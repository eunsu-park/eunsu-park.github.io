{% raw %}
<!DOCTYPE html>
<html lang="ko" data-theme="light">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>3D ë¹„ì „ ê¸°ì´ˆ (3D Vision Basics) - Study Materials</title>
    <link rel="stylesheet" href="/study/static/css/style.css">
    <link rel="stylesheet" href="/study/static/css/highlight.css">
    <!-- KaTeX for LaTeX math rendering -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.16.11/dist/katex.min.css">
    <script defer src="https://cdn.jsdelivr.net/npm/katex@0.16.11/dist/katex.min.js"></script>
    <script defer src="https://cdn.jsdelivr.net/npm/katex@0.16.11/dist/contrib/auto-render.min.js"
        onload="renderMathInElement(document.body, {
            delimiters: [
                {left: '$$', right: '$$', display: true},
                {left: '$', right: '$', display: false}
            ],
            throwOnError: false
        });"></script>
    
</head>
<body>
    <div class="app-container">
        <!-- Sidebar -->
        <aside class="sidebar" id="sidebar">
            <div class="sidebar-header">
                <a href="/study/ko/" class="logo">Study Materials</a>
                <button class="sidebar-toggle" id="sidebar-toggle" aria-label="Toggle sidebar">
                    <span></span>
                </button>
            </div>

            <nav class="sidebar-nav">
                <a href="/study/ko/" class="nav-item ">
                    <span class="nav-icon">ğŸ </span>
                    <span class="nav-text">Home</span>
                </a>
                <a href="/study/examples/" class="nav-item ">
                    <span class="nav-icon">ğŸ’»</span>
                    <span class="nav-text">Examples</span>
                </a>
            </nav>

            <div class="sidebar-search">
                <form action="/study/ko/search.html" method="get" id="search-form">
                    <input type="search" name="q" placeholder="Search..." id="search-sidebar-input">
                </form>
            </div>

            <!-- Language Selector -->
            <div class="sidebar-lang">
                <select id="lang-select" class="lang-selector" onchange="switchLanguage(this.value)">
                    
                    <option value="en" >
                        English
                    </option>
                    
                    <option value="ko" selected>
                        í•œêµ­ì–´
                    </option>
                    
                </select>
            </div>

            <div class="sidebar-footer">
                <button class="theme-toggle" id="theme-toggle" aria-label="Toggle theme">
                    <span class="theme-icon light">â˜€ï¸</span>
                    <span class="theme-icon dark">ğŸŒ™</span>
                </button>
            </div>
        </aside>

        <!-- Main Content -->
        <main class="main-content">
            <header class="main-header">
                <button class="menu-toggle" id="menu-toggle" aria-label="Open menu">
                    <span></span>
                </button>
                
<nav class="breadcrumb">
    <a href="/study/ko/">Topics</a>
    <span class="separator">/</span>
    <a href="/study/ko/Computer_Vision/">Computer Vision</a>
    <span class="separator">/</span>
    <span class="current">3D ë¹„ì „ ê¸°ì´ˆ (3D Vision Basics)</span>
</nav>

            </header>

            <div class="content">
                
<article class="lesson-article">
    <header class="lesson-header">
        <h1>3D ë¹„ì „ ê¸°ì´ˆ (3D Vision Basics)</h1>
    </header>

    
<div class="lesson-toolbar lesson-toolbar--top">
    <div class="toolbar-nav toolbar-nav--prev">
        
        <a href="/study/ko/Computer_Vision/20_Practical_Projects.html" class="nav-prev">
            <span class="nav-label">Previous</span>
            <span class="nav-title">ì‹¤ì „ í”„ë¡œì íŠ¸ (Practical Projects)</span>
        </a>
        
    </div>
    <div class="toolbar-actions">
        <button class="btn btn-copy-link" data-action="copy-link" title="Copy link">
            <span class="icon">ğŸ”—</span>
            <span class="text">Copy link</span>
        </button>
        <a href="/study/ko/Computer_Vision/" class="btn btn-topic-link" title="Back to topic list">
            <span class="icon">ğŸ“‹</span>
            <span class="text">Topic list</span>
        </a>
    </div>
    <div class="toolbar-nav toolbar-nav--next">
        
        <a href="/study/ko/Computer_Vision/22_Depth_Estimation.html" class="nav-next">
            <span class="nav-label">Next</span>
            <span class="nav-title">ë‹¨ì•ˆ ê¹Šì´ ì¶”ì • (Monocular Depth Estimation)</span>
        </a>
        
    </div>
</div>


    
    <nav class="toc" id="toc">
        <h2>Table of Contents</h2>
        <div class="toc">
<ul>
<li><a href="#_1">ê°œìš”</a></li>
<li><a href="#_2">ëª©ì°¨</a></li>
<li><a href="#1-3d">1. 3D ë¹„ì „ ê°œìš”</a><ul>
<li><a href="#3d">3D ë¹„ì „ì˜ ëª©í‘œ</a></li>
<li><a href="#_3">ì¢Œí‘œê³„ ì´í•´</a></li>
</ul>
</li>
<li><a href="#2">2. ìŠ¤í…Œë ˆì˜¤ ë¹„ì „ ì›ë¦¬</a><ul>
<li><a href="#_4">ì—í”¼í´ë¼ ê¸°í•˜í•™</a></li>
<li><a href="#_5">ì‹œì°¨ì™€ ê¹Šì´</a></li>
<li><a href="#_6">ìŠ¤í…Œë ˆì˜¤ ì •í•©</a></li>
</ul>
</li>
<li><a href="#3">3. ê¹Šì´ ë§µ ìƒì„±</a><ul>
<li><a href="#stereobm-block-matching">StereoBM (Block Matching)</a></li>
<li><a href="#stereosgbm-semi-global-block-matching">StereoSGBM (Semi-Global Block Matching)</a></li>
<li><a href="#wls">WLS í•„í„°ë¥¼ ì´ìš©í•œ ì‹œì°¨ ê°œì„ </a></li>
</ul>
</li>
<li><a href="#4">4. í¬ì¸íŠ¸ í´ë¼ìš°ë“œ</a><ul>
<li><a href="#_7">í¬ì¸íŠ¸ í´ë¼ìš°ë“œ ìƒì„±</a></li>
<li><a href="#_8">í¬ì¸íŠ¸ í´ë¼ìš°ë“œ ì²˜ë¦¬</a></li>
</ul>
</li>
<li><a href="#5-open3d">5. Open3D ê¸°ì´ˆ</a><ul>
<li><a href="#open3d">Open3D ì„¤ì¹˜ ë° ê¸°ë³¸ ì‚¬ìš©</a></li>
<li><a href="#_9">ë©”ì‰¬ ì¬êµ¬ì„±</a></li>
<li><a href="#rgbd">RGBD ì´ë¯¸ì§€ ì²˜ë¦¬</a></li>
</ul>
</li>
<li><a href="#6-3d">6. 3D ì¬êµ¬ì„±</a><ul>
<li><a href="#mvs">ë‹¤ì¤‘ ë·° ìŠ¤í…Œë ˆì˜¤ (MVS) ê°œë…</a></li>
<li><a href="#essential-matrix">Essential Matrix ê¸°ë°˜ í¬ì¦ˆ ì¶”ì •</a></li>
<li><a href="#bundle-adjustment">ë²ˆë“¤ ì¡°ì • (Bundle Adjustment)</a></li>
</ul>
</li>
<li><a href="#7">7. ì—°ìŠµ ë¬¸ì œ</a><ul>
<li><a href="#1">ë¬¸ì œ 1: ìŠ¤í…Œë ˆì˜¤ ê¹Šì´ ì¶”ì •</a></li>
<li><a href="#2_1">ë¬¸ì œ 2: í¬ì¸íŠ¸ í´ë¼ìš°ë“œ í•„í„°ë§</a></li>
<li><a href="#3-3d">ë¬¸ì œ 3: ë‘ ë·°ì—ì„œ 3D ì¬êµ¬ì„±</a></li>
<li><a href="#4_1">ë¬¸ì œ 4: ë©”ì‰¬ ì¬êµ¬ì„±</a></li>
<li><a href="#5">ë¬¸ì œ 5: ì‹¤ì‹œê°„ ìŠ¤í…Œë ˆì˜¤ ë¹„ì „</a></li>
</ul>
</li>
<li><a href="#_10">ë‹¤ìŒ ë‹¨ê³„</a></li>
<li><a href="#_11">ì°¸ê³  ìë£Œ</a></li>
</ul>
</div>

    </nav>
    

    <div class="lesson-content markdown-body">
        <h1 id="3d-3d-vision-basics">3D ë¹„ì „ ê¸°ì´ˆ (3D Vision Basics)<a class="header-link" href="#3d-3d-vision-basics" title="Permanent link">&para;</a></h1>
<h2 id="_1">ê°œìš”<a class="header-link" href="#_1" title="Permanent link">&para;</a></h2>
<p>3D ë¹„ì „ì€ 2D ì´ë¯¸ì§€ë¡œë¶€í„° 3ì°¨ì› ì •ë³´ë¥¼ ì¶”ì¶œí•˜ê³  ë³µì›í•˜ëŠ” ê¸°ìˆ ì…ë‹ˆë‹¤. ìŠ¤í…Œë ˆì˜¤ ë¹„ì „, ê¹Šì´ ë§µ, í¬ì¸íŠ¸ í´ë¼ìš°ë“œ ì²˜ë¦¬, 3D ì¬êµ¬ì„±ì˜ ê¸°ì´ˆë¥¼ ë‹¤ë£¹ë‹ˆë‹¤.</p>
<p><strong>ë‚œì´ë„</strong>: â­â­â­â­</p>
<p><strong>ì„ ìˆ˜ ì§€ì‹</strong>: ì¹´ë©”ë¼ ìº˜ë¦¬ë¸Œë ˆì´ì…˜, íŠ¹ì§•ì  ê²€ì¶œ/ë§¤ì¹­, ì„ í˜•ëŒ€ìˆ˜</p>
<hr />
<h2 id="_2">ëª©ì°¨<a class="header-link" href="#_2" title="Permanent link">&para;</a></h2>
<ol>
<li><a href="#1-3d-ë¹„ì „-ê°œìš”">3D ë¹„ì „ ê°œìš”</a></li>
<li><a href="#2-ìŠ¤í…Œë ˆì˜¤-ë¹„ì „-ì›ë¦¬">ìŠ¤í…Œë ˆì˜¤ ë¹„ì „ ì›ë¦¬</a></li>
<li><a href="#3-ê¹Šì´-ë§µ-ìƒì„±">ê¹Šì´ ë§µ ìƒì„±</a></li>
<li><a href="#4-í¬ì¸íŠ¸-í´ë¼ìš°ë“œ">í¬ì¸íŠ¸ í´ë¼ìš°ë“œ</a></li>
<li><a href="#5-open3d-ê¸°ì´ˆ">Open3D ê¸°ì´ˆ</a></li>
<li><a href="#6-3d-ì¬êµ¬ì„±">3D ì¬êµ¬ì„±</a></li>
<li><a href="#7-ì—°ìŠµ-ë¬¸ì œ">ì—°ìŠµ ë¬¸ì œ</a></li>
</ol>
<hr />
<h2 id="1-3d">1. 3D ë¹„ì „ ê°œìš”<a class="header-link" href="#1-3d" title="Permanent link">&para;</a></h2>
<h3 id="3d">3D ë¹„ì „ì˜ ëª©í‘œ<a class="header-link" href="#3d" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><span class="mf">3</span><span class="n">D</span><span class="w"> </span><span class="n">ë¹„ì „</span><span class="w"> </span><span class="n">íŒŒì´í”„ë¼ì¸</span><span class="p">:</span>

<span class="err">â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”</span>
<span class="err">â”‚</span><span class="w">                                                                  </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">  </span><span class="mf">2</span><span class="n">D</span><span class="w"> </span><span class="n">ì´ë¯¸ì§€</span><span class="w"> </span><span class="err">â”€â”€â”€â”€â”€â–¶</span><span class="w"> </span><span class="n">ê¹Šì´</span><span class="w"> </span><span class="n">ì¶”ì •</span><span class="w"> </span><span class="err">â”€â”€â”€â”€â”€â–¶</span><span class="w"> </span><span class="mf">3</span><span class="n">D</span><span class="w"> </span><span class="n">ì¬êµ¬ì„±</span><span class="w">                    </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">      </span><span class="err">â”‚</span><span class="w">                                                           </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">      </span><span class="err">â”‚</span><span class="w">           </span><span class="err">â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”</span><span class="w">                                 </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">      </span><span class="err">â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¶â”‚</span><span class="w"> </span><span class="n">ê¹Šì´</span><span class="w"> </span><span class="n">ì •ë³´</span><span class="w">   </span><span class="err">â”‚â”€â”€â”€â”€â”€â”€â–¶</span><span class="w"> </span><span class="n">í¬ì¸íŠ¸</span><span class="w"> </span><span class="n">í´ë¼ìš°ë“œ</span><span class="w">          </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">                  </span><span class="err">â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜</span><span class="w">            </span><span class="err">â”‚</span><span class="w">                    </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">                                             </span><span class="err">â”‚</span><span class="w">                    </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">                                             </span><span class="err">â–¼</span><span class="w">                    </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">                                      </span><span class="err">â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”</span><span class="w">             </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">                                      </span><span class="err">â”‚</span><span class="w">  </span><span class="mf">3</span><span class="n">D</span><span class="w"> </span><span class="n">ë©”ì‰¬</span><span class="w">    </span><span class="err">â”‚</span><span class="w">             </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">                                      </span><span class="err">â”‚</span><span class="w">  </span><span class="mf">3</span><span class="n">D</span><span class="w"> </span><span class="n">ëª¨ë¸</span><span class="w">    </span><span class="err">â”‚</span><span class="w">             </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">                                      </span><span class="err">â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜</span><span class="w">             </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">                                                                  </span><span class="err">â”‚</span>
<span class="err">â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜</span>

<span class="n">ê¹Šì´</span><span class="w"> </span><span class="n">ì¶”ì¶œ</span><span class="w"> </span><span class="n">ë°©ë²•</span><span class="p">:</span>
<span class="err">â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”</span>
<span class="err">â”‚</span><span class="w"> </span><span class="n">ë°©ë²•</span><span class="w">                </span><span class="err">â”‚</span><span class="w"> </span><span class="n">ì„¤ëª…</span><span class="w">                                     </span><span class="err">â”‚</span>
<span class="err">â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤</span>
<span class="err">â”‚</span><span class="w"> </span><span class="n">ìŠ¤í…Œë ˆì˜¤</span><span class="w"> </span><span class="n">ë¹„ì „</span><span class="w">       </span><span class="err">â”‚</span><span class="w"> </span><span class="n">ë‘</span><span class="w"> </span><span class="n">ì¹´ë©”ë¼ì˜</span><span class="w"> </span><span class="n">ì‹œì°¨ë¡œ</span><span class="w"> </span><span class="n">ê¹Šì´</span><span class="w"> </span><span class="n">ê³„ì‚°</span><span class="w">             </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w"> </span><span class="n">êµ¬ì¡°ê´‘</span><span class="w"> </span><span class="p">(</span><span class="n">Structured</span><span class="p">)</span><span class="w"> </span><span class="err">â”‚</span><span class="w"> </span><span class="n">ì•Œë ¤ì§„</span><span class="w"> </span><span class="n">íŒ¨í„´ì„</span><span class="w"> </span><span class="n">íˆ¬ì‚¬í•˜ì—¬</span><span class="w"> </span><span class="n">ê¹Šì´</span><span class="w"> </span><span class="n">ì¸¡ì •</span><span class="w">         </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w"> </span><span class="kr">To</span><span class="n">F</span><span class="w"> </span><span class="p">(</span><span class="n">Time</span><span class="o">-</span><span class="n">of</span><span class="o">-</span><span class="n">Flight</span><span class="p">)</span><span class="err">â”‚</span><span class="w"> </span><span class="n">ë¹›ì˜</span><span class="w"> </span><span class="n">ë¹„í–‰</span><span class="w"> </span><span class="n">ì‹œê°„ìœ¼ë¡œ</span><span class="w"> </span><span class="n">ê±°ë¦¬</span><span class="w"> </span><span class="n">ì¸¡ì •</span><span class="w">             </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w"> </span><span class="n">ë‹¨ì•ˆ</span><span class="w"> </span><span class="n">ê¹Šì´</span><span class="w"> </span><span class="n">ì¶”ì •</span><span class="w">      </span><span class="err">â”‚</span><span class="w"> </span><span class="n">ë‹¨ì¼</span><span class="w"> </span><span class="n">ì¹´ë©”ë¼</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">ë”¥ëŸ¬ë‹ìœ¼ë¡œ</span><span class="w"> </span><span class="n">ê¹Šì´</span><span class="w"> </span><span class="n">ì˜ˆì¸¡</span><span class="w">       </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w"> </span><span class="n">LiDAR</span><span class="w">               </span><span class="err">â”‚</span><span class="w"> </span><span class="n">ë ˆì´ì €</span><span class="w"> </span><span class="n">ìŠ¤ìºë‹ìœ¼ë¡œ</span><span class="w"> </span><span class="n">ì •ë°€</span><span class="w"> </span><span class="n">ê¹Šì´</span><span class="w"> </span><span class="n">ì¸¡ì •</span><span class="w">         </span><span class="err">â”‚</span>
<span class="err">â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜</span>
</code></pre></div>

<h3 id="_3">ì¢Œí‘œê³„ ì´í•´<a class="header-link" href="#_3" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code>ì¹´ë©”ë¼ ì¢Œí‘œê³„:

        Y (ìœ„)
        â”‚
        â”‚
        â”‚
        â”‚_________ X (ì˜¤ë¥¸ìª½)
       /
      /
     Z (ì¹´ë©”ë¼ ì •ë©´ ë°©í–¥)

ì›”ë“œ ì¢Œí‘œê³„ â†’ ì¹´ë©”ë¼ ì¢Œí‘œê³„ ë³€í™˜:
P_cam = R <span class="gs">* P_world + t</span>

<span class="gs">ì´ë¯¸ì§€ ì¢Œí‘œê³„:</span>
<span class="gs">â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¶ u (ê°€ë¡œ, í”½ì…€)</span>
<span class="gs">â”‚</span>
<span class="gs">â”‚   â— (cx, cy) ì£¼ì </span>
<span class="gs">â”‚</span>
<span class="gs">â–¼</span>
<span class="gs">v (ì„¸ë¡œ, í”½ì…€)</span>

<span class="gs">3D â†’ 2D íˆ¬ì˜:</span>
<span class="gs">u = fx *</span> (X/Z) + cx
v = fy * (Y/Z) + cy
</code></pre></div>

<hr />
<h2 id="2">2. ìŠ¤í…Œë ˆì˜¤ ë¹„ì „ ì›ë¦¬<a class="header-link" href="#2" title="Permanent link">&para;</a></h2>
<h3 id="_4">ì—í”¼í´ë¼ ê¸°í•˜í•™<a class="header-link" href="#_4" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><span class="n">ì—í”¼í´ë¼</span><span class="w"> </span><span class="n">ê¸°í•˜í•™</span><span class="w"> </span><span class="p">(</span><span class="n">Epipolar</span><span class="w"> </span><span class="n">Geometry</span><span class="p">)</span><span class="err">:</span>

<span class="w">             </span><span class="n">ì—í”¼í´</span><span class="w"> </span><span class="p">(</span><span class="n">e</span><span class="p">)</span>
<span class="w">              </span><span class="err">â”‚</span>
<span class="w">   </span><span class="err">â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”</span>
<span class="w">   </span><span class="err">â”‚</span><span class="w">          </span><span class="err">â”‚</span><span class="w">          </span><span class="err">â”‚</span>
<span class="w">   </span><span class="err">â”‚</span><span class="w">    </span><span class="err">â—â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â—</span><span class="w"> </span><span class="n">ì—í”¼í´ë¼</span><span class="w"> </span><span class="n">ì„ </span>
<span class="w">   </span><span class="err">â”‚</span><span class="w">   </span><span class="n">P</span><span class="w">      </span><span class="err">â”‚</span><span class="w">          </span><span class="err">â”‚</span><span class="w">   </span><span class="n">P</span><span class="s1">&#39;</span>
<span class="s1">   â”‚          â”‚          â”‚</span>
<span class="s1">   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜</span>
<span class="s1">       ì™¼ìª½         ì˜¤ë¥¸ìª½</span>
<span class="s1">       ì´ë¯¸ì§€       ì´ë¯¸ì§€</span>

<span class="s1">3D ì  Pê°€ ì™¼ìª½ ì´ë¯¸ì§€ì˜ ì  pì— íˆ¬ì˜ë˜ë©´,</span>
<span class="s1">ì˜¤ë¥¸ìª½ ì´ë¯¸ì§€ì—ì„œëŠ” ì—í”¼í´ë¼ ì„  ìœ„ ì–´ë”˜ê°€ì— p&#39;</span><span class="n">ë¡œ</span><span class="w"> </span><span class="n">íˆ¬ì˜ë¨</span><span class="p">.</span>

<span class="n">í•µì‹¬</span><span class="w"> </span><span class="nl">í–‰ë ¬ë“¤</span><span class="p">:</span>
<span class="err">â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”</span>
<span class="err">â”‚</span><span class="w"> </span><span class="n">í–‰ë ¬</span><span class="w">              </span><span class="err">â”‚</span><span class="w"> </span><span class="n">ì„¤ëª…</span><span class="w">                                    </span><span class="err">â”‚</span>
<span class="err">â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤</span>
<span class="err">â”‚</span><span class="w"> </span><span class="n">Essential</span><span class="w"> </span><span class="n">Matrix</span><span class="w">  </span><span class="err">â”‚</span><span class="w"> </span><span class="n">ì •ê·œí™”ëœ</span><span class="w"> </span><span class="n">ì¢Œí‘œê³„ì—ì„œ</span><span class="w"> </span><span class="n">ê¸°í•˜í•™ì </span><span class="w"> </span><span class="n">ê´€ê³„</span><span class="w">       </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w"> </span><span class="p">(</span><span class="n">E</span><span class="p">)</span><span class="w">               </span><span class="err">â”‚</span><span class="w"> </span><span class="n">E</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">[</span><span class="n">t</span><span class="o">]</span><span class="n">x</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">R</span><span class="w">                            </span><span class="err">â”‚</span>
<span class="err">â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤</span>
<span class="err">â”‚</span><span class="w"> </span><span class="n">Fundamental</span><span class="w"> </span><span class="n">Matrix</span><span class="err">â”‚</span><span class="w"> </span><span class="n">í”½ì…€</span><span class="w"> </span><span class="n">ì¢Œí‘œê³„ì—ì„œ</span><span class="w"> </span><span class="n">ê¸°í•˜í•™ì </span><span class="w"> </span><span class="n">ê´€ê³„</span><span class="w">           </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w"> </span><span class="p">(</span><span class="n">F</span><span class="p">)</span><span class="w">               </span><span class="err">â”‚</span><span class="w"> </span><span class="n">F</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">K</span><span class="s1">&#39;^(-T) * E * K^(-1)               â”‚</span>
<span class="s1">â”‚                   â”‚ p&#39;</span><span class="o">^</span><span class="n">T</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">F</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">p</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="w">                        </span><span class="err">â”‚</span>
<span class="err">â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜</span>
</code></pre></div>

<h3 id="_5">ì‹œì°¨ì™€ ê¹Šì´<a class="header-link" href="#_5" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code>ìŠ¤í…Œë ˆì˜¤ ì‹œì°¨ (Disparity):

ì™¼ìª½ ì¹´ë©”ë¼         ì˜¤ë¥¸ìª½ ì¹´ë©”ë¼
    C_L â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ C_R
     â”‚                    â”‚
     â”‚    b (ë² ì´ìŠ¤ë¼ì¸)   â”‚
     â”‚    â—„â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–º â”‚
     â”‚                    â”‚
     â”‚                    â”‚
     â–¼                    â–¼
    p_L        d        p_R
    â—â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â—
    â”‚                     â”‚
    â”‚     ì‹œì°¨ (d)        â”‚
    â”‚     d = x_L - x_R   â”‚

ê¹Šì´ ê³„ì‚°:
Z = (f * b) / d

ì—¬ê¸°ì„œ:
<span class="k">-</span> Z: ê¹Šì´ (ì¹´ë©”ë¼ë¡œë¶€í„°ì˜ ê±°ë¦¬)
<span class="k">-</span> f: ì´ˆì  ê±°ë¦¬
<span class="k">-</span> b: ë² ì´ìŠ¤ë¼ì¸ (ë‘ ì¹´ë©”ë¼ ì‚¬ì´ ê±°ë¦¬)
<span class="k">-</span> d: ì‹œì°¨ (í”½ì…€ ë‹¨ìœ„)

ì‹œì°¨ ë²”ìœ„ ì˜ˆì‹œ:
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ê±°ë¦¬    â”‚ ì‹œì°¨ (f=500, b=0.1m)          â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ 1m      â”‚ 50 í”½ì…€                       â”‚
â”‚ 5m      â”‚ 10 í”½ì…€                       â”‚
â”‚ 10m     â”‚ 5 í”½ì…€                        â”‚
â”‚ ë¬´í•œëŒ€  â”‚ 0 í”½ì…€                        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
</code></pre></div>

<h3 id="_6">ìŠ¤í…Œë ˆì˜¤ ì •í•©<a class="header-link" href="#_6" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><span class="kn">import</span><span class="w"> </span><span class="nn">cv2</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">numpy</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">np</span>

<span class="k">def</span><span class="w"> </span><span class="nf">stereo_calibrate</span><span class="p">(</span><span class="n">obj_points</span><span class="p">,</span> <span class="n">img_points_left</span><span class="p">,</span> <span class="n">img_points_right</span><span class="p">,</span>
                     <span class="n">K1</span><span class="p">,</span> <span class="n">D1</span><span class="p">,</span> <span class="n">K2</span><span class="p">,</span> <span class="n">D2</span><span class="p">,</span> <span class="n">img_size</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;ìŠ¤í…Œë ˆì˜¤ ì¹´ë©”ë¼ ìº˜ë¦¬ë¸Œë ˆì´ì…˜&quot;&quot;&quot;</span>

    <span class="n">flags</span> <span class="o">=</span> <span class="p">(</span><span class="n">cv2</span><span class="o">.</span><span class="n">CALIB_FIX_INTRINSIC</span> <span class="o">+</span>
             <span class="n">cv2</span><span class="o">.</span><span class="n">CALIB_RATIONAL_MODEL</span><span class="p">)</span>

    <span class="n">ret</span><span class="p">,</span> <span class="n">K1</span><span class="p">,</span> <span class="n">D1</span><span class="p">,</span> <span class="n">K2</span><span class="p">,</span> <span class="n">D2</span><span class="p">,</span> <span class="n">R</span><span class="p">,</span> <span class="n">T</span><span class="p">,</span> <span class="n">E</span><span class="p">,</span> <span class="n">F</span> <span class="o">=</span> <span class="n">cv2</span><span class="o">.</span><span class="n">stereoCalibrate</span><span class="p">(</span>
        <span class="n">obj_points</span><span class="p">,</span>
        <span class="n">img_points_left</span><span class="p">,</span>
        <span class="n">img_points_right</span><span class="p">,</span>
        <span class="n">K1</span><span class="p">,</span> <span class="n">D1</span><span class="p">,</span>
        <span class="n">K2</span><span class="p">,</span> <span class="n">D2</span><span class="p">,</span>
        <span class="n">img_size</span><span class="p">,</span>
        <span class="n">flags</span><span class="o">=</span><span class="n">flags</span>
    <span class="p">)</span>

    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;ìŠ¤í…Œë ˆì˜¤ ìº˜ë¦¬ë¸Œë ˆì´ì…˜ RMS ì˜¤ì°¨: </span><span class="si">{</span><span class="n">ret</span><span class="si">:</span><span class="s2">.4f</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">íšŒì „ í–‰ë ¬ R:</span><span class="se">\n</span><span class="si">{</span><span class="n">R</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">í‰í–‰ ì´ë™ ë²¡í„° T:</span><span class="se">\n</span><span class="si">{</span><span class="n">T</span><span class="o">.</span><span class="n">ravel</span><span class="p">()</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">ë² ì´ìŠ¤ë¼ì¸: </span><span class="si">{</span><span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">norm</span><span class="p">(</span><span class="n">T</span><span class="p">)</span><span class="si">:</span><span class="s2">.4f</span><span class="si">}</span><span class="s2"> ë‹¨ìœ„&quot;</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">R</span><span class="p">,</span> <span class="n">T</span><span class="p">,</span> <span class="n">E</span><span class="p">,</span> <span class="n">F</span>

<span class="k">def</span><span class="w"> </span><span class="nf">stereo_rectify</span><span class="p">(</span><span class="n">K1</span><span class="p">,</span> <span class="n">D1</span><span class="p">,</span> <span class="n">K2</span><span class="p">,</span> <span class="n">D2</span><span class="p">,</span> <span class="n">img_size</span><span class="p">,</span> <span class="n">R</span><span class="p">,</span> <span class="n">T</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;ìŠ¤í…Œë ˆì˜¤ ì •ë¥˜ (Rectification)&quot;&quot;&quot;</span>

    <span class="c1"># ì •ë¥˜ ë³€í™˜ ê³„ì‚°</span>
    <span class="n">R1</span><span class="p">,</span> <span class="n">R2</span><span class="p">,</span> <span class="n">P1</span><span class="p">,</span> <span class="n">P2</span><span class="p">,</span> <span class="n">Q</span><span class="p">,</span> <span class="n">roi1</span><span class="p">,</span> <span class="n">roi2</span> <span class="o">=</span> <span class="n">cv2</span><span class="o">.</span><span class="n">stereoRectify</span><span class="p">(</span>
        <span class="n">K1</span><span class="p">,</span> <span class="n">D1</span><span class="p">,</span>
        <span class="n">K2</span><span class="p">,</span> <span class="n">D2</span><span class="p">,</span>
        <span class="n">img_size</span><span class="p">,</span>
        <span class="n">R</span><span class="p">,</span> <span class="n">T</span><span class="p">,</span>
        <span class="n">alpha</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>  <span class="c1"># 0: ìœ íš¨ í”½ì…€ë§Œ, 1: ëª¨ë“  í”½ì…€</span>
        <span class="n">newImageSize</span><span class="o">=</span><span class="n">img_size</span>
    <span class="p">)</span>

    <span class="c1"># Q í–‰ë ¬: ì‹œì°¨ â†’ 3D ë³€í™˜ì— ì‚¬ìš©</span>
    <span class="c1"># [X Y Z W]^T = Q * [x y disparity 1]^T</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Q í–‰ë ¬ (ì‹œì°¨ â†’ 3D ë³€í™˜):&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">Q</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">R1</span><span class="p">,</span> <span class="n">R2</span><span class="p">,</span> <span class="n">P1</span><span class="p">,</span> <span class="n">P2</span><span class="p">,</span> <span class="n">Q</span><span class="p">,</span> <span class="n">roi1</span><span class="p">,</span> <span class="n">roi2</span>

<span class="k">def</span><span class="w"> </span><span class="nf">create_rectification_maps</span><span class="p">(</span><span class="n">K</span><span class="p">,</span> <span class="n">D</span><span class="p">,</span> <span class="n">R</span><span class="p">,</span> <span class="n">P</span><span class="p">,</span> <span class="n">img_size</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;ì •ë¥˜ ë§µ ìƒì„±&quot;&quot;&quot;</span>

    <span class="n">map1</span><span class="p">,</span> <span class="n">map2</span> <span class="o">=</span> <span class="n">cv2</span><span class="o">.</span><span class="n">initUndistortRectifyMap</span><span class="p">(</span>
        <span class="n">K</span><span class="p">,</span> <span class="n">D</span><span class="p">,</span> <span class="n">R</span><span class="p">,</span> <span class="n">P</span><span class="p">,</span> <span class="n">img_size</span><span class="p">,</span> <span class="n">cv2</span><span class="o">.</span><span class="n">CV_32FC1</span>
    <span class="p">)</span>

    <span class="k">return</span> <span class="n">map1</span><span class="p">,</span> <span class="n">map2</span>

<span class="k">def</span><span class="w"> </span><span class="nf">rectify_stereo_pair</span><span class="p">(</span><span class="n">img_left</span><span class="p">,</span> <span class="n">img_right</span><span class="p">,</span> <span class="n">maps_left</span><span class="p">,</span> <span class="n">maps_right</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;ìŠ¤í…Œë ˆì˜¤ ì´ë¯¸ì§€ ìŒ ì •ë¥˜&quot;&quot;&quot;</span>

    <span class="n">rect_left</span> <span class="o">=</span> <span class="n">cv2</span><span class="o">.</span><span class="n">remap</span><span class="p">(</span><span class="n">img_left</span><span class="p">,</span> <span class="n">maps_left</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">maps_left</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span>
                          <span class="n">cv2</span><span class="o">.</span><span class="n">INTER_LINEAR</span><span class="p">)</span>
    <span class="n">rect_right</span> <span class="o">=</span> <span class="n">cv2</span><span class="o">.</span><span class="n">remap</span><span class="p">(</span><span class="n">img_right</span><span class="p">,</span> <span class="n">maps_right</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">maps_right</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span>
                           <span class="n">cv2</span><span class="o">.</span><span class="n">INTER_LINEAR</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">rect_left</span><span class="p">,</span> <span class="n">rect_right</span>
</code></pre></div>

<hr />
<h2 id="3">3. ê¹Šì´ ë§µ ìƒì„±<a class="header-link" href="#3" title="Permanent link">&para;</a></h2>
<h3 id="stereobm-block-matching">StereoBM (Block Matching)<a class="header-link" href="#stereobm-block-matching" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><span class="kn">import</span><span class="w"> </span><span class="nn">cv2</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">numpy</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">np</span>

<span class="k">def</span><span class="w"> </span><span class="nf">compute_disparity_bm</span><span class="p">(</span><span class="n">left</span><span class="p">,</span> <span class="n">right</span><span class="p">,</span> <span class="n">num_disparities</span><span class="o">=</span><span class="mi">64</span><span class="p">,</span> <span class="n">block_size</span><span class="o">=</span><span class="mi">15</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;StereoBMì„ ì´ìš©í•œ ì‹œì°¨ ë§µ ê³„ì‚°&quot;&quot;&quot;</span>

    <span class="c1"># ê·¸ë ˆì´ìŠ¤ì¼€ì¼ ë³€í™˜</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">left</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span> <span class="o">==</span> <span class="mi">3</span><span class="p">:</span>
        <span class="n">left</span> <span class="o">=</span> <span class="n">cv2</span><span class="o">.</span><span class="n">cvtColor</span><span class="p">(</span><span class="n">left</span><span class="p">,</span> <span class="n">cv2</span><span class="o">.</span><span class="n">COLOR_BGR2GRAY</span><span class="p">)</span>
        <span class="n">right</span> <span class="o">=</span> <span class="n">cv2</span><span class="o">.</span><span class="n">cvtColor</span><span class="p">(</span><span class="n">right</span><span class="p">,</span> <span class="n">cv2</span><span class="o">.</span><span class="n">COLOR_BGR2GRAY</span><span class="p">)</span>

    <span class="c1"># StereoBM ìƒì„±</span>
    <span class="n">stereo</span> <span class="o">=</span> <span class="n">cv2</span><span class="o">.</span><span class="n">StereoBM_create</span><span class="p">(</span>
        <span class="n">numDisparities</span><span class="o">=</span><span class="n">num_disparities</span><span class="p">,</span>  <span class="c1"># 16ì˜ ë°°ìˆ˜</span>
        <span class="n">blockSize</span><span class="o">=</span><span class="n">block_size</span>              <span class="c1"># í™€ìˆ˜, 5~21</span>
    <span class="p">)</span>

    <span class="c1"># íŒŒë¼ë¯¸í„° ì¡°ì • (ì„ íƒ)</span>
    <span class="n">stereo</span><span class="o">.</span><span class="n">setMinDisparity</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
    <span class="n">stereo</span><span class="o">.</span><span class="n">setSpeckleWindowSize</span><span class="p">(</span><span class="mi">100</span><span class="p">)</span>
    <span class="n">stereo</span><span class="o">.</span><span class="n">setSpeckleRange</span><span class="p">(</span><span class="mi">32</span><span class="p">)</span>
    <span class="n">stereo</span><span class="o">.</span><span class="n">setPreFilterType</span><span class="p">(</span><span class="n">cv2</span><span class="o">.</span><span class="n">STEREO_BM_PREFILTER_NORMALIZED_RESPONSE</span><span class="p">)</span>
    <span class="n">stereo</span><span class="o">.</span><span class="n">setPreFilterSize</span><span class="p">(</span><span class="mi">9</span><span class="p">)</span>
    <span class="n">stereo</span><span class="o">.</span><span class="n">setPreFilterCap</span><span class="p">(</span><span class="mi">31</span><span class="p">)</span>
    <span class="n">stereo</span><span class="o">.</span><span class="n">setTextureThreshold</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span>
    <span class="n">stereo</span><span class="o">.</span><span class="n">setUniquenessRatio</span><span class="p">(</span><span class="mi">15</span><span class="p">)</span>

    <span class="c1"># ì‹œì°¨ ê³„ì‚°</span>
    <span class="n">disparity</span> <span class="o">=</span> <span class="n">stereo</span><span class="o">.</span><span class="n">compute</span><span class="p">(</span><span class="n">left</span><span class="p">,</span> <span class="n">right</span><span class="p">)</span>

    <span class="c1"># ì‹œì°¨ ê°’ ì •ê·œí™” (16ë°°ë¡œ ìŠ¤ì¼€ì¼ë˜ì–´ ìˆìŒ)</span>
    <span class="n">disparity</span> <span class="o">=</span> <span class="n">disparity</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">float32</span><span class="p">)</span> <span class="o">/</span> <span class="mf">16.0</span>

    <span class="k">return</span> <span class="n">disparity</span>

<span class="k">def</span><span class="w"> </span><span class="nf">visualize_disparity</span><span class="p">(</span><span class="n">disparity</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;ì‹œì°¨ ë§µ ì‹œê°í™”&quot;&quot;&quot;</span>

    <span class="c1"># ìœ íš¨í•œ ì‹œì°¨ë§Œ ì‚¬ìš©</span>
    <span class="n">valid_mask</span> <span class="o">=</span> <span class="n">disparity</span> <span class="o">&gt;</span> <span class="mi">0</span>

    <span class="c1"># ì •ê·œí™”</span>
    <span class="n">disp_vis</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros_like</span><span class="p">(</span><span class="n">disparity</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">any</span><span class="p">(</span><span class="n">valid_mask</span><span class="p">):</span>
        <span class="n">disp_min</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">disparity</span><span class="p">[</span><span class="n">valid_mask</span><span class="p">])</span>
        <span class="n">disp_max</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">disparity</span><span class="p">[</span><span class="n">valid_mask</span><span class="p">])</span>
        <span class="n">disp_vis</span> <span class="o">=</span> <span class="p">(</span><span class="n">disparity</span> <span class="o">-</span> <span class="n">disp_min</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="n">disp_max</span> <span class="o">-</span> <span class="n">disp_min</span><span class="p">)</span> <span class="o">*</span> <span class="mi">255</span>

    <span class="n">disp_vis</span> <span class="o">=</span> <span class="n">disp_vis</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">uint8</span><span class="p">)</span>

    <span class="c1"># ì»¬ëŸ¬ë§µ ì ìš©</span>
    <span class="n">disp_color</span> <span class="o">=</span> <span class="n">cv2</span><span class="o">.</span><span class="n">applyColorMap</span><span class="p">(</span><span class="n">disp_vis</span><span class="p">,</span> <span class="n">cv2</span><span class="o">.</span><span class="n">COLORMAP_JET</span><span class="p">)</span>

    <span class="c1"># ìœ íš¨í•˜ì§€ ì•Šì€ ì˜ì—­ì€ ê²€ì€ìƒ‰ìœ¼ë¡œ</span>
    <span class="n">disp_color</span><span class="p">[</span><span class="o">~</span><span class="n">valid_mask</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span>

    <span class="k">return</span> <span class="n">disp_color</span>
</code></pre></div>

<h3 id="stereosgbm-semi-global-block-matching">StereoSGBM (Semi-Global Block Matching)<a class="header-link" href="#stereosgbm-semi-global-block-matching" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">compute_disparity_sgbm</span><span class="p">(</span><span class="n">left</span><span class="p">,</span> <span class="n">right</span><span class="p">,</span> <span class="n">num_disparities</span><span class="o">=</span><span class="mi">64</span><span class="p">,</span> <span class="n">block_size</span><span class="o">=</span><span class="mi">5</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;StereoSGBMì„ ì´ìš©í•œ ì‹œì°¨ ë§µ ê³„ì‚°&quot;&quot;&quot;</span>

    <span class="c1"># ê·¸ë ˆì´ìŠ¤ì¼€ì¼ ë³€í™˜</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">left</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span> <span class="o">==</span> <span class="mi">3</span><span class="p">:</span>
        <span class="n">gray_left</span> <span class="o">=</span> <span class="n">cv2</span><span class="o">.</span><span class="n">cvtColor</span><span class="p">(</span><span class="n">left</span><span class="p">,</span> <span class="n">cv2</span><span class="o">.</span><span class="n">COLOR_BGR2GRAY</span><span class="p">)</span>
        <span class="n">gray_right</span> <span class="o">=</span> <span class="n">cv2</span><span class="o">.</span><span class="n">cvtColor</span><span class="p">(</span><span class="n">right</span><span class="p">,</span> <span class="n">cv2</span><span class="o">.</span><span class="n">COLOR_BGR2GRAY</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">gray_left</span><span class="p">,</span> <span class="n">gray_right</span> <span class="o">=</span> <span class="n">left</span><span class="p">,</span> <span class="n">right</span>

    <span class="c1"># SGBM íŒŒë¼ë¯¸í„°</span>
    <span class="c1"># P1, P2: ì¸ì ‘ í”½ì…€ ê°„ ì‹œì°¨ ì°¨ì´ì— ëŒ€í•œ í˜ë„í‹°</span>
    <span class="n">P1</span> <span class="o">=</span> <span class="mi">8</span> <span class="o">*</span> <span class="mi">3</span> <span class="o">*</span> <span class="n">block_size</span> <span class="o">**</span> <span class="mi">2</span>
    <span class="n">P2</span> <span class="o">=</span> <span class="mi">32</span> <span class="o">*</span> <span class="mi">3</span> <span class="o">*</span> <span class="n">block_size</span> <span class="o">**</span> <span class="mi">2</span>

    <span class="n">stereo</span> <span class="o">=</span> <span class="n">cv2</span><span class="o">.</span><span class="n">StereoSGBM_create</span><span class="p">(</span>
        <span class="n">minDisparity</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
        <span class="n">numDisparities</span><span class="o">=</span><span class="n">num_disparities</span><span class="p">,</span>
        <span class="n">blockSize</span><span class="o">=</span><span class="n">block_size</span><span class="p">,</span>
        <span class="n">P1</span><span class="o">=</span><span class="n">P1</span><span class="p">,</span>
        <span class="n">P2</span><span class="o">=</span><span class="n">P2</span><span class="p">,</span>
        <span class="n">disp12MaxDiff</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
        <span class="n">uniquenessRatio</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span>
        <span class="n">speckleWindowSize</span><span class="o">=</span><span class="mi">100</span><span class="p">,</span>
        <span class="n">speckleRange</span><span class="o">=</span><span class="mi">32</span><span class="p">,</span>
        <span class="n">preFilterCap</span><span class="o">=</span><span class="mi">63</span><span class="p">,</span>
        <span class="n">mode</span><span class="o">=</span><span class="n">cv2</span><span class="o">.</span><span class="n">STEREO_SGBM_MODE_SGBM_3WAY</span>
    <span class="p">)</span>

    <span class="c1"># ì‹œì°¨ ê³„ì‚°</span>
    <span class="n">disparity</span> <span class="o">=</span> <span class="n">stereo</span><span class="o">.</span><span class="n">compute</span><span class="p">(</span><span class="n">gray_left</span><span class="p">,</span> <span class="n">gray_right</span><span class="p">)</span>
    <span class="n">disparity</span> <span class="o">=</span> <span class="n">disparity</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">float32</span><span class="p">)</span> <span class="o">/</span> <span class="mf">16.0</span>

    <span class="k">return</span> <span class="n">disparity</span>

<span class="k">def</span><span class="w"> </span><span class="nf">disparity_to_depth</span><span class="p">(</span><span class="n">disparity</span><span class="p">,</span> <span class="n">Q</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;ì‹œì°¨ ë§µì„ ê¹Šì´ ë§µìœ¼ë¡œ ë³€í™˜&quot;&quot;&quot;</span>

    <span class="c1"># Q í–‰ë ¬ì„ ì´ìš©í•œ 3D ì¬íˆ¬ì˜</span>
    <span class="c1"># points_3d[y, x] = [X, Y, Z, W]</span>
    <span class="n">points_3d</span> <span class="o">=</span> <span class="n">cv2</span><span class="o">.</span><span class="n">reprojectImageTo3D</span><span class="p">(</span><span class="n">disparity</span><span class="p">,</span> <span class="n">Q</span><span class="p">)</span>

    <span class="c1"># Z ê°’ (ê¹Šì´) ì¶”ì¶œ</span>
    <span class="n">depth</span> <span class="o">=</span> <span class="n">points_3d</span><span class="p">[:,</span> <span class="p">:,</span> <span class="mi">2</span><span class="p">]</span>

    <span class="c1"># ìœ íš¨í•˜ì§€ ì•Šì€ ê¹Šì´ í•„í„°ë§</span>
    <span class="n">valid_mask</span> <span class="o">=</span> <span class="p">(</span><span class="n">disparity</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">depth</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">depth</span> <span class="o">&lt;</span> <span class="mi">10000</span><span class="p">)</span>
    <span class="n">depth</span><span class="p">[</span><span class="o">~</span><span class="n">valid_mask</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>

    <span class="k">return</span> <span class="n">depth</span><span class="p">,</span> <span class="n">points_3d</span>

<span class="k">def</span><span class="w"> </span><span class="nf">create_depth_colormap</span><span class="p">(</span><span class="n">depth</span><span class="p">,</span> <span class="n">max_depth</span><span class="o">=</span><span class="mf">10.0</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;ê¹Šì´ ë§µ ì‹œê°í™”&quot;&quot;&quot;</span>

    <span class="c1"># ê¹Šì´ í´ë¦¬í•‘</span>
    <span class="n">depth_clipped</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">clip</span><span class="p">(</span><span class="n">depth</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">max_depth</span><span class="p">)</span>

    <span class="c1"># ì •ê·œí™” (0-255)</span>
    <span class="n">depth_norm</span> <span class="o">=</span> <span class="p">(</span><span class="n">depth_clipped</span> <span class="o">/</span> <span class="n">max_depth</span> <span class="o">*</span> <span class="mi">255</span><span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">uint8</span><span class="p">)</span>

    <span class="c1"># ì»¬ëŸ¬ë§µ ì ìš© (ê°€ê¹Œìš´ = ë¹¨ê°•, ë¨¼ = íŒŒë‘)</span>
    <span class="n">depth_color</span> <span class="o">=</span> <span class="n">cv2</span><span class="o">.</span><span class="n">applyColorMap</span><span class="p">(</span><span class="mi">255</span> <span class="o">-</span> <span class="n">depth_norm</span><span class="p">,</span> <span class="n">cv2</span><span class="o">.</span><span class="n">COLORMAP_JET</span><span class="p">)</span>

    <span class="c1"># ìœ íš¨í•˜ì§€ ì•Šì€ ì˜ì—­ ë§ˆìŠ¤í‚¹</span>
    <span class="n">depth_color</span><span class="p">[</span><span class="n">depth</span> <span class="o">&lt;=</span> <span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span>

    <span class="k">return</span> <span class="n">depth_color</span>
</code></pre></div>

<h3 id="wls">WLS í•„í„°ë¥¼ ì´ìš©í•œ ì‹œì°¨ ê°œì„ <a class="header-link" href="#wls" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">compute_disparity_with_wls</span><span class="p">(</span><span class="n">left</span><span class="p">,</span> <span class="n">right</span><span class="p">,</span> <span class="n">num_disparities</span><span class="o">=</span><span class="mi">64</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;WLS í•„í„°ë¡œ ê°œì„ ëœ ì‹œì°¨ ë§µ ê³„ì‚°&quot;&quot;&quot;</span>

    <span class="c1"># ê·¸ë ˆì´ìŠ¤ì¼€ì¼</span>
    <span class="n">gray_left</span> <span class="o">=</span> <span class="n">cv2</span><span class="o">.</span><span class="n">cvtColor</span><span class="p">(</span><span class="n">left</span><span class="p">,</span> <span class="n">cv2</span><span class="o">.</span><span class="n">COLOR_BGR2GRAY</span><span class="p">)</span>
    <span class="n">gray_right</span> <span class="o">=</span> <span class="n">cv2</span><span class="o">.</span><span class="n">cvtColor</span><span class="p">(</span><span class="n">right</span><span class="p">,</span> <span class="n">cv2</span><span class="o">.</span><span class="n">COLOR_BGR2GRAY</span><span class="p">)</span>

    <span class="c1"># ì™¼ìª½ ë§¤ì²˜</span>
    <span class="n">left_matcher</span> <span class="o">=</span> <span class="n">cv2</span><span class="o">.</span><span class="n">StereoSGBM_create</span><span class="p">(</span>
        <span class="n">minDisparity</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
        <span class="n">numDisparities</span><span class="o">=</span><span class="n">num_disparities</span><span class="p">,</span>
        <span class="n">blockSize</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span>
        <span class="n">P1</span><span class="o">=</span><span class="mi">8</span> <span class="o">*</span> <span class="mi">3</span> <span class="o">*</span> <span class="mi">5</span> <span class="o">**</span> <span class="mi">2</span><span class="p">,</span>
        <span class="n">P2</span><span class="o">=</span><span class="mi">32</span> <span class="o">*</span> <span class="mi">3</span> <span class="o">*</span> <span class="mi">5</span> <span class="o">**</span> <span class="mi">2</span><span class="p">,</span>
        <span class="n">disp12MaxDiff</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
        <span class="n">uniquenessRatio</span><span class="o">=</span><span class="mi">15</span><span class="p">,</span>
        <span class="n">speckleWindowSize</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
        <span class="n">speckleRange</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span>
        <span class="n">preFilterCap</span><span class="o">=</span><span class="mi">63</span><span class="p">,</span>
        <span class="n">mode</span><span class="o">=</span><span class="n">cv2</span><span class="o">.</span><span class="n">STEREO_SGBM_MODE_SGBM_3WAY</span>
    <span class="p">)</span>

    <span class="c1"># ì˜¤ë¥¸ìª½ ë§¤ì²˜ (ì™¼ìª½-ì˜¤ë¥¸ìª½ ì¼ê´€ì„± ê²€ì‚¬ìš©)</span>
    <span class="n">right_matcher</span> <span class="o">=</span> <span class="n">cv2</span><span class="o">.</span><span class="n">ximgproc</span><span class="o">.</span><span class="n">createRightMatcher</span><span class="p">(</span><span class="n">left_matcher</span><span class="p">)</span>

    <span class="c1"># ì‹œì°¨ ê³„ì‚°</span>
    <span class="n">left_disp</span> <span class="o">=</span> <span class="n">left_matcher</span><span class="o">.</span><span class="n">compute</span><span class="p">(</span><span class="n">gray_left</span><span class="p">,</span> <span class="n">gray_right</span><span class="p">)</span>
    <span class="n">right_disp</span> <span class="o">=</span> <span class="n">right_matcher</span><span class="o">.</span><span class="n">compute</span><span class="p">(</span><span class="n">gray_right</span><span class="p">,</span> <span class="n">gray_left</span><span class="p">)</span>

    <span class="c1"># WLS í•„í„°</span>
    <span class="n">wls_filter</span> <span class="o">=</span> <span class="n">cv2</span><span class="o">.</span><span class="n">ximgproc</span><span class="o">.</span><span class="n">createDisparityWLSFilter</span><span class="p">(</span><span class="n">left_matcher</span><span class="p">)</span>
    <span class="n">wls_filter</span><span class="o">.</span><span class="n">setLambda</span><span class="p">(</span><span class="mi">80000</span><span class="p">)</span>
    <span class="n">wls_filter</span><span class="o">.</span><span class="n">setSigmaColor</span><span class="p">(</span><span class="mf">1.2</span><span class="p">)</span>

    <span class="c1"># í•„í„° ì ìš©</span>
    <span class="n">filtered_disp</span> <span class="o">=</span> <span class="n">wls_filter</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">left_disp</span><span class="p">,</span> <span class="n">left</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="n">right_disp</span><span class="p">)</span>
    <span class="n">filtered_disp</span> <span class="o">=</span> <span class="n">filtered_disp</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">float32</span><span class="p">)</span> <span class="o">/</span> <span class="mf">16.0</span>

    <span class="k">return</span> <span class="n">filtered_disp</span>
</code></pre></div>

<hr />
<h2 id="4">4. í¬ì¸íŠ¸ í´ë¼ìš°ë“œ<a class="header-link" href="#4" title="Permanent link">&para;</a></h2>
<h3 id="_7">í¬ì¸íŠ¸ í´ë¼ìš°ë“œ ìƒì„±<a class="header-link" href="#_7" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><span class="kn">import</span><span class="w"> </span><span class="nn">cv2</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">numpy</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">np</span>

<span class="k">def</span><span class="w"> </span><span class="nf">create_point_cloud</span><span class="p">(</span><span class="n">depth</span><span class="p">,</span> <span class="n">rgb</span><span class="p">,</span> <span class="n">K</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;ê¹Šì´ ë§µê³¼ RGB ì´ë¯¸ì§€ë¡œ í¬ì¸íŠ¸ í´ë¼ìš°ë“œ ìƒì„±&quot;&quot;&quot;</span>

    <span class="n">h</span><span class="p">,</span> <span class="n">w</span> <span class="o">=</span> <span class="n">depth</span><span class="o">.</span><span class="n">shape</span>
    <span class="n">fx</span><span class="p">,</span> <span class="n">fy</span> <span class="o">=</span> <span class="n">K</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span> <span class="n">K</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span>
    <span class="n">cx</span><span class="p">,</span> <span class="n">cy</span> <span class="o">=</span> <span class="n">K</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">2</span><span class="p">],</span> <span class="n">K</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">]</span>

    <span class="c1"># í”½ì…€ ì¢Œí‘œ ê·¸ë¦¬ë“œ</span>
    <span class="n">u</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">w</span><span class="p">)</span>
    <span class="n">v</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">h</span><span class="p">)</span>
    <span class="n">u</span><span class="p">,</span> <span class="n">v</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">meshgrid</span><span class="p">(</span><span class="n">u</span><span class="p">,</span> <span class="n">v</span><span class="p">)</span>

    <span class="c1"># ìœ íš¨í•œ ê¹Šì´ ë§ˆìŠ¤í¬</span>
    <span class="n">valid</span> <span class="o">=</span> <span class="n">depth</span> <span class="o">&gt;</span> <span class="mi">0</span>

    <span class="c1"># 3D ì¢Œí‘œ ê³„ì‚°</span>
    <span class="n">Z</span> <span class="o">=</span> <span class="n">depth</span><span class="p">[</span><span class="n">valid</span><span class="p">]</span>
    <span class="n">X</span> <span class="o">=</span> <span class="p">(</span><span class="n">u</span><span class="p">[</span><span class="n">valid</span><span class="p">]</span> <span class="o">-</span> <span class="n">cx</span><span class="p">)</span> <span class="o">*</span> <span class="n">Z</span> <span class="o">/</span> <span class="n">fx</span>
    <span class="n">Y</span> <span class="o">=</span> <span class="p">(</span><span class="n">v</span><span class="p">[</span><span class="n">valid</span><span class="p">]</span> <span class="o">-</span> <span class="n">cy</span><span class="p">)</span> <span class="o">*</span> <span class="n">Z</span> <span class="o">/</span> <span class="n">fy</span>

    <span class="c1"># í¬ì¸íŠ¸ í´ë¼ìš°ë“œ (N x 3)</span>
    <span class="n">points</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">stack</span><span class="p">([</span><span class="n">X</span><span class="p">,</span> <span class="n">Y</span><span class="p">,</span> <span class="n">Z</span><span class="p">],</span> <span class="n">axis</span><span class="o">=-</span><span class="mi">1</span><span class="p">)</span>

    <span class="c1"># ìƒ‰ìƒ ì •ë³´ (N x 3)</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">rgb</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span> <span class="o">==</span> <span class="mi">3</span><span class="p">:</span>
        <span class="n">colors</span> <span class="o">=</span> <span class="n">rgb</span><span class="p">[</span><span class="n">valid</span><span class="p">]</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">colors</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">stack</span><span class="p">([</span><span class="n">rgb</span><span class="p">[</span><span class="n">valid</span><span class="p">]]</span> <span class="o">*</span> <span class="mi">3</span><span class="p">,</span> <span class="n">axis</span><span class="o">=-</span><span class="mi">1</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">points</span><span class="p">,</span> <span class="n">colors</span>

<span class="k">def</span><span class="w"> </span><span class="nf">subsample_point_cloud</span><span class="p">(</span><span class="n">points</span><span class="p">,</span> <span class="n">colors</span><span class="p">,</span> <span class="n">voxel_size</span><span class="o">=</span><span class="mf">0.01</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;ë³µì…€ ê·¸ë¦¬ë“œë¡œ í¬ì¸íŠ¸ í´ë¼ìš°ë“œ ë‹¤ìš´ìƒ˜í”Œë§&quot;&quot;&quot;</span>

    <span class="c1"># ë³µì…€ ì¸ë±ìŠ¤ ê³„ì‚°</span>
    <span class="n">voxel_indices</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">floor</span><span class="p">(</span><span class="n">points</span> <span class="o">/</span> <span class="n">voxel_size</span><span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">int</span><span class="p">)</span>

    <span class="c1"># ê³ ìœ í•œ ë³µì…€ë§Œ ì„ íƒ</span>
    <span class="n">_</span><span class="p">,</span> <span class="n">unique_indices</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">unique</span><span class="p">(</span>
        <span class="n">voxel_indices</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">return_index</span><span class="o">=</span><span class="kc">True</span>
    <span class="p">)</span>

    <span class="k">return</span> <span class="n">points</span><span class="p">[</span><span class="n">unique_indices</span><span class="p">],</span> <span class="n">colors</span><span class="p">[</span><span class="n">unique_indices</span><span class="p">]</span>

<span class="k">def</span><span class="w"> </span><span class="nf">save_point_cloud_ply</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="n">points</span><span class="p">,</span> <span class="n">colors</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;PLY í˜•ì‹ìœ¼ë¡œ í¬ì¸íŠ¸ í´ë¼ìš°ë“œ ì €ì¥&quot;&quot;&quot;</span>

    <span class="n">n_points</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">points</span><span class="p">)</span>

    <span class="c1"># PLY í—¤ë”</span>
    <span class="n">header</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;&quot;&quot;ply</span>
<span class="s2">format ascii 1.0</span>
<span class="s2">element vertex </span><span class="si">{</span><span class="n">n_points</span><span class="si">}</span>
<span class="s2">property float x</span>
<span class="s2">property float y</span>
<span class="s2">property float z</span>
<span class="s2">property uchar red</span>
<span class="s2">property uchar green</span>
<span class="s2">property uchar blue</span>
<span class="s2">end_header</span>
<span class="s2">&quot;&quot;&quot;</span>

    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="s1">&#39;w&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
        <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">header</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n_points</span><span class="p">):</span>
            <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">z</span> <span class="o">=</span> <span class="n">points</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
            <span class="n">r</span><span class="p">,</span> <span class="n">g</span><span class="p">,</span> <span class="n">b</span> <span class="o">=</span> <span class="n">colors</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
            <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">x</span><span class="si">:</span><span class="s2">.6f</span><span class="si">}</span><span class="s2"> </span><span class="si">{</span><span class="n">y</span><span class="si">:</span><span class="s2">.6f</span><span class="si">}</span><span class="s2"> </span><span class="si">{</span><span class="n">z</span><span class="si">:</span><span class="s2">.6f</span><span class="si">}</span><span class="s2"> </span><span class="si">{</span><span class="nb">int</span><span class="p">(</span><span class="n">r</span><span class="p">)</span><span class="si">}</span><span class="s2"> </span><span class="si">{</span><span class="nb">int</span><span class="p">(</span><span class="n">g</span><span class="p">)</span><span class="si">}</span><span class="s2"> </span><span class="si">{</span><span class="nb">int</span><span class="p">(</span><span class="n">b</span><span class="p">)</span><span class="si">}</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>

    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;ì €ì¥ë¨: </span><span class="si">{</span><span class="n">filename</span><span class="si">}</span><span class="s2"> (</span><span class="si">{</span><span class="n">n_points</span><span class="si">}</span><span class="s2"> í¬ì¸íŠ¸)&quot;</span><span class="p">)</span>
</code></pre></div>

<h3 id="_8">í¬ì¸íŠ¸ í´ë¼ìš°ë“œ ì²˜ë¦¬<a class="header-link" href="#_8" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">remove_outliers_statistical</span><span class="p">(</span><span class="n">points</span><span class="p">,</span> <span class="n">colors</span><span class="p">,</span> <span class="n">nb_neighbors</span><span class="o">=</span><span class="mi">20</span><span class="p">,</span> <span class="n">std_ratio</span><span class="o">=</span><span class="mf">2.0</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;í†µê³„ì  ì´ìƒì¹˜ ì œê±°&quot;&quot;&quot;</span>

    <span class="kn">from</span><span class="w"> </span><span class="nn">scipy.spatial</span><span class="w"> </span><span class="kn">import</span> <span class="n">KDTree</span>

    <span class="c1"># KD-Tree êµ¬ì¶•</span>
    <span class="n">tree</span> <span class="o">=</span> <span class="n">KDTree</span><span class="p">(</span><span class="n">points</span><span class="p">)</span>

    <span class="c1"># ê° ì ì˜ k-NN ê±°ë¦¬ ê³„ì‚°</span>
    <span class="n">distances</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">tree</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="n">points</span><span class="p">,</span> <span class="n">k</span><span class="o">=</span><span class="n">nb_neighbors</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>
    <span class="n">mean_distances</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">distances</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">:],</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>  <span class="c1"># ìê¸° ìì‹  ì œì™¸</span>

    <span class="c1"># ì „ì²´ í‰ê· ê³¼ í‘œì¤€í¸ì°¨</span>
    <span class="n">global_mean</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">mean_distances</span><span class="p">)</span>
    <span class="n">global_std</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">std</span><span class="p">(</span><span class="n">mean_distances</span><span class="p">)</span>

    <span class="c1"># ì´ìƒì¹˜ ë§ˆìŠ¤í¬</span>
    <span class="n">threshold</span> <span class="o">=</span> <span class="n">global_mean</span> <span class="o">+</span> <span class="n">std_ratio</span> <span class="o">*</span> <span class="n">global_std</span>
    <span class="n">inlier_mask</span> <span class="o">=</span> <span class="n">mean_distances</span> <span class="o">&lt;</span> <span class="n">threshold</span>

    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;ì´ìƒì¹˜ ì œê±°: </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">points</span><span class="p">)</span><span class="si">}</span><span class="s2"> â†’ </span><span class="si">{</span><span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">inlier_mask</span><span class="p">)</span><span class="si">}</span><span class="s2"> í¬ì¸íŠ¸&quot;</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">points</span><span class="p">[</span><span class="n">inlier_mask</span><span class="p">],</span> <span class="n">colors</span><span class="p">[</span><span class="n">inlier_mask</span><span class="p">]</span>

<span class="k">def</span><span class="w"> </span><span class="nf">estimate_normals</span><span class="p">(</span><span class="n">points</span><span class="p">,</span> <span class="n">k</span><span class="o">=</span><span class="mi">30</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;í¬ì¸íŠ¸ í´ë¼ìš°ë“œ ë²•ì„  ë²¡í„° ì¶”ì •&quot;&quot;&quot;</span>

    <span class="kn">from</span><span class="w"> </span><span class="nn">scipy.spatial</span><span class="w"> </span><span class="kn">import</span> <span class="n">KDTree</span>
    <span class="kn">from</span><span class="w"> </span><span class="nn">numpy.linalg</span><span class="w"> </span><span class="kn">import</span> <span class="n">eig</span>

    <span class="n">tree</span> <span class="o">=</span> <span class="n">KDTree</span><span class="p">(</span><span class="n">points</span><span class="p">)</span>
    <span class="n">normals</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros_like</span><span class="p">(</span><span class="n">points</span><span class="p">)</span>

    <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">point</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">points</span><span class="p">):</span>
        <span class="c1"># k-NN ê²€ìƒ‰</span>
        <span class="n">_</span><span class="p">,</span> <span class="n">indices</span> <span class="o">=</span> <span class="n">tree</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="n">point</span><span class="p">,</span> <span class="n">k</span><span class="o">=</span><span class="n">k</span><span class="p">)</span>
        <span class="n">neighbors</span> <span class="o">=</span> <span class="n">points</span><span class="p">[</span><span class="n">indices</span><span class="p">]</span>

        <span class="c1"># ê³µë¶„ì‚° í–‰ë ¬</span>
        <span class="n">centered</span> <span class="o">=</span> <span class="n">neighbors</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">neighbors</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
        <span class="n">cov</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">centered</span><span class="o">.</span><span class="n">T</span><span class="p">,</span> <span class="n">centered</span><span class="p">)</span> <span class="o">/</span> <span class="n">k</span>

        <span class="c1"># ê°€ì¥ ì‘ì€ ê³ ìœ ê°’ì˜ ê³ ìœ ë²¡í„°ê°€ ë²•ì„ </span>
        <span class="n">eigenvalues</span><span class="p">,</span> <span class="n">eigenvectors</span> <span class="o">=</span> <span class="n">eig</span><span class="p">(</span><span class="n">cov</span><span class="p">)</span>
        <span class="n">min_idx</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">argmin</span><span class="p">(</span><span class="n">eigenvalues</span><span class="p">)</span>
        <span class="n">normals</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">eigenvectors</span><span class="p">[:,</span> <span class="n">min_idx</span><span class="p">]</span>

    <span class="k">return</span> <span class="n">normals</span>
</code></pre></div>

<hr />
<h2 id="5-open3d">5. Open3D ê¸°ì´ˆ<a class="header-link" href="#5-open3d" title="Permanent link">&para;</a></h2>
<h3 id="open3d">Open3D ì„¤ì¹˜ ë° ê¸°ë³¸ ì‚¬ìš©<a class="header-link" href="#open3d" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><span class="c1"># pip install open3d</span>

<span class="kn">import</span><span class="w"> </span><span class="nn">open3d</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">o3d</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">numpy</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">np</span>

<span class="k">def</span><span class="w"> </span><span class="nf">create_open3d_point_cloud</span><span class="p">(</span><span class="n">points</span><span class="p">,</span> <span class="n">colors</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Open3D í¬ì¸íŠ¸ í´ë¼ìš°ë“œ ìƒì„±&quot;&quot;&quot;</span>

    <span class="n">pcd</span> <span class="o">=</span> <span class="n">o3d</span><span class="o">.</span><span class="n">geometry</span><span class="o">.</span><span class="n">PointCloud</span><span class="p">()</span>
    <span class="n">pcd</span><span class="o">.</span><span class="n">points</span> <span class="o">=</span> <span class="n">o3d</span><span class="o">.</span><span class="n">utility</span><span class="o">.</span><span class="n">Vector3dVector</span><span class="p">(</span><span class="n">points</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">colors</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="c1"># ìƒ‰ìƒì„ 0-1 ë²”ìœ„ë¡œ ì •ê·œí™”</span>
        <span class="k">if</span> <span class="n">colors</span><span class="o">.</span><span class="n">max</span><span class="p">()</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
            <span class="n">colors</span> <span class="o">=</span> <span class="n">colors</span> <span class="o">/</span> <span class="mf">255.0</span>
        <span class="n">pcd</span><span class="o">.</span><span class="n">colors</span> <span class="o">=</span> <span class="n">o3d</span><span class="o">.</span><span class="n">utility</span><span class="o">.</span><span class="n">Vector3dVector</span><span class="p">(</span><span class="n">colors</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">pcd</span>

<span class="k">def</span><span class="w"> </span><span class="nf">visualize_point_cloud</span><span class="p">(</span><span class="n">pcd</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;í¬ì¸íŠ¸ í´ë¼ìš°ë“œ ì‹œê°í™”&quot;&quot;&quot;</span>

    <span class="c1"># ì¢Œí‘œì¶• ì¶”ê°€</span>
    <span class="n">coordinate_frame</span> <span class="o">=</span> <span class="n">o3d</span><span class="o">.</span><span class="n">geometry</span><span class="o">.</span><span class="n">TriangleMesh</span><span class="o">.</span><span class="n">create_coordinate_frame</span><span class="p">(</span>
        <span class="n">size</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span> <span class="n">origin</span><span class="o">=</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span>
    <span class="p">)</span>

    <span class="n">o3d</span><span class="o">.</span><span class="n">visualization</span><span class="o">.</span><span class="n">draw_geometries</span><span class="p">(</span>
        <span class="p">[</span><span class="n">pcd</span><span class="p">,</span> <span class="n">coordinate_frame</span><span class="p">],</span>
        <span class="n">window_name</span><span class="o">=</span><span class="s2">&quot;Point Cloud&quot;</span><span class="p">,</span>
        <span class="n">width</span><span class="o">=</span><span class="mi">1280</span><span class="p">,</span>
        <span class="n">height</span><span class="o">=</span><span class="mi">720</span><span class="p">,</span>
        <span class="n">point_show_normal</span><span class="o">=</span><span class="kc">False</span>
    <span class="p">)</span>

<span class="k">def</span><span class="w"> </span><span class="nf">process_point_cloud_open3d</span><span class="p">(</span><span class="n">pcd</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Open3Dë¡œ í¬ì¸íŠ¸ í´ë¼ìš°ë“œ ì²˜ë¦¬&quot;&quot;&quot;</span>

    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;ì›ë³¸ í¬ì¸íŠ¸ ìˆ˜: </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">pcd</span><span class="o">.</span><span class="n">points</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

    <span class="c1"># 1. ë‹¤ìš´ìƒ˜í”Œë§</span>
    <span class="n">pcd_down</span> <span class="o">=</span> <span class="n">pcd</span><span class="o">.</span><span class="n">voxel_down_sample</span><span class="p">(</span><span class="n">voxel_size</span><span class="o">=</span><span class="mf">0.02</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;ë‹¤ìš´ìƒ˜í”Œë§ í›„: </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">pcd_down</span><span class="o">.</span><span class="n">points</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

    <span class="c1"># 2. ì´ìƒì¹˜ ì œê±°</span>
    <span class="n">pcd_clean</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">pcd_down</span><span class="o">.</span><span class="n">remove_statistical_outlier</span><span class="p">(</span>
        <span class="n">nb_neighbors</span><span class="o">=</span><span class="mi">20</span><span class="p">,</span>
        <span class="n">std_ratio</span><span class="o">=</span><span class="mf">2.0</span>
    <span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;ì´ìƒì¹˜ ì œê±° í›„: </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">pcd_clean</span><span class="o">.</span><span class="n">points</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

    <span class="c1"># 3. ë²•ì„  ì¶”ì •</span>
    <span class="n">pcd_clean</span><span class="o">.</span><span class="n">estimate_normals</span><span class="p">(</span>
        <span class="n">search_param</span><span class="o">=</span><span class="n">o3d</span><span class="o">.</span><span class="n">geometry</span><span class="o">.</span><span class="n">KDTreeSearchParamHybrid</span><span class="p">(</span>
            <span class="n">radius</span><span class="o">=</span><span class="mf">0.1</span><span class="p">,</span> <span class="n">max_nn</span><span class="o">=</span><span class="mi">30</span>
        <span class="p">)</span>
    <span class="p">)</span>

    <span class="c1"># 4. ë²•ì„  ë°©í–¥ ì •ë ¬</span>
    <span class="n">pcd_clean</span><span class="o">.</span><span class="n">orient_normals_consistent_tangent_plane</span><span class="p">(</span><span class="n">k</span><span class="o">=</span><span class="mi">15</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">pcd_clean</span>
</code></pre></div>

<h3 id="_9">ë©”ì‰¬ ì¬êµ¬ì„±<a class="header-link" href="#_9" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">reconstruct_mesh_poisson</span><span class="p">(</span><span class="n">pcd</span><span class="p">,</span> <span class="n">depth</span><span class="o">=</span><span class="mi">9</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;í¬ì•„ì†¡ í‘œë©´ ì¬êµ¬ì„±&quot;&quot;&quot;</span>

    <span class="c1"># ë²•ì„ ì´ í•„ìš”í•¨</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">pcd</span><span class="o">.</span><span class="n">has_normals</span><span class="p">():</span>
        <span class="n">pcd</span><span class="o">.</span><span class="n">estimate_normals</span><span class="p">()</span>
        <span class="n">pcd</span><span class="o">.</span><span class="n">orient_normals_consistent_tangent_plane</span><span class="p">(</span><span class="n">k</span><span class="o">=</span><span class="mi">15</span><span class="p">)</span>

    <span class="c1"># í¬ì•„ì†¡ ì¬êµ¬ì„±</span>
    <span class="n">mesh</span><span class="p">,</span> <span class="n">densities</span> <span class="o">=</span> <span class="n">o3d</span><span class="o">.</span><span class="n">geometry</span><span class="o">.</span><span class="n">TriangleMesh</span><span class="o">.</span><span class="n">create_from_point_cloud_poisson</span><span class="p">(</span>
        <span class="n">pcd</span><span class="p">,</span> <span class="n">depth</span><span class="o">=</span><span class="n">depth</span>
    <span class="p">)</span>

    <span class="c1"># ì €ë°€ë„ ì˜ì—­ ì œê±°</span>
    <span class="n">densities</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">densities</span><span class="p">)</span>
    <span class="n">density_threshold</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">quantile</span><span class="p">(</span><span class="n">densities</span><span class="p">,</span> <span class="mf">0.01</span><span class="p">)</span>
    <span class="n">vertices_to_remove</span> <span class="o">=</span> <span class="n">densities</span> <span class="o">&lt;</span> <span class="n">density_threshold</span>
    <span class="n">mesh</span><span class="o">.</span><span class="n">remove_vertices_by_mask</span><span class="p">(</span><span class="n">vertices_to_remove</span><span class="p">)</span>

    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;ë©”ì‰¬ ì •ì  ìˆ˜: </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">mesh</span><span class="o">.</span><span class="n">vertices</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;ë©”ì‰¬ ì‚¼ê°í˜• ìˆ˜: </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">mesh</span><span class="o">.</span><span class="n">triangles</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">mesh</span>

<span class="k">def</span><span class="w"> </span><span class="nf">reconstruct_mesh_ball_pivoting</span><span class="p">(</span><span class="n">pcd</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;ë³¼ í”¼ë²—íŒ… í‘œë©´ ì¬êµ¬ì„±&quot;&quot;&quot;</span>

    <span class="k">if</span> <span class="ow">not</span> <span class="n">pcd</span><span class="o">.</span><span class="n">has_normals</span><span class="p">():</span>
        <span class="n">pcd</span><span class="o">.</span><span class="n">estimate_normals</span><span class="p">()</span>

    <span class="c1"># ë°˜ê²½ ì¶”ì •</span>
    <span class="n">distances</span> <span class="o">=</span> <span class="n">pcd</span><span class="o">.</span><span class="n">compute_nearest_neighbor_distance</span><span class="p">()</span>
    <span class="n">avg_dist</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">distances</span><span class="p">)</span>
    <span class="n">radii</span> <span class="o">=</span> <span class="p">[</span><span class="n">avg_dist</span><span class="p">,</span> <span class="n">avg_dist</span> <span class="o">*</span> <span class="mi">2</span><span class="p">,</span> <span class="n">avg_dist</span> <span class="o">*</span> <span class="mi">4</span><span class="p">]</span>

    <span class="n">mesh</span> <span class="o">=</span> <span class="n">o3d</span><span class="o">.</span><span class="n">geometry</span><span class="o">.</span><span class="n">TriangleMesh</span><span class="o">.</span><span class="n">create_from_point_cloud_ball_pivoting</span><span class="p">(</span>
        <span class="n">pcd</span><span class="p">,</span> <span class="n">o3d</span><span class="o">.</span><span class="n">utility</span><span class="o">.</span><span class="n">DoubleVector</span><span class="p">(</span><span class="n">radii</span><span class="p">)</span>
    <span class="p">)</span>

    <span class="k">return</span> <span class="n">mesh</span>

<span class="k">def</span><span class="w"> </span><span class="nf">save_mesh</span><span class="p">(</span><span class="n">mesh</span><span class="p">,</span> <span class="n">filename</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;ë©”ì‰¬ ì €ì¥&quot;&quot;&quot;</span>
    <span class="n">o3d</span><span class="o">.</span><span class="n">io</span><span class="o">.</span><span class="n">write_triangle_mesh</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="n">mesh</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;ë©”ì‰¬ ì €ì¥ë¨: </span><span class="si">{</span><span class="n">filename</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</code></pre></div>

<h3 id="rgbd">RGBD ì´ë¯¸ì§€ ì²˜ë¦¬<a class="header-link" href="#rgbd" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">create_rgbd_from_opencv</span><span class="p">(</span><span class="n">color_img</span><span class="p">,</span> <span class="n">depth_img</span><span class="p">,</span> <span class="n">K</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;OpenCV ì´ë¯¸ì§€ë¥¼ Open3D RGBDë¡œ ë³€í™˜&quot;&quot;&quot;</span>

    <span class="c1"># BGR â†’ RGB</span>
    <span class="n">color_rgb</span> <span class="o">=</span> <span class="n">cv2</span><span class="o">.</span><span class="n">cvtColor</span><span class="p">(</span><span class="n">color_img</span><span class="p">,</span> <span class="n">cv2</span><span class="o">.</span><span class="n">COLOR_BGR2RGB</span><span class="p">)</span>

    <span class="c1"># Open3D ì´ë¯¸ì§€ë¡œ ë³€í™˜</span>
    <span class="n">color_o3d</span> <span class="o">=</span> <span class="n">o3d</span><span class="o">.</span><span class="n">geometry</span><span class="o">.</span><span class="n">Image</span><span class="p">(</span><span class="n">color_rgb</span><span class="p">)</span>
    <span class="n">depth_o3d</span> <span class="o">=</span> <span class="n">o3d</span><span class="o">.</span><span class="n">geometry</span><span class="o">.</span><span class="n">Image</span><span class="p">(</span><span class="n">depth_img</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">float32</span><span class="p">))</span>

    <span class="c1"># RGBD ì´ë¯¸ì§€ ìƒì„±</span>
    <span class="n">rgbd</span> <span class="o">=</span> <span class="n">o3d</span><span class="o">.</span><span class="n">geometry</span><span class="o">.</span><span class="n">RGBDImage</span><span class="o">.</span><span class="n">create_from_color_and_depth</span><span class="p">(</span>
        <span class="n">color_o3d</span><span class="p">,</span> <span class="n">depth_o3d</span><span class="p">,</span>
        <span class="n">depth_scale</span><span class="o">=</span><span class="mf">1000.0</span><span class="p">,</span>  <span class="c1"># mm â†’ m</span>
        <span class="n">depth_trunc</span><span class="o">=</span><span class="mf">3.0</span><span class="p">,</span>     <span class="c1"># ìµœëŒ€ ê¹Šì´</span>
        <span class="n">convert_rgb_to_intensity</span><span class="o">=</span><span class="kc">False</span>
    <span class="p">)</span>

    <span class="k">return</span> <span class="n">rgbd</span>

<span class="k">def</span><span class="w"> </span><span class="nf">rgbd_to_point_cloud</span><span class="p">(</span><span class="n">rgbd</span><span class="p">,</span> <span class="n">K</span><span class="p">,</span> <span class="n">width</span><span class="p">,</span> <span class="n">height</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;RGBD ì´ë¯¸ì§€ì—ì„œ í¬ì¸íŠ¸ í´ë¼ìš°ë“œ ìƒì„±&quot;&quot;&quot;</span>

    <span class="c1"># Open3D ì¹´ë©”ë¼ íŒŒë¼ë¯¸í„°</span>
    <span class="n">intrinsic</span> <span class="o">=</span> <span class="n">o3d</span><span class="o">.</span><span class="n">camera</span><span class="o">.</span><span class="n">PinholeCameraIntrinsic</span><span class="p">(</span>
        <span class="n">width</span><span class="p">,</span> <span class="n">height</span><span class="p">,</span>
        <span class="n">K</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span> <span class="n">K</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span>  <span class="c1"># fx, fy</span>
        <span class="n">K</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">2</span><span class="p">],</span> <span class="n">K</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">]</span>   <span class="c1"># cx, cy</span>
    <span class="p">)</span>

    <span class="c1"># í¬ì¸íŠ¸ í´ë¼ìš°ë“œ ìƒì„±</span>
    <span class="n">pcd</span> <span class="o">=</span> <span class="n">o3d</span><span class="o">.</span><span class="n">geometry</span><span class="o">.</span><span class="n">PointCloud</span><span class="o">.</span><span class="n">create_from_rgbd_image</span><span class="p">(</span>
        <span class="n">rgbd</span><span class="p">,</span> <span class="n">intrinsic</span>
    <span class="p">)</span>

    <span class="k">return</span> <span class="n">pcd</span>
</code></pre></div>

<hr />
<h2 id="6-3d">6. 3D ì¬êµ¬ì„±<a class="header-link" href="#6-3d" title="Permanent link">&para;</a></h2>
<h3 id="mvs">ë‹¤ì¤‘ ë·° ìŠ¤í…Œë ˆì˜¤ (MVS) ê°œë…<a class="header-link" href="#mvs" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><span class="err">ë‹¤ì¤‘</span><span class="w"> </span><span class="err">ë·°</span><span class="w"> </span><span class="err">ìŠ¤í…Œë ˆì˜¤</span><span class="w"> </span><span class="err">íŒŒì´í”„ë¼ì¸</span><span class="p">:</span>

<span class="err">â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”</span>
<span class="err">â”‚</span><span class="w">                                                                 </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">  </span><span class="mf">1.</span><span class="w"> </span><span class="err">ì´ë¯¸ì§€</span><span class="w"> </span><span class="err">ìˆ˜ì§‘</span><span class="w">                                                 </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">     </span><span class="err">ì—¬ëŸ¬</span><span class="w"> </span><span class="err">ê°ë„ì—ì„œ</span><span class="w"> </span><span class="err">ëŒ€ìƒ</span><span class="w"> </span><span class="err">ì´¬ì˜</span><span class="w">                                     </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">         </span><span class="err">ğŸ“·</span><span class="w"> </span><span class="err">ğŸ“·</span><span class="w"> </span><span class="err">ğŸ“·</span><span class="w"> </span><span class="err">ğŸ“·</span><span class="w"> </span><span class="err">ğŸ“·</span><span class="w">                                          </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">                                                                 </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">  </span><span class="mf">2.</span><span class="w"> </span><span class="err">íŠ¹ì§•ì </span><span class="w"> </span><span class="err">ê²€ì¶œ</span><span class="w"> </span><span class="err">ë°</span><span class="w"> </span><span class="err">ë§¤ì¹­</span><span class="w">                                         </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">     </span><span class="n">SIFT</span><span class="p">,</span><span class="w"> </span><span class="n">ORB</span><span class="w"> </span><span class="err">ë“±ìœ¼ë¡œ</span><span class="w"> </span><span class="err">ì´ë¯¸ì§€</span><span class="w"> </span><span class="err">ê°„</span><span class="w"> </span><span class="err">ëŒ€ì‘ì </span><span class="w"> </span><span class="err">ì°¾ê¸°</span><span class="w">                      </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">         </span><span class="err">â—</span><span class="w"> </span><span class="err">â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€</span><span class="w"> </span><span class="err">â—</span><span class="w">                                         </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">                                                                 </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">  </span><span class="mf">3.</span><span class="w"> </span><span class="n">Structure</span><span class="w"> </span><span class="n">from</span><span class="w"> </span><span class="n">Motion</span><span class="w"> </span><span class="p">(</span><span class="n">SfM</span><span class="p">)</span><span class="w">                                 </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">     </span><span class="err">ì¹´ë©”ë¼</span><span class="w"> </span><span class="err">í¬ì¦ˆ</span><span class="w"> </span><span class="err">ì¶”ì •</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="err">í¬ì†Œ</span><span class="w"> </span><span class="err">í¬ì¸íŠ¸</span><span class="w"> </span><span class="err">í´ë¼ìš°ë“œ</span><span class="w">                     </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">         </span><span class="err">ğŸ“·â”€â”€â”€â”€â”</span><span class="w">    </span><span class="err">â—</span><span class="w">                                            </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">         </span><span class="err">ğŸ“·â”€â”€â”€â”€â”¼â”€â”€â”€â”€â—</span><span class="w"> </span><span class="err">â—</span><span class="w">                                          </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">         </span><span class="err">ğŸ“·â”€â”€â”€â”€â”˜</span><span class="w">    </span><span class="err">â—</span><span class="w">                                            </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">                                                                 </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">  </span><span class="mf">4.</span><span class="w"> </span><span class="err">ì¡°ë°€</span><span class="w"> </span><span class="err">ì¬êµ¬ì„±</span><span class="w"> </span><span class="p">(</span><span class="n">Dense</span><span class="w"> </span><span class="n">Reconstruction</span><span class="p">)</span><span class="w">                          </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">     </span><span class="err">ëª¨ë“ </span><span class="w"> </span><span class="err">í”½ì…€ì—</span><span class="w"> </span><span class="err">ëŒ€í•´</span><span class="w"> </span><span class="err">ê¹Šì´</span><span class="w"> </span><span class="err">ì¶”ì •</span><span class="w">                                  </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">         </span><span class="p">[:::::::::::]</span><span class="w">                                           </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">                                                                 </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">  </span><span class="mf">5.</span><span class="w"> </span><span class="err">ë©”ì‰¬</span><span class="w"> </span><span class="err">ìƒì„±</span><span class="w">                                                   </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">     </span><span class="err">í¬ì¸íŠ¸</span><span class="w"> </span><span class="err">í´ë¼ìš°ë“œ</span><span class="w"> </span><span class="err">â†’</span><span class="w"> </span><span class="err">ì‚¼ê°í˜•</span><span class="w"> </span><span class="err">ë©”ì‰¬</span><span class="w">                               </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">         </span><span class="err">â–²â–²â–²â–²â–²â–²â–²â–²</span><span class="w">                                              </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">                                                                 </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">  </span><span class="mf">6.</span><span class="w"> </span><span class="err">í…ìŠ¤ì²˜</span><span class="w"> </span><span class="err">ë§¤í•‘</span><span class="w">                                                 </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">     </span><span class="err">ì›ë³¸</span><span class="w"> </span><span class="err">ì´ë¯¸ì§€ë¡œ</span><span class="w"> </span><span class="err">ë©”ì‰¬ì—</span><span class="w"> </span><span class="err">í…ìŠ¤ì²˜</span><span class="w"> </span><span class="err">ì ìš©</span><span class="w">                            </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">                                                                 </span><span class="err">â”‚</span>
<span class="err">â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜</span>
</code></pre></div>

<h3 id="essential-matrix">Essential Matrix ê¸°ë°˜ í¬ì¦ˆ ì¶”ì •<a class="header-link" href="#essential-matrix" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><span class="kn">import</span><span class="w"> </span><span class="nn">cv2</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">numpy</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">np</span>

<span class="k">def</span><span class="w"> </span><span class="nf">estimate_pose_from_essential</span><span class="p">(</span><span class="n">pts1</span><span class="p">,</span> <span class="n">pts2</span><span class="p">,</span> <span class="n">K</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Essential Matrixë¡œ ìƒëŒ€ í¬ì¦ˆ ì¶”ì •&quot;&quot;&quot;</span>

    <span class="c1"># Essential Matrix ê³„ì‚°</span>
    <span class="n">E</span><span class="p">,</span> <span class="n">mask</span> <span class="o">=</span> <span class="n">cv2</span><span class="o">.</span><span class="n">findEssentialMat</span><span class="p">(</span>
        <span class="n">pts1</span><span class="p">,</span> <span class="n">pts2</span><span class="p">,</span> <span class="n">K</span><span class="p">,</span>
        <span class="n">method</span><span class="o">=</span><span class="n">cv2</span><span class="o">.</span><span class="n">RANSAC</span><span class="p">,</span>
        <span class="n">prob</span><span class="o">=</span><span class="mf">0.999</span><span class="p">,</span>
        <span class="n">threshold</span><span class="o">=</span><span class="mf">1.0</span>
    <span class="p">)</span>

    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;ì¸ë¼ì´ì–´ ë¹„ìœ¨: </span><span class="si">{</span><span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">mask</span><span class="p">)</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="nb">len</span><span class="p">(</span><span class="n">mask</span><span class="p">)</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="mi">100</span><span class="si">:</span><span class="s2">.1f</span><span class="si">}</span><span class="s2">%&quot;</span><span class="p">)</span>

    <span class="c1"># Essential Matrixì—ì„œ R, t ë³µêµ¬</span>
    <span class="n">_</span><span class="p">,</span> <span class="n">R</span><span class="p">,</span> <span class="n">t</span><span class="p">,</span> <span class="n">mask</span> <span class="o">=</span> <span class="n">cv2</span><span class="o">.</span><span class="n">recoverPose</span><span class="p">(</span><span class="n">E</span><span class="p">,</span> <span class="n">pts1</span><span class="p">,</span> <span class="n">pts2</span><span class="p">,</span> <span class="n">K</span><span class="p">)</span>

    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">íšŒì „ í–‰ë ¬ R:</span><span class="se">\n</span><span class="si">{</span><span class="n">R</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">í‰í–‰ ì´ë™ ë²¡í„° t (ë‹¨ìœ„ ë²¡í„°):</span><span class="se">\n</span><span class="si">{</span><span class="n">t</span><span class="o">.</span><span class="n">ravel</span><span class="p">()</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">R</span><span class="p">,</span> <span class="n">t</span>

<span class="k">def</span><span class="w"> </span><span class="nf">triangulate_points</span><span class="p">(</span><span class="n">pts1</span><span class="p">,</span> <span class="n">pts2</span><span class="p">,</span> <span class="n">K</span><span class="p">,</span> <span class="n">R</span><span class="p">,</span> <span class="n">t</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;ë‘ ë·°ì—ì„œ 3D ì  ì‚¼ê°ì¸¡ëŸ‰&quot;&quot;&quot;</span>

    <span class="c1"># íˆ¬ì˜ í–‰ë ¬ êµ¬ì„±</span>
    <span class="n">P1</span> <span class="o">=</span> <span class="n">K</span> <span class="o">@</span> <span class="n">np</span><span class="o">.</span><span class="n">hstack</span><span class="p">([</span><span class="n">np</span><span class="o">.</span><span class="n">eye</span><span class="p">(</span><span class="mi">3</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="mi">3</span><span class="p">,</span> <span class="mi">1</span><span class="p">))])</span>
    <span class="n">P2</span> <span class="o">=</span> <span class="n">K</span> <span class="o">@</span> <span class="n">np</span><span class="o">.</span><span class="n">hstack</span><span class="p">([</span><span class="n">R</span><span class="p">,</span> <span class="n">t</span><span class="p">])</span>

    <span class="c1"># ì‚¼ê°ì¸¡ëŸ‰</span>
    <span class="n">pts1_h</span> <span class="o">=</span> <span class="n">pts1</span><span class="o">.</span><span class="n">T</span>  <span class="c1"># (2, N)</span>
    <span class="n">pts2_h</span> <span class="o">=</span> <span class="n">pts2</span><span class="o">.</span><span class="n">T</span>

    <span class="n">points_4d</span> <span class="o">=</span> <span class="n">cv2</span><span class="o">.</span><span class="n">triangulatePoints</span><span class="p">(</span><span class="n">P1</span><span class="p">,</span> <span class="n">P2</span><span class="p">,</span> <span class="n">pts1_h</span><span class="p">,</span> <span class="n">pts2_h</span><span class="p">)</span>

    <span class="c1"># ë™ì°¨ ì¢Œí‘œ â†’ 3D ì¢Œí‘œ</span>
    <span class="n">points_3d</span> <span class="o">=</span> <span class="n">points_4d</span><span class="p">[:</span><span class="mi">3</span><span class="p">]</span> <span class="o">/</span> <span class="n">points_4d</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span>

    <span class="k">return</span> <span class="n">points_3d</span><span class="o">.</span><span class="n">T</span>  <span class="c1"># (N, 3)</span>

<span class="k">def</span><span class="w"> </span><span class="nf">incremental_sfm</span><span class="p">(</span><span class="n">images</span><span class="p">,</span> <span class="n">K</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;ì¦ë¶„ì  SfM (ê°„ë‹¨í•œ ë²„ì „)&quot;&quot;&quot;</span>

    <span class="c1"># SIFT ê²€ì¶œê¸°</span>
    <span class="n">sift</span> <span class="o">=</span> <span class="n">cv2</span><span class="o">.</span><span class="n">SIFT_create</span><span class="p">()</span>

    <span class="c1"># ì²« ë‘ ì´ë¯¸ì§€ë¡œ ì´ˆê¸°í™”</span>
    <span class="n">kp1</span><span class="p">,</span> <span class="n">desc1</span> <span class="o">=</span> <span class="n">sift</span><span class="o">.</span><span class="n">detectAndCompute</span><span class="p">(</span><span class="n">images</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="kc">None</span><span class="p">)</span>
    <span class="n">kp2</span><span class="p">,</span> <span class="n">desc2</span> <span class="o">=</span> <span class="n">sift</span><span class="o">.</span><span class="n">detectAndCompute</span><span class="p">(</span><span class="n">images</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="kc">None</span><span class="p">)</span>

    <span class="c1"># ë§¤ì¹­</span>
    <span class="n">bf</span> <span class="o">=</span> <span class="n">cv2</span><span class="o">.</span><span class="n">BFMatcher</span><span class="p">()</span>
    <span class="n">matches</span> <span class="o">=</span> <span class="n">bf</span><span class="o">.</span><span class="n">knnMatch</span><span class="p">(</span><span class="n">desc1</span><span class="p">,</span> <span class="n">desc2</span><span class="p">,</span> <span class="n">k</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>

    <span class="c1"># ë¹„ìœ¨ í…ŒìŠ¤íŠ¸</span>
    <span class="n">good_matches</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">m</span><span class="p">,</span> <span class="n">n</span> <span class="ow">in</span> <span class="n">matches</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">m</span><span class="o">.</span><span class="n">distance</span> <span class="o">&lt;</span> <span class="mf">0.75</span> <span class="o">*</span> <span class="n">n</span><span class="o">.</span><span class="n">distance</span><span class="p">:</span>
            <span class="n">good_matches</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">m</span><span class="p">)</span>

    <span class="n">pts1</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">float32</span><span class="p">([</span><span class="n">kp1</span><span class="p">[</span><span class="n">m</span><span class="o">.</span><span class="n">queryIdx</span><span class="p">]</span><span class="o">.</span><span class="n">pt</span> <span class="k">for</span> <span class="n">m</span> <span class="ow">in</span> <span class="n">good_matches</span><span class="p">])</span>
    <span class="n">pts2</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">float32</span><span class="p">([</span><span class="n">kp2</span><span class="p">[</span><span class="n">m</span><span class="o">.</span><span class="n">trainIdx</span><span class="p">]</span><span class="o">.</span><span class="n">pt</span> <span class="k">for</span> <span class="n">m</span> <span class="ow">in</span> <span class="n">good_matches</span><span class="p">])</span>

    <span class="c1"># ì´ˆê¸° í¬ì¦ˆ ë° 3D ì </span>
    <span class="n">R</span><span class="p">,</span> <span class="n">t</span> <span class="o">=</span> <span class="n">estimate_pose_from_essential</span><span class="p">(</span><span class="n">pts1</span><span class="p">,</span> <span class="n">pts2</span><span class="p">,</span> <span class="n">K</span><span class="p">)</span>
    <span class="n">points_3d</span> <span class="o">=</span> <span class="n">triangulate_points</span><span class="p">(</span><span class="n">pts1</span><span class="p">,</span> <span class="n">pts2</span><span class="p">,</span> <span class="n">K</span><span class="p">,</span> <span class="n">R</span><span class="p">,</span> <span class="n">t</span><span class="p">)</span>

    <span class="c1"># ì¹´ë©”ë¼ í¬ì¦ˆ ì €ì¥</span>
    <span class="n">camera_poses</span> <span class="o">=</span> <span class="p">[</span>
        <span class="p">{</span><span class="s1">&#39;R&#39;</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">eye</span><span class="p">(</span><span class="mi">3</span><span class="p">),</span> <span class="s1">&#39;t&#39;</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="mi">3</span><span class="p">,</span> <span class="mi">1</span><span class="p">))},</span>  <span class="c1"># ì²« ë²ˆì§¸ ì¹´ë©”ë¼</span>
        <span class="p">{</span><span class="s1">&#39;R&#39;</span><span class="p">:</span> <span class="n">R</span><span class="p">,</span> <span class="s1">&#39;t&#39;</span><span class="p">:</span> <span class="n">t</span><span class="p">}</span>                           <span class="c1"># ë‘ ë²ˆì§¸ ì¹´ë©”ë¼</span>
    <span class="p">]</span>

    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;ì´ˆê¸° 3D ì  ìˆ˜: </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">points_3d</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

    <span class="c1"># ì´í›„ ì´ë¯¸ì§€ ì¶”ê°€ (PnPë¡œ í¬ì¦ˆ ì¶”ì •)</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">images</span><span class="p">)):</span>
        <span class="n">kp_new</span><span class="p">,</span> <span class="n">desc_new</span> <span class="o">=</span> <span class="n">sift</span><span class="o">.</span><span class="n">detectAndCompute</span><span class="p">(</span><span class="n">images</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="kc">None</span><span class="p">)</span>

        <span class="c1"># ì´ì „ ì´ë¯¸ì§€ì™€ ë§¤ì¹­</span>
        <span class="n">matches</span> <span class="o">=</span> <span class="n">bf</span><span class="o">.</span><span class="n">knnMatch</span><span class="p">(</span><span class="n">desc2</span><span class="p">,</span> <span class="n">desc_new</span><span class="p">,</span> <span class="n">k</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>

        <span class="n">good_matches</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">m</span><span class="p">,</span> <span class="n">n</span> <span class="ow">in</span> <span class="n">matches</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">m</span><span class="o">.</span><span class="n">distance</span> <span class="o">&lt;</span> <span class="mf">0.75</span> <span class="o">*</span> <span class="n">n</span><span class="o">.</span><span class="n">distance</span><span class="p">:</span>
                <span class="n">good_matches</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">m</span><span class="p">)</span>

        <span class="c1"># 3D-2D ëŒ€ì‘ì </span>
        <span class="n">obj_points</span> <span class="o">=</span> <span class="n">points_3d</span><span class="p">[[</span><span class="n">m</span><span class="o">.</span><span class="n">queryIdx</span> <span class="k">for</span> <span class="n">m</span> <span class="ow">in</span> <span class="n">good_matches</span><span class="p">]]</span>
        <span class="n">img_points</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">float32</span><span class="p">([</span><span class="n">kp_new</span><span class="p">[</span><span class="n">m</span><span class="o">.</span><span class="n">trainIdx</span><span class="p">]</span><span class="o">.</span><span class="n">pt</span> <span class="k">for</span> <span class="n">m</span> <span class="ow">in</span> <span class="n">good_matches</span><span class="p">])</span>

        <span class="c1"># PnPë¡œ í¬ì¦ˆ ì¶”ì •</span>
        <span class="n">success</span><span class="p">,</span> <span class="n">rvec</span><span class="p">,</span> <span class="n">tvec</span><span class="p">,</span> <span class="n">inliers</span> <span class="o">=</span> <span class="n">cv2</span><span class="o">.</span><span class="n">solvePnPRansac</span><span class="p">(</span>
            <span class="n">obj_points</span><span class="p">,</span> <span class="n">img_points</span><span class="p">,</span> <span class="n">K</span><span class="p">,</span> <span class="kc">None</span>
        <span class="p">)</span>

        <span class="k">if</span> <span class="n">success</span><span class="p">:</span>
            <span class="n">R_new</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">cv2</span><span class="o">.</span><span class="n">Rodrigues</span><span class="p">(</span><span class="n">rvec</span><span class="p">)</span>
            <span class="n">camera_poses</span><span class="o">.</span><span class="n">append</span><span class="p">({</span><span class="s1">&#39;R&#39;</span><span class="p">:</span> <span class="n">R_new</span><span class="p">,</span> <span class="s1">&#39;t&#39;</span><span class="p">:</span> <span class="n">tvec</span><span class="p">})</span>
            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;ì´ë¯¸ì§€ </span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s2"> ë“±ë¡ ì™„ë£Œ (ì¸ë¼ì´ì–´: </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">inliers</span><span class="p">)</span><span class="si">}</span><span class="s2">)&quot;</span><span class="p">)</span>

        <span class="c1"># ë‹¤ìŒ ë°˜ë³µì„ ìœ„í•´ ì—…ë°ì´íŠ¸</span>
        <span class="n">desc2</span> <span class="o">=</span> <span class="n">desc_new</span>

    <span class="k">return</span> <span class="n">points_3d</span><span class="p">,</span> <span class="n">camera_poses</span>
</code></pre></div>

<h3 id="bundle-adjustment">ë²ˆë“¤ ì¡°ì • (Bundle Adjustment)<a class="header-link" href="#bundle-adjustment" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code>ë²ˆë“¤ ì¡°ì • (Bundle Adjustment):
ì¹´ë©”ë¼ íŒŒë¼ë¯¸í„°ì™€ 3D ì  ìœ„ì¹˜ë¥¼ ë™ì‹œì— ìµœì í™”

ìµœì†Œí™” ëª©í‘œ:
E = Î£_i Î£_j || x_ij - Ï€(K, R_i, t_i, X_j) ||Â²

ì—¬ê¸°ì„œ:
<span class="k">-</span> x_ij: ì´ë¯¸ì§€ iì—ì„œ ê´€ì¸¡ëœ ì  jì˜ 2D ì¢Œí‘œ
<span class="k">-</span> Ï€(): 3D â†’ 2D íˆ¬ì˜ í•¨ìˆ˜
<span class="k">-</span> K: ì¹´ë©”ë¼ ë‚´ë¶€ íŒŒë¼ë¯¸í„°
<span class="k">-</span> R_i, t_i: ì¹´ë©”ë¼ iì˜ í¬ì¦ˆ
<span class="k">-</span> X_j: 3D ì  jì˜ ì¢Œí‘œ

ìµœì í™” ë„êµ¬:
<span class="k">-</span> Ceres Solver
<span class="k">-</span> g2o
<span class="k">-</span> SciPy (ì‘ì€ ë¬¸ì œìš©)
</code></pre></div>

<hr />
<h2 id="7">7. ì—°ìŠµ ë¬¸ì œ<a class="header-link" href="#7" title="Permanent link">&para;</a></h2>
<h3 id="1">ë¬¸ì œ 1: ìŠ¤í…Œë ˆì˜¤ ê¹Šì´ ì¶”ì •<a class="header-link" href="#1" title="Permanent link">&para;</a></h3>
<p>ìŠ¤í…Œë ˆì˜¤ ì´ë¯¸ì§€ ìŒì—ì„œ ê¹Šì´ ë§µì„ ìƒì„±í•˜ì„¸ìš”.</p>
<p><strong>ìš”êµ¬ì‚¬í•­</strong>:
- StereoBMê³¼ StereoSGBM ë¹„êµ
- ì‹œì°¨ ë§µ ì‹œê°í™”
- ê¹Šì´ ë§µìœ¼ë¡œ ë³€í™˜
- í’ˆì§ˆ ê°œì„  (í•„í„°ë§)</p>
<details>
<summary>íŒíŠ¸</summary>


<div class="highlight"><pre><span></span><code><span class="c1"># íŒŒë¼ë¯¸í„° íŠœë‹ í•„ìš”</span>
<span class="n">stereo</span> <span class="o">=</span> <span class="n">cv2</span><span class="o">.</span><span class="n">StereoSGBM_create</span><span class="p">(</span>
    <span class="n">numDisparities</span><span class="o">=</span><span class="mi">128</span><span class="p">,</span>
    <span class="n">blockSize</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span>
    <span class="n">P1</span><span class="o">=</span><span class="mi">8</span> <span class="o">*</span> <span class="mi">3</span> <span class="o">*</span> <span class="mi">5</span> <span class="o">**</span> <span class="mi">2</span><span class="p">,</span>
    <span class="n">P2</span><span class="o">=</span><span class="mi">32</span> <span class="o">*</span> <span class="mi">3</span> <span class="o">*</span> <span class="mi">5</span> <span class="o">**</span> <span class="mi">2</span>
<span class="p">)</span>

<span class="c1"># WLS í•„í„°ë¡œ ê°œì„ </span>
<span class="n">wls_filter</span> <span class="o">=</span> <span class="n">cv2</span><span class="o">.</span><span class="n">ximgproc</span><span class="o">.</span><span class="n">createDisparityWLSFilter</span><span class="p">(</span><span class="n">stereo</span><span class="p">)</span>
</code></pre></div>



</details>

<h3 id="2_1">ë¬¸ì œ 2: í¬ì¸íŠ¸ í´ë¼ìš°ë“œ í•„í„°ë§<a class="header-link" href="#2_1" title="Permanent link">&para;</a></h3>
<p>ë…¸ì´ì¦ˆê°€ ìˆëŠ” í¬ì¸íŠ¸ í´ë¼ìš°ë“œë¥¼ ì •ì œí•˜ì„¸ìš”.</p>
<p><strong>ìš”êµ¬ì‚¬í•­</strong>:
- í†µê³„ì  ì´ìƒì¹˜ ì œê±°
- ë³µì…€ ë‹¤ìš´ìƒ˜í”Œë§
- í‰ë©´ ì˜ì—­ ì¶”ì¶œ
- ê²°ê³¼ ì‹œê°í™”</p>
<details>
<summary>íŒíŠ¸</summary>


<div class="highlight"><pre><span></span><code><span class="kn">import</span><span class="w"> </span><span class="nn">open3d</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">o3d</span>

<span class="c1"># ì´ìƒì¹˜ ì œê±°</span>
<span class="n">pcd_clean</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">pcd</span><span class="o">.</span><span class="n">remove_statistical_outlier</span><span class="p">(</span>
    <span class="n">nb_neighbors</span><span class="o">=</span><span class="mi">20</span><span class="p">,</span> <span class="n">std_ratio</span><span class="o">=</span><span class="mf">2.0</span>
<span class="p">)</span>

<span class="c1"># ë‹¤ìš´ìƒ˜í”Œë§</span>
<span class="n">pcd_down</span> <span class="o">=</span> <span class="n">pcd_clean</span><span class="o">.</span><span class="n">voxel_down_sample</span><span class="p">(</span><span class="mf">0.02</span><span class="p">)</span>

<span class="c1"># í‰ë©´ ì¶”ì¶œ (RANSAC)</span>
<span class="n">plane_model</span><span class="p">,</span> <span class="n">inliers</span> <span class="o">=</span> <span class="n">pcd_down</span><span class="o">.</span><span class="n">segment_plane</span><span class="p">(</span>
    <span class="n">distance_threshold</span><span class="o">=</span><span class="mf">0.01</span><span class="p">,</span>
    <span class="n">ransac_n</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span>
    <span class="n">num_iterations</span><span class="o">=</span><span class="mi">1000</span>
<span class="p">)</span>
</code></pre></div>



</details>

<h3 id="3-3d">ë¬¸ì œ 3: ë‘ ë·°ì—ì„œ 3D ì¬êµ¬ì„±<a class="header-link" href="#3-3d" title="Permanent link">&para;</a></h3>
<p>ë‘ ì´ë¯¸ì§€ì—ì„œ 3D í¬ì¸íŠ¸ë¥¼ ì¬êµ¬ì„±í•˜ì„¸ìš”.</p>
<p><strong>ìš”êµ¬ì‚¬í•­</strong>:
- íŠ¹ì§•ì  ê²€ì¶œ ë° ë§¤ì¹­
- Essential Matrix ê³„ì‚°
- ì¹´ë©”ë¼ í¬ì¦ˆ ë³µêµ¬
- ì‚¼ê°ì¸¡ëŸ‰ìœ¼ë¡œ 3D ì  ìƒì„±</p>
<details>
<summary>íŒíŠ¸</summary>


<div class="highlight"><pre><span></span><code><span class="c1"># Essential Matrix</span>
<span class="n">E</span><span class="p">,</span> <span class="n">mask</span> <span class="o">=</span> <span class="n">cv2</span><span class="o">.</span><span class="n">findEssentialMat</span><span class="p">(</span><span class="n">pts1</span><span class="p">,</span> <span class="n">pts2</span><span class="p">,</span> <span class="n">K</span><span class="p">)</span>

<span class="c1"># í¬ì¦ˆ ë³µêµ¬</span>
<span class="n">_</span><span class="p">,</span> <span class="n">R</span><span class="p">,</span> <span class="n">t</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">cv2</span><span class="o">.</span><span class="n">recoverPose</span><span class="p">(</span><span class="n">E</span><span class="p">,</span> <span class="n">pts1</span><span class="p">,</span> <span class="n">pts2</span><span class="p">,</span> <span class="n">K</span><span class="p">)</span>

<span class="c1"># ì‚¼ê°ì¸¡ëŸ‰</span>
<span class="n">points_4d</span> <span class="o">=</span> <span class="n">cv2</span><span class="o">.</span><span class="n">triangulatePoints</span><span class="p">(</span><span class="n">P1</span><span class="p">,</span> <span class="n">P2</span><span class="p">,</span> <span class="n">pts1</span><span class="o">.</span><span class="n">T</span><span class="p">,</span> <span class="n">pts2</span><span class="o">.</span><span class="n">T</span><span class="p">)</span>
<span class="n">points_3d</span> <span class="o">=</span> <span class="n">points_4d</span><span class="p">[:</span><span class="mi">3</span><span class="p">]</span> <span class="o">/</span> <span class="n">points_4d</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span>
</code></pre></div>



</details>

<h3 id="4_1">ë¬¸ì œ 4: ë©”ì‰¬ ì¬êµ¬ì„±<a class="header-link" href="#4_1" title="Permanent link">&para;</a></h3>
<p>í¬ì¸íŠ¸ í´ë¼ìš°ë“œì—ì„œ 3D ë©”ì‰¬ë¥¼ ìƒì„±í•˜ì„¸ìš”.</p>
<p><strong>ìš”êµ¬ì‚¬í•­</strong>:
- í¬ì¸íŠ¸ í´ë¼ìš°ë“œ ì „ì²˜ë¦¬
- ë²•ì„  ë²¡í„° ì¶”ì •
- í¬ì•„ì†¡ ë˜ëŠ” ë³¼ í”¼ë²—íŒ… ì¬êµ¬ì„±
- ê²°ê³¼ ì €ì¥ ë° ì‹œê°í™”</p>
<details>
<summary>íŒíŠ¸</summary>


<div class="highlight"><pre><span></span><code><span class="c1"># ë²•ì„  ì¶”ì •</span>
<span class="n">pcd</span><span class="o">.</span><span class="n">estimate_normals</span><span class="p">()</span>
<span class="n">pcd</span><span class="o">.</span><span class="n">orient_normals_consistent_tangent_plane</span><span class="p">(</span><span class="n">k</span><span class="o">=</span><span class="mi">15</span><span class="p">)</span>

<span class="c1"># í¬ì•„ì†¡ ì¬êµ¬ì„±</span>
<span class="n">mesh</span><span class="p">,</span> <span class="n">densities</span> <span class="o">=</span> <span class="n">o3d</span><span class="o">.</span><span class="n">geometry</span><span class="o">.</span><span class="n">TriangleMesh</span><span class="o">.</span><span class="n">create_from_point_cloud_poisson</span><span class="p">(</span>
    <span class="n">pcd</span><span class="p">,</span> <span class="n">depth</span><span class="o">=</span><span class="mi">9</span>
<span class="p">)</span>

<span class="c1"># ì €ë°€ë„ ì˜ì—­ ì œê±°</span>
<span class="n">densities</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">densities</span><span class="p">)</span>
<span class="n">mesh</span><span class="o">.</span><span class="n">remove_vertices_by_mask</span><span class="p">(</span><span class="n">densities</span> <span class="o">&lt;</span> <span class="n">np</span><span class="o">.</span><span class="n">quantile</span><span class="p">(</span><span class="n">densities</span><span class="p">,</span> <span class="mf">0.01</span><span class="p">))</span>
</code></pre></div>



</details>

<h3 id="5">ë¬¸ì œ 5: ì‹¤ì‹œê°„ ìŠ¤í…Œë ˆì˜¤ ë¹„ì „<a class="header-link" href="#5" title="Permanent link">&para;</a></h3>
<p>ì›¹ìº  ë˜ëŠ” ìŠ¤í…Œë ˆì˜¤ ì¹´ë©”ë¼ë¡œ ì‹¤ì‹œê°„ ê¹Šì´ ì¶”ì •ì„ êµ¬í˜„í•˜ì„¸ìš”.</p>
<p><strong>ìš”êµ¬ì‚¬í•­</strong>:
- ì¹´ë©”ë¼ ìº˜ë¦¬ë¸Œë ˆì´ì…˜ ì ìš©
- ì‹¤ì‹œê°„ ì‹œì°¨ ê³„ì‚°
- ê¹Šì´ ì‹œê°í™”
- FPS ì¸¡ì •</p>
<details>
<summary>íŒíŠ¸</summary>


<div class="highlight"><pre><span></span><code><span class="c1"># ë¦¬ë§µí•‘ ë§µ ë¯¸ë¦¬ ê³„ì‚°</span>
<span class="n">map1_left</span><span class="p">,</span> <span class="n">map2_left</span> <span class="o">=</span> <span class="n">cv2</span><span class="o">.</span><span class="n">initUndistortRectifyMap</span><span class="p">(</span><span class="o">...</span><span class="p">)</span>
<span class="n">map1_right</span><span class="p">,</span> <span class="n">map2_right</span> <span class="o">=</span> <span class="n">cv2</span><span class="o">.</span><span class="n">initUndistortRectifyMap</span><span class="p">(</span><span class="o">...</span><span class="p">)</span>

<span class="k">while</span> <span class="kc">True</span><span class="p">:</span>
    <span class="c1"># ì •ë¥˜</span>
    <span class="n">rect_left</span> <span class="o">=</span> <span class="n">cv2</span><span class="o">.</span><span class="n">remap</span><span class="p">(</span><span class="n">left</span><span class="p">,</span> <span class="n">map1_left</span><span class="p">,</span> <span class="n">map2_left</span><span class="p">,</span> <span class="n">cv2</span><span class="o">.</span><span class="n">INTER_LINEAR</span><span class="p">)</span>
    <span class="n">rect_right</span> <span class="o">=</span> <span class="n">cv2</span><span class="o">.</span><span class="n">remap</span><span class="p">(</span><span class="n">right</span><span class="p">,</span> <span class="n">map1_right</span><span class="p">,</span> <span class="n">map2_right</span><span class="p">,</span> <span class="n">cv2</span><span class="o">.</span><span class="n">INTER_LINEAR</span><span class="p">)</span>

    <span class="c1"># ì‹œì°¨ ê³„ì‚° (SGBM)</span>
    <span class="n">disparity</span> <span class="o">=</span> <span class="n">stereo</span><span class="o">.</span><span class="n">compute</span><span class="p">(</span><span class="n">rect_left</span><span class="p">,</span> <span class="n">rect_right</span><span class="p">)</span>
</code></pre></div>



</details>

<hr />
<h2 id="_10">ë‹¤ìŒ ë‹¨ê³„<a class="header-link" href="#_10" title="Permanent link">&para;</a></h2>
<ul>
<li><a href="./22_Depth_Estimation.md">22_Depth_Estimation.md</a> - ë‹¨ì•ˆ ê¹Šì´ ì¶”ì •, MiDaS, DPT, Structure from Motion</li>
</ul>
<hr />
<h2 id="_11">ì°¸ê³  ìë£Œ<a class="header-link" href="#_11" title="Permanent link">&para;</a></h2>
<ul>
<li><a href="https://docs.opencv.org/4.x/dd/d53/tutorial_py_depthmap.html">OpenCV Stereo Vision Tutorial</a></li>
<li><a href="http://www.open3d.org/docs/">Open3D Documentation</a></li>
<li><a href="https://www.robots.ox.ac.uk/~vgg/hzbook/">Multiple View Geometry in Computer Vision</a></li>
<li><a href="https://github.com/colmap/colmap">Structure from Motion Tutorial</a></li>
<li><a href="https://people.cs.rutgers.edu/~elgammal/classes/cs534/lectures/Stereo_2.pdf">Stereo Vision: A Tutorial</a></li>
</ul>
    </div>

    
<div class="lesson-toolbar lesson-toolbar--bottom">
    <div class="toolbar-nav toolbar-nav--prev">
        
        <a href="/study/ko/Computer_Vision/20_Practical_Projects.html" class="nav-prev">
            <span class="nav-label">Previous</span>
            <span class="nav-title">ì‹¤ì „ í”„ë¡œì íŠ¸ (Practical Projects)</span>
        </a>
        
    </div>
    <div class="toolbar-actions">
        <button class="btn btn-copy-link" data-action="copy-link" title="Copy link">
            <span class="icon">ğŸ”—</span>
            <span class="text">Copy link</span>
        </button>
        <a href="/study/ko/Computer_Vision/" class="btn btn-topic-link" title="Back to topic list">
            <span class="icon">ğŸ“‹</span>
            <span class="text">Topic list</span>
        </a>
    </div>
    <div class="toolbar-nav toolbar-nav--next">
        
        <a href="/study/ko/Computer_Vision/22_Depth_Estimation.html" class="nav-next">
            <span class="nav-label">Next</span>
            <span class="nav-title">ë‹¨ì•ˆ ê¹Šì´ ì¶”ì • (Monocular Depth Estimation)</span>
        </a>
        
    </div>
</div>


    <div class="toolbar-keyboard-hint">
        <kbd>&larr;</kbd> <kbd>&rarr;</kbd> to navigate between lessons
    </div>
</article>

<!-- Scroll to top floating button -->
<button class="scroll-to-top" id="scroll-to-top" title="Scroll to top" aria-label="Scroll to top">â†‘</button>

            </div>
        </main>
    </div>

    <script src="/study/static/js/app.js"></script>
    <script>
        function switchLanguage(newLang) {
            const path = window.location.pathname;
            const base = '/study';
            const currentLang = 'ko';
            const newPath = path.replace(base + '/' + currentLang + '/', base + '/' + newLang + '/');
            window.location.href = newPath + window.location.search;
        }
    </script>
    
<script>
    document.addEventListener('DOMContentLoaded', function() {
        // Copy link - independent feedback per button
        document.querySelectorAll('[data-action="copy-link"]').forEach(function(btn) {
            btn.addEventListener('click', function() {
                navigator.clipboard.writeText(window.location.href);
                var textEl = this.querySelector('.text');
                var originalText = textEl.textContent;
                textEl.textContent = 'Copied!';
                setTimeout(function() { textEl.textContent = originalText; }, 2000);
            });
        });

        // Add copy buttons to code blocks
        document.querySelectorAll('.lesson-content pre').forEach(function(pre) {
            var copyBtn = document.createElement('button');
            copyBtn.className = 'code-copy-btn';
            copyBtn.textContent = 'Copy';
            copyBtn.addEventListener('click', function() {
                var code = pre.querySelector('code');
                var text = code ? code.textContent : pre.textContent;
                navigator.clipboard.writeText(text);
                copyBtn.textContent = 'Copied!';
                setTimeout(function() { copyBtn.textContent = 'Copy'; }, 2000);
            });
            pre.style.position = 'relative';
            pre.appendChild(copyBtn);
        });

        // Scroll to top button
        var scrollBtn = document.getElementById('scroll-to-top');
        window.addEventListener('scroll', function() {
            scrollBtn.classList.toggle('visible', window.scrollY > 300);
        });
        scrollBtn.addEventListener('click', function() {
            window.scrollTo({ top: 0, behavior: 'smooth' });
        });

        // Keyboard shortcuts: left/right arrows for lesson navigation
        document.addEventListener('keydown', function(e) {
            var tag = document.activeElement.tagName;
            if (tag === 'INPUT' || tag === 'TEXTAREA' || tag === 'SELECT') return;

            if (e.key === 'ArrowLeft') {
                var prevLink = document.querySelector('.nav-prev');
                if (prevLink) prevLink.click();
            } else if (e.key === 'ArrowRight') {
                var nextLink = document.querySelector('.nav-next');
                if (nextLink) nextLink.click();
            }
        });
    });
</script>

</body>
</html>
{% endraw %}