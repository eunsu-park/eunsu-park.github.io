{% raw %}
<!DOCTYPE html>
<html lang="ko" data-theme="light">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>19. ë² ì´ì§€ì•ˆ ì¶”ë¡  (Bayesian Inference) - Study Materials</title>
    <link rel="stylesheet" href="/study/static/css/style.css">
    <link rel="stylesheet" href="/study/static/css/highlight.css">
    <!-- KaTeX for LaTeX math rendering -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.16.11/dist/katex.min.css">
    <script defer src="https://cdn.jsdelivr.net/npm/katex@0.16.11/dist/katex.min.js"></script>
    <script defer src="https://cdn.jsdelivr.net/npm/katex@0.16.11/dist/contrib/auto-render.min.js"
        onload="renderMathInElement(document.body, {
            delimiters: [
                {left: '$$', right: '$$', display: true},
                {left: '$', right: '$', display: false}
            ],
            throwOnError: false
        });"></script>
    
</head>
<body>
    <div class="app-container">
        <!-- Sidebar -->
        <aside class="sidebar" id="sidebar">
            <div class="sidebar-header">
                <a href="/study/ko/" class="logo">Study Materials</a>
                <button class="sidebar-toggle" id="sidebar-toggle" aria-label="Toggle sidebar">
                    <span></span>
                </button>
            </div>

            <nav class="sidebar-nav">
                <a href="/study/ko/" class="nav-item ">
                    <span class="nav-icon">ğŸ </span>
                    <span class="nav-text">Home</span>
                </a>
                <a href="/study/examples/" class="nav-item ">
                    <span class="nav-icon">ğŸ’»</span>
                    <span class="nav-text">Examples</span>
                </a>
            </nav>

            <div class="sidebar-search">
                <form action="/study/ko/search.html" method="get" id="search-form">
                    <input type="search" name="q" placeholder="Search..." id="search-sidebar-input">
                </form>
            </div>

            <!-- Language Selector -->
            <div class="sidebar-lang">
                <select id="lang-select" class="lang-selector" onchange="switchLanguage(this.value)">
                    
                    <option value="en" >
                        English
                    </option>
                    
                    <option value="ko" selected>
                        í•œêµ­ì–´
                    </option>
                    
                </select>
            </div>

            <div class="sidebar-footer">
                <button class="theme-toggle" id="theme-toggle" aria-label="Toggle theme">
                    <span class="theme-icon light">â˜€ï¸</span>
                    <span class="theme-icon dark">ğŸŒ™</span>
                </button>
            </div>
        </aside>

        <!-- Main Content -->
        <main class="main-content">
            <header class="main-header">
                <button class="menu-toggle" id="menu-toggle" aria-label="Open menu">
                    <span></span>
                </button>
                
<nav class="breadcrumb">
    <a href="/study/ko/">Topics</a>
    <span class="separator">/</span>
    <a href="/study/ko/Data_Science/">Data Science</a>
    <span class="separator">/</span>
    <span class="current">19. ë² ì´ì§€ì•ˆ ì¶”ë¡  (Bayesian Inference)</span>
</nav>

            </header>

            <div class="content">
                
<article class="lesson-article">
    <header class="lesson-header">
        <h1>19. ë² ì´ì§€ì•ˆ ì¶”ë¡  (Bayesian Inference)</h1>
    </header>

    
<div class="lesson-toolbar lesson-toolbar--top">
    <div class="toolbar-nav toolbar-nav--prev">
        
        <a href="/study/ko/Data_Science/18_Bayesian_Statistics_Basics.html" class="nav-prev">
            <span class="nav-label">Previous</span>
            <span class="nav-title">18. ë² ì´ì§€ì•ˆ í†µê³„ ê¸°ì´ˆ (Introduction to Bayesian Statistics)</span>
        </a>
        
    </div>
    <div class="toolbar-actions">
        <button class="btn btn-copy-link" data-action="copy-link" title="Copy link">
            <span class="icon">ğŸ”—</span>
            <span class="text">Copy link</span>
        </button>
        <a href="/study/ko/Data_Science/" class="btn btn-topic-link" title="Back to topic list">
            <span class="icon">ğŸ“‹</span>
            <span class="text">Topic list</span>
        </a>
    </div>
    <div class="toolbar-nav toolbar-nav--next">
        
        <a href="/study/ko/Data_Science/20_Time_Series_Basics.html" class="nav-next">
            <span class="nav-label">Next</span>
            <span class="nav-title">20. ì‹œê³„ì—´ ë¶„ì„ ê¸°ì´ˆ (Time Series Analysis Fundamentals)</span>
        </a>
        
    </div>
</div>


    
    <nav class="toc" id="toc">
        <h2>Table of Contents</h2>
        <div class="toc">
<ul>
<li><a href="#_1">ê°œìš”</a></li>
<li><a href="#1-mcmc">1. MCMC ì†Œê°œ</a><ul>
<li><a href="#11-mcmc">1.1 ì™œ MCMCê°€ í•„ìš”í•œê°€?</a></li>
<li><a href="#12">1.2 ë§ˆë¥´ì½”í”„ ì²´ì¸ ê¸°ì´ˆ</a></li>
</ul>
</li>
<li><a href="#2-metropolis-hastings">2. Metropolis-Hastings ì•Œê³ ë¦¬ì¦˜</a><ul>
<li><a href="#21">2.1 ì•Œê³ ë¦¬ì¦˜ ê°œìš”</a></li>
<li><a href="#22">2.2 êµ¬í˜„</a></li>
<li><a href="#23">2.3 ë‹¤ë³€ëŸ‰ í™•ì¥</a></li>
</ul>
</li>
<li><a href="#3-pymc">3. PyMC ì†Œê°œ</a><ul>
<li><a href="#31">3.1 ì„¤ì¹˜ ë° ê¸°ë³¸ ì„¤ì •</a></li>
<li><a href="#32-pymc">3.2 ì²« ë²ˆì§¸ PyMC ëª¨ë¸: ë™ì „ ë˜ì§€ê¸°</a></li>
<li><a href="#33">3.3 ì •ê·œë¶„í¬ ëª¨ìˆ˜ ì¶”ì •</a></li>
</ul>
</li>
<li><a href="#4">4. ë² ì´ì§€ì•ˆ ì„ í˜• íšŒê·€</a><ul>
<li><a href="#41">4.1 ëª¨ë¸ ì •ì˜</a></li>
<li><a href="#42-pymc">4.2 PyMC êµ¬í˜„</a></li>
<li><a href="#43">4.3 ì‚¬í›„ ì˜ˆì¸¡</a></li>
</ul>
</li>
<li><a href="#5">5. ëª¨ë¸ ë¹„êµ</a><ul>
<li><a href="#51-waic-widely-applicable-information-criterion">5.1 WAIC (Widely Applicable Information Criterion)</a></li>
<li><a href="#52-loo-cv-leave-one-out-cross-validation">5.2 LOO-CV (Leave-One-Out Cross-Validation)</a></li>
<li><a href="#53">5.3 ë² ì´ì¦ˆ íŒ©í„° (ê°œë…)</a></li>
</ul>
</li>
<li><a href="#6-posterior-predictive-checks">6. ì‚¬í›„ ì˜ˆì¸¡ ê²€ì‚¬ (Posterior Predictive Checks)</a><ul>
<li><a href="#61">6.1 ê°œë…</a></li>
<li><a href="#62">6.2 êµ¬í˜„</a></li>
<li><a href="#63-arviz-ppc">6.3 ArviZë¥¼ ì‚¬ìš©í•œ PPC</a></li>
</ul>
</li>
<li><a href="#7">7. ìˆ˜ë ´ ì§„ë‹¨</a><ul>
<li><a href="#71-r-hat-gelman-rubin">7.1 R-hat (Gelman-Rubin í†µê³„ëŸ‰)</a></li>
<li><a href="#72">7.2 ìê¸°ìƒê´€ ë¶„ì„</a></li>
<li><a href="#73-ess">7.3 ìœ íš¨ í‘œë³¸ í¬ê¸° (ESS)</a></li>
</ul>
</li>
<li><a href="#8">8. ì‹¤ìŠµ ì˜ˆì œ</a><ul>
<li><a href="#81-hierarchical-model">8.1 ê³„ì¸µì  ëª¨ë¸ (Hierarchical Model)</a></li>
</ul>
</li>
<li><a href="#9">9. ì—°ìŠµ ë¬¸ì œ</a><ul>
<li><a href="#1-mh">ë¬¸ì œ 1: MH ì•Œê³ ë¦¬ì¦˜ êµ¬í˜„</a></li>
<li><a href="#2-pymc">ë¬¸ì œ 2: PyMC ëª¨ë¸ë§</a></li>
<li><a href="#3">ë¬¸ì œ 3: ëª¨ë¸ ë¹„êµ</a></li>
<li><a href="#4_1">ë¬¸ì œ 4: ìˆ˜ë ´ ì§„ë‹¨</a></li>
</ul>
</li>
<li><a href="#10">10. í•µì‹¬ ìš”ì•½</a><ul>
<li><a href="#mcmc">MCMC í•µì‹¬</a></li>
<li><a href="#pymc">PyMC ì›Œí¬í”Œë¡œìš°</a></li>
<li><a href="#_2">ìˆ˜ë ´ ì§„ë‹¨ ì²´í¬ë¦¬ìŠ¤íŠ¸</a></li>
<li><a href="#_3">ë‹¤ìŒ ì¥ ë¯¸ë¦¬ë³´ê¸°</a></li>
</ul>
</li>
</ul>
</div>

    </nav>
    

    <div class="lesson-content markdown-body">
        <h1 id="19-bayesian-inference">19. ë² ì´ì§€ì•ˆ ì¶”ë¡  (Bayesian Inference)<a class="header-link" href="#19-bayesian-inference" title="Permanent link">&para;</a></h1>
<p><a href="./18_Bayesian_Statistics_Basics.md">ì´ì „: ë² ì´ì§€ì•ˆ í†µê³„ ê¸°ì´ˆ</a> | <a href="./20_Time_Series_Basics.md">ë‹¤ìŒ: ì‹œê³„ì—´ ë¶„ì„ ê¸°ì´ˆ</a></p>
<h2 id="_1">ê°œìš”<a class="header-link" href="#_1" title="Permanent link">&para;</a></h2>
<p>ì¼¤ë ˆ ì‚¬ì „ë¶„í¬ê°€ ì ìš©ë˜ì§€ ì•ŠëŠ” ë³µì¡í•œ ëª¨ë¸ì—ì„œëŠ” ì‚¬í›„ë¶„í¬ë¥¼ í•´ì„ì ìœ¼ë¡œ êµ¬í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤. ì´ ì¥ì—ì„œëŠ” MCMC(Markov Chain Monte Carlo) ë°©ë²•ê³¼ PyMC ë¼ì´ë¸ŒëŸ¬ë¦¬ë¥¼ ì‚¬ìš©í•œ ë² ì´ì§€ì•ˆ ì¶”ë¡ ì„ í•™ìŠµí•©ë‹ˆë‹¤.</p>
<hr />
<h2 id="1-mcmc">1. MCMC ì†Œê°œ<a class="header-link" href="#1-mcmc" title="Permanent link">&para;</a></h2>
<h3 id="11-mcmc">1.1 ì™œ MCMCê°€ í•„ìš”í•œê°€?<a class="header-link" href="#11-mcmc" title="Permanent link">&para;</a></h3>
<p><strong>ë¬¸ì œ</strong>: ë³µì¡í•œ ì‚¬í›„ë¶„í¬ì˜ ì •ê·œí™” ìƒìˆ˜ë¥¼ ê³„ì‚°í•˜ê¸° ì–´ë ¤ì›€</p>
<p>$$P(\theta|D) = \frac{P(D|\theta)P(\theta)}{\int P(D|\theta)P(\theta)d\theta}$$</p>
<p>ë¶„ëª¨ì˜ ì ë¶„ì´ ê³ ì°¨ì›ì—ì„œ ê³„ì‚° ë¶ˆê°€ëŠ¥í•  ìˆ˜ ìˆìŒ.</p>
<p><strong>í•´ê²°</strong>: ì‚¬í›„ë¶„í¬ì—ì„œ ì§ì ‘ ìƒ˜í”Œë§í•˜ì—¬ ë¶„í¬ë¥¼ ê·¼ì‚¬</p>
<div class="highlight"><pre><span></span><code><span class="kn">import</span><span class="w"> </span><span class="nn">numpy</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">np</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">scipy.stats</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">stats</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">matplotlib.pyplot</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">plt</span>

<span class="c1"># MCMCì˜ í•µì‹¬ ì•„ì´ë””ì–´ ì‹œê°í™”</span>
<span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">seed</span><span class="p">(</span><span class="mi">42</span><span class="p">)</span>

<span class="c1"># ëª©í‘œ ë¶„í¬: í˜¼í•© ì •ê·œë¶„í¬ (ì •ê·œí™” ìƒìˆ˜ ì—†ì´ë„ ë¹„ìœ¨ë§Œ ì•Œë©´ ë¨)</span>
<span class="k">def</span><span class="w"> </span><span class="nf">target_unnormalized</span><span class="p">(</span><span class="n">x</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;ë¹„ì •ê·œí™” ëª©í‘œ ë¶„í¬&quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="mf">0.3</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="mf">0.5</span> <span class="o">*</span> <span class="p">((</span><span class="n">x</span> <span class="o">-</span> <span class="mi">2</span><span class="p">)</span> <span class="o">/</span> <span class="mf">0.5</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span> <span class="o">+</span> \
           <span class="mf">0.7</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="mf">0.5</span> <span class="o">*</span> <span class="p">((</span><span class="n">x</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="o">/</span> <span class="mi">1</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>

<span class="n">x_range</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="o">-</span><span class="mi">5</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">200</span><span class="p">)</span>
<span class="n">y</span> <span class="o">=</span> <span class="n">target_unnormalized</span><span class="p">(</span><span class="n">x_range</span><span class="p">)</span>

<span class="n">fig</span><span class="p">,</span> <span class="n">axes</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">14</span><span class="p">,</span> <span class="mi">5</span><span class="p">))</span>

<span class="c1"># ë¹„ì •ê·œí™” ëª©í‘œ ë¶„í¬</span>
<span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x_range</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="s1">&#39;b-&#39;</span><span class="p">,</span> <span class="n">lw</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Unnormalized target&#39;</span><span class="p">)</span>
<span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">fill_between</span><span class="p">(</span><span class="n">x_range</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.3</span><span class="p">)</span>
<span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;x&#39;</span><span class="p">)</span>
<span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;Unnormalized density&#39;</span><span class="p">)</span>
<span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;ë¹„ì •ê·œí™” ëª©í‘œ ë¶„í¬&#39;</span><span class="p">)</span>
<span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
<span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="kc">True</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.3</span><span class="p">)</span>

<span class="c1"># MCMC ìƒ˜í”Œì˜ íˆìŠ¤í† ê·¸ë¨ (ë‚˜ì¤‘ì— ì±„ìš¸ ì˜ˆì •)</span>
<span class="n">axes</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="mf">0.5</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">,</span> <span class="s1">&#39;MCMC ìƒ˜í”Œ</span><span class="se">\n</span><span class="s1">(ë‹¤ìŒ ì„¹ì…˜ì—ì„œ ì±„ì›€)&#39;</span><span class="p">,</span>
             <span class="n">transform</span><span class="o">=</span><span class="n">axes</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">transAxes</span><span class="p">,</span> <span class="n">ha</span><span class="o">=</span><span class="s1">&#39;center&#39;</span><span class="p">,</span> <span class="n">va</span><span class="o">=</span><span class="s1">&#39;center&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">14</span><span class="p">)</span>
<span class="n">axes</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;x&#39;</span><span class="p">)</span>
<span class="n">axes</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;ë°€ë„&#39;</span><span class="p">)</span>
<span class="n">axes</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;MCMC ìƒ˜í”Œ íˆìŠ¤í† ê·¸ë¨&#39;</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</code></pre></div>

<h3 id="12">1.2 ë§ˆë¥´ì½”í”„ ì²´ì¸ ê¸°ì´ˆ<a class="header-link" href="#12" title="Permanent link">&para;</a></h3>
<p><strong>ì •ì˜</strong>: ë‹¤ìŒ ìƒíƒœê°€ í˜„ì¬ ìƒíƒœì—ë§Œ ì˜ì¡´í•˜ëŠ” í™•ë¥ ì  ê³¼ì •</p>
<p>$$P(X_{t+1}|X_1, X_2, ..., X_t) = P(X_{t+1}|X_t)$$</p>
<div class="highlight"><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">simple_markov_chain_demo</span><span class="p">():</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;ê°„ë‹¨í•œ ë§ˆë¥´ì½”í”„ ì²´ì¸ ì‹œë®¬ë ˆì´ì…˜&quot;&quot;&quot;</span>

    <span class="c1"># ë‚ ì”¨ ì „ì´ í™•ë¥ : ë§‘ìŒ(0), íë¦¼(1), ë¹„(2)</span>
    <span class="n">transition_matrix</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span>
        <span class="p">[</span><span class="mf">0.7</span><span class="p">,</span> <span class="mf">0.2</span><span class="p">,</span> <span class="mf">0.1</span><span class="p">],</span>  <span class="c1"># ë§‘ìŒ â†’ ë§‘ìŒ/íë¦¼/ë¹„</span>
        <span class="p">[</span><span class="mf">0.3</span><span class="p">,</span> <span class="mf">0.4</span><span class="p">,</span> <span class="mf">0.3</span><span class="p">],</span>  <span class="c1"># íë¦¼ â†’ ë§‘ìŒ/íë¦¼/ë¹„</span>
        <span class="p">[</span><span class="mf">0.2</span><span class="p">,</span> <span class="mf">0.3</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">],</span>  <span class="c1"># ë¹„ â†’ ë§‘ìŒ/íë¦¼/ë¹„</span>
    <span class="p">])</span>

    <span class="n">states</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;ë§‘ìŒ&#39;</span><span class="p">,</span> <span class="s1">&#39;íë¦¼&#39;</span><span class="p">,</span> <span class="s1">&#39;ë¹„&#39;</span><span class="p">]</span>

    <span class="c1"># ì‹œë®¬ë ˆì´ì…˜</span>
    <span class="n">n_steps</span> <span class="o">=</span> <span class="mi">1000</span>
    <span class="n">current_state</span> <span class="o">=</span> <span class="mi">0</span>  <span class="c1"># ë§‘ìŒì—ì„œ ì‹œì‘</span>
    <span class="n">chain</span> <span class="o">=</span> <span class="p">[</span><span class="n">current_state</span><span class="p">]</span>

    <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n_steps</span><span class="p">):</span>
        <span class="n">probs</span> <span class="o">=</span> <span class="n">transition_matrix</span><span class="p">[</span><span class="n">current_state</span><span class="p">]</span>
        <span class="n">current_state</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">choice</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">],</span> <span class="n">p</span><span class="o">=</span><span class="n">probs</span><span class="p">)</span>
        <span class="n">chain</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">current_state</span><span class="p">)</span>

    <span class="c1"># ì •ìƒ ë¶„í¬ ì¶”ì •</span>
    <span class="n">unique</span><span class="p">,</span> <span class="n">counts</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">unique</span><span class="p">(</span><span class="n">chain</span><span class="p">,</span> <span class="n">return_counts</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">empirical_dist</span> <span class="o">=</span> <span class="n">counts</span> <span class="o">/</span> <span class="nb">len</span><span class="p">(</span><span class="n">chain</span><span class="p">)</span>

    <span class="c1"># ì´ë¡ ì  ì •ìƒ ë¶„í¬ (ì „ì´í–‰ë ¬ì˜ ì™¼ìª½ ê³ ìœ ë²¡í„°)</span>
    <span class="n">eigenvalues</span><span class="p">,</span> <span class="n">eigenvectors</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">eig</span><span class="p">(</span><span class="n">transition_matrix</span><span class="o">.</span><span class="n">T</span><span class="p">)</span>
    <span class="n">stationary_idx</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">argmin</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">eigenvalues</span> <span class="o">-</span> <span class="mi">1</span><span class="p">))</span>
    <span class="n">stationary_dist</span> <span class="o">=</span> <span class="n">eigenvectors</span><span class="p">[:,</span> <span class="n">stationary_idx</span><span class="p">]</span><span class="o">.</span><span class="n">real</span>
    <span class="n">stationary_dist</span> <span class="o">=</span> <span class="n">stationary_dist</span> <span class="o">/</span> <span class="n">stationary_dist</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span>

    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;=== ë§ˆë¥´ì½”í”„ ì²´ì¸ ë‚ ì”¨ ì‹œë®¬ë ˆì´ì…˜ ===&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;ì‹œë®¬ë ˆì´ì…˜ ë‹¨ê³„: </span><span class="si">{</span><span class="n">n_steps</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">ìƒíƒœë³„ ë¹ˆë„:&quot;</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">state</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">states</span><span class="p">):</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  </span><span class="si">{</span><span class="n">state</span><span class="si">}</span><span class="s2">: ê²½í—˜ì =</span><span class="si">{</span><span class="n">empirical_dist</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="si">:</span><span class="s2">.3f</span><span class="si">}</span><span class="s2">, ì´ë¡ ì =</span><span class="si">{</span><span class="n">stationary_dist</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="si">:</span><span class="s2">.3f</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">chain</span>

<span class="n">chain</span> <span class="o">=</span> <span class="n">simple_markov_chain_demo</span><span class="p">()</span>
</code></pre></div>

<hr />
<h2 id="2-metropolis-hastings">2. Metropolis-Hastings ì•Œê³ ë¦¬ì¦˜<a class="header-link" href="#2-metropolis-hastings" title="Permanent link">&para;</a></h2>
<h3 id="21">2.1 ì•Œê³ ë¦¬ì¦˜ ê°œìš”<a class="header-link" href="#21" title="Permanent link">&para;</a></h3>
<p><strong>ëª©í‘œ</strong>: ëª©í‘œ ë¶„í¬ Ï€(x)ì—ì„œ ìƒ˜í”Œ ì¶”ì¶œ</p>
<p><strong>ì•Œê³ ë¦¬ì¦˜</strong>:
1. ì´ˆê¸°ê°’ xâ‚€ ì„ íƒ
2. ì œì•ˆ ë¶„í¬ q(x'|x)ì—ì„œ í›„ë³´ x' ìƒì„±
3. ìˆ˜ë½ í™•ë¥  ê³„ì‚°: Î± = min(1, [Ï€(x')q(x|x')] / [Ï€(x)q(x'|x)])
4. U ~ Uniform(0,1)ì´ë©´:
   - U &lt; Î±: x' ìˆ˜ë½ (x_{t+1} = x')
   - ê·¸ë ‡ì§€ ì•Šìœ¼ë©´: x ìœ ì§€ (x_{t+1} = x)
5. 2-4 ë°˜ë³µ</p>
<h3 id="22">2.2 êµ¬í˜„<a class="header-link" href="#22" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">metropolis_hastings</span><span class="p">(</span><span class="n">target</span><span class="p">,</span> <span class="n">proposal_std</span><span class="p">,</span> <span class="n">n_samples</span><span class="p">,</span> <span class="n">initial_value</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">burn_in</span><span class="o">=</span><span class="mi">1000</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Metropolis-Hastings ì•Œê³ ë¦¬ì¦˜</span>

<span class="sd">    Parameters:</span>
<span class="sd">    -----------</span>
<span class="sd">    target : callable</span>
<span class="sd">        ë¹„ì •ê·œí™” ëª©í‘œ ë°€ë„ í•¨ìˆ˜</span>
<span class="sd">    proposal_std : float</span>
<span class="sd">        ì œì•ˆ ë¶„í¬(ì •ê·œë¶„í¬)ì˜ í‘œì¤€í¸ì°¨</span>
<span class="sd">    n_samples : int</span>
<span class="sd">        ìƒì„±í•  ìƒ˜í”Œ ìˆ˜</span>
<span class="sd">    initial_value : float</span>
<span class="sd">        ì´ˆê¸°ê°’</span>
<span class="sd">    burn_in : int</span>
<span class="sd">        burn-in ê¸°ê°„ (ë²„ë¦´ ì´ˆê¸° ìƒ˜í”Œ ìˆ˜)</span>

<span class="sd">    Returns:</span>
<span class="sd">    --------</span>
<span class="sd">    samples : ndarray</span>
<span class="sd">        MCMC ìƒ˜í”Œ</span>
<span class="sd">    acceptance_rate : float</span>
<span class="sd">        ìˆ˜ë½ë¥ </span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">samples</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">n_samples</span> <span class="o">+</span> <span class="n">burn_in</span><span class="p">)</span>
    <span class="n">samples</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">initial_value</span>
    <span class="n">n_accepted</span> <span class="o">=</span> <span class="mi">0</span>

    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">n_samples</span> <span class="o">+</span> <span class="n">burn_in</span><span class="p">):</span>
        <span class="n">current</span> <span class="o">=</span> <span class="n">samples</span><span class="p">[</span><span class="n">i</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>

        <span class="c1"># ì œì•ˆ (ëŒ€ì¹­ ì •ê·œë¶„í¬)</span>
        <span class="n">proposal</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">normal</span><span class="p">(</span><span class="n">current</span><span class="p">,</span> <span class="n">proposal_std</span><span class="p">)</span>

        <span class="c1"># ìˆ˜ë½ í™•ë¥  (ëŒ€ì¹­ ì œì•ˆë¶„í¬ì´ë¯€ë¡œ q ì·¨ì†Œë¨)</span>
        <span class="n">acceptance_ratio</span> <span class="o">=</span> <span class="n">target</span><span class="p">(</span><span class="n">proposal</span><span class="p">)</span> <span class="o">/</span> <span class="n">target</span><span class="p">(</span><span class="n">current</span><span class="p">)</span>
        <span class="n">acceptance_prob</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">acceptance_ratio</span><span class="p">)</span>

        <span class="c1"># ìˆ˜ë½/ê±°ë¶€</span>
        <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">uniform</span><span class="p">()</span> <span class="o">&lt;</span> <span class="n">acceptance_prob</span><span class="p">:</span>
            <span class="n">samples</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">proposal</span>
            <span class="n">n_accepted</span> <span class="o">+=</span> <span class="mi">1</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">samples</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">current</span>

    <span class="c1"># burn-in ì œê±°</span>
    <span class="n">samples</span> <span class="o">=</span> <span class="n">samples</span><span class="p">[</span><span class="n">burn_in</span><span class="p">:]</span>
    <span class="n">acceptance_rate</span> <span class="o">=</span> <span class="n">n_accepted</span> <span class="o">/</span> <span class="p">(</span><span class="n">n_samples</span> <span class="o">+</span> <span class="n">burn_in</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">samples</span><span class="p">,</span> <span class="n">acceptance_rate</span>


<span class="c1"># ì˜ˆì œ: í˜¼í•© ì •ê·œë¶„í¬ì—ì„œ ìƒ˜í”Œë§</span>
<span class="k">def</span><span class="w"> </span><span class="nf">mixture_target</span><span class="p">(</span><span class="n">x</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;í˜¼í•© ì •ê·œë¶„í¬ (ë¹„ì •ê·œí™”)&quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="mf">0.3</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="mf">0.5</span> <span class="o">*</span> <span class="p">((</span><span class="n">x</span> <span class="o">-</span> <span class="mi">2</span><span class="p">)</span> <span class="o">/</span> <span class="mf">0.5</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span> <span class="o">+</span> \
           <span class="mf">0.7</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="mf">0.5</span> <span class="o">*</span> <span class="p">((</span><span class="n">x</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="o">/</span> <span class="mi">1</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>

<span class="c1"># ë‹¤ì–‘í•œ ì œì•ˆ ë¶„í¬ë¡œ ì‹¤í—˜</span>
<span class="n">proposal_stds</span> <span class="o">=</span> <span class="p">[</span><span class="mf">0.1</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">,</span> <span class="mf">5.0</span><span class="p">]</span>
<span class="n">fig</span><span class="p">,</span> <span class="n">axes</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">15</span><span class="p">,</span> <span class="mi">8</span><span class="p">))</span>

<span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">seed</span><span class="p">(</span><span class="mi">42</span><span class="p">)</span>

<span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">proposal_std</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">proposal_stds</span><span class="p">):</span>
    <span class="n">samples</span><span class="p">,</span> <span class="n">acc_rate</span> <span class="o">=</span> <span class="n">metropolis_hastings</span><span class="p">(</span>
        <span class="n">mixture_target</span><span class="p">,</span>
        <span class="n">proposal_std</span><span class="o">=</span><span class="n">proposal_std</span><span class="p">,</span>
        <span class="n">n_samples</span><span class="o">=</span><span class="mi">10000</span><span class="p">,</span>
        <span class="n">burn_in</span><span class="o">=</span><span class="mi">1000</span>
    <span class="p">)</span>

    <span class="c1"># íŠ¸ë ˆì´ìŠ¤ í”Œë¡¯</span>
    <span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">samples</span><span class="p">[:</span><span class="mi">500</span><span class="p">],</span> <span class="s1">&#39;b-&#39;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.7</span><span class="p">,</span> <span class="n">lw</span><span class="o">=</span><span class="mf">0.5</span><span class="p">)</span>
    <span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;Iteration&#39;</span><span class="p">)</span>
    <span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;Value&#39;</span><span class="p">)</span>
    <span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Trace (Ïƒ=</span><span class="si">{</span><span class="n">proposal_std</span><span class="si">}</span><span class="s1">, acc=</span><span class="si">{</span><span class="n">acc_rate</span><span class="si">:</span><span class="s1">.2%</span><span class="si">}</span><span class="s1">)&#39;</span><span class="p">)</span>
    <span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="kc">True</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.3</span><span class="p">)</span>

    <span class="c1"># íˆìŠ¤í† ê·¸ë¨</span>
    <span class="n">x_range</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="o">-</span><span class="mi">5</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">200</span><span class="p">)</span>
    <span class="n">true_density</span> <span class="o">=</span> <span class="n">mixture_target</span><span class="p">(</span><span class="n">x_range</span><span class="p">)</span>
    <span class="n">true_density</span> <span class="o">=</span> <span class="n">true_density</span> <span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">trapz</span><span class="p">(</span><span class="n">true_density</span><span class="p">,</span> <span class="n">x_range</span><span class="p">)</span>

    <span class="n">axes</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">hist</span><span class="p">(</span><span class="n">samples</span><span class="p">,</span> <span class="n">bins</span><span class="o">=</span><span class="mi">50</span><span class="p">,</span> <span class="n">density</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.7</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;MCMC samples&#39;</span><span class="p">)</span>
    <span class="n">axes</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x_range</span><span class="p">,</span> <span class="n">true_density</span><span class="p">,</span> <span class="s1">&#39;r-&#39;</span><span class="p">,</span> <span class="n">lw</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;True density&#39;</span><span class="p">)</span>
    <span class="n">axes</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;Value&#39;</span><span class="p">)</span>
    <span class="n">axes</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;Density&#39;</span><span class="p">)</span>
    <span class="n">axes</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Histogram (Ïƒ=</span><span class="si">{</span><span class="n">proposal_std</span><span class="si">}</span><span class="s1">)&#39;</span><span class="p">)</span>
    <span class="n">axes</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
    <span class="n">axes</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="kc">True</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.3</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">suptitle</span><span class="p">(</span><span class="s1">&#39;Metropolis-Hastings: ì œì•ˆ ë¶„í¬ í‘œì¤€í¸ì°¨ì˜ ì˜í–¥&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</code></pre></div>

<h3 id="23">2.3 ë‹¤ë³€ëŸ‰ í™•ì¥<a class="header-link" href="#23" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">metropolis_hastings_2d</span><span class="p">(</span><span class="n">target</span><span class="p">,</span> <span class="n">proposal_cov</span><span class="p">,</span> <span class="n">n_samples</span><span class="p">,</span> <span class="n">initial_value</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">burn_in</span><span class="o">=</span><span class="mi">1000</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    2ì°¨ì› Metropolis-Hastings</span>

<span class="sd">    Parameters:</span>
<span class="sd">    -----------</span>
<span class="sd">    target : callable</span>
<span class="sd">        ë¹„ì •ê·œí™” 2D ëª©í‘œ ë°€ë„ í•¨ìˆ˜</span>
<span class="sd">    proposal_cov : ndarray</span>
<span class="sd">        ì œì•ˆ ë¶„í¬ì˜ ê³µë¶„ì‚° í–‰ë ¬ (2x2)</span>
<span class="sd">    n_samples : int</span>
<span class="sd">        ìƒì„±í•  ìƒ˜í”Œ ìˆ˜</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">initial_value</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">initial_value</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">])</span>

    <span class="n">samples</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">n_samples</span> <span class="o">+</span> <span class="n">burn_in</span><span class="p">,</span> <span class="mi">2</span><span class="p">))</span>
    <span class="n">samples</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">initial_value</span>
    <span class="n">n_accepted</span> <span class="o">=</span> <span class="mi">0</span>

    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">n_samples</span> <span class="o">+</span> <span class="n">burn_in</span><span class="p">):</span>
        <span class="n">current</span> <span class="o">=</span> <span class="n">samples</span><span class="p">[</span><span class="n">i</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>

        <span class="c1"># ë‹¤ë³€ëŸ‰ ì •ê·œë¶„í¬ì—ì„œ ì œì•ˆ</span>
        <span class="n">proposal</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">multivariate_normal</span><span class="p">(</span><span class="n">current</span><span class="p">,</span> <span class="n">proposal_cov</span><span class="p">)</span>

        <span class="c1"># ìˆ˜ë½ í™•ë¥ </span>
        <span class="n">acceptance_ratio</span> <span class="o">=</span> <span class="n">target</span><span class="p">(</span><span class="n">proposal</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="n">target</span><span class="p">(</span><span class="n">current</span><span class="p">)</span> <span class="o">+</span> <span class="mf">1e-10</span><span class="p">)</span>
        <span class="n">acceptance_prob</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">acceptance_ratio</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">uniform</span><span class="p">()</span> <span class="o">&lt;</span> <span class="n">acceptance_prob</span><span class="p">:</span>
            <span class="n">samples</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">proposal</span>
            <span class="n">n_accepted</span> <span class="o">+=</span> <span class="mi">1</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">samples</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">current</span>

    <span class="n">samples</span> <span class="o">=</span> <span class="n">samples</span><span class="p">[</span><span class="n">burn_in</span><span class="p">:]</span>
    <span class="n">acceptance_rate</span> <span class="o">=</span> <span class="n">n_accepted</span> <span class="o">/</span> <span class="p">(</span><span class="n">n_samples</span> <span class="o">+</span> <span class="n">burn_in</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">samples</span><span class="p">,</span> <span class="n">acceptance_rate</span>


<span class="c1"># 2D í˜¼í•© ì •ê·œë¶„í¬</span>
<span class="k">def</span><span class="w"> </span><span class="nf">target_2d</span><span class="p">(</span><span class="n">x</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;2D í˜¼í•© ì •ê·œë¶„í¬&quot;&quot;&quot;</span>
    <span class="c1"># ì²« ë²ˆì§¸ ì„±ë¶„</span>
    <span class="n">mu1</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">])</span>
    <span class="n">cov1</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([[</span><span class="mf">0.5</span><span class="p">,</span> <span class="mf">0.3</span><span class="p">],</span> <span class="p">[</span><span class="mf">0.3</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">]])</span>
    <span class="n">term1</span> <span class="o">=</span> <span class="n">stats</span><span class="o">.</span><span class="n">multivariate_normal</span><span class="p">(</span><span class="n">mu1</span><span class="p">,</span> <span class="n">cov1</span><span class="p">)</span><span class="o">.</span><span class="n">pdf</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>

    <span class="c1"># ë‘ ë²ˆì§¸ ì„±ë¶„</span>
    <span class="n">mu2</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">])</span>
    <span class="n">cov2</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([[</span><span class="mf">0.8</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.2</span><span class="p">],</span> <span class="p">[</span><span class="o">-</span><span class="mf">0.2</span><span class="p">,</span> <span class="mf">0.8</span><span class="p">]])</span>
    <span class="n">term2</span> <span class="o">=</span> <span class="n">stats</span><span class="o">.</span><span class="n">multivariate_normal</span><span class="p">(</span><span class="n">mu2</span><span class="p">,</span> <span class="n">cov2</span><span class="p">)</span><span class="o">.</span><span class="n">pdf</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>

    <span class="k">return</span> <span class="mf">0.4</span> <span class="o">*</span> <span class="n">term1</span> <span class="o">+</span> <span class="mf">0.6</span> <span class="o">*</span> <span class="n">term2</span>

<span class="c1"># ìƒ˜í”Œë§</span>
<span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">seed</span><span class="p">(</span><span class="mi">42</span><span class="p">)</span>
<span class="n">proposal_cov</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([[</span><span class="mf">0.5</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">]])</span>
<span class="n">samples_2d</span><span class="p">,</span> <span class="n">acc_rate</span> <span class="o">=</span> <span class="n">metropolis_hastings_2d</span><span class="p">(</span>
    <span class="n">target_2d</span><span class="p">,</span>
    <span class="n">proposal_cov</span><span class="o">=</span><span class="n">proposal_cov</span><span class="p">,</span>
    <span class="n">n_samples</span><span class="o">=</span><span class="mi">20000</span><span class="p">,</span>
    <span class="n">burn_in</span><span class="o">=</span><span class="mi">5000</span>
<span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;ìˆ˜ë½ë¥ : </span><span class="si">{</span><span class="n">acc_rate</span><span class="si">:</span><span class="s2">.2%</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

<span class="c1"># ì‹œê°í™”</span>
<span class="n">fig</span><span class="p">,</span> <span class="n">axes</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">15</span><span class="p">,</span> <span class="mi">5</span><span class="p">))</span>

<span class="c1"># íŠ¸ë ˆì´ìŠ¤ í”Œë¡¯</span>
<span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">samples_2d</span><span class="p">[:</span><span class="mi">1000</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span> <span class="s1">&#39;b-&#39;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.7</span><span class="p">,</span> <span class="n">lw</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;x1&#39;</span><span class="p">)</span>
<span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">samples_2d</span><span class="p">[:</span><span class="mi">1000</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span> <span class="s1">&#39;r-&#39;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.7</span><span class="p">,</span> <span class="n">lw</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;x2&#39;</span><span class="p">)</span>
<span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;Iteration&#39;</span><span class="p">)</span>
<span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;Value&#39;</span><span class="p">)</span>
<span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;Trace Plot (first 1000)&#39;</span><span class="p">)</span>
<span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
<span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="kc">True</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.3</span><span class="p">)</span>

<span class="c1"># 2D ì‚°ì ë„</span>
<span class="n">axes</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">samples_2d</span><span class="p">[::</span><span class="mi">10</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span> <span class="n">samples_2d</span><span class="p">[::</span><span class="mi">10</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.3</span><span class="p">,</span> <span class="n">s</span><span class="o">=</span><span class="mi">5</span><span class="p">)</span>
<span class="n">axes</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;x1&#39;</span><span class="p">)</span>
<span class="n">axes</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;x2&#39;</span><span class="p">)</span>
<span class="n">axes</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;MCMC Samples (2D)&#39;</span><span class="p">)</span>
<span class="n">axes</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="kc">True</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.3</span><span class="p">)</span>

<span class="c1"># ë“±ê³ ì„ ê³¼ ë¹„êµ</span>
<span class="n">x1_range</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="o">-</span><span class="mi">4</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">100</span><span class="p">)</span>
<span class="n">x2_range</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="o">-</span><span class="mi">4</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">100</span><span class="p">)</span>
<span class="n">X1</span><span class="p">,</span> <span class="n">X2</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">meshgrid</span><span class="p">(</span><span class="n">x1_range</span><span class="p">,</span> <span class="n">x2_range</span><span class="p">)</span>
<span class="n">positions</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">dstack</span><span class="p">((</span><span class="n">X1</span><span class="p">,</span> <span class="n">X2</span><span class="p">))</span>
<span class="n">Z</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([[</span><span class="n">target_2d</span><span class="p">(</span><span class="n">p</span><span class="p">)</span> <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">row</span><span class="p">]</span> <span class="k">for</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">positions</span><span class="p">])</span>

<span class="n">axes</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">contour</span><span class="p">(</span><span class="n">X1</span><span class="p">,</span> <span class="n">X2</span><span class="p">,</span> <span class="n">Z</span><span class="p">,</span> <span class="n">levels</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="s1">&#39;viridis&#39;</span><span class="p">)</span>
<span class="n">axes</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">samples_2d</span><span class="p">[::</span><span class="mi">20</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span> <span class="n">samples_2d</span><span class="p">[::</span><span class="mi">20</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.2</span><span class="p">,</span> <span class="n">s</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">c</span><span class="o">=</span><span class="s1">&#39;red&#39;</span><span class="p">)</span>
<span class="n">axes</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;x1&#39;</span><span class="p">)</span>
<span class="n">axes</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;x2&#39;</span><span class="p">)</span>
<span class="n">axes</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;Samples vs True Density&#39;</span><span class="p">)</span>
<span class="n">axes</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="kc">True</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.3</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</code></pre></div>

<hr />
<h2 id="3-pymc">3. PyMC ì†Œê°œ<a class="header-link" href="#3-pymc" title="Permanent link">&para;</a></h2>
<h3 id="31">3.1 ì„¤ì¹˜ ë° ê¸°ë³¸ ì„¤ì •<a class="header-link" href="#31" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><span class="c1"># PyMC ì„¤ì¹˜ (Python 3.9+)</span>
pip<span class="w"> </span>install<span class="w"> </span>pymc<span class="w"> </span>arviz

<span class="c1"># ë˜ëŠ” conda</span>
conda<span class="w"> </span>install<span class="w"> </span>-c<span class="w"> </span>conda-forge<span class="w"> </span>pymc<span class="w"> </span>arviz
</code></pre></div>

<div class="highlight"><pre><span></span><code><span class="c1"># ê¸°ë³¸ import</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">pymc</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">pm</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">arviz</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">az</span>

<span class="c1"># ì‹œê°í™” ì„¤ì •</span>
<span class="n">az</span><span class="o">.</span><span class="n">style</span><span class="o">.</span><span class="n">use</span><span class="p">(</span><span class="s2">&quot;arviz-darkgrid&quot;</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;PyMC version: </span><span class="si">{</span><span class="n">pm</span><span class="o">.</span><span class="n">__version__</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;ArviZ version: </span><span class="si">{</span><span class="n">az</span><span class="o">.</span><span class="n">__version__</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</code></pre></div>

<h3 id="32-pymc">3.2 ì²« ë²ˆì§¸ PyMC ëª¨ë¸: ë™ì „ ë˜ì§€ê¸°<a class="header-link" href="#32-pymc" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><span class="kn">import</span><span class="w"> </span><span class="nn">pymc</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">pm</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">arviz</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">az</span>

<span class="c1"># ë°ì´í„°</span>
<span class="n">n_trials</span> <span class="o">=</span> <span class="mi">100</span>
<span class="n">n_heads</span> <span class="o">=</span> <span class="mi">65</span>

<span class="c1"># PyMC ëª¨ë¸ ì •ì˜</span>
<span class="k">with</span> <span class="n">pm</span><span class="o">.</span><span class="n">Model</span><span class="p">()</span> <span class="k">as</span> <span class="n">coin_model</span><span class="p">:</span>
    <span class="c1"># ì‚¬ì „ë¶„í¬: Beta(1, 1) = Uniform(0, 1)</span>
    <span class="n">p</span> <span class="o">=</span> <span class="n">pm</span><span class="o">.</span><span class="n">Beta</span><span class="p">(</span><span class="s1">&#39;p&#39;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">beta</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>

    <span class="c1"># ê°€ëŠ¥ë„: Binomial</span>
    <span class="n">y</span> <span class="o">=</span> <span class="n">pm</span><span class="o">.</span><span class="n">Binomial</span><span class="p">(</span><span class="s1">&#39;y&#39;</span><span class="p">,</span> <span class="n">n</span><span class="o">=</span><span class="n">n_trials</span><span class="p">,</span> <span class="n">p</span><span class="o">=</span><span class="n">p</span><span class="p">,</span> <span class="n">observed</span><span class="o">=</span><span class="n">n_heads</span><span class="p">)</span>

    <span class="c1"># ì‚¬í›„ë¶„í¬ ìƒ˜í”Œë§</span>
    <span class="n">trace</span> <span class="o">=</span> <span class="n">pm</span><span class="o">.</span><span class="n">sample</span><span class="p">(</span><span class="mi">2000</span><span class="p">,</span> <span class="n">tune</span><span class="o">=</span><span class="mi">1000</span><span class="p">,</span> <span class="n">cores</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">random_seed</span><span class="o">=</span><span class="mi">42</span><span class="p">)</span>

<span class="c1"># ê²°ê³¼ í™•ì¸</span>
<span class="nb">print</span><span class="p">(</span><span class="n">az</span><span class="o">.</span><span class="n">summary</span><span class="p">(</span><span class="n">trace</span><span class="p">,</span> <span class="n">var_names</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;p&#39;</span><span class="p">]))</span>

<span class="c1"># ì‹œê°í™”</span>
<span class="n">fig</span><span class="p">,</span> <span class="n">axes</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">12</span><span class="p">,</span> <span class="mi">4</span><span class="p">))</span>

<span class="c1"># íŠ¸ë ˆì´ìŠ¤ í”Œë¡¯</span>
<span class="n">az</span><span class="o">.</span><span class="n">plot_trace</span><span class="p">(</span><span class="n">trace</span><span class="p">,</span> <span class="n">var_names</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;p&#39;</span><span class="p">],</span> <span class="n">axes</span><span class="o">=</span><span class="n">axes</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">))</span>

<span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>

<span class="c1"># ì‚¬í›„ë¶„í¬ í”Œë¡¯</span>
<span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">5</span><span class="p">))</span>
<span class="n">az</span><span class="o">.</span><span class="n">plot_posterior</span><span class="p">(</span><span class="n">trace</span><span class="p">,</span> <span class="n">var_names</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;p&#39;</span><span class="p">],</span> <span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">axvline</span><span class="p">(</span><span class="mf">0.65</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;r&#39;</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;--&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="sa">f</span><span class="s1">&#39;MLE = 0.65&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</code></pre></div>

<h3 id="33">3.3 ì •ê·œë¶„í¬ ëª¨ìˆ˜ ì¶”ì •<a class="header-link" href="#33" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><span class="c1"># ë°ì´í„° ìƒì„±</span>
<span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">seed</span><span class="p">(</span><span class="mi">42</span><span class="p">)</span>
<span class="n">true_mu</span> <span class="o">=</span> <span class="mf">5.0</span>
<span class="n">true_sigma</span> <span class="o">=</span> <span class="mf">2.0</span>
<span class="n">data</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">normal</span><span class="p">(</span><span class="n">true_mu</span><span class="p">,</span> <span class="n">true_sigma</span><span class="p">,</span> <span class="mi">50</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;True Î¼: </span><span class="si">{</span><span class="n">true_mu</span><span class="si">}</span><span class="s2">, Ïƒ: </span><span class="si">{</span><span class="n">true_sigma</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Sample mean: </span><span class="si">{</span><span class="n">data</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span><span class="si">:</span><span class="s2">.3f</span><span class="si">}</span><span class="s2">, std: </span><span class="si">{</span><span class="n">data</span><span class="o">.</span><span class="n">std</span><span class="p">()</span><span class="si">:</span><span class="s2">.3f</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

<span class="c1"># PyMC ëª¨ë¸</span>
<span class="k">with</span> <span class="n">pm</span><span class="o">.</span><span class="n">Model</span><span class="p">()</span> <span class="k">as</span> <span class="n">normal_model</span><span class="p">:</span>
    <span class="c1"># ì‚¬ì „ë¶„í¬</span>
    <span class="n">mu</span> <span class="o">=</span> <span class="n">pm</span><span class="o">.</span><span class="n">Normal</span><span class="p">(</span><span class="s1">&#39;mu&#39;</span><span class="p">,</span> <span class="n">mu</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">sigma</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span>  <span class="c1"># ì•½í•œ ì •ë³´ ì‚¬ì „ë¶„í¬</span>
    <span class="n">sigma</span> <span class="o">=</span> <span class="n">pm</span><span class="o">.</span><span class="n">HalfNormal</span><span class="p">(</span><span class="s1">&#39;sigma&#39;</span><span class="p">,</span> <span class="n">sigma</span><span class="o">=</span><span class="mi">5</span><span class="p">)</span>  <span class="c1"># ì–‘ìˆ˜ ì œì•½</span>

    <span class="c1"># ê°€ëŠ¥ë„</span>
    <span class="n">y</span> <span class="o">=</span> <span class="n">pm</span><span class="o">.</span><span class="n">Normal</span><span class="p">(</span><span class="s1">&#39;y&#39;</span><span class="p">,</span> <span class="n">mu</span><span class="o">=</span><span class="n">mu</span><span class="p">,</span> <span class="n">sigma</span><span class="o">=</span><span class="n">sigma</span><span class="p">,</span> <span class="n">observed</span><span class="o">=</span><span class="n">data</span><span class="p">)</span>

    <span class="c1"># ìƒ˜í”Œë§</span>
    <span class="n">trace</span> <span class="o">=</span> <span class="n">pm</span><span class="o">.</span><span class="n">sample</span><span class="p">(</span><span class="mi">2000</span><span class="p">,</span> <span class="n">tune</span><span class="o">=</span><span class="mi">1000</span><span class="p">,</span> <span class="n">cores</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">random_seed</span><span class="o">=</span><span class="mi">42</span><span class="p">)</span>

<span class="c1"># ê²°ê³¼ ìš”ì•½</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">=== ì‚¬í›„ë¶„í¬ ìš”ì•½ ===&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">az</span><span class="o">.</span><span class="n">summary</span><span class="p">(</span><span class="n">trace</span><span class="p">,</span> <span class="n">var_names</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;mu&#39;</span><span class="p">,</span> <span class="s1">&#39;sigma&#39;</span><span class="p">]))</span>

<span class="c1"># ì‹œê°í™”</span>
<span class="n">fig</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">14</span><span class="p">,</span> <span class="mi">8</span><span class="p">))</span>

<span class="c1"># íŠ¸ë ˆì´ìŠ¤ í”Œë¡¯</span>
<span class="n">axes</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
<span class="n">az</span><span class="o">.</span><span class="n">plot_trace</span><span class="p">(</span><span class="n">trace</span><span class="p">,</span> <span class="n">var_names</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;mu&#39;</span><span class="p">,</span> <span class="s1">&#39;sigma&#39;</span><span class="p">],</span> <span class="n">axes</span><span class="o">=</span><span class="n">axes</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>

<span class="c1"># ê²°í•© ì‚¬í›„ë¶„í¬</span>
<span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">8</span><span class="p">,</span> <span class="mi">8</span><span class="p">))</span>
<span class="n">az</span><span class="o">.</span><span class="n">plot_pair</span><span class="p">(</span><span class="n">trace</span><span class="p">,</span> <span class="n">var_names</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;mu&#39;</span><span class="p">,</span> <span class="s1">&#39;sigma&#39;</span><span class="p">],</span> <span class="n">kind</span><span class="o">=</span><span class="s1">&#39;kde&#39;</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">axvline</span><span class="p">(</span><span class="n">true_mu</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;r&#39;</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;--&#39;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.5</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">axhline</span><span class="p">(</span><span class="n">true_sigma</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;r&#39;</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;--&#39;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.5</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">scatter</span><span class="p">([</span><span class="n">true_mu</span><span class="p">],</span> <span class="p">[</span><span class="n">true_sigma</span><span class="p">],</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;r&#39;</span><span class="p">,</span> <span class="n">s</span><span class="o">=</span><span class="mi">100</span><span class="p">,</span> <span class="n">marker</span><span class="o">=</span><span class="s1">&#39;x&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;True values&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</code></pre></div>

<hr />
<h2 id="4">4. ë² ì´ì§€ì•ˆ ì„ í˜• íšŒê·€<a class="header-link" href="#4" title="Permanent link">&para;</a></h2>
<h3 id="41">4.1 ëª¨ë¸ ì •ì˜<a class="header-link" href="#41" title="Permanent link">&para;</a></h3>
<p>$$y_i = \beta_0 + \beta_1 x_i + \epsilon_i$$</p>
<p>$$\epsilon_i \sim N(0, \sigma^2)$$</p>
<p><strong>ë² ì´ì§€ì•ˆ ì„¤ì •</strong>:
- Î²â‚€ ~ N(0, 10Â²)
- Î²â‚ ~ N(0, 10Â²)
- Ïƒ ~ HalfNormal(5)</p>
<h3 id="42-pymc">4.2 PyMC êµ¬í˜„<a class="header-link" href="#42-pymc" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><span class="c1"># ë°ì´í„° ìƒì„±</span>
<span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">seed</span><span class="p">(</span><span class="mi">42</span><span class="p">)</span>
<span class="n">n</span> <span class="o">=</span> <span class="mi">100</span>
<span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">uniform</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="n">n</span><span class="p">)</span>
<span class="n">true_beta0</span> <span class="o">=</span> <span class="mf">2.5</span>
<span class="n">true_beta1</span> <span class="o">=</span> <span class="mf">1.5</span>
<span class="n">true_sigma</span> <span class="o">=</span> <span class="mf">1.0</span>
<span class="n">y</span> <span class="o">=</span> <span class="n">true_beta0</span> <span class="o">+</span> <span class="n">true_beta1</span> <span class="o">*</span> <span class="n">x</span> <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">normal</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">true_sigma</span><span class="p">,</span> <span class="n">n</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;True parameters: Î²0=</span><span class="si">{</span><span class="n">true_beta0</span><span class="si">}</span><span class="s2">, Î²1=</span><span class="si">{</span><span class="n">true_beta1</span><span class="si">}</span><span class="s2">, Ïƒ=</span><span class="si">{</span><span class="n">true_sigma</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

<span class="c1"># ë¹ˆë„ì£¼ì˜ OLS ë¹„êµ</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">scipy</span><span class="w"> </span><span class="kn">import</span> <span class="n">stats</span> <span class="k">as</span> <span class="n">scipy_stats</span>
<span class="n">slope_ols</span><span class="p">,</span> <span class="n">intercept_ols</span><span class="p">,</span> <span class="n">_</span><span class="p">,</span> <span class="n">_</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">scipy_stats</span><span class="o">.</span><span class="n">linregress</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;OLS estimates: Î²0=</span><span class="si">{</span><span class="n">intercept_ols</span><span class="si">:</span><span class="s2">.3f</span><span class="si">}</span><span class="s2">, Î²1=</span><span class="si">{</span><span class="n">slope_ols</span><span class="si">:</span><span class="s2">.3f</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

<span class="c1"># ë² ì´ì§€ì•ˆ ì„ í˜• íšŒê·€</span>
<span class="k">with</span> <span class="n">pm</span><span class="o">.</span><span class="n">Model</span><span class="p">()</span> <span class="k">as</span> <span class="n">linear_model</span><span class="p">:</span>
    <span class="c1"># ì‚¬ì „ë¶„í¬</span>
    <span class="n">beta0</span> <span class="o">=</span> <span class="n">pm</span><span class="o">.</span><span class="n">Normal</span><span class="p">(</span><span class="s1">&#39;beta0&#39;</span><span class="p">,</span> <span class="n">mu</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">sigma</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span>
    <span class="n">beta1</span> <span class="o">=</span> <span class="n">pm</span><span class="o">.</span><span class="n">Normal</span><span class="p">(</span><span class="s1">&#39;beta1&#39;</span><span class="p">,</span> <span class="n">mu</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">sigma</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span>
    <span class="n">sigma</span> <span class="o">=</span> <span class="n">pm</span><span class="o">.</span><span class="n">HalfNormal</span><span class="p">(</span><span class="s1">&#39;sigma&#39;</span><span class="p">,</span> <span class="n">sigma</span><span class="o">=</span><span class="mi">5</span><span class="p">)</span>

    <span class="c1"># ì„ í˜• ì˜ˆì¸¡</span>
    <span class="n">mu</span> <span class="o">=</span> <span class="n">beta0</span> <span class="o">+</span> <span class="n">beta1</span> <span class="o">*</span> <span class="n">x</span>

    <span class="c1"># ê°€ëŠ¥ë„</span>
    <span class="n">y_obs</span> <span class="o">=</span> <span class="n">pm</span><span class="o">.</span><span class="n">Normal</span><span class="p">(</span><span class="s1">&#39;y_obs&#39;</span><span class="p">,</span> <span class="n">mu</span><span class="o">=</span><span class="n">mu</span><span class="p">,</span> <span class="n">sigma</span><span class="o">=</span><span class="n">sigma</span><span class="p">,</span> <span class="n">observed</span><span class="o">=</span><span class="n">y</span><span class="p">)</span>

    <span class="c1"># ìƒ˜í”Œë§</span>
    <span class="n">trace</span> <span class="o">=</span> <span class="n">pm</span><span class="o">.</span><span class="n">sample</span><span class="p">(</span><span class="mi">3000</span><span class="p">,</span> <span class="n">tune</span><span class="o">=</span><span class="mi">1000</span><span class="p">,</span> <span class="n">cores</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">random_seed</span><span class="o">=</span><span class="mi">42</span><span class="p">)</span>

<span class="c1"># ê²°ê³¼</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">=== ë² ì´ì§€ì•ˆ ì¶”ì • ê²°ê³¼ ===&quot;</span><span class="p">)</span>
<span class="n">summary</span> <span class="o">=</span> <span class="n">az</span><span class="o">.</span><span class="n">summary</span><span class="p">(</span><span class="n">trace</span><span class="p">,</span> <span class="n">var_names</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;beta0&#39;</span><span class="p">,</span> <span class="s1">&#39;beta1&#39;</span><span class="p">,</span> <span class="s1">&#39;sigma&#39;</span><span class="p">])</span>
<span class="nb">print</span><span class="p">(</span><span class="n">summary</span><span class="p">)</span>

<span class="c1"># ì‹œê°í™”</span>
<span class="n">fig</span><span class="p">,</span> <span class="n">axes</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">15</span><span class="p">,</span> <span class="mi">8</span><span class="p">))</span>

<span class="c1"># ì‚¬í›„ë¶„í¬</span>
<span class="n">az</span><span class="o">.</span><span class="n">plot_posterior</span><span class="p">(</span><span class="n">trace</span><span class="p">,</span> <span class="n">var_names</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;beta0&#39;</span><span class="p">],</span> <span class="n">ax</span><span class="o">=</span><span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">])</span>
<span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">axvline</span><span class="p">(</span><span class="n">true_beta0</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;r&#39;</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;--&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;True&#39;</span><span class="p">)</span>
<span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">axvline</span><span class="p">(</span><span class="n">intercept_ols</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;g&#39;</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;:&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;OLS&#39;</span><span class="p">)</span>
<span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>

<span class="n">az</span><span class="o">.</span><span class="n">plot_posterior</span><span class="p">(</span><span class="n">trace</span><span class="p">,</span> <span class="n">var_names</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;beta1&#39;</span><span class="p">],</span> <span class="n">ax</span><span class="o">=</span><span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">])</span>
<span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">axvline</span><span class="p">(</span><span class="n">true_beta1</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;r&#39;</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;--&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;True&#39;</span><span class="p">)</span>
<span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">axvline</span><span class="p">(</span><span class="n">slope_ols</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;g&#39;</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;:&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;OLS&#39;</span><span class="p">)</span>
<span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>

<span class="n">az</span><span class="o">.</span><span class="n">plot_posterior</span><span class="p">(</span><span class="n">trace</span><span class="p">,</span> <span class="n">var_names</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;sigma&#39;</span><span class="p">],</span> <span class="n">ax</span><span class="o">=</span><span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">2</span><span class="p">])</span>
<span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">axvline</span><span class="p">(</span><span class="n">true_sigma</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;r&#39;</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;--&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;True&#39;</span><span class="p">)</span>
<span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>

<span class="c1"># íšŒê·€ì„  ë¶ˆí™•ì‹¤ì„±</span>
<span class="n">ax</span> <span class="o">=</span> <span class="n">axes</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span>
<span class="n">ax</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span> <span class="n">s</span><span class="o">=</span><span class="mi">20</span><span class="p">)</span>

<span class="c1"># ì‚¬í›„ ìƒ˜í”Œì—ì„œ íšŒê·€ì„ </span>
<span class="n">x_plot</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="mi">100</span><span class="p">)</span>
<span class="n">posterior_samples</span> <span class="o">=</span> <span class="n">trace</span><span class="o">.</span><span class="n">posterior</span>

<span class="c1"># 100ê°œì˜ ì‚¬í›„ ìƒ˜í”Œë¡œ íšŒê·€ì„  ê·¸ë¦¬ê¸°</span>
<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">100</span><span class="p">):</span>
    <span class="n">b0</span> <span class="o">=</span> <span class="n">posterior_samples</span><span class="p">[</span><span class="s1">&#39;beta0&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="o">.</span><span class="n">flatten</span><span class="p">()[</span><span class="n">i</span> <span class="o">*</span> <span class="mi">30</span><span class="p">]</span>  <span class="c1"># thin</span>
    <span class="n">b1</span> <span class="o">=</span> <span class="n">posterior_samples</span><span class="p">[</span><span class="s1">&#39;beta1&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="o">.</span><span class="n">flatten</span><span class="p">()[</span><span class="n">i</span> <span class="o">*</span> <span class="mi">30</span><span class="p">]</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x_plot</span><span class="p">,</span> <span class="n">b0</span> <span class="o">+</span> <span class="n">b1</span> <span class="o">*</span> <span class="n">x_plot</span><span class="p">,</span> <span class="s1">&#39;b-&#39;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.05</span><span class="p">)</span>

<span class="c1"># ì‚¬í›„ í‰ê·  íšŒê·€ì„ </span>
<span class="n">mean_b0</span> <span class="o">=</span> <span class="n">posterior_samples</span><span class="p">[</span><span class="s1">&#39;beta0&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span><span class="o">.</span><span class="n">values</span>
<span class="n">mean_b1</span> <span class="o">=</span> <span class="n">posterior_samples</span><span class="p">[</span><span class="s1">&#39;beta1&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span><span class="o">.</span><span class="n">values</span>
<span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x_plot</span><span class="p">,</span> <span class="n">mean_b0</span> <span class="o">+</span> <span class="n">mean_b1</span> <span class="o">*</span> <span class="n">x_plot</span><span class="p">,</span> <span class="s1">&#39;r-&#39;</span><span class="p">,</span> <span class="n">lw</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Posterior mean&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x_plot</span><span class="p">,</span> <span class="n">true_beta0</span> <span class="o">+</span> <span class="n">true_beta1</span> <span class="o">*</span> <span class="n">x_plot</span><span class="p">,</span> <span class="s1">&#39;g--&#39;</span><span class="p">,</span> <span class="n">lw</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;True&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;x&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;y&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;íšŒê·€ì„  ë¶ˆí™•ì‹¤ì„±&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
<span class="n">ax</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="kc">True</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.3</span><span class="p">)</span>

<span class="c1"># ê²°í•© ì‚¬í›„ë¶„í¬: beta0 vs beta1</span>
<span class="n">ax</span> <span class="o">=</span> <span class="n">axes</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span>
<span class="n">az</span><span class="o">.</span><span class="n">plot_pair</span><span class="p">(</span><span class="n">trace</span><span class="p">,</span> <span class="n">var_names</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;beta0&#39;</span><span class="p">,</span> <span class="s1">&#39;beta1&#39;</span><span class="p">],</span> <span class="n">kind</span><span class="o">=</span><span class="s1">&#39;kde&#39;</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">scatter</span><span class="p">([</span><span class="n">true_beta0</span><span class="p">],</span> <span class="p">[</span><span class="n">true_beta1</span><span class="p">],</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;r&#39;</span><span class="p">,</span> <span class="n">s</span><span class="o">=</span><span class="mi">100</span><span class="p">,</span> <span class="n">marker</span><span class="o">=</span><span class="s1">&#39;x&#39;</span><span class="p">,</span> <span class="n">zorder</span><span class="o">=</span><span class="mi">5</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;Î²0 vs Î²1 ê²°í•©ë¶„í¬&#39;</span><span class="p">)</span>

<span class="c1"># íŠ¸ë ˆì´ìŠ¤ í”Œë¡¯</span>
<span class="n">ax</span> <span class="o">=</span> <span class="n">axes</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">]</span>
<span class="n">az</span><span class="o">.</span><span class="n">plot_trace</span><span class="p">(</span><span class="n">trace</span><span class="p">,</span> <span class="n">var_names</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;beta1&#39;</span><span class="p">],</span> <span class="n">axes</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([[</span><span class="n">ax</span><span class="p">,</span> <span class="n">ax</span><span class="p">]]))</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;Î²1 íŠ¸ë ˆì´ìŠ¤&#39;</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</code></pre></div>

<h3 id="43">4.3 ì‚¬í›„ ì˜ˆì¸¡<a class="header-link" href="#43" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><span class="c1"># ì‚¬í›„ ì˜ˆì¸¡ë¶„í¬</span>
<span class="k">with</span> <span class="n">linear_model</span><span class="p">:</span>
    <span class="c1"># ìƒˆë¡œìš´ x ê°’ì— ëŒ€í•œ ì˜ˆì¸¡</span>
    <span class="n">x_new</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">3</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">7</span><span class="p">])</span>

    <span class="c1"># ì‚¬í›„ ì˜ˆì¸¡ ìƒ˜í”Œ</span>
    <span class="n">pm</span><span class="o">.</span><span class="n">set_data</span><span class="p">({</span><span class="s1">&#39;x&#39;</span><span class="p">:</span> <span class="n">x_new</span><span class="p">})</span>  <span class="c1"># ë§Œì•½ shared ë³€ìˆ˜ ì‚¬ìš© ì‹œ</span>

    <span class="c1"># ìˆ˜ë™ìœ¼ë¡œ ì‚¬í›„ ì˜ˆì¸¡</span>
    <span class="n">posterior</span> <span class="o">=</span> <span class="n">trace</span><span class="o">.</span><span class="n">posterior</span>

    <span class="n">beta0_samples</span> <span class="o">=</span> <span class="n">posterior</span><span class="p">[</span><span class="s1">&#39;beta0&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="o">.</span><span class="n">flatten</span><span class="p">()</span>
    <span class="n">beta1_samples</span> <span class="o">=</span> <span class="n">posterior</span><span class="p">[</span><span class="s1">&#39;beta1&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="o">.</span><span class="n">flatten</span><span class="p">()</span>
    <span class="n">sigma_samples</span> <span class="o">=</span> <span class="n">posterior</span><span class="p">[</span><span class="s1">&#39;sigma&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="o">.</span><span class="n">flatten</span><span class="p">()</span>

<span class="c1"># ì˜ˆì¸¡</span>
<span class="n">predictions</span> <span class="o">=</span> <span class="p">{}</span>
<span class="k">for</span> <span class="n">x_val</span> <span class="ow">in</span> <span class="n">x_new</span><span class="p">:</span>
    <span class="n">mu_pred</span> <span class="o">=</span> <span class="n">beta0_samples</span> <span class="o">+</span> <span class="n">beta1_samples</span> <span class="o">*</span> <span class="n">x_val</span>
    <span class="n">y_pred</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">normal</span><span class="p">(</span><span class="n">mu_pred</span><span class="p">,</span> <span class="n">sigma_samples</span><span class="p">)</span>
    <span class="n">predictions</span><span class="p">[</span><span class="n">x_val</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s1">&#39;mean&#39;</span><span class="p">:</span> <span class="n">mu_pred</span><span class="o">.</span><span class="n">mean</span><span class="p">(),</span>
        <span class="s1">&#39;std&#39;</span><span class="p">:</span> <span class="n">mu_pred</span><span class="o">.</span><span class="n">std</span><span class="p">(),</span>
        <span class="s1">&#39;pred_mean&#39;</span><span class="p">:</span> <span class="n">y_pred</span><span class="o">.</span><span class="n">mean</span><span class="p">(),</span>
        <span class="s1">&#39;pred_std&#39;</span><span class="p">:</span> <span class="n">y_pred</span><span class="o">.</span><span class="n">std</span><span class="p">(),</span>
        <span class="s1">&#39;ci_95&#39;</span><span class="p">:</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">percentile</span><span class="p">(</span><span class="n">mu_pred</span><span class="p">,</span> <span class="mf">2.5</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">percentile</span><span class="p">(</span><span class="n">mu_pred</span><span class="p">,</span> <span class="mf">97.5</span><span class="p">)),</span>
        <span class="s1">&#39;pred_95&#39;</span><span class="p">:</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">percentile</span><span class="p">(</span><span class="n">y_pred</span><span class="p">,</span> <span class="mf">2.5</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">percentile</span><span class="p">(</span><span class="n">y_pred</span><span class="p">,</span> <span class="mf">97.5</span><span class="p">))</span>
    <span class="p">}</span>

<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;=== ì‚¬í›„ ì˜ˆì¸¡ ===&quot;</span><span class="p">)</span>
<span class="k">for</span> <span class="n">x_val</span><span class="p">,</span> <span class="n">pred</span> <span class="ow">in</span> <span class="n">predictions</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">x = </span><span class="si">{</span><span class="n">x_val</span><span class="si">}</span><span class="s2">:&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  E[y|x] = </span><span class="si">{</span><span class="n">pred</span><span class="p">[</span><span class="s1">&#39;mean&#39;</span><span class="p">]</span><span class="si">:</span><span class="s2">.3f</span><span class="si">}</span><span class="s2"> Â± </span><span class="si">{</span><span class="n">pred</span><span class="p">[</span><span class="s1">&#39;std&#39;</span><span class="p">]</span><span class="si">:</span><span class="s2">.3f</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  95% CI for E[y|x]: (</span><span class="si">{</span><span class="n">pred</span><span class="p">[</span><span class="s1">&#39;ci_95&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="si">:</span><span class="s2">.3f</span><span class="si">}</span><span class="s2">, </span><span class="si">{</span><span class="n">pred</span><span class="p">[</span><span class="s1">&#39;ci_95&#39;</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span><span class="si">:</span><span class="s2">.3f</span><span class="si">}</span><span class="s2">)&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  95% PI for y: (</span><span class="si">{</span><span class="n">pred</span><span class="p">[</span><span class="s1">&#39;pred_95&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="si">:</span><span class="s2">.3f</span><span class="si">}</span><span class="s2">, </span><span class="si">{</span><span class="n">pred</span><span class="p">[</span><span class="s1">&#39;pred_95&#39;</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span><span class="si">:</span><span class="s2">.3f</span><span class="si">}</span><span class="s2">)&quot;</span><span class="p">)</span>
</code></pre></div>

<hr />
<h2 id="5">5. ëª¨ë¸ ë¹„êµ<a class="header-link" href="#5" title="Permanent link">&para;</a></h2>
<h3 id="51-waic-widely-applicable-information-criterion">5.1 WAIC (Widely Applicable Information Criterion)<a class="header-link" href="#51-waic-widely-applicable-information-criterion" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><span class="c1"># ë‘ ëª¨ë¸ ë¹„êµ: ë‹¨ìˆœ vs ì´ì°¨ íšŒê·€</span>

<span class="c1"># ì´ì°¨ ë°ì´í„° ìƒì„±</span>
<span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">seed</span><span class="p">(</span><span class="mi">42</span><span class="p">)</span>
<span class="n">n</span> <span class="o">=</span> <span class="mi">100</span>
<span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">uniform</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="n">n</span><span class="p">)</span>
<span class="n">y_quad</span> <span class="o">=</span> <span class="mi">2</span> <span class="o">+</span> <span class="mf">0.5</span> <span class="o">*</span> <span class="n">x</span> <span class="o">+</span> <span class="mf">0.1</span> <span class="o">*</span> <span class="n">x</span><span class="o">**</span><span class="mi">2</span> <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">normal</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mf">1.5</span><span class="p">,</span> <span class="n">n</span><span class="p">)</span>

<span class="c1"># ëª¨ë¸ 1: ì„ í˜•</span>
<span class="k">with</span> <span class="n">pm</span><span class="o">.</span><span class="n">Model</span><span class="p">()</span> <span class="k">as</span> <span class="n">model_linear</span><span class="p">:</span>
    <span class="n">beta0</span> <span class="o">=</span> <span class="n">pm</span><span class="o">.</span><span class="n">Normal</span><span class="p">(</span><span class="s1">&#39;beta0&#39;</span><span class="p">,</span> <span class="n">mu</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">sigma</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span>
    <span class="n">beta1</span> <span class="o">=</span> <span class="n">pm</span><span class="o">.</span><span class="n">Normal</span><span class="p">(</span><span class="s1">&#39;beta1&#39;</span><span class="p">,</span> <span class="n">mu</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">sigma</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span>
    <span class="n">sigma</span> <span class="o">=</span> <span class="n">pm</span><span class="o">.</span><span class="n">HalfNormal</span><span class="p">(</span><span class="s1">&#39;sigma&#39;</span><span class="p">,</span> <span class="n">sigma</span><span class="o">=</span><span class="mi">5</span><span class="p">)</span>

    <span class="n">mu</span> <span class="o">=</span> <span class="n">beta0</span> <span class="o">+</span> <span class="n">beta1</span> <span class="o">*</span> <span class="n">x</span>
    <span class="n">y_obs</span> <span class="o">=</span> <span class="n">pm</span><span class="o">.</span><span class="n">Normal</span><span class="p">(</span><span class="s1">&#39;y_obs&#39;</span><span class="p">,</span> <span class="n">mu</span><span class="o">=</span><span class="n">mu</span><span class="p">,</span> <span class="n">sigma</span><span class="o">=</span><span class="n">sigma</span><span class="p">,</span> <span class="n">observed</span><span class="o">=</span><span class="n">y_quad</span><span class="p">)</span>

    <span class="n">trace_linear</span> <span class="o">=</span> <span class="n">pm</span><span class="o">.</span><span class="n">sample</span><span class="p">(</span><span class="mi">2000</span><span class="p">,</span> <span class="n">tune</span><span class="o">=</span><span class="mi">1000</span><span class="p">,</span> <span class="n">cores</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">random_seed</span><span class="o">=</span><span class="mi">42</span><span class="p">)</span>
    <span class="c1"># WAIC ê³„ì‚°ì„ ìœ„í•œ log_likelihood</span>
    <span class="n">pm</span><span class="o">.</span><span class="n">compute_log_likelihood</span><span class="p">(</span><span class="n">trace_linear</span><span class="p">)</span>

<span class="c1"># ëª¨ë¸ 2: ì´ì°¨</span>
<span class="k">with</span> <span class="n">pm</span><span class="o">.</span><span class="n">Model</span><span class="p">()</span> <span class="k">as</span> <span class="n">model_quadratic</span><span class="p">:</span>
    <span class="n">beta0</span> <span class="o">=</span> <span class="n">pm</span><span class="o">.</span><span class="n">Normal</span><span class="p">(</span><span class="s1">&#39;beta0&#39;</span><span class="p">,</span> <span class="n">mu</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">sigma</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span>
    <span class="n">beta1</span> <span class="o">=</span> <span class="n">pm</span><span class="o">.</span><span class="n">Normal</span><span class="p">(</span><span class="s1">&#39;beta1&#39;</span><span class="p">,</span> <span class="n">mu</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">sigma</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span>
    <span class="n">beta2</span> <span class="o">=</span> <span class="n">pm</span><span class="o">.</span><span class="n">Normal</span><span class="p">(</span><span class="s1">&#39;beta2&#39;</span><span class="p">,</span> <span class="n">mu</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">sigma</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span>
    <span class="n">sigma</span> <span class="o">=</span> <span class="n">pm</span><span class="o">.</span><span class="n">HalfNormal</span><span class="p">(</span><span class="s1">&#39;sigma&#39;</span><span class="p">,</span> <span class="n">sigma</span><span class="o">=</span><span class="mi">5</span><span class="p">)</span>

    <span class="n">mu</span> <span class="o">=</span> <span class="n">beta0</span> <span class="o">+</span> <span class="n">beta1</span> <span class="o">*</span> <span class="n">x</span> <span class="o">+</span> <span class="n">beta2</span> <span class="o">*</span> <span class="n">x</span><span class="o">**</span><span class="mi">2</span>
    <span class="n">y_obs</span> <span class="o">=</span> <span class="n">pm</span><span class="o">.</span><span class="n">Normal</span><span class="p">(</span><span class="s1">&#39;y_obs&#39;</span><span class="p">,</span> <span class="n">mu</span><span class="o">=</span><span class="n">mu</span><span class="p">,</span> <span class="n">sigma</span><span class="o">=</span><span class="n">sigma</span><span class="p">,</span> <span class="n">observed</span><span class="o">=</span><span class="n">y_quad</span><span class="p">)</span>

    <span class="n">trace_quadratic</span> <span class="o">=</span> <span class="n">pm</span><span class="o">.</span><span class="n">sample</span><span class="p">(</span><span class="mi">2000</span><span class="p">,</span> <span class="n">tune</span><span class="o">=</span><span class="mi">1000</span><span class="p">,</span> <span class="n">cores</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">random_seed</span><span class="o">=</span><span class="mi">42</span><span class="p">)</span>
    <span class="n">pm</span><span class="o">.</span><span class="n">compute_log_likelihood</span><span class="p">(</span><span class="n">trace_quadratic</span><span class="p">)</span>

<span class="c1"># WAIC ë¹„êµ</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;=== WAIC ë¹„êµ ===&quot;</span><span class="p">)</span>
<span class="n">waic_linear</span> <span class="o">=</span> <span class="n">az</span><span class="o">.</span><span class="n">waic</span><span class="p">(</span><span class="n">trace_linear</span><span class="p">)</span>
<span class="n">waic_quadratic</span> <span class="o">=</span> <span class="n">az</span><span class="o">.</span><span class="n">waic</span><span class="p">(</span><span class="n">trace_quadratic</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Linear model WAIC: </span><span class="si">{</span><span class="n">waic_linear</span><span class="o">.</span><span class="n">waic</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Quadratic model WAIC: </span><span class="si">{</span><span class="n">waic_quadratic</span><span class="o">.</span><span class="n">waic</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">ë‚®ì€ WAICì´ ë” ì¢‹ì€ ëª¨ë¸&quot;</span><span class="p">)</span>

<span class="c1"># ëª¨ë¸ ë¹„êµ</span>
<span class="n">comparison</span> <span class="o">=</span> <span class="n">az</span><span class="o">.</span><span class="n">compare</span><span class="p">({</span>
    <span class="s1">&#39;Linear&#39;</span><span class="p">:</span> <span class="n">trace_linear</span><span class="p">,</span>
    <span class="s1">&#39;Quadratic&#39;</span><span class="p">:</span> <span class="n">trace_quadratic</span>
<span class="p">},</span> <span class="n">ic</span><span class="o">=</span><span class="s1">&#39;waic&#39;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">=== ëª¨ë¸ ë¹„êµ ===&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">comparison</span><span class="p">)</span>

<span class="c1"># ì‹œê°í™”</span>
<span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">5</span><span class="p">))</span>
<span class="n">az</span><span class="o">.</span><span class="n">plot_compare</span><span class="p">(</span><span class="n">comparison</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;WAIC ëª¨ë¸ ë¹„êµ&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</code></pre></div>

<h3 id="52-loo-cv-leave-one-out-cross-validation">5.2 LOO-CV (Leave-One-Out Cross-Validation)<a class="header-link" href="#52-loo-cv-leave-one-out-cross-validation" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><span class="c1"># LOO-CV (Pareto Smoothed Importance Sampling LOO)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;=== LOO-CV ë¹„êµ ===&quot;</span><span class="p">)</span>

<span class="n">loo_linear</span> <span class="o">=</span> <span class="n">az</span><span class="o">.</span><span class="n">loo</span><span class="p">(</span><span class="n">trace_linear</span><span class="p">)</span>
<span class="n">loo_quadratic</span> <span class="o">=</span> <span class="n">az</span><span class="o">.</span><span class="n">loo</span><span class="p">(</span><span class="n">trace_quadratic</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Linear model LOO: </span><span class="si">{</span><span class="n">loo_linear</span><span class="o">.</span><span class="n">loo</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Quadratic model LOO: </span><span class="si">{</span><span class="n">loo_quadratic</span><span class="o">.</span><span class="n">loo</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

<span class="c1"># LOO ì§„ë‹¨</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">=== LOO ì§„ë‹¨: Pareto k ===&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Linear - k &gt; 0.7ì¸ ê´€ì¸¡ì¹˜: </span><span class="si">{</span><span class="p">(</span><span class="n">loo_linear</span><span class="o">.</span><span class="n">pareto_k</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="mf">0.7</span><span class="p">)</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Quadratic - k &gt; 0.7ì¸ ê´€ì¸¡ì¹˜: </span><span class="si">{</span><span class="p">(</span><span class="n">loo_quadratic</span><span class="o">.</span><span class="n">pareto_k</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="mf">0.7</span><span class="p">)</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

<span class="c1"># ë¹„êµ</span>
<span class="n">comparison_loo</span> <span class="o">=</span> <span class="n">az</span><span class="o">.</span><span class="n">compare</span><span class="p">({</span>
    <span class="s1">&#39;Linear&#39;</span><span class="p">:</span> <span class="n">trace_linear</span><span class="p">,</span>
    <span class="s1">&#39;Quadratic&#39;</span><span class="p">:</span> <span class="n">trace_quadratic</span>
<span class="p">},</span> <span class="n">ic</span><span class="o">=</span><span class="s1">&#39;loo&#39;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">=== LOO ëª¨ë¸ ë¹„êµ ===&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">comparison_loo</span><span class="p">)</span>
</code></pre></div>

<h3 id="53">5.3 ë² ì´ì¦ˆ íŒ©í„° (ê°œë…)<a class="header-link" href="#53" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">bayes_factor_example</span><span class="p">():</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;ë² ì´ì¦ˆ íŒ©í„° ê°œë… ì„¤ëª…&quot;&quot;&quot;</span>

    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;=== ë² ì´ì¦ˆ íŒ©í„° (Bayes Factor) ===&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">()</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;ì •ì˜: BFâ‚â‚€ = P(D|Mâ‚) / P(D|Mâ‚€)&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">()</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;í•´ì„:&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;  BF &gt; 100   : ê²°ì •ì  ì¦ê±° (Mâ‚ ì§€ì§€)&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;  30 &lt; BF &lt; 100: ë§¤ìš° ê°•í•œ ì¦ê±°&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;  10 &lt; BF &lt; 30 : ê°•í•œ ì¦ê±°&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;  3 &lt; BF &lt; 10  : ì¤‘ê°„ ì¦ê±°&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;  1 &lt; BF &lt; 3   : ì•½í•œ ì¦ê±°&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;  BF = 1       : ì¦ê±° ì—†ìŒ&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;  BF &lt; 1       : Mâ‚€ ì§€ì§€&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">()</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;ì£¼ì˜: ë² ì´ì¦ˆ íŒ©í„° ê³„ì‚°ì€ ì¼ë°˜ì ìœ¼ë¡œ ì–´ë ¤ì›€&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;      PyMCì—ì„œëŠ” Savage-Dickey ratio ë“±ì˜ ë°©ë²• ì‚¬ìš©&quot;</span><span class="p">)</span>

<span class="n">bayes_factor_example</span><span class="p">()</span>
</code></pre></div>

<hr />
<h2 id="6-posterior-predictive-checks">6. ì‚¬í›„ ì˜ˆì¸¡ ê²€ì‚¬ (Posterior Predictive Checks)<a class="header-link" href="#6-posterior-predictive-checks" title="Permanent link">&para;</a></h2>
<h3 id="61">6.1 ê°œë…<a class="header-link" href="#61" title="Permanent link">&para;</a></h3>
<p>ì‚¬í›„ ì˜ˆì¸¡ ë¶„í¬: ê´€ì¸¡ëœ ë°ì´í„°ë¥¼ í•™ìŠµí•œ ëª¨ë¸ì´ ìƒì„±í•  ê²ƒìœ¼ë¡œ ì˜ˆìƒë˜ëŠ” ë°ì´í„°</p>
<p>$$p(\tilde{y}|y) = \int p(\tilde{y}|\theta) p(\theta|y) d\theta$$</p>
<h3 id="62">6.2 êµ¬í˜„<a class="header-link" href="#62" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><span class="c1"># í¬ì•„ì†¡ íšŒê·€ ì˜ˆì œ</span>
<span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">seed</span><span class="p">(</span><span class="mi">42</span><span class="p">)</span>
<span class="n">n</span> <span class="o">=</span> <span class="mi">100</span>
<span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">uniform</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="n">n</span><span class="p">)</span>
<span class="n">true_rate</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="mf">0.5</span> <span class="o">+</span> <span class="mf">0.3</span> <span class="o">*</span> <span class="n">x</span><span class="p">)</span>
<span class="n">y_count</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">poisson</span><span class="p">(</span><span class="n">true_rate</span><span class="p">)</span>

<span class="c1"># ì˜ëª»ëœ ëª¨ë¸: ì •ê·œë¶„í¬ ê°€ì •</span>
<span class="k">with</span> <span class="n">pm</span><span class="o">.</span><span class="n">Model</span><span class="p">()</span> <span class="k">as</span> <span class="n">wrong_model</span><span class="p">:</span>
    <span class="n">beta0</span> <span class="o">=</span> <span class="n">pm</span><span class="o">.</span><span class="n">Normal</span><span class="p">(</span><span class="s1">&#39;beta0&#39;</span><span class="p">,</span> <span class="n">mu</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">sigma</span><span class="o">=</span><span class="mi">5</span><span class="p">)</span>
    <span class="n">beta1</span> <span class="o">=</span> <span class="n">pm</span><span class="o">.</span><span class="n">Normal</span><span class="p">(</span><span class="s1">&#39;beta1&#39;</span><span class="p">,</span> <span class="n">mu</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">sigma</span><span class="o">=</span><span class="mi">5</span><span class="p">)</span>
    <span class="n">sigma</span> <span class="o">=</span> <span class="n">pm</span><span class="o">.</span><span class="n">HalfNormal</span><span class="p">(</span><span class="s1">&#39;sigma&#39;</span><span class="p">,</span> <span class="n">sigma</span><span class="o">=</span><span class="mi">5</span><span class="p">)</span>

    <span class="n">mu</span> <span class="o">=</span> <span class="n">beta0</span> <span class="o">+</span> <span class="n">beta1</span> <span class="o">*</span> <span class="n">x</span>
    <span class="n">y_obs</span> <span class="o">=</span> <span class="n">pm</span><span class="o">.</span><span class="n">Normal</span><span class="p">(</span><span class="s1">&#39;y_obs&#39;</span><span class="p">,</span> <span class="n">mu</span><span class="o">=</span><span class="n">mu</span><span class="p">,</span> <span class="n">sigma</span><span class="o">=</span><span class="n">sigma</span><span class="p">,</span> <span class="n">observed</span><span class="o">=</span><span class="n">y_count</span><span class="p">)</span>

    <span class="n">trace_wrong</span> <span class="o">=</span> <span class="n">pm</span><span class="o">.</span><span class="n">sample</span><span class="p">(</span><span class="mi">2000</span><span class="p">,</span> <span class="n">tune</span><span class="o">=</span><span class="mi">1000</span><span class="p">,</span> <span class="n">cores</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">random_seed</span><span class="o">=</span><span class="mi">42</span><span class="p">)</span>

    <span class="c1"># ì‚¬í›„ ì˜ˆì¸¡</span>
    <span class="n">ppc_wrong</span> <span class="o">=</span> <span class="n">pm</span><span class="o">.</span><span class="n">sample_posterior_predictive</span><span class="p">(</span><span class="n">trace_wrong</span><span class="p">,</span> <span class="n">random_seed</span><span class="o">=</span><span class="mi">42</span><span class="p">)</span>

<span class="c1"># ì˜¬ë°”ë¥¸ ëª¨ë¸: í¬ì•„ì†¡ ê°€ì •</span>
<span class="k">with</span> <span class="n">pm</span><span class="o">.</span><span class="n">Model</span><span class="p">()</span> <span class="k">as</span> <span class="n">correct_model</span><span class="p">:</span>
    <span class="n">beta0</span> <span class="o">=</span> <span class="n">pm</span><span class="o">.</span><span class="n">Normal</span><span class="p">(</span><span class="s1">&#39;beta0&#39;</span><span class="p">,</span> <span class="n">mu</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">sigma</span><span class="o">=</span><span class="mi">5</span><span class="p">)</span>
    <span class="n">beta1</span> <span class="o">=</span> <span class="n">pm</span><span class="o">.</span><span class="n">Normal</span><span class="p">(</span><span class="s1">&#39;beta1&#39;</span><span class="p">,</span> <span class="n">mu</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">sigma</span><span class="o">=</span><span class="mi">5</span><span class="p">)</span>

    <span class="n">log_rate</span> <span class="o">=</span> <span class="n">beta0</span> <span class="o">+</span> <span class="n">beta1</span> <span class="o">*</span> <span class="n">x</span>
    <span class="n">rate</span> <span class="o">=</span> <span class="n">pm</span><span class="o">.</span><span class="n">math</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="n">log_rate</span><span class="p">)</span>

    <span class="n">y_obs</span> <span class="o">=</span> <span class="n">pm</span><span class="o">.</span><span class="n">Poisson</span><span class="p">(</span><span class="s1">&#39;y_obs&#39;</span><span class="p">,</span> <span class="n">mu</span><span class="o">=</span><span class="n">rate</span><span class="p">,</span> <span class="n">observed</span><span class="o">=</span><span class="n">y_count</span><span class="p">)</span>

    <span class="n">trace_correct</span> <span class="o">=</span> <span class="n">pm</span><span class="o">.</span><span class="n">sample</span><span class="p">(</span><span class="mi">2000</span><span class="p">,</span> <span class="n">tune</span><span class="o">=</span><span class="mi">1000</span><span class="p">,</span> <span class="n">cores</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">random_seed</span><span class="o">=</span><span class="mi">42</span><span class="p">)</span>

    <span class="n">ppc_correct</span> <span class="o">=</span> <span class="n">pm</span><span class="o">.</span><span class="n">sample_posterior_predictive</span><span class="p">(</span><span class="n">trace_correct</span><span class="p">,</span> <span class="n">random_seed</span><span class="o">=</span><span class="mi">42</span><span class="p">)</span>

<span class="c1"># ì‹œê°í™”</span>
<span class="n">fig</span><span class="p">,</span> <span class="n">axes</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">14</span><span class="p">,</span> <span class="mi">10</span><span class="p">))</span>

<span class="c1"># ì˜ëª»ëœ ëª¨ë¸ì˜ PPC</span>
<span class="n">ax</span> <span class="o">=</span> <span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span>
<span class="n">ppc_data_wrong</span> <span class="o">=</span> <span class="n">ppc_wrong</span><span class="o">.</span><span class="n">posterior_predictive</span><span class="p">[</span><span class="s1">&#39;y_obs&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="o">.</span><span class="n">flatten</span><span class="p">()</span>
<span class="n">ax</span><span class="o">.</span><span class="n">hist</span><span class="p">(</span><span class="n">y_count</span><span class="p">,</span> <span class="n">bins</span><span class="o">=</span><span class="mi">20</span><span class="p">,</span> <span class="n">density</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.7</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Observed&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">hist</span><span class="p">(</span><span class="n">ppc_data_wrong</span><span class="p">[:</span><span class="nb">len</span><span class="p">(</span><span class="n">y_count</span><span class="p">)</span><span class="o">*</span><span class="mi">10</span><span class="p">],</span> <span class="n">bins</span><span class="o">=</span><span class="mi">20</span><span class="p">,</span> <span class="n">density</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;PPC&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;y&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;Density&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;ì˜ëª»ëœ ëª¨ë¸ (Normal): PPC&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>

<span class="c1"># ì˜¬ë°”ë¥¸ ëª¨ë¸ì˜ PPC</span>
<span class="n">ax</span> <span class="o">=</span> <span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span>
<span class="n">ppc_data_correct</span> <span class="o">=</span> <span class="n">ppc_correct</span><span class="o">.</span><span class="n">posterior_predictive</span><span class="p">[</span><span class="s1">&#39;y_obs&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="o">.</span><span class="n">flatten</span><span class="p">()</span>
<span class="n">ax</span><span class="o">.</span><span class="n">hist</span><span class="p">(</span><span class="n">y_count</span><span class="p">,</span> <span class="n">bins</span><span class="o">=</span><span class="mi">20</span><span class="p">,</span> <span class="n">density</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.7</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Observed&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">hist</span><span class="p">(</span><span class="n">ppc_data_correct</span><span class="p">[:</span><span class="nb">len</span><span class="p">(</span><span class="n">y_count</span><span class="p">)</span><span class="o">*</span><span class="mi">10</span><span class="p">],</span> <span class="n">bins</span><span class="o">=</span><span class="mi">20</span><span class="p">,</span> <span class="n">density</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;PPC&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;y&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;Density&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;ì˜¬ë°”ë¥¸ ëª¨ë¸ (Poisson): PPC&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>

<span class="c1"># ì”ì°¨ ë¶„ì„ - ì˜ëª»ëœ ëª¨ë¸</span>
<span class="n">ax</span> <span class="o">=</span> <span class="n">axes</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span>
<span class="n">mean_pred_wrong</span> <span class="o">=</span> <span class="n">ppc_wrong</span><span class="o">.</span><span class="n">posterior_predictive</span><span class="p">[</span><span class="s1">&#39;y_obs&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">dim</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;chain&#39;</span><span class="p">,</span> <span class="s1">&#39;draw&#39;</span><span class="p">])</span><span class="o">.</span><span class="n">values</span>
<span class="n">residuals_wrong</span> <span class="o">=</span> <span class="n">y_count</span> <span class="o">-</span> <span class="n">mean_pred_wrong</span>
<span class="n">ax</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">mean_pred_wrong</span><span class="p">,</span> <span class="n">residuals_wrong</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.5</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">axhline</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;r&#39;</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;--&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;Predicted&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;Residual&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;ì˜ëª»ëœ ëª¨ë¸: ì”ì°¨&#39;</span><span class="p">)</span>

<span class="c1"># ì”ì°¨ ë¶„ì„ - ì˜¬ë°”ë¥¸ ëª¨ë¸</span>
<span class="n">ax</span> <span class="o">=</span> <span class="n">axes</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span>
<span class="n">mean_pred_correct</span> <span class="o">=</span> <span class="n">ppc_correct</span><span class="o">.</span><span class="n">posterior_predictive</span><span class="p">[</span><span class="s1">&#39;y_obs&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">dim</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;chain&#39;</span><span class="p">,</span> <span class="s1">&#39;draw&#39;</span><span class="p">])</span><span class="o">.</span><span class="n">values</span>
<span class="n">residuals_correct</span> <span class="o">=</span> <span class="n">y_count</span> <span class="o">-</span> <span class="n">mean_pred_correct</span>
<span class="n">ax</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">mean_pred_correct</span><span class="p">,</span> <span class="n">residuals_correct</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.5</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">axhline</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;r&#39;</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;--&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;Predicted&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;Residual&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;ì˜¬ë°”ë¥¸ ëª¨ë¸: ì”ì°¨&#39;</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</code></pre></div>

<h3 id="63-arviz-ppc">6.3 ArviZë¥¼ ì‚¬ìš©í•œ PPC<a class="header-link" href="#63-arviz-ppc" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><span class="c1"># ArviZ PPC í”Œë¡¯</span>
<span class="n">fig</span><span class="p">,</span> <span class="n">axes</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">14</span><span class="p">,</span> <span class="mi">5</span><span class="p">))</span>

<span class="c1"># ê´€ì¸¡ ë°ì´í„°ë¥¼ InferenceDataì— ì¶”ê°€</span>
<span class="n">idata_wrong</span> <span class="o">=</span> <span class="n">az</span><span class="o">.</span><span class="n">from_pymc3</span><span class="p">(</span><span class="n">trace_wrong</span><span class="p">,</span> <span class="n">posterior_predictive</span><span class="o">=</span><span class="n">ppc_wrong</span><span class="p">)</span>
<span class="n">idata_wrong</span><span class="o">.</span><span class="n">add_groups</span><span class="p">({</span><span class="s1">&#39;observed_data&#39;</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;y_obs&#39;</span><span class="p">:</span> <span class="n">y_count</span><span class="p">}})</span>

<span class="n">idata_correct</span> <span class="o">=</span> <span class="n">az</span><span class="o">.</span><span class="n">from_pymc3</span><span class="p">(</span><span class="n">trace_correct</span><span class="p">,</span> <span class="n">posterior_predictive</span><span class="o">=</span><span class="n">ppc_correct</span><span class="p">)</span>
<span class="n">idata_correct</span><span class="o">.</span><span class="n">add_groups</span><span class="p">({</span><span class="s1">&#39;observed_data&#39;</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;y_obs&#39;</span><span class="p">:</span> <span class="n">y_count</span><span class="p">}})</span>

<span class="c1"># PPC í”Œë¡¯</span>
<span class="n">az</span><span class="o">.</span><span class="n">plot_ppc</span><span class="p">(</span><span class="n">idata_wrong</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">num_pp_samples</span><span class="o">=</span><span class="mi">100</span><span class="p">)</span>
<span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;ì˜ëª»ëœ ëª¨ë¸ (Normal)&#39;</span><span class="p">)</span>

<span class="n">az</span><span class="o">.</span><span class="n">plot_ppc</span><span class="p">(</span><span class="n">idata_correct</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">axes</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">num_pp_samples</span><span class="o">=</span><span class="mi">100</span><span class="p">)</span>
<span class="n">axes</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;ì˜¬ë°”ë¥¸ ëª¨ë¸ (Poisson)&#39;</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</code></pre></div>

<hr />
<h2 id="7">7. ìˆ˜ë ´ ì§„ë‹¨<a class="header-link" href="#7" title="Permanent link">&para;</a></h2>
<h3 id="71-r-hat-gelman-rubin">7.1 R-hat (Gelman-Rubin í†µê³„ëŸ‰)<a class="header-link" href="#71-r-hat-gelman-rubin" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">demonstrate_convergence_diagnostics</span><span class="p">():</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;ìˆ˜ë ´ ì§„ë‹¨ ì‹œì—°&quot;&quot;&quot;</span>

    <span class="c1"># ì—¬ëŸ¬ ì²´ì¸ìœ¼ë¡œ ìƒ˜í”Œë§</span>
    <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">seed</span><span class="p">(</span><span class="mi">42</span><span class="p">)</span>
    <span class="n">data</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">normal</span><span class="p">(</span><span class="mi">5</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">50</span><span class="p">)</span>

    <span class="k">with</span> <span class="n">pm</span><span class="o">.</span><span class="n">Model</span><span class="p">()</span> <span class="k">as</span> <span class="n">model</span><span class="p">:</span>
        <span class="n">mu</span> <span class="o">=</span> <span class="n">pm</span><span class="o">.</span><span class="n">Normal</span><span class="p">(</span><span class="s1">&#39;mu&#39;</span><span class="p">,</span> <span class="n">mu</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">sigma</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span>
        <span class="n">sigma</span> <span class="o">=</span> <span class="n">pm</span><span class="o">.</span><span class="n">HalfNormal</span><span class="p">(</span><span class="s1">&#39;sigma&#39;</span><span class="p">,</span> <span class="n">sigma</span><span class="o">=</span><span class="mi">5</span><span class="p">)</span>
        <span class="n">y</span> <span class="o">=</span> <span class="n">pm</span><span class="o">.</span><span class="n">Normal</span><span class="p">(</span><span class="s1">&#39;y&#39;</span><span class="p">,</span> <span class="n">mu</span><span class="o">=</span><span class="n">mu</span><span class="p">,</span> <span class="n">sigma</span><span class="o">=</span><span class="n">sigma</span><span class="p">,</span> <span class="n">observed</span><span class="o">=</span><span class="n">data</span><span class="p">)</span>

        <span class="c1"># ì—¬ëŸ¬ ì²´ì¸</span>
        <span class="n">trace</span> <span class="o">=</span> <span class="n">pm</span><span class="o">.</span><span class="n">sample</span><span class="p">(</span><span class="mi">2000</span><span class="p">,</span> <span class="n">tune</span><span class="o">=</span><span class="mi">1000</span><span class="p">,</span> <span class="n">chains</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span> <span class="n">cores</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">random_seed</span><span class="o">=</span><span class="mi">42</span><span class="p">)</span>

    <span class="c1"># R-hat ê³„ì‚°</span>
    <span class="n">summary</span> <span class="o">=</span> <span class="n">az</span><span class="o">.</span><span class="n">summary</span><span class="p">(</span><span class="n">trace</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;=== ìˆ˜ë ´ ì§„ë‹¨ ===&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">summary</span><span class="p">[[</span><span class="s1">&#39;mean&#39;</span><span class="p">,</span> <span class="s1">&#39;sd&#39;</span><span class="p">,</span> <span class="s1">&#39;r_hat&#39;</span><span class="p">,</span> <span class="s1">&#39;ess_bulk&#39;</span><span class="p">,</span> <span class="s1">&#39;ess_tail&#39;</span><span class="p">]])</span>

    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">í•´ì„:&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;  R-hat &lt; 1.01: ìˆ˜ë ´ ì–‘í˜¸&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;  ESS_bulk &gt; 400: ë²Œí¬ ESS ì¶©ë¶„&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;  ESS_tail &gt; 400: ê¼¬ë¦¬ ESS ì¶©ë¶„&quot;</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">trace</span>

<span class="n">trace_diagnostic</span> <span class="o">=</span> <span class="n">demonstrate_convergence_diagnostics</span><span class="p">()</span>

<span class="c1"># ì²´ì¸ë³„ íŠ¸ë ˆì´ìŠ¤ í”Œë¡¯</span>
<span class="n">fig</span><span class="p">,</span> <span class="n">axes</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">14</span><span class="p">,</span> <span class="mi">8</span><span class="p">))</span>
<span class="n">az</span><span class="o">.</span><span class="n">plot_trace</span><span class="p">(</span><span class="n">trace_diagnostic</span><span class="p">,</span> <span class="n">var_names</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;mu&#39;</span><span class="p">,</span> <span class="s1">&#39;sigma&#39;</span><span class="p">],</span> <span class="n">axes</span><span class="o">=</span><span class="n">axes</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">suptitle</span><span class="p">(</span><span class="s1">&#39;ë‹¤ì¤‘ ì²´ì¸ íŠ¸ë ˆì´ìŠ¤ í”Œë¡¯&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</code></pre></div>

<h3 id="72">7.2 ìê¸°ìƒê´€ ë¶„ì„<a class="header-link" href="#72" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><span class="c1"># ìê¸°ìƒê´€ í”Œë¡¯</span>
<span class="n">fig</span><span class="p">,</span> <span class="n">axes</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">12</span><span class="p">,</span> <span class="mi">4</span><span class="p">))</span>

<span class="n">az</span><span class="o">.</span><span class="n">plot_autocorr</span><span class="p">(</span><span class="n">trace_diagnostic</span><span class="p">,</span> <span class="n">var_names</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;mu&#39;</span><span class="p">],</span> <span class="n">ax</span><span class="o">=</span><span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
<span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;Î¼ ìê¸°ìƒê´€&#39;</span><span class="p">)</span>

<span class="n">az</span><span class="o">.</span><span class="n">plot_autocorr</span><span class="p">(</span><span class="n">trace_diagnostic</span><span class="p">,</span> <span class="n">var_names</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;sigma&#39;</span><span class="p">],</span> <span class="n">ax</span><span class="o">=</span><span class="n">axes</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
<span class="n">axes</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;Ïƒ ìê¸°ìƒê´€&#39;</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>

<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;ìê¸°ìƒê´€ì´ ë¹ ë¥´ê²Œ 0ìœ¼ë¡œ ê°ì†Œí•˜ë©´ ì¢‹ì€ í˜¼í•©ì„ ì˜ë¯¸&quot;</span><span class="p">)</span>
</code></pre></div>

<h3 id="73-ess">7.3 ìœ íš¨ í‘œë³¸ í¬ê¸° (ESS)<a class="header-link" href="#73-ess" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><span class="c1"># ESS ê³„ì‚°</span>
<span class="n">ess</span> <span class="o">=</span> <span class="n">az</span><span class="o">.</span><span class="n">ess</span><span class="p">(</span><span class="n">trace_diagnostic</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;=== ìœ íš¨ í‘œë³¸ í¬ê¸° (ESS) ===&quot;</span><span class="p">)</span>
<span class="k">for</span> <span class="n">var</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;mu&#39;</span><span class="p">,</span> <span class="s1">&#39;sigma&#39;</span><span class="p">]:</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">var</span><span class="si">}</span><span class="s2">: bulk=</span><span class="si">{</span><span class="n">ess</span><span class="p">[</span><span class="n">var</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="si">:</span><span class="s2">.0f</span><span class="si">}</span><span class="s2">, tail=</span><span class="si">{</span><span class="n">az</span><span class="o">.</span><span class="n">ess</span><span class="p">(</span><span class="n">trace_diagnostic</span><span class="p">,</span><span class="w"> </span><span class="n">method</span><span class="o">=</span><span class="s1">&#39;tail&#39;</span><span class="p">)[</span><span class="n">var</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="si">:</span><span class="s2">.0f</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">ê¶Œì¥: ESS &gt; 400 (ìµœì†Œ 100 ì´ìƒ)&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;ESSê°€ ë‚®ìœ¼ë©´ ë” ë§ì€ ìƒ˜í”Œì´ í•„ìš”í•˜ê±°ë‚˜ ëª¨ë¸/ìƒ˜í”ŒëŸ¬ ê°œì„  í•„ìš”&quot;</span><span class="p">)</span>
</code></pre></div>

<hr />
<h2 id="8">8. ì‹¤ìŠµ ì˜ˆì œ<a class="header-link" href="#8" title="Permanent link">&para;</a></h2>
<h3 id="81-hierarchical-model">8.1 ê³„ì¸µì  ëª¨ë¸ (Hierarchical Model)<a class="header-link" href="#81-hierarchical-model" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><span class="c1"># ì—¬ëŸ¬ í•™êµì˜ í•™ìƒ ì„±ì  ë°ì´í„°</span>
<span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">seed</span><span class="p">(</span><span class="mi">42</span><span class="p">)</span>

<span class="n">n_schools</span> <span class="o">=</span> <span class="mi">8</span>
<span class="n">n_students_per_school</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">randint</span><span class="p">(</span><span class="mi">15</span><span class="p">,</span> <span class="mi">30</span><span class="p">,</span> <span class="n">n_schools</span><span class="p">)</span>

<span class="c1"># ì§„ì§œ í•™êµ íš¨ê³¼</span>
<span class="n">true_school_mean</span> <span class="o">=</span> <span class="mi">70</span>
<span class="n">true_school_std</span> <span class="o">=</span> <span class="mi">5</span>
<span class="n">true_school_effects</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">normal</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">true_school_std</span><span class="p">,</span> <span class="n">n_schools</span><span class="p">)</span>
<span class="n">true_noise_std</span> <span class="o">=</span> <span class="mi">10</span>

<span class="c1"># ë°ì´í„° ìƒì„±</span>
<span class="n">schools</span> <span class="o">=</span> <span class="p">[]</span>
<span class="n">scores</span> <span class="o">=</span> <span class="p">[]</span>
<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n_schools</span><span class="p">):</span>
    <span class="n">school_mean</span> <span class="o">=</span> <span class="n">true_school_mean</span> <span class="o">+</span> <span class="n">true_school_effects</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
    <span class="n">student_scores</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">normal</span><span class="p">(</span><span class="n">school_mean</span><span class="p">,</span> <span class="n">true_noise_std</span><span class="p">,</span> <span class="n">n_students_per_school</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
    <span class="n">schools</span><span class="o">.</span><span class="n">extend</span><span class="p">([</span><span class="n">i</span><span class="p">]</span> <span class="o">*</span> <span class="n">n_students_per_school</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
    <span class="n">scores</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">student_scores</span><span class="p">)</span>

<span class="n">schools</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">schools</span><span class="p">)</span>
<span class="n">scores</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">scores</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;í•™êµ ìˆ˜: </span><span class="si">{</span><span class="n">n_schools</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;ì´ í•™ìƒ ìˆ˜: </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">scores</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;í•™êµë³„ í‰ê·  ì ìˆ˜: </span><span class="si">{</span><span class="p">[</span><span class="n">scores</span><span class="p">[</span><span class="n">schools</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">mean</span><span class="p">():</span><span class="mf">.1</span><span class="n">f</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="ow">in</span><span class="w"> </span><span class="nb">range</span><span class="p">(</span><span class="n">n_schools</span><span class="p">)]</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

<span class="c1"># ê³„ì¸µì  ëª¨ë¸</span>
<span class="k">with</span> <span class="n">pm</span><span class="o">.</span><span class="n">Model</span><span class="p">()</span> <span class="k">as</span> <span class="n">hierarchical_model</span><span class="p">:</span>
    <span class="c1"># ì´ˆëª¨ìˆ˜ (hyperparameters)</span>
    <span class="n">mu_school</span> <span class="o">=</span> <span class="n">pm</span><span class="o">.</span><span class="n">Normal</span><span class="p">(</span><span class="s1">&#39;mu_school&#39;</span><span class="p">,</span> <span class="n">mu</span><span class="o">=</span><span class="mi">70</span><span class="p">,</span> <span class="n">sigma</span><span class="o">=</span><span class="mi">20</span><span class="p">)</span>
    <span class="n">sigma_school</span> <span class="o">=</span> <span class="n">pm</span><span class="o">.</span><span class="n">HalfNormal</span><span class="p">(</span><span class="s1">&#39;sigma_school&#39;</span><span class="p">,</span> <span class="n">sigma</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span>

    <span class="c1"># í•™êµ íš¨ê³¼</span>
    <span class="n">school_effect</span> <span class="o">=</span> <span class="n">pm</span><span class="o">.</span><span class="n">Normal</span><span class="p">(</span><span class="s1">&#39;school_effect&#39;</span><span class="p">,</span> <span class="n">mu</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">sigma</span><span class="o">=</span><span class="n">sigma_school</span><span class="p">,</span> <span class="n">shape</span><span class="o">=</span><span class="n">n_schools</span><span class="p">)</span>

    <span class="c1"># ì”ì°¨ í‘œì¤€í¸ì°¨</span>
    <span class="n">sigma_residual</span> <span class="o">=</span> <span class="n">pm</span><span class="o">.</span><span class="n">HalfNormal</span><span class="p">(</span><span class="s1">&#39;sigma_residual&#39;</span><span class="p">,</span> <span class="n">sigma</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span>

    <span class="c1"># ê¸°ëŒ€ê°’</span>
    <span class="n">mu</span> <span class="o">=</span> <span class="n">mu_school</span> <span class="o">+</span> <span class="n">school_effect</span><span class="p">[</span><span class="n">schools</span><span class="p">]</span>

    <span class="c1"># ê°€ëŠ¥ë„</span>
    <span class="n">y_obs</span> <span class="o">=</span> <span class="n">pm</span><span class="o">.</span><span class="n">Normal</span><span class="p">(</span><span class="s1">&#39;y_obs&#39;</span><span class="p">,</span> <span class="n">mu</span><span class="o">=</span><span class="n">mu</span><span class="p">,</span> <span class="n">sigma</span><span class="o">=</span><span class="n">sigma_residual</span><span class="p">,</span> <span class="n">observed</span><span class="o">=</span><span class="n">scores</span><span class="p">)</span>

    <span class="c1"># ìƒ˜í”Œë§</span>
    <span class="n">trace_hier</span> <span class="o">=</span> <span class="n">pm</span><span class="o">.</span><span class="n">sample</span><span class="p">(</span><span class="mi">3000</span><span class="p">,</span> <span class="n">tune</span><span class="o">=</span><span class="mi">1500</span><span class="p">,</span> <span class="n">cores</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">random_seed</span><span class="o">=</span><span class="mi">42</span><span class="p">)</span>

<span class="c1"># ê²°ê³¼</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">=== ê³„ì¸µì  ëª¨ë¸ ê²°ê³¼ ===&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">az</span><span class="o">.</span><span class="n">summary</span><span class="p">(</span><span class="n">trace_hier</span><span class="p">,</span> <span class="n">var_names</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;mu_school&#39;</span><span class="p">,</span> <span class="s1">&#39;sigma_school&#39;</span><span class="p">,</span> <span class="s1">&#39;sigma_residual&#39;</span><span class="p">]))</span>

<span class="c1"># í•™êµ íš¨ê³¼ ë¹„êµ</span>
<span class="n">school_effects_post</span> <span class="o">=</span> <span class="n">trace_hier</span><span class="o">.</span><span class="n">posterior</span><span class="p">[</span><span class="s1">&#39;school_effect&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">dim</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;chain&#39;</span><span class="p">,</span> <span class="s1">&#39;draw&#39;</span><span class="p">])</span><span class="o">.</span><span class="n">values</span>
<span class="n">school_effects_ci</span> <span class="o">=</span> <span class="n">az</span><span class="o">.</span><span class="n">hdi</span><span class="p">(</span><span class="n">trace_hier</span><span class="p">,</span> <span class="n">var_names</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;school_effect&#39;</span><span class="p">])[</span><span class="s1">&#39;school_effect&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span>

<span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">6</span><span class="p">))</span>
<span class="n">school_ids</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">n_schools</span><span class="p">)</span>

<span class="c1"># ì‚¬í›„ í‰ê· ê³¼ ì‹ ìš©êµ¬ê°„</span>
<span class="n">ax</span><span class="o">.</span><span class="n">errorbar</span><span class="p">(</span><span class="n">school_ids</span><span class="p">,</span> <span class="n">school_effects_post</span><span class="p">,</span>
            <span class="n">yerr</span><span class="o">=</span><span class="p">[</span><span class="n">school_effects_post</span> <span class="o">-</span> <span class="n">school_effects_ci</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">],</span>
                  <span class="n">school_effects_ci</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">school_effects_post</span><span class="p">],</span>
            <span class="n">fmt</span><span class="o">=</span><span class="s1">&#39;o&#39;</span><span class="p">,</span> <span class="n">capsize</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Posterior (hierarchical)&#39;</span><span class="p">)</span>

<span class="c1"># ì‹¤ì œ íš¨ê³¼</span>
<span class="n">ax</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">school_ids</span> <span class="o">+</span> <span class="mf">0.1</span><span class="p">,</span> <span class="n">true_school_effects</span><span class="p">,</span> <span class="n">marker</span><span class="o">=</span><span class="s1">&#39;x&#39;</span><span class="p">,</span> <span class="n">s</span><span class="o">=</span><span class="mi">100</span><span class="p">,</span>
           <span class="n">color</span><span class="o">=</span><span class="s1">&#39;r&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;True effects&#39;</span><span class="p">,</span> <span class="n">zorder</span><span class="o">=</span><span class="mi">5</span><span class="p">)</span>

<span class="c1"># ê°œë³„ í•™êµ í‰ê·  (no pooling)</span>
<span class="n">school_means</span> <span class="o">=</span> <span class="p">[</span><span class="n">scores</span><span class="p">[</span><span class="n">schools</span> <span class="o">==</span> <span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span> <span class="o">-</span> <span class="n">true_school_mean</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n_schools</span><span class="p">)]</span>
<span class="n">ax</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">school_ids</span> <span class="o">-</span> <span class="mf">0.1</span><span class="p">,</span> <span class="n">school_means</span><span class="p">,</span> <span class="n">marker</span><span class="o">=</span><span class="s1">&#39;s&#39;</span><span class="p">,</span> <span class="n">s</span><span class="o">=</span><span class="mi">60</span><span class="p">,</span>
           <span class="n">color</span><span class="o">=</span><span class="s1">&#39;g&#39;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;No pooling (raw)&#39;</span><span class="p">)</span>

<span class="n">ax</span><span class="o">.</span><span class="n">axhline</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;k&#39;</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;--&#39;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.3</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;School ID&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;School Effect&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;í•™êµ íš¨ê³¼: ê³„ì¸µì  ëª¨ë¸ vs ê°œë³„ ì¶”ì •&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
<span class="n">ax</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="kc">True</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.3</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>

<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">ìˆ˜ì¶•(Shrinkage) íš¨ê³¼:&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;ê³„ì¸µì  ëª¨ë¸ì€ ê·¹ë‹¨ì ì¸ ì¶”ì •ì¹˜ë¥¼ ì „ì²´ í‰ê·  ë°©í–¥ìœ¼ë¡œ ìˆ˜ì¶•ì‹œí‚´&quot;</span><span class="p">)</span>
</code></pre></div>

<hr />
<h2 id="9">9. ì—°ìŠµ ë¬¸ì œ<a class="header-link" href="#9" title="Permanent link">&para;</a></h2>
<h3 id="1-mh">ë¬¸ì œ 1: MH ì•Œê³ ë¦¬ì¦˜ êµ¬í˜„<a class="header-link" href="#1-mh" title="Permanent link">&para;</a></h3>
<p>ë‹¤ìŒ ëª©í‘œ ë¶„í¬ì—ì„œ Metropolis-Hastingsë¡œ ìƒ˜í”Œì„ ì¶”ì¶œí•˜ì„¸ìš”:
- ëª©í‘œ: Gamma(5, 1)
- ì œì•ˆ ë¶„í¬: í˜„ì¬ ê°’ì—ì„œ Â±0.5 ê· ë“±ë¶„í¬</p>
<h3 id="2-pymc">ë¬¸ì œ 2: PyMC ëª¨ë¸ë§<a class="header-link" href="#2-pymc" title="Permanent link">&para;</a></h3>
<p>ë‹¤ìŒ ë°ì´í„°ì— ëŒ€í•´ PyMCë¡œ ë² ì´ì§€ì•ˆ ì¶”ë¡ ì„ ìˆ˜í–‰í•˜ì„¸ìš”:
- 20ê°œ ì œí’ˆ ì¤‘ 3ê°œ ë¶ˆëŸ‰
- Beta(1,1) ì‚¬ì „ë¶„í¬
- ë¶ˆëŸ‰ë¥ ì˜ ì‚¬í›„ í‰ê· ê³¼ 95% ì‹ ìš©êµ¬ê°„ ê³„ì‚°</p>
<h3 id="3">ë¬¸ì œ 3: ëª¨ë¸ ë¹„êµ<a class="header-link" href="#3" title="Permanent link">&para;</a></h3>
<p>ì„ í˜• íšŒê·€ì™€ ë‹¤í•­ íšŒê·€(2ì°¨, 3ì°¨)ë¥¼ ë¹„êµí•˜ì„¸ìš”:
- ë°ì´í„° ìƒì„±: y = 2 + 3x + 0.5xÂ² + noise
- WAICë¡œ ëª¨ë¸ ì„ íƒ
- ì‚¬í›„ ì˜ˆì¸¡ ê²€ì‚¬ ìˆ˜í–‰</p>
<h3 id="4_1">ë¬¸ì œ 4: ìˆ˜ë ´ ì§„ë‹¨<a class="header-link" href="#4_1" title="Permanent link">&para;</a></h3>
<p>ì—¬ëŸ¬ ì²´ì¸ìœ¼ë¡œ ìƒ˜í”Œë§í•˜ê³  ë‹¤ìŒì„ í™•ì¸í•˜ì„¸ìš”:
- R-hatì´ 1.01 ë¯¸ë§Œì¸ì§€
- ESSê°€ ì¶©ë¶„í•œì§€
- íŠ¸ë ˆì´ìŠ¤ í”Œë¡¯ì´ ì˜ ì„ì´ëŠ”ì§€</p>
<hr />
<h2 id="10">10. í•µì‹¬ ìš”ì•½<a class="header-link" href="#10" title="Permanent link">&para;</a></h2>
<h3 id="mcmc">MCMC í•µì‹¬<a class="header-link" href="#mcmc" title="Permanent link">&para;</a></h3>
<ol>
<li><strong>Metropolis-Hastings</strong>: ì œì•ˆ-ìˆ˜ë½/ê±°ë¶€ ë°˜ë³µ</li>
<li><strong>ìˆ˜ë½ë¥ </strong>: 20-50%ê°€ ì ì ˆ</li>
<li><strong>Burn-in</strong>: ì´ˆê¸° ë¶ˆì•ˆì •í•œ ìƒ˜í”Œ ì œê±°</li>
</ol>
<h3 id="pymc">PyMC ì›Œí¬í”Œë¡œìš°<a class="header-link" href="#pymc" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><span class="k">with</span> <span class="n">pm</span><span class="o">.</span><span class="n">Model</span><span class="p">()</span> <span class="k">as</span> <span class="n">model</span><span class="p">:</span>
    <span class="c1"># 1. ì‚¬ì „ë¶„í¬ ì •ì˜</span>
    <span class="n">theta</span> <span class="o">=</span> <span class="n">pm</span><span class="o">.</span><span class="n">Distribution</span><span class="p">(</span><span class="s1">&#39;theta&#39;</span><span class="p">,</span> <span class="o">...</span><span class="p">)</span>

    <span class="c1"># 2. ê°€ëŠ¥ë„ ì •ì˜</span>
    <span class="n">y</span> <span class="o">=</span> <span class="n">pm</span><span class="o">.</span><span class="n">Distribution</span><span class="p">(</span><span class="s1">&#39;y&#39;</span><span class="p">,</span> <span class="o">...</span><span class="p">,</span> <span class="n">observed</span><span class="o">=</span><span class="n">data</span><span class="p">)</span>

    <span class="c1"># 3. ìƒ˜í”Œë§</span>
    <span class="n">trace</span> <span class="o">=</span> <span class="n">pm</span><span class="o">.</span><span class="n">sample</span><span class="p">(</span><span class="o">...</span><span class="p">)</span>

    <span class="c1"># 4. ì‚¬í›„ ì˜ˆì¸¡</span>
    <span class="n">ppc</span> <span class="o">=</span> <span class="n">pm</span><span class="o">.</span><span class="n">sample_posterior_predictive</span><span class="p">(</span><span class="n">trace</span><span class="p">)</span>

<span class="c1"># 5. ì§„ë‹¨ ë° ìš”ì•½</span>
<span class="n">az</span><span class="o">.</span><span class="n">summary</span><span class="p">(</span><span class="n">trace</span><span class="p">)</span>
<span class="n">az</span><span class="o">.</span><span class="n">plot_trace</span><span class="p">(</span><span class="n">trace</span><span class="p">)</span>
<span class="n">az</span><span class="o">.</span><span class="n">plot_ppc</span><span class="p">(</span><span class="o">...</span><span class="p">)</span>
</code></pre></div>

<h3 id="_2">ìˆ˜ë ´ ì§„ë‹¨ ì²´í¬ë¦¬ìŠ¤íŠ¸<a class="header-link" href="#_2" title="Permanent link">&para;</a></h3>
<ul>
<li>[ ] R-hat &lt; 1.01</li>
<li>[ ] ESS &gt; 400</li>
<li>[ ] íŠ¸ë ˆì´ìŠ¤ í”Œë¡¯ì´ ì•ˆì •ì </li>
<li>[ ] ìê¸°ìƒê´€ì´ ë¹ ë¥´ê²Œ ê°ì†Œ</li>
<li>[ ] ì²´ì¸ë“¤ì´ ì˜ ì„ì„</li>
</ul>
<h3 id="_3">ë‹¤ìŒ ì¥ ë¯¸ë¦¬ë³´ê¸°<a class="header-link" href="#_3" title="Permanent link">&para;</a></h3>
<p>10ì¥ <strong>ì‹œê³„ì—´ ë¶„ì„ ê¸°ì´ˆ</strong>ì—ì„œëŠ”:
- ì‹œê³„ì—´ êµ¬ì„±ìš”ì†Œ (ì¶”ì„¸, ê³„ì ˆì„±, ì¡ìŒ)
- ì •ìƒì„±ê³¼ ë‹¨ìœ„ê·¼ ê²€ì •
- ACF/PACF ë¶„ì„
- ì‹œê³„ì—´ ë¶„í•´</p>
    </div>

    
<div class="lesson-toolbar lesson-toolbar--bottom">
    <div class="toolbar-nav toolbar-nav--prev">
        
        <a href="/study/ko/Data_Science/18_Bayesian_Statistics_Basics.html" class="nav-prev">
            <span class="nav-label">Previous</span>
            <span class="nav-title">18. ë² ì´ì§€ì•ˆ í†µê³„ ê¸°ì´ˆ (Introduction to Bayesian Statistics)</span>
        </a>
        
    </div>
    <div class="toolbar-actions">
        <button class="btn btn-copy-link" data-action="copy-link" title="Copy link">
            <span class="icon">ğŸ”—</span>
            <span class="text">Copy link</span>
        </button>
        <a href="/study/ko/Data_Science/" class="btn btn-topic-link" title="Back to topic list">
            <span class="icon">ğŸ“‹</span>
            <span class="text">Topic list</span>
        </a>
    </div>
    <div class="toolbar-nav toolbar-nav--next">
        
        <a href="/study/ko/Data_Science/20_Time_Series_Basics.html" class="nav-next">
            <span class="nav-label">Next</span>
            <span class="nav-title">20. ì‹œê³„ì—´ ë¶„ì„ ê¸°ì´ˆ (Time Series Analysis Fundamentals)</span>
        </a>
        
    </div>
</div>


    <div class="toolbar-keyboard-hint">
        <kbd>&larr;</kbd> <kbd>&rarr;</kbd> to navigate between lessons
    </div>
</article>

<!-- Scroll to top floating button -->
<button class="scroll-to-top" id="scroll-to-top" title="Scroll to top" aria-label="Scroll to top">â†‘</button>

            </div>
        </main>
    </div>

    <script src="/study/static/js/app.js"></script>
    <script>
        function switchLanguage(newLang) {
            const path = window.location.pathname;
            const base = '/study';
            const currentLang = 'ko';
            const newPath = path.replace(base + '/' + currentLang + '/', base + '/' + newLang + '/');
            window.location.href = newPath + window.location.search;
        }
    </script>
    
<script>
    document.addEventListener('DOMContentLoaded', function() {
        // Copy link - independent feedback per button
        document.querySelectorAll('[data-action="copy-link"]').forEach(function(btn) {
            btn.addEventListener('click', function() {
                navigator.clipboard.writeText(window.location.href);
                var textEl = this.querySelector('.text');
                var originalText = textEl.textContent;
                textEl.textContent = 'Copied!';
                setTimeout(function() { textEl.textContent = originalText; }, 2000);
            });
        });

        // Add copy buttons to code blocks
        document.querySelectorAll('.lesson-content pre').forEach(function(pre) {
            var copyBtn = document.createElement('button');
            copyBtn.className = 'code-copy-btn';
            copyBtn.textContent = 'Copy';
            copyBtn.addEventListener('click', function() {
                var code = pre.querySelector('code');
                var text = code ? code.textContent : pre.textContent;
                navigator.clipboard.writeText(text);
                copyBtn.textContent = 'Copied!';
                setTimeout(function() { copyBtn.textContent = 'Copy'; }, 2000);
            });
            pre.style.position = 'relative';
            pre.appendChild(copyBtn);
        });

        // Scroll to top button
        var scrollBtn = document.getElementById('scroll-to-top');
        window.addEventListener('scroll', function() {
            scrollBtn.classList.toggle('visible', window.scrollY > 300);
        });
        scrollBtn.addEventListener('click', function() {
            window.scrollTo({ top: 0, behavior: 'smooth' });
        });

        // Keyboard shortcuts: left/right arrows for lesson navigation
        document.addEventListener('keydown', function(e) {
            var tag = document.activeElement.tagName;
            if (tag === 'INPUT' || tag === 'TEXTAREA' || tag === 'SELECT') return;

            if (e.key === 'ArrowLeft') {
                var prevLink = document.querySelector('.nav-prev');
                if (prevLink) prevLink.click();
            } else if (e.key === 'ArrowRight') {
                var nextLink = document.querySelector('.nav-next');
                if (nextLink) nextLink.click();
            }
        });
    });
</script>

</body>
</html>
{% endraw %}