{% raw %}
<!DOCTYPE html>
<html lang="ko" data-theme="light">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>NoSQL 데이터 모델 - Study Materials</title>
    <link rel="stylesheet" href="/study/static/css/style.css">
    <link rel="stylesheet" href="/study/static/css/highlight.css">
    <!-- KaTeX for LaTeX math rendering -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.16.11/dist/katex.min.css">
    <script defer src="https://cdn.jsdelivr.net/npm/katex@0.16.11/dist/katex.min.js"></script>
    <script defer src="https://cdn.jsdelivr.net/npm/katex@0.16.11/dist/contrib/auto-render.min.js"
        onload="renderMathInElement(document.body, {
            delimiters: [
                {left: '$$', right: '$$', display: true},
                {left: '$', right: '$', display: false}
            ],
            throwOnError: false
        });"></script>
    
</head>
<body>
    <div class="app-container">
        <!-- Sidebar -->
        <aside class="sidebar" id="sidebar">
            <div class="sidebar-header">
                <a href="/study/ko/" class="logo">Study Materials</a>
                <button class="sidebar-toggle" id="sidebar-toggle" aria-label="Toggle sidebar">
                    <span></span>
                </button>
            </div>

            <nav class="sidebar-nav">
                <a href="/study/ko/" class="nav-item ">
                    <span class="nav-icon">🏠</span>
                    <span class="nav-text">Home</span>
                </a>
                <a href="/study/examples/" class="nav-item ">
                    <span class="nav-icon">💻</span>
                    <span class="nav-text">Examples</span>
                </a>
            </nav>

            <div class="sidebar-search">
                <form action="/study/ko/search.html" method="get" id="search-form">
                    <input type="search" name="q" placeholder="Search..." id="search-sidebar-input">
                </form>
            </div>

            <!-- Language Selector -->
            <div class="sidebar-lang">
                <select id="lang-select" class="lang-selector" onchange="switchLanguage(this.value)">
                    
                    <option value="en" >
                        English
                    </option>
                    
                    <option value="ko" selected>
                        한국어
                    </option>
                    
                </select>
            </div>

            <div class="sidebar-footer">
                <button class="theme-toggle" id="theme-toggle" aria-label="Toggle theme">
                    <span class="theme-icon light">☀️</span>
                    <span class="theme-icon dark">🌙</span>
                </button>
            </div>
        </aside>

        <!-- Main Content -->
        <main class="main-content">
            <header class="main-header">
                <button class="menu-toggle" id="menu-toggle" aria-label="Open menu">
                    <span></span>
                </button>
                
<nav class="breadcrumb">
    <a href="/study/ko/">Topics</a>
    <span class="separator">/</span>
    <a href="/study/ko/Database_Theory/">Database Theory</a>
    <span class="separator">/</span>
    <span class="current">NoSQL 데이터 모델</span>
</nav>

            </header>

            <div class="content">
                
<article class="lesson-article">
    <header class="lesson-header">
        <h1>NoSQL 데이터 모델</h1>
    </header>

    
<div class="lesson-toolbar lesson-toolbar--top">
    <div class="toolbar-nav toolbar-nav--prev">
        
        <a href="/study/ko/Database_Theory/12_Recovery_Systems.html" class="nav-prev">
            <span class="nav-label">Previous</span>
            <span class="nav-title">12. 복구 시스템</span>
        </a>
        
    </div>
    <div class="toolbar-actions">
        <button class="btn btn-copy-link" data-action="copy-link" title="Copy link">
            <span class="icon">🔗</span>
            <span class="text">Copy link</span>
        </button>
        <a href="/study/ko/Database_Theory/" class="btn btn-topic-link" title="Back to topic list">
            <span class="icon">📋</span>
            <span class="text">Topic list</span>
        </a>
    </div>
    <div class="toolbar-nav toolbar-nav--next">
        
        <a href="/study/ko/Database_Theory/14_Distributed_Databases.html" class="nav-next">
            <span class="nav-label">Next</span>
            <span class="nav-title">분산 데이터베이스</span>
        </a>
        
    </div>
</div>


    
    <nav class="toc" id="toc">
        <h2>Table of Contents</h2>
        <div class="toc">
<ul>
<li><a href="#_1">목차</a></li>
<li><a href="#1">1. 동기: 관계형 모델의 한계</a><ul>
<li><a href="#11-impedance-mismatch">1.1 임피던스 불일치(Impedance Mismatch)</a></li>
<li><a href="#12">1.2 확장성 과제</a></li>
<li><a href="#13">1.3 스키마 경직성</a></li>
<li><a href="#14-nosql">1.4 NoSQL 운동</a></li>
</ul>
</li>
<li><a href="#2-cap">2. CAP 정리</a><ul>
<li><a href="#21">2.1 진술</a></li>
<li><a href="#22">2.2 각 속성 이해</a></li>
<li><a href="#23">2.3 증명 스케치</a></li>
<li><a href="#24-cap">2.4 실제 CAP</a></li>
<li><a href="#25-pacelc">2.5 PACELC 확장</a></li>
</ul>
</li>
<li><a href="#3-base-vs-acid">3. BASE vs ACID</a><ul>
<li><a href="#31-acid">3.1 ACID 요약</a></li>
<li><a href="#32-base">3.2 BASE 속성</a></li>
<li><a href="#33">3.3 상세 비교</a></li>
<li><a href="#34">3.4 최종 일관성 모델</a></li>
</ul>
</li>
<li><a href="#4-">4. 키-값 저장소</a><ul>
<li><a href="#41">4.1 데이터 모델</a></li>
<li><a href="#42">4.2 연산</a></li>
<li><a href="#43-redis">4.3 Redis</a></li>
<li><a href="#44-amazon-dynamodb">4.4 Amazon DynamoDB</a></li>
<li><a href="#45-">4.5 키-값 저장소의 한계</a></li>
</ul>
</li>
<li><a href="#5">5. 문서 저장소</a><ul>
<li><a href="#51">5.1 데이터 모델</a></li>
<li><a href="#52-json-vs-bson">5.2 JSON vs BSON</a></li>
<li><a href="#53-mongodb">5.3 MongoDB</a></li>
<li><a href="#54">5.4 스키마 설계 패턴</a></li>
<li><a href="#55-mongodb">5.5 MongoDB의 인덱싱</a></li>
<li><a href="#56">5.6 문서 저장소의 한계</a></li>
</ul>
</li>
<li><a href="#6">6. 와이드 컬럼 저장소</a><ul>
<li><a href="#61">6.1 데이터 모델</a></li>
<li><a href="#62-cassandra">6.2 Cassandra</a></li>
<li><a href="#63-hbase">6.3 HBase</a></li>
<li><a href="#64">6.4 와이드 컬럼 저장소 사용 사례</a></li>
<li><a href="#65">6.5 한계</a></li>
</ul>
</li>
<li><a href="#7">7. 그래프 데이터베이스</a><ul>
<li><a href="#71">7.1 속성 그래프 모델</a></li>
<li><a href="#72">7.2 왜 그래프인가?</a></li>
<li><a href="#73-cypher">7.3 Cypher 쿼리 언어</a></li>
<li><a href="#74">7.4 그래프 사용 사례</a></li>
<li><a href="#75">7.5 그래프 데이터베이스의 한계</a></li>
</ul>
</li>
<li><a href="#8">8. 비교 매트릭스: 어떤 모델을 사용할지</a><ul>
<li><a href="#81">8.1 결정 매트릭스</a></li>
<li><a href="#82">8.2 결정 플로우차트</a></li>
<li><a href="#83">8.3 구체적 권장사항</a></li>
</ul>
</li>
<li><a href="#9">9. 폴리글랏 지속성</a><ul>
<li><a href="#91">9.1 정의</a></li>
<li><a href="#92">9.2 아키텍처 예제</a></li>
<li><a href="#93">9.3 이점</a></li>
<li><a href="#94">9.4 과제</a></li>
<li><a href="#95">9.5 과제 완화</a></li>
<li><a href="#96">9.6 폴리글랏 지속성을 사용하지 말아야 할 때</a></li>
</ul>
</li>
<li><a href="#10">10. 연습문제</a><ul>
<li><a href="#1-cap">연습문제 1: CAP 정리 분석</a></li>
<li><a href="#2">연습문제 2: 데이터 모델 선택</a></li>
<li><a href="#3-redis">연습문제 3: Redis 설계</a></li>
<li><a href="#4-mongodb">연습문제 4: MongoDB 스키마 설계</a></li>
<li><a href="#5-cassandra">연습문제 5: Cassandra 데이터 모델링</a></li>
<li><a href="#6-cypher">연습문제 6: Cypher 쿼리</a></li>
<li><a href="#7_1">연습문제 7: 폴리글랏 지속성 설계</a></li>
<li><a href="#8-cap">연습문제 8: CAP 정리 증명 확장</a></li>
<li><a href="#9_1">연습문제 9: 일관성 모델 분류</a></li>
<li><a href="#10_1">연습문제 10: 비교 분석</a></li>
</ul>
</li>
<li><a href="#11">11. 참고문헌</a></li>
</ul>
</div>

    </nav>
    

    <div class="lesson-content markdown-body">
        <h1 id="nosql">NoSQL 데이터 모델<a class="header-link" href="#nosql" title="Permanent link">&para;</a></h1>
<p><strong>이전</strong>: <a href="./12_Concurrency_Control.md">12. 동시성 제어</a> | <strong>다음</strong>: <a href="./14_Distributed_Databases.md">14. 분산 데이터베이스</a></p>
<hr />
<p>관계형 모델은 Codd의 1970년 획기적인 논문 이후 데이터 관리의 지배적인 패러다임으로 자리잡았습니다. 그러나 인터넷이 수천 명의 사용자에서 수십억 명으로 진화하고, 데이터가 메가바이트에서 페타바이트로 증가하면서, 실무자들은 관계형 모델의 엄격한 보장이 자산이 아닌 부채가 되는 시나리오를 발견했습니다. 이 레슨에서는 NoSQL 혁명을 탐구합니다: 왜 발생했는지, 어떤 모델이 등장했는지, 그리고 주어진 문제에 적합한 데이터 모델을 선택하는 방법을 다룹니다.</p>
<p><strong>난이도</strong>: ⭐⭐⭐</p>
<p><strong>학습 목표</strong>:
- 관계형 모델이 웹 스케일에서 어려움을 겪는 이유 설명
- CAP 정리와 형식적 증명 스케치를 진술하고 해석
- BASE와 ACID 일관성 모델 대조
- 키-값, 문서, 와이드 컬럼, 그래프 패러다임을 사용하여 데이터 모델 설계
- 각 NoSQL 패러다임에서 기본 쿼리 작성
- 적절한 데이터 모델을 선택하기 위한 의사결정 프레임워크 적용
- 폴리글랏 지속성(Polyglot Persistence)과 그 아키텍처적 함의 이해</p>
<hr />
<h2 id="_1">목차<a class="header-link" href="#_1" title="Permanent link">&para;</a></h2>
<ol>
<li><a href="#1-동기-관계형-모델의-한계">동기: 관계형 모델의 한계</a></li>
<li><a href="#2-cap-정리">CAP 정리</a></li>
<li><a href="#3-base-vs-acid">BASE vs ACID</a></li>
<li><a href="#4-키-값-저장소">키-값 저장소</a></li>
<li><a href="#5-문서-저장소">문서 저장소</a></li>
<li><a href="#6-와이드-컬럼-저장소">와이드 컬럼 저장소</a></li>
<li><a href="#7-그래프-데이터베이스">그래프 데이터베이스</a></li>
<li><a href="#8-비교-매트릭스-어떤-모델을-사용할지">비교 매트릭스: 어떤 모델을 사용할지</a></li>
<li><a href="#9-폴리글랏-지속성">폴리글랏 지속성</a></li>
<li><a href="#10-연습문제">연습문제</a></li>
<li><a href="#11-참고문헌">참고문헌</a></li>
</ol>
<hr />
<h2 id="1">1. 동기: 관계형 모델의 한계<a class="header-link" href="#1" title="Permanent link">&para;</a></h2>
<h3 id="11-impedance-mismatch">1.1 임피던스 불일치(Impedance Mismatch)<a class="header-link" href="#11-impedance-mismatch" title="Permanent link">&para;</a></h3>
<p>관계형 데이터베이스는 데이터를 평평한 2차원 테이블에 저장합니다. 그러나 현대 애플리케이션은 풍부하고 중첩된 객체를 다룹니다: 전자상거래 애플리케이션의 단일 "주문"에는 품목, 배송 주소, 결제 세부사항, 프로모션 코드가 포함됩니다. 이러한 계층적 객체를 정규화된 테이블에 매핑하려면 읽기 시점에는 복잡한 JOIN 작업이 필요하고 쓰기 시점에는 여러 테이블 INSERT 작업이 필요합니다.</p>
<div class="highlight"><pre><span></span><code><span class="nx">애플리케이션</span><span class="w"> </span><span class="nx">객체</span><span class="w">              </span><span class="nx">관계형</span><span class="w"> </span><span class="nx">테이블</span>
<span class="err">┌──────────────────┐</span><span class="w">            </span><span class="err">┌──────────┐</span><span class="w">   </span><span class="err">┌────────────┐</span>
<span class="err">│</span><span class="w"> </span><span class="nx">Order</span><span class="w">             </span><span class="err">│</span><span class="w">            </span><span class="err">│</span><span class="w"> </span><span class="nx">orders</span><span class="w">   </span><span class="err">│</span><span class="w">   </span><span class="err">│</span><span class="w"> </span><span class="nx">line_items</span><span class="w"> </span><span class="err">│</span>
<span class="err">│</span><span class="w">  </span><span class="err">├─</span><span class="w"> </span><span class="nx">customer</span><span class="w">      </span><span class="err">│</span><span class="w">    </span><span class="err">──▶</span><span class="w">    </span><span class="err">├──────────┤</span><span class="w">   </span><span class="err">├────────────┤</span>
<span class="err">│</span><span class="w">  </span><span class="err">├─</span><span class="w"> </span><span class="nx">items</span><span class="p">[]</span><span class="w">       </span><span class="err">│</span><span class="w">            </span><span class="err">│</span><span class="w"> </span><span class="nx">order_id</span><span class="w"> </span><span class="err">│──▶│</span><span class="w"> </span><span class="nx">order_id</span><span class="w">   </span><span class="err">│</span>
<span class="err">│</span><span class="w">  </span><span class="err">├─</span><span class="w"> </span><span class="nx">shipping_addr</span><span class="w"> </span><span class="err">│</span><span class="w">            </span><span class="err">│</span><span class="w"> </span><span class="nx">cust_id</span><span class="w">  </span><span class="err">│</span><span class="w">   </span><span class="err">│</span><span class="w"> </span><span class="nx">product_id</span><span class="w"> </span><span class="err">│</span>
<span class="err">│</span><span class="w">  </span><span class="err">└─</span><span class="w"> </span><span class="nx">payment</span><span class="w">       </span><span class="err">│</span><span class="w">            </span><span class="err">│</span><span class="w"> </span><span class="nx">total</span><span class="w">    </span><span class="err">│</span><span class="w">   </span><span class="err">│</span><span class="w"> </span><span class="nx">quantity</span><span class="w">   </span><span class="err">│</span>
<span class="err">└──────────────────┘</span><span class="w">            </span><span class="err">└──────────┘</span><span class="w">   </span><span class="err">└────────────┘</span>
<span class="w">                                      </span><span class="err">│</span>
<span class="w">                                      </span><span class="err">▼</span>
<span class="w">                                </span><span class="err">┌──────────────┐</span><span class="w">   </span><span class="err">┌──────────┐</span>
<span class="w">                                </span><span class="err">│</span><span class="w"> </span><span class="nx">addresses</span><span class="w">    </span><span class="err">│</span><span class="w">   </span><span class="err">│</span><span class="w"> </span><span class="nx">payments</span><span class="w"> </span><span class="err">│</span>
<span class="w">                                </span><span class="err">├──────────────┤</span><span class="w">   </span><span class="err">├──────────┤</span>
<span class="w">                                </span><span class="err">│</span><span class="w"> </span><span class="nx">order_id</span><span class="w">     </span><span class="err">│</span><span class="w">   </span><span class="err">│</span><span class="w"> </span><span class="nx">order_id</span><span class="w"> </span><span class="err">│</span>
<span class="w">                                </span><span class="err">│</span><span class="w"> </span><span class="nx">street</span><span class="w">       </span><span class="err">│</span><span class="w">   </span><span class="err">│</span><span class="w"> </span><span class="nx">method</span><span class="w">   </span><span class="err">│</span>
<span class="w">                                </span><span class="err">│</span><span class="w"> </span><span class="nx">city</span><span class="w">         </span><span class="err">│</span><span class="w">   </span><span class="err">│</span><span class="w"> </span><span class="nx">amount</span><span class="w">   </span><span class="err">│</span>
<span class="w">                                </span><span class="err">└──────────────┘</span><span class="w">   </span><span class="err">└──────────┘</span>
</code></pre></div>

<p>애플리케이션의 객체 모델과 데이터베이스의 관계형 모델 사이의 이러한 "임피던스 불일치"는 코드 복잡성, 개발 시간, 런타임 성능에서 오버헤드를 발생시킵니다.</p>
<h3 id="12">1.2 확장성 과제<a class="header-link" href="#12" title="Permanent link">&para;</a></h3>
<p>관계형 데이터베이스는 수직 확장(더 큰 기계)을 위해 설계되었습니다. 더 많은 용량이 필요할 때 더 빠른 CPU, 더 많은 RAM, 또는 더 빠른 디스크를 구매합니다. 이 접근법에는 엄격한 한계가 있습니다:</p>
<table>
<thead>
<tr>
<th>확장 차원</th>
<th>수직 (Scale Up)</th>
<th>수평 (Scale Out)</th>
</tr>
</thead>
<tbody>
<tr>
<td><strong>접근법</strong></td>
<td>더 큰 기계</td>
<td>더 많은 기계</td>
</tr>
<tr>
<td><strong>비용 곡선</strong></td>
<td>지수적</td>
<td>선형</td>
</tr>
<tr>
<td><strong>이론적 한계</strong></td>
<td>하드웨어 상한</td>
<td>사실상 무제한</td>
</tr>
<tr>
<td><strong>업그레이드 다운타임</strong></td>
<td>일반적으로 필요</td>
<td>롤링 업그레이드</td>
</tr>
<tr>
<td><strong>관계형 DB 지원</strong></td>
<td>자연스러운 적합</td>
<td>매우 어려움</td>
</tr>
<tr>
<td><strong>NoSQL 지원</strong></td>
<td>가능</td>
<td>자연스러운 적합</td>
</tr>
</tbody>
</table>
<p>수평 확장은 여러 노드에 데이터를 분산해야 하며, 이는 근본적으로 여러 관계형 보장과 충돌합니다:</p>
<ul>
<li><strong>파티션 간 JOIN</strong>은 예측 불가능한 지연 시간을 갖는 네트워크 작업이 됩니다.</li>
<li><strong>분산 트랜잭션</strong>은 처리량을 감소시키는 복잡한 조정 프로토콜(2PC)이 필요합니다.</li>
<li>수백 개의 노드에 걸쳐 수십억 행에 대한 <strong>스키마 변경</strong>(ALTER TABLE)은 운영상 위험합니다.</li>
</ul>
<h3 id="13">1.3 스키마 경직성<a class="header-link" href="#13" title="Permanent link">&para;</a></h3>
<p>관계형 데이터베이스는 엄격한 스키마를 강제합니다: 테이블의 모든 행은 동일한 컬럼을 갖습니다. 애자일 개발에서 요구사항은 자주 변경됩니다. 각 스키마 변경에는 다음이 필요합니다:</p>
<ol>
<li>마이그레이션 스크립트 작성</li>
<li>프로덕션 크기 데이터에 대한 마이그레이션 테스트</li>
<li>애플리케이션 코드 변경과의 배포 조정</li>
<li>ALTER TABLE 작업 중 잠재적으로 테이블 잠금</li>
</ol>
<p>빠르게 진화하는 데이터 모델을 가진 애플리케이션(소셜 미디어 피드, IoT 센서 데이터, 콘텐츠 관리)의 경우, 이 경직성은 상당한 운영 오버헤드를 부과합니다.</p>
<h3 id="14-nosql">1.4 NoSQL 운동<a class="header-link" href="#14-nosql" title="Permanent link">&para;</a></h3>
<p>"NoSQL"이라는 용어는 2009년경에 등장했으며, 처음에는 "Not Only SQL"의 약자로 이러한 시스템이 관계형 데이터베이스를 대체하기보다는 보완함을 강조했습니다. 주요 동기는 다음과 같았습니다:</p>
<ul>
<li><strong>수평 확장성</strong>: 상용 하드웨어에 데이터 분산</li>
<li><strong>유연한 스키마</strong>: 마이그레이션 없이 변화하는 데이터 구조에 적응</li>
<li><strong>높은 가용성</strong>: 노드 장애 시에도 운영 유지</li>
<li><strong>성능</strong>: 범용 쿼리가 아닌 특정 액세스 패턴에 최적화</li>
<li><strong>개발자 생산성</strong>: 애플리케이션 객체와 일치하는 형식으로 데이터 저장</li>
</ul>
<blockquote>
<p><strong>역사적 참고</strong>: Google의 Bigtable 논문(2006)과 Amazon의 Dynamo 논문(2007)은 NoSQL 운동의 기초 논문으로 간주됩니다. 이들은 관계형 보장을 완화하면 이전에는 불가능했던 성능과 확장성을 달성할 수 있음을 입증했습니다.</p>
</blockquote>
<hr />
<h2 id="2-cap">2. CAP 정리<a class="header-link" href="#2-cap" title="Permanent link">&para;</a></h2>
<h3 id="21">2.1 진술<a class="header-link" href="#21" title="Permanent link">&para;</a></h3>
<p>Eric Brewer가 2000년에 공식화하고 Gilbert와 Lynch가 2002년에 형식적으로 증명한 CAP 정리는 다음을 명시합니다:</p>
<blockquote>
<p><strong>CAP 정리</strong>: 분산 데이터 저장소에서 다음 세 가지 속성을 모두 동시에 보장하는 것은 불가능합니다:
- <strong>일관성(Consistency, C)</strong>: 모든 읽기는 가장 최근의 쓰기 또는 오류를 받습니다.
- <strong>가용성(Availability, A)</strong>: 모든 요청은 가장 최근의 쓰기를 포함한다는 보장 없이 (오류가 아닌) 응답을 받습니다.
- <strong>파티션 허용성(Partition Tolerance, P)</strong>: 노드 간 네트워크에서 임의 수의 메시지가 손실되거나 지연되더라도 시스템이 계속 작동합니다.</p>
</blockquote>
<div class="highlight"><pre><span></span><code>                    ┌─────────────────┐
                    │   Consistency   │
                    │       (C)       │
                    └────────┬────────┘
                             │
                   CA        │        CP
               (분산         │    (가용성
               시스템에서    │    희생)
               불가능)       │
                             │
        ┌────────────────────┼────────────────────┐
        │                    │                    │
   ┌────┴─────┐                            ┌─────┴─────┐
   │Availability│                           │ Partition │
   │    (A)    │                            │ Tolerance │
   │           │                            │    (P)    │
   └────┬──────┘                            └─────┬─────┘
        │                                         │
        └──────────────── AP ─────────────────────┘
                    (일관성
                     희생)
</code></pre></div>

<h3 id="22">2.2 각 속성 이해<a class="header-link" href="#22" title="Permanent link">&para;</a></h3>
<p><strong>일관성(Consistency)</strong> (선형화 가능성): 클라이언트 A가 키 <code>k</code>에 값 <code>v</code>를 쓰면, 이후 모든 클라이언트에 의한 <code>k</code>의 읽기는 <code>v</code>(또는 더 최근의 값)를 반환해야 합니다. 이것이 선형화 가능 일관성 -- 가장 강력한 형태입니다. 시스템이 마치 데이터의 단일 복사본이 있는 것처럼 동작함을 의미합니다.</p>
<p><strong>가용성(Availability)</strong>: 장애가 없는 노드가 받은 모든 요청은 응답을 발생시켜야 합니다. 시스템은 상태에 대해 확실하지 않을 때 요청을 무시하거나 오류를 반환할 수 없습니다.</p>
<p><strong>파티션 허용성(Partition Tolerance)</strong>: 네트워크 파티션은 노드 간 메시지가 손실되거나 임의로 지연될 때 발생합니다. 모든 실제 분산 시스템에서 네트워크 파티션은 불가피합니다(케이블이 끊어지고, 스위치가 고장나고, 데이터센터가 연결성을 잃습니다). 따라서 P는 실제로 선택 사항이 아닙니다.</p>
<h3 id="23">2.3 증명 스케치<a class="header-link" href="#23" title="Permanent link">&para;</a></h3>
<p>Gilbert와 Lynch(2002)의 증명은 모순을 통해 진행됩니다:</p>
<p><strong>설정</strong>: 네트워크로 연결된 가장 간단한 분산 시스템, 두 개의 노드 N1과 N2를 고려합니다. 두 노드 모두 변수 <code>v</code>의 복사본을 저장하며, 초기값은 <code>v0</code>입니다.</p>
<p><strong>가정</strong>: 시스템이 세 가지 속성 모두를 보장합니다: C, A, P.</p>
<p><strong>단계 1</strong>: N1과 N2 사이에 네트워크 파티션이 발생합니다. N1에서 N2로(그 반대도) 보낸 메시지가 손실됩니다. P에 의해 시스템은 계속 작동해야 합니다.</p>
<p><strong>단계 2</strong>: 클라이언트가 N1에 쓰기 요청을 보내 <code>v = v1</code>로 설정합니다. A에 의해 N1은 이 쓰기를 수락하고 클라이언트에 응답해야 합니다. 그러나 파티션 때문에 N1은 이 업데이트를 N2에 전파할 수 없습니다.</p>
<p><strong>단계 3</strong>: 다른 클라이언트가 <code>v</code>의 값을 위해 N2에 읽기 요청을 보냅니다. A에 의해 N2는 응답해야 합니다. N2가 가진 유일한 값은 <code>v0</code>(이전 값)입니다. N1의 업데이트가 파티션에서 손실되었기 때문입니다.</p>
<p><strong>단계 4</strong>: N2는 <code>v0</code>를 반환하지만, 가장 최근의 쓰기는 <code>v1</code>입니다. 이는 C(선형화 가능성)를 위반합니다.</p>
<p><strong>모순</strong>: C, A, P를 가정했지만 C의 위반을 도출했습니다. 따라서 세 가지를 동시에 보장하는 것은 불가능합니다.</p>
<div class="highlight"><pre><span></span><code>    N1                          N2
    ┌──┐                       ┌──┐
    │v0│                       │v0│    초기 상태
    └──┘                       └──┘
     │                          │
     │    ╳╳╳ PARTITION ╳╳╳    │     네트워크 파티션
     │                          │
   write(v1)                    │
     │                          │
    ┌──┐                       ┌──┐
    │v1│    복제 불가           │v0│    N1 업데이트, N2 오래됨
    └──┘    ──────╳──────▶     └──┘
                                │
                             read(v) → v0 반환  ← C 위반
</code></pre></div>

<h3 id="24-cap">2.4 실제 CAP<a class="header-link" href="#24-cap" title="Permanent link">&para;</a></h3>
<p>네트워크 파티션이 분산 시스템에서 불가피하기 때문에, 실제 선택은 다음 사이입니다:</p>
<ul>
<li>
<p><strong>CP 시스템</strong>: 파티션 중 가용성을 희생합니다. 파티션이 발생하면 시스템은 일관성을 유지하기 위해 일부 요청을 거부할 수 있습니다. 예: HBase, MongoDB(다수 읽기 관심 수준), etcd, ZooKeeper.</p>
</li>
<li>
<p><strong>AP 시스템</strong>: 파티션 중 일관성을 희생합니다. 파티션이 발생하면 시스템은 계속 요청을 처리하지만 오래된 데이터를 반환할 수 있습니다. 예: Cassandra, DynamoDB, CouchDB, Riak.</p>
</li>
</ul>
<p><strong>중요한 뉘앙스</strong>:</p>
<ol>
<li>
<p><strong>CAP는 파티션 중의 동작에만 관한 것입니다.</strong> 파티션이 없을 때 시스템은 C와 A를 모두 제공할 수 있습니다.</p>
</li>
<li>
<p><strong>일관성은 스펙트럼입니다.</strong> 엄격한 선형화 가능성과 최종 일관성 사이에는 많은 중간 수준이 있습니다(인과 일관성, read-your-writes, 단조 읽기).</p>
</li>
<li>
<p><strong>선택은 작업별이지 시스템별이 아닙니다.</strong> 단일 데이터베이스가 다른 작업에 대해 다른 일관성 보장을 제공할 수 있습니다. 예를 들어, MongoDB는 쿼리별로 <code>readConcern: "majority"</code>(CP) 또는 <code>readConcern: "local"</code>(AP)를 선택할 수 있습니다.</p>
</li>
</ol>
<h3 id="25-pacelc">2.5 PACELC 확장<a class="header-link" href="#25-pacelc" title="Permanent link">&para;</a></h3>
<p>Daniel Abadi는 PACELC 정리를 개선안으로 제안했습니다:</p>
<blockquote>
<p><strong>PACELC</strong>: <strong>P</strong>artition이 있으면 <strong>A</strong>vailability와 <strong>C</strong>onsistency 중 선택; <strong>E</strong>lse(시스템이 정상 작동 중일 때) <strong>L</strong>atency와 <strong>C</strong>onsistency 중 선택.</p>
</blockquote>
<table>
<thead>
<tr>
<th>시스템</th>
<th>P → A or C?</th>
<th>E → L or C?</th>
<th>분류</th>
</tr>
</thead>
<tbody>
<tr>
<td>DynamoDB</td>
<td>A</td>
<td>L</td>
<td>PA/EL</td>
</tr>
<tr>
<td>Cassandra</td>
<td>A</td>
<td>L</td>
<td>PA/EL</td>
</tr>
<tr>
<td>MongoDB</td>
<td>C</td>
<td>C</td>
<td>PC/EC</td>
</tr>
<tr>
<td>HBase</td>
<td>C</td>
<td>C</td>
<td>PC/EC</td>
</tr>
<tr>
<td>PNUTS (Yahoo)</td>
<td>A</td>
<td>C</td>
<td>PA/EC</td>
</tr>
<tr>
<td>Spanner</td>
<td>C</td>
<td>C</td>
<td>PC/EC</td>
</tr>
</tbody>
</table>
<p>이는 파티션이 없을 때도 시스템이 지연 시간-일관성 트레이드오프를 만든다는 관찰을 포착합니다.</p>
<hr />
<h2 id="3-base-vs-acid">3. BASE vs ACID<a class="header-link" href="#3-base-vs-acid" title="Permanent link">&para;</a></h2>
<p><a href="./11_Transaction_Theory.md">레슨 11</a>에서 ACID를 자세히 다뤘습니다. 이제 대부분의 NoSQL 시스템이 채택하는 BASE 모델과 대조해 봅시다.</p>
<h3 id="31-acid">3.1 ACID 요약<a class="header-link" href="#31-acid" title="Permanent link">&para;</a></h3>
<table>
<thead>
<tr>
<th>속성</th>
<th>의미</th>
</tr>
</thead>
<tbody>
<tr>
<td><strong>원자성(Atomicity)</strong></td>
<td>트랜잭션의 모든 작업이 성공하거나 모두 실패</td>
</tr>
<tr>
<td><strong>일관성(Consistency)</strong></td>
<td>트랜잭션이 데이터베이스를 하나의 유효한 상태에서 다른 상태로 이동</td>
</tr>
<tr>
<td><strong>격리성(Isolation)</strong></td>
<td>동시 트랜잭션은 서로 간섭하지 않음</td>
</tr>
<tr>
<td><strong>지속성(Durability)</strong></td>
<td>커밋되면 데이터는 시스템 장애에도 살아남음</td>
</tr>
</tbody>
</table>
<h3 id="32-base">3.2 BASE 속성<a class="header-link" href="#32-base" title="Permanent link">&para;</a></h3>
<p>BASE는 Eric Brewer가 ACID의 대립으로 제안한 역약어(backronym)입니다:</p>
<table>
<thead>
<tr>
<th>속성</th>
<th>의미</th>
</tr>
</thead>
<tbody>
<tr>
<td><strong>기본적으로 가용(Basically Available)</strong></td>
<td>시스템은 가용성(CAP 의미에서)을 보장</td>
</tr>
<tr>
<td><strong>소프트 상태(Soft state)</strong></td>
<td>최종 일관성 전파로 인해 입력 없이도 시스템의 상태가 시간이 지나면서 변할 수 있음</td>
</tr>
<tr>
<td><strong>최종적으로 일관됨(Eventually consistent)</strong></td>
<td>새로운 업데이트 없이 충분한 시간이 주어지면, 모든 복제본은 동일한 상태로 수렴</td>
</tr>
</tbody>
</table>
<h3 id="33">3.3 상세 비교<a class="header-link" href="#33" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code>          ACID                                    BASE
┌──────────────────────┐            ┌──────────────────────┐
│ 강한 일관성           │            │ 최종 일관성           │
│ 비관적 잠금           │            │ 낙관적 복제           │
│ 중앙집중식            │            │ 분산                  │
│ 스키마 우선           │            │ 스키마 유연           │
│ Scale up              │            │ Scale out             │
│ 복잡한 쿼리 지원      │            │ 단순 쿼리 패턴        │
│ 낮은 가용성           │            │ 높은 가용성           │
│ 높은 지연(2PC)        │            │ 낮은 지연             │
└──────────────────────┘            └──────────────────────┘
</code></pre></div>

<table>
<thead>
<tr>
<th>차원</th>
<th>ACID</th>
<th>BASE</th>
</tr>
</thead>
<tbody>
<tr>
<td><strong>목표</strong></td>
<td>무엇보다 정확성</td>
<td>무엇보다 가용성</td>
</tr>
<tr>
<td><strong>읽기</strong></td>
<td>항상 최신 쓰기 확인</td>
<td>오래된 데이터를 볼 수 있음</td>
</tr>
<tr>
<td><strong>충돌 해결</strong></td>
<td>충돌 방지(잠금)</td>
<td>충돌 감지 및 해결(CRDT, LWW)</td>
</tr>
<tr>
<td><strong>애플리케이션 복잡성</strong></td>
<td>단순(DB가 일관성 처리)</td>
<td>복잡(앱이 충돌 처리)</td>
</tr>
<tr>
<td><strong>사용 사례</strong></td>
<td>은행, 재고, 예약</td>
<td>소셜 피드, 분석, 캐싱</td>
</tr>
</tbody>
</table>
<h3 id="34">3.4 최종 일관성 모델<a class="header-link" href="#34" title="Permanent link">&para;</a></h3>
<p>"최종적으로 일관됨"은 단일 모델이 아니라 일관성 보장의 집합입니다:</p>
<table>
<thead>
<tr>
<th>모델</th>
<th>보장</th>
</tr>
</thead>
<tbody>
<tr>
<td><strong>강한 최종 일관성(Strong eventual consistency)</strong></td>
<td>동일한 업데이트 집합을 받은 복제본은 동일한 상태(충돌 없음)</td>
</tr>
<tr>
<td><strong>인과 일관성(Causal consistency)</strong></td>
<td>작업 A가 인과적으로 B에 선행하면, 모든 노드는 A를 B 전에 봄</td>
</tr>
<tr>
<td><strong>Read-your-writes</strong></td>
<td>프로세스는 항상 자신의 쓰기를 봄</td>
</tr>
<tr>
<td><strong>단조 읽기(Monotonic reads)</strong></td>
<td>프로세스가 값 v를 읽으면, 후속 읽기는 v보다 오래된 값을 반환하지 않음</td>
</tr>
<tr>
<td><strong>단조 쓰기(Monotonic writes)</strong></td>
<td>프로세스의 쓰기는 모든 복제본에서 순서대로 적용</td>
</tr>
<tr>
<td><strong>세션 일관성(Session consistency)</strong></td>
<td>세션 내에서 read-your-writes + 단조 읽기</td>
</tr>
</tbody>
</table>
<hr />
<h2 id="4-">4. 키-값 저장소<a class="header-link" href="#4-" title="Permanent link">&para;</a></h2>
<h3 id="41">4.1 데이터 모델<a class="header-link" href="#41" title="Permanent link">&para;</a></h3>
<p>키-값 저장소는 가장 간단한 NoSQL 데이터 모델입니다. 본질적으로 분산 해시 테이블입니다:</p>
<div class="highlight"><pre><span></span><code>┌─────────────────────────────────────────────────┐
│<span class="w">                  </span>키-값<span class="w"> </span>저장소<span class="w">                    </span>│
│<span class="w">                                                 </span>│
│<span class="w">   </span>키<span class="w"> </span>(문자열)<span class="w">          </span>값<span class="w"> </span>(불투명<span class="w"> </span>블롭)<span class="w">          </span>│
│<span class="w">   </span>─────────────<span class="w">         </span>───────────────────<span class="w">     </span>│
│<span class="w">   </span>&quot;user:1001&quot;<span class="w">     </span>→<span class="w">     </span>{&quot;name&quot;:<span class="w"> </span>&quot;Alice&quot;,<span class="w"> </span>...}<span class="w">  </span>│
│<span class="w">   </span>&quot;session:abc&quot;<span class="w">   </span>→<span class="w">     </span>{token_data...}<span class="w">         </span>│
│<span class="w">   </span>&quot;cache:page:42&quot;<span class="w"> </span>→<span class="w">     </span>&quot;<span class="nt">&lt;html&gt;</span>...<span class="nt">&lt;/html&gt;</span>&quot;<span class="w">      </span>│
│<span class="w">   </span>&quot;counter:views&quot;<span class="w"> </span>→<span class="w">     </span>&quot;1547382&quot;<span class="w">               </span>│
│<span class="w">                                                 </span>│
└─────────────────────────────────────────────────┘
</code></pre></div>

<p><strong>특성</strong>:
- <strong>키</strong>는 고유한 문자열(또는 바이트 배열)
- <strong>값</strong>은 불투명 블롭 -- 저장소는 내용을 해석하지 않음
- <strong>연산</strong>은 단순: GET, PUT, DELETE (그리고 때때로 원자적 증가, TTL)
- <strong>보조 인덱스 없음</strong> (별도 기능으로 추가되지 않는 한)
- <strong>JOIN, 집계, 복잡한 쿼리 없음</strong></p>
<h3 id="42">4.2 연산<a class="header-link" href="#42" title="Permanent link">&para;</a></h3>
<p>API는 의도적으로 최소화되었습니다:</p>
<div class="highlight"><pre><span></span><code># 기본 연산
PUT(key, value)         # 키-값 쌍 저장
GET(key) → value        # 키로 값 검색
DELETE(key)             # 키-값 쌍 제거

# 확장 연산 (벤더별)
EXISTS(key) → bool      # 키 존재 확인
EXPIRE(key, ttl)        # 생존 시간 설정
INCR(key)               # 원자적 증가
MGET(key1, key2, ...)   # 일괄 검색
</code></pre></div>

<h3 id="43-redis">4.3 Redis<a class="header-link" href="#43-redis" title="Permanent link">&para;</a></h3>
<p>Redis(Remote Dictionary Server)는 풍부한 데이터 구조를 지원하는 인메모리 키-값 저장소입니다.</p>
<p><strong>Redis의 데이터 구조</strong>:</p>
<div class="highlight"><pre><span></span><code>┌───────────────────────────────────────────────────────┐
│  Redis 데이터 타입                                     │
│                                                       │
│  STRING:  &quot;hello&quot;                                     │
│  LIST:    [a, b, c, d]                                │
│  SET:     {a, b, c}                                   │
│  SORTED SET: {(a,1.0), (b,2.5), (c,3.7)}            │
│  HASH:    {field1: val1, field2: val2}                │
│  BITMAP:  01101001...                                 │
│  STREAM:  [(id1, {k:v}), (id2, {k:v}), ...]         │
│  GEOSPATIAL: {(member, lat, lon), ...}                │
└───────────────────────────────────────────────────────┘
</code></pre></div>

<p><strong>Redis 세션 예제</strong>:</p>
<div class="highlight"><pre><span></span><code><span class="err">#</span><span class="w"> </span><span class="n">문자열</span>
<span class="k">SET</span><span class="w"> </span><span class="k">user</span><span class="err">:</span><span class="mi">1001</span><span class="err">:</span><span class="n">name</span><span class="w"> </span><span class="ss">&quot;Alice&quot;</span>
<span class="k">GET</span><span class="w"> </span><span class="k">user</span><span class="err">:</span><span class="mi">1001</span><span class="err">:</span><span class="n">name</span><span class="w">                    </span><span class="err">#</span><span class="w"> </span><span class="err">→</span><span class="w"> </span><span class="ss">&quot;Alice&quot;</span>

<span class="err">#</span><span class="w"> </span><span class="n">해시</span><span class="w"> </span><span class="p">(</span><span class="n">미니</span><span class="w"> </span><span class="n">문서처럼</span><span class="p">)</span>
<span class="n">HSET</span><span class="w"> </span><span class="k">user</span><span class="err">:</span><span class="mi">1001</span><span class="w"> </span><span class="n">name</span><span class="w"> </span><span class="ss">&quot;Alice&quot;</span><span class="w"> </span><span class="n">email</span><span class="w"> </span><span class="ss">&quot;alice@example.com&quot;</span><span class="w"> </span><span class="n">age</span><span class="w"> </span><span class="ss">&quot;30&quot;</span>
<span class="n">HGET</span><span class="w"> </span><span class="k">user</span><span class="err">:</span><span class="mi">1001</span><span class="w"> </span><span class="n">name</span><span class="w">                   </span><span class="err">#</span><span class="w"> </span><span class="err">→</span><span class="w"> </span><span class="ss">&quot;Alice&quot;</span>
<span class="n">HGETALL</span><span class="w"> </span><span class="k">user</span><span class="err">:</span><span class="mi">1001</span><span class="w">                     </span><span class="err">#</span><span class="w"> </span><span class="err">→</span><span class="w"> </span><span class="n">name</span><span class="p">,</span><span class="w"> </span><span class="n">Alice</span><span class="p">,</span><span class="w"> </span><span class="n">email</span><span class="p">,</span><span class="w"> </span><span class="n">alice</span><span class="nv">@example</span><span class="p">.</span><span class="n">com</span><span class="p">,</span><span class="w"> </span><span class="n">age</span><span class="p">,</span><span class="w"> </span><span class="mi">30</span>

<span class="err">#</span><span class="w"> </span><span class="n">리스트</span><span class="w"> </span><span class="p">(</span><span class="n">메시지</span><span class="w"> </span><span class="n">큐</span><span class="w"> </span><span class="n">패턴</span><span class="p">)</span>
<span class="n">LPUSH</span><span class="w"> </span><span class="nl">notifications</span><span class="p">:</span><span class="mi">1001</span><span class="w"> </span><span class="ss">&quot;New order #42&quot;</span>
<span class="n">LPUSH</span><span class="w"> </span><span class="nl">notifications</span><span class="p">:</span><span class="mi">1001</span><span class="w"> </span><span class="ss">&quot;Payment received&quot;</span>
<span class="n">LRANGE</span><span class="w"> </span><span class="nl">notifications</span><span class="p">:</span><span class="mi">1001</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="o">-</span><span class="mi">1</span><span class="w">       </span><span class="err">#</span><span class="w"> </span><span class="err">→</span><span class="w"> </span><span class="o">[</span><span class="n">&quot;Payment received&quot;, &quot;New order #42&quot;</span><span class="o">]</span>

<span class="err">#</span><span class="w"> </span><span class="n">정렬된</span><span class="w"> </span><span class="n">집합</span><span class="w"> </span><span class="p">(</span><span class="n">리더보드</span><span class="p">)</span>
<span class="n">ZADD</span><span class="w"> </span><span class="n">leaderboard</span><span class="w"> </span><span class="mi">1500</span><span class="w"> </span><span class="ss">&quot;player:alice&quot;</span>
<span class="n">ZADD</span><span class="w"> </span><span class="n">leaderboard</span><span class="w"> </span><span class="mi">2300</span><span class="w"> </span><span class="ss">&quot;player:bob&quot;</span>
<span class="n">ZADD</span><span class="w"> </span><span class="n">leaderboard</span><span class="w"> </span><span class="mi">1800</span><span class="w"> </span><span class="ss">&quot;player:charlie&quot;</span>
<span class="n">ZREVRANGE</span><span class="w"> </span><span class="n">leaderboard</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="mi">2</span><span class="w"> </span><span class="n">WITHSCORES</span><span class="w"> </span><span class="err">#</span><span class="w"> </span><span class="err">→</span><span class="w"> </span><span class="nl">bob</span><span class="p">:</span><span class="mi">2300</span><span class="p">,</span><span class="w"> </span><span class="nl">charlie</span><span class="p">:</span><span class="mi">1800</span><span class="p">,</span><span class="w"> </span><span class="nl">alice</span><span class="p">:</span><span class="mi">1500</span>

<span class="err">#</span><span class="w"> </span><span class="n">원자적</span><span class="w"> </span><span class="n">증가</span><span class="w"> </span><span class="p">(</span><span class="n">페이지</span><span class="w"> </span><span class="n">뷰</span><span class="w"> </span><span class="n">카운터</span><span class="p">)</span>
<span class="n">INCR</span><span class="w"> </span><span class="nl">page</span><span class="p">:</span><span class="nl">views</span><span class="p">:</span><span class="n">homepage</span><span class="w">              </span><span class="err">#</span><span class="w"> </span><span class="err">→</span><span class="w"> </span><span class="mi">1</span>
<span class="n">INCR</span><span class="w"> </span><span class="nl">page</span><span class="p">:</span><span class="nl">views</span><span class="p">:</span><span class="n">homepage</span><span class="w">              </span><span class="err">#</span><span class="w"> </span><span class="err">→</span><span class="w"> </span><span class="mi">2</span>

<span class="err">#</span><span class="w"> </span><span class="n">TTL</span><span class="w"> </span><span class="p">(</span><span class="n">세션</span><span class="w"> </span><span class="n">관리</span><span class="p">)</span>
<span class="k">SET</span><span class="w"> </span><span class="k">session</span><span class="err">:</span><span class="n">abc123</span><span class="w"> </span><span class="ss">&quot;{user_id: 1001}&quot;</span><span class="w"> </span><span class="n">EX</span><span class="w"> </span><span class="mi">3600</span><span class="w">   </span><span class="err">#</span><span class="w"> </span><span class="mi">1</span><span class="n">시간</span><span class="w"> </span><span class="n">후</span><span class="w"> </span><span class="n">만료</span>
<span class="n">TTL</span><span class="w"> </span><span class="k">session</span><span class="err">:</span><span class="n">abc123</span><span class="w">                              </span><span class="err">#</span><span class="w"> </span><span class="err">→</span><span class="w"> </span><span class="mi">3598</span><span class="w"> </span><span class="p">(</span><span class="n">남은</span><span class="w"> </span><span class="n">초</span><span class="p">)</span>
</code></pre></div>

<p><strong>Redis 사용 사례</strong>:
- <strong>캐싱</strong>: TTL로 자주 액세스되는 데이터 저장
- <strong>세션 저장</strong>: 자동 만료되는 사용자 세션
- <strong>속도 제한</strong>: 슬라이딩 윈도우를 위해 EXPIRE와 함께 INCR 사용
- <strong>실시간 리더보드</strong>: 순위를 위한 정렬된 집합
- <strong>Pub/Sub 메시징</strong>: 경량 메시지 브로커
- <strong>분산 잠금</strong>: 상호 배제를 위한 SETNX(SET if Not eXists)</p>
<h3 id="44-amazon-dynamodb">4.4 Amazon DynamoDB<a class="header-link" href="#44-amazon-dynamodb" title="Permanent link">&para;</a></h3>
<p>DynamoDB는 AWS의 완전 관리형 서버리스 키-값 및 문서 데이터베이스입니다.</p>
<p><strong>핵심 개념</strong>:</p>
<div class="highlight"><pre><span></span><code>┌─────────────────────────────────────────────────────────┐
│  DynamoDB 테이블                                         │
│                                                         │
│  파티션 키 (PK)  │  정렬 키 (SK)  │  속성              │
│  ────────────────┼─────────────────┼────────────        │
│  &quot;USER#1001&quot;     │  &quot;PROFILE&quot;      │  {name, email}     │
│  &quot;USER#1001&quot;     │  &quot;ORDER#001&quot;    │  {total, date}     │
│  &quot;USER#1001&quot;     │  &quot;ORDER#002&quot;    │  {total, date}     │
│  &quot;USER#1002&quot;     │  &quot;PROFILE&quot;      │  {name, email}     │
│                                                         │
│  PK → 파티션 결정 (물리적 위치)                         │
│  PK + SK → 항목을 고유하게 식별                         │
└─────────────────────────────────────────────────────────┘
</code></pre></div>

<p><strong>단일 테이블 설계</strong>: 데이터를 많은 테이블로 정규화하는 관계형 데이터베이스와 달리, DynamoDB 모범 사례는 모든 엔티티를 단일 테이블에 넣고 복합 키를 사용하여 관계를 모델링하는 것을 권장합니다:</p>
<div class="highlight"><pre><span></span><code>PK              SK                  속성
───────────     ───────────────     ─────────────────────
USER#1001       PROFILE             name=Alice, email=...
USER#1001       ORDER#2024-001      total=99.99, status=shipped
USER#1001       ORDER#2024-002      total=45.50, status=pending
PRODUCT#ABC     METADATA            name=Widget, price=9.99
PRODUCT#ABC     REVIEW#1001         rating=5, text=&quot;Great!&quot;
ORDER#2024-001  ITEM#ABC            qty=2, price=9.99
</code></pre></div>

<p><strong>액세스 패턴</strong>이 설계를 주도합니다:
- 사용자 프로필 가져오기: <code>PK = "USER#1001", SK = "PROFILE"</code>
- 사용자 주문 목록: <code>PK = "USER#1001", SK begins_with "ORDER#"</code>
- 주문 항목 가져오기: <code>PK = "ORDER#2024-001", SK begins_with "ITEM#"</code></p>
<h3 id="45-">4.5 키-값 저장소의 한계<a class="header-link" href="#45-" title="Permanent link">&para;</a></h3>
<ul>
<li><strong>애드혹 쿼리 없음</strong>: 키로만 조회 가능; "도시 X의 모든 사용자 찾기" 같은 것은 불가능</li>
<li><strong>관계 없음</strong>: JOIN 없음, 외래 키 없음</li>
<li><strong>애플리케이션 수준 일관성</strong>: 애플리케이션이 키 간 데이터 일관성을 관리해야 함</li>
<li><strong>데이터 모델링 복잡성</strong>: 비정규화와 단일 테이블 설계는 신중한 사전 계획 필요</li>
</ul>
<hr />
<h2 id="5">5. 문서 저장소<a class="header-link" href="#5" title="Permanent link">&para;</a></h2>
<h3 id="51">5.1 데이터 모델<a class="header-link" href="#51" title="Permanent link">&para;</a></h3>
<p>문서 저장소는 값을 구조화되고 쿼리 가능한 문서(일반적으로 JSON 또는 BSON)로 만들어 키-값 모델을 확장합니다:</p>
<div class="highlight"><pre><span></span><code><span class="p">{</span>
<span class="w">  </span><span class="nt">&quot;_id&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;order_1001&quot;</span><span class="p">,</span>
<span class="w">  </span><span class="nt">&quot;customer&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nt">&quot;name&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;Alice Chen&quot;</span><span class="p">,</span>
<span class="w">    </span><span class="nt">&quot;email&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;alice@example.com&quot;</span><span class="p">,</span>
<span class="w">    </span><span class="nt">&quot;address&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">      </span><span class="nt">&quot;street&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;123 Main St&quot;</span><span class="p">,</span>
<span class="w">      </span><span class="nt">&quot;city&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;San Francisco&quot;</span><span class="p">,</span>
<span class="w">      </span><span class="nt">&quot;state&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;CA&quot;</span><span class="p">,</span>
<span class="w">      </span><span class="nt">&quot;zip&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;94105&quot;</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">  </span><span class="p">},</span>
<span class="w">  </span><span class="nt">&quot;items&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span>
<span class="w">    </span><span class="p">{</span><span class="nt">&quot;product_id&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;P001&quot;</span><span class="p">,</span><span class="w"> </span><span class="nt">&quot;name&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;Widget&quot;</span><span class="p">,</span><span class="w"> </span><span class="nt">&quot;qty&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">2</span><span class="p">,</span><span class="w"> </span><span class="nt">&quot;price&quot;</span><span class="p">:</span><span class="w"> </span><span class="mf">9.99</span><span class="p">},</span>
<span class="w">    </span><span class="p">{</span><span class="nt">&quot;product_id&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;P002&quot;</span><span class="p">,</span><span class="w"> </span><span class="nt">&quot;name&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;Gadget&quot;</span><span class="p">,</span><span class="w"> </span><span class="nt">&quot;qty&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="nt">&quot;price&quot;</span><span class="p">:</span><span class="w"> </span><span class="mf">24.99</span><span class="p">}</span>
<span class="w">  </span><span class="p">],</span>
<span class="w">  </span><span class="nt">&quot;total&quot;</span><span class="p">:</span><span class="w"> </span><span class="mf">44.97</span><span class="p">,</span>
<span class="w">  </span><span class="nt">&quot;status&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;shipped&quot;</span><span class="p">,</span>
<span class="w">  </span><span class="nt">&quot;created_at&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;2024-11-15T10:30:00Z&quot;</span><span class="p">,</span>
<span class="w">  </span><span class="nt">&quot;tags&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="s2">&quot;electronics&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;priority&quot;</span><span class="p">]</span>
<span class="p">}</span>
</code></pre></div>

<p><strong>주요 특성</strong>:
- <strong>자체 설명</strong>: 각 문서가 자체 구조를 포함
- <strong>중첩 구조</strong>: 객체 내 객체, 객체 배열
- <strong>유연한 스키마</strong>: 동일 컬렉션의 다른 문서가 다른 필드를 가질 수 있음
- <strong>풍부한 쿼리</strong>: 키-값 저장소와 달리 중첩 필드를 포함한 모든 필드로 쿼리 가능
- <strong>인덱스</strong>: 중첩 객체 내 필드를 포함한 모든 필드에 보조 인덱스</p>
<h3 id="52-json-vs-bson">5.2 JSON vs BSON<a class="header-link" href="#52-json-vs-bson" title="Permanent link">&para;</a></h3>
<table>
<thead>
<tr>
<th>기능</th>
<th>JSON</th>
<th>BSON</th>
</tr>
</thead>
<tbody>
<tr>
<td><strong>형식</strong></td>
<td>텍스트 기반</td>
<td>바이너리</td>
</tr>
<tr>
<td><strong>가독성</strong></td>
<td>사람이 읽을 수 있음</td>
<td>기계 최적화</td>
</tr>
<tr>
<td><strong>데이터 타입</strong></td>
<td>String, Number, Boolean, null, Object, Array</td>
<td>Date, ObjectId, Decimal128, Binary 포함 20+ 타입</td>
</tr>
<tr>
<td><strong>크기</strong></td>
<td>텍스트에 컴팩트</td>
<td>약간 큰 편(타입 접두사)</td>
</tr>
<tr>
<td><strong>파싱</strong></td>
<td>느림(텍스트 파싱)</td>
<td>빠름(직접 메모리 매핑)</td>
</tr>
<tr>
<td><strong>사용처</strong></td>
<td>CouchDB, Elasticsearch</td>
<td>MongoDB</td>
</tr>
</tbody>
</table>
<h3 id="53-mongodb">5.3 MongoDB<a class="header-link" href="#53-mongodb" title="Permanent link">&para;</a></h3>
<p>MongoDB는 BSON을 저장 형식으로 사용하는 가장 인기 있는 문서 데이터베이스입니다.</p>
<p><strong>핵심 개념</strong>:</p>
<div class="highlight"><pre><span></span><code>관계형            MongoDB
─────────         ─────────
Database    →     Database
Table       →     Collection
Row         →     Document
Column      →     Field
JOIN        →     Embedding / $lookup
Primary Key →     _id field
Index       →     Index
</code></pre></div>

<p><strong>CRUD 연산</strong>:</p>
<div class="highlight"><pre><span></span><code><span class="c1">// INSERT</span>
<span class="nx">db</span><span class="p">.</span><span class="nx">orders</span><span class="p">.</span><span class="nx">insertOne</span><span class="p">({</span>
<span class="w">  </span><span class="nx">customer</span><span class="o">:</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">name</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;Alice&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">email</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;alice@example.com&quot;</span><span class="w"> </span><span class="p">},</span>
<span class="w">  </span><span class="nx">items</span><span class="o">:</span><span class="w"> </span><span class="p">[</span>
<span class="w">    </span><span class="p">{</span><span class="w"> </span><span class="nx">product</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;Widget&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">qty</span><span class="o">:</span><span class="w"> </span><span class="mf">2</span><span class="p">,</span><span class="w"> </span><span class="nx">price</span><span class="o">:</span><span class="w"> </span><span class="mf">9.99</span><span class="w"> </span><span class="p">},</span>
<span class="w">    </span><span class="p">{</span><span class="w"> </span><span class="nx">product</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;Gadget&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">qty</span><span class="o">:</span><span class="w"> </span><span class="mf">1</span><span class="p">,</span><span class="w"> </span><span class="nx">price</span><span class="o">:</span><span class="w"> </span><span class="mf">24.99</span><span class="w"> </span><span class="p">}</span>
<span class="w">  </span><span class="p">],</span>
<span class="w">  </span><span class="nx">total</span><span class="o">:</span><span class="w"> </span><span class="mf">44.97</span><span class="p">,</span>
<span class="w">  </span><span class="nx">status</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;pending&quot;</span><span class="p">,</span>
<span class="w">  </span><span class="nx">created_at</span><span class="o">:</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="nb">Date</span><span class="p">()</span>
<span class="p">});</span>

<span class="c1">// FIND (쿼리)</span>
<span class="c1">// Alice의 모든 대기 중인 주문 찾기</span>
<span class="nx">db</span><span class="p">.</span><span class="nx">orders</span><span class="p">.</span><span class="nx">find</span><span class="p">({</span>
<span class="w">  </span><span class="s2">&quot;customer.name&quot;</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;Alice&quot;</span><span class="p">,</span>
<span class="w">  </span><span class="s2">&quot;status&quot;</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;pending&quot;</span>
<span class="p">});</span>

<span class="c1">// total &gt; 100인 주문 찾기, 날짜순 정렬</span>
<span class="nx">db</span><span class="p">.</span><span class="nx">orders</span><span class="p">.</span><span class="nx">find</span><span class="p">({</span><span class="w"> </span><span class="nx">total</span><span class="o">:</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">$gt</span><span class="o">:</span><span class="w"> </span><span class="mf">100</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="p">})</span>
<span class="w">         </span><span class="p">.</span><span class="nx">sort</span><span class="p">({</span><span class="w"> </span><span class="nx">created_at</span><span class="o">:</span><span class="w"> </span><span class="o">-</span><span class="mf">1</span><span class="w"> </span><span class="p">})</span>
<span class="w">         </span><span class="p">.</span><span class="nx">limit</span><span class="p">(</span><span class="mf">10</span><span class="p">);</span>

<span class="c1">// 특정 제품을 포함하는 주문 찾기</span>
<span class="nx">db</span><span class="p">.</span><span class="nx">orders</span><span class="p">.</span><span class="nx">find</span><span class="p">({</span><span class="w"> </span><span class="s2">&quot;items.product&quot;</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;Widget&quot;</span><span class="w"> </span><span class="p">});</span>

<span class="c1">// UPDATE</span>
<span class="c1">// 주문 상태를 배송됨으로 설정</span>
<span class="nx">db</span><span class="p">.</span><span class="nx">orders</span><span class="p">.</span><span class="nx">updateOne</span><span class="p">(</span>
<span class="w">  </span><span class="p">{</span><span class="w"> </span><span class="nx">_id</span><span class="o">:</span><span class="w"> </span><span class="nx">ObjectId</span><span class="p">(</span><span class="s2">&quot;...&quot;</span><span class="p">)</span><span class="w"> </span><span class="p">},</span>
<span class="w">  </span><span class="p">{</span>
<span class="w">    </span><span class="nx">$set</span><span class="o">:</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">status</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;shipped&quot;</span><span class="w"> </span><span class="p">},</span>
<span class="w">    </span><span class="nx">$currentDate</span><span class="o">:</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">updated_at</span><span class="o">:</span><span class="w"> </span><span class="kc">true</span><span class="w"> </span><span class="p">}</span>
<span class="w">  </span><span class="p">}</span>
<span class="p">);</span>

<span class="c1">// 기존 주문에 항목 추가</span>
<span class="nx">db</span><span class="p">.</span><span class="nx">orders</span><span class="p">.</span><span class="nx">updateOne</span><span class="p">(</span>
<span class="w">  </span><span class="p">{</span><span class="w"> </span><span class="nx">_id</span><span class="o">:</span><span class="w"> </span><span class="nx">ObjectId</span><span class="p">(</span><span class="s2">&quot;...&quot;</span><span class="p">)</span><span class="w"> </span><span class="p">},</span>
<span class="w">  </span><span class="p">{</span><span class="w"> </span><span class="nx">$push</span><span class="o">:</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">items</span><span class="o">:</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">product</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;Doohickey&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">qty</span><span class="o">:</span><span class="w"> </span><span class="mf">3</span><span class="p">,</span><span class="w"> </span><span class="nx">price</span><span class="o">:</span><span class="w"> </span><span class="mf">5.99</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="p">}</span>
<span class="p">);</span>

<span class="c1">// DELETE</span>
<span class="nx">db</span><span class="p">.</span><span class="nx">orders</span><span class="p">.</span><span class="nx">deleteMany</span><span class="p">({</span><span class="w"> </span><span class="nx">status</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;cancelled&quot;</span><span class="w"> </span><span class="p">});</span>
</code></pre></div>

<p><strong>집계 파이프라인</strong>: MongoDB의 복잡한 데이터 처리 프레임워크:</p>
<div class="highlight"><pre><span></span><code><span class="c1">// 최근 30일간 제품 카테고리별 수익</span>
<span class="nx">db</span><span class="p">.</span><span class="nx">orders</span><span class="p">.</span><span class="nx">aggregate</span><span class="p">([</span>
<span class="w">  </span><span class="c1">// 단계 1: 최근 주문 필터</span>
<span class="w">  </span><span class="p">{</span><span class="w"> </span><span class="nx">$match</span><span class="o">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nx">created_at</span><span class="o">:</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">$gte</span><span class="o">:</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="nb">Date</span><span class="p">(</span><span class="nb">Date</span><span class="p">.</span><span class="nx">now</span><span class="p">()</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="mf">30</span><span class="o">*</span><span class="mf">24</span><span class="o">*</span><span class="mf">60</span><span class="o">*</span><span class="mf">60</span><span class="o">*</span><span class="mf">1000</span><span class="p">)</span><span class="w"> </span><span class="p">},</span>
<span class="w">    </span><span class="nx">status</span><span class="o">:</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">$ne</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;cancelled&quot;</span><span class="w"> </span><span class="p">}</span>
<span class="w">  </span><span class="p">}},</span>
<span class="w">  </span><span class="c1">// 단계 2: items 배열 펼치기 (항목당 하나의 문서)</span>
<span class="w">  </span><span class="p">{</span><span class="w"> </span><span class="nx">$unwind</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;$items&quot;</span><span class="w"> </span><span class="p">},</span>
<span class="w">  </span><span class="c1">// 단계 3: 제품별로 그룹화하고 수익 합계</span>
<span class="w">  </span><span class="p">{</span><span class="w"> </span><span class="nx">$group</span><span class="o">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nx">_id</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;$items.product&quot;</span><span class="p">,</span>
<span class="w">    </span><span class="nx">total_revenue</span><span class="o">:</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">$sum</span><span class="o">:</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">$multiply</span><span class="o">:</span><span class="w"> </span><span class="p">[</span><span class="s2">&quot;$items.qty&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;$items.price&quot;</span><span class="p">]</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="p">},</span>
<span class="w">    </span><span class="nx">total_units</span><span class="o">:</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">$sum</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;$items.qty&quot;</span><span class="w"> </span><span class="p">},</span>
<span class="w">    </span><span class="nx">order_count</span><span class="o">:</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">$sum</span><span class="o">:</span><span class="w"> </span><span class="mf">1</span><span class="w"> </span><span class="p">}</span>
<span class="w">  </span><span class="p">}},</span>
<span class="w">  </span><span class="c1">// 단계 4: 수익 내림차순 정렬</span>
<span class="w">  </span><span class="p">{</span><span class="w"> </span><span class="nx">$sort</span><span class="o">:</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">total_revenue</span><span class="o">:</span><span class="w"> </span><span class="o">-</span><span class="mf">1</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="p">},</span>
<span class="w">  </span><span class="c1">// 단계 5: 상위 10개로 제한</span>
<span class="w">  </span><span class="p">{</span><span class="w"> </span><span class="nx">$limit</span><span class="o">:</span><span class="w"> </span><span class="mf">10</span><span class="w"> </span><span class="p">}</span>
<span class="p">]);</span>
</code></pre></div>

<h3 id="54">5.4 스키마 설계 패턴<a class="header-link" href="#54" title="Permanent link">&para;</a></h3>
<p>문서 데이터베이스에서 주요 설계 결정은 <strong>임베딩 vs 참조</strong>입니다:</p>
<p><strong>임베딩</strong> (비정규화):</p>
<div class="highlight"><pre><span></span><code><span class="p">{</span>
<span class="w">  </span><span class="nt">&quot;_id&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;user_1001&quot;</span><span class="p">,</span>
<span class="w">  </span><span class="nt">&quot;name&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;Alice&quot;</span><span class="p">,</span>
<span class="w">  </span><span class="nt">&quot;orders&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span>
<span class="w">    </span><span class="p">{</span><span class="w"> </span><span class="nt">&quot;order_id&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;O001&quot;</span><span class="p">,</span><span class="w"> </span><span class="nt">&quot;total&quot;</span><span class="p">:</span><span class="w"> </span><span class="mf">44.97</span><span class="p">,</span><span class="w"> </span><span class="nt">&quot;items&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="err">...</span><span class="p">]</span><span class="w"> </span><span class="p">},</span>
<span class="w">    </span><span class="p">{</span><span class="w"> </span><span class="nt">&quot;order_id&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;O002&quot;</span><span class="p">,</span><span class="w"> </span><span class="nt">&quot;total&quot;</span><span class="p">:</span><span class="w"> </span><span class="mf">89.50</span><span class="p">,</span><span class="w"> </span><span class="nt">&quot;items&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="err">...</span><span class="p">]</span><span class="w"> </span><span class="p">}</span>
<span class="w">  </span><span class="p">]</span>
<span class="p">}</span>
</code></pre></div>

<p><strong>참조</strong> (정규화):</p>
<div class="highlight"><pre><span></span><code><span class="c1">// Users 컬렉션</span>
<span class="p">{</span><span class="w"> </span><span class="nt">&quot;_id&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;user_1001&quot;</span><span class="p">,</span><span class="w"> </span><span class="nt">&quot;name&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;Alice&quot;</span><span class="w"> </span><span class="p">}</span>

<span class="c1">// Orders 컬렉션</span>
<span class="p">{</span><span class="w"> </span><span class="nt">&quot;_id&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;O001&quot;</span><span class="p">,</span><span class="w"> </span><span class="nt">&quot;user_id&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;user_1001&quot;</span><span class="p">,</span><span class="w"> </span><span class="nt">&quot;total&quot;</span><span class="p">:</span><span class="w"> </span><span class="mf">44.97</span><span class="p">,</span><span class="w"> </span><span class="nt">&quot;items&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="err">...</span><span class="p">]</span><span class="w"> </span><span class="p">}</span>
<span class="p">{</span><span class="w"> </span><span class="nt">&quot;_id&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;O002&quot;</span><span class="p">,</span><span class="w"> </span><span class="nt">&quot;user_id&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;user_1001&quot;</span><span class="p">,</span><span class="w"> </span><span class="nt">&quot;total&quot;</span><span class="p">:</span><span class="w"> </span><span class="mf">89.50</span><span class="p">,</span><span class="w"> </span><span class="nt">&quot;items&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="err">...</span><span class="p">]</span><span class="w"> </span><span class="p">}</span>
</code></pre></div>

<p><strong>결정 기준</strong>:</p>
<table>
<thead>
<tr>
<th>요인</th>
<th>임베드</th>
<th>참조</th>
</tr>
</thead>
<tbody>
<tr>
<td>데이터가 함께 읽히는가?</td>
<td>예 → 임베드</td>
<td>아니오 → 참조</td>
</tr>
<tr>
<td>데이터 크기가 무제한인가?</td>
<td>아니오 → 임베드</td>
<td>예 → 참조 (16MB 문서 제한)</td>
</tr>
<tr>
<td>데이터가 독립적으로 업데이트되는가?</td>
<td>아니오 → 임베드</td>
<td>예 → 참조</td>
</tr>
<tr>
<td>카디널리티</td>
<td>One-to-few</td>
<td>One-to-many / Many-to-many</td>
</tr>
</tbody>
</table>
<p><strong>일반적인 패턴</strong>:</p>
<table>
<thead>
<tr>
<th>패턴</th>
<th>설명</th>
<th>예</th>
</tr>
</thead>
<tbody>
<tr>
<td><strong>Subset</strong></td>
<td>가장 많이 사용되는 필드를 임베드, 나머지는 참조</td>
<td>제품 요약은 임베드, 전체 스펙은 참조</td>
</tr>
<tr>
<td><strong>Extended Reference</strong></td>
<td>참조된 문서에서 자주 액세스되는 필드의 복사본 저장</td>
<td>주문이 고객 이름 + 이메일 저장(전체 프로필 아님)</td>
</tr>
<tr>
<td><strong>Computed</strong></td>
<td>미리 계산하고 파생 값 저장</td>
<td>매번 항목에서 계산하지 않고 주문 총액 저장</td>
</tr>
<tr>
<td><strong>Bucket</strong></td>
<td>시계열 데이터를 버킷으로 그룹화</td>
<td>시간당 센서 판독값을 하나의 문서로</td>
</tr>
<tr>
<td><strong>Outlier</strong></td>
<td>임베딩 제한을 초과하는 문서를 다르게 처리</td>
<td>"has_overflow" 플래그 지정하고 초과분을 오버플로 컬렉션에 저장</td>
</tr>
</tbody>
</table>
<h3 id="55-mongodb">5.5 MongoDB의 인덱싱<a class="header-link" href="#55-mongodb" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><span class="c1">// 단일 필드 인덱스</span>
<span class="nx">db</span><span class="p">.</span><span class="nx">orders</span><span class="p">.</span><span class="nx">createIndex</span><span class="p">({</span><span class="w"> </span><span class="nx">status</span><span class="o">:</span><span class="w"> </span><span class="mf">1</span><span class="w"> </span><span class="p">});</span>

<span class="c1">// 복합 인덱스</span>
<span class="nx">db</span><span class="p">.</span><span class="nx">orders</span><span class="p">.</span><span class="nx">createIndex</span><span class="p">({</span><span class="w"> </span><span class="s2">&quot;customer.email&quot;</span><span class="o">:</span><span class="w"> </span><span class="mf">1</span><span class="p">,</span><span class="w"> </span><span class="nx">created_at</span><span class="o">:</span><span class="w"> </span><span class="o">-</span><span class="mf">1</span><span class="w"> </span><span class="p">});</span>

<span class="c1">// 멀티키 인덱스 (배열 필드에)</span>
<span class="nx">db</span><span class="p">.</span><span class="nx">orders</span><span class="p">.</span><span class="nx">createIndex</span><span class="p">({</span><span class="w"> </span><span class="s2">&quot;items.product&quot;</span><span class="o">:</span><span class="w"> </span><span class="mf">1</span><span class="w"> </span><span class="p">});</span>

<span class="c1">// 텍스트 인덱스 (전문 검색)</span>
<span class="nx">db</span><span class="p">.</span><span class="nx">orders</span><span class="p">.</span><span class="nx">createIndex</span><span class="p">({</span><span class="w"> </span><span class="s2">&quot;items.product&quot;</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;text&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">notes</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;text&quot;</span><span class="w"> </span><span class="p">});</span>

<span class="c1">// TTL 인덱스 (만료 후 자동 삭제)</span>
<span class="nx">db</span><span class="p">.</span><span class="nx">sessions</span><span class="p">.</span><span class="nx">createIndex</span><span class="p">({</span><span class="w"> </span><span class="nx">created_at</span><span class="o">:</span><span class="w"> </span><span class="mf">1</span><span class="w"> </span><span class="p">},</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">expireAfterSeconds</span><span class="o">:</span><span class="w"> </span><span class="mf">3600</span><span class="w"> </span><span class="p">});</span>

<span class="c1">// 고유 인덱스</span>
<span class="nx">db</span><span class="p">.</span><span class="nx">users</span><span class="p">.</span><span class="nx">createIndex</span><span class="p">({</span><span class="w"> </span><span class="nx">email</span><span class="o">:</span><span class="w"> </span><span class="mf">1</span><span class="w"> </span><span class="p">},</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">unique</span><span class="o">:</span><span class="w"> </span><span class="kc">true</span><span class="w"> </span><span class="p">});</span>
</code></pre></div>

<h3 id="56">5.6 문서 저장소의 한계<a class="header-link" href="#56" title="Permanent link">&para;</a></h3>
<ul>
<li><strong>다중 문서 ACID 트랜잭션 없음</strong> (역사적으로; MongoDB는 v4.0에서 추가했지만 성능 오버헤드 있음)</li>
<li><strong>데이터 중복</strong>: 비정규화는 업데이트가 많은 문서를 터치해야 할 수 있음을 의미</li>
<li><strong>무제한 문서 증가</strong>: 제한 없이 증가하는 문서는 성능을 저하시킴</li>
<li><strong>내장 참조 무결성 없음</strong>: 애플리케이션이 외래 키 같은 제약 조건을 강제해야 함</li>
</ul>
<hr />
<h2 id="6">6. 와이드 컬럼 저장소<a class="header-link" href="#6" title="Permanent link">&para;</a></h2>
<h3 id="61">6.1 데이터 모델<a class="header-link" href="#61" title="Permanent link">&para;</a></h3>
<p>와이드 컬럼 저장소(컬럼 패밀리 저장소라고도 함)는 행이 아닌 컬럼으로 데이터를 구성합니다. 컬럼형 분석 데이터베이스(Parquet나 ClickHouse 같은)와 혼동해서는 안 됩니다; 와이드 컬럼 저장소는 운영 워크로드를 위해 설계되었습니다.</p>
<div class="highlight"><pre><span></span><code><span class="err">┌────────────────────────────────────────────────────────────────┐</span>
<span class="err">│</span><span class="w">  </span><span class="n">와이드</span><span class="w"> </span><span class="n">컬럼</span><span class="w"> </span><span class="n">저장소</span><span class="w">                                             </span><span class="err">│</span>
<span class="err">│</span><span class="w">                                                                </span><span class="err">│</span>
<span class="err">│</span><span class="w">  </span><span class="n">행</span><span class="w"> </span><span class="n">키</span><span class="w">        </span><span class="err">│</span><span class="w"> </span><span class="n">컬럼</span><span class="w"> </span><span class="nl">패밀리</span><span class="p">:</span><span class="w"> </span><span class="ss">&quot;profile&quot;</span><span class="w">  </span><span class="err">│</span><span class="w"> </span><span class="nl">CF</span><span class="p">:</span><span class="w"> </span><span class="ss">&quot;activity&quot;</span><span class="w">       </span><span class="err">│</span>
<span class="err">│</span><span class="w">  </span><span class="err">─────────────┼───────────────────────────┼────────────────</span><span class="w">     </span><span class="err">│</span>
<span class="err">│</span><span class="w">  </span><span class="k">user</span><span class="err">:</span><span class="mi">1001</span><span class="w">    </span><span class="err">│</span><span class="w"> </span><span class="nl">name</span><span class="p">:</span><span class="w"> </span><span class="n">Alice</span><span class="w">               </span><span class="err">│</span><span class="w"> </span><span class="nl">last_login</span><span class="p">:</span><span class="w"> </span><span class="p">...</span><span class="w">     </span><span class="err">│</span>
<span class="err">│</span><span class="w">               </span><span class="err">│</span><span class="w"> </span><span class="nl">email</span><span class="p">:</span><span class="w"> </span><span class="n">alice</span><span class="nv">@ex</span><span class="p">.</span><span class="n">com</span><span class="w">       </span><span class="err">│</span><span class="w"> </span><span class="nl">page_views</span><span class="p">:</span><span class="w"> </span><span class="mi">1547</span><span class="w">    </span><span class="err">│</span>
<span class="err">│</span><span class="w">               </span><span class="err">│</span><span class="w"> </span><span class="nl">city</span><span class="p">:</span><span class="w"> </span><span class="n">San</span><span class="w"> </span><span class="n">Francisco</span><span class="w">       </span><span class="err">│</span><span class="w">                     </span><span class="err">│</span>
<span class="err">│</span><span class="w">  </span><span class="err">─────────────┼───────────────────────────┼────────────────</span><span class="w">     </span><span class="err">│</span>
<span class="err">│</span><span class="w">  </span><span class="k">user</span><span class="err">:</span><span class="mi">1002</span><span class="w">    </span><span class="err">│</span><span class="w"> </span><span class="nl">name</span><span class="p">:</span><span class="w"> </span><span class="n">Bob</span><span class="w">                 </span><span class="err">│</span><span class="w"> </span><span class="nl">last_login</span><span class="p">:</span><span class="w"> </span><span class="p">...</span><span class="w">     </span><span class="err">│</span>
<span class="err">│</span><span class="w">               </span><span class="err">│</span><span class="w"> </span><span class="nl">email</span><span class="p">:</span><span class="w"> </span><span class="n">bob</span><span class="nv">@ex</span><span class="p">.</span><span class="n">com</span><span class="w">         </span><span class="err">│</span><span class="w"> </span><span class="nl">page_views</span><span class="p">:</span><span class="w"> </span><span class="mi">892</span><span class="w">     </span><span class="err">│</span>
<span class="err">│</span><span class="w">               </span><span class="err">│</span><span class="w"> </span><span class="nl">phone</span><span class="p">:</span><span class="w"> </span><span class="o">+</span><span class="mi">1</span><span class="o">-</span><span class="mi">555</span><span class="o">-</span><span class="mi">0123</span><span class="w">        </span><span class="err">│</span><span class="w"> </span><span class="nl">last_purchase</span><span class="p">:</span><span class="w"> </span><span class="p">...</span><span class="w">  </span><span class="err">│</span>
<span class="err">│</span><span class="w">               </span><span class="err">│</span><span class="w">                           </span><span class="err">│</span><span class="w">                     </span><span class="err">│</span>
<span class="err">│</span><span class="w">  </span><span class="nl">참고</span><span class="p">:</span><span class="w"> </span><span class="k">user</span><span class="err">:</span><span class="mi">1001</span><span class="n">에는</span><span class="w"> </span><span class="ss">&quot;phone&quot;</span><span class="w"> </span><span class="n">컬럼이</span><span class="w"> </span><span class="n">없음</span><span class="p">,</span><span class="w">                       </span><span class="err">│</span>
<span class="err">│</span><span class="w">        </span><span class="k">user</span><span class="err">:</span><span class="mi">1002</span><span class="n">에는</span><span class="w"> </span><span class="n">추가</span><span class="w"> </span><span class="ss">&quot;last_purchase&quot;</span><span class="w"> </span><span class="n">컬럼이</span><span class="w"> </span><span class="n">있음</span><span class="p">.</span><span class="w">          </span><span class="err">│</span>
<span class="err">│</span><span class="w">        </span><span class="n">각</span><span class="w"> </span><span class="n">행은</span><span class="w"> </span><span class="n">다른</span><span class="w"> </span><span class="n">컬럼을</span><span class="w"> </span><span class="n">가질</span><span class="w"> </span><span class="n">수</span><span class="w"> </span><span class="n">있음</span><span class="err">!</span><span class="w">                        </span><span class="err">│</span>
<span class="err">└────────────────────────────────────────────────────────────────┘</span>
</code></pre></div>

<p><strong>주요 개념</strong>:
- <strong>행 키(Row Key)</strong>: 기본 식별자, 노드 간 데이터 분산 결정
- <strong>컬럼 패밀리(Column Family)</strong>: 관련 컬럼 그룹, 테이블 생성 시 정의
- <strong>컬럼(Column)</strong>: 컬럼 패밀리 내의 이름-값 쌍
- <strong>희소 저장</strong>: 행이 동일한 컬럼을 가질 필요 없음; 빈 컬럼은 저장 공간을 소비하지 않음
- <strong>타임스탬프</strong>: 각 셀(행 키 + 컬럼)은 여러 타임스탬프가 찍힌 버전을 저장 가능</p>
<h3 id="62-cassandra">6.2 Cassandra<a class="header-link" href="#62-cassandra" title="Permanent link">&para;</a></h3>
<p>Apache Cassandra는 단일 장애 지점이 없는 고가용성을 위해 설계된 분산 와이드 컬럼 저장소입니다.</p>
<p><strong>아키텍처</strong>:</p>
<div class="highlight"><pre><span></span><code>                  ┌─────────────────────────────┐
                  │      Cassandra Ring          │
                  │                              │
                  │     N1 ─── N2                │
                  │    /         \               │
                  │  N6           N3             │
                  │    \         /               │
                  │     N5 ─── N4                │
                  │                              │
                  │  모든 노드가 동등            │
                  │  (master/slave 없음)        │
                  │  일관된 해싱으로             │
                  │  데이터 분산                 │
                  └─────────────────────────────┘
</code></pre></div>

<p><strong>CQL (Cassandra Query Language)</strong>:</p>
<div class="highlight"><pre><span></span><code><span class="c1">-- 키스페이스 생성 (데이터베이스와 유사)</span>
<span class="k">CREATE</span><span class="w"> </span><span class="n">KEYSPACE</span><span class="w"> </span><span class="n">ecommerce</span>
<span class="k">WITH</span><span class="w"> </span><span class="n">replication</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="err">{</span>
<span class="w">  </span><span class="s1">&#39;class&#39;</span><span class="p">:</span><span class="w"> </span><span class="s1">&#39;NetworkTopologyStrategy&#39;</span><span class="p">,</span>
<span class="w">  </span><span class="s1">&#39;dc1&#39;</span><span class="p">:</span><span class="w"> </span><span class="mi">3</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;dc2&#39;</span><span class="p">:</span><span class="w"> </span><span class="mi">3</span>
<span class="err">}</span><span class="p">;</span>

<span class="c1">-- 복합 기본 키로 테이블 생성</span>
<span class="k">CREATE</span><span class="w"> </span><span class="k">TABLE</span><span class="w"> </span><span class="n">ecommerce</span><span class="p">.</span><span class="n">orders</span><span class="w"> </span><span class="p">(</span>
<span class="w">  </span><span class="n">customer_id</span><span class="w"> </span><span class="n">UUID</span><span class="p">,</span>
<span class="w">  </span><span class="n">order_date</span><span class="w"> </span><span class="k">TIMESTAMP</span><span class="p">,</span>
<span class="w">  </span><span class="n">order_id</span><span class="w"> </span><span class="n">UUID</span><span class="p">,</span>
<span class="w">  </span><span class="n">total</span><span class="w"> </span><span class="nb">DECIMAL</span><span class="p">,</span>
<span class="w">  </span><span class="n">status</span><span class="w"> </span><span class="nb">TEXT</span><span class="p">,</span>
<span class="w">  </span><span class="n">items</span><span class="w"> </span><span class="n">LIST</span><span class="o">&lt;</span><span class="n">FROZEN</span><span class="o">&lt;</span><span class="n">item_type</span><span class="o">&gt;&gt;</span><span class="p">,</span>
<span class="w">  </span><span class="k">PRIMARY</span><span class="w"> </span><span class="k">KEY</span><span class="w"> </span><span class="p">((</span><span class="n">customer_id</span><span class="p">),</span><span class="w"> </span><span class="n">order_date</span><span class="p">,</span><span class="w"> </span><span class="n">order_id</span><span class="p">)</span>
<span class="p">)</span><span class="w"> </span><span class="k">WITH</span><span class="w"> </span><span class="n">CLUSTERING</span><span class="w"> </span><span class="k">ORDER</span><span class="w"> </span><span class="k">BY</span><span class="w"> </span><span class="p">(</span><span class="n">order_date</span><span class="w"> </span><span class="k">DESC</span><span class="p">);</span>

<span class="c1">-- PRIMARY KEY는 두 부분으로 구성:</span>
<span class="c1">--   파티션 키: (customer_id) → 어느 노드가 데이터를 저장할지 결정</span>
<span class="c1">--   클러스터링 키: order_date, order_id → 파티션 내 정렬 순서 결정</span>

<span class="c1">-- 데이터 삽입</span>
<span class="k">INSERT</span><span class="w"> </span><span class="k">INTO</span><span class="w"> </span><span class="n">ecommerce</span><span class="p">.</span><span class="n">orders</span><span class="w"> </span><span class="p">(</span><span class="n">customer_id</span><span class="p">,</span><span class="w"> </span><span class="n">order_date</span><span class="p">,</span><span class="w"> </span><span class="n">order_id</span><span class="p">,</span><span class="w"> </span><span class="n">total</span><span class="p">,</span><span class="w"> </span><span class="n">status</span><span class="p">)</span>
<span class="k">VALUES</span><span class="w"> </span><span class="p">(</span><span class="n">uuid</span><span class="p">(),</span><span class="w"> </span><span class="s1">&#39;2024-11-15&#39;</span><span class="p">,</span><span class="w"> </span><span class="n">uuid</span><span class="p">(),</span><span class="w"> </span><span class="mi">44</span><span class="p">.</span><span class="mi">97</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;shipped&#39;</span><span class="p">);</span>

<span class="c1">-- 파티션 키로 쿼리 (빠름 - 하나의 노드로 감)</span>
<span class="k">SELECT</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="k">FROM</span><span class="w"> </span><span class="n">ecommerce</span><span class="p">.</span><span class="n">orders</span>
<span class="k">WHERE</span><span class="w"> </span><span class="n">customer_id</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">550</span><span class="n">e8400</span><span class="o">-</span><span class="n">e29b</span><span class="o">-</span><span class="mi">41</span><span class="n">d4</span><span class="o">-</span><span class="n">a716</span><span class="o">-</span><span class="mi">446655440000</span><span class="p">;</span>

<span class="c1">-- 클러스터링 키 범위로 쿼리 (빠름 - 파티션 내 순차 읽기)</span>
<span class="k">SELECT</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="k">FROM</span><span class="w"> </span><span class="n">ecommerce</span><span class="p">.</span><span class="n">orders</span>
<span class="k">WHERE</span><span class="w"> </span><span class="n">customer_id</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">550</span><span class="n">e8400</span><span class="o">-</span><span class="n">e29b</span><span class="o">-</span><span class="mi">41</span><span class="n">d4</span><span class="o">-</span><span class="n">a716</span><span class="o">-</span><span class="mi">446655440000</span>
<span class="w">  </span><span class="k">AND</span><span class="w"> </span><span class="n">order_date</span><span class="w"> </span><span class="o">&gt;=</span><span class="w"> </span><span class="s1">&#39;2024-01-01&#39;</span>
<span class="w">  </span><span class="k">AND</span><span class="w"> </span><span class="n">order_date</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="s1">&#39;2025-01-01&#39;</span><span class="p">;</span>

<span class="c1">-- 파티션 키 없이 쿼리 (느림 - ALLOW FILTERING 필요, 모든 노드 스캔)</span>
<span class="c1">-- 안티패턴: 프로덕션에서 피하세요!</span>
<span class="k">SELECT</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="k">FROM</span><span class="w"> </span><span class="n">ecommerce</span><span class="p">.</span><span class="n">orders</span><span class="w"> </span><span class="k">WHERE</span><span class="w"> </span><span class="n">status</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">&#39;pending&#39;</span><span class="w"> </span><span class="n">ALLOW</span><span class="w"> </span><span class="n">FILTERING</span><span class="p">;</span>
</code></pre></div>

<p><strong>데이터 모델링 원칙</strong>: Cassandra에서는 엔티티가 아닌 쿼리를 중심으로 테이블을 모델링합니다. N개의 다른 쿼리가 있다면 N개의 다른 테이블이 필요할 수 있습니다(각각 하나의 쿼리에 최적화).</p>
<h3 id="63-hbase">6.3 HBase<a class="header-link" href="#63-hbase" title="Permanent link">&para;</a></h3>
<p>Apache HBase는 HDFS(Hadoop Distributed File System) 위에 구축된 와이드 컬럼 저장소로, Google의 Bigtable에서 영감을 받았습니다.</p>
<p><strong>Cassandra와의 주요 차이점</strong>:</p>
<table>
<thead>
<tr>
<th>기능</th>
<th>Cassandra</th>
<th>HBase</th>
</tr>
</thead>
<tbody>
<tr>
<td><strong>아키텍처</strong></td>
<td>Peer-to-peer (마스터 없음)</td>
<td>Master-RegionServer</td>
</tr>
<tr>
<td><strong>일관성</strong></td>
<td>조정 가능 (기본 AP)</td>
<td>강함 (CP)</td>
</tr>
<tr>
<td><strong>쓰기 경로</strong></td>
<td>Log-structured merge tree</td>
<td>Log-structured merge tree</td>
</tr>
<tr>
<td><strong>저장소</strong></td>
<td>자체 저장 엔진</td>
<td>HDFS</td>
</tr>
<tr>
<td><strong>쿼리 언어</strong></td>
<td>CQL (SQL-like)</td>
<td>Java API / HBase Shell</td>
</tr>
<tr>
<td><strong>최적 용도</strong></td>
<td>쓰기 중심, 다중 데이터센터</td>
<td>HDFS 데이터에 대한 무작위 읽기/쓰기</td>
</tr>
</tbody>
</table>
<h3 id="64">6.4 와이드 컬럼 저장소 사용 사례<a class="header-link" href="#64" title="Permanent link">&para;</a></h3>
<ul>
<li><strong>시계열 데이터</strong>: IoT 센서 판독값, 메트릭, 로그 (행 키 = device_id, 클러스터링 키 = timestamp)</li>
<li><strong>이벤트 로깅</strong>: 사용자 또는 서비스별로 분할된 애플리케이션 이벤트 저장</li>
<li><strong>콘텐츠 관리</strong>: 기사, 댓글, 메타데이터 저장</li>
<li><strong>추천 엔진</strong>: 사용자-항목 상호작용 행렬 저장</li>
<li><strong>메시징 시스템</strong>: 대화별로 분할된 메시지 저장</li>
</ul>
<h3 id="65">6.5 한계<a class="header-link" href="#65" title="Permanent link">&para;</a></h3>
<ul>
<li><strong>JOIN 없음</strong>: 쿼리를 위한 모든 데이터가 하나의 테이블에 있어야 함(비정규화)</li>
<li><strong>제한된 보조 인덱스</strong>: 비-키 컬럼으로 쿼리하는 것은 비용이 큼</li>
<li><strong>복잡한 데이터 모델링</strong>: 효과적인 파티션 키 설계는 액세스 패턴에 대한 깊은 이해 필요</li>
<li><strong>다중 파티션 트랜잭션 없음</strong> (Cassandra는 Paxos를 사용한 경량 트랜잭션을 추가했지만 느림)</li>
</ul>
<hr />
<h2 id="7">7. 그래프 데이터베이스<a class="header-link" href="#7" title="Permanent link">&para;</a></h2>
<h3 id="71">7.1 속성 그래프 모델<a class="header-link" href="#71" title="Permanent link">&para;</a></h3>
<p>그래프 데이터베이스는 데이터를 노드와 엣지의 네트워크로 저장하여 복잡하고 상호 연결된 관계를 가진 데이터에 이상적입니다.</p>
<div class="highlight"><pre><span></span><code>┌──────────────────────────────────────────────────────────────┐
│  속성 그래프 모델                                             │
│                                                              │
│  NODE (Vertex)                    EDGE (Relationship)        │
│  ┌─────────────────┐             ────────────────────        │
│  │ Label: Person   │             Type: FOLLOWS               │
│  │ Properties:     │             Properties:                 │
│  │   name: &quot;Alice&quot; │──FOLLOWS──▶   since: &quot;2023-01&quot;          │
│  │   age: 30       │             Direction: Alice → Bob      │
│  └─────────────────┘                                         │
│                                                              │
│  노드는 다음을 가짐:              엣지는 다음을 가짐:        │
│  - 하나 이상의 레이블            - 정확히 하나의 타입        │
│  - 0개 이상의 속성               - 방향                      │
│  - 고유 ID                       - 0개 이상의 속성           │
│                                  - 시작 노드와 끝 노드       │
└──────────────────────────────────────────────────────────────┘
</code></pre></div>

<p><strong>그래프 예제</strong>:</p>
<div class="highlight"><pre><span></span><code>(Alice:Person)──[:FOLLOWS]──▶(Bob:Person)
     │                            │
     │                            │
  [:LIKES]                    [:WROTE]
     │                            │
     ▼                            ▼
(Neo4j:Product)              (Review:Review)
  {name: &quot;Neo4j&quot;}             {rating: 5,
                               text: &quot;Great DB!&quot;}
     ▲
     │
  [:MADE_BY]
     │
(Neo4j Inc:Company)
  {founded: 2007}
</code></pre></div>

<h3 id="72">7.2 왜 그래프인가?<a class="header-link" href="#72" title="Permanent link">&para;</a></h3>
<p>소셜 네트워크 쿼리를 고려하세요: "나와 같은 제품을 좋아하는 친구의 친구를 찾기."</p>
<p><strong>SQL에서</strong> (관계형):</p>
<div class="highlight"><pre><span></span><code><span class="c1">-- 같은 제품을 좋아하는 친구의 친구</span>
<span class="k">SELECT</span><span class="w"> </span><span class="k">DISTINCT</span><span class="w"> </span><span class="n">fof</span><span class="p">.</span><span class="n">name</span>
<span class="k">FROM</span><span class="w"> </span><span class="n">users</span><span class="w"> </span><span class="n">me</span>
<span class="k">JOIN</span><span class="w"> </span><span class="n">friendships</span><span class="w"> </span><span class="n">f1</span><span class="w"> </span><span class="k">ON</span><span class="w"> </span><span class="n">me</span><span class="p">.</span><span class="n">id</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">f1</span><span class="p">.</span><span class="n">user_id</span>
<span class="k">JOIN</span><span class="w"> </span><span class="n">friendships</span><span class="w"> </span><span class="n">f2</span><span class="w"> </span><span class="k">ON</span><span class="w"> </span><span class="n">f1</span><span class="p">.</span><span class="n">friend_id</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">f2</span><span class="p">.</span><span class="n">user_id</span>
<span class="k">JOIN</span><span class="w"> </span><span class="n">user_likes</span><span class="w"> </span><span class="n">ul1</span><span class="w"> </span><span class="k">ON</span><span class="w"> </span><span class="n">me</span><span class="p">.</span><span class="n">id</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">ul1</span><span class="p">.</span><span class="n">user_id</span>
<span class="k">JOIN</span><span class="w"> </span><span class="n">user_likes</span><span class="w"> </span><span class="n">ul2</span><span class="w"> </span><span class="k">ON</span><span class="w"> </span><span class="n">f2</span><span class="p">.</span><span class="n">friend_id</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">ul2</span><span class="p">.</span><span class="n">user_id</span>
<span class="k">WHERE</span><span class="w"> </span><span class="n">me</span><span class="p">.</span><span class="n">name</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">&#39;Alice&#39;</span>
<span class="w">  </span><span class="k">AND</span><span class="w"> </span><span class="n">ul1</span><span class="p">.</span><span class="n">product_id</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">ul2</span><span class="p">.</span><span class="n">product_id</span>
<span class="w">  </span><span class="k">AND</span><span class="w"> </span><span class="n">f2</span><span class="p">.</span><span class="n">friend_id</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="n">me</span><span class="p">.</span><span class="n">id</span><span class="p">;</span>

<span class="c1">-- 이것은 여러 JOIN이 필요하고, 성능은</span>
<span class="c1">-- 순회 깊이에 따라 지수적으로 저하됩니다.</span>
</code></pre></div>

<p><strong>Cypher에서</strong> (Neo4j):</p>
<div class="highlight"><pre><span></span><code><span class="c1">// 동일한 쿼리, 그래프 순회로 자연스럽게 표현</span>
<span class="k">MATCH</span><span class="w"> </span><span class="p">(</span><span class="n">me</span><span class="p">:</span><span class="n">Person</span><span class="w"> </span><span class="p">{</span><span class="n">name</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;Alice&quot;</span><span class="p">})</span><span class="o">-[</span><span class="p">:</span><span class="n">FRIEND</span><span class="o">]-&gt;</span><span class="p">()</span><span class="o">-[</span><span class="p">:</span><span class="n">FRIEND</span><span class="o">]-&gt;</span><span class="p">(</span><span class="n">fof</span><span class="p">:</span><span class="n">Person</span><span class="p">),</span>
<span class="w">      </span><span class="p">(</span><span class="n">me</span><span class="p">)</span><span class="o">-[</span><span class="p">:</span><span class="n">LIKES</span><span class="o">]-&gt;</span><span class="p">(</span><span class="n">product</span><span class="p">:</span><span class="n">Product</span><span class="p">)</span><span class="o">&lt;-[</span><span class="p">:</span><span class="n">LIKES</span><span class="o">]-</span><span class="p">(</span><span class="n">fof</span><span class="p">)</span>
<span class="k">WHERE</span><span class="w"> </span><span class="n">fof</span><span class="w"> </span><span class="p">&lt;&gt;</span><span class="w"> </span><span class="n">me</span>
<span class="k">RETURN</span><span class="w"> </span><span class="k">DISTINCT</span><span class="w"> </span><span class="n">fof</span><span class="p">.</span><span class="n">name</span><span class="p">;</span>
</code></pre></div>

<p><strong>성능 비교</strong>: 관계 중심 쿼리의 경우, 그래프 데이터베이스는 데이터셋 크기에 관계없이 일정한 성능을 유지하지만(순회가 로컬이기 때문), 관계형 데이터베이스는 테이블이 커지면서 성능이 저하됩니다(JOIN이 더 큰 인덱스 구조를 스캔하기 때문).</p>
<div class="highlight"><pre><span></span><code>쿼리 시간
    │
    │  Relational (JOIN 기반)
    │  ╱
    │ ╱
    │╱                    Graph DB (순회 기반)
    │─────────────────────────────────────────
    │
    └──────────────────────────────────────── 데이터 크기
</code></pre></div>

<h3 id="73-cypher">7.3 Cypher 쿼리 언어<a class="header-link" href="#73-cypher" title="Permanent link">&para;</a></h3>
<p>Cypher는 Neo4j의 선언적 그래프 쿼리 언어입니다. 구문은 ASCII 아트를 사용하여 그래프 패턴을 표현합니다.</p>
<p><strong>패턴 구문</strong>:</p>
<div class="highlight"><pre><span></span><code><span class="p">(</span><span class="n">node</span><span class="p">)</span><span class="w">              </span><span class="o">--</span><span class="w"> </span><span class="err">노드</span>
<span class="p">(</span><span class="n">n</span><span class="o">:</span><span class="n">Label</span><span class="p">)</span><span class="w">           </span><span class="o">--</span><span class="w"> </span><span class="err">레이블이</span><span class="w"> </span><span class="err">있는</span><span class="w"> </span><span class="err">노드</span>
<span class="p">(</span><span class="n">n</span><span class="o">:</span><span class="n">Label</span><span class="w"> </span><span class="p">{</span><span class="n">prop</span><span class="o">:</span><span class="w"> </span><span class="n">v</span><span class="p">})</span><span class="w"> </span><span class="o">--</span><span class="w"> </span><span class="err">속성</span><span class="w"> </span><span class="err">필터가</span><span class="w"> </span><span class="err">있는</span><span class="w"> </span><span class="err">노드</span>
<span class="o">-</span><span class="p">[</span><span class="n">r</span><span class="o">:</span><span class="kr">TYPE</span><span class="p">]</span><span class="o">-&gt;</span><span class="w">         </span><span class="o">--</span><span class="w"> </span><span class="err">방향성</span><span class="w"> </span><span class="err">있는</span><span class="w"> </span><span class="err">관계</span>
<span class="o">-</span><span class="p">[</span><span class="n">r</span><span class="o">:</span><span class="kr">TYPE</span><span class="o">*</span><span class="mf">1..3</span><span class="p">]</span><span class="o">-&gt;</span><span class="w">    </span><span class="o">--</span><span class="w"> </span><span class="err">가변</span><span class="w"> </span><span class="err">길이</span><span class="w"> </span><span class="err">경로</span><span class="w"> </span><span class="p">(</span><span class="mi">1</span><span class="o">~</span><span class="mi">3</span><span class="w"> </span><span class="err">홉</span><span class="p">)</span>
</code></pre></div>

<p><strong>CREATE 연산</strong>:</p>
<div class="highlight"><pre><span></span><code><span class="c1">// 노드 생성</span>
<span class="k">CREATE</span><span class="w"> </span><span class="p">(</span><span class="n">alice</span><span class="p">:</span><span class="n">Person</span><span class="w"> </span><span class="p">{</span><span class="n">name</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;Alice&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">age</span><span class="p">:</span><span class="w"> </span><span class="m">30</span><span class="p">})</span>
<span class="k">CREATE</span><span class="w"> </span><span class="p">(</span><span class="n">bob</span><span class="p">:</span><span class="n">Person</span><span class="w"> </span><span class="p">{</span><span class="n">name</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;Bob&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">age</span><span class="p">:</span><span class="w"> </span><span class="m">28</span><span class="p">})</span>
<span class="k">CREATE</span><span class="w"> </span><span class="p">(</span><span class="n">widget</span><span class="p">:</span><span class="n">Product</span><span class="w"> </span><span class="p">{</span><span class="n">name</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;Widget&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">price</span><span class="p">:</span><span class="w"> </span><span class="m">9</span><span class="p">.</span><span class="m">99</span><span class="p">})</span>

<span class="c1">// 관계 생성</span>
<span class="k">MATCH</span><span class="w"> </span><span class="p">(</span><span class="n">alice</span><span class="p">:</span><span class="n">Person</span><span class="w"> </span><span class="p">{</span><span class="n">name</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;Alice&quot;</span><span class="p">}),</span><span class="w"> </span><span class="p">(</span><span class="n">bob</span><span class="p">:</span><span class="n">Person</span><span class="w"> </span><span class="p">{</span><span class="n">name</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;Bob&quot;</span><span class="p">})</span>
<span class="k">CREATE</span><span class="w"> </span><span class="p">(</span><span class="n">alice</span><span class="p">)</span><span class="o">-[</span><span class="p">:</span><span class="n">FOLLOWS</span><span class="w"> </span><span class="p">{</span><span class="n">since</span><span class="p">:</span><span class="w"> </span><span class="n">date</span><span class="p">(</span><span class="s">&quot;2023-01-15&quot;</span><span class="p">)}</span><span class="o">]-&gt;</span><span class="p">(</span><span class="n">bob</span><span class="p">);</span>

<span class="k">MATCH</span><span class="w"> </span><span class="p">(</span><span class="n">alice</span><span class="p">:</span><span class="n">Person</span><span class="w"> </span><span class="p">{</span><span class="n">name</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;Alice&quot;</span><span class="p">}),</span><span class="w"> </span><span class="p">(</span><span class="n">w</span><span class="p">:</span><span class="n">Product</span><span class="w"> </span><span class="p">{</span><span class="n">name</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;Widget&quot;</span><span class="p">})</span>
<span class="k">CREATE</span><span class="w"> </span><span class="p">(</span><span class="n">alice</span><span class="p">)</span><span class="o">-[</span><span class="p">:</span><span class="n">PURCHASED</span><span class="w"> </span><span class="p">{</span><span class="n">date</span><span class="p">:</span><span class="w"> </span><span class="n">date</span><span class="p">(</span><span class="s">&quot;2024-03-20&quot;</span><span class="p">),</span><span class="w"> </span><span class="n">qty</span><span class="p">:</span><span class="w"> </span><span class="m">2</span><span class="p">}</span><span class="o">]-&gt;</span><span class="p">(</span><span class="n">w</span><span class="p">);</span>
</code></pre></div>

<p><strong>READ 연산</strong>:</p>
<div class="highlight"><pre><span></span><code><span class="c1">// Alice가 팔로우하는 모든 사람 찾기</span>
<span class="k">MATCH</span><span class="w"> </span><span class="p">(</span><span class="n">alice</span><span class="p">:</span><span class="n">Person</span><span class="w"> </span><span class="p">{</span><span class="n">name</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;Alice&quot;</span><span class="p">})</span><span class="o">-[</span><span class="p">:</span><span class="n">FOLLOWS</span><span class="o">]-&gt;</span><span class="p">(</span><span class="n">friend</span><span class="p">)</span>
<span class="k">RETURN</span><span class="w"> </span><span class="n">friend</span><span class="p">.</span><span class="n">name</span><span class="p">;</span>

<span class="c1">// 두 사람 사이의 최단 경로 찾기</span>
<span class="k">MATCH</span><span class="w"> </span><span class="n">path</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="n">shortestPath</span><span class="p">(</span>
<span class="w">  </span><span class="p">(</span><span class="n">alice</span><span class="p">:</span><span class="n">Person</span><span class="w"> </span><span class="p">{</span><span class="n">name</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;Alice&quot;</span><span class="p">})</span><span class="o">-[</span><span class="p">:</span><span class="n">FOLLOWS</span><span class="p">*</span><span class="o">]-</span><span class="p">(</span><span class="n">bob</span><span class="p">:</span><span class="n">Person</span><span class="w"> </span><span class="p">{</span><span class="n">name</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;Bob&quot;</span><span class="p">})</span>
<span class="p">)</span>
<span class="k">RETURN</span><span class="w"> </span><span class="n">path</span><span class="p">;</span>

<span class="c1">// 추천: Alice와 같은 제품을 구매한 사람들이 구매한 제품</span>
<span class="k">MATCH</span><span class="w"> </span><span class="p">(</span><span class="n">alice</span><span class="p">:</span><span class="n">Person</span><span class="w"> </span><span class="p">{</span><span class="n">name</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;Alice&quot;</span><span class="p">})</span><span class="o">-[</span><span class="p">:</span><span class="n">PURCHASED</span><span class="o">]-&gt;</span><span class="p">(</span><span class="n">p</span><span class="p">:</span><span class="n">Product</span><span class="p">)</span><span class="o">&lt;-[</span><span class="p">:</span><span class="n">PURCHASED</span><span class="o">]-</span><span class="p">(</span><span class="n">other</span><span class="p">),</span>
<span class="w">      </span><span class="p">(</span><span class="n">other</span><span class="p">)</span><span class="o">-[</span><span class="p">:</span><span class="n">PURCHASED</span><span class="o">]-&gt;</span><span class="p">(</span><span class="n">rec</span><span class="p">:</span><span class="n">Product</span><span class="p">)</span>
<span class="k">WHERE</span><span class="w"> </span><span class="k">NOT</span><span class="w"> </span><span class="p">(</span><span class="n">alice</span><span class="p">)</span><span class="o">-[</span><span class="p">:</span><span class="n">PURCHASED</span><span class="o">]-&gt;</span><span class="p">(</span><span class="n">rec</span><span class="p">)</span>
<span class="k">RETURN</span><span class="w"> </span><span class="n">rec</span><span class="p">.</span><span class="n">name</span><span class="p">,</span><span class="w"> </span><span class="n">COUNT</span><span class="p">(*)</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">score</span>
<span class="k">ORDER</span><span class="w"> </span><span class="k">BY</span><span class="w"> </span><span class="n">score</span><span class="w"> </span><span class="k">DESC</span>
<span class="k">LIMIT</span><span class="w"> </span><span class="m">5</span><span class="p">;</span>

<span class="c1">// PageRank 스타일 영향력: 누가 가장 많은 팔로워를 가지는가?</span>
<span class="k">MATCH</span><span class="w"> </span><span class="p">(</span><span class="n">p</span><span class="p">:</span><span class="n">Person</span><span class="p">)</span><span class="o">&lt;-[</span><span class="p">:</span><span class="n">FOLLOWS</span><span class="o">]-</span><span class="p">(</span><span class="n">follower</span><span class="p">)</span>
<span class="k">RETURN</span><span class="w"> </span><span class="n">p</span><span class="p">.</span><span class="n">name</span><span class="p">,</span><span class="w"> </span><span class="n">COUNT</span><span class="p">(</span><span class="n">follower</span><span class="p">)</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">followers</span>
<span class="k">ORDER</span><span class="w"> </span><span class="k">BY</span><span class="w"> </span><span class="n">followers</span><span class="w"> </span><span class="k">DESC</span>
<span class="k">LIMIT</span><span class="w"> </span><span class="m">10</span><span class="p">;</span>

<span class="c1">// 커뮤니티 감지: 상호 팔로우 클러스터 찾기</span>
<span class="k">MATCH</span><span class="w"> </span><span class="p">(</span><span class="n">a</span><span class="p">:</span><span class="n">Person</span><span class="p">)</span><span class="o">-[</span><span class="p">:</span><span class="n">FOLLOWS</span><span class="o">]-&gt;</span><span class="p">(</span><span class="n">b</span><span class="p">:</span><span class="n">Person</span><span class="p">)</span><span class="o">-[</span><span class="p">:</span><span class="n">FOLLOWS</span><span class="o">]-&gt;</span><span class="p">(</span><span class="n">a</span><span class="p">)</span>
<span class="k">RETURN</span><span class="w"> </span><span class="n">a</span><span class="p">.</span><span class="n">name</span><span class="p">,</span><span class="w"> </span><span class="n">b</span><span class="p">.</span><span class="n">name</span><span class="p">;</span>
</code></pre></div>

<p><strong>UPDATE 및 DELETE</strong>:</p>
<div class="highlight"><pre><span></span><code><span class="c1">// 속성 업데이트</span>
<span class="k">MATCH</span><span class="w"> </span><span class="p">(</span><span class="n">alice</span><span class="p">:</span><span class="n">Person</span><span class="w"> </span><span class="p">{</span><span class="n">name</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;Alice&quot;</span><span class="p">})</span>
<span class="k">SET</span><span class="w"> </span><span class="n">alice</span><span class="p">.</span><span class="n">age</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="m">31</span><span class="p">;</span>

<span class="c1">// 레이블 추가</span>
<span class="k">MATCH</span><span class="w"> </span><span class="p">(</span><span class="n">alice</span><span class="p">:</span><span class="n">Person</span><span class="w"> </span><span class="p">{</span><span class="n">name</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;Alice&quot;</span><span class="p">})</span>
<span class="k">SET</span><span class="w"> </span><span class="n">alice</span><span class="p">:</span><span class="n">PremiumUser</span><span class="p">;</span>

<span class="c1">// 관계 삭제</span>
<span class="k">MATCH</span><span class="w"> </span><span class="p">(</span><span class="n">alice</span><span class="p">:</span><span class="n">Person</span><span class="w"> </span><span class="p">{</span><span class="n">name</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;Alice&quot;</span><span class="p">})</span><span class="o">-[</span><span class="n">r</span><span class="p">:</span><span class="n">FOLLOWS</span><span class="o">]-&gt;</span><span class="p">(</span><span class="n">bob</span><span class="p">:</span><span class="n">Person</span><span class="w"> </span><span class="p">{</span><span class="n">name</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;Bob&quot;</span><span class="p">})</span>
<span class="k">DELETE</span><span class="w"> </span><span class="n">r</span><span class="p">;</span>

<span class="c1">// 노드와 모든 관계 삭제</span>
<span class="k">MATCH</span><span class="w"> </span><span class="p">(</span><span class="n">n</span><span class="p">:</span><span class="n">Person</span><span class="w"> </span><span class="p">{</span><span class="n">name</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;Eve&quot;</span><span class="p">})</span>
<span class="n">DETACH</span><span class="w"> </span><span class="k">DELETE</span><span class="w"> </span><span class="n">n</span><span class="p">;</span>
</code></pre></div>

<h3 id="74">7.4 그래프 사용 사례<a class="header-link" href="#74" title="Permanent link">&para;</a></h3>
<table>
<thead>
<tr>
<th>사용 사례</th>
<th>그래프가 뛰어난 이유</th>
</tr>
</thead>
<tbody>
<tr>
<td><strong>소셜 네트워크</strong></td>
<td>친구의 친구 쿼리, 영향력, 커뮤니티 감지</td>
</tr>
<tr>
<td><strong>추천 엔진</strong></td>
<td>그래프 순회를 통한 협업 필터링</td>
</tr>
<tr>
<td><strong>사기 탐지</strong></td>
<td>거래 네트워크에서 의심스러운 패턴 식별</td>
</tr>
<tr>
<td><strong>지식 그래프</strong></td>
<td>엔티티와 관계 표현 (Google Knowledge Graph, Wikidata)</td>
</tr>
<tr>
<td><strong>네트워크/IT 운영</strong></td>
<td>네트워크 토폴로지 모델링, 종속성 추적, 근본 원인 분석</td>
</tr>
<tr>
<td><strong>공급망</strong></td>
<td>제조, 배송, 유통을 통한 제품 추적</td>
</tr>
<tr>
<td><strong>액세스 제어</strong></td>
<td>권한 계층 구조 및 상속 모델링</td>
</tr>
<tr>
<td><strong>생물학</strong></td>
<td>단백질 상호작용 네트워크, 유전자 조절 네트워크</td>
</tr>
</tbody>
</table>
<h3 id="75">7.5 그래프 데이터베이스의 한계<a class="header-link" href="#75" title="Permanent link">&para;</a></h3>
<ul>
<li><strong>집계에 적합하지 않음</strong>: SUM, AVG, GROUP BY는 그래프가 빛나는 곳이 아님</li>
<li><strong>저장 오버헤드</strong>: 모든 엣지에 대한 관계 포인터 저장은 관계형 외래 키보다 더 많은 공간 사용</li>
<li><strong>제한된 수평 확장</strong>: 고도로 연결된 그래프를 노드 간에 분할하는 것은 NP-hard 문제(그래프 분할)</li>
<li><strong>작은 생태계</strong>: 관계형 또는 문서 데이터베이스에 비해 도구, 개발자, 커뮤니티 지원이 적음</li>
<li><strong>쓰기 처리량</strong>: 일반적으로 키-값 또는 와이드 컬럼 저장소보다 낮음</li>
</ul>
<hr />
<h2 id="8">8. 비교 매트릭스: 어떤 모델을 사용할지<a class="header-link" href="#8" title="Permanent link">&para;</a></h2>
<h3 id="81">8.1 결정 매트릭스<a class="header-link" href="#81" title="Permanent link">&para;</a></h3>
<table>
<thead>
<tr>
<th>기준</th>
<th>키-값</th>
<th>문서</th>
<th>와이드 컬럼</th>
<th>그래프</th>
<th>관계형</th>
</tr>
</thead>
<tbody>
<tr>
<td><strong>스키마 유연성</strong></td>
<td>높음 (불투명 값)</td>
<td>높음 (JSON)</td>
<td>중간 (컬럼 패밀리 고정)</td>
<td>높음 (속성 그래프)</td>
<td>낮음 (고정 스키마)</td>
</tr>
<tr>
<td><strong>쿼리 복잡성</strong></td>
<td>키 조회만</td>
<td>필드에 대한 풍부한 쿼리</td>
<td>파티션 키 기반</td>
<td>그래프 순회</td>
<td>전체 SQL</td>
</tr>
<tr>
<td><strong>관계</strong></td>
<td>없음</td>
<td>임베디드/참조</td>
<td>비정규화</td>
<td>일등급</td>
<td>JOIN</td>
</tr>
<tr>
<td><strong>쓰기 처리량</strong></td>
<td>매우 높음</td>
<td>높음</td>
<td>매우 높음</td>
<td>중간</td>
<td>중간</td>
</tr>
<tr>
<td><strong>읽기 지연</strong></td>
<td>밀리초 미만</td>
<td>낮음</td>
<td>낮음 (파티션 키)</td>
<td>가변 (깊이)</td>
<td>가변</td>
</tr>
<tr>
<td><strong>수평 확장</strong></td>
<td>우수</td>
<td>좋음</td>
<td>우수</td>
<td>제한적</td>
<td>나쁨</td>
</tr>
<tr>
<td><strong>ACID 트랜잭션</strong></td>
<td>제한적</td>
<td>문서당 (일부에서 다중 문서)</td>
<td>제한적</td>
<td>노드당 (일부는 다중 지원)</td>
<td>전체</td>
</tr>
<tr>
<td><strong>집계</strong></td>
<td>없음</td>
<td>집계 파이프라인</td>
<td>제한적</td>
<td>제한적</td>
<td>전체 SQL</td>
</tr>
</tbody>
</table>
<h3 id="82">8.2 결정 플로우차트<a class="header-link" href="#82" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code>                         주요 요구사항은 무엇인가?
                                   │
                ┌──────────────────┼──────────────────┐
                │                  │                  │
          고속               구조화된           복잡한
          단순 조회           데이터에 대한      관계
                │            풍부한 쿼리             │
                │                  │                  │
           키-값              문서              그래프 DB
           (Redis,            (MongoDB,          (Neo4j,
            DynamoDB)          CouchDB)           Neptune)
                                   │
                              대규모 쓰기
                              필요?
                              ┌────┴────┐
                              │         │
                             예        아니오
                              │         │
                         와이드 컬럼    문서
                         (Cassandra)  (MongoDB)
</code></pre></div>

<h3 id="83">8.3 구체적 권장사항<a class="header-link" href="#83" title="Permanent link">&para;</a></h3>
<table>
<thead>
<tr>
<th>시나리오</th>
<th>권장 모델</th>
<th>이유</th>
</tr>
</thead>
<tbody>
<tr>
<td>사용자 세션</td>
<td>키-값 (Redis)</td>
<td>TTL이 있는 단순 GET/SET</td>
</tr>
<tr>
<td>제품 카탈로그</td>
<td>문서 (MongoDB)</td>
<td>제품 카테고리별 유연한 속성</td>
</tr>
<tr>
<td>IoT 시계열</td>
<td>와이드 컬럼 (Cassandra)</td>
<td>대규모 쓰기 처리량, 시간순 파티션</td>
</tr>
<tr>
<td>소셜 그래프</td>
<td>그래프 (Neo4j)</td>
<td>관계 순회가 핵심 작업</td>
</tr>
<tr>
<td>금융 거래</td>
<td>관계형 (PostgreSQL)</td>
<td>ACID 준수 필수</td>
</tr>
<tr>
<td>콘텐츠 관리</td>
<td>문서 (MongoDB)</td>
<td>중첩되고 가변적인 구조</td>
</tr>
<tr>
<td>실시간 분석</td>
<td>와이드 컬럼 + 키-값</td>
<td>저장용 Cassandra, 캐싱용 Redis</td>
</tr>
<tr>
<td>사기 탐지</td>
<td>그래프 (Neo4j)</td>
<td>거래 네트워크에서 패턴 매칭</td>
</tr>
<tr>
<td>쇼핑 카트</td>
<td>키-값 (Redis) 또는 문서</td>
<td>빠른 읽기/쓰기, 유연한 구조</td>
</tr>
<tr>
<td>추천 엔진</td>
<td>그래프 + 문서</td>
<td>관계용 그래프, 항목 메타데이터용 문서</td>
</tr>
</tbody>
</table>
<hr />
<h2 id="9">9. 폴리글랏 지속성<a class="header-link" href="#9" title="Permanent link">&para;</a></h2>
<h3 id="91">9.1 정의<a class="header-link" href="#91" title="Permanent link">&para;</a></h3>
<p>폴리글랏 지속성(Polyglot Persistence)은 애플리케이션의 각 구성 요소의 특정 액세스 패턴과 요구사항에 따라 다른 데이터 저장 기술을 사용하는 관행입니다.</p>
<p>이 용어는 Martin Fowler와 Pramod Sadalage가 2011년에 만들었습니다.</p>
<h3 id="92">9.2 아키텍처 예제<a class="header-link" href="#92" title="Permanent link">&para;</a></h3>
<p>전자상거래 플랫폼을 고려하세요:</p>
<div class="highlight"><pre><span></span><code>┌─────────────────────────────────────────────────────────────────┐
│                    전자상거래 플랫폼                             │
│                                                                 │
│  ┌──────────────┐  ┌──────────────┐  ┌────────────────┐        │
│  │  Product      │  │  Order       │  │  User          │        │
│  │  Service      │  │  Service     │  │  Service       │        │
│  └──────┬───────┘  └──────┬───────┘  └───────┬────────┘        │
│         │                 │                   │                  │
│         ▼                 ▼                   ▼                  │
│  ┌──────────────┐  ┌──────────────┐  ┌────────────────┐        │
│  │  MongoDB     │  │  PostgreSQL  │  │  PostgreSQL    │        │
│  │  (Catalog)   │  │  (Orders)    │  │  (Users)       │        │
│  │              │  │  ACID txns   │  │  Auth + RBAC   │        │
│  └──────────────┘  └──────────────┘  └────────────────┘        │
│                                                                 │
│  ┌──────────────┐  ┌──────────────┐  ┌────────────────┐        │
│  │  Redis       │  │  Neo4j       │  │  Elasticsearch │        │
│  │  (Cache +    │  │  (Recom-     │  │  (Search)      │        │
│  │   Sessions)  │  │   mendations)│  │                │        │
│  └──────────────┘  └──────────────┘  └────────────────┘        │
│                                                                 │
│  ┌──────────────┐  ┌──────────────┐                             │
│  │  Cassandra   │  │  S3 / Blob   │                             │
│  │  (Analytics  │  │  (Images,    │                             │
│  │   Events)    │  │   Files)     │                             │
│  └──────────────┘  └──────────────┘                             │
└─────────────────────────────────────────────────────────────────┘
</code></pre></div>

<h3 id="93">9.3 이점<a class="header-link" href="#93" title="Permanent link">&para;</a></h3>
<ul>
<li><strong>최적화된 성능</strong>: 각 서비스가 액세스 패턴에 가장 적합한 데이터베이스 사용</li>
<li><strong>독립적 확장</strong>: 워크로드에 따라 각 데이터베이스를 독립적으로 확장</li>
<li><strong>기술 유연성</strong>: 팀이 특정 문제에 최적의 도구 채택 가능</li>
</ul>
<h3 id="94">9.4 과제<a class="header-link" href="#94" title="Permanent link">&para;</a></h3>
<ul>
<li><strong>운영 복잡성</strong>: 여러 데이터베이스 기술은 다양한 전문지식 필요</li>
<li><strong>데이터 일관성</strong>: 데이터베이스 간 데이터 동기화가 어려움</li>
<li><strong>모니터링 및 디버깅</strong>: 다른 모니터링 도구, 다른 로그 형식</li>
<li><strong>교차 저장소 쿼리</strong>: MongoDB와 PostgreSQL의 데이터를 조인하려면 애플리케이션 수준 로직 필요</li>
<li><strong>트랜잭션 경계</strong>: 단일 비즈니스 작업이 여러 데이터베이스에 걸쳐 있을 수 있음 (예: "주문하기"는 PostgreSQL에 주문을 쓰고 Redis에 캐시를 씀)</li>
</ul>
<h3 id="95">9.5 과제 완화<a class="header-link" href="#95" title="Permanent link">&para;</a></h3>
<table>
<thead>
<tr>
<th>과제</th>
<th>완화 전략</th>
</tr>
</thead>
<tbody>
<tr>
<td>데이터 일관성</td>
<td>최종 일관성을 위한 이벤트 기반 아키텍처 (Kafka/RabbitMQ)</td>
</tr>
<tr>
<td>교차 저장소 쿼리</td>
<td>애플리케이션/게이트웨이 레이어에서 API 구성</td>
</tr>
<tr>
<td>운영 복잡성</td>
<td>공유 인프라를 가진 플랫폼 팀 (Kubernetes, Terraform)</td>
</tr>
<tr>
<td>트랜잭션 경계</td>
<td>분산 트랜잭션을 위한 Saga 패턴 또는 outbox 패턴</td>
</tr>
<tr>
<td>모니터링</td>
<td>통합 관찰성 (OpenTelemetry, Grafana)</td>
</tr>
</tbody>
</table>
<h3 id="96">9.6 폴리글랏 지속성을 사용하지 말아야 할 때<a class="header-link" href="#96" title="Permanent link">&para;</a></h3>
<ul>
<li><strong>작은 팀</strong>: 운영 오버헤드가 정당화되지 않음</li>
<li><strong>단순한 애플리케이션</strong>: 단일 PostgreSQL 인스턴스가 대부분의 워크로드를 잘 처리</li>
<li><strong>엄격한 일관성 요구사항</strong>: 여러 데이터베이스는 전역 일관성을 거의 불가능하게 만듦</li>
<li><strong>초기 단계 스타트업</strong>: 조기 최적화; 하나의 데이터베이스로 시작하고 나중에 분할</li>
</ul>
<blockquote>
<p><strong>경험 법칙</strong>: 모든 것에 PostgreSQL로 시작하세요. 특정하고 측정 가능한 한계(성능, 규모, 데이터 모델 불일치)에 도달하면, 그 특정 사용 사례를 위한 특수 데이터베이스 도입을 고려하세요.</p>
</blockquote>
<hr />
<h2 id="10">10. 연습문제<a class="header-link" href="#10" title="Permanent link">&para;</a></h2>
<h3 id="1-cap">연습문제 1: CAP 정리 분석<a class="header-link" href="#1-cap" title="Permanent link">&para;</a></h3>
<p>다음 각 시스템에 대해 CP 또는 AP로 분류하세요. 답을 정당화하세요.</p>
<ol>
<li>계좌 간 송금을 처리하는 은행 시스템.</li>
<li>대략적인 카운트를 표시하는 소셜 미디어 "좋아요" 카운터.</li>
<li>DNS 시스템.</li>
<li>분산 구성 저장소 (etcd 또는 ZooKeeper 같은).</li>
<li>쇼핑 카트 서비스.</li>
</ol>
<h3 id="2">연습문제 2: 데이터 모델 선택<a class="header-link" href="#2" title="Permanent link">&para;</a></h3>
<p>다음 각 시나리오에 대해 가장 적절한 NoSQL 데이터 모델(키-값, 문서, 와이드 컬럼, 그래프)을 선택하고 기본 스키마를 설계하세요.</p>
<ol>
<li>
<p><strong>실시간 멀티플레이어 게임</strong>: 100,000명의 동시 플레이어에 대한 플레이어 위치, 점수, 게임 상태 저장. 업데이트는 플레이어당 초당 60회 발생.</p>
</li>
<li>
<p><strong>레시피 웹사이트</strong>: 가변 재료, 단계, 영양 정보, 사용자 평가 및 댓글이 있는 레시피 저장. 사용자가 재료로 검색할 수 있어야 함.</p>
</li>
<li>
<p><strong>족보 애플리케이션</strong>: 수세기에 걸친 부모-자녀 관계, 결혼, 역사적 기록이 있는 가계도 저장.</p>
</li>
<li>
<p><strong>IoT 차량 관리</strong>: 5초마다 샘플링된 50,000대 차량의 GPS 좌표, 속도, 연료 레벨 저장.</p>
</li>
</ol>
<h3 id="3-redis">연습문제 3: Redis 설계<a class="header-link" href="#3-redis" title="Permanent link">&para;</a></h3>
<p>다음 요구사항을 가진 속도 제한기를 위한 Redis 데이터 모델을 설계하세요:
- 사용자당 분당 100개의 API 요청 허용
- 각 응답과 함께 남은 요청 수 반환
- 각 분 윈도우 시작 시 카운터 재설정</p>
<p>Redis 명령을 사용하여 <code>check_rate_limit(user_id)</code> 함수의 의사 코드를 작성하세요.</p>
<h3 id="4-mongodb">연습문제 4: MongoDB 스키마 설계<a class="header-link" href="#4-mongodb" title="Permanent link">&para;</a></h3>
<p>블로그 플랫폼을 구축하고 있습니다. 다음 액세스 패턴을 고려하여 MongoDB 스키마를 설계하세요:
1. 모든 댓글과 함께 블로그 게시물 표시
2. 특정 작성자의 최근 게시물 10개 표시
3. 모든 작성자의 최근 게시물 10개 표시
4. 게시물당 총 댓글 수 계산</p>
<p>고려사항:
- 게시물은 0~10,000개의 댓글을 가질 수 있음
- 댓글은 답글을 가질 수 있음 (최대 3단계 깊이)
- 작성자는 이름, 소개, 아바타가 있는 프로필을 가짐</p>
<p>JSON 문서 예제로 스키마를 제공하고 임베딩 vs 참조 결정을 설명하세요.</p>
<h3 id="5-cassandra">연습문제 5: Cassandra 데이터 모델링<a class="header-link" href="#5-cassandra" title="Permanent link">&para;</a></h3>
<p>다음 쿼리를 가진 메시징 애플리케이션을 위한 Cassandra 스키마를 설계하세요:
1. 대화의 모든 메시지를 타임스탬프순으로 가져오기 (최신순)
2. 사용자의 모든 대화를 마지막 활동순으로 가져오기
3. 사용자의 대화당 읽지 않은 메시지 수 가져오기</p>
<p>CQL CREATE TABLE 문을 작성하고 파티션 키 및 클러스터링 키 선택을 설명하세요.</p>
<h3 id="6-cypher">연습문제 6: Cypher 쿼리<a class="header-link" href="#6-cypher" title="Permanent link">&para;</a></h3>
<p>다음 그래프가 주어졌을 때:</p>
<div class="highlight"><pre><span></span><code><span class="p">(</span><span class="o">:</span><span class="n">Person</span><span class="w"> </span><span class="p">{</span><span class="n">name</span><span class="o">:</span><span class="w"> </span><span class="s">&quot;Alice&quot;</span><span class="p">})</span><span class="o">-</span><span class="p">[</span><span class="o">:</span><span class="n">WORKS_AT</span><span class="p">]</span><span class="o">-&gt;</span><span class="p">(</span><span class="o">:</span><span class="n">Company</span><span class="w"> </span><span class="p">{</span><span class="n">name</span><span class="o">:</span><span class="w"> </span><span class="s">&quot;TechCorp&quot;</span><span class="p">})</span>
<span class="p">(</span><span class="o">:</span><span class="n">Person</span><span class="w"> </span><span class="p">{</span><span class="n">name</span><span class="o">:</span><span class="w"> </span><span class="s">&quot;Bob&quot;</span><span class="p">})</span><span class="o">-</span><span class="p">[</span><span class="o">:</span><span class="n">WORKS_AT</span><span class="p">]</span><span class="o">-&gt;</span><span class="p">(</span><span class="o">:</span><span class="n">Company</span><span class="w"> </span><span class="p">{</span><span class="n">name</span><span class="o">:</span><span class="w"> </span><span class="s">&quot;TechCorp&quot;</span><span class="p">})</span>
<span class="p">(</span><span class="o">:</span><span class="n">Person</span><span class="w"> </span><span class="p">{</span><span class="n">name</span><span class="o">:</span><span class="w"> </span><span class="s">&quot;Charlie&quot;</span><span class="p">})</span><span class="o">-</span><span class="p">[</span><span class="o">:</span><span class="n">WORKS_AT</span><span class="p">]</span><span class="o">-&gt;</span><span class="p">(</span><span class="o">:</span><span class="n">Company</span><span class="w"> </span><span class="p">{</span><span class="n">name</span><span class="o">:</span><span class="w"> </span><span class="s">&quot;DataInc&quot;</span><span class="p">})</span>
<span class="p">(</span><span class="o">:</span><span class="n">Person</span><span class="w"> </span><span class="p">{</span><span class="n">name</span><span class="o">:</span><span class="w"> </span><span class="s">&quot;Alice&quot;</span><span class="p">})</span><span class="o">-</span><span class="p">[</span><span class="o">:</span><span class="n">KNOWS</span><span class="p">]</span><span class="o">-</span><span class="p">(</span><span class="o">:</span><span class="n">Person</span><span class="w"> </span><span class="p">{</span><span class="n">name</span><span class="o">:</span><span class="w"> </span><span class="s">&quot;Bob&quot;</span><span class="p">})</span>
<span class="p">(</span><span class="o">:</span><span class="n">Person</span><span class="w"> </span><span class="p">{</span><span class="n">name</span><span class="o">:</span><span class="w"> </span><span class="s">&quot;Bob&quot;</span><span class="p">})</span><span class="o">-</span><span class="p">[</span><span class="o">:</span><span class="n">KNOWS</span><span class="p">]</span><span class="o">-</span><span class="p">(</span><span class="o">:</span><span class="n">Person</span><span class="w"> </span><span class="p">{</span><span class="n">name</span><span class="o">:</span><span class="w"> </span><span class="s">&quot;Charlie&quot;</span><span class="p">})</span>
<span class="p">(</span><span class="o">:</span><span class="n">Person</span><span class="w"> </span><span class="p">{</span><span class="n">name</span><span class="o">:</span><span class="w"> </span><span class="s">&quot;Alice&quot;</span><span class="p">})</span><span class="o">-</span><span class="p">[</span><span class="o">:</span><span class="n">KNOWS</span><span class="p">]</span><span class="o">-</span><span class="p">(</span><span class="o">:</span><span class="n">Person</span><span class="w"> </span><span class="p">{</span><span class="n">name</span><span class="o">:</span><span class="w"> </span><span class="s">&quot;Diana&quot;</span><span class="p">})</span>
<span class="p">(</span><span class="o">:</span><span class="n">Person</span><span class="w"> </span><span class="p">{</span><span class="n">name</span><span class="o">:</span><span class="w"> </span><span class="s">&quot;Diana&quot;</span><span class="p">})</span><span class="o">-</span><span class="p">[</span><span class="o">:</span><span class="n">WORKS_AT</span><span class="p">]</span><span class="o">-&gt;</span><span class="p">(</span><span class="o">:</span><span class="n">Company</span><span class="w"> </span><span class="p">{</span><span class="n">name</span><span class="o">:</span><span class="w"> </span><span class="s">&quot;DataInc&quot;</span><span class="p">})</span>
<span class="p">(</span><span class="o">:</span><span class="n">Person</span><span class="w"> </span><span class="p">{</span><span class="n">name</span><span class="o">:</span><span class="w"> </span><span class="s">&quot;Alice&quot;</span><span class="p">})</span><span class="o">-</span><span class="p">[</span><span class="o">:</span><span class="n">SKILL</span><span class="p">]</span><span class="o">-&gt;</span><span class="p">(</span><span class="o">:</span><span class="n">Technology</span><span class="w"> </span><span class="p">{</span><span class="n">name</span><span class="o">:</span><span class="w"> </span><span class="s">&quot;Python&quot;</span><span class="p">})</span>
<span class="p">(</span><span class="o">:</span><span class="n">Person</span><span class="w"> </span><span class="p">{</span><span class="n">name</span><span class="o">:</span><span class="w"> </span><span class="s">&quot;Bob&quot;</span><span class="p">})</span><span class="o">-</span><span class="p">[</span><span class="o">:</span><span class="n">SKILL</span><span class="p">]</span><span class="o">-&gt;</span><span class="p">(</span><span class="o">:</span><span class="n">Technology</span><span class="w"> </span><span class="p">{</span><span class="n">name</span><span class="o">:</span><span class="w"> </span><span class="s">&quot;Python&quot;</span><span class="p">})</span>
<span class="p">(</span><span class="o">:</span><span class="n">Person</span><span class="w"> </span><span class="p">{</span><span class="n">name</span><span class="o">:</span><span class="w"> </span><span class="s">&quot;Bob&quot;</span><span class="p">})</span><span class="o">-</span><span class="p">[</span><span class="o">:</span><span class="n">SKILL</span><span class="p">]</span><span class="o">-&gt;</span><span class="p">(</span><span class="o">:</span><span class="n">Technology</span><span class="w"> </span><span class="p">{</span><span class="n">name</span><span class="o">:</span><span class="w"> </span><span class="s">&quot;Java&quot;</span><span class="p">})</span>
<span class="p">(</span><span class="o">:</span><span class="n">Person</span><span class="w"> </span><span class="p">{</span><span class="n">name</span><span class="o">:</span><span class="w"> </span><span class="s">&quot;Charlie&quot;</span><span class="p">})</span><span class="o">-</span><span class="p">[</span><span class="o">:</span><span class="n">SKILL</span><span class="p">]</span><span class="o">-&gt;</span><span class="p">(</span><span class="o">:</span><span class="n">Technology</span><span class="w"> </span><span class="p">{</span><span class="n">name</span><span class="o">:</span><span class="w"> </span><span class="s">&quot;Python&quot;</span><span class="p">})</span>
<span class="p">(</span><span class="o">:</span><span class="n">Person</span><span class="w"> </span><span class="p">{</span><span class="n">name</span><span class="o">:</span><span class="w"> </span><span class="s">&quot;Diana&quot;</span><span class="p">})</span><span class="o">-</span><span class="p">[</span><span class="o">:</span><span class="n">SKILL</span><span class="p">]</span><span class="o">-&gt;</span><span class="p">(</span><span class="o">:</span><span class="n">Technology</span><span class="w"> </span><span class="p">{</span><span class="n">name</span><span class="o">:</span><span class="w"> </span><span class="s">&quot;Java&quot;</span><span class="p">})</span>
</code></pre></div>

<p>다음에 대한 Cypher 쿼리를 작성하세요:
1. "DataInc"에서 일하는 사람을 아는 모든 사람 찾기 (DataInc에서 직접 일하지 않는).
2. Bob과 최소 2개의 기술을 공유하는 모든 사람 찾기.
3. Alice와 Charlie 사이의 최단 경로 찾기.
4. Alice의 연결이 일하는 곳을 기반으로 Alice에게 회사 추천 (자신의 회사 제외).</p>
<h3 id="7_1">연습문제 7: 폴리글랏 지속성 설계<a class="header-link" href="#7_1" title="Permanent link">&para;</a></h3>
<p>차량 공유 플랫폼(Uber/Lyft와 유사)을 설계하고 있습니다. 애플리케이션에는 다음이 필요합니다:
- 실시간 운전자 위치 추적 (2초마다 업데이트)
- 승차 예약 및 결제 처리
- 평점이 있는 운전자 및 승객 프로필
- 경로 계산 및 ETA 추정
- 승차 기록 및 분석
- 사기 탐지 (승차 요청의 의심스러운 패턴 식별)</p>
<p>폴리글랏 지속성 아키텍처를 설계하세요:
1. 각 데이터 도메인과 액세스 패턴 식별.
2. 각 도메인에 대한 데이터베이스 기술 선택. 선택을 정당화.
3. 서비스 간 데이터 흐름을 보여주는 아키텍처 다이어그램 그리기.
4. 주요 데이터 일관성 과제 식별 및 솔루션 제안.</p>
<h3 id="8-cap">연습문제 8: CAP 정리 증명 확장<a class="header-link" href="#8-cap" title="Permanent link">&para;</a></h3>
<p>섹션 2.3의 Gilbert-Lynch 증명 스케치를 확장하여 <strong>3-노드</strong> 시스템(N1, N2, N3)도 네트워크가 {N1}과 {N2, N3}의 두 그룹으로 분할될 때 C, A, P를 동시에 만족할 수 없음을 보이세요.</p>
<p>구체적으로:
1. 초기 상태 정의.
2. 파티션 설명.
3. 소수 파티션(N1)에 대한 쓰기 표시.
4. 다수 파티션(N2 또는 N3)에서의 읽기 표시.
5. 모순 식별.</p>
<h3 id="9_1">연습문제 9: 일관성 모델 분류<a class="header-link" href="#9_1" title="Permanent link">&para;</a></h3>
<p>아래 각 시나리오에 대해 필요한 최소 일관성 모델 결정 (가장 강함에서 가장 약함으로: 선형화 가능성, 순차 일관성, 인과 일관성, read-your-writes, 최종 일관성):</p>
<ol>
<li>사용자가 프로필 사진을 업데이트하고 즉시 프로필 페이지를 봄.</li>
<li>그룹 채팅에서 Alice가 Bob의 메시지에 답장하면, 모든 사람이 Alice의 답장 전에 Bob의 메시지를 봐야 함.</li>
<li>재고 시스템이 절대 제품을 과다 판매해서는 안 됨.</li>
<li>약간 부정확할 수 있지만 결국 모든 좋아요를 반영해야 하는 "좋아요" 카운터.</li>
<li>사용자가 항상 보낸 편지함 폴더에서 보낸 메시지를 보는 이메일 시스템.</li>
</ol>
<h3 id="10_1">연습문제 10: 비교 분석<a class="header-link" href="#10_1" title="Permanent link">&para;</a></h3>
<p>다음을 사용하여 대학 등록 시스템(학생, 과정, 등록, 교수, 학과)을 모델링하는 방법을 비교하는 500단어 에세이를 작성하세요:
1. 관계형 데이터베이스 (PostgreSQL)
2. 문서 데이터베이스 (MongoDB)
3. 그래프 데이터베이스 (Neo4j)</p>
<p>각 모델에 대해:
- 스키마 그리기/설명
- 두 가지 대표적인 쿼리 작성
- 이 사용 사례에 대한 모델의 장점 하나와 단점 하나 나열</p>
<hr />
<h2 id="11">11. 참고문헌<a class="header-link" href="#11" title="Permanent link">&para;</a></h2>
<ol>
<li>Brewer, E. (2000). "Towards Robust Distributed Systems" (CAP Theorem keynote). ACM PODC.</li>
<li>Gilbert, S. &amp; Lynch, N. (2002). "Brewer's Conjecture and the Feasibility of Consistent, Available, Partition-Tolerant Web Services." ACM SIGACT News.</li>
<li>DeCandia, G. et al. (2007). "Dynamo: Amazon's Highly Available Key-Value Store." SOSP.</li>
<li>Chang, F. et al. (2006). "Bigtable: A Distributed Storage System for Structured Data." OSDI.</li>
<li>Cattell, R. (2011). "Scalable SQL and NoSQL Data Stores." ACM SIGMOD Record.</li>
<li>Sadalage, P. &amp; Fowler, M. (2012). <em>NoSQL Distilled</em>. Addison-Wesley.</li>
<li>Robinson, I., Webber, J., &amp; Eifrem, E. (2015). <em>Graph Databases</em>. O'Reilly Media.</li>
<li>Abadi, D. (2012). "Consistency Tradeoffs in Modern Distributed Database System Design." IEEE Computer.</li>
<li>MongoDB Manual. "Data Modeling Introduction." https://www.mongodb.com/docs/manual/core/data-modeling-introduction/</li>
<li>Apache Cassandra Documentation. https://cassandra.apache.org/doc/latest/</li>
</ol>
<hr />
<p><strong>이전</strong>: <a href="./12_Concurrency_Control.md">12. 동시성 제어</a> | <strong>다음</strong>: <a href="./14_Distributed_Databases.md">14. 분산 데이터베이스</a></p>
    </div>

    
<div class="lesson-toolbar lesson-toolbar--bottom">
    <div class="toolbar-nav toolbar-nav--prev">
        
        <a href="/study/ko/Database_Theory/12_Recovery_Systems.html" class="nav-prev">
            <span class="nav-label">Previous</span>
            <span class="nav-title">12. 복구 시스템</span>
        </a>
        
    </div>
    <div class="toolbar-actions">
        <button class="btn btn-copy-link" data-action="copy-link" title="Copy link">
            <span class="icon">🔗</span>
            <span class="text">Copy link</span>
        </button>
        <a href="/study/ko/Database_Theory/" class="btn btn-topic-link" title="Back to topic list">
            <span class="icon">📋</span>
            <span class="text">Topic list</span>
        </a>
    </div>
    <div class="toolbar-nav toolbar-nav--next">
        
        <a href="/study/ko/Database_Theory/14_Distributed_Databases.html" class="nav-next">
            <span class="nav-label">Next</span>
            <span class="nav-title">분산 데이터베이스</span>
        </a>
        
    </div>
</div>


    <div class="toolbar-keyboard-hint">
        <kbd>&larr;</kbd> <kbd>&rarr;</kbd> to navigate between lessons
    </div>
</article>

<!-- Scroll to top floating button -->
<button class="scroll-to-top" id="scroll-to-top" title="Scroll to top" aria-label="Scroll to top">↑</button>

            </div>
        </main>
    </div>

    <script src="/study/static/js/app.js"></script>
    <script>
        function switchLanguage(newLang) {
            const path = window.location.pathname;
            const base = '/study';
            const currentLang = 'ko';
            const newPath = path.replace(base + '/' + currentLang + '/', base + '/' + newLang + '/');
            window.location.href = newPath + window.location.search;
        }
    </script>
    
<script>
    document.addEventListener('DOMContentLoaded', function() {
        // Copy link - independent feedback per button
        document.querySelectorAll('[data-action="copy-link"]').forEach(function(btn) {
            btn.addEventListener('click', function() {
                navigator.clipboard.writeText(window.location.href);
                var textEl = this.querySelector('.text');
                var originalText = textEl.textContent;
                textEl.textContent = 'Copied!';
                setTimeout(function() { textEl.textContent = originalText; }, 2000);
            });
        });

        // Add copy buttons to code blocks
        document.querySelectorAll('.lesson-content pre').forEach(function(pre) {
            var copyBtn = document.createElement('button');
            copyBtn.className = 'code-copy-btn';
            copyBtn.textContent = 'Copy';
            copyBtn.addEventListener('click', function() {
                var code = pre.querySelector('code');
                var text = code ? code.textContent : pre.textContent;
                navigator.clipboard.writeText(text);
                copyBtn.textContent = 'Copied!';
                setTimeout(function() { copyBtn.textContent = 'Copy'; }, 2000);
            });
            pre.style.position = 'relative';
            pre.appendChild(copyBtn);
        });

        // Scroll to top button
        var scrollBtn = document.getElementById('scroll-to-top');
        window.addEventListener('scroll', function() {
            scrollBtn.classList.toggle('visible', window.scrollY > 300);
        });
        scrollBtn.addEventListener('click', function() {
            window.scrollTo({ top: 0, behavior: 'smooth' });
        });

        // Keyboard shortcuts: left/right arrows for lesson navigation
        document.addEventListener('keydown', function(e) {
            var tag = document.activeElement.tagName;
            if (tag === 'INPUT' || tag === 'TEXTAREA' || tag === 'SELECT') return;

            if (e.key === 'ArrowLeft') {
                var prevLink = document.querySelector('.nav-prev');
                if (prevLink) prevLink.click();
            } else if (e.key === 'ArrowRight') {
                var nextLink = document.querySelector('.nav-next');
                if (nextLink) nextLink.click();
            }
        });
    });
</script>

</body>
</html>
{% endraw %}