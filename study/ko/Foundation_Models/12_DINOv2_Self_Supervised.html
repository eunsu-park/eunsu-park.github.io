{% raw %}
<!DOCTYPE html>
<html lang="ko" data-theme="light">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>DINOv2 & Self-Supervised Vision - Study Materials</title>
    <link rel="stylesheet" href="/study/static/css/style.css">
    <link rel="stylesheet" href="/study/static/css/highlight.css">
    <!-- KaTeX for LaTeX math rendering -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.16.11/dist/katex.min.css">
    <script defer src="https://cdn.jsdelivr.net/npm/katex@0.16.11/dist/katex.min.js"></script>
    <script defer src="https://cdn.jsdelivr.net/npm/katex@0.16.11/dist/contrib/auto-render.min.js"
        onload="renderMathInElement(document.body, {
            delimiters: [
                {left: '$$', right: '$$', display: true},
                {left: '$', right: '$', display: false}
            ],
            throwOnError: false
        });"></script>
    
</head>
<body>
    <div class="app-container">
        <!-- Sidebar -->
        <aside class="sidebar" id="sidebar">
            <div class="sidebar-header">
                <a href="/study/ko/" class="logo">Study Materials</a>
                <button class="sidebar-toggle" id="sidebar-toggle" aria-label="Toggle sidebar">
                    <span></span>
                </button>
            </div>

            <nav class="sidebar-nav">
                <a href="/study/ko/" class="nav-item ">
                    <span class="nav-icon">ğŸ </span>
                    <span class="nav-text">Home</span>
                </a>
                <a href="/study/examples/" class="nav-item ">
                    <span class="nav-icon">ğŸ’»</span>
                    <span class="nav-text">Examples</span>
                </a>
            </nav>

            <div class="sidebar-search">
                <form action="/study/ko/search.html" method="get" id="search-form">
                    <input type="search" name="q" placeholder="Search..." id="search-sidebar-input">
                </form>
            </div>

            <!-- Language Selector -->
            <div class="sidebar-lang">
                <select id="lang-select" class="lang-selector" onchange="switchLanguage(this.value)">
                    
                    <option value="en" >
                        English
                    </option>
                    
                    <option value="ko" selected>
                        í•œêµ­ì–´
                    </option>
                    
                </select>
            </div>

            <div class="sidebar-footer">
                <button class="theme-toggle" id="theme-toggle" aria-label="Toggle theme">
                    <span class="theme-icon light">â˜€ï¸</span>
                    <span class="theme-icon dark">ğŸŒ™</span>
                </button>
            </div>
        </aside>

        <!-- Main Content -->
        <main class="main-content">
            <header class="main-header">
                <button class="menu-toggle" id="menu-toggle" aria-label="Open menu">
                    <span></span>
                </button>
                
<nav class="breadcrumb">
    <a href="/study/ko/">Topics</a>
    <span class="separator">/</span>
    <a href="/study/ko/Foundation_Models/">Foundation Models</a>
    <span class="separator">/</span>
    <span class="current">DINOv2 & Self-Supervised Vision</span>
</nav>

            </header>

            <div class="content">
                
<article class="lesson-article">
    <header class="lesson-header">
        <h1>DINOv2 & Self-Supervised Vision</h1>
    </header>

    
<div class="lesson-toolbar lesson-toolbar--top">
    <div class="toolbar-nav toolbar-nav--prev">
        
        <a href="/study/ko/Foundation_Models/11_Small_Language_Models.html" class="nav-prev">
            <span class="nav-label">Previous</span>
            <span class="nav-title">11. Small Language Models</span>
        </a>
        
    </div>
    <div class="toolbar-actions">
        <button class="btn btn-copy-link" data-action="copy-link" title="Copy link">
            <span class="icon">ğŸ”—</span>
            <span class="text">Copy link</span>
        </button>
        <a href="/study/ko/Foundation_Models/" class="btn btn-topic-link" title="Back to topic list">
            <span class="icon">ğŸ“‹</span>
            <span class="text">Topic list</span>
        </a>
    </div>
    <div class="toolbar-nav toolbar-nav--next">
        
        <a href="/study/ko/Foundation_Models/13_Segment_Anything.html" class="nav-next">
            <span class="nav-label">Next</span>
            <span class="nav-title">Segment Anything Model (SAM)</span>
        </a>
        
    </div>
</div>


    
    <nav class="toc" id="toc">
        <h2>Table of Contents</h2>
        <div class="toc">
<ul>
<li><a href="#_1">í•™ìŠµ ëª©í‘œ</a></li>
<li><a href="#1-self-supervised-learning-in-vision">1. Self-Supervised Learning in Vision ë³µìŠµ</a><ul>
<li><a href="#11-self-supervised">1.1 ì™œ Self-Supervisedì¸ê°€?</a></li>
<li><a href="#12-deep_learning">1.2 Deep_Learning í´ë” ë³µìŠµ</a></li>
</ul>
</li>
<li><a href="#2-dino-2021">2. DINO (2021)</a><ul>
<li><a href="#21">2.1 í•µì‹¬ ì•„ì´ë””ì–´</a></li>
<li><a href="#22">2.2 ì£¼ìš” êµ¬ì„± ìš”ì†Œ</a></li>
<li><a href="#23-multi-crop">2.3 Multi-crop ì „ëµ</a></li>
<li><a href="#24-teacher-student">2.4 Teacher-Student ì—…ë°ì´íŠ¸</a></li>
</ul>
</li>
<li><a href="#3-dinov2-2023">3. DINOv2 (2023)</a><ul>
<li><a href="#31-dinov2">3.1 DINOv2ì˜ ê°œì„ ì </a></li>
<li><a href="#32-lvd-142m">3.2 LVD-142M ë°ì´í„°ì…‹</a></li>
<li><a href="#33-ibot">3.3 iBOT í†µí•©</a></li>
<li><a href="#34">3.4 ëª¨ë¸ êµ¬ì¡°</a></li>
</ul>
</li>
<li><a href="#4-dinov2">4. DINOv2 ì‚¬ìš©í•˜ê¸°</a><ul>
<li><a href="#41-huggingface">4.1 HuggingFaceë¡œ ë¡œë“œ</a></li>
<li><a href="#42">4.2 íŠ¹ì§• ì¶”ì¶œ ë° í™œìš©</a></li>
<li><a href="#43-dense-prediction-semantic-segmentation">4.3 Dense Prediction (Semantic Segmentation)</a></li>
</ul>
</li>
<li><a href="#5-dinov2">5. DINOv2 ì‘ìš©</a><ul>
<li><a href="#51-zero-shot-semantic-segmentation">5.1 Zero-shot Semantic Segmentation</a></li>
<li><a href="#52-depth-estimation">5.2 Depth Estimation</a></li>
</ul>
</li>
<li><a href="#_2">ì •ë¦¬</a><ul>
<li><a href="#dinodinov2">DINO/DINOv2 í•µì‹¬</a></li>
<li><a href="#_3">í™œìš©</a></li>
<li><a href="#_4">ë‹¤ìŒ ë‹¨ê³„</a></li>
</ul>
</li>
<li><a href="#_5">ì°¸ê³  ìë£Œ</a><ul>
<li><a href="#_6">ë…¼ë¬¸</a></li>
<li><a href="#_7">ì½”ë“œ</a></li>
</ul>
</li>
</ul>
</div>

    </nav>
    

    <div class="lesson-content markdown-body">
        <h1 id="dinov2-self-supervised-vision">DINOv2 &amp; Self-Supervised Vision<a class="header-link" href="#dinov2-self-supervised-vision" title="Permanent link">&para;</a></h1>
<h2 id="_1">í•™ìŠµ ëª©í‘œ<a class="header-link" href="#_1" title="Permanent link">&para;</a></h2>
<ul>
<li>DINO/DINOv2ì˜ Self-distillation ë©”ì»¤ë‹ˆì¦˜ ì´í•´</li>
<li>Teacher-Student í•™ìŠµ íŒ¨ëŸ¬ë‹¤ì„ íŒŒì•…</li>
<li>Dense Visual Features í™œìš©ë²• ìŠµë“</li>
<li>Vision Foundation Modelë¡œì„œì˜ DINOv2 í™œìš©</li>
</ul>
<hr />
<h2 id="1-self-supervised-learning-in-vision">1. Self-Supervised Learning in Vision ë³µìŠµ<a class="header-link" href="#1-self-supervised-learning-in-vision" title="Permanent link">&para;</a></h2>
<h3 id="11-self-supervised">1.1 ì™œ Self-Supervisedì¸ê°€?<a class="header-link" href="#11-self-supervised" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><span class="err">â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”</span>
<span class="err">â”‚</span><span class="w">              </span><span class="nx">Visionì—ì„œ</span><span class="w"> </span><span class="k">Self</span><span class="o">-</span><span class="nx">Supervised</span><span class="w"> </span><span class="nx">Learning</span><span class="w">                 </span><span class="err">â”‚</span>
<span class="err">â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤</span>
<span class="err">â”‚</span><span class="w">                                                                 </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">  </span><span class="nx">Supervised</span><span class="w"> </span><span class="nx">Learningì˜</span><span class="w"> </span><span class="nx">í•œê³„</span><span class="p">:</span><span class="w">                                     </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">  </span><span class="err">â€¢</span><span class="w"> </span><span class="nx">ImageNet</span><span class="p">:</span><span class="w"> </span><span class="m m-Double">1.4</span><span class="nx">M</span><span class="w"> </span><span class="nx">ì´ë¯¸ì§€</span><span class="p">,</span><span class="w"> </span><span class="mi">1000</span><span class="w"> </span><span class="nx">í´ë˜ìŠ¤</span><span class="w">                            </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">  </span><span class="err">â€¢</span><span class="w"> </span><span class="nx">ë ˆì´ë¸”ë§</span><span class="w"> </span><span class="nx">ë¹„ìš©</span><span class="w"> </span><span class="nx">ë†’ìŒ</span><span class="w">                                             </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">  </span><span class="err">â€¢</span><span class="w"> </span><span class="nx">í´ë˜ìŠ¤</span><span class="w"> </span><span class="nx">ë ˆì´ë¸”</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nx">ì œí•œëœ</span><span class="w"> </span><span class="nx">ì •ë³´</span><span class="w">                                     </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">                                                                 </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">  </span><span class="k">Self</span><span class="o">-</span><span class="nx">Supervised</span><span class="w"> </span><span class="nx">Learning</span><span class="p">:</span><span class="w">                                       </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">  </span><span class="err">â€¢</span><span class="w"> </span><span class="nx">ë ˆì´ë¸”</span><span class="w"> </span><span class="nx">ì—†ì´</span><span class="w"> </span><span class="nx">í•™ìŠµ</span><span class="w"> </span><span class="p">(</span><span class="nx">pretext</span><span class="w"> </span><span class="nx">task</span><span class="w"> </span><span class="nx">í™œìš©</span><span class="p">)</span><span class="w">                           </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">  </span><span class="err">â€¢</span><span class="w"> </span><span class="nx">ìˆ˜ì‹­ì–µ</span><span class="w"> </span><span class="nx">ì´ë¯¸ì§€</span><span class="w"> </span><span class="nx">í™œìš©</span><span class="w"> </span><span class="nx">ê°€ëŠ¥</span><span class="w">                                         </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">  </span><span class="err">â€¢</span><span class="w"> </span><span class="nx">ë”</span><span class="w"> </span><span class="nx">í’ë¶€í•œ</span><span class="w"> </span><span class="nx">í‘œí˜„</span><span class="w"> </span><span class="nx">í•™ìŠµ</span><span class="w">                                            </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">                                                                 </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">  </span><span class="nx">ì£¼ìš”</span><span class="w"> </span><span class="nx">ë°©ë²•ë¡ </span><span class="p">:</span><span class="w">                                                     </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">  </span><span class="err">â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”</span><span class="w">         </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">  </span><span class="err">â”‚</span><span class="w"> </span><span class="nx">Contrastive</span><span class="w">   </span><span class="err">â”‚</span><span class="w"> </span><span class="nx">SimCLR</span><span class="p">,</span><span class="w"> </span><span class="nx">MoCo</span><span class="w">  </span><span class="err">â”‚</span><span class="w"> </span><span class="nx">ìœ ì‚¬</span><span class="o">/</span><span class="nx">ë¹„ìœ ì‚¬</span><span class="w"> </span><span class="nx">ìŒ</span><span class="w"> </span><span class="nx">í•™ìŠµ</span><span class="w"> </span><span class="err">â”‚</span><span class="w">         </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">  </span><span class="err">â”‚</span><span class="w"> </span><span class="nx">Distillation</span><span class="w">  </span><span class="err">â”‚</span><span class="w"> </span><span class="nx">DINO</span><span class="p">,</span><span class="w"> </span><span class="nx">BYOL</span><span class="w">    </span><span class="err">â”‚</span><span class="w"> </span><span class="nx">Teacher</span><span class="o">-</span><span class="nx">Student</span><span class="w">    </span><span class="err">â”‚</span><span class="w">         </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">  </span><span class="err">â”‚</span><span class="w"> </span><span class="nx">Masked</span><span class="w">        </span><span class="err">â”‚</span><span class="w"> </span><span class="nx">MAE</span><span class="p">,</span><span class="w"> </span><span class="nx">BEiT</span><span class="w">     </span><span class="err">â”‚</span><span class="w"> </span><span class="nx">ë§ˆìŠ¤í‚¹</span><span class="w"> </span><span class="nx">í›„</span><span class="w"> </span><span class="nx">ë³µì›</span><span class="w">      </span><span class="err">â”‚</span><span class="w">         </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">  </span><span class="err">â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜</span><span class="w">         </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">                                                                 </span><span class="err">â”‚</span>
<span class="err">â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜</span>
</code></pre></div>

<h3 id="12-deep_learning">1.2 Deep_Learning í´ë” ë³µìŠµ<a class="header-link" href="#12-deep_learning" title="Permanent link">&para;</a></h3>
<blockquote>
<p><strong>ì„ ìˆ˜ ì§€ì‹</strong>: <a href="../Deep_Learning/21_Self_Supervised_Learning.md">Deep_Learning/21_Self_Supervised_Learning.md</a>
- SimCLR: Contrastive Learning ê¸°ì´ˆ
- MoCo: Momentum Contrast
- BYOL: Bootstrap Your Own Latent
- MAE: Masked Autoencoders</p>
</blockquote>
<hr />
<h2 id="2-dino-2021">2. DINO (2021)<a class="header-link" href="#2-dino-2021" title="Permanent link">&para;</a></h2>
<h3 id="21">2.1 í•µì‹¬ ì•„ì´ë””ì–´<a class="header-link" href="#21" title="Permanent link">&para;</a></h3>
<p><strong>DINO</strong> (Self-<strong>Di</strong>stillation with <strong>No</strong> labels)ëŠ” Knowledge Distillationì„ Self-supervisedë¡œ ì ìš©í•©ë‹ˆë‹¤.</p>
<div class="highlight"><pre><span></span><code>â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    DINO Architecture                             â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                 â”‚
â”‚                        Input Image                              â”‚
â”‚                            â”‚                                    â”‚
â”‚              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                      â”‚
â”‚              â–¼                           â–¼                      â”‚
â”‚     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”            â”‚
â”‚     â”‚  Global Crops   â”‚         â”‚  Local Crops    â”‚            â”‚
â”‚     â”‚   (224Ã—224)     â”‚         â”‚   (96Ã—96)       â”‚            â”‚
â”‚     â”‚    Ã— 2          â”‚         â”‚    Ã— 6+         â”‚            â”‚
â”‚     â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜         â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜            â”‚
â”‚              â”‚                           â”‚                      â”‚
â”‚              â–¼                           â–¼                      â”‚
â”‚     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”            â”‚
â”‚     â”‚ Teacher Network â”‚         â”‚ Student Network â”‚            â”‚
â”‚     â”‚   (EMA update)  â”‚         â”‚   (Gradient)    â”‚            â”‚
â”‚     â”‚   [stop-grad]   â”‚         â”‚                 â”‚            â”‚
â”‚     â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜         â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜            â”‚
â”‚              â”‚                           â”‚                      â”‚
â”‚              â–¼                           â–¼                      â”‚
â”‚     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”            â”‚
â”‚     â”‚  Teacher Head   â”‚         â”‚  Student Head   â”‚            â”‚
â”‚     â”‚  (Projection)   â”‚         â”‚  (Projection)   â”‚            â”‚
â”‚     â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜         â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜            â”‚
â”‚              â”‚                           â”‚                      â”‚
â”‚              â–¼                           â–¼                      â”‚
â”‚          P_teacher                   P_student                  â”‚
â”‚              â”‚                           â”‚                      â”‚
â”‚              â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                      â”‚
â”‚                          â–¼                                      â”‚
â”‚                  Cross-Entropy Loss                             â”‚
â”‚                  H(P_t, P_s) = -Î£ P_t log(P_s)                 â”‚
â”‚                                                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
</code></pre></div>

<h3 id="22">2.2 ì£¼ìš” êµ¬ì„± ìš”ì†Œ<a class="header-link" href="#22" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><span class="kn">import</span><span class="w"> </span><span class="nn">torch</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">torch.nn</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">nn</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">torch.nn.functional</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">F</span>

<span class="k">class</span><span class="w"> </span><span class="nc">DINOHead</span><span class="p">(</span><span class="n">nn</span><span class="o">.</span><span class="n">Module</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    DINO Projection Head</span>

<span class="sd">    êµ¬ì¡°: Linear â†’ GELU â†’ Linear â†’ L2 Norm</span>
<span class="sd">    ì¶œë ¥: K ì°¨ì› (ì˜ˆ: 65536)</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">in_dim</span><span class="p">,</span> <span class="n">out_dim</span><span class="o">=</span><span class="mi">65536</span><span class="p">,</span> <span class="n">hidden_dim</span><span class="o">=</span><span class="mi">2048</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">mlp</span> <span class="o">=</span> <span class="n">nn</span><span class="o">.</span><span class="n">Sequential</span><span class="p">(</span>
            <span class="n">nn</span><span class="o">.</span><span class="n">Linear</span><span class="p">(</span><span class="n">in_dim</span><span class="p">,</span> <span class="n">hidden_dim</span><span class="p">),</span>
            <span class="n">nn</span><span class="o">.</span><span class="n">GELU</span><span class="p">(),</span>
            <span class="n">nn</span><span class="o">.</span><span class="n">Linear</span><span class="p">(</span><span class="n">hidden_dim</span><span class="p">,</span> <span class="n">hidden_dim</span><span class="p">),</span>
            <span class="n">nn</span><span class="o">.</span><span class="n">GELU</span><span class="p">(),</span>
            <span class="n">nn</span><span class="o">.</span><span class="n">Linear</span><span class="p">(</span><span class="n">hidden_dim</span><span class="p">,</span> <span class="n">out_dim</span><span class="p">),</span>
        <span class="p">)</span>
        <span class="c1"># L2 ì •ê·œí™”</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">last_layer</span> <span class="o">=</span> <span class="n">nn</span><span class="o">.</span><span class="n">utils</span><span class="o">.</span><span class="n">weight_norm</span><span class="p">(</span>
            <span class="n">nn</span><span class="o">.</span><span class="n">Linear</span><span class="p">(</span><span class="n">out_dim</span><span class="p">,</span> <span class="n">out_dim</span><span class="p">,</span> <span class="n">bias</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
        <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">last_layer</span><span class="o">.</span><span class="n">weight_g</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">fill_</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">forward</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">):</span>
        <span class="n">x</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">mlp</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
        <span class="n">x</span> <span class="o">=</span> <span class="n">F</span><span class="o">.</span><span class="n">normalize</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">dim</span><span class="o">=-</span><span class="mi">1</span><span class="p">,</span> <span class="n">p</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
        <span class="n">x</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">last_layer</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">x</span>

<span class="k">class</span><span class="w"> </span><span class="nc">DINOLoss</span><span class="p">(</span><span class="n">nn</span><span class="o">.</span><span class="n">Module</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    DINO Loss: Cross-entropy between teacher and student</span>

<span class="sd">    íŠ¹ì§•:</span>
<span class="sd">    - Teacher: Centering + Sharpening (temperature Ï„_t &lt; Ï„_s)</span>
<span class="sd">    - Student: ì¼ë°˜ softmax</span>
<span class="sd">    - Center: ëª¨ë“  teacher ì¶œë ¥ì˜ moving average (collapse ë°©ì§€)</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">out_dim</span><span class="p">,</span> <span class="n">teacher_temp</span><span class="o">=</span><span class="mf">0.04</span><span class="p">,</span> <span class="n">student_temp</span><span class="o">=</span><span class="mf">0.1</span><span class="p">,</span> <span class="n">center_momentum</span><span class="o">=</span><span class="mf">0.9</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">teacher_temp</span> <span class="o">=</span> <span class="n">teacher_temp</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">student_temp</span> <span class="o">=</span> <span class="n">student_temp</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">center_momentum</span> <span class="o">=</span> <span class="n">center_momentum</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">register_buffer</span><span class="p">(</span><span class="s2">&quot;center&quot;</span><span class="p">,</span> <span class="n">torch</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">out_dim</span><span class="p">))</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">forward</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">student_output</span><span class="p">,</span> <span class="n">teacher_output</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Args:</span>
<span class="sd">            student_output: (batch, n_crops, out_dim)</span>
<span class="sd">            teacher_output: (batch, n_global_crops, out_dim)</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># Teacher: centering + sharpening</span>
        <span class="n">teacher_out</span> <span class="o">=</span> <span class="n">F</span><span class="o">.</span><span class="n">softmax</span><span class="p">(</span>
            <span class="p">(</span><span class="n">teacher_output</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">center</span><span class="p">)</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">teacher_temp</span><span class="p">,</span> <span class="n">dim</span><span class="o">=-</span><span class="mi">1</span>
        <span class="p">)</span>
        <span class="n">teacher_out</span> <span class="o">=</span> <span class="n">teacher_out</span><span class="o">.</span><span class="n">detach</span><span class="p">()</span>  <span class="c1"># stop gradient</span>

        <span class="c1"># Student: softmax with higher temperature</span>
        <span class="n">student_out</span> <span class="o">=</span> <span class="n">F</span><span class="o">.</span><span class="n">log_softmax</span><span class="p">(</span><span class="n">student_output</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">student_temp</span><span class="p">,</span> <span class="n">dim</span><span class="o">=-</span><span class="mi">1</span><span class="p">)</span>

        <span class="c1"># Cross-entropy loss</span>
        <span class="n">loss</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="o">-</span><span class="n">teacher_out</span> <span class="o">*</span> <span class="n">student_out</span><span class="p">,</span> <span class="n">dim</span><span class="o">=-</span><span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span>

        <span class="c1"># Update center (EMA)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">update_center</span><span class="p">(</span><span class="n">teacher_output</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">loss</span>

    <span class="nd">@torch</span><span class="o">.</span><span class="n">no_grad</span><span class="p">()</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">update_center</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">teacher_output</span><span class="p">):</span>
        <span class="n">batch_center</span> <span class="o">=</span> <span class="n">teacher_output</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">dim</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">keepdim</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">center</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">center</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">center_momentum</span> <span class="o">+</span> <span class="n">batch_center</span> <span class="o">*</span> <span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">center_momentum</span><span class="p">)</span>
</code></pre></div>

<h3 id="23-multi-crop">2.3 Multi-crop ì „ëµ<a class="header-link" href="#23-multi-crop" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">Multi-crop Strategy:</span>

<span class="sd">Global crops (2ê°œ):</span>
<span class="sd">- í¬ê¸°: 224Ã—224 (ì›ë³¸ì˜ 50-100%)</span>
<span class="sd">- Teacherì™€ Student ëª¨ë‘ì— ì…ë ¥</span>
<span class="sd">- ì „ì²´ ì´ë¯¸ì§€ ë§¥ë½ í•™ìŠµ</span>

<span class="sd">Local crops (ì—¬ëŸ¬ ê°œ, ë³´í†µ 6-8ê°œ):</span>
<span class="sd">- í¬ê¸°: 96Ã—96 (ì›ë³¸ì˜ 5-50%)</span>
<span class="sd">- Studentì—ë§Œ ì…ë ¥</span>
<span class="sd">- ì§€ì—­ íŒ¨í„´ í•™ìŠµ</span>

<span class="sd">ëª©ì :</span>
<span class="sd">- &quot;Local-to-Global&quot; ëŒ€ì‘ í•™ìŠµ</span>
<span class="sd">- ì‘ì€ ì˜ì—­ì´ ì „ì²´ ì´ë¯¸ì§€ì˜ ì–´ë–¤ ë¶€ë¶„ì¸ì§€ í•™ìŠµ</span>
<span class="sd">- Semantic segmentation ëŠ¥ë ¥ ìì—°ìŠ¤ëŸ½ê²Œ ìŠµë“</span>
<span class="sd">&quot;&quot;&quot;</span>

<span class="kn">from</span><span class="w"> </span><span class="nn">torchvision</span><span class="w"> </span><span class="kn">import</span> <span class="n">transforms</span>

<span class="k">class</span><span class="w"> </span><span class="nc">DINODataAugmentation</span><span class="p">:</span>
    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">global_crops_scale</span><span class="o">=</span><span class="p">(</span><span class="mf">0.4</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">),</span> <span class="n">local_crops_scale</span><span class="o">=</span><span class="p">(</span><span class="mf">0.05</span><span class="p">,</span> <span class="mf">0.4</span><span class="p">),</span>
                 <span class="n">n_local_crops</span><span class="o">=</span><span class="mi">8</span><span class="p">):</span>
        <span class="c1"># Global crops (224Ã—224)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">global_transform</span> <span class="o">=</span> <span class="n">transforms</span><span class="o">.</span><span class="n">Compose</span><span class="p">([</span>
            <span class="n">transforms</span><span class="o">.</span><span class="n">RandomResizedCrop</span><span class="p">(</span><span class="mi">224</span><span class="p">,</span> <span class="n">scale</span><span class="o">=</span><span class="n">global_crops_scale</span><span class="p">),</span>
            <span class="n">transforms</span><span class="o">.</span><span class="n">RandomHorizontalFlip</span><span class="p">(),</span>
            <span class="n">transforms</span><span class="o">.</span><span class="n">ColorJitter</span><span class="p">(</span><span class="mf">0.4</span><span class="p">,</span> <span class="mf">0.4</span><span class="p">,</span> <span class="mf">0.2</span><span class="p">,</span> <span class="mf">0.1</span><span class="p">),</span>
            <span class="n">transforms</span><span class="o">.</span><span class="n">RandomGrayscale</span><span class="p">(</span><span class="n">p</span><span class="o">=</span><span class="mf">0.2</span><span class="p">),</span>
            <span class="n">transforms</span><span class="o">.</span><span class="n">GaussianBlur</span><span class="p">(</span><span class="n">kernel_size</span><span class="o">=</span><span class="mi">23</span><span class="p">,</span> <span class="n">sigma</span><span class="o">=</span><span class="p">(</span><span class="mf">0.1</span><span class="p">,</span> <span class="mf">2.0</span><span class="p">)),</span>
            <span class="n">transforms</span><span class="o">.</span><span class="n">ToTensor</span><span class="p">(),</span>
            <span class="n">transforms</span><span class="o">.</span><span class="n">Normalize</span><span class="p">((</span><span class="mf">0.485</span><span class="p">,</span> <span class="mf">0.456</span><span class="p">,</span> <span class="mf">0.406</span><span class="p">),</span> <span class="p">(</span><span class="mf">0.229</span><span class="p">,</span> <span class="mf">0.224</span><span class="p">,</span> <span class="mf">0.225</span><span class="p">)),</span>
        <span class="p">])</span>

        <span class="c1"># Local crops (96Ã—96)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">local_transform</span> <span class="o">=</span> <span class="n">transforms</span><span class="o">.</span><span class="n">Compose</span><span class="p">([</span>
            <span class="n">transforms</span><span class="o">.</span><span class="n">RandomResizedCrop</span><span class="p">(</span><span class="mi">96</span><span class="p">,</span> <span class="n">scale</span><span class="o">=</span><span class="n">local_crops_scale</span><span class="p">),</span>
            <span class="n">transforms</span><span class="o">.</span><span class="n">RandomHorizontalFlip</span><span class="p">(),</span>
            <span class="n">transforms</span><span class="o">.</span><span class="n">ColorJitter</span><span class="p">(</span><span class="mf">0.4</span><span class="p">,</span> <span class="mf">0.4</span><span class="p">,</span> <span class="mf">0.2</span><span class="p">,</span> <span class="mf">0.1</span><span class="p">),</span>
            <span class="n">transforms</span><span class="o">.</span><span class="n">RandomGrayscale</span><span class="p">(</span><span class="n">p</span><span class="o">=</span><span class="mf">0.2</span><span class="p">),</span>
            <span class="n">transforms</span><span class="o">.</span><span class="n">GaussianBlur</span><span class="p">(</span><span class="n">kernel_size</span><span class="o">=</span><span class="mi">23</span><span class="p">,</span> <span class="n">sigma</span><span class="o">=</span><span class="p">(</span><span class="mf">0.1</span><span class="p">,</span> <span class="mf">2.0</span><span class="p">)),</span>
            <span class="n">transforms</span><span class="o">.</span><span class="n">ToTensor</span><span class="p">(),</span>
            <span class="n">transforms</span><span class="o">.</span><span class="n">Normalize</span><span class="p">((</span><span class="mf">0.485</span><span class="p">,</span> <span class="mf">0.456</span><span class="p">,</span> <span class="mf">0.406</span><span class="p">),</span> <span class="p">(</span><span class="mf">0.229</span><span class="p">,</span> <span class="mf">0.224</span><span class="p">,</span> <span class="mf">0.225</span><span class="p">)),</span>
        <span class="p">])</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">n_local_crops</span> <span class="o">=</span> <span class="n">n_local_crops</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__call__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">image</span><span class="p">):</span>
        <span class="n">crops</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="c1"># 2 global crops</span>
        <span class="n">crops</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">global_transform</span><span class="p">(</span><span class="n">image</span><span class="p">))</span>
        <span class="n">crops</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">global_transform</span><span class="p">(</span><span class="n">image</span><span class="p">))</span>
        <span class="c1"># n local crops</span>
        <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">n_local_crops</span><span class="p">):</span>
            <span class="n">crops</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">local_transform</span><span class="p">(</span><span class="n">image</span><span class="p">))</span>
        <span class="k">return</span> <span class="n">crops</span>
</code></pre></div>

<h3 id="24-teacher-student">2.4 Teacher-Student ì—…ë°ì´íŠ¸<a class="header-link" href="#24-teacher-student" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><span class="k">class</span><span class="w"> </span><span class="nc">DINOTrainer</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    DINO í•™ìŠµ ë£¨í”„</span>

<span class="sd">    í•µì‹¬:</span>
<span class="sd">    - Student: gradientë¡œ ì—…ë°ì´íŠ¸</span>
<span class="sd">    - Teacher: Studentì˜ EMA (Exponential Moving Average)</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">student</span><span class="p">,</span> <span class="n">teacher</span><span class="p">,</span> <span class="n">optimizer</span><span class="p">,</span> <span class="n">loss_fn</span><span class="p">,</span> <span class="n">momentum</span><span class="o">=</span><span class="mf">0.996</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">student</span> <span class="o">=</span> <span class="n">student</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">teacher</span> <span class="o">=</span> <span class="n">teacher</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">optimizer</span> <span class="o">=</span> <span class="n">optimizer</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">loss_fn</span> <span class="o">=</span> <span class="n">loss_fn</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">momentum</span> <span class="o">=</span> <span class="n">momentum</span>

        <span class="c1"># TeacherëŠ” Studentë¡œ ì´ˆê¸°í™”</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">teacher</span><span class="o">.</span><span class="n">load_state_dict</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">student</span><span class="o">.</span><span class="n">state_dict</span><span class="p">())</span>
        <span class="c1"># TeacherëŠ” gradient ê³„ì‚° ì•ˆ í•¨</span>
        <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">teacher</span><span class="o">.</span><span class="n">parameters</span><span class="p">():</span>
            <span class="n">p</span><span class="o">.</span><span class="n">requires_grad</span> <span class="o">=</span> <span class="kc">False</span>

    <span class="nd">@torch</span><span class="o">.</span><span class="n">no_grad</span><span class="p">()</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">update_teacher</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;EMA update: Î¸_t = m * Î¸_t + (1-m) * Î¸_s&quot;&quot;&quot;</span>
        <span class="k">for</span> <span class="n">param_s</span><span class="p">,</span> <span class="n">param_t</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">student</span><span class="o">.</span><span class="n">parameters</span><span class="p">(),</span> <span class="bp">self</span><span class="o">.</span><span class="n">teacher</span><span class="o">.</span><span class="n">parameters</span><span class="p">()):</span>
            <span class="n">param_t</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">mul_</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">momentum</span><span class="p">)</span><span class="o">.</span><span class="n">add_</span><span class="p">((</span><span class="mi">1</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">momentum</span><span class="p">)</span> <span class="o">*</span> <span class="n">param_s</span><span class="o">.</span><span class="n">data</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">train_step</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">images</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        images: list of crops [global1, global2, local1, ..., localN]</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># Global cropsë§Œ Teacherì— ì…ë ¥</span>
        <span class="n">teacher_output</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">teacher</span><span class="p">(</span><span class="n">torch</span><span class="o">.</span><span class="n">cat</span><span class="p">(</span><span class="n">images</span><span class="p">[:</span><span class="mi">2</span><span class="p">]))</span>

        <span class="c1"># ëª¨ë“  cropsë¥¼ Studentì— ì…ë ¥</span>
        <span class="n">student_output</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">student</span><span class="p">(</span><span class="n">torch</span><span class="o">.</span><span class="n">cat</span><span class="p">(</span><span class="n">images</span><span class="p">))</span>

        <span class="c1"># Loss ê³„ì‚° (ê° student crop vs ê° teacher crop)</span>
        <span class="n">loss</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">loss_fn</span><span class="p">(</span><span class="n">student_output</span><span class="p">,</span> <span class="n">teacher_output</span><span class="p">)</span>

        <span class="c1"># Student ì—…ë°ì´íŠ¸</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">optimizer</span><span class="o">.</span><span class="n">zero_grad</span><span class="p">()</span>
        <span class="n">loss</span><span class="o">.</span><span class="n">backward</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">optimizer</span><span class="o">.</span><span class="n">step</span><span class="p">()</span>

        <span class="c1"># Teacher EMA ì—…ë°ì´íŠ¸</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">update_teacher</span><span class="p">()</span>

        <span class="k">return</span> <span class="n">loss</span><span class="o">.</span><span class="n">item</span><span class="p">()</span>
</code></pre></div>

<hr />
<h2 id="3-dinov2-2023">3. DINOv2 (2023)<a class="header-link" href="#3-dinov2-2023" title="Permanent link">&para;</a></h2>
<h3 id="31-dinov2">3.1 DINOv2ì˜ ê°œì„ ì <a class="header-link" href="#31-dinov2" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code>â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                 DINO vs DINOv2 ë¹„êµ                              â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                 â”‚
â”‚  í•­ëª©              â”‚ DINO (2021)      â”‚ DINOv2 (2023)          â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€  â”‚
â”‚  ë°ì´í„°            â”‚ ImageNet (1.3M)  â”‚ LVD-142M (142M)        â”‚
â”‚  ë°ì´í„° íë ˆì´ì…˜    â”‚ ì—†ìŒ             â”‚ ìë™ íë ˆì´ì…˜ íŒŒì´í”„ë¼ì¸  â”‚
â”‚  ëª¨ë¸ í¬ê¸°         â”‚ ViT-S/B          â”‚ ViT-S/B/L/g            â”‚
â”‚  í•™ìŠµ ëª©í‘œ         â”‚ DINOë§Œ           â”‚ DINO + iBOT (masked)   â”‚
â”‚  Regularization   â”‚ ê¸°ë³¸             â”‚ KoLeo + ì •ê·œí™” ê°•í™”     â”‚
â”‚  Resolution       â”‚ 224              â”‚ 518 (ê³ í•´ìƒë„)          â”‚
â”‚  ì„±ëŠ¥ (k-NN)      â”‚ ~74% (IN-1K)    â”‚ ~86% (IN-1K)           â”‚
â”‚                                                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
</code></pre></div>

<h3 id="32-lvd-142m">3.2 LVD-142M ë°ì´í„°ì…‹<a class="header-link" href="#32-lvd-142m" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">LVD-142M (Learning with large Visual Datasets)</span>

<span class="sd">ìë™ íë ˆì´ì…˜ íŒŒì´í”„ë¼ì¸:</span>
<span class="sd">1. ì›¹ì—ì„œ ì´ë¯¸ì§€ ìˆ˜ì§‘ (billions)</span>
<span class="sd">2. ì¤‘ë³µ ì œê±° (copy detection)</span>
<span class="sd">3. í’ˆì§ˆ í•„í„°ë§</span>
<span class="sd">4. ImageNetê³¼ ìœ ì‚¬ë„ ê¸°ë°˜ ìƒ˜í”Œë§</span>
<span class="sd">5. ìµœì¢… 142M ì´ë¯¸ì§€</span>

<span class="sd">í•µì‹¬ ê¸°ìˆ :</span>
<span class="sd">- Self-supervised copy detection</span>
<span class="sd">- Embedding ê¸°ë°˜ í´ëŸ¬ìŠ¤í„°ë§</span>
<span class="sd">- Retrieval ê¸°ë°˜ ë°ì´í„° ì„ íƒ</span>

<span class="sd">ì™œ ì¤‘ìš”í•œê°€:</span>
<span class="sd">- ë°ì´í„° í’ˆì§ˆì´ ëª¨ë¸ ì„±ëŠ¥ì˜ í•µì‹¬</span>
<span class="sd">- Scalingì€ ë°ì´í„° íë ˆì´ì…˜ì´ í•„ìˆ˜</span>
<span class="sd">- ìë™í™”ëœ íŒŒì´í”„ë¼ì¸ìœ¼ë¡œ í™•ì¥ ê°€ëŠ¥</span>
<span class="sd">&quot;&quot;&quot;</span>
</code></pre></div>

<h3 id="33-ibot">3.3 iBOT í†µí•©<a class="header-link" href="#33-ibot" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code>â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                 DINOv2 = DINO + iBOT                            â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                 â”‚
â”‚  DINO Loss (ì´ë¯¸ì§€ ë ˆë²¨):                                        â”‚
â”‚  â€¢ Global/Local crop ê°„ consistency                             â”‚
â”‚  â€¢ CLS token ê¸°ë°˜                                               â”‚
â”‚                                                                 â”‚
â”‚  iBOT Loss (íŒ¨ì¹˜ ë ˆë²¨):                                          â”‚
â”‚  â€¢ Masked patches ì˜ˆì¸¡                                          â”‚
â”‚  â€¢ MAEì™€ ìœ ì‚¬í•˜ì§€ë§Œ Teacher ì‚¬ìš©                                  â”‚
â”‚                                                                 â”‚
â”‚                    Input Image                                  â”‚
â”‚                         â”‚                                       â”‚
â”‚          â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                          â”‚
â”‚          â–¼                           â–¼                          â”‚
â”‚     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”                â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”                      â”‚
â”‚     â”‚ Teacher â”‚                â”‚ Student â”‚                      â”‚
â”‚     â”‚ (full)  â”‚                â”‚ (masked)â”‚ â† ì¼ë¶€ íŒ¨ì¹˜ ë§ˆìŠ¤í‚¹     â”‚
â”‚     â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜                â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜                      â”‚
â”‚          â”‚                          â”‚                           â”‚
â”‚     â”Œâ”€â”€â”€â”€â”´â”€â”€â”€â”€â”                â”Œâ”€â”€â”€â”€â”´â”€â”€â”€â”€â”                      â”‚
â”‚     â”‚CLSâ”‚Patchâ”‚                â”‚CLSâ”‚Patchâ”‚                      â”‚
â”‚     â””â”€â”¬â”€â”€â”€â”¬â”€â”€â”€â”˜                â””â”€â”¬â”€â”€â”€â”¬â”€â”€â”€â”˜                      â”‚
â”‚       â”‚   â”‚                      â”‚   â”‚                          â”‚
â”‚       â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚â”€â”€â”€â”¤                          â”‚
â”‚       â”‚          iBOT Loss       â”‚   â”‚                          â”‚
â”‚       â”‚     (masked patches)     â”‚   â”‚                          â”‚
â”‚       â”‚                          â”‚   â”‚                          â”‚
â”‚       â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚                          â”‚
â”‚              DINO Loss               â”‚                          â”‚
â”‚           (CLS tokens)               â”‚                          â”‚
â”‚                                                                 â”‚
â”‚  Total Loss = L_DINO + Î» Ã— L_iBOT                               â”‚
â”‚                                                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
</code></pre></div>

<h3 id="34">3.4 ëª¨ë¸ êµ¬ì¡°<a class="header-link" href="#34" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">DINOv2 ëª¨ë¸ ì‚¬ì–‘</span>

<span class="sd">Model      â”‚ Layers â”‚ Hidden â”‚ Heads â”‚ Params â”‚ Patch</span>
<span class="sd">â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”‚â”€â”€â”€â”€â”€â”€â”€â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”‚â”€â”€â”€â”€â”€â”€â”€</span>
<span class="sd">ViT-S/14  â”‚ 12     â”‚ 384    â”‚ 6     â”‚ 21M    â”‚ 14Ã—14</span>
<span class="sd">ViT-B/14  â”‚ 12     â”‚ 768    â”‚ 12    â”‚ 86M    â”‚ 14Ã—14</span>
<span class="sd">ViT-L/14  â”‚ 24     â”‚ 1024   â”‚ 16    â”‚ 300M   â”‚ 14Ã—14</span>
<span class="sd">ViT-g/14  â”‚ 40     â”‚ 1536   â”‚ 24    â”‚ 1.1B   â”‚ 14Ã—14</span>

<span class="sd">íŠ¹ì§•:</span>
<span class="sd">- Patch size 14 (ê¸°ì¡´ ViTëŠ” 16)</span>
<span class="sd">- ë” ë†’ì€ í•´ìƒë„ ì§€ì›</span>
<span class="sd">- Register tokens (attention artifact í•´ê²°)</span>
<span class="sd">&quot;&quot;&quot;</span>
</code></pre></div>

<hr />
<h2 id="4-dinov2">4. DINOv2 ì‚¬ìš©í•˜ê¸°<a class="header-link" href="#4-dinov2" title="Permanent link">&para;</a></h2>
<h3 id="41-huggingface">4.1 HuggingFaceë¡œ ë¡œë“œ<a class="header-link" href="#41-huggingface" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><span class="kn">import</span><span class="w"> </span><span class="nn">torch</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">transformers</span><span class="w"> </span><span class="kn">import</span> <span class="n">AutoImageProcessor</span><span class="p">,</span> <span class="n">AutoModel</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">PIL</span><span class="w"> </span><span class="kn">import</span> <span class="n">Image</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">requests</span>

<span class="c1"># ëª¨ë¸ ë¡œë“œ</span>
<span class="n">model_name</span> <span class="o">=</span> <span class="s2">&quot;facebook/dinov2-base&quot;</span>
<span class="n">processor</span> <span class="o">=</span> <span class="n">AutoImageProcessor</span><span class="o">.</span><span class="n">from_pretrained</span><span class="p">(</span><span class="n">model_name</span><span class="p">)</span>
<span class="n">model</span> <span class="o">=</span> <span class="n">AutoModel</span><span class="o">.</span><span class="n">from_pretrained</span><span class="p">(</span><span class="n">model_name</span><span class="p">)</span>

<span class="c1"># ì´ë¯¸ì§€ ë¡œë“œ</span>
<span class="n">url</span> <span class="o">=</span> <span class="s2">&quot;http://images.cocodataset.org/val2017/000000039769.jpg&quot;</span>
<span class="n">image</span> <span class="o">=</span> <span class="n">Image</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="n">requests</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">url</span><span class="p">,</span> <span class="n">stream</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span><span class="o">.</span><span class="n">raw</span><span class="p">)</span>

<span class="c1"># ì „ì²˜ë¦¬ ë° ì¶”ë¡ </span>
<span class="n">inputs</span> <span class="o">=</span> <span class="n">processor</span><span class="p">(</span><span class="n">images</span><span class="o">=</span><span class="n">image</span><span class="p">,</span> <span class="n">return_tensors</span><span class="o">=</span><span class="s2">&quot;pt&quot;</span><span class="p">)</span>

<span class="k">with</span> <span class="n">torch</span><span class="o">.</span><span class="n">no_grad</span><span class="p">():</span>
    <span class="n">outputs</span> <span class="o">=</span> <span class="n">model</span><span class="p">(</span><span class="o">**</span><span class="n">inputs</span><span class="p">)</span>

<span class="c1"># ì¶œë ¥ êµ¬ì¡°</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Last hidden state: </span><span class="si">{</span><span class="n">outputs</span><span class="o">.</span><span class="n">last_hidden_state</span><span class="o">.</span><span class="n">shape</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="c1"># (1, 257, 768) = (batch, 1 CLS + 256 patches, hidden_dim)</span>

<span class="c1"># CLS token (ì „ì²´ ì´ë¯¸ì§€ í‘œí˜„)</span>
<span class="n">cls_token</span> <span class="o">=</span> <span class="n">outputs</span><span class="o">.</span><span class="n">last_hidden_state</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">]</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;CLS token: </span><span class="si">{</span><span class="n">cls_token</span><span class="o">.</span><span class="n">shape</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>  <span class="c1"># (1, 768)</span>

<span class="c1"># Patch tokens (ì§€ì—­ í‘œí˜„)</span>
<span class="n">patch_tokens</span> <span class="o">=</span> <span class="n">outputs</span><span class="o">.</span><span class="n">last_hidden_state</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">:]</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Patch tokens: </span><span class="si">{</span><span class="n">patch_tokens</span><span class="o">.</span><span class="n">shape</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>  <span class="c1"># (1, 256, 768)</span>
</code></pre></div>

<h3 id="42">4.2 íŠ¹ì§• ì¶”ì¶œ ë° í™œìš©<a class="header-link" href="#42" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><span class="kn">import</span><span class="w"> </span><span class="nn">torch</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">torch.nn.functional</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">F</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">transformers</span><span class="w"> </span><span class="kn">import</span> <span class="n">AutoImageProcessor</span><span class="p">,</span> <span class="n">AutoModel</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">numpy</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">np</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">sklearn.neighbors</span><span class="w"> </span><span class="kn">import</span> <span class="n">NearestNeighbors</span>

<span class="k">class</span><span class="w"> </span><span class="nc">DINOv2FeatureExtractor</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;DINOv2ë¥¼ ì´ìš©í•œ ì´ë¯¸ì§€ íŠ¹ì§• ì¶”ì¶œê¸°&quot;&quot;&quot;</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">model_name</span><span class="o">=</span><span class="s2">&quot;facebook/dinov2-base&quot;</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">processor</span> <span class="o">=</span> <span class="n">AutoImageProcessor</span><span class="o">.</span><span class="n">from_pretrained</span><span class="p">(</span><span class="n">model_name</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">model</span> <span class="o">=</span> <span class="n">AutoModel</span><span class="o">.</span><span class="n">from_pretrained</span><span class="p">(</span><span class="n">model_name</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">eval</span><span class="p">()</span>

    <span class="nd">@torch</span><span class="o">.</span><span class="n">no_grad</span><span class="p">()</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">extract_features</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">images</span><span class="p">,</span> <span class="n">return_patches</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        ì´ë¯¸ì§€ì—ì„œ íŠ¹ì§• ì¶”ì¶œ</span>

<span class="sd">        Args:</span>
<span class="sd">            images: PIL Image ë˜ëŠ” ë¦¬ìŠ¤íŠ¸</span>
<span class="sd">            return_patches: íŒ¨ì¹˜ë³„ íŠ¹ì§•ë„ ë°˜í™˜í• ì§€</span>

<span class="sd">        Returns:</span>
<span class="sd">            cls_features: (n_images, hidden_dim)</span>
<span class="sd">            patch_features: (n_images, n_patches, hidden_dim) - optional</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">images</span><span class="p">,</span> <span class="nb">list</span><span class="p">):</span>
            <span class="n">images</span> <span class="o">=</span> <span class="p">[</span><span class="n">images</span><span class="p">]</span>

        <span class="n">inputs</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">processor</span><span class="p">(</span><span class="n">images</span><span class="o">=</span><span class="n">images</span><span class="p">,</span> <span class="n">return_tensors</span><span class="o">=</span><span class="s2">&quot;pt&quot;</span><span class="p">)</span>
        <span class="n">outputs</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="p">(</span><span class="o">**</span><span class="n">inputs</span><span class="p">)</span>

        <span class="n">cls_features</span> <span class="o">=</span> <span class="n">outputs</span><span class="o">.</span><span class="n">last_hidden_state</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">]</span>

        <span class="k">if</span> <span class="n">return_patches</span><span class="p">:</span>
            <span class="n">patch_features</span> <span class="o">=</span> <span class="n">outputs</span><span class="o">.</span><span class="n">last_hidden_state</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">:]</span>
            <span class="k">return</span> <span class="n">cls_features</span><span class="p">,</span> <span class="n">patch_features</span>

        <span class="k">return</span> <span class="n">cls_features</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">compute_similarity</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">image1</span><span class="p">,</span> <span class="n">image2</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;ë‘ ì´ë¯¸ì§€ ê°„ ìœ ì‚¬ë„ (ì½”ì‚¬ì¸)&quot;&quot;&quot;</span>
        <span class="n">feat1</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">extract_features</span><span class="p">(</span><span class="n">image1</span><span class="p">)</span>
        <span class="n">feat2</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">extract_features</span><span class="p">(</span><span class="n">image2</span><span class="p">)</span>
        <span class="n">similarity</span> <span class="o">=</span> <span class="n">F</span><span class="o">.</span><span class="n">cosine_similarity</span><span class="p">(</span><span class="n">feat1</span><span class="p">,</span> <span class="n">feat2</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">similarity</span><span class="o">.</span><span class="n">item</span><span class="p">()</span>

<span class="c1"># ì‚¬ìš© ì˜ˆì‹œ</span>
<span class="n">extractor</span> <span class="o">=</span> <span class="n">DINOv2FeatureExtractor</span><span class="p">()</span>

<span class="c1"># ì´ë¯¸ì§€ ê²€ìƒ‰</span>
<span class="k">def</span><span class="w"> </span><span class="nf">build_image_index</span><span class="p">(</span><span class="n">images</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;ì´ë¯¸ì§€ ì¸ë±ìŠ¤ êµ¬ì¶•&quot;&quot;&quot;</span>
    <span class="n">features</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">img</span> <span class="ow">in</span> <span class="n">images</span><span class="p">:</span>
        <span class="n">feat</span> <span class="o">=</span> <span class="n">extractor</span><span class="o">.</span><span class="n">extract_features</span><span class="p">(</span><span class="n">img</span><span class="p">)</span>
        <span class="n">features</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">feat</span><span class="o">.</span><span class="n">numpy</span><span class="p">())</span>
    <span class="n">features</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">vstack</span><span class="p">(</span><span class="n">features</span><span class="p">)</span>

    <span class="c1"># k-NN ì¸ë±ìŠ¤</span>
    <span class="n">index</span> <span class="o">=</span> <span class="n">NearestNeighbors</span><span class="p">(</span><span class="n">n_neighbors</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span> <span class="n">metric</span><span class="o">=</span><span class="s1">&#39;cosine&#39;</span><span class="p">)</span>
    <span class="n">index</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">features</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">index</span><span class="p">,</span> <span class="n">features</span>

<span class="k">def</span><span class="w"> </span><span class="nf">search_similar</span><span class="p">(</span><span class="n">query_image</span><span class="p">,</span> <span class="n">index</span><span class="p">,</span> <span class="n">features</span><span class="p">,</span> <span class="n">k</span><span class="o">=</span><span class="mi">5</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;ìœ ì‚¬ ì´ë¯¸ì§€ ê²€ìƒ‰&quot;&quot;&quot;</span>
    <span class="n">query_feat</span> <span class="o">=</span> <span class="n">extractor</span><span class="o">.</span><span class="n">extract_features</span><span class="p">(</span><span class="n">query_image</span><span class="p">)</span><span class="o">.</span><span class="n">numpy</span><span class="p">()</span>
    <span class="n">distances</span><span class="p">,</span> <span class="n">indices</span> <span class="o">=</span> <span class="n">index</span><span class="o">.</span><span class="n">kneighbors</span><span class="p">(</span><span class="n">query_feat</span><span class="p">,</span> <span class="n">n_neighbors</span><span class="o">=</span><span class="n">k</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">indices</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">distances</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
</code></pre></div>

<h3 id="43-dense-prediction-semantic-segmentation">4.3 Dense Prediction (Semantic Segmentation)<a class="header-link" href="#43-dense-prediction-semantic-segmentation" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><span class="kn">import</span><span class="w"> </span><span class="nn">torch</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">numpy</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">np</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">matplotlib.pyplot</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">plt</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">sklearn.decomposition</span><span class="w"> </span><span class="kn">import</span> <span class="n">PCA</span>

<span class="k">def</span><span class="w"> </span><span class="nf">visualize_attention_maps</span><span class="p">(</span><span class="n">model</span><span class="p">,</span> <span class="n">processor</span><span class="p">,</span> <span class="n">image</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;DINOv2ì˜ attention map ì‹œê°í™”&quot;&quot;&quot;</span>

    <span class="n">inputs</span> <span class="o">=</span> <span class="n">processor</span><span class="p">(</span><span class="n">images</span><span class="o">=</span><span class="n">image</span><span class="p">,</span> <span class="n">return_tensors</span><span class="o">=</span><span class="s2">&quot;pt&quot;</span><span class="p">)</span>

    <span class="k">with</span> <span class="n">torch</span><span class="o">.</span><span class="n">no_grad</span><span class="p">():</span>
        <span class="n">outputs</span> <span class="o">=</span> <span class="n">model</span><span class="p">(</span><span class="o">**</span><span class="n">inputs</span><span class="p">,</span> <span class="n">output_attentions</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

    <span class="c1"># ë§ˆì§€ë§‰ ë ˆì´ì–´ì˜ attention</span>
    <span class="n">attentions</span> <span class="o">=</span> <span class="n">outputs</span><span class="o">.</span><span class="n">attentions</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>  <span class="c1"># (1, n_heads, n_tokens, n_tokens)</span>

    <span class="c1"># CLS tokenì´ ê° íŒ¨ì¹˜ì— ì£¼ëŠ” attention</span>
    <span class="n">cls_attn</span> <span class="o">=</span> <span class="n">attentions</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="p">:,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">:]</span>  <span class="c1"># (n_heads, n_patches)</span>

    <span class="c1"># í‰ê· </span>
    <span class="n">cls_attn_mean</span> <span class="o">=</span> <span class="n">cls_attn</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">dim</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>  <span class="c1"># (n_patches,)</span>

    <span class="c1"># Reshape to 2D</span>
    <span class="n">n_patches</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">cls_attn_mean</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]))</span>
    <span class="n">attn_map</span> <span class="o">=</span> <span class="n">cls_attn_mean</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">n_patches</span><span class="p">,</span> <span class="n">n_patches</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">attn_map</span><span class="o">.</span><span class="n">numpy</span><span class="p">()</span>

<span class="k">def</span><span class="w"> </span><span class="nf">visualize_patch_pca</span><span class="p">(</span><span class="n">model</span><span class="p">,</span> <span class="n">processor</span><span class="p">,</span> <span class="n">image</span><span class="p">,</span> <span class="n">n_components</span><span class="o">=</span><span class="mi">3</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;íŒ¨ì¹˜ íŠ¹ì§•ì˜ PCA ì‹œê°í™” (ì˜ë¯¸ë¡ ì  ì˜ì—­ í™•ì¸)&quot;&quot;&quot;</span>

    <span class="n">inputs</span> <span class="o">=</span> <span class="n">processor</span><span class="p">(</span><span class="n">images</span><span class="o">=</span><span class="n">image</span><span class="p">,</span> <span class="n">return_tensors</span><span class="o">=</span><span class="s2">&quot;pt&quot;</span><span class="p">)</span>

    <span class="k">with</span> <span class="n">torch</span><span class="o">.</span><span class="n">no_grad</span><span class="p">():</span>
        <span class="n">outputs</span> <span class="o">=</span> <span class="n">model</span><span class="p">(</span><span class="o">**</span><span class="n">inputs</span><span class="p">)</span>

    <span class="c1"># íŒ¨ì¹˜ í† í°</span>
    <span class="n">patch_tokens</span> <span class="o">=</span> <span class="n">outputs</span><span class="o">.</span><span class="n">last_hidden_state</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">:]</span><span class="o">.</span><span class="n">numpy</span><span class="p">()</span>  <span class="c1"># (n_patches, hidden)</span>

    <span class="c1"># PCA</span>
    <span class="n">pca</span> <span class="o">=</span> <span class="n">PCA</span><span class="p">(</span><span class="n">n_components</span><span class="o">=</span><span class="n">n_components</span><span class="p">)</span>
    <span class="n">patch_pca</span> <span class="o">=</span> <span class="n">pca</span><span class="o">.</span><span class="n">fit_transform</span><span class="p">(</span><span class="n">patch_tokens</span><span class="p">)</span>

    <span class="c1"># Normalize to [0, 1] for visualization</span>
    <span class="n">patch_pca</span> <span class="o">=</span> <span class="p">(</span><span class="n">patch_pca</span> <span class="o">-</span> <span class="n">patch_pca</span><span class="o">.</span><span class="n">min</span><span class="p">())</span> <span class="o">/</span> <span class="p">(</span><span class="n">patch_pca</span><span class="o">.</span><span class="n">max</span><span class="p">()</span> <span class="o">-</span> <span class="n">patch_pca</span><span class="o">.</span><span class="n">min</span><span class="p">())</span>

    <span class="c1"># Reshape</span>
    <span class="n">n_patches</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">patch_tokens</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]))</span>
    <span class="n">pca_image</span> <span class="o">=</span> <span class="n">patch_pca</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">n_patches</span><span class="p">,</span> <span class="n">n_patches</span><span class="p">,</span> <span class="n">n_components</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">pca_image</span>

<span class="c1"># ì‹œê°í™”</span>
<span class="c1"># fig, axes = plt.subplots(1, 3, figsize=(15, 5))</span>
<span class="c1"># axes[0].imshow(image)</span>
<span class="c1"># axes[0].set_title(&#39;Original&#39;)</span>
<span class="c1"># axes[1].imshow(visualize_attention_maps(model, processor, image), cmap=&#39;hot&#39;)</span>
<span class="c1"># axes[1].set_title(&#39;Attention Map&#39;)</span>
<span class="c1"># axes[2].imshow(visualize_patch_pca(model, processor, image))</span>
<span class="c1"># axes[2].set_title(&#39;PCA of Patches&#39;)</span>
</code></pre></div>

<hr />
<h2 id="5-dinov2">5. DINOv2 ì‘ìš©<a class="header-link" href="#5-dinov2" title="Permanent link">&para;</a></h2>
<h3 id="51-zero-shot-semantic-segmentation">5.1 Zero-shot Semantic Segmentation<a class="header-link" href="#51-zero-shot-semantic-segmentation" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">DINOv2ì˜ íŒ¨ì¹˜ íŠ¹ì§•ì„ ì´ìš©í•œ ì„¸ê·¸ë©˜í…Œì´ì…˜</span>

<span class="sd">ë°©ë²•:</span>
<span class="sd">1. ì´ë¯¸ì§€ì—ì„œ DINOv2 íŒ¨ì¹˜ íŠ¹ì§• ì¶”ì¶œ</span>
<span class="sd">2. ì˜ˆì‹œ ì´ë¯¸ì§€ì—ì„œ ê´€ì‹¬ ì˜ì—­ì˜ íŠ¹ì§• ì¶”ì¶œ</span>
<span class="sd">3. ì½”ì‚¬ì¸ ìœ ì‚¬ë„ë¡œ í•´ë‹¹ ì˜ì—­ ì°¾ê¸°</span>

<span class="sd">ì¥ì :</span>
<span class="sd">- í•™ìŠµ ì—†ì´ ì„¸ê·¸ë©˜í…Œì´ì…˜ ê°€ëŠ¥</span>
<span class="sd">- ìƒˆë¡œìš´ ê°ì²´ í´ë˜ìŠ¤ë„ ì²˜ë¦¬ ê°€ëŠ¥</span>
<span class="sd">&quot;&quot;&quot;</span>

<span class="k">def</span><span class="w"> </span><span class="nf">segment_with_reference</span><span class="p">(</span><span class="n">model</span><span class="p">,</span> <span class="n">processor</span><span class="p">,</span> <span class="n">target_image</span><span class="p">,</span> <span class="n">reference_image</span><span class="p">,</span> <span class="n">reference_mask</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    ì°¸ì¡° ì´ë¯¸ì§€ì˜ ë§ˆìŠ¤í¬ë¥¼ ì´ìš©í•´ íƒ€ê²Ÿ ì´ë¯¸ì§€ ì„¸ê·¸ë©˜í…Œì´ì…˜</span>

<span class="sd">    Args:</span>
<span class="sd">        target_image: ì„¸ê·¸ë©˜í…Œì´ì…˜í•  ì´ë¯¸ì§€</span>
<span class="sd">        reference_image: ì°¸ì¡° ì´ë¯¸ì§€</span>
<span class="sd">        reference_mask: ì°¸ì¡° ì´ë¯¸ì§€ì˜ ê´€ì‹¬ ì˜ì—­ ë§ˆìŠ¤í¬ (binary)</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># íŠ¹ì§• ì¶”ì¶œ</span>
    <span class="k">with</span> <span class="n">torch</span><span class="o">.</span><span class="n">no_grad</span><span class="p">():</span>
        <span class="n">target_inputs</span> <span class="o">=</span> <span class="n">processor</span><span class="p">(</span><span class="n">images</span><span class="o">=</span><span class="n">target_image</span><span class="p">,</span> <span class="n">return_tensors</span><span class="o">=</span><span class="s2">&quot;pt&quot;</span><span class="p">)</span>
        <span class="n">target_outputs</span> <span class="o">=</span> <span class="n">model</span><span class="p">(</span><span class="o">**</span><span class="n">target_inputs</span><span class="p">)</span>
        <span class="n">target_patches</span> <span class="o">=</span> <span class="n">target_outputs</span><span class="o">.</span><span class="n">last_hidden_state</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">:]</span>  <span class="c1"># (n_patches, hidden)</span>

        <span class="n">ref_inputs</span> <span class="o">=</span> <span class="n">processor</span><span class="p">(</span><span class="n">images</span><span class="o">=</span><span class="n">reference_image</span><span class="p">,</span> <span class="n">return_tensors</span><span class="o">=</span><span class="s2">&quot;pt&quot;</span><span class="p">)</span>
        <span class="n">ref_outputs</span> <span class="o">=</span> <span class="n">model</span><span class="p">(</span><span class="o">**</span><span class="n">ref_inputs</span><span class="p">)</span>
        <span class="n">ref_patches</span> <span class="o">=</span> <span class="n">ref_outputs</span><span class="o">.</span><span class="n">last_hidden_state</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">:]</span>  <span class="c1"># (n_patches, hidden)</span>

    <span class="c1"># ì°¸ì¡° ë§ˆìŠ¤í¬ì—ì„œ ê´€ì‹¬ ì˜ì—­ì˜ íŠ¹ì§• í‰ê· </span>
    <span class="n">n_patches</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">ref_patches</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]))</span>
    <span class="n">mask_resized</span> <span class="o">=</span> <span class="n">F</span><span class="o">.</span><span class="n">interpolate</span><span class="p">(</span>
        <span class="n">reference_mask</span><span class="o">.</span><span class="n">unsqueeze</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">unsqueeze</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">float</span><span class="p">(),</span>
        <span class="n">size</span><span class="o">=</span><span class="p">(</span><span class="n">n_patches</span><span class="p">,</span> <span class="n">n_patches</span><span class="p">),</span>
        <span class="n">mode</span><span class="o">=</span><span class="s1">&#39;nearest&#39;</span>
    <span class="p">)</span><span class="o">.</span><span class="n">squeeze</span><span class="p">()</span><span class="o">.</span><span class="n">bool</span><span class="p">()</span>

    <span class="n">foreground_features</span> <span class="o">=</span> <span class="n">ref_patches</span><span class="p">[</span><span class="n">mask_resized</span><span class="o">.</span><span class="n">flatten</span><span class="p">()]</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">dim</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>

    <span class="c1"># íƒ€ê²Ÿ ì´ë¯¸ì§€ì˜ ê° íŒ¨ì¹˜ì™€ ìœ ì‚¬ë„ ê³„ì‚°</span>
    <span class="n">similarities</span> <span class="o">=</span> <span class="n">F</span><span class="o">.</span><span class="n">cosine_similarity</span><span class="p">(</span>
        <span class="n">target_patches</span><span class="p">,</span>
        <span class="n">foreground_features</span><span class="o">.</span><span class="n">unsqueeze</span><span class="p">(</span><span class="mi">0</span><span class="p">),</span>
        <span class="n">dim</span><span class="o">=</span><span class="mi">1</span>
    <span class="p">)</span>

    <span class="c1"># Reshape to 2D</span>
    <span class="n">similarity_map</span> <span class="o">=</span> <span class="n">similarities</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">n_patches</span><span class="p">,</span> <span class="n">n_patches</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">similarity_map</span><span class="o">.</span><span class="n">numpy</span><span class="p">()</span>
</code></pre></div>

<h3 id="52-depth-estimation">5.2 Depth Estimation<a class="header-link" href="#52-depth-estimation" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">DINOv2 + Linear Probeë¡œ Depth Estimation</span>

<span class="sd">ë°©ë²•:</span>
<span class="sd">1. DINOv2ë¡œ íŒ¨ì¹˜ íŠ¹ì§• ì¶”ì¶œ</span>
<span class="sd">2. ê°„ë‹¨í•œ Linear layerë¡œ depth ì˜ˆì¸¡</span>
<span class="sd">3. ì ì€ ë°ì´í„°ë¡œë„ ì¢‹ì€ ì„±ëŠ¥</span>

<span class="sd">ì´ìœ :</span>
<span class="sd">- DINOv2ê°€ ì´ë¯¸ 3D êµ¬ì¡° ì •ë³´ë¥¼ í•™ìŠµ</span>
<span class="sd">- íŒ¨ì¹˜ íŠ¹ì§•ì— depth cueê°€ ì¸ì½”ë”©ë¨</span>
<span class="sd">&quot;&quot;&quot;</span>

<span class="k">class</span><span class="w"> </span><span class="nc">DepthEstimator</span><span class="p">(</span><span class="n">nn</span><span class="o">.</span><span class="n">Module</span><span class="p">):</span>
    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">dinov2_model</span><span class="p">,</span> <span class="n">hidden_dim</span><span class="o">=</span><span class="mi">768</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">backbone</span> <span class="o">=</span> <span class="n">dinov2_model</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">backbone</span><span class="o">.</span><span class="n">eval</span><span class="p">()</span>
        <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">backbone</span><span class="o">.</span><span class="n">parameters</span><span class="p">():</span>
            <span class="n">p</span><span class="o">.</span><span class="n">requires_grad</span> <span class="o">=</span> <span class="kc">False</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">head</span> <span class="o">=</span> <span class="n">nn</span><span class="o">.</span><span class="n">Sequential</span><span class="p">(</span>
            <span class="n">nn</span><span class="o">.</span><span class="n">Linear</span><span class="p">(</span><span class="n">hidden_dim</span><span class="p">,</span> <span class="mi">256</span><span class="p">),</span>
            <span class="n">nn</span><span class="o">.</span><span class="n">ReLU</span><span class="p">(),</span>
            <span class="n">nn</span><span class="o">.</span><span class="n">Linear</span><span class="p">(</span><span class="mi">256</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span>
            <span class="n">nn</span><span class="o">.</span><span class="n">Sigmoid</span><span class="p">()</span>
        <span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">forward</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">):</span>
        <span class="k">with</span> <span class="n">torch</span><span class="o">.</span><span class="n">no_grad</span><span class="p">():</span>
            <span class="n">features</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">backbone</span><span class="p">(</span><span class="n">x</span><span class="p">)</span><span class="o">.</span><span class="n">last_hidden_state</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">:]</span>  <span class="c1"># patch tokens</span>

        <span class="n">depth</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">head</span><span class="p">(</span><span class="n">features</span><span class="p">)</span>  <span class="c1"># (batch, n_patches, 1)</span>

        <span class="c1"># Reshape to image</span>
        <span class="n">batch</span><span class="p">,</span> <span class="n">n_patches</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">depth</span><span class="o">.</span><span class="n">shape</span>
        <span class="n">h</span> <span class="o">=</span> <span class="n">w</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">n_patches</span><span class="p">))</span>
        <span class="n">depth</span> <span class="o">=</span> <span class="n">depth</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">batch</span><span class="p">,</span> <span class="n">h</span><span class="p">,</span> <span class="n">w</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">depth</span>
</code></pre></div>

<hr />
<h2 id="_2">ì •ë¦¬<a class="header-link" href="#_2" title="Permanent link">&para;</a></h2>
<h3 id="dinodinov2">DINO/DINOv2 í•µì‹¬<a class="header-link" href="#dinodinov2" title="Permanent link">&para;</a></h3>
<table>
<thead>
<tr>
<th>ê°œë…</th>
<th>ì„¤ëª…</th>
</tr>
</thead>
<tbody>
<tr>
<td><strong>Self-distillation</strong></td>
<td>Teacher-Student êµ¬ì¡°, ë ˆì´ë¸” ì—†ì´ í•™ìŠµ</td>
</tr>
<tr>
<td><strong>Multi-crop</strong></td>
<td>Global + Local cropsë¡œ ë‹¤ì–‘í•œ ìŠ¤ì¼€ì¼ í•™ìŠµ</td>
</tr>
<tr>
<td><strong>Centering</strong></td>
<td>Teacher ì¶œë ¥ centeringìœ¼ë¡œ collapse ë°©ì§€</td>
</tr>
<tr>
<td><strong>EMA Teacher</strong></td>
<td>Momentumìœ¼ë¡œ ì•ˆì •ì ì¸ íƒ€ê²Ÿ ì œê³µ</td>
</tr>
<tr>
<td><strong>iBOT</strong></td>
<td>Masked patch prediction ì¶”ê°€ (DINOv2)</td>
</tr>
</tbody>
</table>
<h3 id="_3">í™œìš©<a class="header-link" href="#_3" title="Permanent link">&para;</a></h3>
<ul>
<li><strong>Image Retrieval</strong>: CLS tokenìœ¼ë¡œ ìœ ì‚¬ ì´ë¯¸ì§€ ê²€ìƒ‰</li>
<li><strong>Semantic Segmentation</strong>: íŒ¨ì¹˜ íŠ¹ì§•ìœ¼ë¡œ zero-shot ì„¸ê·¸ë©˜í…Œì´ì…˜</li>
<li><strong>Depth Estimation</strong>: Linear probeë¡œ depth ì˜ˆì¸¡</li>
<li><strong>Fine-tuning</strong>: ë‹¤ìš´ìŠ¤íŠ¸ë¦¼ íƒœìŠ¤í¬ í•™ìŠµ</li>
</ul>
<h3 id="_4">ë‹¤ìŒ ë‹¨ê³„<a class="header-link" href="#_4" title="Permanent link">&para;</a></h3>
<ul>
<li><a href="13_Segment_Anything.md">13_Segment_Anything.md</a>: SAMì˜ promptable segmentation</li>
<li><a href="14_Unified_Vision_Models.md">14_Unified_Vision_Models.md</a>: í†µí•© Vision Foundation Models</li>
</ul>
<hr />
<h2 id="_5">ì°¸ê³  ìë£Œ<a class="header-link" href="#_5" title="Permanent link">&para;</a></h2>
<h3 id="_6">ë…¼ë¬¸<a class="header-link" href="#_6" title="Permanent link">&para;</a></h3>
<ul>
<li>Caron et al. (2021). "Emerging Properties in Self-Supervised Vision Transformers" (DINO)</li>
<li>Oquab et al. (2023). "DINOv2: Learning Robust Visual Features without Supervision"</li>
<li>Zhou et al. (2021). "iBOT: Image BERT Pre-Training with Online Tokenizer"</li>
</ul>
<h3 id="_7">ì½”ë“œ<a class="header-link" href="#_7" title="Permanent link">&para;</a></h3>
<ul>
<li><a href="https://github.com/facebookresearch/dino">DINO GitHub</a></li>
<li><a href="https://github.com/facebookresearch/dinov2">DINOv2 GitHub</a></li>
<li><a href="https://huggingface.co/facebook/dinov2-base">HuggingFace DINOv2</a></li>
</ul>
    </div>

    
<div class="lesson-toolbar lesson-toolbar--bottom">
    <div class="toolbar-nav toolbar-nav--prev">
        
        <a href="/study/ko/Foundation_Models/11_Small_Language_Models.html" class="nav-prev">
            <span class="nav-label">Previous</span>
            <span class="nav-title">11. Small Language Models</span>
        </a>
        
    </div>
    <div class="toolbar-actions">
        <button class="btn btn-copy-link" data-action="copy-link" title="Copy link">
            <span class="icon">ğŸ”—</span>
            <span class="text">Copy link</span>
        </button>
        <a href="/study/ko/Foundation_Models/" class="btn btn-topic-link" title="Back to topic list">
            <span class="icon">ğŸ“‹</span>
            <span class="text">Topic list</span>
        </a>
    </div>
    <div class="toolbar-nav toolbar-nav--next">
        
        <a href="/study/ko/Foundation_Models/13_Segment_Anything.html" class="nav-next">
            <span class="nav-label">Next</span>
            <span class="nav-title">Segment Anything Model (SAM)</span>
        </a>
        
    </div>
</div>


    <div class="toolbar-keyboard-hint">
        <kbd>&larr;</kbd> <kbd>&rarr;</kbd> to navigate between lessons
    </div>
</article>

<!-- Scroll to top floating button -->
<button class="scroll-to-top" id="scroll-to-top" title="Scroll to top" aria-label="Scroll to top">â†‘</button>

            </div>
        </main>
    </div>

    <script src="/study/static/js/app.js"></script>
    <script>
        function switchLanguage(newLang) {
            const path = window.location.pathname;
            const base = '/study';
            const currentLang = 'ko';
            const newPath = path.replace(base + '/' + currentLang + '/', base + '/' + newLang + '/');
            window.location.href = newPath + window.location.search;
        }
    </script>
    
<script>
    document.addEventListener('DOMContentLoaded', function() {
        // Copy link - independent feedback per button
        document.querySelectorAll('[data-action="copy-link"]').forEach(function(btn) {
            btn.addEventListener('click', function() {
                navigator.clipboard.writeText(window.location.href);
                var textEl = this.querySelector('.text');
                var originalText = textEl.textContent;
                textEl.textContent = 'Copied!';
                setTimeout(function() { textEl.textContent = originalText; }, 2000);
            });
        });

        // Add copy buttons to code blocks
        document.querySelectorAll('.lesson-content pre').forEach(function(pre) {
            var copyBtn = document.createElement('button');
            copyBtn.className = 'code-copy-btn';
            copyBtn.textContent = 'Copy';
            copyBtn.addEventListener('click', function() {
                var code = pre.querySelector('code');
                var text = code ? code.textContent : pre.textContent;
                navigator.clipboard.writeText(text);
                copyBtn.textContent = 'Copied!';
                setTimeout(function() { copyBtn.textContent = 'Copy'; }, 2000);
            });
            pre.style.position = 'relative';
            pre.appendChild(copyBtn);
        });

        // Scroll to top button
        var scrollBtn = document.getElementById('scroll-to-top');
        window.addEventListener('scroll', function() {
            scrollBtn.classList.toggle('visible', window.scrollY > 300);
        });
        scrollBtn.addEventListener('click', function() {
            window.scrollTo({ top: 0, behavior: 'smooth' });
        });

        // Keyboard shortcuts: left/right arrows for lesson navigation
        document.addEventListener('keydown', function(e) {
            var tag = document.activeElement.tagName;
            if (tag === 'INPUT' || tag === 'TEXTAREA' || tag === 'SELECT') return;

            if (e.key === 'ArrowLeft') {
                var prevLink = document.querySelector('.nav-prev');
                if (prevLink) prevLink.click();
            } else if (e.key === 'ArrowRight') {
                var nextLink = document.querySelector('.nav-next');
                if (nextLink) nextLink.click();
            }
        });
    });
</script>

</body>
</html>
{% endraw %}