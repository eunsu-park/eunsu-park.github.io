{% raw %}
<!DOCTYPE html>
<html lang="ko" data-theme="light">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>18. Audio/Video Foundation Models - Study Materials</title>
    <link rel="stylesheet" href="/study/static/css/style.css">
    <link rel="stylesheet" href="/study/static/css/highlight.css">
    <!-- KaTeX for LaTeX math rendering -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.16.11/dist/katex.min.css">
    <script defer src="https://cdn.jsdelivr.net/npm/katex@0.16.11/dist/katex.min.js"></script>
    <script defer src="https://cdn.jsdelivr.net/npm/katex@0.16.11/dist/contrib/auto-render.min.js"
        onload="renderMathInElement(document.body, {
            delimiters: [
                {left: '$$', right: '$$', display: true},
                {left: '$', right: '$', display: false}
            ],
            throwOnError: false
        });"></script>
    
</head>
<body>
    <div class="app-container">
        <!-- Sidebar -->
        <aside class="sidebar" id="sidebar">
            <div class="sidebar-header">
                <a href="/study/ko/" class="logo">Study Materials</a>
                <button class="sidebar-toggle" id="sidebar-toggle" aria-label="Toggle sidebar">
                    <span></span>
                </button>
            </div>

            <nav class="sidebar-nav">
                <a href="/study/ko/" class="nav-item ">
                    <span class="nav-icon">ğŸ </span>
                    <span class="nav-text">Home</span>
                </a>
                <a href="/study/examples/" class="nav-item ">
                    <span class="nav-icon">ğŸ’»</span>
                    <span class="nav-text">Examples</span>
                </a>
            </nav>

            <div class="sidebar-search">
                <form action="/study/ko/search.html" method="get" id="search-form">
                    <input type="search" name="q" placeholder="Search..." id="search-sidebar-input">
                </form>
            </div>

            <!-- Language Selector -->
            <div class="sidebar-lang">
                <select id="lang-select" class="lang-selector" onchange="switchLanguage(this.value)">
                    
                    <option value="en" >
                        English
                    </option>
                    
                    <option value="ko" selected>
                        í•œêµ­ì–´
                    </option>
                    
                </select>
            </div>

            <div class="sidebar-footer">
                <button class="theme-toggle" id="theme-toggle" aria-label="Toggle theme">
                    <span class="theme-icon light">â˜€ï¸</span>
                    <span class="theme-icon dark">ğŸŒ™</span>
                </button>
            </div>
        </aside>

        <!-- Main Content -->
        <main class="main-content">
            <header class="main-header">
                <button class="menu-toggle" id="menu-toggle" aria-label="Open menu">
                    <span></span>
                </button>
                
<nav class="breadcrumb">
    <a href="/study/ko/">Topics</a>
    <span class="separator">/</span>
    <a href="/study/ko/Foundation_Models/">Foundation Models</a>
    <span class="separator">/</span>
    <span class="current">18. Audio/Video Foundation Models</span>
</nav>

            </header>

            <div class="content">
                
<article class="lesson-article">
    <header class="lesson-header">
        <h1>18. Audio/Video Foundation Models</h1>
    </header>

    
<div class="lesson-toolbar lesson-toolbar--top">
    <div class="toolbar-nav toolbar-nav--prev">
        
        <a href="/study/ko/Foundation_Models/17_GPT4V_Gemini.html" class="nav-prev">
            <span class="nav-label">Previous</span>
            <span class="nav-title">17. GPT-4V, GPT-4o, Gemini & Claude 3</span>
        </a>
        
    </div>
    <div class="toolbar-actions">
        <button class="btn btn-copy-link" data-action="copy-link" title="Copy link">
            <span class="icon">ğŸ”—</span>
            <span class="text">Copy link</span>
        </button>
        <a href="/study/ko/Foundation_Models/" class="btn btn-topic-link" title="Back to topic list">
            <span class="icon">ğŸ“‹</span>
            <span class="text">Topic list</span>
        </a>
    </div>
    <div class="toolbar-nav toolbar-nav--next">
        
        <a href="/study/ko/Foundation_Models/19_PEFT_Unified.html" class="nav-next">
            <span class="nav-label">Next</span>
            <span class="nav-title">19. PEFT (Parameter-Efficient Fine-Tuning) í†µí•©</span>
        </a>
        
    </div>
</div>


    
    <nav class="toc" id="toc">
        <h2>Table of Contents</h2>
        <div class="toc">
<ul>
<li><a href="#_1">ê°œìš”</a></li>
<li><a href="#1-speech-foundation-models">1. Speech Foundation Models</a><ul>
<li><a href="#11-whisper">1.1 Whisper</a></li>
<li><a href="#12-speech-synthesis-tts">1.2 Speech Synthesis (TTS)</a></li>
</ul>
</li>
<li><a href="#2-audio-generation-models">2. Audio Generation Models</a><ul>
<li><a href="#21-audiolm">2.1 AudioLM</a></li>
<li><a href="#22-musicgen">2.2 MusicGen</a></li>
<li><a href="#23-audiocraft-audio-diffusion">2.3 AudioCraft (Audio Diffusion)</a></li>
</ul>
</li>
<li><a href="#3-video-understanding-models">3. Video Understanding Models</a><ul>
<li><a href="#31-video-llama-videollama-2">3.1 Video-LLaMA / VideoLLaMA 2</a></li>
<li><a href="#32-video-generation-sora">3.2 Video Generation ê°œë… (Sora)</a></li>
</ul>
</li>
<li><a href="#4">4. ì‹¤ìš©ì  ì‘ìš©</a><ul>
<li><a href="#41-multimodal-pipeline">4.1 Multimodal Pipeline</a></li>
<li><a href="#42-real-time-processing">4.2 Real-time Processing</a></li>
</ul>
</li>
<li><a href="#5">5. ëª¨ë¸ ë¹„êµ</a><ul>
<li><a href="#51-speech-models">5.1 Speech Models</a></li>
<li><a href="#52-audio-generation">5.2 Audio Generation</a></li>
<li><a href="#53-video-models">5.3 Video Models</a></li>
</ul>
</li>
<li><a href="#_2">í•µì‹¬ ì •ë¦¬</a><ul>
<li><a href="#audio-foundation-models">Audio Foundation Models</a></li>
<li><a href="#video-foundation-models">Video Foundation Models</a></li>
<li><a href="#_3">ì‹¤ìš© í¬ì¸íŠ¸</a></li>
</ul>
</li>
<li><a href="#_4">ì°¸ê³  ìë£Œ</a></li>
</ul>
</div>

    </nav>
    

    <div class="lesson-content markdown-body">
        <h1 id="18-audiovideo-foundation-models">18. Audio/Video Foundation Models<a class="header-link" href="#18-audiovideo-foundation-models" title="Permanent link">&para;</a></h1>
<h2 id="_1">ê°œìš”<a class="header-link" href="#_1" title="Permanent link">&para;</a></h2>
<p>Audioì™€ Video ë„ë©”ì¸ì˜ Foundation Modelë“¤ì€ ìŒì„± ì¸ì‹, ìŒì•… ìƒì„±, ë¹„ë””ì˜¤ ì´í•´ ë“± ë‹¤ì–‘í•œ ë©€í‹°ë¯¸ë””ì–´ íƒœìŠ¤í¬ë¥¼ í†µí•©ì ìœ¼ë¡œ ì²˜ë¦¬í•©ë‹ˆë‹¤.</p>
<hr />
<h2 id="1-speech-foundation-models">1. Speech Foundation Models<a class="header-link" href="#1-speech-foundation-models" title="Permanent link">&para;</a></h2>
<h3 id="11-whisper">1.1 Whisper<a class="header-link" href="#11-whisper" title="Permanent link">&para;</a></h3>
<p>OpenAIì˜ ë²”ìš© ìŒì„± ì¸ì‹ ëª¨ë¸:</p>
<div class="highlight"><pre><span></span><code>Whisper ì•„í‚¤í…ì²˜:
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Audio Input (30ì´ˆ ì„¸ê·¸ë¨¼íŠ¸)                  â”‚
â”‚       â†“                                      â”‚
â”‚  Log-Mel Spectrogram (80 bins)              â”‚
â”‚       â†“                                      â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                   â”‚
â”‚  â”‚   Audio Encoder      â”‚                   â”‚
â”‚  â”‚   (Transformer)      â”‚                   â”‚
â”‚  â”‚   - Conv1d stem      â”‚                   â”‚
â”‚  â”‚   - Sinusoidal pos   â”‚                   â”‚
â”‚  â”‚   - N layers         â”‚                   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                   â”‚
â”‚       â†“                                      â”‚
â”‚  Audio Features                              â”‚
â”‚       â†“                                      â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                   â”‚
â”‚  â”‚   Text Decoder       â”‚                   â”‚
â”‚  â”‚   (Transformer)      â”‚                   â”‚
â”‚  â”‚   - Cross-attention  â”‚                   â”‚
â”‚  â”‚   - Causal masking   â”‚                   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                   â”‚
â”‚       â†“                                      â”‚
â”‚  Text Output (Transcription/Translation)    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

ëª¨ë¸ í¬ê¸°:
- tiny:   39M params,  ~32x realtime
- base:   74M params,  ~16x realtime
- small:  244M params, ~6x realtime
- medium: 769M params, ~2x realtime
- large:  1.55B params, ~1x realtime
</code></pre></div>

<div class="highlight"><pre><span></span><code><span class="kn">import</span><span class="w"> </span><span class="nn">torch</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">whisper</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">transformers</span><span class="w"> </span><span class="kn">import</span> <span class="n">WhisperProcessor</span><span class="p">,</span> <span class="n">WhisperForConditionalGeneration</span>

<span class="c1"># OpenAI whisper ì‚¬ìš©</span>
<span class="k">def</span><span class="w"> </span><span class="nf">transcribe_with_whisper</span><span class="p">():</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;OpenAI Whisperë¡œ ìŒì„± ì¸ì‹&quot;&quot;&quot;</span>
    <span class="n">model</span> <span class="o">=</span> <span class="n">whisper</span><span class="o">.</span><span class="n">load_model</span><span class="p">(</span><span class="s2">&quot;base&quot;</span><span class="p">)</span>

    <span class="c1"># ê¸°ë³¸ transcription</span>
    <span class="n">result</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">transcribe</span><span class="p">(</span><span class="s2">&quot;audio.mp3&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">result</span><span class="p">[</span><span class="s2">&quot;text&quot;</span><span class="p">])</span>

    <span class="c1"># ì–¸ì–´ ê°ì§€ ë° ë²ˆì—­</span>
    <span class="n">result</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">transcribe</span><span class="p">(</span>
        <span class="s2">&quot;audio.mp3&quot;</span><span class="p">,</span>
        <span class="n">task</span><span class="o">=</span><span class="s2">&quot;translate&quot;</span><span class="p">,</span>  <span class="c1"># ì˜ì–´ë¡œ ë²ˆì—­</span>
        <span class="n">language</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>     <span class="c1"># ìë™ ê°ì§€</span>
        <span class="n">fp16</span><span class="o">=</span><span class="n">torch</span><span class="o">.</span><span class="n">cuda</span><span class="o">.</span><span class="n">is_available</span><span class="p">()</span>
    <span class="p">)</span>

    <span class="c1"># íƒ€ì„ìŠ¤íƒ¬í”„ í¬í•¨</span>
    <span class="n">result</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">transcribe</span><span class="p">(</span>
        <span class="s2">&quot;audio.mp3&quot;</span><span class="p">,</span>
        <span class="n">word_timestamps</span><span class="o">=</span><span class="kc">True</span>
    <span class="p">)</span>

    <span class="k">for</span> <span class="n">segment</span> <span class="ow">in</span> <span class="n">result</span><span class="p">[</span><span class="s2">&quot;segments&quot;</span><span class="p">]:</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;[</span><span class="si">{</span><span class="n">segment</span><span class="p">[</span><span class="s1">&#39;start&#39;</span><span class="p">]</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2"> - </span><span class="si">{</span><span class="n">segment</span><span class="p">[</span><span class="s1">&#39;end&#39;</span><span class="p">]</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2">] </span><span class="si">{</span><span class="n">segment</span><span class="p">[</span><span class="s1">&#39;text&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">result</span>


<span class="c1"># HuggingFace Transformers ì‚¬ìš©</span>
<span class="k">def</span><span class="w"> </span><span class="nf">transcribe_with_hf_whisper</span><span class="p">():</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;HuggingFace Whisper ì‚¬ìš©&quot;&quot;&quot;</span>
    <span class="n">processor</span> <span class="o">=</span> <span class="n">WhisperProcessor</span><span class="o">.</span><span class="n">from_pretrained</span><span class="p">(</span><span class="s2">&quot;openai/whisper-base&quot;</span><span class="p">)</span>
    <span class="n">model</span> <span class="o">=</span> <span class="n">WhisperForConditionalGeneration</span><span class="o">.</span><span class="n">from_pretrained</span><span class="p">(</span><span class="s2">&quot;openai/whisper-base&quot;</span><span class="p">)</span>

    <span class="c1"># ì˜¤ë””ì˜¤ ë¡œë“œ (16kHz)</span>
    <span class="kn">import</span><span class="w"> </span><span class="nn">librosa</span>
    <span class="n">audio</span><span class="p">,</span> <span class="n">sr</span> <span class="o">=</span> <span class="n">librosa</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="s2">&quot;audio.mp3&quot;</span><span class="p">,</span> <span class="n">sr</span><span class="o">=</span><span class="mi">16000</span><span class="p">)</span>

    <span class="c1"># ì…ë ¥ ì²˜ë¦¬</span>
    <span class="n">input_features</span> <span class="o">=</span> <span class="n">processor</span><span class="p">(</span>
        <span class="n">audio</span><span class="p">,</span>
        <span class="n">sampling_rate</span><span class="o">=</span><span class="mi">16000</span><span class="p">,</span>
        <span class="n">return_tensors</span><span class="o">=</span><span class="s2">&quot;pt&quot;</span>
    <span class="p">)</span><span class="o">.</span><span class="n">input_features</span>

    <span class="c1"># ìƒì„±</span>
    <span class="n">predicted_ids</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">generate</span><span class="p">(</span>
        <span class="n">input_features</span><span class="p">,</span>
        <span class="n">language</span><span class="o">=</span><span class="s2">&quot;korean&quot;</span><span class="p">,</span>
        <span class="n">task</span><span class="o">=</span><span class="s2">&quot;transcribe&quot;</span>
    <span class="p">)</span>

    <span class="c1"># ë””ì½”ë”©</span>
    <span class="n">transcription</span> <span class="o">=</span> <span class="n">processor</span><span class="o">.</span><span class="n">batch_decode</span><span class="p">(</span>
        <span class="n">predicted_ids</span><span class="p">,</span>
        <span class="n">skip_special_tokens</span><span class="o">=</span><span class="kc">True</span>
    <span class="p">)[</span><span class="mi">0</span><span class="p">]</span>

    <span class="k">return</span> <span class="n">transcription</span>


<span class="c1"># Whisper Fine-tuning</span>
<span class="k">class</span><span class="w"> </span><span class="nc">WhisperFineTuner</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;ë„ë©”ì¸ íŠ¹í™” Whisper Fine-tuning&quot;&quot;&quot;</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">model_name</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;openai/whisper-small&quot;</span><span class="p">):</span>
        <span class="kn">from</span><span class="w"> </span><span class="nn">transformers</span><span class="w"> </span><span class="kn">import</span> <span class="p">(</span>
            <span class="n">WhisperForConditionalGeneration</span><span class="p">,</span>
            <span class="n">WhisperProcessor</span><span class="p">,</span>
            <span class="n">Seq2SeqTrainingArguments</span><span class="p">,</span>
            <span class="n">Seq2SeqTrainer</span>
        <span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">processor</span> <span class="o">=</span> <span class="n">WhisperProcessor</span><span class="o">.</span><span class="n">from_pretrained</span><span class="p">(</span><span class="n">model_name</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">model</span> <span class="o">=</span> <span class="n">WhisperForConditionalGeneration</span><span class="o">.</span><span class="n">from_pretrained</span><span class="p">(</span><span class="n">model_name</span><span class="p">)</span>

        <span class="c1"># Freeze encoder (ì„ íƒì )</span>
        <span class="k">for</span> <span class="n">param</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">encoder</span><span class="o">.</span><span class="n">parameters</span><span class="p">():</span>
            <span class="n">param</span><span class="o">.</span><span class="n">requires_grad</span> <span class="o">=</span> <span class="kc">False</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">prepare_dataset</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">dataset</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;ë°ì´í„°ì…‹ ì „ì²˜ë¦¬&quot;&quot;&quot;</span>
        <span class="k">def</span><span class="w"> </span><span class="nf">prepare_example</span><span class="p">(</span><span class="n">example</span><span class="p">):</span>
            <span class="n">audio</span> <span class="o">=</span> <span class="n">example</span><span class="p">[</span><span class="s2">&quot;audio&quot;</span><span class="p">][</span><span class="s2">&quot;array&quot;</span><span class="p">]</span>

            <span class="c1"># ì…ë ¥ íŠ¹ì§• ì¶”ì¶œ</span>
            <span class="n">input_features</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">processor</span><span class="p">(</span>
                <span class="n">audio</span><span class="p">,</span>
                <span class="n">sampling_rate</span><span class="o">=</span><span class="mi">16000</span><span class="p">,</span>
                <span class="n">return_tensors</span><span class="o">=</span><span class="s2">&quot;pt&quot;</span>
            <span class="p">)</span><span class="o">.</span><span class="n">input_features</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>

            <span class="c1"># ë ˆì´ë¸” í† í°í™”</span>
            <span class="n">labels</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">processor</span><span class="o">.</span><span class="n">tokenizer</span><span class="p">(</span>
                <span class="n">example</span><span class="p">[</span><span class="s2">&quot;transcription&quot;</span><span class="p">]</span>
            <span class="p">)</span><span class="o">.</span><span class="n">input_ids</span>

            <span class="k">return</span> <span class="p">{</span>
                <span class="s2">&quot;input_features&quot;</span><span class="p">:</span> <span class="n">input_features</span><span class="p">,</span>
                <span class="s2">&quot;labels&quot;</span><span class="p">:</span> <span class="n">labels</span>
            <span class="p">}</span>

        <span class="k">return</span> <span class="n">dataset</span><span class="o">.</span><span class="n">map</span><span class="p">(</span><span class="n">prepare_example</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">train</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">train_dataset</span><span class="p">,</span> <span class="n">eval_dataset</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Fine-tuning ì‹¤í–‰&quot;&quot;&quot;</span>
        <span class="kn">from</span><span class="w"> </span><span class="nn">transformers</span><span class="w"> </span><span class="kn">import</span> <span class="n">Seq2SeqTrainingArguments</span><span class="p">,</span> <span class="n">Seq2SeqTrainer</span>

        <span class="n">training_args</span> <span class="o">=</span> <span class="n">Seq2SeqTrainingArguments</span><span class="p">(</span>
            <span class="n">output_dir</span><span class="o">=</span><span class="s2">&quot;./whisper-finetuned&quot;</span><span class="p">,</span>
            <span class="n">per_device_train_batch_size</span><span class="o">=</span><span class="mi">8</span><span class="p">,</span>
            <span class="n">gradient_accumulation_steps</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span>
            <span class="n">learning_rate</span><span class="o">=</span><span class="mf">1e-5</span><span class="p">,</span>
            <span class="n">warmup_steps</span><span class="o">=</span><span class="mi">500</span><span class="p">,</span>
            <span class="n">num_train_epochs</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span>
            <span class="n">evaluation_strategy</span><span class="o">=</span><span class="s2">&quot;steps&quot;</span><span class="p">,</span>
            <span class="n">eval_steps</span><span class="o">=</span><span class="mi">500</span><span class="p">,</span>
            <span class="n">save_steps</span><span class="o">=</span><span class="mi">1000</span><span class="p">,</span>
            <span class="n">fp16</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
            <span class="n">predict_with_generate</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
            <span class="n">generation_max_length</span><span class="o">=</span><span class="mi">225</span>
        <span class="p">)</span>

        <span class="n">trainer</span> <span class="o">=</span> <span class="n">Seq2SeqTrainer</span><span class="p">(</span>
            <span class="n">model</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="p">,</span>
            <span class="n">args</span><span class="o">=</span><span class="n">training_args</span><span class="p">,</span>
            <span class="n">train_dataset</span><span class="o">=</span><span class="n">train_dataset</span><span class="p">,</span>
            <span class="n">eval_dataset</span><span class="o">=</span><span class="n">eval_dataset</span><span class="p">,</span>
            <span class="n">tokenizer</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">processor</span><span class="o">.</span><span class="n">feature_extractor</span><span class="p">,</span>
        <span class="p">)</span>

        <span class="n">trainer</span><span class="o">.</span><span class="n">train</span><span class="p">()</span>
</code></pre></div>

<h3 id="12-speech-synthesis-tts">1.2 Speech Synthesis (TTS)<a class="header-link" href="#12-speech-synthesis-tts" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><span class="c1"># VITS/Coqui TTS</span>
<span class="k">def</span><span class="w"> </span><span class="nf">text_to_speech_coqui</span><span class="p">():</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Coqui TTSë¡œ ìŒì„± í•©ì„±&quot;&quot;&quot;</span>
    <span class="kn">from</span><span class="w"> </span><span class="nn">TTS.api</span><span class="w"> </span><span class="kn">import</span> <span class="n">TTS</span>

    <span class="c1"># ë‹¤êµ­ì–´ TTS</span>
    <span class="n">tts</span> <span class="o">=</span> <span class="n">TTS</span><span class="p">(</span><span class="s2">&quot;tts_models/multilingual/multi-dataset/xtts_v2&quot;</span><span class="p">)</span>

    <span class="c1"># ìŒì„± í•©ì„±</span>
    <span class="n">tts</span><span class="o">.</span><span class="n">tts_to_file</span><span class="p">(</span>
        <span class="n">text</span><span class="o">=</span><span class="s2">&quot;ì•ˆë…•í•˜ì„¸ìš”, Foundation Model í•™ìŠµ ìë£Œì…ë‹ˆë‹¤.&quot;</span><span class="p">,</span>
        <span class="n">file_path</span><span class="o">=</span><span class="s2">&quot;output.wav&quot;</span><span class="p">,</span>
        <span class="n">speaker_wav</span><span class="o">=</span><span class="s2">&quot;reference_voice.wav&quot;</span><span class="p">,</span>  <span class="c1"># Voice cloning</span>
        <span class="n">language</span><span class="o">=</span><span class="s2">&quot;ko&quot;</span>
    <span class="p">)</span>


<span class="c1"># Bark (Suno AI)</span>
<span class="k">def</span><span class="w"> </span><span class="nf">text_to_speech_bark</span><span class="p">():</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Barkë¡œ ìŒì„± í•©ì„± (ë¹„ì–¸ì–´ì  í‘œí˜„ í¬í•¨)&quot;&quot;&quot;</span>
    <span class="kn">from</span><span class="w"> </span><span class="nn">transformers</span><span class="w"> </span><span class="kn">import</span> <span class="n">AutoProcessor</span><span class="p">,</span> <span class="n">BarkModel</span>
    <span class="kn">import</span><span class="w"> </span><span class="nn">scipy.io.wavfile</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">wavfile</span>

    <span class="n">processor</span> <span class="o">=</span> <span class="n">AutoProcessor</span><span class="o">.</span><span class="n">from_pretrained</span><span class="p">(</span><span class="s2">&quot;suno/bark&quot;</span><span class="p">)</span>
    <span class="n">model</span> <span class="o">=</span> <span class="n">BarkModel</span><span class="o">.</span><span class="n">from_pretrained</span><span class="p">(</span><span class="s2">&quot;suno/bark&quot;</span><span class="p">)</span>

    <span class="c1"># í…ìŠ¤íŠ¸ (ë¹„ì–¸ì–´ì  í‘œí˜„ í¬í•¨ ê°€ëŠ¥)</span>
    <span class="n">text</span> <span class="o">=</span> <span class="s2">&quot;[laughs] Hello! This is amazing. [sighs]&quot;</span>

    <span class="n">inputs</span> <span class="o">=</span> <span class="n">processor</span><span class="p">(</span><span class="n">text</span><span class="p">,</span> <span class="n">return_tensors</span><span class="o">=</span><span class="s2">&quot;pt&quot;</span><span class="p">)</span>
    <span class="n">audio_array</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">generate</span><span class="p">(</span><span class="o">**</span><span class="n">inputs</span><span class="p">)</span>
    <span class="n">audio_array</span> <span class="o">=</span> <span class="n">audio_array</span><span class="o">.</span><span class="n">cpu</span><span class="p">()</span><span class="o">.</span><span class="n">numpy</span><span class="p">()</span><span class="o">.</span><span class="n">squeeze</span><span class="p">()</span>

    <span class="c1"># ì €ì¥</span>
    <span class="n">wavfile</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;bark_output.wav&quot;</span><span class="p">,</span> <span class="mi">24000</span><span class="p">,</span> <span class="n">audio_array</span><span class="p">)</span>
</code></pre></div>

<hr />
<h2 id="2-audio-generation-models">2. Audio Generation Models<a class="header-link" href="#2-audio-generation-models" title="Permanent link">&para;</a></h2>
<h3 id="21-audiolm">2.1 AudioLM<a class="header-link" href="#21-audiolm" title="Permanent link">&para;</a></h3>
<p>Googleì˜ Audio Language Model:</p>
<div class="highlight"><pre><span></span><code>AudioLM êµ¬ì¡°:
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                   Audio Input                       â”‚
â”‚                       â†“                             â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚           Semantic Tokens (w2v-BERT)          â”‚  â”‚
â”‚  â”‚           - High-level content               â”‚  â”‚
â”‚  â”‚           - ~25 tokens/second                â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                       â†“                             â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚         Coarse Acoustic Tokens (SoundStream) â”‚  â”‚
â”‚  â”‚           - Medium-level details             â”‚  â”‚
â”‚  â”‚           - ~50 tokens/second                â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                       â†“                             â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚          Fine Acoustic Tokens (SoundStream)  â”‚  â”‚
â”‚  â”‚           - Fine-grained details             â”‚  â”‚
â”‚  â”‚           - ~100 tokens/second               â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                       â†“                             â”‚
â”‚                 SoundStream Decoder                 â”‚
â”‚                       â†“                             â”‚
â”‚                   Audio Output                      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

3ë‹¨ê³„ ìƒì„±:
1. Semantic â†’ Semantic (continuation)
2. Semantic â†’ Coarse Acoustic
3. Coarse â†’ Fine Acoustic
</code></pre></div>

<h3 id="22-musicgen">2.2 MusicGen<a class="header-link" href="#22-musicgen" title="Permanent link">&para;</a></h3>
<p>Metaì˜ ìŒì•… ìƒì„± ëª¨ë¸:</p>
<div class="highlight"><pre><span></span><code><span class="kn">from</span><span class="w"> </span><span class="nn">transformers</span><span class="w"> </span><span class="kn">import</span> <span class="n">AutoProcessor</span><span class="p">,</span> <span class="n">MusicgenForConditionalGeneration</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">scipy.io.wavfile</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">wavfile</span>

<span class="k">class</span><span class="w"> </span><span class="nc">MusicGenerator</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;MusicGenì„ ì‚¬ìš©í•œ ìŒì•… ìƒì„±&quot;&quot;&quot;</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">model_size</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;small&quot;</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        model_size: &quot;small&quot; (300M), &quot;medium&quot; (1.5B), &quot;large&quot; (3.3B)</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">model_name</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;facebook/musicgen-</span><span class="si">{</span><span class="n">model_size</span><span class="si">}</span><span class="s2">&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">processor</span> <span class="o">=</span> <span class="n">AutoProcessor</span><span class="o">.</span><span class="n">from_pretrained</span><span class="p">(</span><span class="n">model_name</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">model</span> <span class="o">=</span> <span class="n">MusicgenForConditionalGeneration</span><span class="o">.</span><span class="n">from_pretrained</span><span class="p">(</span><span class="n">model_name</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">torch</span><span class="o">.</span><span class="n">cuda</span><span class="o">.</span><span class="n">is_available</span><span class="p">():</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">model</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="s2">&quot;cuda&quot;</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">generate_from_text</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">prompt</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="n">duration</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">10.0</span><span class="p">,</span>
        <span class="n">temperature</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">1.0</span><span class="p">,</span>
        <span class="n">guidance_scale</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">3.0</span>
    <span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;í…ìŠ¤íŠ¸ í”„ë¡¬í”„íŠ¸ë¡œ ìŒì•… ìƒì„±&quot;&quot;&quot;</span>
        <span class="n">inputs</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">processor</span><span class="p">(</span>
            <span class="n">text</span><span class="o">=</span><span class="p">[</span><span class="n">prompt</span><span class="p">],</span>
            <span class="n">padding</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
            <span class="n">return_tensors</span><span class="o">=</span><span class="s2">&quot;pt&quot;</span>
        <span class="p">)</span>

        <span class="k">if</span> <span class="n">torch</span><span class="o">.</span><span class="n">cuda</span><span class="o">.</span><span class="n">is_available</span><span class="p">():</span>
            <span class="n">inputs</span> <span class="o">=</span> <span class="p">{</span><span class="n">k</span><span class="p">:</span> <span class="n">v</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="s2">&quot;cuda&quot;</span><span class="p">)</span> <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">inputs</span><span class="o">.</span><span class="n">items</span><span class="p">()}</span>

        <span class="c1"># í† í° ìˆ˜ ê³„ì‚° (32kHz, 50 tokens/second)</span>
        <span class="n">max_new_tokens</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">duration</span> <span class="o">*</span> <span class="mi">50</span><span class="p">)</span>

        <span class="n">audio_values</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">generate</span><span class="p">(</span>
            <span class="o">**</span><span class="n">inputs</span><span class="p">,</span>
            <span class="n">max_new_tokens</span><span class="o">=</span><span class="n">max_new_tokens</span><span class="p">,</span>
            <span class="n">do_sample</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
            <span class="n">temperature</span><span class="o">=</span><span class="n">temperature</span><span class="p">,</span>
            <span class="n">guidance_scale</span><span class="o">=</span><span class="n">guidance_scale</span>
        <span class="p">)</span>

        <span class="k">return</span> <span class="n">audio_values</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">cpu</span><span class="p">()</span><span class="o">.</span><span class="n">numpy</span><span class="p">()</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">generate_with_melody</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">prompt</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="n">melody_audio</span><span class="p">:</span> <span class="n">torch</span><span class="o">.</span><span class="n">Tensor</span><span class="p">,</span>
        <span class="n">duration</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">10.0</span>
    <span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;ë©œë¡œë”” ì¡°ê±´ë¶€ ìƒì„± (melody ëª¨ë¸ë§Œ)&quot;&quot;&quot;</span>
        <span class="n">inputs</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">processor</span><span class="p">(</span>
            <span class="n">text</span><span class="o">=</span><span class="p">[</span><span class="n">prompt</span><span class="p">],</span>
            <span class="n">audio</span><span class="o">=</span><span class="n">melody_audio</span><span class="p">,</span>
            <span class="n">sampling_rate</span><span class="o">=</span><span class="mi">32000</span><span class="p">,</span>
            <span class="n">padding</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
            <span class="n">return_tensors</span><span class="o">=</span><span class="s2">&quot;pt&quot;</span>
        <span class="p">)</span>

        <span class="n">max_new_tokens</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">duration</span> <span class="o">*</span> <span class="mi">50</span><span class="p">)</span>

        <span class="n">audio_values</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">generate</span><span class="p">(</span>
            <span class="o">**</span><span class="n">inputs</span><span class="p">,</span>
            <span class="n">max_new_tokens</span><span class="o">=</span><span class="n">max_new_tokens</span>
        <span class="p">)</span>

        <span class="k">return</span> <span class="n">audio_values</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">cpu</span><span class="p">()</span><span class="o">.</span><span class="n">numpy</span><span class="p">()</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">save_audio</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">audio</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span> <span class="n">path</span><span class="p">:</span> <span class="nb">str</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;ì˜¤ë””ì˜¤ ì €ì¥&quot;&quot;&quot;</span>
        <span class="n">wavfile</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="mi">32000</span><span class="p">,</span> <span class="n">audio</span><span class="p">)</span>


<span class="c1"># ì‚¬ìš© ì˜ˆì‹œ</span>
<span class="k">def</span><span class="w"> </span><span class="nf">music_generation_examples</span><span class="p">():</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;ë‹¤ì–‘í•œ ìŒì•… ìƒì„± ì˜ˆì‹œ&quot;&quot;&quot;</span>
    <span class="n">generator</span> <span class="o">=</span> <span class="n">MusicGenerator</span><span class="p">(</span><span class="s2">&quot;small&quot;</span><span class="p">)</span>

    <span class="c1"># í…ìŠ¤íŠ¸ ê¸°ë°˜ ìƒì„±</span>
    <span class="n">prompts</span> <span class="o">=</span> <span class="p">[</span>
        <span class="s2">&quot;A calm piano melody with soft strings in the background&quot;</span><span class="p">,</span>
        <span class="s2">&quot;Upbeat electronic dance music with heavy bass drops&quot;</span><span class="p">,</span>
        <span class="s2">&quot;Traditional Korean music with gayageum and janggu&quot;</span><span class="p">,</span>
        <span class="s2">&quot;Jazz trio improvisation with drums, bass, and piano&quot;</span>
    <span class="p">]</span>

    <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">prompt</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">prompts</span><span class="p">):</span>
        <span class="n">audio</span> <span class="o">=</span> <span class="n">generator</span><span class="o">.</span><span class="n">generate_from_text</span><span class="p">(</span>
            <span class="n">prompt</span><span class="p">,</span>
            <span class="n">duration</span><span class="o">=</span><span class="mf">15.0</span><span class="p">,</span>
            <span class="n">temperature</span><span class="o">=</span><span class="mf">0.9</span><span class="p">,</span>
            <span class="n">guidance_scale</span><span class="o">=</span><span class="mf">3.5</span>
        <span class="p">)</span>
        <span class="n">generator</span><span class="o">.</span><span class="n">save_audio</span><span class="p">(</span><span class="n">audio</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;music_</span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s2">.wav&quot;</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Generated: </span><span class="si">{</span><span class="n">prompt</span><span class="p">[:</span><span class="mi">50</span><span class="p">]</span><span class="si">}</span><span class="s2">...&quot;</span><span class="p">)</span>
</code></pre></div>

<h3 id="23-audiocraft-audio-diffusion">2.3 AudioCraft (Audio Diffusion)<a class="header-link" href="#23-audiocraft-audio-diffusion" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><span class="c1"># AudioGen (ì‚¬ìš´ë“œ íš¨ê³¼ ìƒì„±)</span>
<span class="k">def</span><span class="w"> </span><span class="nf">generate_sound_effects</span><span class="p">():</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;AudioGenìœ¼ë¡œ ì‚¬ìš´ë“œ íš¨ê³¼ ìƒì„±&quot;&quot;&quot;</span>
    <span class="kn">from</span><span class="w"> </span><span class="nn">audiocraft.models</span><span class="w"> </span><span class="kn">import</span> <span class="n">AudioGen</span>
    <span class="kn">from</span><span class="w"> </span><span class="nn">audiocraft.data.audio</span><span class="w"> </span><span class="kn">import</span> <span class="n">audio_write</span>

    <span class="n">model</span> <span class="o">=</span> <span class="n">AudioGen</span><span class="o">.</span><span class="n">get_pretrained</span><span class="p">(</span><span class="s2">&quot;facebook/audiogen-medium&quot;</span><span class="p">)</span>
    <span class="n">model</span><span class="o">.</span><span class="n">set_generation_params</span><span class="p">(</span><span class="n">duration</span><span class="o">=</span><span class="mi">5</span><span class="p">)</span>

    <span class="n">descriptions</span> <span class="o">=</span> <span class="p">[</span>
        <span class="s2">&quot;Dog barking in the distance&quot;</span><span class="p">,</span>
        <span class="s2">&quot;Thunder and heavy rain&quot;</span><span class="p">,</span>
        <span class="s2">&quot;Car engine starting and driving away&quot;</span>
    <span class="p">]</span>

    <span class="n">wav</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">generate</span><span class="p">(</span><span class="n">descriptions</span><span class="p">)</span>

    <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">one_wav</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">wav</span><span class="p">):</span>
        <span class="n">audio_write</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;sound_</span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">one_wav</span><span class="o">.</span><span class="n">cpu</span><span class="p">(),</span> <span class="n">model</span><span class="o">.</span><span class="n">sample_rate</span><span class="p">)</span>
</code></pre></div>

<hr />
<h2 id="3-video-understanding-models">3. Video Understanding Models<a class="header-link" href="#3-video-understanding-models" title="Permanent link">&para;</a></h2>
<h3 id="31-video-llama-videollama-2">3.1 Video-LLaMA / VideoLLaMA 2<a class="header-link" href="#31-video-llama-videollama-2" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><span class="n">VideoLLaMA</span><span class="w"> </span><span class="err">ì•„í‚¤í…ì²˜</span><span class="o">:</span>
<span class="err">â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”</span>
<span class="err">â”‚</span><span class="w">  </span><span class="n">Video</span><span class="w"> </span><span class="n">Input</span><span class="w">                                         </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">  </span><span class="p">[</span><span class="n">Frame1</span><span class="p">,</span><span class="w"> </span><span class="n">Frame2</span><span class="p">,</span><span class="w"> </span><span class="p">...,</span><span class="w"> </span><span class="n">FrameN</span><span class="p">]</span><span class="w">                      </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">          </span><span class="err">â†“</span><span class="w">                                           </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">  </span><span class="err">â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”</span><span class="w"> </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">  </span><span class="err">â”‚</span><span class="w">         </span><span class="n">Visual</span><span class="w"> </span><span class="n">Encoder</span><span class="w"> </span><span class="p">(</span><span class="n">ViT</span><span class="o">/</span><span class="n">CLIP</span><span class="p">)</span><span class="w">              </span><span class="err">â”‚</span><span class="w"> </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">  </span><span class="err">â”‚</span><span class="w">         </span><span class="o">-</span><span class="w"> </span><span class="n">Frame</span><span class="o">-</span><span class="n">level</span><span class="w"> </span><span class="n">features</span><span class="w">                 </span><span class="err">â”‚</span><span class="w"> </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">  </span><span class="err">â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜</span><span class="w"> </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">          </span><span class="err">â†“</span><span class="w">                                           </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">  </span><span class="err">â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”</span><span class="w"> </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">  </span><span class="err">â”‚</span><span class="w">       </span><span class="n">Video</span><span class="w"> </span><span class="n">Q</span><span class="o">-</span><span class="n">Former</span><span class="w">                           </span><span class="err">â”‚</span><span class="w"> </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">  </span><span class="err">â”‚</span><span class="w">       </span><span class="o">-</span><span class="w"> </span><span class="n">Temporal</span><span class="w"> </span><span class="n">aggregation</span><span class="w">                   </span><span class="err">â”‚</span><span class="w"> </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">  </span><span class="err">â”‚</span><span class="w">       </span><span class="o">-</span><span class="w"> </span><span class="n">Cross</span><span class="o">-</span><span class="n">attention</span><span class="w"> </span><span class="n">with</span><span class="w"> </span><span class="n">queries</span><span class="w">           </span><span class="err">â”‚</span><span class="w"> </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">  </span><span class="err">â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜</span><span class="w"> </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">          </span><span class="err">â†“</span><span class="w">                                           </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">  </span><span class="n">Video</span><span class="w"> </span><span class="n">Embeddings</span><span class="w">                                    </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">          </span><span class="o">+</span><span class="w">                                           </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">  </span><span class="n">Audio</span><span class="w"> </span><span class="n">Embeddings</span><span class="w"> </span><span class="p">(</span><span class="n">ImageBind</span><span class="p">)</span><span class="w">                        </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">          </span><span class="err">â†“</span><span class="w">                                           </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">  </span><span class="err">â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”</span><span class="w"> </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">  </span><span class="err">â”‚</span><span class="w">              </span><span class="n">LLM</span><span class="w"> </span><span class="n">Backbone</span><span class="w">                       </span><span class="err">â”‚</span><span class="w"> </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">  </span><span class="err">â”‚</span><span class="w">           </span><span class="p">(</span><span class="n">LLaMA</span><span class="o">/</span><span class="n">Vicuna</span><span class="p">)</span><span class="w">                        </span><span class="err">â”‚</span><span class="w"> </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">  </span><span class="err">â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜</span><span class="w"> </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">          </span><span class="err">â†“</span><span class="w">                                           </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">  </span><span class="n">Text</span><span class="w"> </span><span class="n">Response</span><span class="w">                                       </span><span class="err">â”‚</span>
<span class="err">â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜</span>
</code></pre></div>

<div class="highlight"><pre><span></span><code><span class="kn">import</span><span class="w"> </span><span class="nn">torch</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">transformers</span><span class="w"> </span><span class="kn">import</span> <span class="n">AutoProcessor</span><span class="p">,</span> <span class="n">AutoModelForVision2Seq</span>

<span class="k">class</span><span class="w"> </span><span class="nc">VideoUnderstanding</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;ë¹„ë””ì˜¤ ì´í•´ ëª¨ë¸&quot;&quot;&quot;</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">model_name</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;DAMO-NLP-SG/Video-LLaMA-2-7B&quot;</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">processor</span> <span class="o">=</span> <span class="n">AutoProcessor</span><span class="o">.</span><span class="n">from_pretrained</span><span class="p">(</span><span class="n">model_name</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">model</span> <span class="o">=</span> <span class="n">AutoModelForVision2Seq</span><span class="o">.</span><span class="n">from_pretrained</span><span class="p">(</span>
            <span class="n">model_name</span><span class="p">,</span>
            <span class="n">torch_dtype</span><span class="o">=</span><span class="n">torch</span><span class="o">.</span><span class="n">float16</span><span class="p">,</span>
            <span class="n">device_map</span><span class="o">=</span><span class="s2">&quot;auto&quot;</span>
        <span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">extract_frames</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">video_path</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="n">num_frames</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">8</span><span class="p">,</span>
        <span class="n">uniform</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span>
    <span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;ë¹„ë””ì˜¤ì—ì„œ í”„ë ˆì„ ì¶”ì¶œ&quot;&quot;&quot;</span>
        <span class="kn">import</span><span class="w"> </span><span class="nn">cv2</span>

        <span class="n">cap</span> <span class="o">=</span> <span class="n">cv2</span><span class="o">.</span><span class="n">VideoCapture</span><span class="p">(</span><span class="n">video_path</span><span class="p">)</span>
        <span class="n">total_frames</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">cap</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">cv2</span><span class="o">.</span><span class="n">CAP_PROP_FRAME_COUNT</span><span class="p">))</span>

        <span class="k">if</span> <span class="n">uniform</span><span class="p">:</span>
            <span class="c1"># ê· ì¼ ìƒ˜í”Œë§</span>
            <span class="n">indices</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">total_frames</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="n">num_frames</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">int</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c1"># ëœë¤ ìƒ˜í”Œë§</span>
            <span class="n">indices</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">choice</span><span class="p">(</span><span class="n">total_frames</span><span class="p">,</span> <span class="n">num_frames</span><span class="p">,</span> <span class="n">replace</span><span class="o">=</span><span class="kc">False</span><span class="p">))</span>

        <span class="n">frames</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">idx</span> <span class="ow">in</span> <span class="n">indices</span><span class="p">:</span>
            <span class="n">cap</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">cv2</span><span class="o">.</span><span class="n">CAP_PROP_POS_FRAMES</span><span class="p">,</span> <span class="n">idx</span><span class="p">)</span>
            <span class="n">ret</span><span class="p">,</span> <span class="n">frame</span> <span class="o">=</span> <span class="n">cap</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>
            <span class="k">if</span> <span class="n">ret</span><span class="p">:</span>
                <span class="n">frame</span> <span class="o">=</span> <span class="n">cv2</span><span class="o">.</span><span class="n">cvtColor</span><span class="p">(</span><span class="n">frame</span><span class="p">,</span> <span class="n">cv2</span><span class="o">.</span><span class="n">COLOR_BGR2RGB</span><span class="p">)</span>
                <span class="n">frames</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">frame</span><span class="p">)</span>

        <span class="n">cap</span><span class="o">.</span><span class="n">release</span><span class="p">()</span>
        <span class="k">return</span> <span class="n">frames</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">analyze_video</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">video_path</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="n">question</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="n">num_frames</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">8</span>
    <span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;ë¹„ë””ì˜¤ ë¶„ì„ ë° ì§ˆë¬¸ ì‘ë‹µ&quot;&quot;&quot;</span>
        <span class="n">frames</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">extract_frames</span><span class="p">(</span><span class="n">video_path</span><span class="p">,</span> <span class="n">num_frames</span><span class="p">)</span>

        <span class="c1"># ì…ë ¥ ì¤€ë¹„</span>
        <span class="n">inputs</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">processor</span><span class="p">(</span>
            <span class="n">text</span><span class="o">=</span><span class="n">question</span><span class="p">,</span>
            <span class="n">images</span><span class="o">=</span><span class="n">frames</span><span class="p">,</span>
            <span class="n">return_tensors</span><span class="o">=</span><span class="s2">&quot;pt&quot;</span>
        <span class="p">)</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">device</span><span class="p">)</span>

        <span class="c1"># ìƒì„±</span>
        <span class="n">outputs</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">generate</span><span class="p">(</span>
            <span class="o">**</span><span class="n">inputs</span><span class="p">,</span>
            <span class="n">max_new_tokens</span><span class="o">=</span><span class="mi">256</span><span class="p">,</span>
            <span class="n">do_sample</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
            <span class="n">temperature</span><span class="o">=</span><span class="mf">0.7</span>
        <span class="p">)</span>

        <span class="n">response</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">processor</span><span class="o">.</span><span class="n">decode</span><span class="p">(</span><span class="n">outputs</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">skip_special_tokens</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">response</span>


<span class="c1"># Video Captioning</span>
<span class="k">class</span><span class="w"> </span><span class="nc">VideoCaptioner</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;ë¹„ë””ì˜¤ ìº¡ì…”ë‹&quot;&quot;&quot;</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="kn">from</span><span class="w"> </span><span class="nn">transformers</span><span class="w"> </span><span class="kn">import</span> <span class="n">BlipProcessor</span><span class="p">,</span> <span class="n">BlipForConditionalGeneration</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">processor</span> <span class="o">=</span> <span class="n">BlipProcessor</span><span class="o">.</span><span class="n">from_pretrained</span><span class="p">(</span>
            <span class="s2">&quot;Salesforce/blip2-opt-2.7b&quot;</span>
        <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">model</span> <span class="o">=</span> <span class="n">BlipForConditionalGeneration</span><span class="o">.</span><span class="n">from_pretrained</span><span class="p">(</span>
            <span class="s2">&quot;Salesforce/blip2-opt-2.7b&quot;</span><span class="p">,</span>
            <span class="n">torch_dtype</span><span class="o">=</span><span class="n">torch</span><span class="o">.</span><span class="n">float16</span>
        <span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">caption_video</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">video_path</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="n">num_frames</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">5</span>
    <span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;ë¹„ë””ì˜¤ ìº¡ì…˜ ìƒì„±&quot;&quot;&quot;</span>
        <span class="n">frames</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_extract_frames</span><span class="p">(</span><span class="n">video_path</span><span class="p">,</span> <span class="n">num_frames</span><span class="p">)</span>

        <span class="n">captions</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">frame</span> <span class="ow">in</span> <span class="n">frames</span><span class="p">:</span>
            <span class="n">inputs</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">processor</span><span class="p">(</span><span class="n">images</span><span class="o">=</span><span class="n">frame</span><span class="p">,</span> <span class="n">return_tensors</span><span class="o">=</span><span class="s2">&quot;pt&quot;</span><span class="p">)</span>
            <span class="n">output</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">generate</span><span class="p">(</span><span class="o">**</span><span class="n">inputs</span><span class="p">,</span> <span class="n">max_new_tokens</span><span class="o">=</span><span class="mi">50</span><span class="p">)</span>
            <span class="n">caption</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">processor</span><span class="o">.</span><span class="n">decode</span><span class="p">(</span><span class="n">output</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">skip_special_tokens</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
            <span class="n">captions</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">caption</span><span class="p">)</span>

        <span class="c1"># ìº¡ì…˜ í†µí•©</span>
        <span class="n">summary</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_summarize_captions</span><span class="p">(</span><span class="n">captions</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">summary</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_summarize_captions</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">captions</span><span class="p">:</span> <span class="nb">list</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;í”„ë ˆì„ë³„ ìº¡ì…˜ì„ ë¹„ë””ì˜¤ ìš”ì•½ìœ¼ë¡œ í†µí•©&quot;&quot;&quot;</span>
        <span class="c1"># ê°„ë‹¨í•œ í†µí•© (ì‹¤ì œë¡œëŠ” LLM ì‚¬ìš© ê¶Œì¥)</span>
        <span class="n">unique_elements</span> <span class="o">=</span> <span class="nb">set</span><span class="p">()</span>
        <span class="k">for</span> <span class="n">caption</span> <span class="ow">in</span> <span class="n">captions</span><span class="p">:</span>
            <span class="n">unique_elements</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">caption</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span><span class="o">.</span><span class="n">split</span><span class="p">())</span>

        <span class="k">return</span> <span class="s2">&quot; â†’ &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">captions</span><span class="p">)</span>
</code></pre></div>

<h3 id="32-video-generation-sora">3.2 Video Generation ê°œë… (Sora)<a class="header-link" href="#32-video-generation-sora" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code>Sora í•µì‹¬ ê°œë…:
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                     Text Prompt                         â”‚
â”‚  &quot;A cat playing piano in a cozy room with warm light&quot;  â”‚
â”‚                         â†“                               â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”â”‚
â”‚  â”‚              Text Encoder (T5/CLIP)                â”‚â”‚
â”‚  â”‚              - Semantic understanding              â”‚â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜â”‚
â”‚                         â†“                               â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”â”‚
â”‚  â”‚          Spacetime Latent Patches                  â”‚â”‚
â”‚  â”‚          - Video as 3D patches                     â”‚â”‚
â”‚  â”‚          - Compress HÃ—WÃ—T into latent             â”‚â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜â”‚
â”‚                         â†“                               â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”â”‚
â”‚  â”‚              Diffusion Transformer                 â”‚â”‚
â”‚  â”‚              - DiT backbone                        â”‚â”‚
â”‚  â”‚              - Attention over spacetime            â”‚â”‚
â”‚  â”‚              - Variable resolution/duration        â”‚â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜â”‚
â”‚                         â†“                               â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”â”‚
â”‚  â”‚              VAE Decoder                           â”‚â”‚
â”‚  â”‚              - Latent â†’ Pixel space               â”‚â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜â”‚
â”‚                         â†“                               â”‚
â”‚                    Video Output                         â”‚
â”‚              (Variable length, up to 1 min)            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

í•µì‹¬ ê¸°ìˆ :
1. Spacetime Patches: ì‹œê³µê°„ì„ íŒ¨ì¹˜ë¡œ ë¶„í• 
2. DiT (Diffusion Transformer): Transformer ê¸°ë°˜ diffusion
3. Variable Resolution: ë‹¤ì–‘í•œ í•´ìƒë„/ê¸¸ì´ ì§€ì›
4. Recaptioning: ìƒì„¸í•œ ìº¡ì…˜ìœ¼ë¡œ ì¬í•™ìŠµ
</code></pre></div>

<div class="highlight"><pre><span></span><code><span class="c1"># ê°„ë‹¨í•œ Video Diffusion ê°œë… êµ¬í˜„</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">torch</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">torch.nn</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">nn</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">einops</span><span class="w"> </span><span class="kn">import</span> <span class="n">rearrange</span>

<span class="k">class</span><span class="w"> </span><span class="nc">SpacetimePatchEmbed</span><span class="p">(</span><span class="n">nn</span><span class="o">.</span><span class="n">Module</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;ì‹œê³µê°„ íŒ¨ì¹˜ ì„ë² ë”©&quot;&quot;&quot;</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">img_size</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">256</span><span class="p">,</span>
        <span class="n">patch_size</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">16</span><span class="p">,</span>
        <span class="n">num_frames</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">16</span><span class="p">,</span>
        <span class="n">temporal_patch</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">2</span><span class="p">,</span>
        <span class="n">in_channels</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">4</span><span class="p">,</span>  <span class="c1"># VAE latent</span>
        <span class="n">embed_dim</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">768</span>
    <span class="p">):</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">patch_size</span> <span class="o">=</span> <span class="n">patch_size</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">temporal_patch</span> <span class="o">=</span> <span class="n">temporal_patch</span>

        <span class="c1"># 3D íŒ¨ì¹˜ ì„ë² ë”©</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">proj</span> <span class="o">=</span> <span class="n">nn</span><span class="o">.</span><span class="n">Conv3d</span><span class="p">(</span>
            <span class="n">in_channels</span><span class="p">,</span> <span class="n">embed_dim</span><span class="p">,</span>
            <span class="n">kernel_size</span><span class="o">=</span><span class="p">(</span><span class="n">temporal_patch</span><span class="p">,</span> <span class="n">patch_size</span><span class="p">,</span> <span class="n">patch_size</span><span class="p">),</span>
            <span class="n">stride</span><span class="o">=</span><span class="p">(</span><span class="n">temporal_patch</span><span class="p">,</span> <span class="n">patch_size</span><span class="p">,</span> <span class="n">patch_size</span><span class="p">)</span>
        <span class="p">)</span>

        <span class="c1"># íŒ¨ì¹˜ ìˆ˜ ê³„ì‚°</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">num_spatial_patches</span> <span class="o">=</span> <span class="p">(</span><span class="n">img_size</span> <span class="o">//</span> <span class="n">patch_size</span><span class="p">)</span> <span class="o">**</span> <span class="mi">2</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">num_temporal_patches</span> <span class="o">=</span> <span class="n">num_frames</span> <span class="o">//</span> <span class="n">temporal_patch</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">num_patches</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">num_spatial_patches</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">num_temporal_patches</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">forward</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Args:</span>
<span class="sd">            x: (B, C, T, H, W) - ë¹„ë””ì˜¤ latent</span>
<span class="sd">        Returns:</span>
<span class="sd">            patches: (B, N, D) - ì‹œê³µê°„ íŒ¨ì¹˜</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># (B, D, t, h, w)</span>
        <span class="n">x</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">proj</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
        <span class="c1"># (B, D, N) -&gt; (B, N, D)</span>
        <span class="n">x</span> <span class="o">=</span> <span class="n">x</span><span class="o">.</span><span class="n">flatten</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span><span class="o">.</span><span class="n">transpose</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">x</span>


<span class="k">class</span><span class="w"> </span><span class="nc">VideoTransformerBlock</span><span class="p">(</span><span class="n">nn</span><span class="o">.</span><span class="n">Module</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;ë¹„ë””ì˜¤ìš© Transformer ë¸”ë¡&quot;&quot;&quot;</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">dim</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
        <span class="n">num_heads</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
        <span class="n">mlp_ratio</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">4.0</span><span class="p">,</span>
        <span class="n">num_spatial_patches</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">256</span><span class="p">,</span>
        <span class="n">num_temporal_patches</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">8</span>
    <span class="p">):</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">num_spatial</span> <span class="o">=</span> <span class="n">num_spatial_patches</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">num_temporal</span> <span class="o">=</span> <span class="n">num_temporal_patches</span>

        <span class="c1"># Spatial attention</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">spatial_norm</span> <span class="o">=</span> <span class="n">nn</span><span class="o">.</span><span class="n">LayerNorm</span><span class="p">(</span><span class="n">dim</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">spatial_attn</span> <span class="o">=</span> <span class="n">nn</span><span class="o">.</span><span class="n">MultiheadAttention</span><span class="p">(</span><span class="n">dim</span><span class="p">,</span> <span class="n">num_heads</span><span class="p">,</span> <span class="n">batch_first</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

        <span class="c1"># Temporal attention</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">temporal_norm</span> <span class="o">=</span> <span class="n">nn</span><span class="o">.</span><span class="n">LayerNorm</span><span class="p">(</span><span class="n">dim</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">temporal_attn</span> <span class="o">=</span> <span class="n">nn</span><span class="o">.</span><span class="n">MultiheadAttention</span><span class="p">(</span><span class="n">dim</span><span class="p">,</span> <span class="n">num_heads</span><span class="p">,</span> <span class="n">batch_first</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

        <span class="c1"># FFN</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ffn_norm</span> <span class="o">=</span> <span class="n">nn</span><span class="o">.</span><span class="n">LayerNorm</span><span class="p">(</span><span class="n">dim</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ffn</span> <span class="o">=</span> <span class="n">nn</span><span class="o">.</span><span class="n">Sequential</span><span class="p">(</span>
            <span class="n">nn</span><span class="o">.</span><span class="n">Linear</span><span class="p">(</span><span class="n">dim</span><span class="p">,</span> <span class="nb">int</span><span class="p">(</span><span class="n">dim</span> <span class="o">*</span> <span class="n">mlp_ratio</span><span class="p">)),</span>
            <span class="n">nn</span><span class="o">.</span><span class="n">GELU</span><span class="p">(),</span>
            <span class="n">nn</span><span class="o">.</span><span class="n">Linear</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">dim</span> <span class="o">*</span> <span class="n">mlp_ratio</span><span class="p">),</span> <span class="n">dim</span><span class="p">)</span>
        <span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">forward</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">t_emb</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Args:</span>
<span class="sd">            x: (B, T*S, D) - ì‹œê³µê°„ íŒ¨ì¹˜</span>
<span class="sd">            t_emb: (B, D) - timestep ì„ë² ë”©</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">B</span><span class="p">,</span> <span class="n">N</span><span class="p">,</span> <span class="n">D</span> <span class="o">=</span> <span class="n">x</span><span class="o">.</span><span class="n">shape</span>
        <span class="n">T</span><span class="p">,</span> <span class="n">S</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">num_temporal</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">num_spatial</span>

        <span class="c1"># Spatial attention (ê° í”„ë ˆì„ ë‚´)</span>
        <span class="n">x_spatial</span> <span class="o">=</span> <span class="n">rearrange</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="s1">&#39;b (t s) d -&gt; (b t) s d&#39;</span><span class="p">,</span> <span class="n">t</span><span class="o">=</span><span class="n">T</span><span class="p">,</span> <span class="n">s</span><span class="o">=</span><span class="n">S</span><span class="p">)</span>
        <span class="n">x_spatial</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">spatial_norm</span><span class="p">(</span><span class="n">x_spatial</span><span class="p">)</span>
        <span class="n">attn_out</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">spatial_attn</span><span class="p">(</span><span class="n">x_spatial</span><span class="p">,</span> <span class="n">x_spatial</span><span class="p">,</span> <span class="n">x_spatial</span><span class="p">)</span>
        <span class="n">x_spatial</span> <span class="o">=</span> <span class="n">rearrange</span><span class="p">(</span><span class="n">attn_out</span><span class="p">,</span> <span class="s1">&#39;(b t) s d -&gt; b (t s) d&#39;</span><span class="p">,</span> <span class="n">b</span><span class="o">=</span><span class="n">B</span><span class="p">,</span> <span class="n">t</span><span class="o">=</span><span class="n">T</span><span class="p">)</span>
        <span class="n">x</span> <span class="o">=</span> <span class="n">x</span> <span class="o">+</span> <span class="n">x_spatial</span>

        <span class="c1"># Temporal attention (ê°™ì€ ìœ„ì¹˜ì˜ í”„ë ˆì„ ê°„)</span>
        <span class="n">x_temporal</span> <span class="o">=</span> <span class="n">rearrange</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="s1">&#39;b (t s) d -&gt; (b s) t d&#39;</span><span class="p">,</span> <span class="n">t</span><span class="o">=</span><span class="n">T</span><span class="p">,</span> <span class="n">s</span><span class="o">=</span><span class="n">S</span><span class="p">)</span>
        <span class="n">x_temporal</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">temporal_norm</span><span class="p">(</span><span class="n">x_temporal</span><span class="p">)</span>
        <span class="n">attn_out</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">temporal_attn</span><span class="p">(</span><span class="n">x_temporal</span><span class="p">,</span> <span class="n">x_temporal</span><span class="p">,</span> <span class="n">x_temporal</span><span class="p">)</span>
        <span class="n">x_temporal</span> <span class="o">=</span> <span class="n">rearrange</span><span class="p">(</span><span class="n">attn_out</span><span class="p">,</span> <span class="s1">&#39;(b s) t d -&gt; b (t s) d&#39;</span><span class="p">,</span> <span class="n">b</span><span class="o">=</span><span class="n">B</span><span class="p">,</span> <span class="n">s</span><span class="o">=</span><span class="n">S</span><span class="p">)</span>
        <span class="n">x</span> <span class="o">=</span> <span class="n">x</span> <span class="o">+</span> <span class="n">x_temporal</span>

        <span class="c1"># FFN</span>
        <span class="n">x</span> <span class="o">=</span> <span class="n">x</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">ffn</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ffn_norm</span><span class="p">(</span><span class="n">x</span><span class="p">))</span>

        <span class="k">return</span> <span class="n">x</span>


<span class="k">class</span><span class="w"> </span><span class="nc">SimpleDiT</span><span class="p">(</span><span class="n">nn</span><span class="o">.</span><span class="n">Module</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;ë‹¨ìˆœí™”ëœ Diffusion Transformer&quot;&quot;&quot;</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">img_size</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">256</span><span class="p">,</span>
        <span class="n">patch_size</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">16</span><span class="p">,</span>
        <span class="n">num_frames</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">16</span><span class="p">,</span>
        <span class="n">in_channels</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">4</span><span class="p">,</span>
        <span class="n">hidden_size</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">768</span><span class="p">,</span>
        <span class="n">depth</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">12</span><span class="p">,</span>
        <span class="n">num_heads</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">12</span>
    <span class="p">):</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">()</span>

        <span class="c1"># Patch embedding</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">patch_embed</span> <span class="o">=</span> <span class="n">SpacetimePatchEmbed</span><span class="p">(</span>
            <span class="n">img_size</span><span class="p">,</span> <span class="n">patch_size</span><span class="p">,</span> <span class="n">num_frames</span><span class="p">,</span>
            <span class="n">temporal_patch</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">in_channels</span><span class="o">=</span><span class="n">in_channels</span><span class="p">,</span>
            <span class="n">embed_dim</span><span class="o">=</span><span class="n">hidden_size</span>
        <span class="p">)</span>

        <span class="n">num_spatial</span> <span class="o">=</span> <span class="p">(</span><span class="n">img_size</span> <span class="o">//</span> <span class="n">patch_size</span><span class="p">)</span> <span class="o">**</span> <span class="mi">2</span>
        <span class="n">num_temporal</span> <span class="o">=</span> <span class="n">num_frames</span> <span class="o">//</span> <span class="mi">2</span>

        <span class="c1"># Position embedding</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">pos_embed</span> <span class="o">=</span> <span class="n">nn</span><span class="o">.</span><span class="n">Parameter</span><span class="p">(</span>
            <span class="n">torch</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">num_spatial</span> <span class="o">*</span> <span class="n">num_temporal</span><span class="p">,</span> <span class="n">hidden_size</span><span class="p">)</span>
        <span class="p">)</span>

        <span class="c1"># Timestep embedding</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">time_embed</span> <span class="o">=</span> <span class="n">nn</span><span class="o">.</span><span class="n">Sequential</span><span class="p">(</span>
            <span class="n">nn</span><span class="o">.</span><span class="n">Linear</span><span class="p">(</span><span class="n">hidden_size</span><span class="p">,</span> <span class="n">hidden_size</span> <span class="o">*</span> <span class="mi">4</span><span class="p">),</span>
            <span class="n">nn</span><span class="o">.</span><span class="n">SiLU</span><span class="p">(),</span>
            <span class="n">nn</span><span class="o">.</span><span class="n">Linear</span><span class="p">(</span><span class="n">hidden_size</span> <span class="o">*</span> <span class="mi">4</span><span class="p">,</span> <span class="n">hidden_size</span><span class="p">)</span>
        <span class="p">)</span>

        <span class="c1"># Transformer blocks</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">blocks</span> <span class="o">=</span> <span class="n">nn</span><span class="o">.</span><span class="n">ModuleList</span><span class="p">([</span>
            <span class="n">VideoTransformerBlock</span><span class="p">(</span>
                <span class="n">hidden_size</span><span class="p">,</span> <span class="n">num_heads</span><span class="p">,</span>
                <span class="n">num_spatial_patches</span><span class="o">=</span><span class="n">num_spatial</span><span class="p">,</span>
                <span class="n">num_temporal_patches</span><span class="o">=</span><span class="n">num_temporal</span>
            <span class="p">)</span>
            <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">depth</span><span class="p">)</span>
        <span class="p">])</span>

        <span class="c1"># Output</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">final_norm</span> <span class="o">=</span> <span class="n">nn</span><span class="o">.</span><span class="n">LayerNorm</span><span class="p">(</span><span class="n">hidden_size</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">final_proj</span> <span class="o">=</span> <span class="n">nn</span><span class="o">.</span><span class="n">Linear</span><span class="p">(</span>
            <span class="n">hidden_size</span><span class="p">,</span>
            <span class="n">patch_size</span> <span class="o">*</span> <span class="n">patch_size</span> <span class="o">*</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">in_channels</span>
        <span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">forward</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">t</span><span class="p">,</span> <span class="n">cond</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Args:</span>
<span class="sd">            x: (B, C, T, H, W) - noisy video latent</span>
<span class="sd">            t: (B,) - diffusion timestep</span>
<span class="sd">            cond: (B, L, D) - text conditioning</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># Patch embedding</span>
        <span class="n">x</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">patch_embed</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">pos_embed</span>

        <span class="c1"># Timestep embedding (sinusoidal)</span>
        <span class="n">t_emb</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_sinusoidal_embedding</span><span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="n">x</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>
        <span class="n">t_emb</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">time_embed</span><span class="p">(</span><span class="n">t_emb</span><span class="p">)</span>

        <span class="c1"># Transformer blocks</span>
        <span class="k">for</span> <span class="n">block</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">blocks</span><span class="p">:</span>
            <span class="n">x</span> <span class="o">=</span> <span class="n">block</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">t_emb</span><span class="p">)</span>

        <span class="c1"># Output</span>
        <span class="n">x</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">final_norm</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
        <span class="n">x</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">final_proj</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">x</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_sinusoidal_embedding</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">t</span><span class="p">,</span> <span class="n">dim</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Sinusoidal timestep embedding&quot;&quot;&quot;</span>
        <span class="n">half</span> <span class="o">=</span> <span class="n">dim</span> <span class="o">//</span> <span class="mi">2</span>
        <span class="n">freqs</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span>
            <span class="o">-</span><span class="n">math</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="mi">10000</span><span class="p">)</span> <span class="o">*</span> <span class="n">torch</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">half</span><span class="p">,</span> <span class="n">device</span><span class="o">=</span><span class="n">t</span><span class="o">.</span><span class="n">device</span><span class="p">)</span> <span class="o">/</span> <span class="n">half</span>
        <span class="p">)</span>
        <span class="n">args</span> <span class="o">=</span> <span class="n">t</span><span class="p">[:,</span> <span class="kc">None</span><span class="p">]</span> <span class="o">*</span> <span class="n">freqs</span><span class="p">[</span><span class="kc">None</span><span class="p">]</span>
        <span class="n">embedding</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">cat</span><span class="p">([</span><span class="n">torch</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">args</span><span class="p">),</span> <span class="n">torch</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">args</span><span class="p">)],</span> <span class="n">dim</span><span class="o">=-</span><span class="mi">1</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">embedding</span>
</code></pre></div>

<hr />
<h2 id="4">4. ì‹¤ìš©ì  ì‘ìš©<a class="header-link" href="#4" title="Permanent link">&para;</a></h2>
<h3 id="41-multimodal-pipeline">4.1 Multimodal Pipeline<a class="header-link" href="#41-multimodal-pipeline" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><span class="k">class</span><span class="w"> </span><span class="nc">MultimodalPipeline</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;ì˜¤ë””ì˜¤/ë¹„ë””ì˜¤ í†µí•© íŒŒì´í”„ë¼ì¸&quot;&quot;&quot;</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c1"># Speech recognition</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">whisper</span> <span class="o">=</span> <span class="n">whisper</span><span class="o">.</span><span class="n">load_model</span><span class="p">(</span><span class="s2">&quot;base&quot;</span><span class="p">)</span>

        <span class="c1"># Music generation</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">music_processor</span> <span class="o">=</span> <span class="n">AutoProcessor</span><span class="o">.</span><span class="n">from_pretrained</span><span class="p">(</span><span class="s2">&quot;facebook/musicgen-small&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">music_model</span> <span class="o">=</span> <span class="n">MusicgenForConditionalGeneration</span><span class="o">.</span><span class="n">from_pretrained</span><span class="p">(</span>
            <span class="s2">&quot;facebook/musicgen-small&quot;</span>
        <span class="p">)</span>

        <span class="c1"># TTS</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">tts</span> <span class="o">=</span> <span class="n">TTS</span><span class="p">(</span><span class="s2">&quot;tts_models/multilingual/multi-dataset/xtts_v2&quot;</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">transcribe_and_translate</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">audio_path</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="n">target_language</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;en&quot;</span>
    <span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;ìŒì„± ì¸ì‹ ë° ë²ˆì—­&quot;&quot;&quot;</span>
        <span class="c1"># ìŒì„± ì¸ì‹</span>
        <span class="n">result</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">whisper</span><span class="o">.</span><span class="n">transcribe</span><span class="p">(</span><span class="n">audio_path</span><span class="p">)</span>
        <span class="n">original_text</span> <span class="o">=</span> <span class="n">result</span><span class="p">[</span><span class="s2">&quot;text&quot;</span><span class="p">]</span>
        <span class="n">source_language</span> <span class="o">=</span> <span class="n">result</span><span class="p">[</span><span class="s2">&quot;language&quot;</span><span class="p">]</span>

        <span class="c1"># ë²ˆì—­ (ì˜ì–´ë¡œ)</span>
        <span class="k">if</span> <span class="n">source_language</span> <span class="o">!=</span> <span class="n">target_language</span><span class="p">:</span>
            <span class="n">translation</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">whisper</span><span class="o">.</span><span class="n">transcribe</span><span class="p">(</span>
                <span class="n">audio_path</span><span class="p">,</span>
                <span class="n">task</span><span class="o">=</span><span class="s2">&quot;translate&quot;</span>
            <span class="p">)[</span><span class="s2">&quot;text&quot;</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">translation</span> <span class="o">=</span> <span class="n">original_text</span>

        <span class="k">return</span> <span class="p">{</span>
            <span class="s2">&quot;original&quot;</span><span class="p">:</span> <span class="n">original_text</span><span class="p">,</span>
            <span class="s2">&quot;source_language&quot;</span><span class="p">:</span> <span class="n">source_language</span><span class="p">,</span>
            <span class="s2">&quot;translation&quot;</span><span class="p">:</span> <span class="n">translation</span>
        <span class="p">}</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">generate_soundtrack</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">video_description</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="n">mood</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="n">duration</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">30.0</span>
    <span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;ë¹„ë””ì˜¤ ì„¤ëª… ê¸°ë°˜ ë°°ê²½ìŒì•… ìƒì„±&quot;&quot;&quot;</span>
        <span class="n">prompt</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">mood</span><span class="si">}</span><span class="s2"> music for: </span><span class="si">{</span><span class="n">video_description</span><span class="si">}</span><span class="s2">&quot;</span>

        <span class="n">inputs</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">music_processor</span><span class="p">(</span>
            <span class="n">text</span><span class="o">=</span><span class="p">[</span><span class="n">prompt</span><span class="p">],</span>
            <span class="n">padding</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
            <span class="n">return_tensors</span><span class="o">=</span><span class="s2">&quot;pt&quot;</span>
        <span class="p">)</span>

        <span class="n">max_new_tokens</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">duration</span> <span class="o">*</span> <span class="mi">50</span><span class="p">)</span>

        <span class="n">audio_values</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">music_model</span><span class="o">.</span><span class="n">generate</span><span class="p">(</span>
            <span class="o">**</span><span class="n">inputs</span><span class="p">,</span>
            <span class="n">max_new_tokens</span><span class="o">=</span><span class="n">max_new_tokens</span><span class="p">,</span>
            <span class="n">guidance_scale</span><span class="o">=</span><span class="mf">4.0</span>
        <span class="p">)</span>

        <span class="k">return</span> <span class="n">audio_values</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">numpy</span><span class="p">()</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">create_voiceover</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">script</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="n">reference_voice</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="n">language</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;en&quot;</span>
    <span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;ë³´ì´ìŠ¤ì˜¤ë²„ ìƒì„±&quot;&quot;&quot;</span>
        <span class="n">output_path</span> <span class="o">=</span> <span class="s2">&quot;voiceover.wav&quot;</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">tts</span><span class="o">.</span><span class="n">tts_to_file</span><span class="p">(</span>
            <span class="n">text</span><span class="o">=</span><span class="n">script</span><span class="p">,</span>
            <span class="n">file_path</span><span class="o">=</span><span class="n">output_path</span><span class="p">,</span>
            <span class="n">speaker_wav</span><span class="o">=</span><span class="n">reference_voice</span><span class="p">,</span>
            <span class="n">language</span><span class="o">=</span><span class="n">language</span>
        <span class="p">)</span>

        <span class="k">return</span> <span class="n">output_path</span>


<span class="c1"># ì‚¬ìš© ì˜ˆì‹œ</span>
<span class="k">def</span><span class="w"> </span><span class="nf">demo_pipeline</span><span class="p">():</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;íŒŒì´í”„ë¼ì¸ ë°ëª¨&quot;&quot;&quot;</span>
    <span class="n">pipeline</span> <span class="o">=</span> <span class="n">MultimodalPipeline</span><span class="p">()</span>

    <span class="c1"># 1. ìŒì„± íŒŒì¼ ì „ì‚¬ ë° ë²ˆì—­</span>
    <span class="n">result</span> <span class="o">=</span> <span class="n">pipeline</span><span class="o">.</span><span class="n">transcribe_and_translate</span><span class="p">(</span>
        <span class="s2">&quot;korean_speech.mp3&quot;</span><span class="p">,</span>
        <span class="n">target_language</span><span class="o">=</span><span class="s2">&quot;en&quot;</span>
    <span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Original: </span><span class="si">{</span><span class="n">result</span><span class="p">[</span><span class="s1">&#39;original&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Translation: </span><span class="si">{</span><span class="n">result</span><span class="p">[</span><span class="s1">&#39;translation&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

    <span class="c1"># 2. ë¹„ë””ì˜¤ìš© ë°°ê²½ìŒì•… ìƒì„±</span>
    <span class="n">music</span> <span class="o">=</span> <span class="n">pipeline</span><span class="o">.</span><span class="n">generate_soundtrack</span><span class="p">(</span>
        <span class="n">video_description</span><span class="o">=</span><span class="s2">&quot;A documentary about ocean wildlife&quot;</span><span class="p">,</span>
        <span class="n">mood</span><span class="o">=</span><span class="s2">&quot;Calm and majestic&quot;</span><span class="p">,</span>
        <span class="n">duration</span><span class="o">=</span><span class="mf">60.0</span>
    <span class="p">)</span>

    <span class="c1"># 3. ë‚˜ë ˆì´ì…˜ ìƒì„±</span>
    <span class="n">voiceover</span> <span class="o">=</span> <span class="n">pipeline</span><span class="o">.</span><span class="n">create_voiceover</span><span class="p">(</span>
        <span class="n">script</span><span class="o">=</span><span class="s2">&quot;Welcome to our exploration of the deep ocean.&quot;</span><span class="p">,</span>
        <span class="n">reference_voice</span><span class="o">=</span><span class="s2">&quot;narrator_sample.wav&quot;</span><span class="p">,</span>
        <span class="n">language</span><span class="o">=</span><span class="s2">&quot;en&quot;</span>
    <span class="p">)</span>
</code></pre></div>

<h3 id="42-real-time-processing">4.2 Real-time Processing<a class="header-link" href="#42-real-time-processing" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><span class="kn">import</span><span class="w"> </span><span class="nn">asyncio</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">collections</span><span class="w"> </span><span class="kn">import</span> <span class="n">deque</span>

<span class="k">class</span><span class="w"> </span><span class="nc">RealTimeAudioProcessor</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;ì‹¤ì‹œê°„ ì˜¤ë””ì˜¤ ì²˜ë¦¬&quot;&quot;&quot;</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">buffer_size</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">3.0</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">buffer_size</span> <span class="o">=</span> <span class="n">buffer_size</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">sample_rate</span> <span class="o">=</span> <span class="mi">16000</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">audio_buffer</span> <span class="o">=</span> <span class="n">deque</span><span class="p">(</span><span class="n">maxlen</span><span class="o">=</span><span class="nb">int</span><span class="p">(</span><span class="n">buffer_size</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">sample_rate</span><span class="p">))</span>

        <span class="c1"># Whisper ëª¨ë¸ (ì‘ì€ ë²„ì „ ì‚¬ìš©)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">model</span> <span class="o">=</span> <span class="n">whisper</span><span class="o">.</span><span class="n">load_model</span><span class="p">(</span><span class="s2">&quot;tiny&quot;</span><span class="p">)</span>

    <span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">process_stream</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">audio_stream</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;ì˜¤ë””ì˜¤ ìŠ¤íŠ¸ë¦¼ ì²˜ë¦¬&quot;&quot;&quot;</span>
        <span class="k">while</span> <span class="kc">True</span><span class="p">:</span>
            <span class="c1"># ì˜¤ë””ì˜¤ ì²­í¬ ìˆ˜ì‹ </span>
            <span class="n">chunk</span> <span class="o">=</span> <span class="k">await</span> <span class="n">audio_stream</span><span class="o">.</span><span class="n">receive</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">audio_buffer</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">chunk</span><span class="p">)</span>

            <span class="c1"># ë²„í¼ê°€ ì¶©ë¶„í•˜ë©´ ì²˜ë¦¬</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">audio_buffer</span><span class="p">)</span> <span class="o">&gt;=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sample_rate</span> <span class="o">*</span> <span class="mi">2</span><span class="p">:</span>
                <span class="n">audio_array</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">audio_buffer</span><span class="p">)</span>

                <span class="c1"># ë¹„ë™ê¸° ì „ì‚¬</span>
                <span class="n">result</span> <span class="o">=</span> <span class="k">await</span> <span class="n">asyncio</span><span class="o">.</span><span class="n">to_thread</span><span class="p">(</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">transcribe</span><span class="p">,</span>
                    <span class="n">audio_array</span><span class="p">,</span>
                    <span class="n">fp16</span><span class="o">=</span><span class="kc">False</span>
                <span class="p">)</span>

                <span class="k">yield</span> <span class="n">result</span><span class="p">[</span><span class="s2">&quot;text&quot;</span><span class="p">]</span>

                <span class="c1"># ë²„í¼ ì¼ë¶€ ìœ ì§€ (ì˜¤ë²„ë©)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">audio_buffer</span> <span class="o">=</span> <span class="n">deque</span><span class="p">(</span>
                    <span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">audio_buffer</span><span class="p">)[</span><span class="bp">self</span><span class="o">.</span><span class="n">sample_rate</span><span class="p">:],</span>
                    <span class="n">maxlen</span><span class="o">=</span><span class="nb">int</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">buffer_size</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">sample_rate</span><span class="p">)</span>
                <span class="p">)</span>


<span class="k">class</span><span class="w"> </span><span class="nc">StreamingVideoAnalyzer</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;ìŠ¤íŠ¸ë¦¬ë° ë¹„ë””ì˜¤ ë¶„ì„&quot;&quot;&quot;</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">frame_interval</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">30</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">frame_interval</span> <span class="o">=</span> <span class="n">frame_interval</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">frame_count</span> <span class="o">=</span> <span class="mi">0</span>

        <span class="c1"># CLIP for quick frame analysis</span>
        <span class="kn">from</span><span class="w"> </span><span class="nn">transformers</span><span class="w"> </span><span class="kn">import</span> <span class="n">CLIPProcessor</span><span class="p">,</span> <span class="n">CLIPModel</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">processor</span> <span class="o">=</span> <span class="n">CLIPProcessor</span><span class="o">.</span><span class="n">from_pretrained</span><span class="p">(</span><span class="s2">&quot;openai/clip-vit-base-patch32&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">model</span> <span class="o">=</span> <span class="n">CLIPModel</span><span class="o">.</span><span class="n">from_pretrained</span><span class="p">(</span><span class="s2">&quot;openai/clip-vit-base-patch32&quot;</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">analyze_frame</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">frame</span><span class="p">,</span> <span class="n">categories</span><span class="p">:</span> <span class="nb">list</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;í”„ë ˆì„ ë¶„ë¥˜&quot;&quot;&quot;</span>
        <span class="n">inputs</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">processor</span><span class="p">(</span>
            <span class="n">text</span><span class="o">=</span><span class="n">categories</span><span class="p">,</span>
            <span class="n">images</span><span class="o">=</span><span class="n">frame</span><span class="p">,</span>
            <span class="n">return_tensors</span><span class="o">=</span><span class="s2">&quot;pt&quot;</span><span class="p">,</span>
            <span class="n">padding</span><span class="o">=</span><span class="kc">True</span>
        <span class="p">)</span>

        <span class="n">outputs</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="p">(</span><span class="o">**</span><span class="n">inputs</span><span class="p">)</span>
        <span class="n">probs</span> <span class="o">=</span> <span class="n">outputs</span><span class="o">.</span><span class="n">logits_per_image</span><span class="o">.</span><span class="n">softmax</span><span class="p">(</span><span class="n">dim</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>

        <span class="k">return</span> <span class="p">{</span><span class="n">cat</span><span class="p">:</span> <span class="n">prob</span><span class="o">.</span><span class="n">item</span><span class="p">()</span> <span class="k">for</span> <span class="n">cat</span><span class="p">,</span> <span class="n">prob</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">categories</span><span class="p">,</span> <span class="n">probs</span><span class="p">[</span><span class="mi">0</span><span class="p">])}</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">process_video_stream</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">video_stream</span><span class="p">,</span> <span class="n">categories</span><span class="p">:</span> <span class="nb">list</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;ë¹„ë””ì˜¤ ìŠ¤íŠ¸ë¦¼ ì²˜ë¦¬&quot;&quot;&quot;</span>
        <span class="kn">import</span><span class="w"> </span><span class="nn">cv2</span>

        <span class="k">while</span> <span class="kc">True</span><span class="p">:</span>
            <span class="n">ret</span><span class="p">,</span> <span class="n">frame</span> <span class="o">=</span> <span class="n">video_stream</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">ret</span><span class="p">:</span>
                <span class="k">break</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">frame_count</span> <span class="o">+=</span> <span class="mi">1</span>

            <span class="c1"># ì¼ì • ê°„ê²©ìœ¼ë¡œë§Œ ë¶„ì„</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">frame_count</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">frame_interval</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">frame_rgb</span> <span class="o">=</span> <span class="n">cv2</span><span class="o">.</span><span class="n">cvtColor</span><span class="p">(</span><span class="n">frame</span><span class="p">,</span> <span class="n">cv2</span><span class="o">.</span><span class="n">COLOR_BGR2RGB</span><span class="p">)</span>
                <span class="n">analysis</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">analyze_frame</span><span class="p">(</span><span class="n">frame_rgb</span><span class="p">,</span> <span class="n">categories</span><span class="p">)</span>
                <span class="k">yield</span> <span class="bp">self</span><span class="o">.</span><span class="n">frame_count</span><span class="p">,</span> <span class="n">analysis</span>
</code></pre></div>

<hr />
<h2 id="5">5. ëª¨ë¸ ë¹„êµ<a class="header-link" href="#5" title="Permanent link">&para;</a></h2>
<h3 id="51-speech-models">5.1 Speech Models<a class="header-link" href="#51-speech-models" title="Permanent link">&para;</a></h3>
<table>
<thead>
<tr>
<th>ëª¨ë¸</th>
<th>íŒŒë¼ë¯¸í„°</th>
<th>íŠ¹ì§•</th>
<th>ìš©ë„</th>
</tr>
</thead>
<tbody>
<tr>
<td>Whisper Large</td>
<td>1.55B</td>
<td>ë‹¤êµ­ì–´, ë²ˆì—­</td>
<td>ë²”ìš© ASR</td>
</tr>
<tr>
<td>Whisper Large-v3</td>
<td>1.55B</td>
<td>ê°œì„ ëœ ì •í™•ë„</td>
<td>í”„ë¡œë•ì…˜</td>
</tr>
<tr>
<td>wav2vec 2.0</td>
<td>300M</td>
<td>Self-supervised</td>
<td>Fine-tuning ë² ì´ìŠ¤</td>
</tr>
<tr>
<td>HuBERT</td>
<td>300M-1B</td>
<td>Masked prediction</td>
<td>Speech representation</td>
</tr>
</tbody>
</table>
<h3 id="52-audio-generation">5.2 Audio Generation<a class="header-link" href="#52-audio-generation" title="Permanent link">&para;</a></h3>
<table>
<thead>
<tr>
<th>ëª¨ë¸</th>
<th>í¬ê¸°</th>
<th>íŠ¹ì§•</th>
<th>ì¶œë ¥</th>
</tr>
</thead>
<tbody>
<tr>
<td>MusicGen Small</td>
<td>300M</td>
<td>ë¹ ë¥¸ ìƒì„±</td>
<td>ìŒì•…</td>
</tr>
<tr>
<td>MusicGen Large</td>
<td>3.3B</td>
<td>ê³ í’ˆì§ˆ</td>
<td>ìŒì•…</td>
</tr>
<tr>
<td>AudioGen</td>
<td>300M-1.5B</td>
<td>ì‚¬ìš´ë“œ íš¨ê³¼</td>
<td>ì˜¤ë””ì˜¤</td>
</tr>
<tr>
<td>Bark</td>
<td>1B+</td>
<td>ë¹„ì–¸ì–´ í‘œí˜„</td>
<td>TTS</td>
</tr>
</tbody>
</table>
<h3 id="53-video-models">5.3 Video Models<a class="header-link" href="#53-video-models" title="Permanent link">&para;</a></h3>
<table>
<thead>
<tr>
<th>ëª¨ë¸</th>
<th>ì•„í‚¤í…ì²˜</th>
<th>ì…ë ¥</th>
<th>íƒœìŠ¤í¬</th>
</tr>
</thead>
<tbody>
<tr>
<td>VideoLLaMA</td>
<td>LLaMA + Q-Former</td>
<td>Video + Audio</td>
<td>VQA, Captioning</td>
</tr>
<tr>
<td>Video-ChatGPT</td>
<td>LLaVA variant</td>
<td>Video</td>
<td>Conversation</td>
</tr>
<tr>
<td>TimeSformer</td>
<td>Divided attention</td>
<td>Video</td>
<td>Classification</td>
</tr>
<tr>
<td>ViViT</td>
<td>Factorized</td>
<td>Video</td>
<td>Classification</td>
</tr>
</tbody>
</table>
<hr />
<h2 id="_2">í•µì‹¬ ì •ë¦¬<a class="header-link" href="#_2" title="Permanent link">&para;</a></h2>
<h3 id="audio-foundation-models">Audio Foundation Models<a class="header-link" href="#audio-foundation-models" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><span class="n">Whisper</span><span class="o">:</span><span class="w"> </span><span class="err">ë²”ìš©</span><span class="w"> </span><span class="n">ASR</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="err">ë²ˆì—­</span>
<span class="err">â”œâ”€â”€</span><span class="w"> </span><span class="n">Encoder</span><span class="o">-</span><span class="n">Decoder</span><span class="w"> </span><span class="n">Transformer</span>
<span class="err">â”œâ”€â”€</span><span class="w"> </span><span class="mi">680</span><span class="n">K</span><span class="w"> </span><span class="err">ì‹œê°„</span><span class="w"> </span><span class="err">í•™ìŠµ</span><span class="w"> </span><span class="err">ë°ì´í„°</span>
<span class="err">â””â”€â”€</span><span class="w"> </span><span class="err">ë‹¤êµ­ì–´</span><span class="w"> </span><span class="o">(</span><span class="mi">99</span><span class="err">ê°œ</span><span class="w"> </span><span class="err">ì–¸ì–´</span><span class="o">)</span>

<span class="n">MusicGen</span><span class="o">:</span><span class="w"> </span><span class="err">í…ìŠ¤íŠ¸â†’ìŒì•…</span>
<span class="err">â”œâ”€â”€</span><span class="w"> </span><span class="n">Autoregressive</span><span class="w"> </span><span class="n">Transformer</span>
<span class="err">â”œâ”€â”€</span><span class="w"> </span><span class="n">EnCodec</span><span class="w"> </span><span class="err">í† í°í™”</span>
<span class="err">â””â”€â”€</span><span class="w"> </span><span class="err">í…ìŠ¤íŠ¸</span><span class="o">/</span><span class="err">ë©œë¡œë””</span><span class="w"> </span><span class="err">ì¡°ê±´ë¶€</span>
</code></pre></div>

<h3 id="video-foundation-models">Video Foundation Models<a class="header-link" href="#video-foundation-models" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><span class="n">Video</span><span class="w"> </span><span class="nl">Understanding:</span>
<span class="err">â”œâ”€â”€</span><span class="w"> </span><span class="n">Frame</span><span class="w"> </span><span class="n">sampling</span><span class="w"> </span><span class="err">â†’</span><span class="w"> </span><span class="n">Visual</span><span class="w"> </span><span class="n">encoder</span>
<span class="err">â”œâ”€â”€</span><span class="w"> </span><span class="n">Temporal</span><span class="w"> </span><span class="n">aggregation</span><span class="w"> </span><span class="p">(</span><span class="n">Q</span><span class="o">-</span><span class="n">Former</span><span class="o">/</span><span class="n">pooling</span><span class="p">)</span>
<span class="err">â””â”€â”€</span><span class="w"> </span><span class="n">LLM</span><span class="w"> </span><span class="n">backbone</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="n">reasoning</span>

<span class="n">Video</span><span class="w"> </span><span class="n">Generation</span><span class="w"> </span><span class="p">(</span><span class="n">Sora</span><span class="w"> </span><span class="n">concept</span><span class="p">)</span><span class="o">:</span>
<span class="err">â”œâ”€â”€</span><span class="w"> </span><span class="n">Spacetime</span><span class="w"> </span><span class="n">patches</span><span class="w"> </span><span class="p">(</span><span class="mh">3</span><span class="n">D</span><span class="w"> </span><span class="n">tokenization</span><span class="p">)</span>
<span class="err">â”œâ”€â”€</span><span class="w"> </span><span class="n">Diffusion</span><span class="w"> </span><span class="n">Transformer</span><span class="w"> </span><span class="p">(</span><span class="n">DiT</span><span class="p">)</span>
<span class="err">â””â”€â”€</span><span class="w"> </span><span class="n">Variable</span><span class="w"> </span><span class="n">resolution</span><span class="o">/</span><span class="n">duration</span>
</code></pre></div>

<h3 id="_3">ì‹¤ìš© í¬ì¸íŠ¸<a class="header-link" href="#_3" title="Permanent link">&para;</a></h3>
<ol>
<li><strong>Whisper</strong>: Fine-tuningìœ¼ë¡œ ë„ë©”ì¸ íŠ¹í™” ê°€ëŠ¥</li>
<li><strong>MusicGen</strong>: guidance_scaleë¡œ í’ˆì§ˆ/ë‹¤ì–‘ì„± ì¡°ì ˆ</li>
<li><strong>Video</strong>: í”„ë ˆì„ ìƒ˜í”Œë§ ì „ëµì´ ì¤‘ìš”</li>
<li><strong>Real-time</strong>: ì‘ì€ ëª¨ë¸ + ìŠ¤íŠ¸ë¦¬ë° ë²„í¼</li>
</ol>
<hr />
<h2 id="_4">ì°¸ê³  ìë£Œ<a class="header-link" href="#_4" title="Permanent link">&para;</a></h2>
<ol>
<li>Radford et al. (2022). "Robust Speech Recognition via Large-Scale Weak Supervision" (Whisper)</li>
<li>Copet et al. (2023). "Simple and Controllable Music Generation" (MusicGen)</li>
<li>Borsos et al. (2023). "AudioLM: a Language Modeling Approach to Audio Generation"</li>
<li>Zhang et al. (2023). "Video-LLaMA: An Instruction-tuned Audio-Visual Language Model"</li>
<li>OpenAI Sora Technical Report (2024)</li>
</ol>
    </div>

    
<div class="lesson-toolbar lesson-toolbar--bottom">
    <div class="toolbar-nav toolbar-nav--prev">
        
        <a href="/study/ko/Foundation_Models/17_GPT4V_Gemini.html" class="nav-prev">
            <span class="nav-label">Previous</span>
            <span class="nav-title">17. GPT-4V, GPT-4o, Gemini & Claude 3</span>
        </a>
        
    </div>
    <div class="toolbar-actions">
        <button class="btn btn-copy-link" data-action="copy-link" title="Copy link">
            <span class="icon">ğŸ”—</span>
            <span class="text">Copy link</span>
        </button>
        <a href="/study/ko/Foundation_Models/" class="btn btn-topic-link" title="Back to topic list">
            <span class="icon">ğŸ“‹</span>
            <span class="text">Topic list</span>
        </a>
    </div>
    <div class="toolbar-nav toolbar-nav--next">
        
        <a href="/study/ko/Foundation_Models/19_PEFT_Unified.html" class="nav-next">
            <span class="nav-label">Next</span>
            <span class="nav-title">19. PEFT (Parameter-Efficient Fine-Tuning) í†µí•©</span>
        </a>
        
    </div>
</div>


    <div class="toolbar-keyboard-hint">
        <kbd>&larr;</kbd> <kbd>&rarr;</kbd> to navigate between lessons
    </div>
</article>

<!-- Scroll to top floating button -->
<button class="scroll-to-top" id="scroll-to-top" title="Scroll to top" aria-label="Scroll to top">â†‘</button>

            </div>
        </main>
    </div>

    <script src="/study/static/js/app.js"></script>
    <script>
        function switchLanguage(newLang) {
            const path = window.location.pathname;
            const base = '/study';
            const currentLang = 'ko';
            const newPath = path.replace(base + '/' + currentLang + '/', base + '/' + newLang + '/');
            window.location.href = newPath + window.location.search;
        }
    </script>
    
<script>
    document.addEventListener('DOMContentLoaded', function() {
        // Copy link - independent feedback per button
        document.querySelectorAll('[data-action="copy-link"]').forEach(function(btn) {
            btn.addEventListener('click', function() {
                navigator.clipboard.writeText(window.location.href);
                var textEl = this.querySelector('.text');
                var originalText = textEl.textContent;
                textEl.textContent = 'Copied!';
                setTimeout(function() { textEl.textContent = originalText; }, 2000);
            });
        });

        // Add copy buttons to code blocks
        document.querySelectorAll('.lesson-content pre').forEach(function(pre) {
            var copyBtn = document.createElement('button');
            copyBtn.className = 'code-copy-btn';
            copyBtn.textContent = 'Copy';
            copyBtn.addEventListener('click', function() {
                var code = pre.querySelector('code');
                var text = code ? code.textContent : pre.textContent;
                navigator.clipboard.writeText(text);
                copyBtn.textContent = 'Copied!';
                setTimeout(function() { copyBtn.textContent = 'Copy'; }, 2000);
            });
            pre.style.position = 'relative';
            pre.appendChild(copyBtn);
        });

        // Scroll to top button
        var scrollBtn = document.getElementById('scroll-to-top');
        window.addEventListener('scroll', function() {
            scrollBtn.classList.toggle('visible', window.scrollY > 300);
        });
        scrollBtn.addEventListener('click', function() {
            window.scrollTo({ top: 0, behavior: 'smooth' });
        });

        // Keyboard shortcuts: left/right arrows for lesson navigation
        document.addEventListener('keydown', function(e) {
            var tag = document.activeElement.tagName;
            if (tag === 'INPUT' || tag === 'TEXTAREA' || tag === 'SELECT') return;

            if (e.key === 'ArrowLeft') {
                var prevLink = document.querySelector('.nav-prev');
                if (prevLink) prevLink.click();
            } else if (e.key === 'ArrowRight') {
                var nextLink = document.querySelector('.nav-next');
                if (nextLink) nextLink.click();
            }
        });
    });
</script>

</body>
</html>
{% endraw %}