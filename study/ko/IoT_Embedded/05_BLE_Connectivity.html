{% raw %}
<!DOCTYPE html>
<html lang="ko" data-theme="light">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>05. BLE ì—°ê²° - Study Materials</title>
    <link rel="stylesheet" href="/study/static/css/style.css">
    <link rel="stylesheet" href="/study/static/css/highlight.css">
    <!-- KaTeX for LaTeX math rendering -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.16.11/dist/katex.min.css">
    <script defer src="https://cdn.jsdelivr.net/npm/katex@0.16.11/dist/katex.min.js"></script>
    <script defer src="https://cdn.jsdelivr.net/npm/katex@0.16.11/dist/contrib/auto-render.min.js"
        onload="renderMathInElement(document.body, {
            delimiters: [
                {left: '$$', right: '$$', display: true},
                {left: '$', right: '$', display: false}
            ],
            throwOnError: false
        });"></script>
    
</head>
<body>
    <div class="app-container">
        <!-- Sidebar -->
        <aside class="sidebar" id="sidebar">
            <div class="sidebar-header">
                <a href="/study/ko/" class="logo">Study Materials</a>
                <button class="sidebar-toggle" id="sidebar-toggle" aria-label="Toggle sidebar">
                    <span></span>
                </button>
            </div>

            <nav class="sidebar-nav">
                <a href="/study/ko/" class="nav-item ">
                    <span class="nav-icon">ğŸ </span>
                    <span class="nav-text">Home</span>
                </a>
                <a href="/study/examples/" class="nav-item ">
                    <span class="nav-icon">ğŸ’»</span>
                    <span class="nav-text">Examples</span>
                </a>
            </nav>

            <div class="sidebar-search">
                <form action="/study/ko/search.html" method="get" id="search-form">
                    <input type="search" name="q" placeholder="Search..." id="search-sidebar-input">
                </form>
            </div>

            <!-- Language Selector -->
            <div class="sidebar-lang">
                <select id="lang-select" class="lang-selector" onchange="switchLanguage(this.value)">
                    
                    <option value="en" >
                        English
                    </option>
                    
                    <option value="ko" selected>
                        í•œêµ­ì–´
                    </option>
                    
                </select>
            </div>

            <div class="sidebar-footer">
                <button class="theme-toggle" id="theme-toggle" aria-label="Toggle theme">
                    <span class="theme-icon light">â˜€ï¸</span>
                    <span class="theme-icon dark">ğŸŒ™</span>
                </button>
            </div>
        </aside>

        <!-- Main Content -->
        <main class="main-content">
            <header class="main-header">
                <button class="menu-toggle" id="menu-toggle" aria-label="Open menu">
                    <span></span>
                </button>
                
<nav class="breadcrumb">
    <a href="/study/ko/">Topics</a>
    <span class="separator">/</span>
    <a href="/study/ko/IoT_Embedded/">IoT Embedded</a>
    <span class="separator">/</span>
    <span class="current">05. BLE ì—°ê²°</span>
</nav>

            </header>

            <div class="content">
                
<article class="lesson-article">
    <header class="lesson-header">
        <h1>05. BLE ì—°ê²°</h1>
    </header>

    
<div class="lesson-toolbar lesson-toolbar--top">
    <div class="toolbar-nav toolbar-nav--prev">
        
        <a href="/study/ko/IoT_Embedded/04_WiFi_Networking.html" class="nav-prev">
            <span class="nav-label">Previous</span>
            <span class="nav-title">04. WiFi ë„¤íŠ¸ì›Œí‚¹</span>
        </a>
        
    </div>
    <div class="toolbar-actions">
        <button class="btn btn-copy-link" data-action="copy-link" title="Copy link">
            <span class="icon">ğŸ”—</span>
            <span class="text">Copy link</span>
        </button>
        <a href="/study/ko/IoT_Embedded/" class="btn btn-topic-link" title="Back to topic list">
            <span class="icon">ğŸ“‹</span>
            <span class="text">Topic list</span>
        </a>
    </div>
    <div class="toolbar-nav toolbar-nav--next">
        
        <a href="/study/ko/IoT_Embedded/06_MQTT_Protocol.html" class="nav-next">
            <span class="nav-label">Next</span>
            <span class="nav-title">06. MQTT í”„ë¡œí† ì½œ</span>
        </a>
        
    </div>
</div>


    
    <nav class="toc" id="toc">
        <h2>Table of Contents</h2>
        <div class="toc">
<ul>
<li><a href="#_1">í•™ìŠµ ëª©í‘œ</a></li>
<li><a href="#1-ble">1. BLE í”„ë¡œí† ì½œ ê°œìš”</a><ul>
<li><a href="#11-ble-vs-bluetooth">1.1 BLE vs í´ë˜ì‹ Bluetooth</a></li>
<li><a href="#12-ble">1.2 BLE í”„ë¡œí† ì½œ ìŠ¤íƒ</a></li>
<li><a href="#13-ble">1.3 BLE ì—­í• </a></li>
</ul>
</li>
<li><a href="#2-gatt">2. GATT êµ¬ì¡°</a><ul>
<li><a href="#21-gatt">2.1 GATT ê³„ì¸µ êµ¬ì¡°</a></li>
<li><a href="#22-uuid">2.2 í‘œì¤€ UUID</a></li>
<li><a href="#23">2.3 íŠ¹ì„± ì†ì„±</a></li>
</ul>
</li>
<li><a href="#3-bleak">3. bleak ë¼ì´ë¸ŒëŸ¬ë¦¬</a><ul>
<li><a href="#31">3.1 ì„¤ì¹˜ ë° ì„¤ì •</a></li>
<li><a href="#32-ble">3.2 BLE ì¥ì¹˜ ìŠ¤ìº”</a></li>
<li><a href="#33-ble">3.3 BLE ì¥ì¹˜ ì—°ê²°</a></li>
</ul>
</li>
<li><a href="#4">4. ì„¼ì„œ ë°ì´í„° ìˆ˜ì‹ </a><ul>
<li><a href="#41">4.1 íŠ¹ì„± ê°’ ì½ê¸°</a></li>
<li><a href="#42-notification">4.2 ì•Œë¦¼(Notification) ìˆ˜ì‹ </a></li>
<li><a href="#43">4.3 íŠ¹ì„± ê°’ ì“°ê¸°</a></li>
</ul>
</li>
<li><a href="#5-ble">5. ì¢…í•© ì˜ˆì œ: BLE ì„¼ì„œ ëª¨ë‹ˆí„°</a></li>
<li><a href="#_2">ì—°ìŠµ ë¬¸ì œ</a><ul>
<li><a href="#1-ble_1">ë¬¸ì œ 1: BLE ìŠ¤ìºë„ˆ</a></li>
<li><a href="#2">ë¬¸ì œ 2: ì‹¬ë°•ìˆ˜ ëª¨ë‹ˆí„°</a></li>
<li><a href="#3">ë¬¸ì œ 3: ë°ì´í„° ë¡œê¹…</a></li>
</ul>
</li>
<li><a href="#_3">ë‹¤ìŒ ë‹¨ê³„</a></li>
</ul>
</div>

    </nav>
    

    <div class="lesson-content markdown-body">
        <h1 id="05-ble">05. BLE ì—°ê²°<a class="header-link" href="#05-ble" title="Permanent link">&para;</a></h1>
<h2 id="_1">í•™ìŠµ ëª©í‘œ<a class="header-link" href="#_1" title="Permanent link">&para;</a></h2>
<ul>
<li>BLE(Bluetooth Low Energy) í”„ë¡œí† ì½œ ê°œìš” ì´í•´</li>
<li>GATT êµ¬ì¡° (ì„œë¹„ìŠ¤, íŠ¹ì„±) íŒŒì•…</li>
<li>Python bleak ë¼ì´ë¸ŒëŸ¬ë¦¬ ì‚¬ìš©ë²• ìŠµë“</li>
<li>BLE ì¥ì¹˜ ìŠ¤ìº” ë° ì—°ê²°</li>
<li>ì„¼ì„œ ë°ì´í„° ìˆ˜ì‹ </li>
</ul>
<hr />
<h2 id="1-ble">1. BLE í”„ë¡œí† ì½œ ê°œìš”<a class="header-link" href="#1-ble" title="Permanent link">&para;</a></h2>
<h3 id="11-ble-vs-bluetooth">1.1 BLE vs í´ë˜ì‹ Bluetooth<a class="header-link" href="#11-ble-vs-bluetooth" title="Permanent link">&para;</a></h3>
<table>
<thead>
<tr>
<th>íŠ¹ì„±</th>
<th>BLE (Bluetooth Low Energy)</th>
<th>í´ë˜ì‹ Bluetooth</th>
</tr>
</thead>
<tbody>
<tr>
<td><strong>ì „ë ¥ ì†Œë¹„</strong></td>
<td>ë§¤ìš° ë‚®ìŒ</td>
<td>ë†’ìŒ</td>
</tr>
<tr>
<td><strong>ë°ì´í„° ì „ì†¡ë¥ </strong></td>
<td>1-2 Mbps</td>
<td>1-3 Mbps</td>
</tr>
<tr>
<td><strong>ë²”ìœ„</strong></td>
<td>~100m</td>
<td>~100m</td>
</tr>
<tr>
<td><strong>ì§€ì—° ì‹œê°„</strong></td>
<td>~6ms</td>
<td>~100ms</td>
</tr>
<tr>
<td><strong>í˜ì–´ë§</strong></td>
<td>ê°„ë‹¨/ìë™</td>
<td>ë³µì¡</td>
</tr>
<tr>
<td><strong>ìš©ë„</strong></td>
<td>IoT ì„¼ì„œ, ì›¨ì–´ëŸ¬ë¸”</td>
<td>ì˜¤ë””ì˜¤, íŒŒì¼ ì „ì†¡</td>
</tr>
</tbody>
</table>
<h3 id="12-ble">1.2 BLE í”„ë¡œí† ì½œ ìŠ¤íƒ<a class="header-link" href="#12-ble" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code>â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    BLE í”„ë¡œí† ì½œ ìŠ¤íƒ                         â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚                    Application                       â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚                           â”‚                                  â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚                GAP (Generic Access Profile)          â”‚    â”‚
â”‚  â”‚           ë””ë°”ì´ìŠ¤ ê²€ìƒ‰, ì—°ê²°, ë³´ì•ˆ                   â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚                           â”‚                                  â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚             GATT (Generic Attribute Profile)         â”‚    â”‚
â”‚  â”‚              ì„œë¹„ìŠ¤, íŠ¹ì„±, ë°ì´í„° êµí™˜                â”‚    â”‚
â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤    â”‚
â”‚  â”‚                 ATT (Attribute Protocol)             â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚                           â”‚                                  â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚                    L2CAP                             â”‚    â”‚
â”‚  â”‚           ë…¼ë¦¬ ë§í¬ ì œì–´ ë° ì ì‘ í”„ë¡œí† ì½œ             â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚                           â”‚                                  â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚              Link Layer + Physical Layer             â”‚    â”‚
â”‚  â”‚                  ë¬´ì„  í†µì‹  ì²˜ë¦¬                       â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚                                                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
</code></pre></div>

<h3 id="13-ble">1.3 BLE ì—­í• <a class="header-link" href="#13-ble" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><span class="c1"># BLE ì—­í•  ì •ì˜</span>
<span class="n">ble_roles</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s2">&quot;Central (Master)&quot;</span><span class="p">:</span> <span class="p">{</span>
        <span class="s2">&quot;description&quot;</span><span class="p">:</span> <span class="s2">&quot;ë‹¤ë¥¸ ì¥ì¹˜ë¥¼ ìŠ¤ìº”í•˜ê³  ì—°ê²°ì„ ì‹œì‘&quot;</span><span class="p">,</span>
        <span class="s2">&quot;example&quot;</span><span class="p">:</span> <span class="s2">&quot;ìŠ¤ë§ˆíŠ¸í°, ë¼ì¦ˆë² ë¦¬íŒŒì´&quot;</span><span class="p">,</span>
        <span class="s2">&quot;behavior&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;ìŠ¤ìº”&quot;</span><span class="p">,</span> <span class="s2">&quot;ì—°ê²° ìš”ì²­&quot;</span><span class="p">,</span> <span class="s2">&quot;ë°ì´í„° ìš”ì²­&quot;</span><span class="p">]</span>
    <span class="p">},</span>
    <span class="s2">&quot;Peripheral (Slave)&quot;</span><span class="p">:</span> <span class="p">{</span>
        <span class="s2">&quot;description&quot;</span><span class="p">:</span> <span class="s2">&quot;ê´‘ê³ í•˜ê³  ì—°ê²°ì„ ê¸°ë‹¤ë¦¼&quot;</span><span class="p">,</span>
        <span class="s2">&quot;example&quot;</span><span class="p">:</span> <span class="s2">&quot;ì„¼ì„œ, ë¹„ì½˜, ì›¨ì–´ëŸ¬ë¸”&quot;</span><span class="p">,</span>
        <span class="s2">&quot;behavior&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;ê´‘ê³ &quot;</span><span class="p">,</span> <span class="s2">&quot;ì—°ê²° ëŒ€ê¸°&quot;</span><span class="p">,</span> <span class="s2">&quot;ë°ì´í„° ì œê³µ&quot;</span><span class="p">]</span>
    <span class="p">},</span>
    <span class="s2">&quot;Observer&quot;</span><span class="p">:</span> <span class="p">{</span>
        <span class="s2">&quot;description&quot;</span><span class="p">:</span> <span class="s2">&quot;ê´‘ê³  íŒ¨í‚·ë§Œ ìˆ˜ì‹  (ì—°ê²° ì—†ìŒ)&quot;</span><span class="p">,</span>
        <span class="s2">&quot;example&quot;</span><span class="p">:</span> <span class="s2">&quot;ë¹„ì½˜ ë¦¬ë”&quot;</span><span class="p">,</span>
        <span class="s2">&quot;behavior&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;ìŠ¤ìº”ë§Œ&quot;</span><span class="p">]</span>
    <span class="p">},</span>
    <span class="s2">&quot;Broadcaster&quot;</span><span class="p">:</span> <span class="p">{</span>
        <span class="s2">&quot;description&quot;</span><span class="p">:</span> <span class="s2">&quot;ê´‘ê³  íŒ¨í‚·ë§Œ ì†¡ì‹  (ì—°ê²° ì—†ìŒ)&quot;</span><span class="p">,</span>
        <span class="s2">&quot;example&quot;</span><span class="p">:</span> <span class="s2">&quot;ë¹„ì½˜&quot;</span><span class="p">,</span>
        <span class="s2">&quot;behavior&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;ê´‘ê³ ë§Œ&quot;</span><span class="p">]</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div>

<hr />
<h2 id="2-gatt">2. GATT êµ¬ì¡°<a class="header-link" href="#2-gatt" title="Permanent link">&para;</a></h2>
<h3 id="21-gatt">2.1 GATT ê³„ì¸µ êµ¬ì¡°<a class="header-link" href="#21-gatt" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code>â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    GATT ê³„ì¸µ êµ¬ì¡°                            â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                              â”‚
â”‚   GATT Server (Peripheral)                                   â”‚
â”‚   â”‚                                                          â”‚
â”‚   â”œâ”€â”€ Profile                                                â”‚
â”‚   â”‚   â”‚                                                      â”‚
â”‚   â”‚   â”œâ”€â”€ Service (UUID: 0x180F - Battery Service)          â”‚
â”‚   â”‚   â”‚   â”‚                                                  â”‚
â”‚   â”‚   â”‚   â””â”€â”€ Characteristic (UUID: 0x2A19 - Battery Level)â”‚
â”‚   â”‚   â”‚       â”œâ”€â”€ Value: 85 (0-100%)                        â”‚
â”‚   â”‚   â”‚       â”œâ”€â”€ Properties: Read, Notify                  â”‚
â”‚   â”‚   â”‚       â””â”€â”€ Descriptors                               â”‚
â”‚   â”‚   â”‚           â””â”€â”€ CCCD (Client Config Descriptor)       â”‚
â”‚   â”‚   â”‚                                                      â”‚
â”‚   â”‚   â””â”€â”€ Service (UUID: 0x181A - Environmental Sensing)    â”‚
â”‚   â”‚       â”‚                                                  â”‚
â”‚   â”‚       â”œâ”€â”€ Characteristic: Temperature (0x2A6E)          â”‚
â”‚   â”‚       â”‚   â””â”€â”€ Value: 25.5Â°C                             â”‚
â”‚   â”‚       â”‚                                                  â”‚
â”‚   â”‚       â””â”€â”€ Characteristic: Humidity (0x2A6F)             â”‚
â”‚   â”‚           â””â”€â”€ Value: 60%                                 â”‚
â”‚   â”‚                                                          â”‚
â”‚   â””â”€â”€ ...                                                    â”‚
â”‚                                                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
</code></pre></div>

<h3 id="22-uuid">2.2 í‘œì¤€ UUID<a class="header-link" href="#22-uuid" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><span class="c1"># í‘œì¤€ BLE ì„œë¹„ìŠ¤ UUID (16-bit)</span>
<span class="n">standard_services</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s2">&quot;0x1800&quot;</span><span class="p">:</span> <span class="s2">&quot;Generic Access&quot;</span><span class="p">,</span>
    <span class="s2">&quot;0x1801&quot;</span><span class="p">:</span> <span class="s2">&quot;Generic Attribute&quot;</span><span class="p">,</span>
    <span class="s2">&quot;0x180A&quot;</span><span class="p">:</span> <span class="s2">&quot;Device Information&quot;</span><span class="p">,</span>
    <span class="s2">&quot;0x180F&quot;</span><span class="p">:</span> <span class="s2">&quot;Battery Service&quot;</span><span class="p">,</span>
    <span class="s2">&quot;0x181A&quot;</span><span class="p">:</span> <span class="s2">&quot;Environmental Sensing&quot;</span><span class="p">,</span>
    <span class="s2">&quot;0x180D&quot;</span><span class="p">:</span> <span class="s2">&quot;Heart Rate&quot;</span><span class="p">,</span>
<span class="p">}</span>

<span class="c1"># í‘œì¤€ íŠ¹ì„± UUID</span>
<span class="n">standard_characteristics</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s2">&quot;0x2A00&quot;</span><span class="p">:</span> <span class="s2">&quot;Device Name&quot;</span><span class="p">,</span>
    <span class="s2">&quot;0x2A19&quot;</span><span class="p">:</span> <span class="s2">&quot;Battery Level&quot;</span><span class="p">,</span>
    <span class="s2">&quot;0x2A6E&quot;</span><span class="p">:</span> <span class="s2">&quot;Temperature&quot;</span><span class="p">,</span>
    <span class="s2">&quot;0x2A6F&quot;</span><span class="p">:</span> <span class="s2">&quot;Humidity&quot;</span><span class="p">,</span>
    <span class="s2">&quot;0x2A37&quot;</span><span class="p">:</span> <span class="s2">&quot;Heart Rate Measurement&quot;</span><span class="p">,</span>
<span class="p">}</span>

<span class="c1"># 16-bit UUIDë¥¼ 128-bitë¡œ ë³€í™˜</span>
<span class="k">def</span><span class="w"> </span><span class="nf">uuid_16_to_128</span><span class="p">(</span><span class="n">uuid_16</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;16-bit UUIDë¥¼ 128-bit BLE ê¸°ë³¸ UUIDë¡œ ë³€í™˜&quot;&quot;&quot;</span>
    <span class="n">base_uuid</span> <span class="o">=</span> <span class="s2">&quot;00000000-0000-1000-8000-00805f9b34fb&quot;</span>
    <span class="n">uuid_16_clean</span> <span class="o">=</span> <span class="n">uuid_16</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;0x&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span>
    <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot;0000</span><span class="si">{</span><span class="n">uuid_16_clean</span><span class="si">}{</span><span class="n">base_uuid</span><span class="p">[</span><span class="mi">8</span><span class="p">:]</span><span class="si">}</span><span class="s2">&quot;</span>

<span class="c1"># ì˜ˆ: 0x180F -&gt; 0000180f-0000-1000-8000-00805f9b34fb</span>
</code></pre></div>

<h3 id="23">2.3 íŠ¹ì„± ì†ì„±<a class="header-link" href="#23" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><span class="c1"># íŠ¹ì„± ì†ì„± (Properties)</span>
<span class="n">characteristic_properties</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s2">&quot;Broadcast&quot;</span><span class="p">:</span> <span class="mh">0x01</span><span class="p">,</span>       <span class="c1"># ê´‘ê³ ì— í¬í•¨ ê°€ëŠ¥</span>
    <span class="s2">&quot;Read&quot;</span><span class="p">:</span> <span class="mh">0x02</span><span class="p">,</span>            <span class="c1"># ì½ê¸° ê°€ëŠ¥</span>
    <span class="s2">&quot;Write No Response&quot;</span><span class="p">:</span> <span class="mh">0x04</span><span class="p">,</span>  <span class="c1"># ì‘ë‹µ ì—†ì´ ì“°ê¸°</span>
    <span class="s2">&quot;Write&quot;</span><span class="p">:</span> <span class="mh">0x08</span><span class="p">,</span>           <span class="c1"># ì‘ë‹µ ìˆëŠ” ì“°ê¸°</span>
    <span class="s2">&quot;Notify&quot;</span><span class="p">:</span> <span class="mh">0x10</span><span class="p">,</span>          <span class="c1"># ì•Œë¦¼ (ì‘ë‹µ ì—†ìŒ)</span>
    <span class="s2">&quot;Indicate&quot;</span><span class="p">:</span> <span class="mh">0x20</span><span class="p">,</span>        <span class="c1"># í‘œì‹œ (ì‘ë‹µ ìˆìŒ)</span>
<span class="p">}</span>

<span class="k">def</span><span class="w"> </span><span class="nf">parse_properties</span><span class="p">(</span><span class="n">props</span><span class="p">:</span> <span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;ì†ì„± ë¹„íŠ¸ë§ˆìŠ¤í¬ë¥¼ ë¦¬ìŠ¤íŠ¸ë¡œ ë³€í™˜&quot;&quot;&quot;</span>
    <span class="n">result</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">name</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">characteristic_properties</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
        <span class="k">if</span> <span class="n">props</span> <span class="o">&amp;</span> <span class="n">value</span><span class="p">:</span>
            <span class="n">result</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">result</span>

<span class="c1"># ì˜ˆ: parse_properties(0x12) -&gt; [&#39;Read&#39;, &#39;Notify&#39;]</span>
</code></pre></div>

<hr />
<h2 id="3-bleak">3. bleak ë¼ì´ë¸ŒëŸ¬ë¦¬<a class="header-link" href="#3-bleak" title="Permanent link">&para;</a></h2>
<h3 id="31">3.1 ì„¤ì¹˜ ë° ì„¤ì •<a class="header-link" href="#31" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><span class="c1"># bleak ì„¤ì¹˜</span>
pip<span class="w"> </span>install<span class="w"> </span>bleak

<span class="c1"># Linuxì—ì„œ ì¶”ê°€ ì„¤ì • (bluetoothctl ì ‘ê·¼ ê¶Œí•œ)</span>
sudo<span class="w"> </span>usermod<span class="w"> </span>-a<span class="w"> </span>-G<span class="w"> </span>bluetooth<span class="w"> </span><span class="nv">$USER</span>

<span class="c1"># D-Bus ì„œë¹„ìŠ¤ í™•ì¸</span>
sudo<span class="w"> </span>systemctl<span class="w"> </span>status<span class="w"> </span>bluetooth
</code></pre></div>

<h3 id="32-ble">3.2 BLE ì¥ì¹˜ ìŠ¤ìº”<a class="header-link" href="#32-ble" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><span class="ch">#!/usr/bin/env python3</span>
<span class="sd">&quot;&quot;&quot;BLE ì¥ì¹˜ ìŠ¤ìº” (bleak)&quot;&quot;&quot;</span>

<span class="kn">import</span><span class="w"> </span><span class="nn">asyncio</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">bleak</span><span class="w"> </span><span class="kn">import</span> <span class="n">BleakScanner</span>

<span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">scan_devices</span><span class="p">(</span><span class="n">timeout</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">10.0</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;ì£¼ë³€ BLE ì¥ì¹˜ ìŠ¤ìº”&quot;&quot;&quot;</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;BLE ì¥ì¹˜ ìŠ¤ìº” ì¤‘... (</span><span class="si">{</span><span class="n">timeout</span><span class="si">}</span><span class="s2">ì´ˆ)&quot;</span><span class="p">)</span>

    <span class="n">devices</span> <span class="o">=</span> <span class="k">await</span> <span class="n">BleakScanner</span><span class="o">.</span><span class="n">discover</span><span class="p">(</span><span class="n">timeout</span><span class="o">=</span><span class="n">timeout</span><span class="p">)</span>

    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">ë°œê²¬ëœ ì¥ì¹˜: </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">devices</span><span class="p">)</span><span class="si">}</span><span class="s2">ê°œ</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>

    <span class="k">for</span> <span class="n">device</span> <span class="ow">in</span> <span class="n">devices</span><span class="p">:</span>
        <span class="n">rssi</span> <span class="o">=</span> <span class="n">device</span><span class="o">.</span><span class="n">rssi</span> <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">device</span><span class="p">,</span> <span class="s1">&#39;rssi&#39;</span><span class="p">)</span> <span class="k">else</span> <span class="s1">&#39;N/A&#39;</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  ì´ë¦„: </span><span class="si">{</span><span class="n">device</span><span class="o">.</span><span class="n">name</span><span class="w"> </span><span class="ow">or</span><span class="w"> </span><span class="s1">&#39;Unknown&#39;</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  ì£¼ì†Œ: </span><span class="si">{</span><span class="n">device</span><span class="o">.</span><span class="n">address</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  RSSI: </span><span class="si">{</span><span class="n">rssi</span><span class="si">}</span><span class="s2"> dBm&quot;</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">()</span>

    <span class="k">return</span> <span class="n">devices</span>

<span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">scan_with_filter</span><span class="p">(</span><span class="n">name_filter</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;ì´ë¦„ í•„í„°ë¡œ ìŠ¤ìº”&quot;&quot;&quot;</span>
    <span class="n">devices</span> <span class="o">=</span> <span class="k">await</span> <span class="n">BleakScanner</span><span class="o">.</span><span class="n">discover</span><span class="p">()</span>

    <span class="k">if</span> <span class="n">name_filter</span><span class="p">:</span>
        <span class="n">devices</span> <span class="o">=</span> <span class="p">[</span><span class="n">d</span> <span class="k">for</span> <span class="n">d</span> <span class="ow">in</span> <span class="n">devices</span> <span class="k">if</span> <span class="n">d</span><span class="o">.</span><span class="n">name</span> <span class="ow">and</span> <span class="n">name_filter</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="ow">in</span> <span class="n">d</span><span class="o">.</span><span class="n">name</span><span class="o">.</span><span class="n">lower</span><span class="p">()]</span>

    <span class="k">return</span> <span class="n">devices</span>

<span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">continuous_scan</span><span class="p">(</span><span class="n">callback</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">duration</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">30.0</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;ì—°ì† ìŠ¤ìº” (ì¥ì¹˜ ë°œê²¬ ì‹œ ì½œë°±)&quot;&quot;&quot;</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">detection_callback</span><span class="p">(</span><span class="n">device</span><span class="p">,</span> <span class="n">advertisement_data</span><span class="p">):</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;ë°œê²¬: </span><span class="si">{</span><span class="n">device</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2"> (</span><span class="si">{</span><span class="n">device</span><span class="o">.</span><span class="n">address</span><span class="si">}</span><span class="s2">)&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">callback</span><span class="p">:</span>
            <span class="n">callback</span><span class="p">(</span><span class="n">device</span><span class="p">,</span> <span class="n">advertisement_data</span><span class="p">)</span>

    <span class="n">scanner</span> <span class="o">=</span> <span class="n">BleakScanner</span><span class="p">(</span><span class="n">detection_callback</span><span class="o">=</span><span class="n">detection_callback</span><span class="p">)</span>

    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;ì—°ì† ìŠ¤ìº” ì‹œì‘ (</span><span class="si">{</span><span class="n">duration</span><span class="si">}</span><span class="s2">ì´ˆ)&quot;</span><span class="p">)</span>
    <span class="k">await</span> <span class="n">scanner</span><span class="o">.</span><span class="n">start</span><span class="p">()</span>
    <span class="k">await</span> <span class="n">asyncio</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="n">duration</span><span class="p">)</span>
    <span class="k">await</span> <span class="n">scanner</span><span class="o">.</span><span class="n">stop</span><span class="p">()</span>

<span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s2">&quot;__main__&quot;</span><span class="p">:</span>
    <span class="n">asyncio</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">scan_devices</span><span class="p">(</span><span class="mi">10</span><span class="p">))</span>
</code></pre></div>

<h3 id="33-ble">3.3 BLE ì¥ì¹˜ ì—°ê²°<a class="header-link" href="#33-ble" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><span class="ch">#!/usr/bin/env python3</span>
<span class="sd">&quot;&quot;&quot;BLE ì¥ì¹˜ ì—°ê²° ë° ì„œë¹„ìŠ¤ íƒìƒ‰&quot;&quot;&quot;</span>

<span class="kn">import</span><span class="w"> </span><span class="nn">asyncio</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">bleak</span><span class="w"> </span><span class="kn">import</span> <span class="n">BleakClient</span><span class="p">,</span> <span class="n">BleakScanner</span>

<span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">connect_and_explore</span><span class="p">(</span><span class="n">address</span><span class="p">:</span> <span class="nb">str</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;ì¥ì¹˜ ì—°ê²° í›„ ì„œë¹„ìŠ¤/íŠ¹ì„± íƒìƒ‰&quot;&quot;&quot;</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;ì—°ê²° ì¤‘: </span><span class="si">{</span><span class="n">address</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

    <span class="k">async</span> <span class="k">with</span> <span class="n">BleakClient</span><span class="p">(</span><span class="n">address</span><span class="p">)</span> <span class="k">as</span> <span class="n">client</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;ì—°ê²°ë¨! MTU: </span><span class="si">{</span><span class="n">client</span><span class="o">.</span><span class="n">mtu_size</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

        <span class="c1"># ì„œë¹„ìŠ¤ íƒìƒ‰</span>
        <span class="k">for</span> <span class="n">service</span> <span class="ow">in</span> <span class="n">client</span><span class="o">.</span><span class="n">services</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">ì„œë¹„ìŠ¤: </span><span class="si">{</span><span class="n">service</span><span class="o">.</span><span class="n">uuid</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  ì„¤ëª…: </span><span class="si">{</span><span class="n">service</span><span class="o">.</span><span class="n">description</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

            <span class="c1"># íŠ¹ì„± íƒìƒ‰</span>
            <span class="k">for</span> <span class="n">char</span> <span class="ow">in</span> <span class="n">service</span><span class="o">.</span><span class="n">characteristics</span><span class="p">:</span>
                <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;    íŠ¹ì„±: </span><span class="si">{</span><span class="n">char</span><span class="o">.</span><span class="n">uuid</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
                <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;      ì†ì„±: </span><span class="si">{</span><span class="n">char</span><span class="o">.</span><span class="n">properties</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

                <span class="c1"># ì½ê¸° ê°€ëŠ¥í•˜ë©´ ê°’ ì½ê¸°</span>
                <span class="k">if</span> <span class="s2">&quot;read&quot;</span> <span class="ow">in</span> <span class="n">char</span><span class="o">.</span><span class="n">properties</span><span class="p">:</span>
                    <span class="k">try</span><span class="p">:</span>
                        <span class="n">value</span> <span class="o">=</span> <span class="k">await</span> <span class="n">client</span><span class="o">.</span><span class="n">read_gatt_char</span><span class="p">(</span><span class="n">char</span><span class="o">.</span><span class="n">uuid</span><span class="p">)</span>
                        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;      ê°’: </span><span class="si">{</span><span class="n">value</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
                    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
                        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;      ì½ê¸° ì‹¤íŒ¨: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

<span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">find_and_connect</span><span class="p">(</span><span class="n">name_filter</span><span class="p">:</span> <span class="nb">str</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;ì´ë¦„ìœ¼ë¡œ ì¥ì¹˜ ì°¾ì•„ ì—°ê²°&quot;&quot;&quot;</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;ì¥ì¹˜ ê²€ìƒ‰: &#39;</span><span class="si">{</span><span class="n">name_filter</span><span class="si">}</span><span class="s2">&#39;&quot;</span><span class="p">)</span>

    <span class="n">device</span> <span class="o">=</span> <span class="k">await</span> <span class="n">BleakScanner</span><span class="o">.</span><span class="n">find_device_by_name</span><span class="p">(</span><span class="n">name_filter</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">device</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;ì¥ì¹˜ ë°œê²¬: </span><span class="si">{</span><span class="n">device</span><span class="o">.</span><span class="n">address</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="k">await</span> <span class="n">connect_and_explore</span><span class="p">(</span><span class="n">device</span><span class="o">.</span><span class="n">address</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;ì¥ì¹˜ë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.&quot;</span><span class="p">)</span>

<span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s2">&quot;__main__&quot;</span><span class="p">:</span>
    <span class="c1"># MAC ì£¼ì†Œë¡œ ì§ì ‘ ì—°ê²°</span>
    <span class="c1"># asyncio.run(connect_and_explore(&quot;AA:BB:CC:DD:EE:FF&quot;))</span>

    <span class="c1"># ì´ë¦„ìœ¼ë¡œ ê²€ìƒ‰ í›„ ì—°ê²°</span>
    <span class="n">asyncio</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">find_and_connect</span><span class="p">(</span><span class="s2">&quot;Temperature&quot;</span><span class="p">))</span>
</code></pre></div>

<hr />
<h2 id="4">4. ì„¼ì„œ ë°ì´í„° ìˆ˜ì‹ <a class="header-link" href="#4" title="Permanent link">&para;</a></h2>
<h3 id="41">4.1 íŠ¹ì„± ê°’ ì½ê¸°<a class="header-link" href="#41" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><span class="ch">#!/usr/bin/env python3</span>
<span class="sd">&quot;&quot;&quot;BLE íŠ¹ì„± ê°’ ì½ê¸°&quot;&quot;&quot;</span>

<span class="kn">import</span><span class="w"> </span><span class="nn">asyncio</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">bleak</span><span class="w"> </span><span class="kn">import</span> <span class="n">BleakClient</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">struct</span>

<span class="c1"># í‘œì¤€ UUID</span>
<span class="n">BATTERY_LEVEL_UUID</span> <span class="o">=</span> <span class="s2">&quot;00002a19-0000-1000-8000-00805f9b34fb&quot;</span>
<span class="n">TEMPERATURE_UUID</span> <span class="o">=</span> <span class="s2">&quot;00002a6e-0000-1000-8000-00805f9b34fb&quot;</span>

<span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">read_battery_level</span><span class="p">(</span><span class="n">address</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span> <span class="o">|</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;ë°°í„°ë¦¬ ë ˆë²¨ ì½ê¸°&quot;&quot;&quot;</span>
    <span class="k">async</span> <span class="k">with</span> <span class="n">BleakClient</span><span class="p">(</span><span class="n">address</span><span class="p">)</span> <span class="k">as</span> <span class="n">client</span><span class="p">:</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">data</span> <span class="o">=</span> <span class="k">await</span> <span class="n">client</span><span class="o">.</span><span class="n">read_gatt_char</span><span class="p">(</span><span class="n">BATTERY_LEVEL_UUID</span><span class="p">)</span>
            <span class="c1"># ë°°í„°ë¦¬ ë ˆë²¨ì€ 1ë°”ì´íŠ¸ (0-100%)</span>
            <span class="k">return</span> <span class="n">data</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;ì½ê¸° ì‹¤íŒ¨: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="k">return</span> <span class="kc">None</span>

<span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">read_temperature</span><span class="p">(</span><span class="n">address</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">float</span> <span class="o">|</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;ì˜¨ë„ ì½ê¸° (IEEE 11073 í˜•ì‹)&quot;&quot;&quot;</span>
    <span class="k">async</span> <span class="k">with</span> <span class="n">BleakClient</span><span class="p">(</span><span class="n">address</span><span class="p">)</span> <span class="k">as</span> <span class="n">client</span><span class="p">:</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">data</span> <span class="o">=</span> <span class="k">await</span> <span class="n">client</span><span class="o">.</span><span class="n">read_gatt_char</span><span class="p">(</span><span class="n">TEMPERATURE_UUID</span><span class="p">)</span>
            <span class="c1"># ì˜¨ë„ëŠ” 16-bit ë¶€í˜¸ìˆëŠ” ì •ìˆ˜ (0.01ë„ ë‹¨ìœ„)</span>
            <span class="n">temp_raw</span> <span class="o">=</span> <span class="n">struct</span><span class="o">.</span><span class="n">unpack</span><span class="p">(</span><span class="s1">&#39;&lt;h&#39;</span><span class="p">,</span> <span class="n">data</span><span class="p">[:</span><span class="mi">2</span><span class="p">])[</span><span class="mi">0</span><span class="p">]</span>
            <span class="k">return</span> <span class="n">temp_raw</span> <span class="o">*</span> <span class="mf">0.01</span>
        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;ì½ê¸° ì‹¤íŒ¨: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="k">return</span> <span class="kc">None</span>

<span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">read_multiple_chars</span><span class="p">(</span><span class="n">address</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">char_uuids</span><span class="p">:</span> <span class="nb">list</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;ì—¬ëŸ¬ íŠ¹ì„± í•œ ë²ˆì— ì½ê¸°&quot;&quot;&quot;</span>
    <span class="n">results</span> <span class="o">=</span> <span class="p">{}</span>

    <span class="k">async</span> <span class="k">with</span> <span class="n">BleakClient</span><span class="p">(</span><span class="n">address</span><span class="p">)</span> <span class="k">as</span> <span class="n">client</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">uuid</span> <span class="ow">in</span> <span class="n">char_uuids</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">data</span> <span class="o">=</span> <span class="k">await</span> <span class="n">client</span><span class="o">.</span><span class="n">read_gatt_char</span><span class="p">(</span><span class="n">uuid</span><span class="p">)</span>
                <span class="n">results</span><span class="p">[</span><span class="n">uuid</span><span class="p">]</span> <span class="o">=</span> <span class="n">data</span>
            <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
                <span class="n">results</span><span class="p">[</span><span class="n">uuid</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
                <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;UUID </span><span class="si">{</span><span class="n">uuid</span><span class="si">}</span><span class="s2"> ì½ê¸° ì‹¤íŒ¨: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">results</span>

<span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s2">&quot;__main__&quot;</span><span class="p">:</span>
    <span class="n">address</span> <span class="o">=</span> <span class="s2">&quot;AA:BB:CC:DD:EE:FF&quot;</span>

    <span class="c1"># ë°°í„°ë¦¬ ë ˆë²¨</span>
    <span class="n">level</span> <span class="o">=</span> <span class="n">asyncio</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">read_battery_level</span><span class="p">(</span><span class="n">address</span><span class="p">))</span>
    <span class="k">if</span> <span class="n">level</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;ë°°í„°ë¦¬: </span><span class="si">{</span><span class="n">level</span><span class="si">}</span><span class="s2">%&quot;</span><span class="p">)</span>

    <span class="c1"># ì˜¨ë„</span>
    <span class="n">temp</span> <span class="o">=</span> <span class="n">asyncio</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">read_temperature</span><span class="p">(</span><span class="n">address</span><span class="p">))</span>
    <span class="k">if</span> <span class="n">temp</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;ì˜¨ë„: </span><span class="si">{</span><span class="n">temp</span><span class="si">}</span><span class="s2">Â°C&quot;</span><span class="p">)</span>
</code></pre></div>

<h3 id="42-notification">4.2 ì•Œë¦¼(Notification) ìˆ˜ì‹ <a class="header-link" href="#42-notification" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><span class="ch">#!/usr/bin/env python3</span>
<span class="sd">&quot;&quot;&quot;BLE ì•Œë¦¼ ìˆ˜ì‹  (ì‹¤ì‹œê°„ ì„¼ì„œ ë°ì´í„°)&quot;&quot;&quot;</span>

<span class="kn">import</span><span class="w"> </span><span class="nn">asyncio</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">bleak</span><span class="w"> </span><span class="kn">import</span> <span class="n">BleakClient</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">datetime</span><span class="w"> </span><span class="kn">import</span> <span class="n">datetime</span>

<span class="c1"># ì˜ˆì‹œ UUID (ì¥ì¹˜ì— ë”°ë¼ ë‹¤ë¦„)</span>
<span class="n">HEART_RATE_UUID</span> <span class="o">=</span> <span class="s2">&quot;00002a37-0000-1000-8000-00805f9b34fb&quot;</span>

<span class="k">def</span><span class="w"> </span><span class="nf">notification_handler</span><span class="p">(</span><span class="n">sender</span><span class="p">,</span> <span class="n">data</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;ì•Œë¦¼ ìˆ˜ì‹  ì½œë°±&quot;&quot;&quot;</span>
    <span class="n">timestamp</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">()</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s2">&quot;%H:%M:%S&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;[</span><span class="si">{</span><span class="n">timestamp</span><span class="si">}</span><span class="s2">] ìˆ˜ì‹  (</span><span class="si">{</span><span class="n">sender</span><span class="si">}</span><span class="s2">): </span><span class="si">{</span><span class="n">data</span><span class="o">.</span><span class="n">hex</span><span class="p">()</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

    <span class="c1"># ë°ì´í„° íŒŒì‹± (ì˜ˆ: Heart Rate Measurement)</span>
    <span class="n">flags</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    <span class="k">if</span> <span class="n">flags</span> <span class="o">&amp;</span> <span class="mh">0x01</span><span class="p">:</span>  <span class="c1"># 16-bit heart rate</span>
        <span class="n">hr</span> <span class="o">=</span> <span class="nb">int</span><span class="o">.</span><span class="n">from_bytes</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="mi">1</span><span class="p">:</span><span class="mi">3</span><span class="p">],</span> <span class="s1">&#39;little&#39;</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>  <span class="c1"># 8-bit heart rate</span>
        <span class="n">hr</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>

    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  ì‹¬ë°•ìˆ˜: </span><span class="si">{</span><span class="n">hr</span><span class="si">}</span><span class="s2"> bpm&quot;</span><span class="p">)</span>

<span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">subscribe_notifications</span><span class="p">(</span><span class="n">address</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">char_uuid</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">duration</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mi">60</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;ì•Œë¦¼ êµ¬ë…&quot;&quot;&quot;</span>
    <span class="k">async</span> <span class="k">with</span> <span class="n">BleakClient</span><span class="p">(</span><span class="n">address</span><span class="p">)</span> <span class="k">as</span> <span class="n">client</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;ì—°ê²°ë¨: </span><span class="si">{</span><span class="n">address</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

        <span class="c1"># ì•Œë¦¼ ì‹œì‘</span>
        <span class="k">await</span> <span class="n">client</span><span class="o">.</span><span class="n">start_notify</span><span class="p">(</span><span class="n">char_uuid</span><span class="p">,</span> <span class="n">notification_handler</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;ì•Œë¦¼ êµ¬ë… ì‹œì‘: </span><span class="si">{</span><span class="n">char_uuid</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

        <span class="c1"># ì§€ì •ëœ ì‹œê°„ ë™ì•ˆ ìˆ˜ì‹ </span>
        <span class="k">await</span> <span class="n">asyncio</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="n">duration</span><span class="p">)</span>

        <span class="c1"># ì•Œë¦¼ ì¤‘ì§€</span>
        <span class="k">await</span> <span class="n">client</span><span class="o">.</span><span class="n">stop_notify</span><span class="p">(</span><span class="n">char_uuid</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;ì•Œë¦¼ êµ¬ë… ì¢…ë£Œ&quot;</span><span class="p">)</span>

<span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">subscribe_multiple</span><span class="p">(</span><span class="n">address</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">char_uuids</span><span class="p">:</span> <span class="nb">list</span><span class="p">,</span> <span class="n">duration</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mi">60</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;ì—¬ëŸ¬ íŠ¹ì„± ì•Œë¦¼ êµ¬ë…&quot;&quot;&quot;</span>
    <span class="k">async</span> <span class="k">with</span> <span class="n">BleakClient</span><span class="p">(</span><span class="n">address</span><span class="p">)</span> <span class="k">as</span> <span class="n">client</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;ì—°ê²°ë¨: </span><span class="si">{</span><span class="n">address</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

        <span class="k">for</span> <span class="n">uuid</span> <span class="ow">in</span> <span class="n">char_uuids</span><span class="p">:</span>
            <span class="k">await</span> <span class="n">client</span><span class="o">.</span><span class="n">start_notify</span><span class="p">(</span><span class="n">uuid</span><span class="p">,</span> <span class="n">notification_handler</span><span class="p">)</span>
            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;êµ¬ë…: </span><span class="si">{</span><span class="n">uuid</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

        <span class="k">await</span> <span class="n">asyncio</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="n">duration</span><span class="p">)</span>

        <span class="k">for</span> <span class="n">uuid</span> <span class="ow">in</span> <span class="n">char_uuids</span><span class="p">:</span>
            <span class="k">await</span> <span class="n">client</span><span class="o">.</span><span class="n">stop_notify</span><span class="p">(</span><span class="n">uuid</span><span class="p">)</span>

<span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s2">&quot;__main__&quot;</span><span class="p">:</span>
    <span class="n">asyncio</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">subscribe_notifications</span><span class="p">(</span><span class="s2">&quot;AA:BB:CC:DD:EE:FF&quot;</span><span class="p">,</span> <span class="n">HEART_RATE_UUID</span><span class="p">,</span> <span class="mi">30</span><span class="p">))</span>
</code></pre></div>

<h3 id="43">4.3 íŠ¹ì„± ê°’ ì“°ê¸°<a class="header-link" href="#43" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><span class="ch">#!/usr/bin/env python3</span>
<span class="sd">&quot;&quot;&quot;BLE íŠ¹ì„±ì— ê°’ ì“°ê¸°&quot;&quot;&quot;</span>

<span class="kn">import</span><span class="w"> </span><span class="nn">asyncio</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">bleak</span><span class="w"> </span><span class="kn">import</span> <span class="n">BleakClient</span>

<span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">write_characteristic</span><span class="p">(</span><span class="n">address</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">char_uuid</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">data</span><span class="p">:</span> <span class="nb">bytes</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;íŠ¹ì„±ì— ê°’ ì“°ê¸° (ì‘ë‹µ ìˆìŒ)&quot;&quot;&quot;</span>
    <span class="k">async</span> <span class="k">with</span> <span class="n">BleakClient</span><span class="p">(</span><span class="n">address</span><span class="p">)</span> <span class="k">as</span> <span class="n">client</span><span class="p">:</span>
        <span class="k">await</span> <span class="n">client</span><span class="o">.</span><span class="n">write_gatt_char</span><span class="p">(</span><span class="n">char_uuid</span><span class="p">,</span> <span class="n">data</span><span class="p">,</span> <span class="n">response</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;ì“°ê¸° ì™„ë£Œ: </span><span class="si">{</span><span class="n">data</span><span class="o">.</span><span class="n">hex</span><span class="p">()</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

<span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">write_without_response</span><span class="p">(</span><span class="n">address</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">char_uuid</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">data</span><span class="p">:</span> <span class="nb">bytes</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;íŠ¹ì„±ì— ê°’ ì“°ê¸° (ì‘ë‹µ ì—†ìŒ - ë¹ ë¦„)&quot;&quot;&quot;</span>
    <span class="k">async</span> <span class="k">with</span> <span class="n">BleakClient</span><span class="p">(</span><span class="n">address</span><span class="p">)</span> <span class="k">as</span> <span class="n">client</span><span class="p">:</span>
        <span class="k">await</span> <span class="n">client</span><span class="o">.</span><span class="n">write_gatt_char</span><span class="p">(</span><span class="n">char_uuid</span><span class="p">,</span> <span class="n">data</span><span class="p">,</span> <span class="n">response</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;ì“°ê¸° ì „ì†¡: </span><span class="si">{</span><span class="n">data</span><span class="o">.</span><span class="n">hex</span><span class="p">()</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

<span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">toggle_led</span><span class="p">(</span><span class="n">address</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">led_uuid</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">state</span><span class="p">:</span> <span class="nb">bool</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;LED ì œì–´ ì˜ˆì œ&quot;&quot;&quot;</span>
    <span class="n">data</span> <span class="o">=</span> <span class="nb">bytes</span><span class="p">([</span><span class="mh">0x01</span> <span class="k">if</span> <span class="n">state</span> <span class="k">else</span> <span class="mh">0x00</span><span class="p">])</span>
    <span class="k">await</span> <span class="n">write_characteristic</span><span class="p">(</span><span class="n">address</span><span class="p">,</span> <span class="n">led_uuid</span><span class="p">,</span> <span class="n">data</span><span class="p">)</span>

<span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">set_sensor_interval</span><span class="p">(</span><span class="n">address</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">config_uuid</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">interval_ms</span><span class="p">:</span> <span class="nb">int</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;ì„¼ì„œ ì¸¡ì • ì£¼ê¸° ì„¤ì •&quot;&quot;&quot;</span>
    <span class="c1"># 2ë°”ì´íŠ¸ ë¦¬í‹€ì—”ë””ì•ˆ</span>
    <span class="n">data</span> <span class="o">=</span> <span class="n">interval_ms</span><span class="o">.</span><span class="n">to_bytes</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="s1">&#39;little&#39;</span><span class="p">)</span>
    <span class="k">await</span> <span class="n">write_characteristic</span><span class="p">(</span><span class="n">address</span><span class="p">,</span> <span class="n">config_uuid</span><span class="p">,</span> <span class="n">data</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;ì¸¡ì • ì£¼ê¸° ì„¤ì •: </span><span class="si">{</span><span class="n">interval_ms</span><span class="si">}</span><span class="s2">ms&quot;</span><span class="p">)</span>

<span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s2">&quot;__main__&quot;</span><span class="p">:</span>
    <span class="c1"># LED í† ê¸€</span>
    <span class="n">asyncio</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">toggle_led</span><span class="p">(</span><span class="s2">&quot;AA:BB:CC:DD:EE:FF&quot;</span><span class="p">,</span> <span class="s2">&quot;custom-led-uuid&quot;</span><span class="p">,</span> <span class="kc">True</span><span class="p">))</span>
</code></pre></div>

<hr />
<h2 id="5-ble">5. ì¢…í•© ì˜ˆì œ: BLE ì„¼ì„œ ëª¨ë‹ˆí„°<a class="header-link" href="#5-ble" title="Permanent link">&para;</a></h2>
<div class="highlight"><pre><span></span><code><span class="ch">#!/usr/bin/env python3</span>
<span class="sd">&quot;&quot;&quot;BLE í™˜ê²½ ì„¼ì„œ ëª¨ë‹ˆí„°&quot;&quot;&quot;</span>

<span class="kn">import</span><span class="w"> </span><span class="nn">asyncio</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">bleak</span><span class="w"> </span><span class="kn">import</span> <span class="n">BleakClient</span><span class="p">,</span> <span class="n">BleakScanner</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">datetime</span><span class="w"> </span><span class="kn">import</span> <span class="n">datetime</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">struct</span>

<span class="k">class</span><span class="w"> </span><span class="nc">BLESensorMonitor</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;BLE í™˜ê²½ ì„¼ì„œ ëª¨ë‹ˆí„°ë§ í´ë˜ìŠ¤&quot;&quot;&quot;</span>

    <span class="c1"># í‘œì¤€ Environmental Sensing ì„œë¹„ìŠ¤</span>
    <span class="n">ENV_SENSING_SERVICE</span> <span class="o">=</span> <span class="s2">&quot;0000181a-0000-1000-8000-00805f9b34fb&quot;</span>
    <span class="n">TEMPERATURE_CHAR</span> <span class="o">=</span> <span class="s2">&quot;00002a6e-0000-1000-8000-00805f9b34fb&quot;</span>
    <span class="n">HUMIDITY_CHAR</span> <span class="o">=</span> <span class="s2">&quot;00002a6f-0000-1000-8000-00805f9b34fb&quot;</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">device_address</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">device_name</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">device_address</span> <span class="o">=</span> <span class="n">device_address</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">device_name</span> <span class="o">=</span> <span class="n">device_name</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">client</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">data_buffer</span> <span class="o">=</span> <span class="p">[]</span>

    <span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">find_device</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span> <span class="o">|</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;ì¥ì¹˜ ê²€ìƒ‰&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">device_address</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">device_address</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">device_name</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;ì¥ì¹˜ ê²€ìƒ‰: </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">device_name</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="n">device</span> <span class="o">=</span> <span class="k">await</span> <span class="n">BleakScanner</span><span class="o">.</span><span class="n">find_device_by_name</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">device_name</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">device</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">device_address</span> <span class="o">=</span> <span class="n">device</span><span class="o">.</span><span class="n">address</span>
                <span class="k">return</span> <span class="n">device</span><span class="o">.</span><span class="n">address</span>

        <span class="k">return</span> <span class="kc">None</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_handle_temperature</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">sender</span><span class="p">,</span> <span class="n">data</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;ì˜¨ë„ ë°ì´í„° í•¸ë“¤ëŸ¬&quot;&quot;&quot;</span>
        <span class="c1"># 0.01ë„ ë‹¨ìœ„ 16-bit ì •ìˆ˜</span>
        <span class="n">temp</span> <span class="o">=</span> <span class="n">struct</span><span class="o">.</span><span class="n">unpack</span><span class="p">(</span><span class="s1">&#39;&lt;h&#39;</span><span class="p">,</span> <span class="n">data</span><span class="p">[:</span><span class="mi">2</span><span class="p">])[</span><span class="mi">0</span><span class="p">]</span> <span class="o">*</span> <span class="mf">0.01</span>
        <span class="n">timestamp</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">()</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">data_buffer</span><span class="o">.</span><span class="n">append</span><span class="p">({</span>
            <span class="s1">&#39;type&#39;</span><span class="p">:</span> <span class="s1">&#39;temperature&#39;</span><span class="p">,</span>
            <span class="s1">&#39;value&#39;</span><span class="p">:</span> <span class="n">temp</span><span class="p">,</span>
            <span class="s1">&#39;unit&#39;</span><span class="p">:</span> <span class="s1">&#39;Â°C&#39;</span><span class="p">,</span>
            <span class="s1">&#39;timestamp&#39;</span><span class="p">:</span> <span class="n">timestamp</span>
        <span class="p">})</span>

        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;[</span><span class="si">{</span><span class="n">timestamp</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s1">&#39;%H:%M:%S&#39;</span><span class="p">)</span><span class="si">}</span><span class="s2">] ì˜¨ë„: </span><span class="si">{</span><span class="n">temp</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2">Â°C&quot;</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_handle_humidity</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">sender</span><span class="p">,</span> <span class="n">data</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;ìŠµë„ ë°ì´í„° í•¸ë“¤ëŸ¬&quot;&quot;&quot;</span>
        <span class="c1"># 0.01% ë‹¨ìœ„ 16-bit ì •ìˆ˜</span>
        <span class="n">humidity</span> <span class="o">=</span> <span class="n">struct</span><span class="o">.</span><span class="n">unpack</span><span class="p">(</span><span class="s1">&#39;&lt;H&#39;</span><span class="p">,</span> <span class="n">data</span><span class="p">[:</span><span class="mi">2</span><span class="p">])[</span><span class="mi">0</span><span class="p">]</span> <span class="o">*</span> <span class="mf">0.01</span>
        <span class="n">timestamp</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">()</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">data_buffer</span><span class="o">.</span><span class="n">append</span><span class="p">({</span>
            <span class="s1">&#39;type&#39;</span><span class="p">:</span> <span class="s1">&#39;humidity&#39;</span><span class="p">,</span>
            <span class="s1">&#39;value&#39;</span><span class="p">:</span> <span class="n">humidity</span><span class="p">,</span>
            <span class="s1">&#39;unit&#39;</span><span class="p">:</span> <span class="s1">&#39;%&#39;</span><span class="p">,</span>
            <span class="s1">&#39;timestamp&#39;</span><span class="p">:</span> <span class="n">timestamp</span>
        <span class="p">})</span>

        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;[</span><span class="si">{</span><span class="n">timestamp</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s1">&#39;%H:%M:%S&#39;</span><span class="p">)</span><span class="si">}</span><span class="s2">] ìŠµë„: </span><span class="si">{</span><span class="n">humidity</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2">%&quot;</span><span class="p">)</span>

    <span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">start_monitoring</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">duration</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mi">60</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;ëª¨ë‹ˆí„°ë§ ì‹œì‘&quot;&quot;&quot;</span>
        <span class="n">address</span> <span class="o">=</span> <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">find_device</span><span class="p">()</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">address</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;ì¥ì¹˜ë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.&quot;</span><span class="p">)</span>
            <span class="k">return</span>

        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;ì—°ê²° ì¤‘: </span><span class="si">{</span><span class="n">address</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

        <span class="k">async</span> <span class="k">with</span> <span class="n">BleakClient</span><span class="p">(</span><span class="n">address</span><span class="p">)</span> <span class="k">as</span> <span class="n">client</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">client</span> <span class="o">=</span> <span class="n">client</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;ì—°ê²°ë¨!&quot;</span><span class="p">)</span>

            <span class="c1"># ì„œë¹„ìŠ¤ í™•ì¸</span>
            <span class="n">services</span> <span class="o">=</span> <span class="n">client</span><span class="o">.</span><span class="n">services</span>
            <span class="n">has_env_sensing</span> <span class="o">=</span> <span class="nb">any</span><span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">ENV_SENSING_SERVICE</span> <span class="ow">in</span> <span class="nb">str</span><span class="p">(</span><span class="n">s</span><span class="o">.</span><span class="n">uuid</span><span class="p">)</span>
                <span class="k">for</span> <span class="n">s</span> <span class="ow">in</span> <span class="n">services</span>
            <span class="p">)</span>

            <span class="k">if</span> <span class="ow">not</span> <span class="n">has_env_sensing</span><span class="p">:</span>
                <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Environmental Sensing ì„œë¹„ìŠ¤ë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.&quot;</span><span class="p">)</span>
                <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;ì‚¬ìš© ê°€ëŠ¥í•œ ì„œë¹„ìŠ¤:&quot;</span><span class="p">)</span>
                <span class="k">for</span> <span class="n">s</span> <span class="ow">in</span> <span class="n">services</span><span class="p">:</span>
                    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  - </span><span class="si">{</span><span class="n">s</span><span class="o">.</span><span class="n">uuid</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
                <span class="k">return</span>

            <span class="c1"># ì•Œë¦¼ êµ¬ë…</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="k">await</span> <span class="n">client</span><span class="o">.</span><span class="n">start_notify</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">TEMPERATURE_CHAR</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_handle_temperature</span><span class="p">)</span>
                <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;ì˜¨ë„ ì•Œë¦¼ êµ¬ë… ì‹œì‘&quot;</span><span class="p">)</span>
            <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
                <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;ì˜¨ë„ êµ¬ë… ì‹¤íŒ¨: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

            <span class="k">try</span><span class="p">:</span>
                <span class="k">await</span> <span class="n">client</span><span class="o">.</span><span class="n">start_notify</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">HUMIDITY_CHAR</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_handle_humidity</span><span class="p">)</span>
                <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;ìŠµë„ ì•Œë¦¼ êµ¬ë… ì‹œì‘&quot;</span><span class="p">)</span>
            <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
                <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;ìŠµë„ êµ¬ë… ì‹¤íŒ¨: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">ëª¨ë‹ˆí„°ë§ ì¤‘... (</span><span class="si">{</span><span class="n">duration</span><span class="si">}</span><span class="s2">ì´ˆ)&quot;</span><span class="p">)</span>
            <span class="k">await</span> <span class="n">asyncio</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="n">duration</span><span class="p">)</span>

            <span class="c1"># ì •ë¦¬</span>
            <span class="k">await</span> <span class="n">client</span><span class="o">.</span><span class="n">stop_notify</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">TEMPERATURE_CHAR</span><span class="p">)</span>
            <span class="k">await</span> <span class="n">client</span><span class="o">.</span><span class="n">stop_notify</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">HUMIDITY_CHAR</span><span class="p">)</span>

        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">=== ëª¨ë‹ˆí„°ë§ ì¢…ë£Œ ===&quot;</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;ìˆ˜ì§‘ëœ ë°ì´í„°: </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data_buffer</span><span class="p">)</span><span class="si">}</span><span class="s2">ê°œ&quot;</span><span class="p">)</span>

    <span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">read_once</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;í•œ ë²ˆ ì½ê¸°&quot;&quot;&quot;</span>
        <span class="n">address</span> <span class="o">=</span> <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">find_device</span><span class="p">()</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">address</span><span class="p">:</span>
            <span class="k">return</span> <span class="p">{}</span>

        <span class="k">async</span> <span class="k">with</span> <span class="n">BleakClient</span><span class="p">(</span><span class="n">address</span><span class="p">)</span> <span class="k">as</span> <span class="n">client</span><span class="p">:</span>
            <span class="n">result</span> <span class="o">=</span> <span class="p">{}</span>

            <span class="k">try</span><span class="p">:</span>
                <span class="n">data</span> <span class="o">=</span> <span class="k">await</span> <span class="n">client</span><span class="o">.</span><span class="n">read_gatt_char</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">TEMPERATURE_CHAR</span><span class="p">)</span>
                <span class="n">result</span><span class="p">[</span><span class="s1">&#39;temperature&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">struct</span><span class="o">.</span><span class="n">unpack</span><span class="p">(</span><span class="s1">&#39;&lt;h&#39;</span><span class="p">,</span> <span class="n">data</span><span class="p">[:</span><span class="mi">2</span><span class="p">])[</span><span class="mi">0</span><span class="p">]</span> <span class="o">*</span> <span class="mf">0.01</span>
            <span class="k">except</span><span class="p">:</span>
                <span class="k">pass</span>

            <span class="k">try</span><span class="p">:</span>
                <span class="n">data</span> <span class="o">=</span> <span class="k">await</span> <span class="n">client</span><span class="o">.</span><span class="n">read_gatt_char</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">HUMIDITY_CHAR</span><span class="p">)</span>
                <span class="n">result</span><span class="p">[</span><span class="s1">&#39;humidity&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">struct</span><span class="o">.</span><span class="n">unpack</span><span class="p">(</span><span class="s1">&#39;&lt;H&#39;</span><span class="p">,</span> <span class="n">data</span><span class="p">[:</span><span class="mi">2</span><span class="p">])[</span><span class="mi">0</span><span class="p">]</span> <span class="o">*</span> <span class="mf">0.01</span>
            <span class="k">except</span><span class="p">:</span>
                <span class="k">pass</span>

            <span class="k">return</span> <span class="n">result</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">get_summary</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;ìˆ˜ì§‘ëœ ë°ì´í„° ìš”ì•½&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">data_buffer</span><span class="p">:</span>
            <span class="k">return</span> <span class="p">{}</span>

        <span class="n">temps</span> <span class="o">=</span> <span class="p">[</span><span class="n">d</span><span class="p">[</span><span class="s1">&#39;value&#39;</span><span class="p">]</span> <span class="k">for</span> <span class="n">d</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">data_buffer</span> <span class="k">if</span> <span class="n">d</span><span class="p">[</span><span class="s1">&#39;type&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;temperature&#39;</span><span class="p">]</span>
        <span class="n">humids</span> <span class="o">=</span> <span class="p">[</span><span class="n">d</span><span class="p">[</span><span class="s1">&#39;value&#39;</span><span class="p">]</span> <span class="k">for</span> <span class="n">d</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">data_buffer</span> <span class="k">if</span> <span class="n">d</span><span class="p">[</span><span class="s1">&#39;type&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;humidity&#39;</span><span class="p">]</span>

        <span class="n">summary</span> <span class="o">=</span> <span class="p">{}</span>

        <span class="k">if</span> <span class="n">temps</span><span class="p">:</span>
            <span class="n">summary</span><span class="p">[</span><span class="s1">&#39;temperature&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
                <span class="s1">&#39;min&#39;</span><span class="p">:</span> <span class="nb">min</span><span class="p">(</span><span class="n">temps</span><span class="p">),</span>
                <span class="s1">&#39;max&#39;</span><span class="p">:</span> <span class="nb">max</span><span class="p">(</span><span class="n">temps</span><span class="p">),</span>
                <span class="s1">&#39;avg&#39;</span><span class="p">:</span> <span class="nb">sum</span><span class="p">(</span><span class="n">temps</span><span class="p">)</span> <span class="o">/</span> <span class="nb">len</span><span class="p">(</span><span class="n">temps</span><span class="p">),</span>
                <span class="s1">&#39;count&#39;</span><span class="p">:</span> <span class="nb">len</span><span class="p">(</span><span class="n">temps</span><span class="p">)</span>
            <span class="p">}</span>

        <span class="k">if</span> <span class="n">humids</span><span class="p">:</span>
            <span class="n">summary</span><span class="p">[</span><span class="s1">&#39;humidity&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
                <span class="s1">&#39;min&#39;</span><span class="p">:</span> <span class="nb">min</span><span class="p">(</span><span class="n">humids</span><span class="p">),</span>
                <span class="s1">&#39;max&#39;</span><span class="p">:</span> <span class="nb">max</span><span class="p">(</span><span class="n">humids</span><span class="p">),</span>
                <span class="s1">&#39;avg&#39;</span><span class="p">:</span> <span class="nb">sum</span><span class="p">(</span><span class="n">humids</span><span class="p">)</span> <span class="o">/</span> <span class="nb">len</span><span class="p">(</span><span class="n">humids</span><span class="p">),</span>
                <span class="s1">&#39;count&#39;</span><span class="p">:</span> <span class="nb">len</span><span class="p">(</span><span class="n">humids</span><span class="p">)</span>
            <span class="p">}</span>

        <span class="k">return</span> <span class="n">summary</span>

<span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s2">&quot;__main__&quot;</span><span class="p">:</span>
    <span class="c1"># ì¥ì¹˜ ì´ë¦„ìœ¼ë¡œ ê²€ìƒ‰</span>
    <span class="n">monitor</span> <span class="o">=</span> <span class="n">BLESensorMonitor</span><span class="p">(</span><span class="n">device_name</span><span class="o">=</span><span class="s2">&quot;EnvSensor&quot;</span><span class="p">)</span>

    <span class="c1"># ë˜ëŠ” MAC ì£¼ì†Œë¡œ ì§ì ‘ ì§€ì •</span>
    <span class="c1"># monitor = BLESensorMonitor(device_address=&quot;AA:BB:CC:DD:EE:FF&quot;)</span>

    <span class="k">try</span><span class="p">:</span>
        <span class="n">asyncio</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">monitor</span><span class="o">.</span><span class="n">start_monitoring</span><span class="p">(</span><span class="n">duration</span><span class="o">=</span><span class="mi">30</span><span class="p">))</span>
    <span class="k">except</span> <span class="ne">KeyboardInterrupt</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">ì‚¬ìš©ì ì¤‘ë‹¨&quot;</span><span class="p">)</span>

    <span class="c1"># ìš”ì•½ ì¶œë ¥</span>
    <span class="n">summary</span> <span class="o">=</span> <span class="n">monitor</span><span class="o">.</span><span class="n">get_summary</span><span class="p">()</span>
    <span class="k">if</span> <span class="n">summary</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">=== ë°ì´í„° ìš”ì•½ ===&quot;</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">sensor</span><span class="p">,</span> <span class="n">stats</span> <span class="ow">in</span> <span class="n">summary</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">sensor</span><span class="si">}</span><span class="s2">:&quot;</span><span class="p">)</span>
            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  ìµœì†Œ: </span><span class="si">{</span><span class="n">stats</span><span class="p">[</span><span class="s1">&#39;min&#39;</span><span class="p">]</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  ìµœëŒ€: </span><span class="si">{</span><span class="n">stats</span><span class="p">[</span><span class="s1">&#39;max&#39;</span><span class="p">]</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  í‰ê· : </span><span class="si">{</span><span class="n">stats</span><span class="p">[</span><span class="s1">&#39;avg&#39;</span><span class="p">]</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</code></pre></div>

<hr />
<h2 id="_2">ì—°ìŠµ ë¬¸ì œ<a class="header-link" href="#_2" title="Permanent link">&para;</a></h2>
<h3 id="1-ble_1">ë¬¸ì œ 1: BLE ìŠ¤ìºë„ˆ<a class="header-link" href="#1-ble_1" title="Permanent link">&para;</a></h3>
<ol>
<li>ì£¼ë³€ BLE ì¥ì¹˜ë¥¼ ìŠ¤ìº”í•˜ëŠ” í”„ë¡œê·¸ë¨ì„ ì‘ì„±í•˜ì„¸ìš”.</li>
<li>RSSI ê°’ ê¸°ì¤€ìœ¼ë¡œ ì •ë ¬í•˜ì—¬ ì¶œë ¥í•˜ì„¸ìš”.</li>
</ol>
<h3 id="2">ë¬¸ì œ 2: ì‹¬ë°•ìˆ˜ ëª¨ë‹ˆí„°<a class="header-link" href="#2" title="Permanent link">&para;</a></h3>
<ol>
<li>ì‹¬ë°•ìˆ˜ ì„¼ì„œ(Heart Rate Service: 0x180D)ì— ì—°ê²°í•˜ì„¸ìš”.</li>
<li>ì‹¤ì‹œê°„ ì‹¬ë°•ìˆ˜ë¥¼ ì½˜ì†”ì— ì¶œë ¥í•˜ì„¸ìš”.</li>
</ol>
<h3 id="3">ë¬¸ì œ 3: ë°ì´í„° ë¡œê¹…<a class="header-link" href="#3" title="Permanent link">&para;</a></h3>
<ol>
<li>BLE ì˜¨ë„ ì„¼ì„œ ë°ì´í„°ë¥¼ ìˆ˜ì‹ í•˜ì„¸ìš”.</li>
<li>ë°ì´í„°ë¥¼ CSV íŒŒì¼ì— ì €ì¥í•˜ì„¸ìš”.</li>
</ol>
<hr />
<h2 id="_3">ë‹¤ìŒ ë‹¨ê³„<a class="header-link" href="#_3" title="Permanent link">&para;</a></h2>
<ul>
<li><a href="06_MQTT_Protocol.md">06_MQTT_Protocol.md</a>: BLE ë°ì´í„°ë¥¼ MQTTë¡œ ì „ì†¡</li>
<li><a href="10_Home_Automation_Project.md">10_Home_Automation_Project.md</a>: BLE ìŠ¤ë§ˆíŠ¸í™ˆ í”„ë¡œì íŠ¸</li>
</ul>
<hr />
<p><em>ìµœì¢… ì—…ë°ì´íŠ¸: 2026-02-01</em></p>
    </div>

    
<div class="lesson-toolbar lesson-toolbar--bottom">
    <div class="toolbar-nav toolbar-nav--prev">
        
        <a href="/study/ko/IoT_Embedded/04_WiFi_Networking.html" class="nav-prev">
            <span class="nav-label">Previous</span>
            <span class="nav-title">04. WiFi ë„¤íŠ¸ì›Œí‚¹</span>
        </a>
        
    </div>
    <div class="toolbar-actions">
        <button class="btn btn-copy-link" data-action="copy-link" title="Copy link">
            <span class="icon">ğŸ”—</span>
            <span class="text">Copy link</span>
        </button>
        <a href="/study/ko/IoT_Embedded/" class="btn btn-topic-link" title="Back to topic list">
            <span class="icon">ğŸ“‹</span>
            <span class="text">Topic list</span>
        </a>
    </div>
    <div class="toolbar-nav toolbar-nav--next">
        
        <a href="/study/ko/IoT_Embedded/06_MQTT_Protocol.html" class="nav-next">
            <span class="nav-label">Next</span>
            <span class="nav-title">06. MQTT í”„ë¡œí† ì½œ</span>
        </a>
        
    </div>
</div>


    <div class="toolbar-keyboard-hint">
        <kbd>&larr;</kbd> <kbd>&rarr;</kbd> to navigate between lessons
    </div>
</article>

<!-- Scroll to top floating button -->
<button class="scroll-to-top" id="scroll-to-top" title="Scroll to top" aria-label="Scroll to top">â†‘</button>

            </div>
        </main>
    </div>

    <script src="/study/static/js/app.js"></script>
    <script>
        function switchLanguage(newLang) {
            const path = window.location.pathname;
            const base = '/study';
            const currentLang = 'ko';
            const newPath = path.replace(base + '/' + currentLang + '/', base + '/' + newLang + '/');
            window.location.href = newPath + window.location.search;
        }
    </script>
    
<script>
    document.addEventListener('DOMContentLoaded', function() {
        // Copy link - independent feedback per button
        document.querySelectorAll('[data-action="copy-link"]').forEach(function(btn) {
            btn.addEventListener('click', function() {
                navigator.clipboard.writeText(window.location.href);
                var textEl = this.querySelector('.text');
                var originalText = textEl.textContent;
                textEl.textContent = 'Copied!';
                setTimeout(function() { textEl.textContent = originalText; }, 2000);
            });
        });

        // Add copy buttons to code blocks
        document.querySelectorAll('.lesson-content pre').forEach(function(pre) {
            var copyBtn = document.createElement('button');
            copyBtn.className = 'code-copy-btn';
            copyBtn.textContent = 'Copy';
            copyBtn.addEventListener('click', function() {
                var code = pre.querySelector('code');
                var text = code ? code.textContent : pre.textContent;
                navigator.clipboard.writeText(text);
                copyBtn.textContent = 'Copied!';
                setTimeout(function() { copyBtn.textContent = 'Copy'; }, 2000);
            });
            pre.style.position = 'relative';
            pre.appendChild(copyBtn);
        });

        // Scroll to top button
        var scrollBtn = document.getElementById('scroll-to-top');
        window.addEventListener('scroll', function() {
            scrollBtn.classList.toggle('visible', window.scrollY > 300);
        });
        scrollBtn.addEventListener('click', function() {
            window.scrollTo({ top: 0, behavior: 'smooth' });
        });

        // Keyboard shortcuts: left/right arrows for lesson navigation
        document.addEventListener('keydown', function(e) {
            var tag = document.activeElement.tagName;
            if (tag === 'INPUT' || tag === 'TEXTAREA' || tag === 'SELECT') return;

            if (e.key === 'ArrowLeft') {
                var prevLink = document.querySelector('.nav-prev');
                if (prevLink) prevLink.click();
            } else if (e.key === 'ArrowRight') {
                var nextLink = document.querySelector('.nav-next');
                if (nextLink) nextLink.click();
            }
        });
    });
</script>

</body>
</html>
{% endraw %}