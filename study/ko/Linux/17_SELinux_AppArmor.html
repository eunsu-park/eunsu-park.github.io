{% raw %}
<!DOCTYPE html>
<html lang="ko" data-theme="light">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SELinuxì™€ AppArmor - Study Materials</title>
    <link rel="stylesheet" href="/study/static/css/style.css">
    <link rel="stylesheet" href="/study/static/css/highlight.css">
    <!-- KaTeX for LaTeX math rendering -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.16.11/dist/katex.min.css">
    <script defer src="https://cdn.jsdelivr.net/npm/katex@0.16.11/dist/katex.min.js"></script>
    <script defer src="https://cdn.jsdelivr.net/npm/katex@0.16.11/dist/contrib/auto-render.min.js"
        onload="renderMathInElement(document.body, {
            delimiters: [
                {left: '$$', right: '$$', display: true},
                {left: '$', right: '$', display: false}
            ],
            throwOnError: false
        });"></script>
    
</head>
<body>
    <div class="app-container">
        <!-- Sidebar -->
        <aside class="sidebar" id="sidebar">
            <div class="sidebar-header">
                <a href="/study/ko/" class="logo">Study Materials</a>
                <button class="sidebar-toggle" id="sidebar-toggle" aria-label="Toggle sidebar">
                    <span></span>
                </button>
            </div>

            <nav class="sidebar-nav">
                <a href="/study/ko/" class="nav-item ">
                    <span class="nav-icon">ğŸ </span>
                    <span class="nav-text">Home</span>
                </a>
                <a href="/study/examples/" class="nav-item ">
                    <span class="nav-icon">ğŸ’»</span>
                    <span class="nav-text">Examples</span>
                </a>
            </nav>

            <div class="sidebar-search">
                <form action="/study/ko/search.html" method="get" id="search-form">
                    <input type="search" name="q" placeholder="Search..." id="search-sidebar-input">
                </form>
            </div>

            <!-- Language Selector -->
            <div class="sidebar-lang">
                <select id="lang-select" class="lang-selector" onchange="switchLanguage(this.value)">
                    
                    <option value="en" >
                        English
                    </option>
                    
                    <option value="ko" selected>
                        í•œêµ­ì–´
                    </option>
                    
                </select>
            </div>

            <div class="sidebar-footer">
                <button class="theme-toggle" id="theme-toggle" aria-label="Toggle theme">
                    <span class="theme-icon light">â˜€ï¸</span>
                    <span class="theme-icon dark">ğŸŒ™</span>
                </button>
            </div>
        </aside>

        <!-- Main Content -->
        <main class="main-content">
            <header class="main-header">
                <button class="menu-toggle" id="menu-toggle" aria-label="Open menu">
                    <span></span>
                </button>
                
<nav class="breadcrumb">
    <a href="/study/ko/">Topics</a>
    <span class="separator">/</span>
    <a href="/study/ko/Linux/">Linux</a>
    <span class="separator">/</span>
    <span class="current">SELinuxì™€ AppArmor</span>
</nav>

            </header>

            <div class="content">
                
<article class="lesson-article">
    <header class="lesson-header">
        <h1>SELinuxì™€ AppArmor</h1>
    </header>

    
<div class="lesson-toolbar lesson-toolbar--top">
    <div class="toolbar-nav toolbar-nav--prev">
        
        <a href="/study/ko/Linux/16_Storage_Management.html" class="nav-prev">
            <span class="nav-label">Previous</span>
            <span class="nav-title">16. ì €ì¥ì†Œ ê´€ë¦¬</span>
        </a>
        
    </div>
    <div class="toolbar-actions">
        <button class="btn btn-copy-link" data-action="copy-link" title="Copy link">
            <span class="icon">ğŸ”—</span>
            <span class="text">Copy link</span>
        </button>
        <a href="/study/ko/Linux/" class="btn btn-topic-link" title="Back to topic list">
            <span class="icon">ğŸ“‹</span>
            <span class="text">Topic list</span>
        </a>
    </div>
    <div class="toolbar-nav toolbar-nav--next">
        
        <a href="/study/ko/Linux/18_Log_Management.html" class="nav-next">
            <span class="nav-label">Next</span>
            <span class="nav-title">ë¡œê·¸ ê´€ë¦¬</span>
        </a>
        
    </div>
</div>


    
    <nav class="toc" id="toc">
        <h2>Table of Contents</h2>
        <div class="toc">
<ul>
<li><a href="#_1">í•™ìŠµ ëª©í‘œ</a></li>
<li><a href="#_2">ëª©ì°¨</a></li>
<li><a href="#1">1. í•„ìˆ˜ ì ‘ê·¼ ì œì–´ ê°œìš”</a><ul>
<li><a href="#dac-vs-mac">DAC vs MAC</a></li>
<li><a href="#_3">ë³´ì•ˆ ëª¨ë“ˆ ë¹„êµ</a></li>
</ul>
</li>
<li><a href="#2-selinux">2. SELinux ê¸°ì´ˆ</a><ul>
<li><a href="#selinux">SELinux ëª¨ë“œ</a></li>
<li><a href="#_4">ì˜êµ¬ì  ëª¨ë“œ ë³€ê²½</a></li>
<li><a href="#selinux_1">SELinux ì»¨í…ìŠ¤íŠ¸</a></li>
<li><a href="#_5">ì£¼ìš” íƒ€ì…</a></li>
</ul>
</li>
<li><a href="#3-selinux">3. SELinux ì •ì±… ê´€ë¦¬</a><ul>
<li><a href="#_6">íŒŒì¼ ì»¨í…ìŠ¤íŠ¸ ë³€ê²½</a></li>
<li><a href="#_7">ì˜êµ¬ì  ì»¨í…ìŠ¤íŠ¸ ì„¤ì •</a></li>
<li><a href="#selinux_2">SELinux ë¶ˆë¦¬ì–¸</a></li>
<li><a href="#_8">ì£¼ìš” ë¶ˆë¦¬ì–¸ ì˜ˆì‹œ</a></li>
<li><a href="#_9">í¬íŠ¸ ì»¨í…ìŠ¤íŠ¸</a></li>
</ul>
</li>
<li><a href="#4-selinux">4. SELinux íŠ¸ëŸ¬ë¸”ìŠˆíŒ…</a><ul>
<li><a href="#_10">ê°ì‚¬ ë¡œê·¸ í™•ì¸</a></li>
<li><a href="#audit2why">audit2why ì‚¬ìš©</a></li>
<li><a href="#audit2allow">audit2allowë¡œ ì •ì±… ìƒì„±</a></li>
<li><a href="#sealert-gui">sealert ì‚¬ìš© (GUI/ìƒì„¸ ë¶„ì„)</a></li>
<li><a href="#_11">ì¼ë°˜ì ì¸ ë¬¸ì œ í•´ê²°</a></li>
</ul>
</li>
<li><a href="#5-apparmor">5. AppArmor ê¸°ì´ˆ</a><ul>
<li><a href="#apparmor">AppArmor ìƒíƒœ í™•ì¸</a></li>
<li><a href="#apparmor_1">AppArmor ëª¨ë“œ</a></li>
<li><a href="#_12">í”„ë¡œíŒŒì¼ ìœ„ì¹˜</a></li>
</ul>
</li>
<li><a href="#6-apparmor">6. AppArmor í”„ë¡œíŒŒì¼</a><ul>
<li><a href="#_13">í”„ë¡œíŒŒì¼ êµ¬ì¡°</a></li>
<li><a href="#_14">ê¶Œí•œ í”Œë˜ê·¸</a></li>
<li><a href="#_15">í”„ë¡œíŒŒì¼ ì‘ì„± ì˜ˆì‹œ</a></li>
<li><a href="#_16">ìë™ í”„ë¡œíŒŒì¼ ìƒì„±</a></li>
<li><a href="#abstractions">Abstractions ì‚¬ìš©</a></li>
</ul>
</li>
<li><a href="#7">7. ì‹¤ë¬´ ì‹œë‚˜ë¦¬ì˜¤</a><ul>
<li><a href="#1-selinux">ì‹œë‚˜ë¦¬ì˜¤ 1: ì›¹ ì„œë²„ ì»¤ìŠ¤í…€ ë””ë ‰í† ë¦¬ (SELinux)</a></li>
<li><a href="#2-php-db-selinux">ì‹œë‚˜ë¦¬ì˜¤ 2: PHP ì• í”Œë¦¬ì¼€ì´ì…˜ DB ì—°ê²° (SELinux)</a></li>
<li><a href="#3-nginx-apparmor">ì‹œë‚˜ë¦¬ì˜¤ 3: Nginx ì»¤ìŠ¤í…€ í¬íŠ¸ (AppArmor)</a></li>
<li><a href="#4-docker-selinux">ì‹œë‚˜ë¦¬ì˜¤ 4: Dockerì™€ SELinux</a></li>
<li><a href="#5-apparmor_1">ì‹œë‚˜ë¦¬ì˜¤ 5: ìƒˆ ì„œë¹„ìŠ¤ í”„ë¡œíŒŒì¼ ìƒì„± (AppArmor)</a></li>
</ul>
</li>
<li><a href="#_17">ì—°ìŠµ ë¬¸ì œ</a><ul>
<li><a href="#1-selinux_1">ë¬¸ì œ 1: SELinux ì»¨í…ìŠ¤íŠ¸</a></li>
<li><a href="#2-apparmor">ë¬¸ì œ 2: AppArmor í”„ë¡œíŒŒì¼</a></li>
<li><a href="#3">ë¬¸ì œ 3: íŠ¸ëŸ¬ë¸”ìŠˆíŒ…</a></li>
</ul>
</li>
<li><a href="#_18">ì •ë‹µ</a><ul>
<li><a href="#1_1">ë¬¸ì œ 1 ì •ë‹µ</a></li>
<li><a href="#2">ë¬¸ì œ 2 ì •ë‹µ</a></li>
<li><a href="#3_1">ë¬¸ì œ 3 ì •ë‹µ</a></li>
</ul>
</li>
<li><a href="#_19">ë‹¤ìŒ ë‹¨ê³„</a></li>
<li><a href="#_20">ì°¸ê³  ìë£Œ</a></li>
</ul>
</div>

    </nav>
    

    <div class="lesson-content markdown-body">
        <h1 id="selinux-apparmor">SELinuxì™€ AppArmor<a class="header-link" href="#selinux-apparmor" title="Permanent link">&para;</a></h1>
<h2 id="_1">í•™ìŠµ ëª©í‘œ<a class="header-link" href="#_1" title="Permanent link">&para;</a></h2>
<p>ì´ ë¬¸ì„œë¥¼ í†µí•´ ë‹¤ìŒì„ í•™ìŠµí•©ë‹ˆë‹¤:</p>
<ul>
<li>í•„ìˆ˜ ì ‘ê·¼ ì œì–´(MAC)ì˜ ê°œë…ê³¼ í•„ìš”ì„±</li>
<li>SELinux ëª¨ë“œì™€ ì •ì±… ê´€ë¦¬</li>
<li>AppArmor í”„ë¡œíŒŒì¼ ì‘ì„± ë° ê´€ë¦¬</li>
<li>ë³´ì•ˆ ëª¨ë“ˆ íŠ¸ëŸ¬ë¸”ìŠˆíŒ…</li>
</ul>
<p><strong>ë‚œì´ë„</strong>: â­â­â­â­ (ê³ ê¸‰)</p>
<hr />
<h2 id="_2">ëª©ì°¨<a class="header-link" href="#_2" title="Permanent link">&para;</a></h2>
<ol>
<li><a href="#1-í•„ìˆ˜-ì ‘ê·¼-ì œì–´-ê°œìš”">í•„ìˆ˜ ì ‘ê·¼ ì œì–´ ê°œìš”</a></li>
<li><a href="#2-selinux-ê¸°ì´ˆ">SELinux ê¸°ì´ˆ</a></li>
<li><a href="#3-selinux-ì •ì±…-ê´€ë¦¬">SELinux ì •ì±… ê´€ë¦¬</a></li>
<li><a href="#4-selinux-íŠ¸ëŸ¬ë¸”ìŠˆíŒ…">SELinux íŠ¸ëŸ¬ë¸”ìŠˆíŒ…</a></li>
<li><a href="#5-apparmor-ê¸°ì´ˆ">AppArmor ê¸°ì´ˆ</a></li>
<li><a href="#6-apparmor-í”„ë¡œíŒŒì¼">AppArmor í”„ë¡œíŒŒì¼</a></li>
<li><a href="#7-ì‹¤ë¬´-ì‹œë‚˜ë¦¬ì˜¤">ì‹¤ë¬´ ì‹œë‚˜ë¦¬ì˜¤</a></li>
</ol>
<hr />
<h2 id="1">1. í•„ìˆ˜ ì ‘ê·¼ ì œì–´ ê°œìš”<a class="header-link" href="#1" title="Permanent link">&para;</a></h2>
<h3 id="dac-vs-mac">DAC vs MAC<a class="header-link" href="#dac-vs-mac" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code>â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    ì ‘ê·¼ ì œì–´ ë¹„êµ                            â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  DAC (Discretionary Access Control)                         â”‚
â”‚  - ì „í†µì ì¸ Unix ê¶Œí•œ ëª¨ë¸                                  â”‚
â”‚  - íŒŒì¼ ì†Œìœ ìê°€ ê¶Œí•œ ê²°ì •                                  â”‚
â”‚  - chmod, chownìœ¼ë¡œ ê´€ë¦¬                                    â”‚
â”‚  - rootëŠ” ëª¨ë“  ì œí•œ ìš°íšŒ ê°€ëŠ¥                               â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  MAC (Mandatory Access Control)                             â”‚
â”‚  - ì‹œìŠ¤í…œ ì •ì±…ì´ ì ‘ê·¼ ê²°ì •                                  â”‚
â”‚  - ì‚¬ìš©ìê°€ ì •ì±… ë³€ê²½ ë¶ˆê°€                                  â”‚
â”‚  - SELinux, AppArmorë¡œ êµ¬í˜„                                 â”‚
â”‚  - rootë„ ì •ì±…ì— ì˜í•´ ì œí•œë¨                                â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
</code></pre></div>

<h3 id="_3">ë³´ì•ˆ ëª¨ë“ˆ ë¹„êµ<a class="header-link" href="#_3" title="Permanent link">&para;</a></h3>
<table>
<thead>
<tr>
<th>íŠ¹ì„±</th>
<th>SELinux</th>
<th>AppArmor</th>
</tr>
</thead>
<tbody>
<tr>
<td>ê¸°ë°˜ ë°°í¬íŒ</td>
<td>RHEL/CentOS/Fedora</td>
<td>Ubuntu/Debian/SUSE</td>
</tr>
<tr>
<td>ì ‘ê·¼ ë°©ì‹</td>
<td>ë ˆì´ë¸” ê¸°ë°˜</td>
<td>ê²½ë¡œ ê¸°ë°˜</td>
</tr>
<tr>
<td>ë³µì¡ë„</td>
<td>ë†’ìŒ</td>
<td>ë‚®ìŒ</td>
</tr>
<tr>
<td>ì„¸ë°€í•¨</td>
<td>ë§¤ìš° ì„¸ë°€</td>
<td>ì¤‘ê°„</td>
</tr>
<tr>
<td>í•™ìŠµ ê³¡ì„ </td>
<td>ê°€íŒŒë¦„</td>
<td>ì™„ë§Œ</td>
</tr>
<tr>
<td>ê¸°ë³¸ ì •ì±…</td>
<td>í¬ê´„ì </td>
<td>ì œí•œì </td>
</tr>
</tbody>
</table>
<hr />
<h2 id="2-selinux">2. SELinux ê¸°ì´ˆ<a class="header-link" href="#2-selinux" title="Permanent link">&para;</a></h2>
<h3 id="selinux">SELinux ëª¨ë“œ<a class="header-link" href="#selinux" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><span class="c1"># í˜„ì¬ ëª¨ë“œ í™•ì¸</span>
getenforce
<span class="c1"># Enforcing, Permissive, ë˜ëŠ” Disabled</span>

<span class="c1"># ìƒì„¸ ìƒíƒœ í™•ì¸</span>
sestatus

<span class="c1"># ì„ì‹œ ëª¨ë“œ ë³€ê²½ (ì¬ë¶€íŒ… ì‹œ ë³µì›)</span>
sudo<span class="w"> </span>setenforce<span class="w"> </span><span class="m">0</span><span class="w">  </span><span class="c1"># Permissive</span>
sudo<span class="w"> </span>setenforce<span class="w"> </span><span class="m">1</span><span class="w">  </span><span class="c1"># Enforcing</span>
</code></pre></div>

<h3 id="_4">ì˜êµ¬ì  ëª¨ë“œ ë³€ê²½<a class="header-link" href="#_4" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><span class="c1"># /etc/selinux/config í¸ì§‘</span>
<span class="c1"># RHEL/CentOS</span>
sudo<span class="w"> </span>vi<span class="w"> </span>/etc/selinux/config
</code></pre></div>

<div class="highlight"><pre><span></span><code><span class="c1"># /etc/selinux/config</span>
<span class="na">SELINUX</span><span class="o">=</span><span class="s">enforcing</span><span class="w">     </span><span class="c1"># enforcing, permissive, disabled</span>
<span class="na">SELINUXTYPE</span><span class="o">=</span><span class="s">targeted</span><span class="w">  </span><span class="c1"># targeted, minimum, mls</span>
</code></pre></div>

<h3 id="selinux_1">SELinux ì»¨í…ìŠ¤íŠ¸<a class="header-link" href="#selinux_1" title="Permanent link">&para;</a></h3>
<p>ëª¨ë“  íŒŒì¼, í”„ë¡œì„¸ìŠ¤, í¬íŠ¸ì— ë³´ì•ˆ ì»¨í…ìŠ¤íŠ¸ê°€ í• ë‹¹ë©ë‹ˆë‹¤:</p>
<div class="highlight"><pre><span></span><code><span class="err">ì‚¬ìš©ì</span><span class="o">:</span><span class="err">ì—­í• </span><span class="o">:</span><span class="err">íƒ€ì…</span><span class="o">:</span><span class="err">ë ˆë²¨</span>
<span class="n">user_u</span><span class="o">:</span><span class="n">role_r</span><span class="o">:</span><span class="n">type_t</span><span class="o">:</span><span class="n">s0</span>
</code></pre></div>

<div class="highlight"><pre><span></span><code><span class="c1"># íŒŒì¼ ì»¨í…ìŠ¤íŠ¸ í™•ì¸</span>
ls<span class="w"> </span>-Z<span class="w"> </span>/var/www/html/
<span class="c1"># -rw-r--r--. root root unconfined_u:object_r:httpd_sys_content_t:s0 index.html</span>

<span class="c1"># í”„ë¡œì„¸ìŠ¤ ì»¨í…ìŠ¤íŠ¸ í™•ì¸</span>
ps<span class="w"> </span>-eZ<span class="w"> </span><span class="p">|</span><span class="w"> </span>grep<span class="w"> </span>httpd
<span class="c1"># system_u:system_r:httpd_t:s0    12345 ?  00:00:01 httpd</span>

<span class="c1"># ì‚¬ìš©ì ì»¨í…ìŠ¤íŠ¸ í™•ì¸</span>
id<span class="w"> </span>-Z
<span class="c1"># unconfined_u:unconfined_r:unconfined_t:s0-s0:c0.c1023</span>
</code></pre></div>

<h3 id="_5">ì£¼ìš” íƒ€ì…<a class="header-link" href="#_5" title="Permanent link">&para;</a></h3>
<table>
<thead>
<tr>
<th>íƒ€ì…</th>
<th>ì„¤ëª…</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>httpd_t</code></td>
<td>Apache ì›¹ ì„œë²„ í”„ë¡œì„¸ìŠ¤</td>
</tr>
<tr>
<td><code>httpd_sys_content_t</code></td>
<td>ì›¹ ì½˜í…ì¸  íŒŒì¼</td>
</tr>
<tr>
<td><code>mysqld_t</code></td>
<td>MySQL í”„ë¡œì„¸ìŠ¤</td>
</tr>
<tr>
<td><code>sshd_t</code></td>
<td>SSH ë°ëª¬</td>
</tr>
<tr>
<td><code>user_home_t</code></td>
<td>ì‚¬ìš©ì í™ˆ ë””ë ‰í† ë¦¬</td>
</tr>
<tr>
<td><code>tmp_t</code></td>
<td>ì„ì‹œ íŒŒì¼</td>
</tr>
</tbody>
</table>
<hr />
<h2 id="3-selinux">3. SELinux ì •ì±… ê´€ë¦¬<a class="header-link" href="#3-selinux" title="Permanent link">&para;</a></h2>
<h3 id="_6">íŒŒì¼ ì»¨í…ìŠ¤íŠ¸ ë³€ê²½<a class="header-link" href="#_6" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><span class="c1"># ì„ì‹œ ë³€ê²½ (ì¬ë ˆì´ë¸”ë§ ì‹œ ë³µì›)</span>
chcon<span class="w"> </span>-t<span class="w"> </span>httpd_sys_content_t<span class="w"> </span>/var/www/custom/index.html

<span class="c1"># ë””ë ‰í† ë¦¬ ì¬ê·€ì  ë³€ê²½</span>
chcon<span class="w"> </span>-R<span class="w"> </span>-t<span class="w"> </span>httpd_sys_content_t<span class="w"> </span>/var/www/custom/

<span class="c1"># ë‹¤ë¥¸ íŒŒì¼ì˜ ì»¨í…ìŠ¤íŠ¸ ë³µì‚¬</span>
chcon<span class="w"> </span>--reference<span class="o">=</span>/var/www/html/index.html<span class="w"> </span>/var/www/custom/index.html
</code></pre></div>

<h3 id="_7">ì˜êµ¬ì  ì»¨í…ìŠ¤íŠ¸ ì„¤ì •<a class="header-link" href="#_7" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><span class="c1"># ì •ì±…ì— ì»¨í…ìŠ¤íŠ¸ ê·œì¹™ ì¶”ê°€</span>
sudo<span class="w"> </span>semanage<span class="w"> </span>fcontext<span class="w"> </span>-a<span class="w"> </span>-t<span class="w"> </span>httpd_sys_content_t<span class="w"> </span><span class="s2">&quot;/srv/www(/.*)?&quot;</span>

<span class="c1"># ì •ì±… ì ìš©</span>
sudo<span class="w"> </span>restorecon<span class="w"> </span>-Rv<span class="w"> </span>/srv/www

<span class="c1"># ì»¨í…ìŠ¤íŠ¸ ê·œì¹™ ëª©ë¡ í™•ì¸</span>
sudo<span class="w"> </span>semanage<span class="w"> </span>fcontext<span class="w"> </span>-l<span class="w"> </span><span class="p">|</span><span class="w"> </span>grep<span class="w"> </span>httpd

<span class="c1"># ê·œì¹™ ì‚­ì œ</span>
sudo<span class="w"> </span>semanage<span class="w"> </span>fcontext<span class="w"> </span>-d<span class="w"> </span><span class="s2">&quot;/srv/www(/.*)?&quot;</span>
</code></pre></div>

<h3 id="selinux_2">SELinux ë¶ˆë¦¬ì–¸<a class="header-link" href="#selinux_2" title="Permanent link">&para;</a></h3>
<p>ë¶ˆë¦¬ì–¸ì€ SELinux ì •ì±…ì˜ íŠ¹ì • ê¸°ëŠ¥ì„ ì¼œê³  ë„ëŠ” ìŠ¤ìœ„ì¹˜ì…ë‹ˆë‹¤:</p>
<div class="highlight"><pre><span></span><code><span class="c1"># ëª¨ë“  ë¶ˆë¦¬ì–¸ ëª©ë¡</span>
getsebool<span class="w"> </span>-a

<span class="c1"># íŠ¹ì • ë¶ˆë¦¬ì–¸ í™•ì¸</span>
getsebool<span class="w"> </span>httpd_can_network_connect

<span class="c1"># ì„ì‹œ ë³€ê²½</span>
sudo<span class="w"> </span>setsebool<span class="w"> </span>httpd_can_network_connect<span class="w"> </span>on

<span class="c1"># ì˜êµ¬ ë³€ê²½ (-P ì˜µì…˜)</span>
sudo<span class="w"> </span>setsebool<span class="w"> </span>-P<span class="w"> </span>httpd_can_network_connect<span class="w"> </span>on

<span class="c1"># ë¶ˆë¦¬ì–¸ ê²€ìƒ‰</span>
getsebool<span class="w"> </span>-a<span class="w"> </span><span class="p">|</span><span class="w"> </span>grep<span class="w"> </span>httpd
</code></pre></div>

<h3 id="_8">ì£¼ìš” ë¶ˆë¦¬ì–¸ ì˜ˆì‹œ<a class="header-link" href="#_8" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><span class="c1"># ì›¹ ì„œë²„ ê´€ë ¨</span>
httpd_can_network_connect<span class="w">      </span><span class="c1"># ì™¸ë¶€ ë„¤íŠ¸ì›Œí¬ ì—°ê²° í—ˆìš©</span>
httpd_can_network_connect_db<span class="w">   </span><span class="c1"># DB ì—°ê²° í—ˆìš©</span>
httpd_can_sendmail<span class="w">            </span><span class="c1"># ë©”ì¼ ì „ì†¡ í—ˆìš©</span>
httpd_enable_homedirs<span class="w">         </span><span class="c1"># ì‚¬ìš©ì í™ˆ ë””ë ‰í† ë¦¬ ì ‘ê·¼</span>

<span class="c1"># FTP ê´€ë ¨</span>
ftpd_anon_write<span class="w">              </span><span class="c1"># ìµëª… ì“°ê¸° í—ˆìš©</span>
ftpd_full_access<span class="w">             </span><span class="c1"># ì „ì²´ íŒŒì¼ì‹œìŠ¤í…œ ì ‘ê·¼</span>

<span class="c1"># ê¸°íƒ€</span>
samba_enable_home_dirs<span class="w">       </span><span class="c1"># Samba í™ˆ ë””ë ‰í† ë¦¬ ê³µìœ </span>
</code></pre></div>

<h3 id="_9">í¬íŠ¸ ì»¨í…ìŠ¤íŠ¸<a class="header-link" href="#_9" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><span class="c1"># í¬íŠ¸ ë ˆì´ë¸” í™•ì¸</span>
sudo<span class="w"> </span>semanage<span class="w"> </span>port<span class="w"> </span>-l<span class="w"> </span><span class="p">|</span><span class="w"> </span>grep<span class="w"> </span>http
<span class="c1"># http_port_t                    tcp      80, 81, 443, 488, 8008, 8009, 8443, 9000</span>

<span class="c1"># ìƒˆ í¬íŠ¸ ì¶”ê°€</span>
sudo<span class="w"> </span>semanage<span class="w"> </span>port<span class="w"> </span>-a<span class="w"> </span>-t<span class="w"> </span>http_port_t<span class="w"> </span>-p<span class="w"> </span>tcp<span class="w"> </span><span class="m">8080</span>

<span class="c1"># í¬íŠ¸ ì‚­ì œ</span>
sudo<span class="w"> </span>semanage<span class="w"> </span>port<span class="w"> </span>-d<span class="w"> </span>-t<span class="w"> </span>http_port_t<span class="w"> </span>-p<span class="w"> </span>tcp<span class="w"> </span><span class="m">8080</span>

<span class="c1"># í¬íŠ¸ ìˆ˜ì •</span>
sudo<span class="w"> </span>semanage<span class="w"> </span>port<span class="w"> </span>-m<span class="w"> </span>-t<span class="w"> </span>http_port_t<span class="w"> </span>-p<span class="w"> </span>tcp<span class="w"> </span><span class="m">8888</span>
</code></pre></div>

<hr />
<h2 id="4-selinux">4. SELinux íŠ¸ëŸ¬ë¸”ìŠˆíŒ…<a class="header-link" href="#4-selinux" title="Permanent link">&para;</a></h2>
<h3 id="_10">ê°ì‚¬ ë¡œê·¸ í™•ì¸<a class="header-link" href="#_10" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><span class="c1"># SELinux ê±°ë¶€ ë¡œê·¸ í™•ì¸</span>
sudo<span class="w"> </span>ausearch<span class="w"> </span>-m<span class="w"> </span>avc<span class="w"> </span>-ts<span class="w"> </span>recent

<span class="c1"># íŠ¹ì • ì„œë¹„ìŠ¤ ê´€ë ¨ ë¡œê·¸</span>
sudo<span class="w"> </span>ausearch<span class="w"> </span>-m<span class="w"> </span>avc<span class="w"> </span>-c<span class="w"> </span>httpd

<span class="c1"># ì½ê¸° ì‰¬ìš´ í˜•ì‹ìœ¼ë¡œ ë³€í™˜</span>
sudo<span class="w"> </span>ausearch<span class="w"> </span>-m<span class="w"> </span>avc<span class="w"> </span>-ts<span class="w"> </span>recent<span class="w"> </span><span class="p">|</span><span class="w"> </span>audit2why
</code></pre></div>

<h3 id="audit2why">audit2why ì‚¬ìš©<a class="header-link" href="#audit2why" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><span class="c1"># ê±°ë¶€ ì´ìœ  ë¶„ì„</span>
sudo<span class="w"> </span>cat<span class="w"> </span>/var/log/audit/audit.log<span class="w"> </span><span class="p">|</span><span class="w"> </span>audit2why

<span class="c1"># ì˜ˆì‹œ ì¶œë ¥:</span>
<span class="c1"># type=AVC msg=audit(...): avc:  denied  { read } for  pid=1234</span>
<span class="c1"># comm=&quot;httpd&quot; name=&quot;index.html&quot; dev=&quot;sda1&quot; ino=12345</span>
<span class="c1"># scontext=system_u:system_r:httpd_t:s0</span>
<span class="c1"># tcontext=unconfined_u:object_r:user_home_t:s0 tclass=file</span>
<span class="c1">#</span>
<span class="c1"># Was caused by:</span>
<span class="c1">#   Missing type enforcement (TE) allow rule.</span>
</code></pre></div>

<h3 id="audit2allow">audit2allowë¡œ ì •ì±… ìƒì„±<a class="header-link" href="#audit2allow" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><span class="c1"># í—ˆìš© ê·œì¹™ ìƒì„± (í™•ì¸ë§Œ)</span>
sudo<span class="w"> </span>ausearch<span class="w"> </span>-m<span class="w"> </span>avc<span class="w"> </span>-ts<span class="w"> </span>recent<span class="w"> </span><span class="p">|</span><span class="w"> </span>audit2allow

<span class="c1"># ë¡œì»¬ ëª¨ë“ˆë¡œ ì»´íŒŒì¼</span>
sudo<span class="w"> </span>ausearch<span class="w"> </span>-m<span class="w"> </span>avc<span class="w"> </span>-ts<span class="w"> </span>recent<span class="w"> </span><span class="p">|</span><span class="w"> </span>audit2allow<span class="w"> </span>-M<span class="w"> </span>mypolicy

<span class="c1"># ëª¨ë“ˆ ì„¤ì¹˜</span>
sudo<span class="w"> </span>semodule<span class="w"> </span>-i<span class="w"> </span>mypolicy.pp

<span class="c1"># ì„¤ì¹˜ëœ ëª¨ë“ˆ í™•ì¸</span>
sudo<span class="w"> </span>semodule<span class="w"> </span>-l<span class="w"> </span><span class="p">|</span><span class="w"> </span>grep<span class="w"> </span>mypolicy

<span class="c1"># ëª¨ë“ˆ ì œê±°</span>
sudo<span class="w"> </span>semodule<span class="w"> </span>-r<span class="w"> </span>mypolicy
</code></pre></div>

<h3 id="sealert-gui">sealert ì‚¬ìš© (GUI/ìƒì„¸ ë¶„ì„)<a class="header-link" href="#sealert-gui" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><span class="c1"># setroubleshoot íŒ¨í‚¤ì§€ í•„ìš”</span>
sudo<span class="w"> </span>yum<span class="w"> </span>install<span class="w"> </span>setroubleshoot-server

<span class="c1"># ë¶„ì„ ì‹¤í–‰</span>
sudo<span class="w"> </span>sealert<span class="w"> </span>-a<span class="w"> </span>/var/log/audit/audit.log

<span class="c1"># ì‹¤ì‹œê°„ ì•Œë¦¼ í™•ì¸</span>
sudo<span class="w"> </span>sealert<span class="w"> </span>-l<span class="w"> </span><span class="s2">&quot;*&quot;</span>
</code></pre></div>

<h3 id="_11">ì¼ë°˜ì ì¸ ë¬¸ì œ í•´ê²°<a class="header-link" href="#_11" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><span class="c1"># ë¬¸ì œ: ì›¹ ì„œë²„ê°€ íŒŒì¼ì„ ì½ì§€ ëª»í•¨</span>
<span class="c1"># 1. ì»¨í…ìŠ¤íŠ¸ í™•ì¸</span>
ls<span class="w"> </span>-Z<span class="w"> </span>/var/www/html/problem_file

<span class="c1"># 2. ì»¨í…ìŠ¤íŠ¸ ìˆ˜ì •</span>
sudo<span class="w"> </span>restorecon<span class="w"> </span>-v<span class="w"> </span>/var/www/html/problem_file

<span class="c1"># ë¬¸ì œ: ì»¤ìŠ¤í…€ í¬íŠ¸ ì‚¬ìš© ë¶ˆê°€</span>
<span class="c1"># 1. í˜„ì¬ í¬íŠ¸ ë ˆì´ë¸” í™•ì¸</span>
sudo<span class="w"> </span>semanage<span class="w"> </span>port<span class="w"> </span>-l<span class="w"> </span><span class="p">|</span><span class="w"> </span>grep<span class="w"> </span><span class="m">8080</span>

<span class="c1"># 2. í¬íŠ¸ ì¶”ê°€</span>
sudo<span class="w"> </span>semanage<span class="w"> </span>port<span class="w"> </span>-a<span class="w"> </span>-t<span class="w"> </span>http_port_t<span class="w"> </span>-p<span class="w"> </span>tcp<span class="w"> </span><span class="m">8080</span>

<span class="c1"># ë¬¸ì œ: ë„¤íŠ¸ì›Œí¬ ì—°ê²° ê±°ë¶€</span>
<span class="c1"># 1. ê´€ë ¨ ë¶ˆë¦¬ì–¸ í™•ì¸</span>
getsebool<span class="w"> </span>-a<span class="w"> </span><span class="p">|</span><span class="w"> </span>grep<span class="w"> </span>httpd_can_network

<span class="c1"># 2. ë¶ˆë¦¬ì–¸ í™œì„±í™”</span>
sudo<span class="w"> </span>setsebool<span class="w"> </span>-P<span class="w"> </span>httpd_can_network_connect<span class="w"> </span>on
</code></pre></div>

<hr />
<h2 id="5-apparmor">5. AppArmor ê¸°ì´ˆ<a class="header-link" href="#5-apparmor" title="Permanent link">&para;</a></h2>
<h3 id="apparmor">AppArmor ìƒíƒœ í™•ì¸<a class="header-link" href="#apparmor" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><span class="c1"># Ubuntu/Debian</span>
sudo<span class="w"> </span>aa-status

<span class="c1"># ë˜ëŠ”</span>
sudo<span class="w"> </span>apparmor_status
</code></pre></div>

<p>ì˜ˆì‹œ ì¶œë ¥:</p>
<div class="highlight"><pre><span></span><code><span class="n">apparmor</span><span class="w"> </span><span class="n">module</span><span class="w"> </span><span class="k">is</span><span class="w"> </span><span class="n">loaded</span><span class="o">.</span>
<span class="mi">38</span><span class="w"> </span><span class="n">profiles</span><span class="w"> </span><span class="n">are</span><span class="w"> </span><span class="n">loaded</span><span class="o">.</span>
<span class="mi">36</span><span class="w"> </span><span class="n">profiles</span><span class="w"> </span><span class="n">are</span><span class="w"> </span><span class="ow">in</span><span class="w"> </span><span class="n">enforce</span><span class="w"> </span><span class="n">mode</span><span class="o">.</span>
<span class="w">   </span><span class="o">/</span><span class="n">snap</span><span class="o">/</span><span class="n">snapd</span><span class="o">/</span><span class="mi">19457</span><span class="o">/</span><span class="n">usr</span><span class="o">/</span><span class="n">lib</span><span class="o">/</span><span class="n">snapd</span><span class="o">/</span><span class="n">snap</span><span class="o">-</span><span class="n">confine</span>
<span class="w">   </span><span class="o">/</span><span class="n">usr</span><span class="o">/</span><span class="n">bin</span><span class="o">/</span><span class="n">evince</span>
<span class="w">   </span><span class="o">...</span>
<span class="mi">2</span><span class="w"> </span><span class="n">profiles</span><span class="w"> </span><span class="n">are</span><span class="w"> </span><span class="ow">in</span><span class="w"> </span><span class="n">complain</span><span class="w"> </span><span class="n">mode</span><span class="o">.</span>
<span class="w">   </span><span class="o">/</span><span class="n">usr</span><span class="o">/</span><span class="n">sbin</span><span class="o">/</span><span class="n">cups</span><span class="o">-</span><span class="n">browsed</span>
<span class="w">   </span><span class="o">/</span><span class="n">usr</span><span class="o">/</span><span class="n">sbin</span><span class="o">/</span><span class="n">cupsd</span>
</code></pre></div>

<h3 id="apparmor_1">AppArmor ëª¨ë“œ<a class="header-link" href="#apparmor_1" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><span class="c1"># Enforce ëª¨ë“œ: ì •ì±… ìœ„ë°˜ ì°¨ë‹¨</span>
sudo<span class="w"> </span>aa-enforce<span class="w"> </span>/etc/apparmor.d/usr.sbin.nginx

<span class="c1"># Complain ëª¨ë“œ: ìœ„ë°˜ ë¡œê¹…ë§Œ (ì°¨ë‹¨ ì•ˆ í•¨)</span>
sudo<span class="w"> </span>aa-complain<span class="w"> </span>/etc/apparmor.d/usr.sbin.nginx

<span class="c1"># í”„ë¡œíŒŒì¼ ë¹„í™œì„±í™”</span>
sudo<span class="w"> </span>aa-disable<span class="w"> </span>/etc/apparmor.d/usr.sbin.nginx

<span class="c1"># í”„ë¡œíŒŒì¼ ë‹¤ì‹œ ë¡œë“œ</span>
sudo<span class="w"> </span>apparmor_parser<span class="w"> </span>-r<span class="w"> </span>/etc/apparmor.d/usr.sbin.nginx
</code></pre></div>

<h3 id="_12">í”„ë¡œíŒŒì¼ ìœ„ì¹˜<a class="header-link" href="#_12" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><span class="c1"># ì‹œìŠ¤í…œ í”„ë¡œíŒŒì¼</span>
ls<span class="w"> </span>/etc/apparmor.d/

<span class="c1"># ì£¼ìš” íŒŒì¼ë“¤</span>
/etc/apparmor.d/usr.sbin.nginx<span class="w">    </span><span class="c1"># Nginx í”„ë¡œíŒŒì¼</span>
/etc/apparmor.d/usr.sbin.mysqld<span class="w">   </span><span class="c1"># MySQL í”„ë¡œíŒŒì¼</span>
/etc/apparmor.d/abstractions/<span class="w">     </span><span class="c1"># ê³µìœ  ê·œì¹™</span>
/etc/apparmor.d/tunables/<span class="w">         </span><span class="c1"># ë³€ìˆ˜ ì •ì˜</span>
</code></pre></div>

<hr />
<h2 id="6-apparmor">6. AppArmor í”„ë¡œíŒŒì¼<a class="header-link" href="#6-apparmor" title="Permanent link">&para;</a></h2>
<h3 id="_13">í”„ë¡œíŒŒì¼ êµ¬ì¡°<a class="header-link" href="#_13" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><span class="c1">#include &lt;tunables/global&gt;</span>

<span class="o">/</span><span class="n">path</span><span class="o">/</span><span class="n">to</span><span class="o">/</span><span class="n">program</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="c1">#include &lt;abstractions/base&gt;</span>

<span class="w">  </span><span class="c1"># íŒŒì¼ ì ‘ê·¼ ê·œì¹™</span>
<span class="w">  </span><span class="o">/</span><span class="n">etc</span><span class="o">/</span><span class="n">myapp</span><span class="o">.</span><span class="n">conf</span><span class="w"> </span><span class="n">r</span><span class="p">,</span>
<span class="w">  </span><span class="o">/</span><span class="k">var</span><span class="o">/</span><span class="nb">log</span><span class="o">/</span><span class="n">myapp</span><span class="o">.</span><span class="n">log</span><span class="w"> </span><span class="n">w</span><span class="p">,</span>
<span class="w">  </span><span class="o">/</span><span class="n">usr</span><span class="o">/</span><span class="n">lib</span><span class="o">/</span><span class="n">myapp</span><span class="o">/**</span><span class="w"> </span><span class="n">r</span><span class="p">,</span>

<span class="w">  </span><span class="c1"># ë„¤íŠ¸ì›Œí¬ ê·œì¹™</span>
<span class="w">  </span><span class="n">network</span><span class="w"> </span><span class="n">inet</span><span class="w"> </span><span class="n">stream</span><span class="p">,</span>

<span class="w">  </span><span class="c1"># ì‹¤í–‰ ê·œì¹™</span>
<span class="w">  </span><span class="o">/</span><span class="n">usr</span><span class="o">/</span><span class="n">bin</span><span class="o">/</span><span class="n">helper</span><span class="w"> </span><span class="n">ix</span><span class="p">,</span>
<span class="p">}</span>
</code></pre></div>

<h3 id="_14">ê¶Œí•œ í”Œë˜ê·¸<a class="header-link" href="#_14" title="Permanent link">&para;</a></h3>
<table>
<thead>
<tr>
<th>í”Œë˜ê·¸</th>
<th>ì˜ë¯¸</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>r</code></td>
<td>ì½ê¸°</td>
</tr>
<tr>
<td><code>w</code></td>
<td>ì“°ê¸°</td>
</tr>
<tr>
<td><code>a</code></td>
<td>ì¶”ê°€</td>
</tr>
<tr>
<td><code>k</code></td>
<td>íŒŒì¼ ì ê¸ˆ</td>
</tr>
<tr>
<td><code>l</code></td>
<td>ë§í¬</td>
</tr>
<tr>
<td><code>m</code></td>
<td>ë©”ëª¨ë¦¬ ë§µ ì‹¤í–‰</td>
</tr>
<tr>
<td><code>x</code></td>
<td>ì‹¤í–‰</td>
</tr>
<tr>
<td><code>ix</code></td>
<td>ë™ì¼ í”„ë¡œíŒŒì¼ë¡œ ì‹¤í–‰</td>
</tr>
<tr>
<td><code>px</code></td>
<td>ë‹¤ë¥¸ í”„ë¡œíŒŒì¼ë¡œ ì‹¤í–‰</td>
</tr>
<tr>
<td><code>ux</code></td>
<td>ì œí•œ ì—†ì´ ì‹¤í–‰</td>
</tr>
<tr>
<td><code>Px</code></td>
<td>px + í™˜ê²½ ì •ë¦¬</td>
</tr>
<tr>
<td><code>Ux</code></td>
<td>ux + í™˜ê²½ ì •ë¦¬</td>
</tr>
</tbody>
</table>
<h3 id="_15">í”„ë¡œíŒŒì¼ ì‘ì„± ì˜ˆì‹œ<a class="header-link" href="#_15" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><span class="c1"># /etc/apparmor.d/usr.local.bin.myapp</span>
<span class="c1">#include &lt;tunables/global&gt;</span>

/usr/local/bin/myapp<span class="w"> </span><span class="o">{</span>
<span class="w">  </span><span class="c1">#include &lt;abstractions/base&gt;</span>
<span class="w">  </span><span class="c1">#include &lt;abstractions/nameservice&gt;</span>

<span class="w">  </span><span class="c1"># ì„¤ì • íŒŒì¼ ì½ê¸°</span>
<span class="w">  </span>/etc/myapp/**<span class="w"> </span>r,

<span class="w">  </span><span class="c1"># ë°ì´í„° ë””ë ‰í† ë¦¬</span>
<span class="w">  </span>/var/lib/myapp/<span class="w"> </span>r,
<span class="w">  </span>/var/lib/myapp/**<span class="w"> </span>rw,

<span class="w">  </span><span class="c1"># ë¡œê·¸ íŒŒì¼</span>
<span class="w">  </span>/var/log/myapp/<span class="w"> </span>r,
<span class="w">  </span>/var/log/myapp/**<span class="w"> </span>rw,
<span class="w">  </span>owner<span class="w"> </span>/var/log/myapp/*.log<span class="w"> </span>w,

<span class="w">  </span><span class="c1"># ëŸ°íƒ€ì„ íŒŒì¼</span>
<span class="w">  </span>/run/myapp.pid<span class="w"> </span>rw,
<span class="w">  </span>/run/myapp.sock<span class="w"> </span>rw,

<span class="w">  </span><span class="c1"># ë¼ì´ë¸ŒëŸ¬ë¦¬</span>
<span class="w">  </span>/usr/lib/myapp/**<span class="w"> </span>rm,

<span class="w">  </span><span class="c1"># ë„¤íŠ¸ì›Œí¬ ì ‘ê·¼</span>
<span class="w">  </span>network<span class="w"> </span>inet<span class="w"> </span>tcp,
<span class="w">  </span>network<span class="w"> </span>inet<span class="w"> </span>udp,

<span class="w">  </span><span class="c1"># ì‹œìŠ¤í…œ í˜¸ì¶œ ì œí•œ</span>
<span class="w">  </span>deny<span class="w"> </span>@<span class="o">{</span>PROC<span class="o">}</span>/**<span class="w"> </span>w,
<span class="w">  </span>deny<span class="w"> </span>/sys/**<span class="w"> </span>w,

<span class="w">  </span><span class="c1"># ìì‹ í”„ë¡œì„¸ìŠ¤</span>
<span class="w">  </span>/usr/bin/logger<span class="w"> </span>Px,
<span class="o">}</span>
</code></pre></div>

<h3 id="_16">ìë™ í”„ë¡œíŒŒì¼ ìƒì„±<a class="header-link" href="#_16" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><span class="c1"># aa-genprofë¡œ í”„ë¡œíŒŒì¼ ìƒì„±</span>
sudo<span class="w"> </span>aa-genprof<span class="w"> </span>/usr/local/bin/myapp

<span class="c1"># í”„ë¡œê·¸ë¨ì„ ì‹¤í–‰í•˜ê³  ì¼ë°˜ì ì¸ ì‘ì—… ìˆ˜í–‰</span>
<span class="c1"># aa-genprofê°€ ì ‘ê·¼ì„ ëª¨ë‹ˆí„°ë§í•˜ê³  í”„ë¡œíŒŒì¼ ìƒì„±</span>

<span class="c1"># aa-logprofë¡œ ê¸°ì¡´ í”„ë¡œíŒŒì¼ ì—…ë°ì´íŠ¸</span>
sudo<span class="w"> </span>aa-logprof
</code></pre></div>

<h3 id="abstractions">Abstractions ì‚¬ìš©<a class="header-link" href="#abstractions" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><span class="c1"># /etc/apparmor.d/abstractions/ ë‚´ ê³µí†µ ê·œì¹™</span>
<span class="c1"># base          - ê¸°ë³¸ ì‹œìŠ¤í…œ ì ‘ê·¼</span>
<span class="c1"># nameservice   - DNS, NSS ë“±</span>
<span class="c1"># authentication - PAM, shadow ë“±</span>
<span class="c1"># apache2-common - Apache ê³µí†µ ê·œì¹™</span>
<span class="c1"># mysql         - MySQL í´ë¼ì´ì–¸íŠ¸ ì ‘ê·¼</span>
<span class="c1"># php           - PHP ê´€ë ¨ ì ‘ê·¼</span>
</code></pre></div>

<p>í”„ë¡œíŒŒì¼ì—ì„œ ì‚¬ìš©:</p>
<div class="highlight"><pre><span></span><code><span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;abstractions/base&gt;</span>
<span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;abstractions/nameservice&gt;</span>
</code></pre></div>

<hr />
<h2 id="7">7. ì‹¤ë¬´ ì‹œë‚˜ë¦¬ì˜¤<a class="header-link" href="#7" title="Permanent link">&para;</a></h2>
<h3 id="1-selinux">ì‹œë‚˜ë¦¬ì˜¤ 1: ì›¹ ì„œë²„ ì»¤ìŠ¤í…€ ë””ë ‰í† ë¦¬ (SELinux)<a class="header-link" href="#1-selinux" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><span class="c1"># ë¬¸ì œ: /data/wwwì—ì„œ ì›¹ ì½˜í…ì¸  ì œê³µ ì‹œ 403 ì—ëŸ¬</span>

<span class="c1"># 1. í˜„ì¬ ì»¨í…ìŠ¤íŠ¸ í™•ì¸</span>
ls<span class="w"> </span>-Zd<span class="w"> </span>/data/www
<span class="c1"># drwxr-xr-x. root root unconfined_u:object_r:default_t:s0 /data/www</span>

<span class="c1"># 2. ì˜¬ë°”ë¥¸ ì»¨í…ìŠ¤íŠ¸ ì„¤ì •</span>
sudo<span class="w"> </span>semanage<span class="w"> </span>fcontext<span class="w"> </span>-a<span class="w"> </span>-t<span class="w"> </span>httpd_sys_content_t<span class="w"> </span><span class="s2">&quot;/data/www(/.*)?&quot;</span>
sudo<span class="w"> </span>restorecon<span class="w"> </span>-Rv<span class="w"> </span>/data/www

<span class="c1"># 3. í™•ì¸</span>
ls<span class="w"> </span>-Zd<span class="w"> </span>/data/www
<span class="c1"># drwxr-xr-x. root root unconfined_u:object_r:httpd_sys_content_t:s0 /data/www</span>
</code></pre></div>

<h3 id="2-php-db-selinux">ì‹œë‚˜ë¦¬ì˜¤ 2: PHP ì• í”Œë¦¬ì¼€ì´ì…˜ DB ì—°ê²° (SELinux)<a class="header-link" href="#2-php-db-selinux" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><span class="c1"># ë¬¸ì œ: PHPì—ì„œ ì›ê²© MySQL ì—°ê²° ì‹¤íŒ¨</span>

<span class="c1"># 1. ë¡œê·¸ í™•ì¸</span>
sudo<span class="w"> </span>ausearch<span class="w"> </span>-m<span class="w"> </span>avc<span class="w"> </span>-c<span class="w"> </span>httpd<span class="w"> </span><span class="p">|</span><span class="w"> </span>audit2why

<span class="c1"># 2. ë¶ˆë¦¬ì–¸ í™•ì¸</span>
getsebool<span class="w"> </span>httpd_can_network_connect_db
<span class="c1"># httpd_can_network_connect_db --&gt; off</span>

<span class="c1"># 3. ë¶ˆë¦¬ì–¸ í™œì„±í™”</span>
sudo<span class="w"> </span>setsebool<span class="w"> </span>-P<span class="w"> </span>httpd_can_network_connect_db<span class="w"> </span>on
</code></pre></div>

<h3 id="3-nginx-apparmor">ì‹œë‚˜ë¦¬ì˜¤ 3: Nginx ì»¤ìŠ¤í…€ í¬íŠ¸ (AppArmor)<a class="header-link" href="#3-nginx-apparmor" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><span class="c1"># /etc/apparmor.d/local/nginx</span>
<span class="c1"># ë¡œì»¬ ì»¤ìŠ¤í„°ë§ˆì´ì§•ìš© íŒŒì¼</span>

<span class="c1"># ì¶”ê°€ í¬íŠ¸ í—ˆìš©</span>
network<span class="w"> </span>inet<span class="w"> </span>stream,

<span class="c1"># ì¶”ê°€ ê²½ë¡œ í—ˆìš©</span>
/data/nginx/**<span class="w"> </span>r,
/var/log/nginx-custom/<span class="w"> </span>rw,
/var/log/nginx-custom/**<span class="w"> </span>rw,
</code></pre></div>

<div class="highlight"><pre><span></span><code><span class="c1"># í”„ë¡œíŒŒì¼ ë¦¬ë¡œë“œ</span>
sudo<span class="w"> </span>apparmor_parser<span class="w"> </span>-r<span class="w"> </span>/etc/apparmor.d/usr.sbin.nginx
</code></pre></div>

<h3 id="4-docker-selinux">ì‹œë‚˜ë¦¬ì˜¤ 4: Dockerì™€ SELinux<a class="header-link" href="#4-docker-selinux" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><span class="c1"># Docker ì»¨í…Œì´ë„ˆì—ì„œ í˜¸ìŠ¤íŠ¸ ë³¼ë¥¨ ë§ˆìš´íŠ¸</span>

<span class="c1"># ë°©ë²• 1: z ì˜µì…˜ (ê³µìœ  ë ˆì´ë¸”)</span>
docker<span class="w"> </span>run<span class="w"> </span>-v<span class="w"> </span>/data:/data:z<span class="w"> </span>myimage

<span class="c1"># ë°©ë²• 2: Z ì˜µì…˜ (ì „ìš© ë ˆì´ë¸”)</span>
docker<span class="w"> </span>run<span class="w"> </span>-v<span class="w"> </span>/data:/data:Z<span class="w"> </span>myimage

<span class="c1"># ë°©ë²• 3: ìˆ˜ë™ ë ˆì´ë¸” ì§€ì •</span>
sudo<span class="w"> </span>chcon<span class="w"> </span>-Rt<span class="w"> </span>svirt_sandbox_file_t<span class="w"> </span>/data
docker<span class="w"> </span>run<span class="w"> </span>-v<span class="w"> </span>/data:/data<span class="w"> </span>myimage
</code></pre></div>

<h3 id="5-apparmor_1">ì‹œë‚˜ë¦¬ì˜¤ 5: ìƒˆ ì„œë¹„ìŠ¤ í”„ë¡œíŒŒì¼ ìƒì„± (AppArmor)<a class="header-link" href="#5-apparmor_1" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><span class="c1"># 1. complain ëª¨ë“œë¡œ ì‹œì‘</span>
sudo<span class="w"> </span>aa-complain<span class="w"> </span>/usr/local/bin/newservice

<span class="c1"># 2. ì„œë¹„ìŠ¤ ì‹¤í–‰ ë° ëª¨ë“  ê¸°ëŠ¥ í…ŒìŠ¤íŠ¸</span>

<span class="c1"># 3. ë¡œê·¸ì—ì„œ í”„ë¡œíŒŒì¼ ì—…ë°ì´íŠ¸</span>
sudo<span class="w"> </span>aa-logprof

<span class="c1"># 4. enforce ëª¨ë“œë¡œ ì „í™˜</span>
sudo<span class="w"> </span>aa-enforce<span class="w"> </span>/usr/local/bin/newservice

<span class="c1"># 5. í…ŒìŠ¤íŠ¸</span>
</code></pre></div>

<hr />
<h2 id="_17">ì—°ìŠµ ë¬¸ì œ<a class="header-link" href="#_17" title="Permanent link">&para;</a></h2>
<h3 id="1-selinux_1">ë¬¸ì œ 1: SELinux ì»¨í…ìŠ¤íŠ¸<a class="header-link" href="#1-selinux_1" title="Permanent link">&para;</a></h3>
<p>ë‹¤ìŒ ìƒí™©ì—ì„œ ì–´ë–¤ ëª…ë ¹ì„ ì‚¬ìš©í•´ì•¼ í• ê¹Œìš”?
- <code>/opt/webapp</code> ë””ë ‰í† ë¦¬ë¥¼ ì›¹ ì„œë²„ ì½˜í…ì¸ ë¡œ ì˜êµ¬ ì„¤ì •
- Apacheê°€ 8443 í¬íŠ¸ë¥¼ ì‚¬ìš©í•˜ë„ë¡ í—ˆìš©
- httpdê°€ ì‚¬ìš©ì í™ˆ ë””ë ‰í† ë¦¬ì— ì ‘ê·¼í•˜ë„ë¡ í—ˆìš©</p>
<h3 id="2-apparmor">ë¬¸ì œ 2: AppArmor í”„ë¡œíŒŒì¼<a class="header-link" href="#2-apparmor" title="Permanent link">&para;</a></h3>
<p><code>/usr/local/bin/backup.sh</code> ìŠ¤í¬ë¦½íŠ¸ê°€ ë‹¤ìŒ ì‘ì—…ì„ ìˆ˜í–‰í•©ë‹ˆë‹¤:
- <code>/etc/</code> ì½ê¸°
- <code>/var/backup/</code>ì— ì“°ê¸°
- <code>rsync</code> ì‹¤í–‰
- TCP 22ë²ˆ í¬íŠ¸ ë„¤íŠ¸ì›Œí¬ ì ‘ê·¼</p>
<p>ì´ ìŠ¤í¬ë¦½íŠ¸ì˜ AppArmor í”„ë¡œíŒŒì¼ì„ ì‘ì„±í•˜ì„¸ìš”.</p>
<h3 id="3">ë¬¸ì œ 3: íŠ¸ëŸ¬ë¸”ìŠˆíŒ…<a class="header-link" href="#3" title="Permanent link">&para;</a></h3>
<p>SELinux Enforcing ëª¨ë“œì—ì„œ ì›¹ ì• í”Œë¦¬ì¼€ì´ì…˜ì´ ì‘ë™í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤:
1. ë¬¸ì œë¥¼ ì§„ë‹¨í•˜ëŠ” ë‹¨ê³„ë¥¼ ë‚˜ì—´í•˜ì„¸ìš”
2. ì–´ë–¤ ë„êµ¬ë¥¼ ì‚¬ìš©í•´ì•¼ í• ê¹Œìš”?</p>
<hr />
<h2 id="_18">ì •ë‹µ<a class="header-link" href="#_18" title="Permanent link">&para;</a></h2>
<h3 id="1_1">ë¬¸ì œ 1 ì •ë‹µ<a class="header-link" href="#1_1" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><span class="c1"># ì›¹ ì½˜í…ì¸  ì„¤ì •</span>
sudo<span class="w"> </span>semanage<span class="w"> </span>fcontext<span class="w"> </span>-a<span class="w"> </span>-t<span class="w"> </span>httpd_sys_content_t<span class="w"> </span><span class="s2">&quot;/opt/webapp(/.*)?&quot;</span>
sudo<span class="w"> </span>restorecon<span class="w"> </span>-Rv<span class="w"> </span>/opt/webapp

<span class="c1"># í¬íŠ¸ ì¶”ê°€</span>
sudo<span class="w"> </span>semanage<span class="w"> </span>port<span class="w"> </span>-a<span class="w"> </span>-t<span class="w"> </span>http_port_t<span class="w"> </span>-p<span class="w"> </span>tcp<span class="w"> </span><span class="m">8443</span>

<span class="c1"># í™ˆ ë””ë ‰í† ë¦¬ ì ‘ê·¼ í—ˆìš©</span>
sudo<span class="w"> </span>setsebool<span class="w"> </span>-P<span class="w"> </span>httpd_enable_homedirs<span class="w"> </span>on
</code></pre></div>

<h3 id="2">ë¬¸ì œ 2 ì •ë‹µ<a class="header-link" href="#2" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><span class="c1">#include &lt;tunables/global&gt;</span>

<span class="o">/</span><span class="n">usr</span><span class="o">/</span><span class="n">local</span><span class="o">/</span><span class="n">bin</span><span class="o">/</span><span class="n">backup</span><span class="o">.</span><span class="n">sh</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="c1">#include &lt;abstractions/base&gt;</span>
<span class="w">  </span><span class="c1">#include &lt;abstractions/bash&gt;</span>

<span class="w">  </span><span class="c1"># ì„¤ì • ì½ê¸°</span>
<span class="w">  </span><span class="o">/</span><span class="n">etc</span><span class="o">/**</span><span class="w"> </span><span class="n">r</span><span class="p">,</span>

<span class="w">  </span><span class="c1"># ë°±ì—… ë””ë ‰í† ë¦¬</span>
<span class="w">  </span><span class="o">/</span><span class="k">var</span><span class="o">/</span><span class="n">backup</span><span class="o">/</span><span class="w"> </span><span class="n">r</span><span class="p">,</span>
<span class="w">  </span><span class="o">/</span><span class="k">var</span><span class="o">/</span><span class="n">backup</span><span class="o">/**</span><span class="w"> </span><span class="n">rw</span><span class="p">,</span>

<span class="w">  </span><span class="c1"># rsync ì‹¤í–‰</span>
<span class="w">  </span><span class="o">/</span><span class="n">usr</span><span class="o">/</span><span class="n">bin</span><span class="o">/</span><span class="n">rsync</span><span class="w"> </span><span class="n">Px</span><span class="p">,</span>

<span class="w">  </span><span class="c1"># SSH ë„¤íŠ¸ì›Œí¬</span>
<span class="w">  </span><span class="n">network</span><span class="w"> </span><span class="n">inet</span><span class="w"> </span><span class="n">stream</span><span class="p">,</span>
<span class="w">  </span><span class="n">network</span><span class="w"> </span><span class="n">inet6</span><span class="w"> </span><span class="n">stream</span><span class="p">,</span>
<span class="p">}</span>
</code></pre></div>

<h3 id="3_1">ë¬¸ì œ 3 ì •ë‹µ<a class="header-link" href="#3_1" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><span class="c1"># 1. SELinux ë¡œê·¸ í™•ì¸</span>
sudo<span class="w"> </span>ausearch<span class="w"> </span>-m<span class="w"> </span>avc<span class="w"> </span>-ts<span class="w"> </span>recent

<span class="c1"># 2. ì›ì¸ ë¶„ì„</span>
sudo<span class="w"> </span>ausearch<span class="w"> </span>-m<span class="w"> </span>avc<span class="w"> </span>-ts<span class="w"> </span>recent<span class="w"> </span><span class="p">|</span><span class="w"> </span>audit2why

<span class="c1"># 3. ìƒì„¸ ë¶„ì„ (setroubleshoot ì„¤ì¹˜ ì‹œ)</span>
sudo<span class="w"> </span>sealert<span class="w"> </span>-a<span class="w"> </span>/var/log/audit/audit.log

<span class="c1"># 4. í•´ê²°ì±… ì ìš©</span>
<span class="c1"># - ì»¨í…ìŠ¤íŠ¸ ë¬¸ì œ: restorecon, semanage fcontext</span>
<span class="c1"># - ë¶ˆë¦¬ì–¸ ë¬¸ì œ: setsebool</span>
<span class="c1"># - í¬íŠ¸ ë¬¸ì œ: semanage port</span>
<span class="c1"># - ì •ì±… í•„ìš”: audit2allowë¡œ ì»¤ìŠ¤í…€ ëª¨ë“ˆ ìƒì„±</span>
</code></pre></div>

<hr />
<h2 id="_19">ë‹¤ìŒ ë‹¨ê³„<a class="header-link" href="#_19" title="Permanent link">&para;</a></h2>
<ul>
<li><a href="./18_Log_Management.md">18_Log_Management.md</a> - journald, rsyslog, logrotate í•™ìŠµ</li>
</ul>
<hr />
<h2 id="_20">ì°¸ê³  ìë£Œ<a class="header-link" href="#_20" title="Permanent link">&para;</a></h2>
<ul>
<li><a href="https://access.redhat.com/documentation/en-us/red_hat_enterprise_linux/9/html/using_selinux/index">SELinux User Guide (Red Hat)</a></li>
<li><a href="https://gitlab.com/apparmor/apparmor/-/wikis/home">AppArmor Wiki</a></li>
<li><a href="https://selinuxproject.org/page/Main_Page">SELinux Project Wiki</a></li>
<li><code>man semanage</code>, <code>man restorecon</code>, <code>man audit2why</code></li>
<li><code>man apparmor</code>, <code>man aa-status</code>, <code>man apparmor.d</code></li>
</ul>
    </div>

    
<div class="lesson-toolbar lesson-toolbar--bottom">
    <div class="toolbar-nav toolbar-nav--prev">
        
        <a href="/study/ko/Linux/16_Storage_Management.html" class="nav-prev">
            <span class="nav-label">Previous</span>
            <span class="nav-title">16. ì €ì¥ì†Œ ê´€ë¦¬</span>
        </a>
        
    </div>
    <div class="toolbar-actions">
        <button class="btn btn-copy-link" data-action="copy-link" title="Copy link">
            <span class="icon">ğŸ”—</span>
            <span class="text">Copy link</span>
        </button>
        <a href="/study/ko/Linux/" class="btn btn-topic-link" title="Back to topic list">
            <span class="icon">ğŸ“‹</span>
            <span class="text">Topic list</span>
        </a>
    </div>
    <div class="toolbar-nav toolbar-nav--next">
        
        <a href="/study/ko/Linux/18_Log_Management.html" class="nav-next">
            <span class="nav-label">Next</span>
            <span class="nav-title">ë¡œê·¸ ê´€ë¦¬</span>
        </a>
        
    </div>
</div>


    <div class="toolbar-keyboard-hint">
        <kbd>&larr;</kbd> <kbd>&rarr;</kbd> to navigate between lessons
    </div>
</article>

<!-- Scroll to top floating button -->
<button class="scroll-to-top" id="scroll-to-top" title="Scroll to top" aria-label="Scroll to top">â†‘</button>

            </div>
        </main>
    </div>

    <script src="/study/static/js/app.js"></script>
    <script>
        function switchLanguage(newLang) {
            const path = window.location.pathname;
            const base = '/study';
            const currentLang = 'ko';
            const newPath = path.replace(base + '/' + currentLang + '/', base + '/' + newLang + '/');
            window.location.href = newPath + window.location.search;
        }
    </script>
    
<script>
    document.addEventListener('DOMContentLoaded', function() {
        // Copy link - independent feedback per button
        document.querySelectorAll('[data-action="copy-link"]').forEach(function(btn) {
            btn.addEventListener('click', function() {
                navigator.clipboard.writeText(window.location.href);
                var textEl = this.querySelector('.text');
                var originalText = textEl.textContent;
                textEl.textContent = 'Copied!';
                setTimeout(function() { textEl.textContent = originalText; }, 2000);
            });
        });

        // Add copy buttons to code blocks
        document.querySelectorAll('.lesson-content pre').forEach(function(pre) {
            var copyBtn = document.createElement('button');
            copyBtn.className = 'code-copy-btn';
            copyBtn.textContent = 'Copy';
            copyBtn.addEventListener('click', function() {
                var code = pre.querySelector('code');
                var text = code ? code.textContent : pre.textContent;
                navigator.clipboard.writeText(text);
                copyBtn.textContent = 'Copied!';
                setTimeout(function() { copyBtn.textContent = 'Copy'; }, 2000);
            });
            pre.style.position = 'relative';
            pre.appendChild(copyBtn);
        });

        // Scroll to top button
        var scrollBtn = document.getElementById('scroll-to-top');
        window.addEventListener('scroll', function() {
            scrollBtn.classList.toggle('visible', window.scrollY > 300);
        });
        scrollBtn.addEventListener('click', function() {
            window.scrollTo({ top: 0, behavior: 'smooth' });
        });

        // Keyboard shortcuts: left/right arrows for lesson navigation
        document.addEventListener('keydown', function(e) {
            var tag = document.activeElement.tagName;
            if (tag === 'INPUT' || tag === 'TEXTAREA' || tag === 'SELECT') return;

            if (e.key === 'ArrowLeft') {
                var prevLink = document.querySelector('.nav-prev');
                if (prevLink) prevLink.click();
            } else if (e.key === 'ArrowRight') {
                var nextLink = document.querySelector('.nav-next');
                if (nextLink) nextLink.click();
            }
        });
    });
</script>

</body>
</html>
{% endraw %}