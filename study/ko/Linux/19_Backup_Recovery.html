{% raw %}
<!DOCTYPE html>
<html lang="ko" data-theme="light">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ë°±ì—… ë° ë³µêµ¬ - Study Materials</title>
    <link rel="stylesheet" href="/study/static/css/style.css">
    <link rel="stylesheet" href="/study/static/css/highlight.css">
    <!-- KaTeX for LaTeX math rendering -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.16.11/dist/katex.min.css">
    <script defer src="https://cdn.jsdelivr.net/npm/katex@0.16.11/dist/katex.min.js"></script>
    <script defer src="https://cdn.jsdelivr.net/npm/katex@0.16.11/dist/contrib/auto-render.min.js"
        onload="renderMathInElement(document.body, {
            delimiters: [
                {left: '$$', right: '$$', display: true},
                {left: '$', right: '$', display: false}
            ],
            throwOnError: false
        });"></script>
    
</head>
<body>
    <div class="app-container">
        <!-- Sidebar -->
        <aside class="sidebar" id="sidebar">
            <div class="sidebar-header">
                <a href="/study/ko/" class="logo">Study Materials</a>
                <button class="sidebar-toggle" id="sidebar-toggle" aria-label="Toggle sidebar">
                    <span></span>
                </button>
            </div>

            <nav class="sidebar-nav">
                <a href="/study/ko/" class="nav-item ">
                    <span class="nav-icon">ğŸ </span>
                    <span class="nav-text">Home</span>
                </a>
                <a href="/study/examples/" class="nav-item ">
                    <span class="nav-icon">ğŸ’»</span>
                    <span class="nav-text">Examples</span>
                </a>
            </nav>

            <div class="sidebar-search">
                <form action="/study/ko/search.html" method="get" id="search-form">
                    <input type="search" name="q" placeholder="Search..." id="search-sidebar-input">
                </form>
            </div>

            <!-- Language Selector -->
            <div class="sidebar-lang">
                <select id="lang-select" class="lang-selector" onchange="switchLanguage(this.value)">
                    
                    <option value="en" >
                        English
                    </option>
                    
                    <option value="ko" selected>
                        í•œêµ­ì–´
                    </option>
                    
                </select>
            </div>

            <div class="sidebar-footer">
                <button class="theme-toggle" id="theme-toggle" aria-label="Toggle theme">
                    <span class="theme-icon light">â˜€ï¸</span>
                    <span class="theme-icon dark">ğŸŒ™</span>
                </button>
            </div>
        </aside>

        <!-- Main Content -->
        <main class="main-content">
            <header class="main-header">
                <button class="menu-toggle" id="menu-toggle" aria-label="Open menu">
                    <span></span>
                </button>
                
<nav class="breadcrumb">
    <a href="/study/ko/">Topics</a>
    <span class="separator">/</span>
    <a href="/study/ko/Linux/">Linux</a>
    <span class="separator">/</span>
    <span class="current">ë°±ì—… ë° ë³µêµ¬</span>
</nav>

            </header>

            <div class="content">
                
<article class="lesson-article">
    <header class="lesson-header">
        <h1>ë°±ì—… ë° ë³µêµ¬</h1>
    </header>

    
<div class="lesson-toolbar lesson-toolbar--top">
    <div class="toolbar-nav toolbar-nav--prev">
        
        <a href="/study/ko/Linux/18_Log_Management.html" class="nav-prev">
            <span class="nav-label">Previous</span>
            <span class="nav-title">ë¡œê·¸ ê´€ë¦¬</span>
        </a>
        
    </div>
    <div class="toolbar-actions">
        <button class="btn btn-copy-link" data-action="copy-link" title="Copy link">
            <span class="icon">ğŸ”—</span>
            <span class="text">Copy link</span>
        </button>
        <a href="/study/ko/Linux/" class="btn btn-topic-link" title="Back to topic list">
            <span class="icon">ğŸ“‹</span>
            <span class="text">Topic list</span>
        </a>
    </div>
    <div class="toolbar-nav toolbar-nav--next">
        
        <a href="/study/ko/Linux/20_Kernel_Management.html" class="nav-next">
            <span class="nav-label">Next</span>
            <span class="nav-title">ì»¤ë„ ê´€ë¦¬</span>
        </a>
        
    </div>
</div>


    
    <nav class="toc" id="toc">
        <h2>Table of Contents</h2>
        <div class="toc">
<ul>
<li><a href="#_2">í•™ìŠµ ëª©í‘œ</a></li>
<li><a href="#_3">ëª©ì°¨</a></li>
<li><a href="#1">1. ë°±ì—… ì „ëµ ê°œìš”</a><ul>
<li><a href="#3-2-1">3-2-1 ë°±ì—… ê·œì¹™</a></li>
<li><a href="#_4">ë°±ì—… ìœ í˜•</a></li>
<li><a href="#rto-rpo">RTOì™€ RPO</a></li>
</ul>
</li>
<li><a href="#2-rsync">2. rsync ê³ ê¸‰ ì‚¬ìš©ë²•</a><ul>
<li><a href="#_5">ê¸°ë³¸ ë¬¸ë²•</a></li>
<li><a href="#_6">ì£¼ìš” ì˜µì…˜</a></li>
<li><a href="#_7">ì œì™¸ íŒ¨í„´</a></li>
<li><a href="#_8">ì¦ë¶„ ë°±ì—… ìŠ¤í¬ë¦½íŠ¸</a></li>
<li><a href="#ssh">SSH í‚¤ ì„¤ì • (ì›ê²© ë°±ì—…ìš©)</a></li>
<li><a href="#_9">ëŒ€ì—­í­ ì œí•œ</a></li>
</ul>
</li>
<li><a href="#3-borg-backup">3. Borg Backup</a><ul>
<li><a href="#borg">Borg ì†Œê°œ</a></li>
<li><a href="#_10">ì €ì¥ì†Œ ì´ˆê¸°í™”</a></li>
<li><a href="#_11">ë°±ì—… ìƒì„±</a></li>
<li><a href="#_12">ì••ì¶• ì˜µì…˜</a></li>
<li><a href="#_13">ë°±ì—… ê´€ë¦¬</a></li>
<li><a href="#_14">ë³µêµ¬</a></li>
<li><a href="#pruning">ë³´ì¡´ ì •ì±… (Pruning)</a></li>
<li><a href="#borg_1">Borg ë°±ì—… ìŠ¤í¬ë¦½íŠ¸</a></li>
</ul>
</li>
<li><a href="#4-tarcpio">4. tar/cpio ë°±ì—…</a><ul>
<li><a href="#tar">tar ë°±ì—…</a></li>
<li><a href="#cpio">cpio ë°±ì—…</a></li>
</ul>
</li>
<li><a href="#5">5. ì‹œìŠ¤í…œ ì´ë¯¸ì§€ ë°±ì—…</a><ul>
<li><a href="#dd">ddë¥¼ ì´ìš©í•œ ë””ìŠ¤í¬ ì´ë¯¸ì§€</a></li>
<li><a href="#clonezilla">Clonezilla</a></li>
<li><a href="#lvm">LVM ìŠ¤ëƒ…ìƒ· ë°±ì—…</a></li>
</ul>
</li>
<li><a href="#6">6. ì¬í•´ë³µêµ¬ ì „ëµ</a><ul>
<li><a href="#dr">DR ê³„íš êµ¬ì„±ìš”ì†Œ</a></li>
<li><a href="#_15">ë³µêµ¬ ì²´í¬ë¦¬ìŠ¤íŠ¸</a></li>
<li><a href="#_16">ë² ì–´ë©”íƒˆ ë³µêµ¬ ì ˆì°¨</a></li>
</ul>
</li>
<li><a href="#7">7. ìë™í™” ë° ëª¨ë‹ˆí„°ë§</a><ul>
<li><a href="#systemd">systemd íƒ€ì´ë¨¸ë¥¼ ì´ìš©í•œ ìë™í™”</a></li>
<li><a href="#_17">ë°±ì—… ëª¨ë‹ˆí„°ë§ ìŠ¤í¬ë¦½íŠ¸</a></li>
<li><a href="#prometheus">Prometheus ë©”íŠ¸ë¦­ ìˆ˜ì§‘</a></li>
</ul>
</li>
<li><a href="#_18">ì—°ìŠµ ë¬¸ì œ</a><ul>
<li><a href="#1-rsync">ë¬¸ì œ 1: rsync ì¦ë¶„ ë°±ì—…</a></li>
<li><a href="#2-borg">ë¬¸ì œ 2: Borg ë³µêµ¬</a></li>
<li><a href="#3-dr">ë¬¸ì œ 3: DR í…ŒìŠ¤íŠ¸</a></li>
</ul>
</li>
<li><a href="#_19">ì •ë‹µ</a><ul>
<li><a href="#1_1">ë¬¸ì œ 1 ì •ë‹µ</a></li>
<li><a href="#2">ë¬¸ì œ 2 ì •ë‹µ</a></li>
<li><a href="#3">ë¬¸ì œ 3 ì •ë‹µ</a></li>
</ul>
</li>
<li><a href="#_20">ë‹¤ìŒ ë‹¨ê³„</a></li>
<li><a href="#_21">ì°¸ê³  ìë£Œ</a></li>
</ul>
</div>

    </nav>
    

    <div class="lesson-content markdown-body">
        <h1 id="_1">ë°±ì—… ë° ë³µêµ¬<a class="header-link" href="#_1" title="Permanent link">&para;</a></h1>
<h2 id="_2">í•™ìŠµ ëª©í‘œ<a class="header-link" href="#_2" title="Permanent link">&para;</a></h2>
<p>ì´ ë¬¸ì„œë¥¼ í†µí•´ ë‹¤ìŒì„ í•™ìŠµí•©ë‹ˆë‹¤:</p>
<ul>
<li>rsyncë¥¼ í™œìš©í•œ íš¨ìœ¨ì ì¸ ë°±ì—…</li>
<li>Borg Backupìœ¼ë¡œ ì¤‘ë³µ ì œê±° ë°±ì—…</li>
<li>ì‹œìŠ¤í…œ ì´ë¯¸ì§€ ë°±ì—…ê³¼ ë³µêµ¬</li>
<li>ì¬í•´ë³µêµ¬(DR) ì „ëµ ìˆ˜ë¦½</li>
</ul>
<p><strong>ë‚œì´ë„</strong>: â­â­â­â­ (ê³ ê¸‰)</p>
<hr />
<h2 id="_3">ëª©ì°¨<a class="header-link" href="#_3" title="Permanent link">&para;</a></h2>
<ol>
<li><a href="#1-ë°±ì—…-ì „ëµ-ê°œìš”">ë°±ì—… ì „ëµ ê°œìš”</a></li>
<li><a href="#2-rsync-ê³ ê¸‰-ì‚¬ìš©ë²•">rsync ê³ ê¸‰ ì‚¬ìš©ë²•</a></li>
<li><a href="#3-borg-backup">Borg Backup</a></li>
<li><a href="#4-tarcpio-ë°±ì—…">tar/cpio ë°±ì—…</a></li>
<li><a href="#5-ì‹œìŠ¤í…œ-ì´ë¯¸ì§€-ë°±ì—…">ì‹œìŠ¤í…œ ì´ë¯¸ì§€ ë°±ì—…</a></li>
<li><a href="#6-ì¬í•´ë³µêµ¬-ì „ëµ">ì¬í•´ë³µêµ¬ ì „ëµ</a></li>
<li><a href="#7-ìë™í™”-ë°-ëª¨ë‹ˆí„°ë§">ìë™í™” ë° ëª¨ë‹ˆí„°ë§</a></li>
</ol>
<hr />
<h2 id="1">1. ë°±ì—… ì „ëµ ê°œìš”<a class="header-link" href="#1" title="Permanent link">&para;</a></h2>
<h3 id="3-2-1">3-2-1 ë°±ì—… ê·œì¹™<a class="header-link" href="#3-2-1" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code>â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    3-2-1 ë°±ì—… ê·œì¹™                          â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  3: ë°ì´í„° ì‚¬ë³¸ 3ê°œ ìœ ì§€                                    â”‚
â”‚     â””â”€â”€ ì›ë³¸ + ë°±ì—… 2ê°œ                                     â”‚
â”‚                                                             â”‚
â”‚  2: ì„œë¡œ ë‹¤ë¥¸ 2ì¢…ë¥˜ì˜ ì €ì¥ ë§¤ì²´                             â”‚
â”‚     â””â”€â”€ ë¡œì»¬ ë””ìŠ¤í¬ + ì™¸ì¥ ë””ìŠ¤í¬ ë˜ëŠ” NAS                  â”‚
â”‚                                                             â”‚
â”‚  1: 1ê°œëŠ” ì˜¤í”„ì‚¬ì´íŠ¸ (ì›ê²©ì§€)                               â”‚
â”‚     â””â”€â”€ í´ë¼ìš°ë“œ ë˜ëŠ” ë¬¼ë¦¬ì  ì›ê²©ì§€                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
</code></pre></div>

<h3 id="_4">ë°±ì—… ìœ í˜•<a class="header-link" href="#_4" title="Permanent link">&para;</a></h3>
<table>
<thead>
<tr>
<th>ìœ í˜•</th>
<th>ì„¤ëª…</th>
<th>ì¥ì </th>
<th>ë‹¨ì </th>
</tr>
</thead>
<tbody>
<tr>
<td><strong>ì „ì²´ ë°±ì—…</strong></td>
<td>ëª¨ë“  ë°ì´í„° ë³µì‚¬</td>
<td>ë³µêµ¬ ê°„ë‹¨</td>
<td>ì‹œê°„/ìš©ëŸ‰ ë§ì´ ì†Œìš”</td>
</tr>
<tr>
<td><strong>ì¦ë¶„ ë°±ì—…</strong></td>
<td>ë§ˆì§€ë§‰ ë°±ì—… ì´í›„ ë³€ê²½ë¶„ë§Œ</td>
<td>ë¹ ë¥´ê³  ìš©ëŸ‰ ì ìŒ</td>
<td>ë³µêµ¬ ì‹œ ì²´ì¸ í•„ìš”</td>
</tr>
<tr>
<td><strong>ì°¨ë“± ë°±ì—…</strong></td>
<td>ë§ˆì§€ë§‰ ì „ì²´ ë°±ì—… ì´í›„ ë³€ê²½ë¶„</td>
<td>ì¦ë¶„ë³´ë‹¤ ë³µêµ¬ ê°„ë‹¨</td>
<td>ì¦ë¶„ë³´ë‹¤ ìš©ëŸ‰ í¼</td>
</tr>
<tr>
<td><strong>ìŠ¤ëƒ…ìƒ·</strong></td>
<td>íŠ¹ì • ì‹œì ì˜ íŒŒì¼ì‹œìŠ¤í…œ ìƒíƒœ</td>
<td>ì¦‰ì‹œ ìƒì„±</td>
<td>ì €ì¥ì†Œ ì˜ì¡´ì </td>
</tr>
</tbody>
</table>
<h3 id="rto-rpo">RTOì™€ RPO<a class="header-link" href="#rto-rpo" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code>â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ RPO (Recovery Point Objective)                              â”‚
â”‚ = í—ˆìš© ê°€ëŠ¥í•œ ë°ì´í„° ì†ì‹¤ ì‹œê°„                              â”‚
â”‚ = ë§ˆì§€ë§‰ ë°±ì—… ì´í›„ ì–¼ë§ˆë‚˜ ë°ì´í„°ë¥¼ ìƒì–´ë„ ë˜ëŠ”ê°€?          â”‚
â”‚                                                             â”‚
â”‚ RTO (Recovery Time Objective)                               â”‚
â”‚ = ì„œë¹„ìŠ¤ ë³µêµ¬ê¹Œì§€ í—ˆìš© ê°€ëŠ¥í•œ ì‹œê°„                          â”‚
â”‚ = ì¥ì•  ë°œìƒ í›„ ì–¼ë§ˆ ë‚´ì— ë³µêµ¬í•´ì•¼ í•˜ëŠ”ê°€?                   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

íƒ€ì„ë¼ì¸:
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
     ë§ˆì§€ë§‰ ë°±ì—…           ì¥ì•  ë°œìƒ           ë³µêµ¬ ì™„ë£Œ
         â”‚                    â”‚                   â”‚
         â”‚â—„â”€â”€â”€â”€â”€â”€â”€ RPO â”€â”€â”€â”€â”€â”€â–ºâ”‚â—„â”€â”€â”€â”€â”€â”€ RTO â”€â”€â”€â”€â”€â”€â–ºâ”‚
         â”‚    (ë°ì´í„° ì†ì‹¤)    â”‚   (ë‹¤ìš´íƒ€ì„)      â”‚
</code></pre></div>

<hr />
<h2 id="2-rsync">2. rsync ê³ ê¸‰ ì‚¬ìš©ë²•<a class="header-link" href="#2-rsync" title="Permanent link">&para;</a></h2>
<h3 id="_5">ê¸°ë³¸ ë¬¸ë²•<a class="header-link" href="#_5" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code>rsync<span class="w"> </span><span class="o">[</span>ì˜µì…˜<span class="o">]</span><span class="w"> </span>ì›ë³¸<span class="w"> </span>ëŒ€ìƒ

<span class="c1"># ë¡œì»¬ ë³µì‚¬</span>
rsync<span class="w"> </span>-av<span class="w"> </span>/source/<span class="w"> </span>/backup/

<span class="c1"># ì›ê²© ë³µì‚¬ (SSH)</span>
rsync<span class="w"> </span>-av<span class="w"> </span>/source/<span class="w"> </span>user@server:/backup/
rsync<span class="w"> </span>-av<span class="w"> </span>user@server:/source/<span class="w"> </span>/backup/
</code></pre></div>

<h3 id="_6">ì£¼ìš” ì˜µì…˜<a class="header-link" href="#_6" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><span class="c1"># ê¸°ë³¸ ì˜µì…˜ ì¡°í•©</span>
rsync<span class="w"> </span>-avz<span class="w"> </span>--progress<span class="w"> </span>/source/<span class="w"> </span>/backup/

<span class="c1"># ìƒì„¸ ì˜µì…˜</span>
-a,<span class="w"> </span>--archive<span class="w">       </span><span class="c1"># ì•„ì¹´ì´ë¸Œ ëª¨ë“œ (-rlptgoDì™€ ë™ì¼)</span>
-v,<span class="w"> </span>--verbose<span class="w">       </span><span class="c1"># ìƒì„¸ ì¶œë ¥</span>
-z,<span class="w"> </span>--compress<span class="w">      </span><span class="c1"># ì „ì†¡ ì¤‘ ì••ì¶•</span>
-P<span class="w">                  </span><span class="c1"># --progress --partial ì¡°í•©</span>
--progress<span class="w">          </span><span class="c1"># ì§„í–‰ ìƒí™© í‘œì‹œ</span>
--partial<span class="w">           </span><span class="c1"># ë¶€ë¶„ ì „ì†¡ íŒŒì¼ ìœ ì§€</span>

<span class="c1"># ì‚­ì œ ì˜µì…˜</span>
--delete<span class="w">            </span><span class="c1"># ëŒ€ìƒì—ë§Œ ìˆëŠ” íŒŒì¼ ì‚­ì œ</span>
--delete-before<span class="w">     </span><span class="c1"># ì „ì†¡ ì „ ì‚­ì œ</span>
--delete-after<span class="w">      </span><span class="c1"># ì „ì†¡ í›„ ì‚­ì œ</span>
--delete-excluded<span class="w">   </span><span class="c1"># ì œì™¸ëœ íŒŒì¼ë„ ì‚­ì œ</span>

<span class="c1"># ë™ê¸°í™” ì •ë°€ ì˜µì…˜</span>
-c,<span class="w"> </span>--checksum<span class="w">      </span><span class="c1"># ì²´í¬ì„¬ìœ¼ë¡œ ë¹„êµ (ëŠë¦¼)</span>
-u,<span class="w"> </span>--update<span class="w">        </span><span class="c1"># ëŒ€ìƒì´ ë” ìƒˆë¡œìš°ë©´ ê±´ë„ˆë›°ê¸°</span>
--ignore-existing<span class="w">   </span><span class="c1"># ì¡´ì¬í•˜ëŠ” íŒŒì¼ ê±´ë„ˆë›°ê¸°</span>
</code></pre></div>

<h3 id="_7">ì œì™¸ íŒ¨í„´<a class="header-link" href="#_7" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><span class="c1"># íŠ¹ì • íŒ¨í„´ ì œì™¸</span>
rsync<span class="w"> </span>-av<span class="w"> </span>--exclude<span class="o">=</span><span class="s1">&#39;*.log&#39;</span><span class="w"> </span>--exclude<span class="o">=</span><span class="s1">&#39;cache/&#39;</span><span class="w"> </span>/source/<span class="w"> </span>/backup/

<span class="c1"># ì œì™¸ íŒŒì¼ ì‚¬ìš©</span>
rsync<span class="w"> </span>-av<span class="w"> </span>--exclude-from<span class="o">=</span><span class="s1">&#39;exclude.txt&#39;</span><span class="w"> </span>/source/<span class="w"> </span>/backup/
</code></pre></div>

<div class="highlight"><pre><span></span><code><span class="c1"># exclude.txt ì˜ˆì‹œ</span>
*.log
*.tmp
*.cache
.git/
node_modules/
__pycache__/
.DS_Store
Thumbs.db
</code></pre></div>

<h3 id="_8">ì¦ë¶„ ë°±ì—… ìŠ¤í¬ë¦½íŠ¸<a class="header-link" href="#_8" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><span class="ch">#!/bin/bash</span>
<span class="c1"># incremental-backup.sh</span>

<span class="c1"># ì„¤ì •</span>
<span class="nv">SOURCE</span><span class="o">=</span><span class="s2">&quot;/data&quot;</span>
<span class="nv">BACKUP_BASE</span><span class="o">=</span><span class="s2">&quot;/backup&quot;</span>
<span class="nv">LATEST_LINK</span><span class="o">=</span><span class="s2">&quot;</span><span class="nv">$BACKUP_BASE</span><span class="s2">/latest&quot;</span>
<span class="nv">DATE</span><span class="o">=</span><span class="k">$(</span>date<span class="w"> </span>+%Y-%m-%d_%H-%M-%S<span class="k">)</span>
<span class="nv">BACKUP_PATH</span><span class="o">=</span><span class="s2">&quot;</span><span class="nv">$BACKUP_BASE</span><span class="s2">/</span><span class="nv">$DATE</span><span class="s2">&quot;</span>

<span class="c1"># ì´ì „ ë°±ì—…ì´ ìˆìœ¼ë©´ í•˜ë“œë§í¬ ì‚¬ìš©</span>
<span class="k">if</span><span class="w"> </span><span class="o">[</span><span class="w"> </span>-d<span class="w"> </span><span class="s2">&quot;</span><span class="nv">$LATEST_LINK</span><span class="s2">&quot;</span><span class="w"> </span><span class="o">]</span><span class="p">;</span><span class="w"> </span><span class="k">then</span>
<span class="w">    </span><span class="nv">LINK_DEST</span><span class="o">=</span><span class="s2">&quot;--link-dest=</span><span class="nv">$LATEST_LINK</span><span class="s2">&quot;</span>
<span class="k">else</span>
<span class="w">    </span><span class="nv">LINK_DEST</span><span class="o">=</span><span class="s2">&quot;&quot;</span>
<span class="k">fi</span>

<span class="c1"># rsync ì‹¤í–‰</span>
rsync<span class="w"> </span>-av<span class="w"> </span>--delete<span class="w"> </span><span class="se">\</span>
<span class="w">    </span><span class="nv">$LINK_DEST</span><span class="w"> </span><span class="se">\</span>
<span class="w">    </span>--exclude<span class="o">=</span><span class="s1">&#39;*.tmp&#39;</span><span class="w"> </span><span class="se">\</span>
<span class="w">    </span>--exclude<span class="o">=</span><span class="s1">&#39;cache/&#39;</span><span class="w"> </span><span class="se">\</span>
<span class="w">    </span><span class="s2">&quot;</span><span class="nv">$SOURCE</span><span class="s2">/&quot;</span><span class="w"> </span><span class="se">\</span>
<span class="w">    </span><span class="s2">&quot;</span><span class="nv">$BACKUP_PATH</span><span class="s2">/&quot;</span>

<span class="c1"># ìµœì‹  ë§í¬ ì—…ë°ì´íŠ¸</span>
rm<span class="w"> </span>-f<span class="w"> </span><span class="s2">&quot;</span><span class="nv">$LATEST_LINK</span><span class="s2">&quot;</span>
ln<span class="w"> </span>-s<span class="w"> </span><span class="s2">&quot;</span><span class="nv">$BACKUP_PATH</span><span class="s2">&quot;</span><span class="w"> </span><span class="s2">&quot;</span><span class="nv">$LATEST_LINK</span><span class="s2">&quot;</span>

<span class="c1"># 30ì¼ ì´ìƒ ëœ ë°±ì—… ì‚­ì œ</span>
find<span class="w"> </span><span class="s2">&quot;</span><span class="nv">$BACKUP_BASE</span><span class="s2">&quot;</span><span class="w"> </span>-maxdepth<span class="w"> </span><span class="m">1</span><span class="w"> </span>-type<span class="w"> </span>d<span class="w"> </span>-mtime<span class="w"> </span>+30<span class="w"> </span>-exec<span class="w"> </span>rm<span class="w"> </span>-rf<span class="w"> </span><span class="o">{}</span><span class="w"> </span><span class="se">\;</span>

<span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;Backup completed: </span><span class="nv">$BACKUP_PATH</span><span class="s2">&quot;</span>
</code></pre></div>

<h3 id="ssh">SSH í‚¤ ì„¤ì • (ì›ê²© ë°±ì—…ìš©)<a class="header-link" href="#ssh" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><span class="c1"># ë°±ì—… ì „ìš© í‚¤ ìƒì„±</span>
ssh-keygen<span class="w"> </span>-t<span class="w"> </span>ed25519<span class="w"> </span>-f<span class="w"> </span>~/.ssh/backup_key<span class="w"> </span>-N<span class="w"> </span><span class="s2">&quot;&quot;</span>

<span class="c1"># ì›ê²© ì„œë²„ì— í‚¤ ë³µì‚¬</span>
ssh-copy-id<span class="w"> </span>-i<span class="w"> </span>~/.ssh/backup_key.pub<span class="w"> </span>user@backup-server

<span class="c1"># ìë™í™”ë¥¼ ìœ„í•œ config ì„¤ì •</span>
cat<span class="w"> </span>&gt;&gt;<span class="w"> </span>~/.ssh/config<span class="w"> </span><span class="s">&lt;&lt; EOF</span>
<span class="s">Host backup-server</span>
<span class="s">    HostName 192.168.1.100</span>
<span class="s">    User backupuser</span>
<span class="s">    IdentityFile ~/.ssh/backup_key</span>
<span class="s">    StrictHostKeyChecking no</span>
<span class="s">EOF</span>

<span class="c1"># ì›ê²© ë°±ì—… ì‹¤í–‰</span>
rsync<span class="w"> </span>-avz<span class="w"> </span>-e<span class="w"> </span><span class="s2">&quot;ssh -i ~/.ssh/backup_key&quot;</span><span class="w"> </span>/data/<span class="w"> </span>backup-server:/backup/
</code></pre></div>

<h3 id="_9">ëŒ€ì—­í­ ì œí•œ<a class="header-link" href="#_9" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><span class="c1"># 10MB/së¡œ ì œí•œ</span>
rsync<span class="w"> </span>-av<span class="w"> </span>--bwlimit<span class="o">=</span><span class="m">10000</span><span class="w"> </span>/source/<span class="w"> </span>/backup/

<span class="c1"># ì—…ë¬´ ì‹œê°„ ì™¸ì—ë§Œ ë¹ ë¥¸ ì†ë„</span>
<span class="k">if</span><span class="w"> </span><span class="o">[</span><span class="w"> </span><span class="k">$(</span>date<span class="w"> </span>+%H<span class="k">)</span><span class="w"> </span>-ge<span class="w"> </span><span class="m">18</span><span class="w"> </span><span class="o">]</span><span class="w"> </span><span class="o">||</span><span class="w"> </span><span class="o">[</span><span class="w"> </span><span class="k">$(</span>date<span class="w"> </span>+%H<span class="k">)</span><span class="w"> </span>-lt<span class="w"> </span><span class="m">8</span><span class="w"> </span><span class="o">]</span><span class="p">;</span><span class="w"> </span><span class="k">then</span>
<span class="w">    </span><span class="nv">BWLIMIT</span><span class="o">=</span><span class="s2">&quot;&quot;</span>
<span class="k">else</span>
<span class="w">    </span><span class="nv">BWLIMIT</span><span class="o">=</span><span class="s2">&quot;--bwlimit=5000&quot;</span>
<span class="k">fi</span>
rsync<span class="w"> </span>-av<span class="w"> </span><span class="nv">$BWLIMIT</span><span class="w"> </span>/source/<span class="w"> </span>/backup/
</code></pre></div>

<hr />
<h2 id="3-borg-backup">3. Borg Backup<a class="header-link" href="#3-borg-backup" title="Permanent link">&para;</a></h2>
<h3 id="borg">Borg ì†Œê°œ<a class="header-link" href="#borg" title="Permanent link">&para;</a></h3>
<p>Borg Backupì€ ì¤‘ë³µ ì œê±°, ì••ì¶•, ì•”í˜¸í™”ë¥¼ ì§€ì›í•˜ëŠ” ë°±ì—… í”„ë¡œê·¸ë¨ì…ë‹ˆë‹¤.</p>
<div class="highlight"><pre><span></span><code><span class="c1"># ì„¤ì¹˜</span>
<span class="c1"># Ubuntu/Debian</span>
sudo<span class="w"> </span>apt<span class="w"> </span>install<span class="w"> </span>borgbackup

<span class="c1"># RHEL/CentOS</span>
sudo<span class="w"> </span>yum<span class="w"> </span>install<span class="w"> </span>epel-release
sudo<span class="w"> </span>yum<span class="w"> </span>install<span class="w"> </span>borgbackup

<span class="c1"># pipë¡œ ì„¤ì¹˜</span>
pip<span class="w"> </span>install<span class="w"> </span>borgbackup
</code></pre></div>

<h3 id="_10">ì €ì¥ì†Œ ì´ˆê¸°í™”<a class="header-link" href="#_10" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><span class="c1"># ë¡œì»¬ ì €ì¥ì†Œ ìƒì„±</span>
borg<span class="w"> </span>init<span class="w"> </span>--encryption<span class="o">=</span>repokey<span class="w"> </span>/backup/borg-repo

<span class="c1"># ì›ê²© ì €ì¥ì†Œ ìƒì„±</span>
borg<span class="w"> </span>init<span class="w"> </span>--encryption<span class="o">=</span>repokey<span class="w"> </span>user@server:/backup/borg-repo

<span class="c1"># ì•”í˜¸í™” ì˜µì…˜</span>
<span class="c1"># none       - ì•”í˜¸í™” ì—†ìŒ</span>
<span class="c1"># repokey    - ì €ì¥ì†Œì— í‚¤ ì €ì¥ (ê¶Œì¥)</span>
<span class="c1"># keyfile    - ë¡œì»¬ íŒŒì¼ì— í‚¤ ì €ì¥</span>
<span class="c1"># repokey-blake2 - ë” ë¹ ë¥¸ í•´ì‹œ</span>
</code></pre></div>

<h3 id="_11">ë°±ì—… ìƒì„±<a class="header-link" href="#_11" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><span class="c1"># ê¸°ë³¸ ë°±ì—…</span>
borg<span class="w"> </span>create<span class="w"> </span>/backup/borg-repo::backup-<span class="o">{</span>now<span class="o">}</span><span class="w"> </span>/data

<span class="c1"># ì˜µì…˜ ì‚¬ìš©</span>
borg<span class="w"> </span>create<span class="w"> </span><span class="se">\</span>
<span class="w">    </span>--verbose<span class="w"> </span><span class="se">\</span>
<span class="w">    </span>--progress<span class="w"> </span><span class="se">\</span>
<span class="w">    </span>--stats<span class="w"> </span><span class="se">\</span>
<span class="w">    </span>--compression<span class="w"> </span>lz4<span class="w"> </span><span class="se">\</span>
<span class="w">    </span>--exclude<span class="w"> </span><span class="s1">&#39;*.tmp&#39;</span><span class="w"> </span><span class="se">\</span>
<span class="w">    </span>--exclude<span class="w"> </span><span class="s1">&#39;cache/&#39;</span><span class="w"> </span><span class="se">\</span>
<span class="w">    </span>/backup/borg-repo::backup-<span class="o">{</span>now:%Y-%m-%d_%H-%M<span class="o">}</span><span class="w"> </span><span class="se">\</span>
<span class="w">    </span>/home<span class="w"> </span><span class="se">\</span>
<span class="w">    </span>/etc<span class="w"> </span><span class="se">\</span>
<span class="w">    </span>/var/www
</code></pre></div>

<h3 id="_12">ì••ì¶• ì˜µì…˜<a class="header-link" href="#_12" title="Permanent link">&para;</a></h3>
<table>
<thead>
<tr>
<th>ì˜µì…˜</th>
<th>ì„¤ëª…</th>
<th>ì†ë„</th>
<th>ì••ì¶•ë¥ </th>
</tr>
</thead>
<tbody>
<tr>
<td><code>none</code></td>
<td>ì••ì¶• ì—†ìŒ</td>
<td>ê°€ì¥ ë¹ ë¦„</td>
<td>ì—†ìŒ</td>
</tr>
<tr>
<td><code>lz4</code></td>
<td>ë¹ ë¥¸ ì••ì¶•</td>
<td>ë¹ ë¦„</td>
<td>ë‚®ìŒ</td>
</tr>
<tr>
<td><code>zstd</code></td>
<td>ê· í˜•ì¡íŒ ì••ì¶•</td>
<td>ë³´í†µ</td>
<td>ì¤‘ê°„</td>
</tr>
<tr>
<td><code>zlib</code></td>
<td>gzip í˜¸í™˜</td>
<td>ëŠë¦¼</td>
<td>ë†’ìŒ</td>
</tr>
<tr>
<td><code>lzma</code></td>
<td>ìµœëŒ€ ì••ì¶•</td>
<td>ë§¤ìš° ëŠë¦¼</td>
<td>ìµœê³ </td>
</tr>
</tbody>
</table>
<h3 id="_13">ë°±ì—… ê´€ë¦¬<a class="header-link" href="#_13" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><span class="c1"># ë°±ì—… ëª©ë¡</span>
borg<span class="w"> </span>list<span class="w"> </span>/backup/borg-repo

<span class="c1"># ë°±ì—… ìƒì„¸ ì •ë³´</span>
borg<span class="w"> </span>info<span class="w"> </span>/backup/borg-repo::backup-2024-01-15

<span class="c1"># ë°±ì—… ë‚´ìš© í™•ì¸</span>
borg<span class="w"> </span>list<span class="w"> </span>/backup/borg-repo::backup-2024-01-15

<span class="c1"># íŠ¹ì • ê²½ë¡œë§Œ í™•ì¸</span>
borg<span class="w"> </span>list<span class="w"> </span>/backup/borg-repo::backup-2024-01-15<span class="w"> </span>/home/user/

<span class="c1"># ë°±ì—… ë¹„êµ</span>
borg<span class="w"> </span>diff<span class="w"> </span>/backup/borg-repo::backup-2024-01-14<span class="w"> </span>backup-2024-01-15
</code></pre></div>

<h3 id="_14">ë³µêµ¬<a class="header-link" href="#_14" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><span class="c1"># ì „ì²´ ë³µêµ¬</span>
<span class="nb">cd</span><span class="w"> </span>/restore
borg<span class="w"> </span>extract<span class="w"> </span>/backup/borg-repo::backup-2024-01-15

<span class="c1"># íŠ¹ì • íŒŒì¼/ë””ë ‰í† ë¦¬ ë³µêµ¬</span>
borg<span class="w"> </span>extract<span class="w"> </span>/backup/borg-repo::backup-2024-01-15<span class="w"> </span>home/user/documents

<span class="c1"># ì›ë˜ ê²½ë¡œë¡œ ë³µêµ¬</span>
<span class="nb">cd</span><span class="w"> </span>/
borg<span class="w"> </span>extract<span class="w"> </span>/backup/borg-repo::backup-2024-01-15<span class="w"> </span>etc/nginx/

<span class="c1"># íŠ¹ì • ì‹œì ìœ¼ë¡œ ë§ˆìš´íŠ¸ (FUSE)</span>
mkdir<span class="w"> </span>/mnt/borg
borg<span class="w"> </span>mount<span class="w"> </span>/backup/borg-repo::backup-2024-01-15<span class="w"> </span>/mnt/borg
<span class="c1"># íŒŒì¼ íƒìƒ‰ í›„</span>
borg<span class="w"> </span>umount<span class="w"> </span>/mnt/borg
</code></pre></div>

<h3 id="pruning">ë³´ì¡´ ì •ì±… (Pruning)<a class="header-link" href="#pruning" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><span class="c1"># ìë™ ì •ë¦¬</span>
borg<span class="w"> </span>prune<span class="w"> </span><span class="se">\</span>
<span class="w">    </span>--keep-hourly<span class="o">=</span><span class="m">24</span><span class="w"> </span><span class="se">\</span>
<span class="w">    </span>--keep-daily<span class="o">=</span><span class="m">7</span><span class="w"> </span><span class="se">\</span>
<span class="w">    </span>--keep-weekly<span class="o">=</span><span class="m">4</span><span class="w"> </span><span class="se">\</span>
<span class="w">    </span>--keep-monthly<span class="o">=</span><span class="m">12</span><span class="w"> </span><span class="se">\</span>
<span class="w">    </span>--keep-yearly<span class="o">=</span><span class="m">2</span><span class="w"> </span><span class="se">\</span>
<span class="w">    </span>/backup/borg-repo

<span class="c1"># ë“œë¼ì´ëŸ° (ì‹¤ì œ ì‚­ì œ ì•ˆ í•¨)</span>
borg<span class="w"> </span>prune<span class="w"> </span>--dry-run<span class="w"> </span>--list<span class="w"> </span><span class="se">\</span>
<span class="w">    </span>--keep-daily<span class="o">=</span><span class="m">7</span><span class="w"> </span><span class="se">\</span>
<span class="w">    </span>/backup/borg-repo
</code></pre></div>

<h3 id="borg_1">Borg ë°±ì—… ìŠ¤í¬ë¦½íŠ¸<a class="header-link" href="#borg_1" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><span class="ch">#!/bin/bash</span>
<span class="c1"># borg-backup.sh</span>

<span class="c1"># í™˜ê²½ ë³€ìˆ˜ ì„¤ì •</span>
<span class="nb">export</span><span class="w"> </span><span class="nv">BORG_REPO</span><span class="o">=</span><span class="s2">&quot;user@backup-server:/backup/borg-repo&quot;</span>
<span class="nb">export</span><span class="w"> </span><span class="nv">BORG_PASSPHRASE</span><span class="o">=</span><span class="s2">&quot;your-secure-passphrase&quot;</span>

<span class="c1"># ë¡œê·¸ íŒŒì¼</span>
<span class="nv">LOG_FILE</span><span class="o">=</span><span class="s2">&quot;/var/log/borg-backup.log&quot;</span>

<span class="c1"># ë°±ì—… í•¨ìˆ˜</span>
backup<span class="o">()</span><span class="w"> </span><span class="o">{</span>
<span class="w">    </span><span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;Starting backup: </span><span class="k">$(</span>date<span class="k">)</span><span class="s2">&quot;</span><span class="w"> </span>&gt;&gt;<span class="w"> </span><span class="s2">&quot;</span><span class="nv">$LOG_FILE</span><span class="s2">&quot;</span>

<span class="w">    </span>borg<span class="w"> </span>create<span class="w"> </span><span class="se">\</span>
<span class="w">        </span>--verbose<span class="w"> </span><span class="se">\</span>
<span class="w">        </span>--filter<span class="w"> </span>AME<span class="w"> </span><span class="se">\</span>
<span class="w">        </span>--list<span class="w"> </span><span class="se">\</span>
<span class="w">        </span>--stats<span class="w"> </span><span class="se">\</span>
<span class="w">        </span>--compression<span class="w"> </span>lz4<span class="w"> </span><span class="se">\</span>
<span class="w">        </span>--exclude-caches<span class="w"> </span><span class="se">\</span>
<span class="w">        </span>--exclude<span class="w"> </span><span class="s1">&#39;/home/*/.cache&#39;</span><span class="w"> </span><span class="se">\</span>
<span class="w">        </span>--exclude<span class="w"> </span><span class="s1">&#39;/var/tmp/*&#39;</span><span class="w"> </span><span class="se">\</span>
<span class="w">        </span>--exclude<span class="w"> </span><span class="s1">&#39;/var/cache/*&#39;</span><span class="w"> </span><span class="se">\</span>
<span class="w">        </span>::<span class="s1">&#39;{hostname}-{now:%Y-%m-%d_%H:%M}&#39;</span><span class="w"> </span><span class="se">\</span>
<span class="w">        </span>/etc<span class="w"> </span><span class="se">\</span>
<span class="w">        </span>/home<span class="w"> </span><span class="se">\</span>
<span class="w">        </span>/var/www<span class="w"> </span><span class="se">\</span>
<span class="w">        </span>/var/lib/mysql<span class="w"> </span><span class="se">\</span>
<span class="w">        </span><span class="m">2</span>&gt;&gt;<span class="w"> </span><span class="s2">&quot;</span><span class="nv">$LOG_FILE</span><span class="s2">&quot;</span>

<span class="w">    </span><span class="nv">backup_exit</span><span class="o">=</span><span class="nv">$?</span>

<span class="w">    </span><span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;Backup finished with exit code: </span><span class="nv">$backup_exit</span><span class="s2">&quot;</span><span class="w"> </span>&gt;&gt;<span class="w"> </span><span class="s2">&quot;</span><span class="nv">$LOG_FILE</span><span class="s2">&quot;</span>
<span class="o">}</span>

<span class="c1"># ì •ë¦¬ í•¨ìˆ˜</span>
prune<span class="o">()</span><span class="w"> </span><span class="o">{</span>
<span class="w">    </span><span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;Starting prune: </span><span class="k">$(</span>date<span class="k">)</span><span class="s2">&quot;</span><span class="w"> </span>&gt;&gt;<span class="w"> </span><span class="s2">&quot;</span><span class="nv">$LOG_FILE</span><span class="s2">&quot;</span>

<span class="w">    </span>borg<span class="w"> </span>prune<span class="w"> </span><span class="se">\</span>
<span class="w">        </span>--list<span class="w"> </span><span class="se">\</span>
<span class="w">        </span>--keep-hourly<span class="o">=</span><span class="m">24</span><span class="w"> </span><span class="se">\</span>
<span class="w">        </span>--keep-daily<span class="o">=</span><span class="m">7</span><span class="w"> </span><span class="se">\</span>
<span class="w">        </span>--keep-weekly<span class="o">=</span><span class="m">4</span><span class="w"> </span><span class="se">\</span>
<span class="w">        </span>--keep-monthly<span class="o">=</span><span class="m">6</span><span class="w"> </span><span class="se">\</span>
<span class="w">        </span><span class="m">2</span>&gt;&gt;<span class="w"> </span><span class="s2">&quot;</span><span class="nv">$LOG_FILE</span><span class="s2">&quot;</span>

<span class="w">    </span><span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;Prune finished&quot;</span><span class="w"> </span>&gt;&gt;<span class="w"> </span><span class="s2">&quot;</span><span class="nv">$LOG_FILE</span><span class="s2">&quot;</span>
<span class="o">}</span>

<span class="c1"># ì €ì¥ì†Œ ì •í•©ì„± ê²€ì‚¬ (ì£¼ê°„)</span>
check<span class="o">()</span><span class="w"> </span><span class="o">{</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="o">[</span><span class="w"> </span><span class="k">$(</span>date<span class="w"> </span>+%u<span class="k">)</span><span class="w"> </span>-eq<span class="w"> </span><span class="m">7</span><span class="w"> </span><span class="o">]</span><span class="p">;</span><span class="w"> </span><span class="k">then</span>
<span class="w">        </span><span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;Starting check: </span><span class="k">$(</span>date<span class="k">)</span><span class="s2">&quot;</span><span class="w"> </span>&gt;&gt;<span class="w"> </span><span class="s2">&quot;</span><span class="nv">$LOG_FILE</span><span class="s2">&quot;</span>
<span class="w">        </span>borg<span class="w"> </span>check<span class="w"> </span><span class="m">2</span>&gt;&gt;<span class="w"> </span><span class="s2">&quot;</span><span class="nv">$LOG_FILE</span><span class="s2">&quot;</span>
<span class="w">        </span><span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;Check finished&quot;</span><span class="w"> </span>&gt;&gt;<span class="w"> </span><span class="s2">&quot;</span><span class="nv">$LOG_FILE</span><span class="s2">&quot;</span>
<span class="w">    </span><span class="k">fi</span>
<span class="o">}</span>

<span class="c1"># ì‹¤í–‰</span>
backup
prune
check

<span class="c1"># ì•Œë¦¼ (ì‹¤íŒ¨ ì‹œ)</span>
<span class="k">if</span><span class="w"> </span><span class="o">[</span><span class="w"> </span><span class="nv">$backup_exit</span><span class="w"> </span>-ne<span class="w"> </span><span class="m">0</span><span class="w"> </span><span class="o">]</span><span class="p">;</span><span class="w"> </span><span class="k">then</span>
<span class="w">    </span><span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;Backup failed!&quot;</span><span class="w"> </span><span class="p">|</span><span class="w"> </span>mail<span class="w"> </span>-s<span class="w"> </span><span class="s2">&quot;Borg Backup Alert&quot;</span><span class="w"> </span>admin@example.com
<span class="k">fi</span>
</code></pre></div>

<hr />
<h2 id="4-tarcpio">4. tar/cpio ë°±ì—…<a class="header-link" href="#4-tarcpio" title="Permanent link">&para;</a></h2>
<h3 id="tar">tar ë°±ì—…<a class="header-link" href="#tar" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><span class="c1"># ê¸°ë³¸ ì••ì¶• ë°±ì—…</span>
tar<span class="w"> </span>-czvf<span class="w"> </span>backup.tar.gz<span class="w"> </span>/data

<span class="c1"># ì¦ë¶„ ë°±ì—… (snapshot ì‚¬ìš©)</span>
tar<span class="w"> </span>--create<span class="w"> </span><span class="se">\</span>
<span class="w">    </span>--gzip<span class="w"> </span><span class="se">\</span>
<span class="w">    </span>--listed-incremental<span class="o">=</span>/backup/snapshot.snar<span class="w"> </span><span class="se">\</span>
<span class="w">    </span>--file<span class="o">=</span>/backup/backup-<span class="k">$(</span>date<span class="w"> </span>+%Y%m%d<span class="k">)</span>.tar.gz<span class="w"> </span><span class="se">\</span>
<span class="w">    </span>/data

<span class="c1"># ë³µì›</span>
tar<span class="w"> </span>--extract<span class="w"> </span><span class="se">\</span>
<span class="w">    </span>--gzip<span class="w"> </span><span class="se">\</span>
<span class="w">    </span>--listed-incremental<span class="o">=</span>/dev/null<span class="w"> </span><span class="se">\</span>
<span class="w">    </span>--file<span class="o">=</span>/backup/backup-20240115.tar.gz<span class="w"> </span><span class="se">\</span>
<span class="w">    </span>-C<span class="w"> </span>/restore

<span class="c1"># ì œì™¸ íŒ¨í„´</span>
tar<span class="w"> </span>-czvf<span class="w"> </span>backup.tar.gz<span class="w"> </span><span class="se">\</span>
<span class="w">    </span>--exclude<span class="o">=</span><span class="s1">&#39;*.log&#39;</span><span class="w"> </span><span class="se">\</span>
<span class="w">    </span>--exclude<span class="o">=</span><span class="s1">&#39;cache&#39;</span><span class="w"> </span><span class="se">\</span>
<span class="w">    </span>/data
</code></pre></div>

<h3 id="cpio">cpio ë°±ì—…<a class="header-link" href="#cpio" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><span class="c1"># ë°±ì—… ìƒì„±</span>
find<span class="w"> </span>/data<span class="w"> </span>-print<span class="w"> </span><span class="p">|</span><span class="w"> </span>cpio<span class="w"> </span>-ov<span class="w"> </span>&gt;<span class="w"> </span>backup.cpio

<span class="c1"># ì••ì¶• ë°±ì—…</span>
find<span class="w"> </span>/data<span class="w"> </span>-print<span class="w"> </span><span class="p">|</span><span class="w"> </span>cpio<span class="w"> </span>-ov<span class="w"> </span><span class="p">|</span><span class="w"> </span>gzip<span class="w"> </span>&gt;<span class="w"> </span>backup.cpio.gz

<span class="c1"># ë³µì›</span>
cpio<span class="w"> </span>-iv<span class="w"> </span>&lt;<span class="w"> </span>backup.cpio

<span class="c1"># ì••ì¶• íŒŒì¼ ë³µì›</span>
gunzip<span class="w"> </span>-c<span class="w"> </span>backup.cpio.gz<span class="w"> </span><span class="p">|</span><span class="w"> </span>cpio<span class="w"> </span>-iv

<span class="c1"># íŠ¹ì • íŒŒì¼ë§Œ ë³µì›</span>
cpio<span class="w"> </span>-iv<span class="w"> </span><span class="s2">&quot;*.conf&quot;</span><span class="w"> </span>&lt;<span class="w"> </span>backup.cpio
</code></pre></div>

<hr />
<h2 id="5">5. ì‹œìŠ¤í…œ ì´ë¯¸ì§€ ë°±ì—…<a class="header-link" href="#5" title="Permanent link">&para;</a></h2>
<h3 id="dd">ddë¥¼ ì´ìš©í•œ ë””ìŠ¤í¬ ì´ë¯¸ì§€<a class="header-link" href="#dd" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><span class="c1"># ì „ì²´ ë””ìŠ¤í¬ ë°±ì—…</span>
sudo<span class="w"> </span>dd<span class="w"> </span><span class="k">if</span><span class="o">=</span>/dev/sda<span class="w"> </span><span class="nv">of</span><span class="o">=</span>/backup/disk.img<span class="w"> </span><span class="nv">bs</span><span class="o">=</span>4M<span class="w"> </span><span class="nv">status</span><span class="o">=</span>progress

<span class="c1"># ì••ì¶•ê³¼ í•¨ê»˜</span>
sudo<span class="w"> </span>dd<span class="w"> </span><span class="k">if</span><span class="o">=</span>/dev/sda<span class="w"> </span><span class="nv">bs</span><span class="o">=</span>4M<span class="w"> </span><span class="nv">status</span><span class="o">=</span>progress<span class="w"> </span><span class="p">|</span><span class="w"> </span>gzip<span class="w"> </span>&gt;<span class="w"> </span>/backup/disk.img.gz

<span class="c1"># ë³µì›</span>
sudo<span class="w"> </span>dd<span class="w"> </span><span class="k">if</span><span class="o">=</span>/backup/disk.img<span class="w"> </span><span class="nv">of</span><span class="o">=</span>/dev/sda<span class="w"> </span><span class="nv">bs</span><span class="o">=</span>4M<span class="w"> </span><span class="nv">status</span><span class="o">=</span>progress

<span class="c1"># ì••ì¶•ëœ ì´ë¯¸ì§€ ë³µì›</span>
gunzip<span class="w"> </span>-c<span class="w"> </span>/backup/disk.img.gz<span class="w"> </span><span class="p">|</span><span class="w"> </span>sudo<span class="w"> </span>dd<span class="w"> </span><span class="nv">of</span><span class="o">=</span>/dev/sda<span class="w"> </span><span class="nv">bs</span><span class="o">=</span>4M<span class="w"> </span><span class="nv">status</span><span class="o">=</span>progress

<span class="c1"># íŒŒí‹°ì…˜ë§Œ ë°±ì—…</span>
sudo<span class="w"> </span>dd<span class="w"> </span><span class="k">if</span><span class="o">=</span>/dev/sda1<span class="w"> </span><span class="nv">of</span><span class="o">=</span>/backup/partition.img<span class="w"> </span><span class="nv">bs</span><span class="o">=</span>4M<span class="w"> </span><span class="nv">status</span><span class="o">=</span>progress
</code></pre></div>

<h3 id="clonezilla">Clonezilla<a class="header-link" href="#clonezilla" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><span class="c1"># Clonezilla Live USB ìƒì„± í›„</span>

<span class="c1"># ë””ìŠ¤í¬ ì´ë¯¸ì§€ ìƒì„± (ëª…ë ¹ì¤„)</span>
/usr/sbin/ocs-sr<span class="w"> </span>-q2<span class="w"> </span>-c<span class="w"> </span>-j2<span class="w"> </span>-z1<span class="w"> </span>-i<span class="w"> </span><span class="m">4096</span><span class="w"> </span>-sfsck<span class="w"> </span>-senc<span class="w"> </span>-p<span class="w"> </span><span class="nb">true</span><span class="w"> </span><span class="se">\</span>
<span class="w">    </span>savedisk<span class="w"> </span>img_name<span class="w"> </span>sda

<span class="c1"># ë³µì›</span>
/usr/sbin/ocs-sr<span class="w"> </span>-g<span class="w"> </span>auto<span class="w"> </span>-e1<span class="w"> </span>auto<span class="w"> </span>-e2<span class="w"> </span>-r<span class="w"> </span>-j2<span class="w"> </span>-c<span class="w"> </span>-scr<span class="w"> </span>-p<span class="w"> </span><span class="nb">true</span><span class="w"> </span><span class="se">\</span>
<span class="w">    </span>restoredisk<span class="w"> </span>img_name<span class="w"> </span>sda
</code></pre></div>

<h3 id="lvm">LVM ìŠ¤ëƒ…ìƒ· ë°±ì—…<a class="header-link" href="#lvm" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><span class="c1"># ìŠ¤ëƒ…ìƒ· ìƒì„±</span>
sudo<span class="w"> </span>lvcreate<span class="w"> </span>-L<span class="w"> </span>10G<span class="w"> </span>-s<span class="w"> </span>-n<span class="w"> </span>data-snap<span class="w"> </span>/dev/vg0/data

<span class="c1"># ìŠ¤ëƒ…ìƒ· ë§ˆìš´íŠ¸</span>
sudo<span class="w"> </span>mkdir<span class="w"> </span>/mnt/snapshot
sudo<span class="w"> </span>mount<span class="w"> </span>-o<span class="w"> </span>ro<span class="w"> </span>/dev/vg0/data-snap<span class="w"> </span>/mnt/snapshot

<span class="c1"># ë°±ì—… ìˆ˜í–‰</span>
rsync<span class="w"> </span>-av<span class="w"> </span>/mnt/snapshot/<span class="w"> </span>/backup/data/

<span class="c1"># ì •ë¦¬</span>
sudo<span class="w"> </span>umount<span class="w"> </span>/mnt/snapshot
sudo<span class="w"> </span>lvremove<span class="w"> </span>/dev/vg0/data-snap
</code></pre></div>

<hr />
<h2 id="6">6. ì¬í•´ë³µêµ¬ ì „ëµ<a class="header-link" href="#6" title="Permanent link">&para;</a></h2>
<h3 id="dr">DR ê³„íš êµ¬ì„±ìš”ì†Œ<a class="header-link" href="#dr" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code>â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    ì¬í•´ë³µêµ¬ ê³„íš                            â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  1. ë¦¬ìŠ¤í¬ í‰ê°€                                             â”‚
â”‚     - ì ì¬ì  ìœ„í˜‘ ì‹ë³„                                      â”‚
â”‚     - ë¹„ì¦ˆë‹ˆìŠ¤ ì˜í–¥ ë¶„ì„                                    â”‚
â”‚                                                             â”‚
â”‚  2. ë³µêµ¬ ëª©í‘œ ì„¤ì •                                          â”‚
â”‚     - RTO/RPO ì •ì˜                                          â”‚
â”‚     - ìš°ì„ ìˆœìœ„ ê²°ì •                                         â”‚
â”‚                                                             â”‚
â”‚  3. ë°±ì—… ì „ëµ                                               â”‚
â”‚     - ë°±ì—… ìœ í˜• ë° ì£¼ê¸°                                     â”‚
â”‚     - ì €ì¥ ìœ„ì¹˜ (ì˜¨ì‚¬ì´íŠ¸/ì˜¤í”„ì‚¬ì´íŠ¸)                      â”‚
â”‚                                                             â”‚
â”‚  4. ë³µêµ¬ ì ˆì°¨                                               â”‚
â”‚     - ë‹¨ê³„ë³„ ë³µêµ¬ ê°€ì´ë“œ                                    â”‚
â”‚     - ì—°ë½ì²˜ ë° ì—­í•                                         â”‚
â”‚                                                             â”‚
â”‚  5. í…ŒìŠ¤íŠ¸ ë° ìœ ì§€ë³´ìˆ˜                                      â”‚
â”‚     - ì •ê¸°ì  ë³µêµ¬ í…ŒìŠ¤íŠ¸                                    â”‚
â”‚     - ë¬¸ì„œ ì—…ë°ì´íŠ¸                                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
</code></pre></div>

<h3 id="_15">ë³µêµ¬ ì²´í¬ë¦¬ìŠ¤íŠ¸<a class="header-link" href="#_15" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><span class="ch">#!/bin/bash</span>
<span class="c1"># disaster-recovery-checklist.sh</span>

<span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;=== ì¬í•´ë³µêµ¬ ì²´í¬ë¦¬ìŠ¤íŠ¸ ===&quot;</span>

<span class="c1"># 1. í•˜ë“œì›¨ì–´ ìƒíƒœ í™•ì¸</span>
<span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;[1] í•˜ë“œì›¨ì–´ ìƒíƒœ í™•ì¸&quot;</span>
lsblk
free<span class="w"> </span>-h
cat<span class="w"> </span>/proc/cpuinfo<span class="w"> </span><span class="p">|</span><span class="w"> </span>grep<span class="w"> </span><span class="s2">&quot;model name&quot;</span><span class="w"> </span><span class="p">|</span><span class="w"> </span>head<span class="w"> </span>-1

<span class="c1"># 2. ë„¤íŠ¸ì›Œí¬ ì—°ê²° í™•ì¸</span>
<span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;[2] ë„¤íŠ¸ì›Œí¬ ì—°ê²°&quot;</span>
ip<span class="w"> </span>addr<span class="w"> </span>show
ping<span class="w"> </span>-c<span class="w"> </span><span class="m">3</span><span class="w"> </span><span class="m">8</span>.8.8.8

<span class="c1"># 3. ë°±ì—… ì €ì¥ì†Œ ì ‘ê·¼ í™•ì¸</span>
<span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;[3] ë°±ì—… ì €ì¥ì†Œ ì ‘ê·¼&quot;</span>
<span class="c1"># ë¡œì»¬ ë°±ì—…</span>
ls<span class="w"> </span>-la<span class="w"> </span>/backup/
<span class="c1"># ì›ê²© ë°±ì—…</span>
ssh<span class="w"> </span>backup-server<span class="w"> </span><span class="s2">&quot;ls -la /backup/&quot;</span>

<span class="c1"># 4. ë°±ì—… ë¬´ê²°ì„± ê²€ì¦</span>
<span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;[4] ë°±ì—… ë¬´ê²°ì„±&quot;</span>
<span class="c1"># Borg ê²€ì¦</span>
borg<span class="w"> </span>check<span class="w"> </span>/backup/borg-repo

<span class="c1"># 5. ë³µêµ¬ í…ŒìŠ¤íŠ¸ (ìƒ˜í”Œ)</span>
<span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;[5] ìƒ˜í”Œ íŒŒì¼ ë³µêµ¬ í…ŒìŠ¤íŠ¸&quot;</span>
mkdir<span class="w"> </span>-p<span class="w"> </span>/tmp/recovery-test
borg<span class="w"> </span>extract<span class="w"> </span>/backup/borg-repo::latest<span class="w"> </span>etc/hostname<span class="w"> </span>-C<span class="w"> </span>/tmp/recovery-test
diff<span class="w"> </span>/etc/hostname<span class="w"> </span>/tmp/recovery-test/etc/hostname

<span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;=== ì²´í¬ë¦¬ìŠ¤íŠ¸ ì™„ë£Œ ===&quot;</span>
</code></pre></div>

<h3 id="_16">ë² ì–´ë©”íƒˆ ë³µêµ¬ ì ˆì°¨<a class="header-link" href="#_16" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><span class="c1"># 1. ë¶€íŒ… ë¯¸ë””ì–´ë¡œ ë¶€íŒ… (Ubuntu Live USB ë“±)</span>

<span class="c1"># 2. ë„¤íŠ¸ì›Œí¬ ì„¤ì •</span>
ip<span class="w"> </span>addr<span class="w"> </span>add<span class="w"> </span><span class="m">192</span>.168.1.100/24<span class="w"> </span>dev<span class="w"> </span>eth0
ip<span class="w"> </span>route<span class="w"> </span>add<span class="w"> </span>default<span class="w"> </span>via<span class="w"> </span><span class="m">192</span>.168.1.1

<span class="c1"># 3. ë””ìŠ¤í¬ íŒŒí‹°ì…”ë‹</span>
parted<span class="w"> </span>/dev/sda<span class="w"> </span>mklabel<span class="w"> </span>gpt
parted<span class="w"> </span>/dev/sda<span class="w"> </span>mkpart<span class="w"> </span>primary<span class="w"> </span>ext4<span class="w"> </span>1MiB<span class="w"> </span>512MiB<span class="w">    </span><span class="c1"># /boot</span>
parted<span class="w"> </span>/dev/sda<span class="w"> </span>mkpart<span class="w"> </span>primary<span class="w"> </span>ext4<span class="w"> </span>512MiB<span class="w"> </span><span class="m">100</span>%<span class="w">    </span><span class="c1"># /</span>
mkfs.ext4<span class="w"> </span>/dev/sda1
mkfs.ext4<span class="w"> </span>/dev/sda2

<span class="c1"># 4. ë§ˆìš´íŠ¸</span>
mount<span class="w"> </span>/dev/sda2<span class="w"> </span>/mnt
mkdir<span class="w"> </span>/mnt/boot
mount<span class="w"> </span>/dev/sda1<span class="w"> </span>/mnt/boot

<span class="c1"># 5. ë°±ì—…ì—ì„œ ë³µì›</span>
<span class="c1"># rsync ì‚¬ìš©</span>
rsync<span class="w"> </span>-av<span class="w"> </span>backup-server:/backup/latest/<span class="w"> </span>/mnt/

<span class="c1"># ë˜ëŠ” Borg ì‚¬ìš©</span>
borg<span class="w"> </span>extract<span class="w"> </span>backup-server:/backup/borg-repo::latest<span class="w"> </span>-C<span class="w"> </span>/mnt

<span class="c1"># 6. chrootë¡œ ë¶€íŠ¸ë¡œë” ì„¤ì¹˜</span>
mount<span class="w"> </span>--bind<span class="w"> </span>/dev<span class="w"> </span>/mnt/dev
mount<span class="w"> </span>--bind<span class="w"> </span>/proc<span class="w"> </span>/mnt/proc
mount<span class="w"> </span>--bind<span class="w"> </span>/sys<span class="w"> </span>/mnt/sys
chroot<span class="w"> </span>/mnt

grub-install<span class="w"> </span>/dev/sda
update-grub

<span class="nb">exit</span>

<span class="c1"># 7. ì •ë¦¬ ë° ì¬ë¶€íŒ…</span>
umount<span class="w"> </span>-R<span class="w"> </span>/mnt
reboot
</code></pre></div>

<hr />
<h2 id="7">7. ìë™í™” ë° ëª¨ë‹ˆí„°ë§<a class="header-link" href="#7" title="Permanent link">&para;</a></h2>
<h3 id="systemd">systemd íƒ€ì´ë¨¸ë¥¼ ì´ìš©í•œ ìë™í™”<a class="header-link" href="#systemd" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><span class="c1"># /etc/systemd/system/backup.service</span>
<span class="o">[</span>Unit<span class="o">]</span>
<span class="nv">Description</span><span class="o">=</span>Daily<span class="w"> </span>Backup<span class="w"> </span>Service
<span class="nv">After</span><span class="o">=</span>network-online.target

<span class="o">[</span>Service<span class="o">]</span>
<span class="nv">Type</span><span class="o">=</span>oneshot
<span class="nv">ExecStart</span><span class="o">=</span>/usr/local/bin/backup.sh
<span class="nv">User</span><span class="o">=</span>root
<span class="nv">Nice</span><span class="o">=</span><span class="m">19</span>
<span class="nv">IOSchedulingClass</span><span class="o">=</span>idle

<span class="o">[</span>Install<span class="o">]</span>
<span class="nv">WantedBy</span><span class="o">=</span>multi-user.target
</code></pre></div>

<div class="highlight"><pre><span></span><code><span class="c1"># /etc/systemd/system/backup.timer</span>
<span class="o">[</span>Unit<span class="o">]</span>
<span class="nv">Description</span><span class="o">=</span>Run<span class="w"> </span>backup<span class="w"> </span>daily

<span class="o">[</span>Timer<span class="o">]</span>
<span class="nv">OnCalendar</span><span class="o">=</span>*-*-*<span class="w"> </span><span class="m">02</span>:00:00
<span class="nv">RandomizedDelaySec</span><span class="o">=</span><span class="m">1800</span>
<span class="nv">Persistent</span><span class="o">=</span><span class="nb">true</span>

<span class="o">[</span>Install<span class="o">]</span>
<span class="nv">WantedBy</span><span class="o">=</span>timers.target
</code></pre></div>

<div class="highlight"><pre><span></span><code><span class="c1"># íƒ€ì´ë¨¸ í™œì„±í™”</span>
sudo<span class="w"> </span>systemctl<span class="w"> </span><span class="nb">enable</span><span class="w"> </span>--now<span class="w"> </span>backup.timer

<span class="c1"># ìƒíƒœ í™•ì¸</span>
systemctl<span class="w"> </span>list-timers<span class="w"> </span>--all<span class="w"> </span><span class="p">|</span><span class="w"> </span>grep<span class="w"> </span>backup
</code></pre></div>

<h3 id="_17">ë°±ì—… ëª¨ë‹ˆí„°ë§ ìŠ¤í¬ë¦½íŠ¸<a class="header-link" href="#_17" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><span class="ch">#!/bin/bash</span>
<span class="c1"># backup-monitor.sh</span>

<span class="nv">BACKUP_DIR</span><span class="o">=</span><span class="s2">&quot;/backup&quot;</span>
<span class="nv">MAX_AGE_HOURS</span><span class="o">=</span><span class="m">26</span>
<span class="nv">ALERT_EMAIL</span><span class="o">=</span><span class="s2">&quot;admin@example.com&quot;</span>
<span class="nv">LOGFILE</span><span class="o">=</span><span class="s2">&quot;/var/log/backup-monitor.log&quot;</span>

check_backup_age<span class="o">()</span><span class="w"> </span><span class="o">{</span>
<span class="w">    </span><span class="nb">local</span><span class="w"> </span><span class="nv">newest</span><span class="o">=</span><span class="k">$(</span>find<span class="w"> </span><span class="s2">&quot;</span><span class="nv">$BACKUP_DIR</span><span class="s2">&quot;</span><span class="w"> </span>-maxdepth<span class="w"> </span><span class="m">1</span><span class="w"> </span>-type<span class="w"> </span>d<span class="w"> </span>-name<span class="w"> </span><span class="s2">&quot;20*&quot;</span><span class="w"> </span><span class="p">|</span><span class="w"> </span>sort<span class="w"> </span>-r<span class="w"> </span><span class="p">|</span><span class="w"> </span>head<span class="w"> </span>-1<span class="k">)</span>

<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="o">[</span><span class="w"> </span>-z<span class="w"> </span><span class="s2">&quot;</span><span class="nv">$newest</span><span class="s2">&quot;</span><span class="w"> </span><span class="o">]</span><span class="p">;</span><span class="w"> </span><span class="k">then</span>
<span class="w">        </span><span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;ERROR: No backup found&quot;</span><span class="w"> </span><span class="p">|</span><span class="w"> </span>tee<span class="w"> </span>-a<span class="w"> </span><span class="s2">&quot;</span><span class="nv">$LOGFILE</span><span class="s2">&quot;</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="m">1</span>
<span class="w">    </span><span class="k">fi</span>

<span class="w">    </span><span class="nb">local</span><span class="w"> </span><span class="nv">age_seconds</span><span class="o">=</span><span class="k">$(($(</span>date<span class="w"> </span>+%s<span class="k">)</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="k">$(</span>stat<span class="w"> </span>-c<span class="w"> </span>%Y<span class="w"> </span><span class="s2">&quot;</span><span class="nv">$newest</span><span class="s2">&quot;</span><span class="k">)))</span>
<span class="w">    </span><span class="nb">local</span><span class="w"> </span><span class="nv">age_hours</span><span class="o">=</span><span class="k">$((</span><span class="nv">age_seconds</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="m">3600</span><span class="k">))</span>

<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="o">[</span><span class="w"> </span><span class="nv">$age_hours</span><span class="w"> </span>-gt<span class="w"> </span><span class="nv">$MAX_AGE_HOURS</span><span class="w"> </span><span class="o">]</span><span class="p">;</span><span class="w"> </span><span class="k">then</span>
<span class="w">        </span><span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;WARNING: Latest backup is </span><span class="nv">$age_hours</span><span class="s2"> hours old&quot;</span><span class="w"> </span><span class="p">|</span><span class="w"> </span>tee<span class="w"> </span>-a<span class="w"> </span><span class="s2">&quot;</span><span class="nv">$LOGFILE</span><span class="s2">&quot;</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="m">1</span>
<span class="w">    </span><span class="k">fi</span>

<span class="w">    </span><span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;OK: Latest backup is </span><span class="nv">$age_hours</span><span class="s2"> hours old (</span><span class="nv">$newest</span><span class="s2">)&quot;</span><span class="w"> </span><span class="p">|</span><span class="w"> </span>tee<span class="w"> </span>-a<span class="w"> </span><span class="s2">&quot;</span><span class="nv">$LOGFILE</span><span class="s2">&quot;</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="m">0</span>
<span class="o">}</span>

check_backup_size<span class="o">()</span><span class="w"> </span><span class="o">{</span>
<span class="w">    </span><span class="nb">local</span><span class="w"> </span><span class="nv">today</span><span class="o">=</span><span class="k">$(</span>find<span class="w"> </span><span class="s2">&quot;</span><span class="nv">$BACKUP_DIR</span><span class="s2">&quot;</span><span class="w"> </span>-maxdepth<span class="w"> </span><span class="m">1</span><span class="w"> </span>-type<span class="w"> </span>d<span class="w"> </span>-name<span class="w"> </span><span class="s2">&quot;</span><span class="k">$(</span>date<span class="w"> </span>+%Y-%m-%d<span class="k">)</span><span class="s2">*&quot;</span><span class="w"> </span><span class="p">|</span><span class="w"> </span>head<span class="w"> </span>-1<span class="k">)</span>
<span class="w">    </span><span class="nb">local</span><span class="w"> </span><span class="nv">yesterday</span><span class="o">=</span><span class="k">$(</span>find<span class="w"> </span><span class="s2">&quot;</span><span class="nv">$BACKUP_DIR</span><span class="s2">&quot;</span><span class="w"> </span>-maxdepth<span class="w"> </span><span class="m">1</span><span class="w"> </span>-type<span class="w"> </span>d<span class="w"> </span>-name<span class="w"> </span><span class="s2">&quot;</span><span class="k">$(</span>date<span class="w"> </span>-d<span class="w"> </span>yesterday<span class="w"> </span>+%Y-%m-%d<span class="k">)</span><span class="s2">*&quot;</span><span class="w"> </span><span class="p">|</span><span class="w"> </span>head<span class="w"> </span>-1<span class="k">)</span>

<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="o">[</span><span class="w"> </span>-n<span class="w"> </span><span class="s2">&quot;</span><span class="nv">$today</span><span class="s2">&quot;</span><span class="w"> </span><span class="o">]</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="o">[</span><span class="w"> </span>-n<span class="w"> </span><span class="s2">&quot;</span><span class="nv">$yesterday</span><span class="s2">&quot;</span><span class="w"> </span><span class="o">]</span><span class="p">;</span><span class="w"> </span><span class="k">then</span>
<span class="w">        </span><span class="nb">local</span><span class="w"> </span><span class="nv">size_today</span><span class="o">=</span><span class="k">$(</span>du<span class="w"> </span>-s<span class="w"> </span><span class="s2">&quot;</span><span class="nv">$today</span><span class="s2">&quot;</span><span class="w"> </span><span class="p">|</span><span class="w"> </span>awk<span class="w"> </span><span class="s1">&#39;{print $1}&#39;</span><span class="k">)</span>
<span class="w">        </span><span class="nb">local</span><span class="w"> </span><span class="nv">size_yesterday</span><span class="o">=</span><span class="k">$(</span>du<span class="w"> </span>-s<span class="w"> </span><span class="s2">&quot;</span><span class="nv">$yesterday</span><span class="s2">&quot;</span><span class="w"> </span><span class="p">|</span><span class="w"> </span>awk<span class="w"> </span><span class="s1">&#39;{print $1}&#39;</span><span class="k">)</span>

<span class="w">        </span><span class="c1"># 50% ì´ìƒ ì°¨ì´ë‚˜ë©´ ê²½ê³ </span>
<span class="w">        </span><span class="nb">local</span><span class="w"> </span><span class="nv">diff</span><span class="o">=</span><span class="k">$((</span><span class="nv">size_today</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="nv">size_yesterday</span><span class="k">))</span>
<span class="w">        </span><span class="nb">local</span><span class="w"> </span><span class="nv">threshold</span><span class="o">=</span><span class="k">$((</span><span class="nv">size_yesterday</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="m">2</span><span class="k">))</span>

<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="o">[</span><span class="w"> </span><span class="si">${</span><span class="nv">diff</span><span class="p">#-</span><span class="si">}</span><span class="w"> </span>-gt<span class="w"> </span><span class="nv">$threshold</span><span class="w"> </span><span class="o">]</span><span class="p">;</span><span class="w"> </span><span class="k">then</span>
<span class="w">            </span><span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;WARNING: Significant size change: </span><span class="nv">$size_yesterday</span><span class="s2"> -&gt; </span><span class="nv">$size_today</span><span class="s2">&quot;</span><span class="w"> </span><span class="p">|</span><span class="w"> </span>tee<span class="w"> </span>-a<span class="w"> </span><span class="s2">&quot;</span><span class="nv">$LOGFILE</span><span class="s2">&quot;</span>
<span class="w">            </span><span class="k">return</span><span class="w"> </span><span class="m">1</span>
<span class="w">        </span><span class="k">fi</span>
<span class="w">    </span><span class="k">fi</span>

<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="m">0</span>
<span class="o">}</span>

check_disk_space<span class="o">()</span><span class="w"> </span><span class="o">{</span>
<span class="w">    </span><span class="nb">local</span><span class="w"> </span><span class="nv">usage</span><span class="o">=</span><span class="k">$(</span>df<span class="w"> </span><span class="s2">&quot;</span><span class="nv">$BACKUP_DIR</span><span class="s2">&quot;</span><span class="w"> </span><span class="p">|</span><span class="w"> </span>awk<span class="w"> </span><span class="s1">&#39;NR==2 {print $5}&#39;</span><span class="w"> </span><span class="p">|</span><span class="w"> </span>tr<span class="w"> </span>-d<span class="w"> </span><span class="s1">&#39;%&#39;</span><span class="k">)</span>

<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="o">[</span><span class="w"> </span><span class="nv">$usage</span><span class="w"> </span>-gt<span class="w"> </span><span class="m">90</span><span class="w"> </span><span class="o">]</span><span class="p">;</span><span class="w"> </span><span class="k">then</span>
<span class="w">        </span><span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;CRITICAL: Backup disk usage at </span><span class="si">${</span><span class="nv">usage</span><span class="si">}</span><span class="s2">%&quot;</span><span class="w"> </span><span class="p">|</span><span class="w"> </span>tee<span class="w"> </span>-a<span class="w"> </span><span class="s2">&quot;</span><span class="nv">$LOGFILE</span><span class="s2">&quot;</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="m">1</span>
<span class="w">    </span><span class="k">elif</span><span class="w"> </span><span class="o">[</span><span class="w"> </span><span class="nv">$usage</span><span class="w"> </span>-gt<span class="w"> </span><span class="m">80</span><span class="w"> </span><span class="o">]</span><span class="p">;</span><span class="w"> </span><span class="k">then</span>
<span class="w">        </span><span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;WARNING: Backup disk usage at </span><span class="si">${</span><span class="nv">usage</span><span class="si">}</span><span class="s2">%&quot;</span><span class="w"> </span><span class="p">|</span><span class="w"> </span>tee<span class="w"> </span>-a<span class="w"> </span><span class="s2">&quot;</span><span class="nv">$LOGFILE</span><span class="s2">&quot;</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="m">1</span>
<span class="w">    </span><span class="k">fi</span>

<span class="w">    </span><span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;OK: Backup disk usage at </span><span class="si">${</span><span class="nv">usage</span><span class="si">}</span><span class="s2">%&quot;</span><span class="w"> </span><span class="p">|</span><span class="w"> </span>tee<span class="w"> </span>-a<span class="w"> </span><span class="s2">&quot;</span><span class="nv">$LOGFILE</span><span class="s2">&quot;</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="m">0</span>
<span class="o">}</span>

<span class="c1"># ë©”ì¸ ì‹¤í–‰</span>
<span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;=== Backup Monitor: </span><span class="k">$(</span>date<span class="k">)</span><span class="s2"> ===&quot;</span><span class="w"> </span>&gt;&gt;<span class="w"> </span><span class="s2">&quot;</span><span class="nv">$LOGFILE</span><span class="s2">&quot;</span>
<span class="nv">ERRORS</span><span class="o">=</span><span class="m">0</span>

check_backup_age<span class="w"> </span><span class="o">||</span><span class="w"> </span><span class="o">((</span>ERRORS++<span class="o">))</span>
check_backup_size<span class="w"> </span><span class="o">||</span><span class="w"> </span><span class="o">((</span>ERRORS++<span class="o">))</span>
check_disk_space<span class="w"> </span><span class="o">||</span><span class="w"> </span><span class="o">((</span>ERRORS++<span class="o">))</span>

<span class="k">if</span><span class="w"> </span><span class="o">[</span><span class="w"> </span><span class="nv">$ERRORS</span><span class="w"> </span>-gt<span class="w"> </span><span class="m">0</span><span class="w"> </span><span class="o">]</span><span class="p">;</span><span class="w"> </span><span class="k">then</span>
<span class="w">    </span>tail<span class="w"> </span>-20<span class="w"> </span><span class="s2">&quot;</span><span class="nv">$LOGFILE</span><span class="s2">&quot;</span><span class="w"> </span><span class="p">|</span><span class="w"> </span>mail<span class="w"> </span>-s<span class="w"> </span><span class="s2">&quot;Backup Monitor Alert&quot;</span><span class="w"> </span><span class="s2">&quot;</span><span class="nv">$ALERT_EMAIL</span><span class="s2">&quot;</span>
<span class="k">fi</span>

<span class="nb">exit</span><span class="w"> </span><span class="nv">$ERRORS</span>
</code></pre></div>

<h3 id="prometheus">Prometheus ë©”íŠ¸ë¦­ ìˆ˜ì§‘<a class="header-link" href="#prometheus" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><span class="ch">#!/bin/bash</span>
<span class="c1"># backup-metrics.sh (node_exporter textfile collectorìš©)</span>

<span class="nv">METRICS_FILE</span><span class="o">=</span><span class="s2">&quot;/var/lib/node_exporter/textfile_collector/backup.prom&quot;</span>
<span class="nv">BACKUP_DIR</span><span class="o">=</span><span class="s2">&quot;/backup&quot;</span>

<span class="c1"># ìµœì‹  ë°±ì—… ì‹œê°„</span>
<span class="nv">newest</span><span class="o">=</span><span class="k">$(</span>find<span class="w"> </span><span class="s2">&quot;</span><span class="nv">$BACKUP_DIR</span><span class="s2">&quot;</span><span class="w"> </span>-maxdepth<span class="w"> </span><span class="m">1</span><span class="w"> </span>-type<span class="w"> </span>d<span class="w"> </span>-name<span class="w"> </span><span class="s2">&quot;20*&quot;</span><span class="w"> </span><span class="p">|</span><span class="w"> </span>sort<span class="w"> </span>-r<span class="w"> </span><span class="p">|</span><span class="w"> </span>head<span class="w"> </span>-1<span class="k">)</span>
<span class="k">if</span><span class="w"> </span><span class="o">[</span><span class="w"> </span>-n<span class="w"> </span><span class="s2">&quot;</span><span class="nv">$newest</span><span class="s2">&quot;</span><span class="w"> </span><span class="o">]</span><span class="p">;</span><span class="w"> </span><span class="k">then</span>
<span class="w">    </span><span class="nv">backup_timestamp</span><span class="o">=</span><span class="k">$(</span>stat<span class="w"> </span>-c<span class="w"> </span>%Y<span class="w"> </span><span class="s2">&quot;</span><span class="nv">$newest</span><span class="s2">&quot;</span><span class="k">)</span>
<span class="w">    </span><span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;backup_last_success_timestamp </span><span class="nv">$backup_timestamp</span><span class="s2">&quot;</span><span class="w"> </span>&gt;<span class="w"> </span><span class="s2">&quot;</span><span class="nv">$METRICS_FILE</span><span class="s2">&quot;</span>
<span class="k">fi</span>

<span class="c1"># ë°±ì—… í¬ê¸°</span>
<span class="nv">backup_size</span><span class="o">=</span><span class="k">$(</span>du<span class="w"> </span>-sb<span class="w"> </span><span class="s2">&quot;</span><span class="nv">$newest</span><span class="s2">&quot;</span><span class="w"> </span><span class="m">2</span>&gt;/dev/null<span class="w"> </span><span class="p">|</span><span class="w"> </span>awk<span class="w"> </span><span class="s1">&#39;{print $1}&#39;</span><span class="k">)</span>
<span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;backup_size_bytes </span><span class="nv">$backup_size</span><span class="s2">&quot;</span><span class="w"> </span>&gt;&gt;<span class="w"> </span><span class="s2">&quot;</span><span class="nv">$METRICS_FILE</span><span class="s2">&quot;</span>

<span class="c1"># ë””ìŠ¤í¬ ì‚¬ìš©ëŸ‰</span>
<span class="nv">disk_usage</span><span class="o">=</span><span class="k">$(</span>df<span class="w"> </span><span class="s2">&quot;</span><span class="nv">$BACKUP_DIR</span><span class="s2">&quot;</span><span class="w"> </span><span class="p">|</span><span class="w"> </span>awk<span class="w"> </span><span class="s1">&#39;NR==2 {print $3}&#39;</span><span class="k">)</span>
<span class="nv">disk_total</span><span class="o">=</span><span class="k">$(</span>df<span class="w"> </span><span class="s2">&quot;</span><span class="nv">$BACKUP_DIR</span><span class="s2">&quot;</span><span class="w"> </span><span class="p">|</span><span class="w"> </span>awk<span class="w"> </span><span class="s1">&#39;NR==2 {print $2}&#39;</span><span class="k">)</span>
<span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;backup_disk_used_bytes </span><span class="k">$((</span><span class="nv">disk_usage</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="m">1024</span><span class="k">))</span><span class="s2">&quot;</span><span class="w"> </span>&gt;&gt;<span class="w"> </span><span class="s2">&quot;</span><span class="nv">$METRICS_FILE</span><span class="s2">&quot;</span>
<span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;backup_disk_total_bytes </span><span class="k">$((</span><span class="nv">disk_total</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="m">1024</span><span class="k">))</span><span class="s2">&quot;</span><span class="w"> </span>&gt;&gt;<span class="w"> </span><span class="s2">&quot;</span><span class="nv">$METRICS_FILE</span><span class="s2">&quot;</span>
</code></pre></div>

<hr />
<h2 id="_18">ì—°ìŠµ ë¬¸ì œ<a class="header-link" href="#_18" title="Permanent link">&para;</a></h2>
<h3 id="1-rsync">ë¬¸ì œ 1: rsync ì¦ë¶„ ë°±ì—…<a class="header-link" href="#1-rsync" title="Permanent link">&para;</a></h3>
<p>í•˜ë“œë§í¬ë¥¼ ì´ìš©í•œ rsync ì¦ë¶„ ë°±ì—… ìŠ¤í¬ë¦½íŠ¸ë¥¼ ì‘ì„±í•˜ì„¸ìš”:
- ì›ë³¸: <code>/home/user</code>
- ë°±ì—… ìœ„ì¹˜: <code>/backup/home</code>
- ì¼ì¼ ë°±ì—…, ìµœì‹  ë°±ì—…ì„ <code>latest</code> ì‹¬ë³¼ë¦­ ë§í¬ë¡œ ì—°ê²°
- 30ì¼ ì´ìƒ ëœ ë°±ì—… ìë™ ì‚­ì œ</p>
<h3 id="2-borg">ë¬¸ì œ 2: Borg ë³µêµ¬<a class="header-link" href="#2-borg" title="Permanent link">&para;</a></h3>
<p>Borg ì €ì¥ì†Œì—ì„œ íŠ¹ì • ë‚ ì§œì˜ ë°±ì—… ì¤‘ <code>/etc/nginx/</code> ë””ë ‰í† ë¦¬ë§Œ ë³µêµ¬í•˜ëŠ” ëª…ë ¹ì„ ì‘ì„±í•˜ì„¸ìš”.</p>
<h3 id="3-dr">ë¬¸ì œ 3: DR í…ŒìŠ¤íŠ¸<a class="header-link" href="#3-dr" title="Permanent link">&para;</a></h3>
<p>ë¶„ê¸°ë³„ ì¬í•´ë³µêµ¬ í…ŒìŠ¤íŠ¸ ì ˆì°¨ë¥¼ ì‘ì„±í•˜ì„¸ìš”. í¬í•¨í•´ì•¼ í•  í•­ëª©:
- ë°±ì—… ë¬´ê²°ì„± ê²€ì¦
- ìƒ˜í”Œ ë°ì´í„° ë³µêµ¬ í…ŒìŠ¤íŠ¸
- ì „ì²´ ì‹œìŠ¤í…œ ë³µêµ¬ í…ŒìŠ¤íŠ¸ (ê°€ëŠ¥í•˜ë©´)</p>
<hr />
<h2 id="_19">ì •ë‹µ<a class="header-link" href="#_19" title="Permanent link">&para;</a></h2>
<h3 id="1_1">ë¬¸ì œ 1 ì •ë‹µ<a class="header-link" href="#1_1" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><span class="ch">#!/bin/bash</span>

<span class="nv">SOURCE</span><span class="o">=</span><span class="s2">&quot;/home/user&quot;</span>
<span class="nv">BACKUP_BASE</span><span class="o">=</span><span class="s2">&quot;/backup/home&quot;</span>
<span class="nv">DATE</span><span class="o">=</span><span class="k">$(</span>date<span class="w"> </span>+%Y-%m-%d<span class="k">)</span>
<span class="nv">BACKUP_PATH</span><span class="o">=</span><span class="s2">&quot;</span><span class="nv">$BACKUP_BASE</span><span class="s2">/</span><span class="nv">$DATE</span><span class="s2">&quot;</span>
<span class="nv">LATEST</span><span class="o">=</span><span class="s2">&quot;</span><span class="nv">$BACKUP_BASE</span><span class="s2">/latest&quot;</span>

<span class="c1"># í•˜ë“œë§í¬ ì˜µì…˜</span>
<span class="k">if</span><span class="w"> </span><span class="o">[</span><span class="w"> </span>-d<span class="w"> </span><span class="s2">&quot;</span><span class="nv">$LATEST</span><span class="s2">&quot;</span><span class="w"> </span><span class="o">]</span><span class="p">;</span><span class="w"> </span><span class="k">then</span>
<span class="w">    </span><span class="nv">LINK</span><span class="o">=</span><span class="s2">&quot;--link-dest=</span><span class="nv">$LATEST</span><span class="s2">&quot;</span>
<span class="k">else</span>
<span class="w">    </span><span class="nv">LINK</span><span class="o">=</span><span class="s2">&quot;&quot;</span>
<span class="k">fi</span>

<span class="c1"># ë°±ì—… ì‹¤í–‰</span>
rsync<span class="w"> </span>-av<span class="w"> </span>--delete<span class="w"> </span><span class="nv">$LINK</span><span class="w"> </span><span class="s2">&quot;</span><span class="nv">$SOURCE</span><span class="s2">/&quot;</span><span class="w"> </span><span class="s2">&quot;</span><span class="nv">$BACKUP_PATH</span><span class="s2">/&quot;</span>

<span class="c1"># ìµœì‹  ë§í¬ ì—…ë°ì´íŠ¸</span>
rm<span class="w"> </span>-f<span class="w"> </span><span class="s2">&quot;</span><span class="nv">$LATEST</span><span class="s2">&quot;</span>
ln<span class="w"> </span>-s<span class="w"> </span><span class="s2">&quot;</span><span class="nv">$BACKUP_PATH</span><span class="s2">&quot;</span><span class="w"> </span><span class="s2">&quot;</span><span class="nv">$LATEST</span><span class="s2">&quot;</span>

<span class="c1"># 30ì¼ ì´ìƒ ëœ ë°±ì—… ì‚­ì œ</span>
find<span class="w"> </span><span class="s2">&quot;</span><span class="nv">$BACKUP_BASE</span><span class="s2">&quot;</span><span class="w"> </span>-maxdepth<span class="w"> </span><span class="m">1</span><span class="w"> </span>-type<span class="w"> </span>d<span class="w"> </span>-name<span class="w"> </span><span class="s2">&quot;20*&quot;</span><span class="w"> </span>-mtime<span class="w"> </span>+30<span class="w"> </span>-exec<span class="w"> </span>rm<span class="w"> </span>-rf<span class="w"> </span><span class="o">{}</span><span class="w"> </span><span class="se">\;</span>
</code></pre></div>

<h3 id="2">ë¬¸ì œ 2 ì •ë‹µ<a class="header-link" href="#2" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><span class="c1"># ë°±ì—… ëª©ë¡ í™•ì¸</span>
borg<span class="w"> </span>list<span class="w"> </span>/backup/borg-repo

<span class="c1"># íŠ¹ì • ë‚ ì§œ ë°±ì—…ì—ì„œ nginx ì„¤ì • ë³µêµ¬</span>
borg<span class="w"> </span>extract<span class="w"> </span>/backup/borg-repo::backup-2024-01-15<span class="w"> </span>etc/nginx

<span class="c1"># ë‹¤ë¥¸ ê²½ë¡œë¡œ ë³µêµ¬</span>
mkdir<span class="w"> </span>/tmp/restore
<span class="nb">cd</span><span class="w"> </span>/tmp/restore
borg<span class="w"> </span>extract<span class="w"> </span>/backup/borg-repo::backup-2024-01-15<span class="w"> </span>etc/nginx
</code></pre></div>

<h3 id="3">ë¬¸ì œ 3 ì •ë‹µ<a class="header-link" href="#3" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><span class="gh"># ë¶„ê¸°ë³„ DR í…ŒìŠ¤íŠ¸ ì ˆì°¨</span>

<span class="gu">## 1. ë°±ì—… ë¬´ê²°ì„± ê²€ì¦ (ë§¤ ë¶„ê¸°)</span>
<span class="k">- [ ]</span> Borg check ì‹¤í–‰: <span class="sb">`borg check /backup/borg-repo`</span>
<span class="k">- [ ]</span> ë°±ì—… ëª©ë¡ ê²€í† : <span class="sb">`borg list /backup/borg-repo`</span>
<span class="k">- [ ]</span> ìµœê·¼ ë°±ì—… ìƒì„¸ í™•ì¸: <span class="sb">`borg info /backup/borg-repo::latest`</span>

<span class="gu">## 2. ìƒ˜í”Œ ë°ì´í„° ë³µêµ¬ í…ŒìŠ¤íŠ¸ (ë§¤ ë¶„ê¸°)</span>
<span class="k">- [ ]</span> í…ŒìŠ¤íŠ¸ ë””ë ‰í† ë¦¬ ìƒì„±
<span class="k">- [ ]</span> ì„¤ì • íŒŒì¼ ë³µêµ¬ í…ŒìŠ¤íŠ¸ (/etc/)
<span class="k">- [ ]</span> ë°ì´í„° íŒŒì¼ ë³µêµ¬ í…ŒìŠ¤íŠ¸ (/var/www/)
<span class="k">- [ ]</span> ë³µêµ¬ëœ íŒŒì¼ ë¬´ê²°ì„± í™•ì¸ (diff ë˜ëŠ” checksum)

<span class="gu">## 3. ì „ì²´ ì‹œìŠ¤í…œ ë³µêµ¬ í…ŒìŠ¤íŠ¸ (ë°˜ê¸°)</span>
<span class="k">- [ ]</span> í…ŒìŠ¤íŠ¸ VM ë˜ëŠ” ë¬¼ë¦¬ ì„œë²„ ì¤€ë¹„
<span class="k">- [ ]</span> ë² ì–´ë©”íƒˆ ë³µêµ¬ ì ˆì°¨ ì‹¤í–‰
<span class="k">- [ ]</span> ë¶€íŒ… í™•ì¸
<span class="k">- [ ]</span> ì„œë¹„ìŠ¤ ì •ìƒ ë™ì‘ í™•ì¸
<span class="k">- [ ]</span> ë°ì´í„° ë¬´ê²°ì„± ê²€ì¦

<span class="gu">## 4. ë¬¸ì„œí™” ë° ê°œì„ </span>
<span class="k">- [ ]</span> í…ŒìŠ¤íŠ¸ ê²°ê³¼ ë¬¸ì„œí™”
<span class="k">- [ ]</span> ë°œê²¬ëœ ë¬¸ì œì  ê¸°ë¡
<span class="k">- [ ]</span> ì ˆì°¨ ê°œì„  ì‚¬í•­ ë°˜ì˜
<span class="k">- [ ]</span> RTO/RPO ë‹¬ì„± ì—¬ë¶€ í™•ì¸
</code></pre></div>

<hr />
<h2 id="_20">ë‹¤ìŒ ë‹¨ê³„<a class="header-link" href="#_20" title="Permanent link">&para;</a></h2>
<ul>
<li><a href="./20_Kernel_Management.md">20_Kernel_Management.md</a> - ì»¤ë„ ì»´íŒŒì¼, ëª¨ë“ˆ, GRUB ì„¤ì •</li>
</ul>
<hr />
<h2 id="_21">ì°¸ê³  ìë£Œ<a class="header-link" href="#_21" title="Permanent link">&para;</a></h2>
<ul>
<li><a href="https://rsync.samba.org/documentation.html">rsync Manual</a></li>
<li><a href="https://borgbackup.readthedocs.io/">Borg Backup Documentation</a></li>
<li><a href="https://clonezilla.org/">Clonezilla</a></li>
<li><code>man rsync</code>, <code>man tar</code>, <code>man dd</code>, <code>man borg</code></li>
</ul>
    </div>

    
<div class="lesson-toolbar lesson-toolbar--bottom">
    <div class="toolbar-nav toolbar-nav--prev">
        
        <a href="/study/ko/Linux/18_Log_Management.html" class="nav-prev">
            <span class="nav-label">Previous</span>
            <span class="nav-title">ë¡œê·¸ ê´€ë¦¬</span>
        </a>
        
    </div>
    <div class="toolbar-actions">
        <button class="btn btn-copy-link" data-action="copy-link" title="Copy link">
            <span class="icon">ğŸ”—</span>
            <span class="text">Copy link</span>
        </button>
        <a href="/study/ko/Linux/" class="btn btn-topic-link" title="Back to topic list">
            <span class="icon">ğŸ“‹</span>
            <span class="text">Topic list</span>
        </a>
    </div>
    <div class="toolbar-nav toolbar-nav--next">
        
        <a href="/study/ko/Linux/20_Kernel_Management.html" class="nav-next">
            <span class="nav-label">Next</span>
            <span class="nav-title">ì»¤ë„ ê´€ë¦¬</span>
        </a>
        
    </div>
</div>


    <div class="toolbar-keyboard-hint">
        <kbd>&larr;</kbd> <kbd>&rarr;</kbd> to navigate between lessons
    </div>
</article>

<!-- Scroll to top floating button -->
<button class="scroll-to-top" id="scroll-to-top" title="Scroll to top" aria-label="Scroll to top">â†‘</button>

            </div>
        </main>
    </div>

    <script src="/study/static/js/app.js"></script>
    <script>
        function switchLanguage(newLang) {
            const path = window.location.pathname;
            const base = '/study';
            const currentLang = 'ko';
            const newPath = path.replace(base + '/' + currentLang + '/', base + '/' + newLang + '/');
            window.location.href = newPath + window.location.search;
        }
    </script>
    
<script>
    document.addEventListener('DOMContentLoaded', function() {
        // Copy link - independent feedback per button
        document.querySelectorAll('[data-action="copy-link"]').forEach(function(btn) {
            btn.addEventListener('click', function() {
                navigator.clipboard.writeText(window.location.href);
                var textEl = this.querySelector('.text');
                var originalText = textEl.textContent;
                textEl.textContent = 'Copied!';
                setTimeout(function() { textEl.textContent = originalText; }, 2000);
            });
        });

        // Add copy buttons to code blocks
        document.querySelectorAll('.lesson-content pre').forEach(function(pre) {
            var copyBtn = document.createElement('button');
            copyBtn.className = 'code-copy-btn';
            copyBtn.textContent = 'Copy';
            copyBtn.addEventListener('click', function() {
                var code = pre.querySelector('code');
                var text = code ? code.textContent : pre.textContent;
                navigator.clipboard.writeText(text);
                copyBtn.textContent = 'Copied!';
                setTimeout(function() { copyBtn.textContent = 'Copy'; }, 2000);
            });
            pre.style.position = 'relative';
            pre.appendChild(copyBtn);
        });

        // Scroll to top button
        var scrollBtn = document.getElementById('scroll-to-top');
        window.addEventListener('scroll', function() {
            scrollBtn.classList.toggle('visible', window.scrollY > 300);
        });
        scrollBtn.addEventListener('click', function() {
            window.scrollTo({ top: 0, behavior: 'smooth' });
        });

        // Keyboard shortcuts: left/right arrows for lesson navigation
        document.addEventListener('keydown', function(e) {
            var tag = document.activeElement.tagName;
            if (tag === 'INPUT' || tag === 'TEXTAREA' || tag === 'SELECT') return;

            if (e.key === 'ArrowLeft') {
                var prevLink = document.querySelector('.nav-prev');
                if (prevLink) prevLink.click();
            } else if (e.key === 'ArrowRight') {
                var nextLink = document.querySelector('.nav-next');
                if (nextLink) nextLink.click();
            }
        });
    });
</script>

</body>
</html>
{% endraw %}