{% raw %}
<!DOCTYPE html>
<html lang="ko" data-theme="light">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ansible ê¸°ì´ˆ - Study Materials</title>
    <link rel="stylesheet" href="/study/static/css/style.css">
    <link rel="stylesheet" href="/study/static/css/highlight.css">
    <!-- KaTeX for LaTeX math rendering -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.16.11/dist/katex.min.css">
    <script defer src="https://cdn.jsdelivr.net/npm/katex@0.16.11/dist/katex.min.js"></script>
    <script defer src="https://cdn.jsdelivr.net/npm/katex@0.16.11/dist/contrib/auto-render.min.js"
        onload="renderMathInElement(document.body, {
            delimiters: [
                {left: '$$', right: '$$', display: true},
                {left: '$', right: '$', display: false}
            ],
            throwOnError: false
        });"></script>
    
</head>
<body>
    <div class="app-container">
        <!-- Sidebar -->
        <aside class="sidebar" id="sidebar">
            <div class="sidebar-header">
                <a href="/study/ko/" class="logo">Study Materials</a>
                <button class="sidebar-toggle" id="sidebar-toggle" aria-label="Toggle sidebar">
                    <span></span>
                </button>
            </div>

            <nav class="sidebar-nav">
                <a href="/study/ko/" class="nav-item ">
                    <span class="nav-icon">ğŸ </span>
                    <span class="nav-text">Home</span>
                </a>
                <a href="/study/examples/" class="nav-item ">
                    <span class="nav-icon">ğŸ’»</span>
                    <span class="nav-text">Examples</span>
                </a>
            </nav>

            <div class="sidebar-search">
                <form action="/study/ko/search.html" method="get" id="search-form">
                    <input type="search" name="q" placeholder="Search..." id="search-sidebar-input">
                </form>
            </div>

            <!-- Language Selector -->
            <div class="sidebar-lang">
                <select id="lang-select" class="lang-selector" onchange="switchLanguage(this.value)">
                    
                    <option value="en" >
                        English
                    </option>
                    
                    <option value="ko" selected>
                        í•œêµ­ì–´
                    </option>
                    
                </select>
            </div>

            <div class="sidebar-footer">
                <button class="theme-toggle" id="theme-toggle" aria-label="Toggle theme">
                    <span class="theme-icon light">â˜€ï¸</span>
                    <span class="theme-icon dark">ğŸŒ™</span>
                </button>
            </div>
        </aside>

        <!-- Main Content -->
        <main class="main-content">
            <header class="main-header">
                <button class="menu-toggle" id="menu-toggle" aria-label="Open menu">
                    <span></span>
                </button>
                
<nav class="breadcrumb">
    <a href="/study/ko/">Topics</a>
    <span class="separator">/</span>
    <a href="/study/ko/Linux/">Linux</a>
    <span class="separator">/</span>
    <span class="current">Ansible ê¸°ì´ˆ</span>
</nav>

            </header>

            <div class="content">
                
<article class="lesson-article">
    <header class="lesson-header">
        <h1>Ansible ê¸°ì´ˆ</h1>
    </header>

    
<div class="lesson-toolbar lesson-toolbar--top">
    <div class="toolbar-nav toolbar-nav--prev">
        
        <a href="/study/ko/Linux/21_Virtualization_KVM.html" class="nav-prev">
            <span class="nav-label">Previous</span>
            <span class="nav-title">ê°€ìƒí™” (KVM)</span>
        </a>
        
    </div>
    <div class="toolbar-actions">
        <button class="btn btn-copy-link" data-action="copy-link" title="Copy link">
            <span class="icon">ğŸ”—</span>
            <span class="text">Copy link</span>
        </button>
        <a href="/study/ko/Linux/" class="btn btn-topic-link" title="Back to topic list">
            <span class="icon">ğŸ“‹</span>
            <span class="text">Topic list</span>
        </a>
    </div>
    <div class="toolbar-nav toolbar-nav--next">
        
        <a href="/study/ko/Linux/23_Advanced_Networking.html" class="nav-next">
            <span class="nav-label">Next</span>
            <span class="nav-title">ê³ ê¸‰ ë„¤íŠ¸ì›Œí‚¹</span>
        </a>
        
    </div>
</div>


    
    <nav class="toc" id="toc">
        <h2>Table of Contents</h2>
        <div class="toc">
<ul>
<li><a href="#_1">í•™ìŠµ ëª©í‘œ</a></li>
<li><a href="#_2">ëª©ì°¨</a></li>
<li><a href="#1-ansible">1. Ansible ê°œìš”</a><ul>
<li><a href="#ansible_1">Ansibleì´ë€?</a></li>
<li><a href="#ansible-vs">Ansible vs ë‹¤ë¥¸ ë„êµ¬</a></li>
</ul>
</li>
<li><a href="#2">2. ì„¤ì¹˜ ë° ì„¤ì •</a><ul>
<li><a href="#ansible_2">Ansible ì„¤ì¹˜</a></li>
<li><a href="#ssh">SSH í‚¤ ì„¤ì •</a></li>
<li><a href="#ansiblecfg">ansible.cfg ì„¤ì •</a></li>
</ul>
</li>
<li><a href="#3">3. ì¸ë²¤í† ë¦¬</a><ul>
<li><a href="#ini">INI í˜•ì‹</a></li>
<li><a href="#yaml">YAML í˜•ì‹</a></li>
<li><a href="#_3">ë™ì  ì¸ë²¤í† ë¦¬</a></li>
<li><a href="#_4">ì¸ë²¤í† ë¦¬ í™•ì¸</a></li>
</ul>
</li>
<li><a href="#4-ad-hoc">4. Ad-hoc ëª…ë ¹ì–´</a><ul>
<li><a href="#_5">ê¸°ë³¸ ì‚¬ìš©ë²•</a></li>
<li><a href="#_6">ìì£¼ ì‚¬ìš©í•˜ëŠ” ëª¨ë“ˆ</a></li>
<li><a href="#_7">ê¶Œí•œ ìƒìŠ¹</a></li>
<li><a href="#_8">ë³‘ë ¬ ì‹¤í–‰</a></li>
</ul>
</li>
<li><a href="#5-playbook">5. Playbook</a><ul>
<li><a href="#_9">ê¸°ë³¸ êµ¬ì¡°</a></li>
<li><a href="#playbook">Playbook ì‹¤í–‰</a></li>
<li><a href="#when">ì¡°ê±´ë¬¸ (when)</a></li>
<li><a href="#loop">ë°˜ë³µë¬¸ (loop)</a></li>
<li><a href="#handlers">í•¸ë“¤ëŸ¬ (handlers)</a></li>
<li><a href="#block">ë¸”ë¡ (block)</a></li>
</ul>
</li>
<li><a href="#6">6. ë³€ìˆ˜ì™€ íŒ©íŠ¸</a><ul>
<li><a href="#_10">ë³€ìˆ˜ ì •ì˜ ìœ„ì¹˜</a></li>
<li><a href="#_11">ë³€ìˆ˜ íŒŒì¼ êµ¬ì¡°</a></li>
<li><a href="#group_varshost_vars">group_vars/host_vars ì˜ˆì‹œ</a></li>
<li><a href="#playbook_1">Playbookì—ì„œ ë³€ìˆ˜ ì‚¬ìš©</a></li>
<li><a href="#facts">íŒ©íŠ¸ (Facts)</a></li>
<li><a href="#jinja2">Jinja2 í…œí”Œë¦¿</a></li>
</ul>
</li>
<li><a href="#7-roles">7. Roles</a><ul>
<li><a href="#role">Role êµ¬ì¡°</a></li>
<li><a href="#role_1">Role ìƒì„±</a></li>
<li><a href="#role_2">Role ì˜ˆì‹œ</a></li>
<li><a href="#role_3">Role ì‚¬ìš©</a></li>
<li><a href="#ansible-galaxy">Ansible Galaxy</a></li>
</ul>
</li>
<li><a href="#8-ansible-vault">8. Ansible Vault</a><ul>
<li><a href="#vault">Vault ê¸°ë³¸ ì‚¬ìš©</a></li>
<li><a href="#vault_1">Vault ì‚¬ìš© ì˜ˆì‹œ</a></li>
<li><a href="#playbook_2">Playbook ì‹¤í–‰</a></li>
<li><a href="#_12">ë¬¸ìì—´ ì•”í˜¸í™”</a></li>
</ul>
</li>
<li><a href="#_13">ì—°ìŠµ ë¬¸ì œ</a><ul>
<li><a href="#1">ë¬¸ì œ 1: ì¸ë²¤í† ë¦¬ ì‘ì„±</a></li>
<li><a href="#2-playbook">ë¬¸ì œ 2: Playbook ì‘ì„±</a></li>
<li><a href="#3-role">ë¬¸ì œ 3: Role ì‘ì„±</a></li>
</ul>
</li>
<li><a href="#_14">ì •ë‹µ</a><ul>
<li><a href="#1_1">ë¬¸ì œ 1 ì •ë‹µ</a></li>
<li><a href="#2_1">ë¬¸ì œ 2 ì •ë‹µ</a></li>
<li><a href="#3_1">ë¬¸ì œ 3 ì •ë‹µ</a></li>
</ul>
</li>
<li><a href="#_15">ë‹¤ìŒ ë‹¨ê³„</a></li>
<li><a href="#_16">ì°¸ê³  ìë£Œ</a></li>
</ul>
</div>

    </nav>
    

    <div class="lesson-content markdown-body">
        <h1 id="ansible">Ansible ê¸°ì´ˆ<a class="header-link" href="#ansible" title="Permanent link">&para;</a></h1>
<h2 id="_1">í•™ìŠµ ëª©í‘œ<a class="header-link" href="#_1" title="Permanent link">&para;</a></h2>
<p>ì´ ë¬¸ì„œë¥¼ í†µí•´ ë‹¤ìŒì„ í•™ìŠµí•©ë‹ˆë‹¤:</p>
<ul>
<li>Ansibleì˜ ê°œë…ê³¼ ì•„í‚¤í…ì²˜</li>
<li>ì¸ë²¤í† ë¦¬ì™€ Ad-hoc ëª…ë ¹ì–´</li>
<li>Playbook ì‘ì„± ë° ì‹¤í–‰</li>
<li>Rolesì™€ ë³€ìˆ˜ ê´€ë¦¬</li>
</ul>
<p><strong>ë‚œì´ë„</strong>: â­â­â­ (ì¤‘ê¸‰-ê³ ê¸‰)</p>
<hr />
<h2 id="_2">ëª©ì°¨<a class="header-link" href="#_2" title="Permanent link">&para;</a></h2>
<ol>
<li><a href="#1-ansible-ê°œìš”">Ansible ê°œìš”</a></li>
<li><a href="#2-ì„¤ì¹˜-ë°-ì„¤ì •">ì„¤ì¹˜ ë° ì„¤ì •</a></li>
<li><a href="#3-ì¸ë²¤í† ë¦¬">ì¸ë²¤í† ë¦¬</a></li>
<li><a href="#4-ad-hoc-ëª…ë ¹ì–´">Ad-hoc ëª…ë ¹ì–´</a></li>
<li><a href="#5-playbook">Playbook</a></li>
<li><a href="#6-ë³€ìˆ˜ì™€-íŒ©íŠ¸">ë³€ìˆ˜ì™€ íŒ©íŠ¸</a></li>
<li><a href="#7-roles">Roles</a></li>
<li><a href="#8-ansible-vault">Ansible Vault</a></li>
</ol>
<hr />
<h2 id="1-ansible">1. Ansible ê°œìš”<a class="header-link" href="#1-ansible" title="Permanent link">&para;</a></h2>
<h3 id="ansible_1">Ansibleì´ë€?<a class="header-link" href="#ansible_1" title="Permanent link">&para;</a></h3>
<p>Ansibleì€ ì—ì´ì „íŠ¸ ì—†ì´ SSHë¡œ ì‘ë™í•˜ëŠ” IT ìë™í™” ë„êµ¬ì…ë‹ˆë‹¤.</p>
<div class="highlight"><pre><span></span><code>â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                     Control Node                            â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚  Ansible                                             â”‚   â”‚
â”‚  â”‚  â”œâ”€â”€ Playbooks (YAML)                                â”‚   â”‚
â”‚  â”‚  â”œâ”€â”€ Inventory                                       â”‚   â”‚
â”‚  â”‚  â”œâ”€â”€ Modules                                         â”‚   â”‚
â”‚  â”‚  â””â”€â”€ Plugins                                         â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                            â”‚ SSH
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚                   â”‚                   â”‚
        â–¼                   â–¼                   â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Managed Node  â”‚  â”‚ Managed Node  â”‚  â”‚ Managed Node  â”‚
â”‚ (web-server1) â”‚  â”‚ (web-server2) â”‚  â”‚ (db-server)   â”‚
â”‚   No agent    â”‚  â”‚   No agent    â”‚  â”‚   No agent    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
</code></pre></div>

<h3 id="ansible-vs">Ansible vs ë‹¤ë¥¸ ë„êµ¬<a class="header-link" href="#ansible-vs" title="Permanent link">&para;</a></h3>
<table>
<thead>
<tr>
<th>íŠ¹ì„±</th>
<th>Ansible</th>
<th>Puppet</th>
<th>Chef</th>
</tr>
</thead>
<tbody>
<tr>
<td>ì—ì´ì „íŠ¸</td>
<td>ë¶ˆí•„ìš”</td>
<td>í•„ìš”</td>
<td>í•„ìš”</td>
</tr>
<tr>
<td>ì–¸ì–´</td>
<td>YAML</td>
<td>Ruby DSL</td>
<td>Ruby</td>
</tr>
<tr>
<td>Push/Pull</td>
<td>Push</td>
<td>Pull</td>
<td>Pull</td>
</tr>
<tr>
<td>í•™ìŠµ ê³¡ì„ </td>
<td>ë‚®ìŒ</td>
<td>ì¤‘ê°„</td>
<td>ë†’ìŒ</td>
</tr>
</tbody>
</table>
<hr />
<h2 id="2">2. ì„¤ì¹˜ ë° ì„¤ì •<a class="header-link" href="#2" title="Permanent link">&para;</a></h2>
<h3 id="ansible_2">Ansible ì„¤ì¹˜<a class="header-link" href="#ansible_2" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><span class="c1"># Ubuntu/Debian</span>
sudo<span class="w"> </span>apt<span class="w"> </span>update
sudo<span class="w"> </span>apt<span class="w"> </span>install<span class="w"> </span>ansible

<span class="c1"># RHEL/CentOS</span>
sudo<span class="w"> </span>yum<span class="w"> </span>install<span class="w"> </span>epel-release
sudo<span class="w"> </span>yum<span class="w"> </span>install<span class="w"> </span>ansible

<span class="c1"># pipë¡œ ì„¤ì¹˜ (ê¶Œì¥)</span>
pip3<span class="w"> </span>install<span class="w"> </span>ansible

<span class="c1"># ë²„ì „ í™•ì¸</span>
ansible<span class="w"> </span>--version
</code></pre></div>

<h3 id="ssh">SSH í‚¤ ì„¤ì •<a class="header-link" href="#ssh" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><span class="c1"># SSH í‚¤ ìƒì„±</span>
ssh-keygen<span class="w"> </span>-t<span class="w"> </span>ed25519<span class="w"> </span>-f<span class="w"> </span>~/.ssh/ansible_key

<span class="c1"># ëŒ€ìƒ ì„œë²„ì— í‚¤ ë³µì‚¬</span>
ssh-copy-id<span class="w"> </span>-i<span class="w"> </span>~/.ssh/ansible_key.pub<span class="w"> </span>user@target-server

<span class="c1"># SSH ì—°ê²° í…ŒìŠ¤íŠ¸</span>
ssh<span class="w"> </span>-i<span class="w"> </span>~/.ssh/ansible_key<span class="w"> </span>user@target-server
</code></pre></div>

<h3 id="ansiblecfg">ansible.cfg ì„¤ì •<a class="header-link" href="#ansiblecfg" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><span class="c1"># /etc/ansible/ansible.cfg (ì „ì—­)</span>
<span class="c1"># ~/.ansible.cfg (ì‚¬ìš©ì)</span>
<span class="c1"># ./ansible.cfg (í”„ë¡œì íŠ¸)</span>
</code></pre></div>

<div class="highlight"><pre><span></span><code><span class="c1"># ansible.cfg</span>
<span class="k">[defaults]</span>
<span class="na">inventory</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">./inventory</span>
<span class="na">remote_user</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">ansible</span>
<span class="na">private_key_file</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">~/.ssh/ansible_key</span>
<span class="na">host_key_checking</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">False</span>
<span class="na">retry_files_enabled</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">False</span>
<span class="na">forks</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">20</span>
<span class="na">timeout</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">30</span>

<span class="k">[privilege_escalation]</span>
<span class="na">become</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">True</span>
<span class="na">become_method</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">sudo</span>
<span class="na">become_user</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">root</span>
<span class="na">become_ask_pass</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">False</span>

<span class="k">[ssh_connection]</span>
<span class="na">pipelining</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">True</span>
<span class="na">ssh_args</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">-o ControlMaster=auto -o ControlPersist=60s</span>
</code></pre></div>

<hr />
<h2 id="3">3. ì¸ë²¤í† ë¦¬<a class="header-link" href="#3" title="Permanent link">&para;</a></h2>
<h3 id="ini">INI í˜•ì‹<a class="header-link" href="#ini" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><span class="c1"># inventory/hosts</span>
<span class="k">[webservers]</span>
<span class="na">web1.example.com</span>
<span class="na">web2.example.com ansible_host</span><span class="o">=</span><span class="s">192.168.1.11</span>

<span class="k">[dbservers]</span>
<span class="na">db1.example.com ansible_host</span><span class="o">=</span><span class="s">192.168.1.21 ansible_port=2222</span>
<span class="na">db2.example.com ansible_user</span><span class="o">=</span><span class="s">dbadmin</span>

<span class="k">[loadbalancers]</span>
<span class="na">lb1.example.com</span>

<span class="c1"># ê·¸ë£¹ì˜ ê·¸ë£¹</span>
<span class="k">[production:children]</span>
<span class="na">webservers</span>
<span class="na">dbservers</span>
<span class="na">loadbalancers</span>

<span class="c1"># ê·¸ë£¹ ë³€ìˆ˜</span>
<span class="k">[webservers:vars]</span>
<span class="na">http_port</span><span class="o">=</span><span class="s">80</span>
<span class="na">max_clients</span><span class="o">=</span><span class="s">200</span>

<span class="k">[all:vars]</span>
<span class="na">ansible_python_interpreter</span><span class="o">=</span><span class="s">/usr/bin/python3</span>
</code></pre></div>

<h3 id="yaml">YAML í˜•ì‹<a class="header-link" href="#yaml" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><span class="c1"># inventory/hosts.yml</span>
<span class="nt">all</span><span class="p">:</span>
<span class="w">  </span><span class="nt">children</span><span class="p">:</span>
<span class="w">    </span><span class="nt">webservers</span><span class="p">:</span>
<span class="w">      </span><span class="nt">hosts</span><span class="p">:</span>
<span class="w">        </span><span class="nt">web1.example.com</span><span class="p">:</span>
<span class="w">        </span><span class="nt">web2.example.com</span><span class="p">:</span>
<span class="w">          </span><span class="nt">ansible_host</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">192.168.1.11</span>
<span class="w">      </span><span class="nt">vars</span><span class="p">:</span>
<span class="w">        </span><span class="nt">http_port</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">80</span>
<span class="w">        </span><span class="nt">max_clients</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">200</span>

<span class="w">    </span><span class="nt">dbservers</span><span class="p">:</span>
<span class="w">      </span><span class="nt">hosts</span><span class="p">:</span>
<span class="w">        </span><span class="nt">db1.example.com</span><span class="p">:</span>
<span class="w">          </span><span class="nt">ansible_host</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">192.168.1.21</span>
<span class="w">          </span><span class="nt">ansible_port</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">2222</span>
<span class="w">        </span><span class="nt">db2.example.com</span><span class="p">:</span>
<span class="w">          </span><span class="nt">ansible_user</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">dbadmin</span>

<span class="w">    </span><span class="nt">production</span><span class="p">:</span>
<span class="w">      </span><span class="nt">children</span><span class="p">:</span>
<span class="w">        </span><span class="nt">webservers</span><span class="p">:</span>
<span class="w">        </span><span class="nt">dbservers</span><span class="p">:</span>

<span class="w">  </span><span class="nt">vars</span><span class="p">:</span>
<span class="w">    </span><span class="nt">ansible_python_interpreter</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">/usr/bin/python3</span>
</code></pre></div>

<h3 id="_3">ë™ì  ì¸ë²¤í† ë¦¬<a class="header-link" href="#_3" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><span class="c1"># AWS EC2 ë™ì  ì¸ë²¤í† ë¦¬</span>
pip<span class="w"> </span>install<span class="w"> </span>boto3<span class="w"> </span>botocore

<span class="c1"># ansible.cfg</span>
<span class="o">[</span>defaults<span class="o">]</span>
<span class="nv">inventory</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>aws_ec2.yml
</code></pre></div>

<div class="highlight"><pre><span></span><code><span class="c1"># aws_ec2.yml</span>
<span class="nt">plugin</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">amazon.aws.aws_ec2</span>
<span class="nt">regions</span><span class="p">:</span>
<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">ap-northeast-2</span>
<span class="nt">keyed_groups</span><span class="p">:</span>
<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">key</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">tags.Environment</span>
<span class="w">    </span><span class="nt">prefix</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">env</span>
<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">key</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">instance_type</span>
<span class="w">    </span><span class="nt">prefix</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">type</span>
<span class="nt">compose</span><span class="p">:</span>
<span class="w">  </span><span class="nt">ansible_host</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">public_ip_address</span>
</code></pre></div>

<h3 id="_4">ì¸ë²¤í† ë¦¬ í™•ì¸<a class="header-link" href="#_4" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><span class="c1"># í˜¸ìŠ¤íŠ¸ ëª©ë¡</span>
ansible-inventory<span class="w"> </span>--list
ansible-inventory<span class="w"> </span>--graph

<span class="c1"># íŠ¹ì • ê·¸ë£¹</span>
ansible<span class="w"> </span>webservers<span class="w"> </span>--list-hosts

<span class="c1"># í˜¸ìŠ¤íŠ¸ ë³€ìˆ˜ í™•ì¸</span>
ansible-inventory<span class="w"> </span>--host<span class="w"> </span>web1.example.com
</code></pre></div>

<hr />
<h2 id="4-ad-hoc">4. Ad-hoc ëª…ë ¹ì–´<a class="header-link" href="#4-ad-hoc" title="Permanent link">&para;</a></h2>
<h3 id="_5">ê¸°ë³¸ ì‚¬ìš©ë²•<a class="header-link" href="#_5" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code>ansible<span class="w"> </span>&lt;pattern&gt;<span class="w"> </span>-m<span class="w"> </span>&lt;module&gt;<span class="w"> </span>-a<span class="w"> </span><span class="s2">&quot;&lt;arguments&gt;&quot;</span>

<span class="c1"># ì˜ˆì‹œ</span>
ansible<span class="w"> </span>all<span class="w"> </span>-m<span class="w"> </span>ping
ansible<span class="w"> </span>webservers<span class="w"> </span>-m<span class="w"> </span><span class="nb">command</span><span class="w"> </span>-a<span class="w"> </span><span class="s2">&quot;uptime&quot;</span>
ansible<span class="w"> </span>dbservers<span class="w"> </span>-m<span class="w"> </span>shell<span class="w"> </span>-a<span class="w"> </span><span class="s2">&quot;df -h | grep /dev/sda&quot;</span>
</code></pre></div>

<h3 id="_6">ìì£¼ ì‚¬ìš©í•˜ëŠ” ëª¨ë“ˆ<a class="header-link" href="#_6" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><span class="c1"># ping (ì—°ê²° í…ŒìŠ¤íŠ¸)</span>
ansible<span class="w"> </span>all<span class="w"> </span>-m<span class="w"> </span>ping

<span class="c1"># command (ê¸°ë³¸ ëª…ë ¹ ì‹¤í–‰)</span>
ansible<span class="w"> </span>all<span class="w"> </span>-m<span class="w"> </span><span class="nb">command</span><span class="w"> </span>-a<span class="w"> </span><span class="s2">&quot;hostname&quot;</span>

<span class="c1"># shell (ì‰˜ ê¸°ëŠ¥ ì‚¬ìš©)</span>
ansible<span class="w"> </span>all<span class="w"> </span>-m<span class="w"> </span>shell<span class="w"> </span>-a<span class="w"> </span><span class="s2">&quot;cat /etc/os-release | grep VERSION&quot;</span>

<span class="c1"># copy (íŒŒì¼ ë³µì‚¬)</span>
ansible<span class="w"> </span>all<span class="w"> </span>-m<span class="w"> </span>copy<span class="w"> </span>-a<span class="w"> </span><span class="s2">&quot;src=/local/file dest=/remote/path mode=0644&quot;</span>

<span class="c1"># file (íŒŒì¼/ë””ë ‰í† ë¦¬ ê´€ë¦¬)</span>
ansible<span class="w"> </span>all<span class="w"> </span>-m<span class="w"> </span>file<span class="w"> </span>-a<span class="w"> </span><span class="s2">&quot;path=/tmp/testdir state=directory mode=0755&quot;</span>

<span class="c1"># yum/apt (íŒ¨í‚¤ì§€ ê´€ë¦¬)</span>
ansible<span class="w"> </span>webservers<span class="w"> </span>-m<span class="w"> </span>yum<span class="w"> </span>-a<span class="w"> </span><span class="s2">&quot;name=httpd state=present&quot;</span>
ansible<span class="w"> </span>webservers<span class="w"> </span>-m<span class="w"> </span>apt<span class="w"> </span>-a<span class="w"> </span><span class="s2">&quot;name=nginx state=present update_cache=yes&quot;</span>

<span class="c1"># service (ì„œë¹„ìŠ¤ ê´€ë¦¬)</span>
ansible<span class="w"> </span>webservers<span class="w"> </span>-m<span class="w"> </span>service<span class="w"> </span>-a<span class="w"> </span><span class="s2">&quot;name=nginx state=started enabled=yes&quot;</span>

<span class="c1"># user (ì‚¬ìš©ì ê´€ë¦¬)</span>
ansible<span class="w"> </span>all<span class="w"> </span>-m<span class="w"> </span>user<span class="w"> </span>-a<span class="w"> </span><span class="s2">&quot;name=deploy state=present groups=sudo&quot;</span>

<span class="c1"># setup (ì‹œìŠ¤í…œ ì •ë³´ ìˆ˜ì§‘)</span>
ansible<span class="w"> </span>web1<span class="w"> </span>-m<span class="w"> </span>setup
ansible<span class="w"> </span>web1<span class="w"> </span>-m<span class="w"> </span>setup<span class="w"> </span>-a<span class="w"> </span><span class="s2">&quot;filter=ansible_distribution*&quot;</span>
</code></pre></div>

<h3 id="_7">ê¶Œí•œ ìƒìŠ¹<a class="header-link" href="#_7" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><span class="c1"># sudo ì‚¬ìš©</span>
ansible<span class="w"> </span>all<span class="w"> </span>-m<span class="w"> </span>apt<span class="w"> </span>-a<span class="w"> </span><span class="s2">&quot;name=vim state=present&quot;</span><span class="w"> </span>--become

<span class="c1"># íŠ¹ì • ì‚¬ìš©ìë¡œ</span>
ansible<span class="w"> </span>all<span class="w"> </span>-m<span class="w"> </span><span class="nb">command</span><span class="w"> </span>-a<span class="w"> </span><span class="s2">&quot;whoami&quot;</span><span class="w"> </span>--become<span class="w"> </span>--become-user<span class="o">=</span>postgres
</code></pre></div>

<h3 id="_8">ë³‘ë ¬ ì‹¤í–‰<a class="header-link" href="#_8" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><span class="c1"># ë™ì‹œ ì‹¤í–‰ í˜¸ìŠ¤íŠ¸ ìˆ˜ ì¡°ì ˆ</span>
ansible<span class="w"> </span>all<span class="w"> </span>-m<span class="w"> </span>ping<span class="w"> </span>-f<span class="w"> </span><span class="m">50</span><span class="w">  </span><span class="c1"># 50ê°œ ë™ì‹œ ì‹¤í–‰</span>

<span class="c1"># ìˆœì°¨ ì‹¤í–‰</span>
ansible<span class="w"> </span>all<span class="w"> </span>-m<span class="w"> </span>ping<span class="w"> </span>-f<span class="w"> </span><span class="m">1</span>
</code></pre></div>

<hr />
<h2 id="5-playbook">5. Playbook<a class="header-link" href="#5-playbook" title="Permanent link">&para;</a></h2>
<h3 id="_9">ê¸°ë³¸ êµ¬ì¡°<a class="header-link" href="#_9" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><span class="c1"># site.yml</span>
<span class="nn">---</span>
<span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Configure webservers</span>
<span class="w">  </span><span class="nt">hosts</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">webservers</span>
<span class="w">  </span><span class="nt">become</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">yes</span>
<span class="w">  </span><span class="nt">vars</span><span class="p">:</span>
<span class="w">    </span><span class="nt">http_port</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">80</span>

<span class="w">  </span><span class="nt">tasks</span><span class="p">:</span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Install nginx</span>
<span class="w">      </span><span class="nt">apt</span><span class="p">:</span>
<span class="w">        </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">nginx</span>
<span class="w">        </span><span class="nt">state</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">present</span>
<span class="w">        </span><span class="nt">update_cache</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">yes</span>

<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Start nginx service</span>
<span class="w">      </span><span class="nt">service</span><span class="p">:</span>
<span class="w">        </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">nginx</span>
<span class="w">        </span><span class="nt">state</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">started</span>
<span class="w">        </span><span class="nt">enabled</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">yes</span>

<span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Configure databases</span>
<span class="w">  </span><span class="nt">hosts</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">dbservers</span>
<span class="w">  </span><span class="nt">become</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">yes</span>

<span class="w">  </span><span class="nt">tasks</span><span class="p">:</span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Install PostgreSQL</span>
<span class="w">      </span><span class="nt">apt</span><span class="p">:</span>
<span class="w">        </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">postgresql</span>
<span class="w">        </span><span class="nt">state</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">present</span>
</code></pre></div>

<h3 id="playbook">Playbook ì‹¤í–‰<a class="header-link" href="#playbook" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><span class="c1"># ê¸°ë³¸ ì‹¤í–‰</span>
ansible-playbook<span class="w"> </span>site.yml

<span class="c1"># ì¸ë²¤í† ë¦¬ ì§€ì •</span>
ansible-playbook<span class="w"> </span>-i<span class="w"> </span>inventory/production<span class="w"> </span>site.yml

<span class="c1"># ë“œë¼ì´ëŸ° (ë³€ê²½ ì—†ì´ í™•ì¸)</span>
ansible-playbook<span class="w"> </span>site.yml<span class="w"> </span>--check

<span class="c1"># ì°¨ì´ì  í‘œì‹œ</span>
ansible-playbook<span class="w"> </span>site.yml<span class="w"> </span>--diff

<span class="c1"># ìƒì„¸ ì¶œë ¥</span>
ansible-playbook<span class="w"> </span>site.yml<span class="w"> </span>-v<span class="w">    </span><span class="c1"># ìƒì„¸</span>
ansible-playbook<span class="w"> </span>site.yml<span class="w"> </span>-vvv<span class="w">  </span><span class="c1"># ë§¤ìš° ìƒì„¸</span>

<span class="c1"># íŠ¹ì • í˜¸ìŠ¤íŠ¸ë§Œ</span>
ansible-playbook<span class="w"> </span>site.yml<span class="w"> </span>--limit<span class="w"> </span>web1.example.com

<span class="c1"># íƒœê·¸ ì‚¬ìš©</span>
ansible-playbook<span class="w"> </span>site.yml<span class="w"> </span>--tags<span class="w"> </span><span class="s2">&quot;install,configure&quot;</span>
ansible-playbook<span class="w"> </span>site.yml<span class="w"> </span>--skip-tags<span class="w"> </span><span class="s2">&quot;debug&quot;</span>

<span class="c1"># ì‹œì‘ íƒœìŠ¤í¬ ì§€ì •</span>
ansible-playbook<span class="w"> </span>site.yml<span class="w"> </span>--start-at-task<span class="w"> </span><span class="s2">&quot;Start nginx service&quot;</span>
</code></pre></div>

<h3 id="when">ì¡°ê±´ë¬¸ (when)<a class="header-link" href="#when" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><span class="nt">tasks</span><span class="p">:</span>
<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Install Apache (RHEL)</span>
<span class="w">    </span><span class="nt">yum</span><span class="p">:</span>
<span class="w">      </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">httpd</span>
<span class="w">      </span><span class="nt">state</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">present</span>
<span class="w">    </span><span class="nt">when</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">ansible_os_family == &quot;RedHat&quot;</span>

<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Install Apache (Debian)</span>
<span class="w">    </span><span class="nt">apt</span><span class="p">:</span>
<span class="w">      </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">apache2</span>
<span class="w">      </span><span class="nt">state</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">present</span>
<span class="w">    </span><span class="nt">when</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">ansible_os_family == &quot;Debian&quot;</span>

<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Check if file exists</span>
<span class="w">    </span><span class="nt">stat</span><span class="p">:</span>
<span class="w">      </span><span class="nt">path</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">/etc/myapp.conf</span>
<span class="w">    </span><span class="nt">register</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">config_file</span>

<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Create config if not exists</span>
<span class="w">    </span><span class="nt">template</span><span class="p">:</span>
<span class="w">      </span><span class="nt">src</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">myapp.conf.j2</span>
<span class="w">      </span><span class="nt">dest</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">/etc/myapp.conf</span>
<span class="w">    </span><span class="nt">when</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">not config_file.stat.exists</span>
</code></pre></div>

<h3 id="loop">ë°˜ë³µë¬¸ (loop)<a class="header-link" href="#loop" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><span class="nt">tasks</span><span class="p">:</span>
<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Install multiple packages</span>
<span class="w">    </span><span class="nt">apt</span><span class="p">:</span>
<span class="w">      </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;{{</span><span class="nv"> </span><span class="s">item</span><span class="nv"> </span><span class="s">}}&quot;</span>
<span class="w">      </span><span class="nt">state</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">present</span>
<span class="w">    </span><span class="nt">loop</span><span class="p">:</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">nginx</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">vim</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">git</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">curl</span>

<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Create users</span>
<span class="w">    </span><span class="nt">user</span><span class="p">:</span>
<span class="w">      </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;{{</span><span class="nv"> </span><span class="s">item.name</span><span class="nv"> </span><span class="s">}}&quot;</span>
<span class="w">      </span><span class="nt">groups</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;{{</span><span class="nv"> </span><span class="s">item.groups</span><span class="nv"> </span><span class="s">}}&quot;</span>
<span class="w">      </span><span class="nt">state</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">present</span>
<span class="w">    </span><span class="nt">loop</span><span class="p">:</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="p p-Indicator">{</span><span class="nt"> name</span><span class="p">:</span><span class="w"> </span><span class="s">&#39;alice&#39;</span><span class="p p-Indicator">,</span><span class="nt"> groups</span><span class="p">:</span><span class="w"> </span><span class="s">&#39;sudo&#39;</span><span class="w"> </span><span class="p p-Indicator">}</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="p p-Indicator">{</span><span class="nt"> name</span><span class="p">:</span><span class="w"> </span><span class="s">&#39;bob&#39;</span><span class="p p-Indicator">,</span><span class="nt"> groups</span><span class="p">:</span><span class="w"> </span><span class="s">&#39;developers&#39;</span><span class="w"> </span><span class="p p-Indicator">}</span>

<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Install packages with apt</span>
<span class="w">    </span><span class="nt">apt</span><span class="p">:</span>
<span class="w">      </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;{{</span><span class="nv"> </span><span class="s">packages</span><span class="nv"> </span><span class="s">}}&quot;</span>
<span class="w">      </span><span class="nt">state</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">present</span>
<span class="w">    </span><span class="nt">vars</span><span class="p">:</span>
<span class="w">      </span><span class="nt">packages</span><span class="p">:</span>
<span class="w">        </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">nginx</span>
<span class="w">        </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">postgresql</span>
<span class="w">        </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">redis</span>
</code></pre></div>

<h3 id="handlers">í•¸ë“¤ëŸ¬ (handlers)<a class="header-link" href="#handlers" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><span class="nt">tasks</span><span class="p">:</span>
<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Copy nginx config</span>
<span class="w">    </span><span class="nt">template</span><span class="p">:</span>
<span class="w">      </span><span class="nt">src</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">nginx.conf.j2</span>
<span class="w">      </span><span class="nt">dest</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">/etc/nginx/nginx.conf</span>
<span class="w">    </span><span class="nt">notify</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Restart nginx</span>

<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Copy site config</span>
<span class="w">    </span><span class="nt">template</span><span class="p">:</span>
<span class="w">      </span><span class="nt">src</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">site.conf.j2</span>
<span class="w">      </span><span class="nt">dest</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">/etc/nginx/sites-available/mysite</span>
<span class="w">    </span><span class="nt">notify</span><span class="p">:</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Reload nginx</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Clear cache</span>

<span class="nt">handlers</span><span class="p">:</span>
<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Restart nginx</span>
<span class="w">    </span><span class="nt">service</span><span class="p">:</span>
<span class="w">      </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">nginx</span>
<span class="w">      </span><span class="nt">state</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">restarted</span>

<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Reload nginx</span>
<span class="w">    </span><span class="nt">service</span><span class="p">:</span>
<span class="w">      </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">nginx</span>
<span class="w">      </span><span class="nt">state</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">reloaded</span>

<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Clear cache</span>
<span class="w">    </span><span class="nt">file</span><span class="p">:</span>
<span class="w">      </span><span class="nt">path</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">/var/cache/nginx</span>
<span class="w">      </span><span class="nt">state</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">absent</span>
</code></pre></div>

<h3 id="block">ë¸”ë¡ (block)<a class="header-link" href="#block" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><span class="nt">tasks</span><span class="p">:</span>
<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Install and configure app</span>
<span class="w">    </span><span class="nt">block</span><span class="p">:</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Install package</span>
<span class="w">        </span><span class="nt">apt</span><span class="p">:</span>
<span class="w">          </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">myapp</span>
<span class="w">          </span><span class="nt">state</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">present</span>

<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Configure app</span>
<span class="w">        </span><span class="nt">template</span><span class="p">:</span>
<span class="w">          </span><span class="nt">src</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">myapp.conf.j2</span>
<span class="w">          </span><span class="nt">dest</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">/etc/myapp/config.yml</span>

<span class="w">    </span><span class="nt">rescue</span><span class="p">:</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Rollback on failure</span>
<span class="w">        </span><span class="nt">apt</span><span class="p">:</span>
<span class="w">          </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">myapp</span>
<span class="w">          </span><span class="nt">state</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">absent</span>

<span class="w">    </span><span class="nt">always</span><span class="p">:</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Always run cleanup</span>
<span class="w">        </span><span class="nt">file</span><span class="p">:</span>
<span class="w">          </span><span class="nt">path</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">/tmp/install_temp</span>
<span class="w">          </span><span class="nt">state</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">absent</span>

<span class="w">    </span><span class="nt">when</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">install_myapp | default(true)</span>
<span class="w">    </span><span class="nt">become</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">yes</span>
</code></pre></div>

<hr />
<h2 id="6">6. ë³€ìˆ˜ì™€ íŒ©íŠ¸<a class="header-link" href="#6" title="Permanent link">&para;</a></h2>
<h3 id="_10">ë³€ìˆ˜ ì •ì˜ ìœ„ì¹˜<a class="header-link" href="#_10" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><span class="err">ìš°ì„ ìˆœìœ„</span><span class="w"> </span><span class="p">(</span><span class="err">ë‚®ìŒ</span><span class="w"> </span><span class="err">â†’</span><span class="w"> </span><span class="err">ë†’ìŒ</span><span class="p">):</span>
<span class="mf">1.</span><span class="w"> </span><span class="n">role</span><span class="w"> </span><span class="n">defaults</span>
<span class="mf">2.</span><span class="w"> </span><span class="n">inventory</span><span class="w"> </span><span class="n">file</span><span class="w"> </span><span class="n">vars</span>
<span class="mf">3.</span><span class="w"> </span><span class="n">inventory</span><span class="w"> </span><span class="n">group_vars</span>
<span class="mf">4.</span><span class="w"> </span><span class="n">inventory</span><span class="w"> </span><span class="n">host_vars</span>
<span class="mf">5.</span><span class="w"> </span><span class="n">playbook</span><span class="w"> </span><span class="n">group_vars</span>
<span class="mf">6.</span><span class="w"> </span><span class="n">playbook</span><span class="w"> </span><span class="n">host_vars</span>
<span class="mf">7.</span><span class="w"> </span><span class="n">host</span><span class="w"> </span><span class="n">facts</span>
<span class="mf">8.</span><span class="w"> </span><span class="n">play</span><span class="w"> </span><span class="n">vars</span>
<span class="mf">9.</span><span class="w"> </span><span class="n">play</span><span class="w"> </span><span class="n">vars_prompt</span>
<span class="mf">10.</span><span class="w"> </span><span class="n">play</span><span class="w"> </span><span class="n">vars_files</span>
<span class="mf">11.</span><span class="w"> </span><span class="n">role</span><span class="w"> </span><span class="n">vars</span>
<span class="mf">12.</span><span class="w"> </span><span class="n">block</span><span class="w"> </span><span class="n">vars</span>
<span class="mf">13.</span><span class="w"> </span><span class="n">task</span><span class="w"> </span><span class="n">vars</span>
<span class="mf">14.</span><span class="w"> </span><span class="n">include_vars</span>
<span class="mf">15.</span><span class="w"> </span><span class="n">set_facts</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="n">registered</span><span class="w"> </span><span class="n">vars</span>
<span class="mf">16.</span><span class="w"> </span><span class="n">role</span><span class="w"> </span><span class="n">parameters</span>
<span class="mf">17.</span><span class="w"> </span><span class="n">extra</span><span class="w"> </span><span class="n">vars</span><span class="w"> </span><span class="p">(</span><span class="o">-</span><span class="n">e</span><span class="p">)</span>
</code></pre></div>

<h3 id="_11">ë³€ìˆ˜ íŒŒì¼ êµ¬ì¡°<a class="header-link" href="#_11" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><span class="n">project</span><span class="o">/</span>
<span class="err">â”œâ”€â”€</span><span class="w"> </span><span class="n">ansible</span><span class="o">.</span><span class="n">cfg</span>
<span class="err">â”œâ”€â”€</span><span class="w"> </span><span class="n">inventory</span><span class="o">/</span>
<span class="err">â”‚</span><span class="w">   </span><span class="err">â”œâ”€â”€</span><span class="w"> </span><span class="n">hosts</span>
<span class="err">â”‚</span><span class="w">   </span><span class="err">â”œâ”€â”€</span><span class="w"> </span><span class="n">group_vars</span><span class="o">/</span>
<span class="err">â”‚</span><span class="w">   </span><span class="err">â”‚</span><span class="w">   </span><span class="err">â”œâ”€â”€</span><span class="w"> </span><span class="n">all</span><span class="o">.</span><span class="n">yml</span>
<span class="err">â”‚</span><span class="w">   </span><span class="err">â”‚</span><span class="w">   </span><span class="err">â”œâ”€â”€</span><span class="w"> </span><span class="n">webservers</span><span class="o">.</span><span class="n">yml</span>
<span class="err">â”‚</span><span class="w">   </span><span class="err">â”‚</span><span class="w">   </span><span class="err">â””â”€â”€</span><span class="w"> </span><span class="n">dbservers</span><span class="o">.</span><span class="n">yml</span>
<span class="err">â”‚</span><span class="w">   </span><span class="err">â””â”€â”€</span><span class="w"> </span><span class="n">host_vars</span><span class="o">/</span>
<span class="err">â”‚</span><span class="w">       </span><span class="err">â”œâ”€â”€</span><span class="w"> </span><span class="n">web1</span><span class="o">.</span><span class="n">example</span><span class="o">.</span><span class="n">com</span><span class="o">.</span><span class="n">yml</span>
<span class="err">â”‚</span><span class="w">       </span><span class="err">â””â”€â”€</span><span class="w"> </span><span class="n">db1</span><span class="o">.</span><span class="n">example</span><span class="o">.</span><span class="n">com</span><span class="o">.</span><span class="n">yml</span>
<span class="err">â”œâ”€â”€</span><span class="w"> </span><span class="n">playbooks</span><span class="o">/</span>
<span class="err">â”‚</span><span class="w">   </span><span class="err">â””â”€â”€</span><span class="w"> </span><span class="n">site</span><span class="o">.</span><span class="n">yml</span>
<span class="err">â””â”€â”€</span><span class="w"> </span><span class="n">roles</span><span class="o">/</span>
</code></pre></div>

<h3 id="group_varshost_vars">group_vars/host_vars ì˜ˆì‹œ<a class="header-link" href="#group_varshost_vars" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><span class="c1"># inventory/group_vars/all.yml</span>
<span class="nn">---</span>
<span class="nt">ansible_user</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">deploy</span>
<span class="nt">ntp_servers</span><span class="p">:</span>
<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">0.pool.ntp.org</span>
<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">1.pool.ntp.org</span>

<span class="c1"># inventory/group_vars/webservers.yml</span>
<span class="nn">---</span>
<span class="nt">http_port</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">80</span>
<span class="nt">nginx_worker_processes</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">auto</span>

<span class="c1"># inventory/host_vars/web1.example.com.yml</span>
<span class="nn">---</span>
<span class="nt">nginx_worker_processes</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">4</span>
<span class="nt">custom_config</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">true</span>
</code></pre></div>

<h3 id="playbook_1">Playbookì—ì„œ ë³€ìˆ˜ ì‚¬ìš©<a class="header-link" href="#playbook_1" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><span class="nn">---</span>
<span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Configure web servers</span>
<span class="w">  </span><span class="nt">hosts</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">webservers</span>
<span class="w">  </span><span class="nt">vars</span><span class="p">:</span>
<span class="w">    </span><span class="nt">app_name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">myapp</span>
<span class="w">    </span><span class="nt">app_version</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;1.2.3&quot;</span>
<span class="w">    </span><span class="nt">app_env</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">production</span>

<span class="w">  </span><span class="nt">vars_files</span><span class="p">:</span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">vars/common.yml</span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="s">&quot;vars/{{</span><span class="nv"> </span><span class="s">ansible_os_family</span><span class="nv"> </span><span class="s">}}.yml&quot;</span>

<span class="w">  </span><span class="nt">tasks</span><span class="p">:</span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Deploy application</span>
<span class="w">      </span><span class="nt">template</span><span class="p">:</span>
<span class="w">        </span><span class="nt">src</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">app.conf.j2</span>
<span class="w">        </span><span class="nt">dest</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;/etc/{{</span><span class="nv"> </span><span class="s">app_name</span><span class="nv"> </span><span class="s">}}/config.yml&quot;</span>

<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Set runtime variable</span>
<span class="w">      </span><span class="nt">set_fact</span><span class="p">:</span>
<span class="w">        </span><span class="nt">runtime_var</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;{{</span><span class="nv"> </span><span class="s">ansible_hostname</span><span class="nv"> </span><span class="s">}}-{{</span><span class="nv"> </span><span class="s">app_version</span><span class="nv"> </span><span class="s">}}&quot;</span>
</code></pre></div>

<h3 id="facts">íŒ©íŠ¸ (Facts)<a class="header-link" href="#facts" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><span class="nt">tasks</span><span class="p">:</span>
<span class="w">  </span><span class="c1"># ìë™ ìˆ˜ì§‘ëœ íŒ©íŠ¸ ì‚¬ìš©</span>
<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Print OS info</span>
<span class="w">    </span><span class="nt">debug</span><span class="p">:</span>
<span class="w">      </span><span class="nt">msg</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;OS:</span><span class="nv"> </span><span class="s">{{</span><span class="nv"> </span><span class="s">ansible_distribution</span><span class="nv"> </span><span class="s">}}</span><span class="nv"> </span><span class="s">{{</span><span class="nv"> </span><span class="s">ansible_distribution_version</span><span class="nv"> </span><span class="s">}}&quot;</span>

<span class="w">  </span><span class="c1"># ì»¤ìŠ¤í…€ íŒ©íŠ¸ (ëŒ€ìƒ í˜¸ìŠ¤íŠ¸ì— ì €ì¥)</span>
<span class="w">  </span><span class="c1"># /etc/ansible/facts.d/custom.fact</span>
<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Create custom fact</span>
<span class="w">    </span><span class="nt">copy</span><span class="p">:</span>
<span class="w">      </span><span class="nt">content</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">|</span>
<span class="w">        </span><span class="no">[app]</span>
<span class="w">        </span><span class="no">version=1.2.3</span>
<span class="w">        </span><span class="no">environment=production</span>
<span class="w">      </span><span class="nt">dest</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">/etc/ansible/facts.d/custom.fact</span>
<span class="w">      </span><span class="nt">mode</span><span class="p">:</span><span class="w"> </span><span class="s">&#39;0644&#39;</span>

<span class="w">  </span><span class="c1"># íŒ©íŠ¸ ìƒˆë¡œê³ ì¹¨</span>
<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Refresh facts</span>
<span class="w">    </span><span class="nt">setup</span><span class="p">:</span>
<span class="w">      </span><span class="nt">filter</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">ansible_local</span>

<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Use custom fact</span>
<span class="w">    </span><span class="nt">debug</span><span class="p">:</span>
<span class="w">      </span><span class="nt">msg</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;App</span><span class="nv"> </span><span class="s">version:</span><span class="nv"> </span><span class="s">{{</span><span class="nv"> </span><span class="s">ansible_local.custom.app.version</span><span class="nv"> </span><span class="s">}}&quot;</span>
</code></pre></div>

<h3 id="jinja2">Jinja2 í…œí”Œë¦¿<a class="header-link" href="#jinja2" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><span class="c">{# templates/nginx.conf.j2 #}</span>
<span class="x">worker_processes </span><span class="cp">{{</span> <span class="nv">nginx_worker_processes</span> <span class="o">|</span> <span class="nf">default</span><span class="o">(</span><span class="s1">&#39;auto&#39;</span><span class="o">)</span> <span class="cp">}}</span><span class="x">;</span>

<span class="x">events {</span>
<span class="x">    worker_connections </span><span class="cp">{{</span> <span class="nv">nginx_worker_connections</span> <span class="o">|</span> <span class="nf">default</span><span class="o">(</span><span class="m">1024</span><span class="o">)</span> <span class="cp">}}</span><span class="x">;</span>
<span class="x">}</span>

<span class="x">http {</span>
<span class="x">    server {</span>
<span class="x">        listen </span><span class="cp">{{</span> <span class="nv">http_port</span> <span class="cp">}}</span><span class="x">;</span>
<span class="x">        server_name </span><span class="cp">{{</span> <span class="nv">ansible_fqdn</span> <span class="cp">}}</span><span class="x">;</span>

<span class="x">        </span><span class="cp">{%</span> <span class="k">for</span> <span class="nv">location</span> <span class="k">in</span> <span class="nv">nginx_locations</span> <span class="o">|</span> <span class="nf">default</span><span class="o">([])</span> <span class="cp">%}</span>
<span class="x">        location </span><span class="cp">{{</span> <span class="nv">location.path</span> <span class="cp">}}</span><span class="x"> {</span>
<span class="x">            proxy_pass </span><span class="cp">{{</span> <span class="nv">location.proxy</span> <span class="cp">}}</span><span class="x">;</span>
<span class="x">        }</span>
<span class="x">        </span><span class="cp">{%</span> <span class="k">endfor</span> <span class="cp">%}</span>

<span class="x">        </span><span class="cp">{%</span> <span class="k">if</span> <span class="nv">enable_ssl</span> <span class="o">|</span> <span class="nf">default</span><span class="o">(</span><span class="kp">false</span><span class="o">)</span> <span class="cp">%}</span>
<span class="x">        ssl_certificate </span><span class="cp">{{</span> <span class="nv">ssl_cert_path</span> <span class="cp">}}</span><span class="x">;</span>
<span class="x">        ssl_certificate_key </span><span class="cp">{{</span> <span class="nv">ssl_key_path</span> <span class="cp">}}</span><span class="x">;</span>
<span class="x">        </span><span class="cp">{%</span> <span class="k">endif</span> <span class="cp">%}</span>
<span class="x">    }</span>
<span class="x">}</span>
</code></pre></div>

<hr />
<h2 id="7-roles">7. Roles<a class="header-link" href="#7-roles" title="Permanent link">&para;</a></h2>
<h3 id="role">Role êµ¬ì¡°<a class="header-link" href="#role" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><span class="n">roles</span><span class="o">/</span>
<span class="err">â””â”€â”€</span><span class="w"> </span><span class="n">webserver</span><span class="o">/</span>
<span class="w">    </span><span class="err">â”œâ”€â”€</span><span class="w"> </span><span class="n">defaults</span><span class="o">/</span>
<span class="w">    </span><span class="err">â”‚</span><span class="w">   </span><span class="err">â””â”€â”€</span><span class="w"> </span><span class="n">main</span><span class="o">.</span><span class="n">yml</span><span class="w">      </span><span class="c1"># ê¸°ë³¸ ë³€ìˆ˜ (ë‚®ì€ ìš°ì„ ìˆœìœ„)</span>
<span class="w">    </span><span class="err">â”œâ”€â”€</span><span class="w"> </span><span class="n">files</span><span class="o">/</span>
<span class="w">    </span><span class="err">â”‚</span><span class="w">   </span><span class="err">â””â”€â”€</span><span class="w"> </span><span class="k">static</span><span class="o">.</span><span class="n">conf</span><span class="w">   </span><span class="c1"># ì •ì  íŒŒì¼</span>
<span class="w">    </span><span class="err">â”œâ”€â”€</span><span class="w"> </span><span class="n">handlers</span><span class="o">/</span>
<span class="w">    </span><span class="err">â”‚</span><span class="w">   </span><span class="err">â””â”€â”€</span><span class="w"> </span><span class="n">main</span><span class="o">.</span><span class="n">yml</span><span class="w">      </span><span class="c1"># í•¸ë“¤ëŸ¬</span>
<span class="w">    </span><span class="err">â”œâ”€â”€</span><span class="w"> </span><span class="n">meta</span><span class="o">/</span>
<span class="w">    </span><span class="err">â”‚</span><span class="w">   </span><span class="err">â””â”€â”€</span><span class="w"> </span><span class="n">main</span><span class="o">.</span><span class="n">yml</span><span class="w">      </span><span class="c1"># ì˜ì¡´ì„±, ë©”íƒ€ë°ì´í„°</span>
<span class="w">    </span><span class="err">â”œâ”€â”€</span><span class="w"> </span><span class="n">tasks</span><span class="o">/</span>
<span class="w">    </span><span class="err">â”‚</span><span class="w">   </span><span class="err">â””â”€â”€</span><span class="w"> </span><span class="n">main</span><span class="o">.</span><span class="n">yml</span><span class="w">      </span><span class="c1"># íƒœìŠ¤í¬</span>
<span class="w">    </span><span class="err">â”œâ”€â”€</span><span class="w"> </span><span class="n">templates</span><span class="o">/</span>
<span class="w">    </span><span class="err">â”‚</span><span class="w">   </span><span class="err">â””â”€â”€</span><span class="w"> </span><span class="n">nginx</span><span class="o">.</span><span class="n">conf</span><span class="o">.</span><span class="n">j2</span><span class="w"> </span><span class="c1"># Jinja2 í…œí”Œë¦¿</span>
<span class="w">    </span><span class="err">â””â”€â”€</span><span class="w"> </span><span class="n">vars</span><span class="o">/</span>
<span class="w">        </span><span class="err">â””â”€â”€</span><span class="w"> </span><span class="n">main</span><span class="o">.</span><span class="n">yml</span><span class="w">      </span><span class="c1"># ë³€ìˆ˜ (ë†’ì€ ìš°ì„ ìˆœìœ„)</span>
</code></pre></div>

<h3 id="role_1">Role ìƒì„±<a class="header-link" href="#role_1" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><span class="c1"># ê¸°ë³¸ êµ¬ì¡° ìƒì„±</span>
ansible-galaxy<span class="w"> </span>init<span class="w"> </span>roles/webserver
</code></pre></div>

<h3 id="role_2">Role ì˜ˆì‹œ<a class="header-link" href="#role_2" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><span class="c1"># roles/webserver/defaults/main.yml</span>
<span class="nn">---</span>
<span class="nt">nginx_port</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">80</span>
<span class="nt">nginx_worker_processes</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">auto</span>
<span class="nt">nginx_sites</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">[]</span>
</code></pre></div>

<div class="highlight"><pre><span></span><code><span class="c1"># roles/webserver/tasks/main.yml</span>
<span class="nn">---</span>
<span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Install nginx</span>
<span class="w">  </span><span class="nt">apt</span><span class="p">:</span>
<span class="w">    </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">nginx</span>
<span class="w">    </span><span class="nt">state</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">present</span>
<span class="w">    </span><span class="nt">update_cache</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">yes</span>
<span class="w">  </span><span class="nt">tags</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">install</span>

<span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Configure nginx</span>
<span class="w">  </span><span class="nt">template</span><span class="p">:</span>
<span class="w">    </span><span class="nt">src</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">nginx.conf.j2</span>
<span class="w">    </span><span class="nt">dest</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">/etc/nginx/nginx.conf</span>
<span class="w">  </span><span class="nt">notify</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Restart nginx</span>
<span class="w">  </span><span class="nt">tags</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">configure</span>

<span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Configure sites</span>
<span class="w">  </span><span class="nt">template</span><span class="p">:</span>
<span class="w">    </span><span class="nt">src</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">site.conf.j2</span>
<span class="w">    </span><span class="nt">dest</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;/etc/nginx/sites-available/{{</span><span class="nv"> </span><span class="s">item.name</span><span class="nv"> </span><span class="s">}}&quot;</span>
<span class="w">  </span><span class="nt">loop</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;{{</span><span class="nv"> </span><span class="s">nginx_sites</span><span class="nv"> </span><span class="s">}}&quot;</span>
<span class="w">  </span><span class="nt">notify</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Reload nginx</span>
<span class="w">  </span><span class="nt">tags</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">configure</span>

<span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Enable sites</span>
<span class="w">  </span><span class="nt">file</span><span class="p">:</span>
<span class="w">    </span><span class="nt">src</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;/etc/nginx/sites-available/{{</span><span class="nv"> </span><span class="s">item.name</span><span class="nv"> </span><span class="s">}}&quot;</span>
<span class="w">    </span><span class="nt">dest</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;/etc/nginx/sites-enabled/{{</span><span class="nv"> </span><span class="s">item.name</span><span class="nv"> </span><span class="s">}}&quot;</span>
<span class="w">    </span><span class="nt">state</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">link</span>
<span class="w">  </span><span class="nt">loop</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;{{</span><span class="nv"> </span><span class="s">nginx_sites</span><span class="nv"> </span><span class="s">}}&quot;</span>
<span class="w">  </span><span class="nt">notify</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Reload nginx</span>
<span class="w">  </span><span class="nt">tags</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">configure</span>

<span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Start nginx</span>
<span class="w">  </span><span class="nt">service</span><span class="p">:</span>
<span class="w">    </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">nginx</span>
<span class="w">    </span><span class="nt">state</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">started</span>
<span class="w">    </span><span class="nt">enabled</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">yes</span>
<span class="w">  </span><span class="nt">tags</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">service</span>
</code></pre></div>

<div class="highlight"><pre><span></span><code><span class="c1"># roles/webserver/handlers/main.yml</span>
<span class="nn">---</span>
<span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Restart nginx</span>
<span class="w">  </span><span class="nt">service</span><span class="p">:</span>
<span class="w">    </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">nginx</span>
<span class="w">    </span><span class="nt">state</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">restarted</span>

<span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Reload nginx</span>
<span class="w">  </span><span class="nt">service</span><span class="p">:</span>
<span class="w">    </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">nginx</span>
<span class="w">    </span><span class="nt">state</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">reloaded</span>
</code></pre></div>

<div class="highlight"><pre><span></span><code><span class="c1"># roles/webserver/meta/main.yml</span>
<span class="nn">---</span>
<span class="nt">dependencies</span><span class="p">:</span>
<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">role</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">common</span>
<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">role</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">firewall</span>
<span class="w">    </span><span class="nt">vars</span><span class="p">:</span>
<span class="w">      </span><span class="nt">firewall_allowed_ports</span><span class="p">:</span>
<span class="w">        </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="s">&quot;{{</span><span class="nv"> </span><span class="s">nginx_port</span><span class="nv"> </span><span class="s">}}&quot;</span>
</code></pre></div>

<h3 id="role_3">Role ì‚¬ìš©<a class="header-link" href="#role_3" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><span class="c1"># site.yml</span>
<span class="nn">---</span>
<span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Configure web servers</span>
<span class="w">  </span><span class="nt">hosts</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">webservers</span>
<span class="w">  </span><span class="nt">become</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">yes</span>
<span class="w">  </span><span class="nt">roles</span><span class="p">:</span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">common</span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">role</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">webserver</span>
<span class="w">      </span><span class="nt">vars</span><span class="p">:</span>
<span class="w">        </span><span class="nt">nginx_port</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">8080</span>
<span class="w">        </span><span class="nt">nginx_sites</span><span class="p">:</span>
<span class="w">          </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">mysite</span>
<span class="w">            </span><span class="nt">domain</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">example.com</span>
<span class="w">            </span><span class="nt">root</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">/var/www/mysite</span>

<span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Configure databases</span>
<span class="w">  </span><span class="nt">hosts</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">dbservers</span>
<span class="w">  </span><span class="nt">become</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">yes</span>
<span class="w">  </span><span class="nt">roles</span><span class="p">:</span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">common</span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">postgresql</span>
</code></pre></div>

<h3 id="ansible-galaxy">Ansible Galaxy<a class="header-link" href="#ansible-galaxy" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><span class="c1"># Role ê²€ìƒ‰</span>
ansible-galaxy<span class="w"> </span>search<span class="w"> </span>nginx

<span class="c1"># Role ì„¤ì¹˜</span>
ansible-galaxy<span class="w"> </span>install<span class="w"> </span>geerlingguy.nginx

<span class="c1"># ì»¬ë ‰ì…˜ ì„¤ì¹˜</span>
ansible-galaxy<span class="w"> </span>collection<span class="w"> </span>install<span class="w"> </span>community.general

<span class="c1"># requirements.ymlë¡œ ì„¤ì¹˜</span>
ansible-galaxy<span class="w"> </span>install<span class="w"> </span>-r<span class="w"> </span>requirements.yml
</code></pre></div>

<div class="highlight"><pre><span></span><code><span class="c1"># requirements.yml</span>
<span class="nn">---</span>
<span class="nt">roles</span><span class="p">:</span>
<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">geerlingguy.nginx</span>
<span class="w">    </span><span class="nt">version</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;3.1.0&quot;</span>
<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">geerlingguy.postgresql</span>
<span class="w">    </span><span class="nt">version</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;3.3.1&quot;</span>

<span class="nt">collections</span><span class="p">:</span>
<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">community.general</span>
<span class="w">    </span><span class="nt">version</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;&gt;=6.0.0&quot;</span>
<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">amazon.aws</span>
<span class="w">    </span><span class="nt">version</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;5.0.0&quot;</span>
</code></pre></div>

<hr />
<h2 id="8-ansible-vault">8. Ansible Vault<a class="header-link" href="#8-ansible-vault" title="Permanent link">&para;</a></h2>
<h3 id="vault">Vault ê¸°ë³¸ ì‚¬ìš©<a class="header-link" href="#vault" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><span class="c1"># ìƒˆ ì•”í˜¸í™” íŒŒì¼ ìƒì„±</span>
ansible-vault<span class="w"> </span>create<span class="w"> </span>secrets.yml

<span class="c1"># ê¸°ì¡´ íŒŒì¼ ì•”í˜¸í™”</span>
ansible-vault<span class="w"> </span>encrypt<span class="w"> </span>vars/secrets.yml

<span class="c1"># íŒŒì¼ ë³µí˜¸í™”</span>
ansible-vault<span class="w"> </span>decrypt<span class="w"> </span>vars/secrets.yml

<span class="c1"># íŒŒì¼ í¸ì§‘</span>
ansible-vault<span class="w"> </span>edit<span class="w"> </span>secrets.yml

<span class="c1"># íŒŒì¼ ë‚´ìš© ë³´ê¸°</span>
ansible-vault<span class="w"> </span>view<span class="w"> </span>secrets.yml

<span class="c1"># ë¹„ë°€ë²ˆí˜¸ ë³€ê²½</span>
ansible-vault<span class="w"> </span>rekey<span class="w"> </span>secrets.yml
</code></pre></div>

<h3 id="vault_1">Vault ì‚¬ìš© ì˜ˆì‹œ<a class="header-link" href="#vault_1" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><span class="c1"># vars/secrets.yml (ì•”í˜¸í™”ë¨)</span>
<span class="nn">---</span>
<span class="nt">db_password</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;SuperSecretPassword123&quot;</span>
<span class="nt">api_key</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;sk-1234567890abcdef&quot;</span>
</code></pre></div>

<div class="highlight"><pre><span></span><code><span class="c1"># playbook.yml</span>
<span class="nn">---</span>
<span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Deploy application</span>
<span class="w">  </span><span class="nt">hosts</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">webservers</span>
<span class="w">  </span><span class="nt">vars_files</span><span class="p">:</span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">vars/secrets.yml</span>

<span class="w">  </span><span class="nt">tasks</span><span class="p">:</span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Configure database</span>
<span class="w">      </span><span class="nt">template</span><span class="p">:</span>
<span class="w">        </span><span class="nt">src</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">db.conf.j2</span>
<span class="w">        </span><span class="nt">dest</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">/etc/app/db.conf</span>
<span class="w">      </span><span class="c1"># {{ db_password }} ì‚¬ìš© ê°€ëŠ¥</span>
</code></pre></div>

<h3 id="playbook_2">Playbook ì‹¤í–‰<a class="header-link" href="#playbook_2" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><span class="c1"># ë¹„ë°€ë²ˆí˜¸ í”„ë¡¬í”„íŠ¸</span>
ansible-playbook<span class="w"> </span>site.yml<span class="w"> </span>--ask-vault-pass

<span class="c1"># ë¹„ë°€ë²ˆí˜¸ íŒŒì¼ ì‚¬ìš©</span>
ansible-playbook<span class="w"> </span>site.yml<span class="w"> </span>--vault-password-file<span class="w"> </span>~/.vault_pass

<span class="c1"># í™˜ê²½ ë³€ìˆ˜</span>
<span class="nb">export</span><span class="w"> </span><span class="nv">ANSIBLE_VAULT_PASSWORD_FILE</span><span class="o">=</span>~/.vault_pass
ansible-playbook<span class="w"> </span>site.yml
</code></pre></div>

<h3 id="_12">ë¬¸ìì—´ ì•”í˜¸í™”<a class="header-link" href="#_12" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><span class="c1"># ë¬¸ìì—´ë§Œ ì•”í˜¸í™”</span>
ansible-vault<span class="w"> </span>encrypt_string<span class="w"> </span><span class="s1">&#39;MySecretPassword&#39;</span><span class="w"> </span>--name<span class="w"> </span><span class="s1">&#39;db_password&#39;</span>

<span class="c1"># ì¶œë ¥ (YAMLì— ì§ì ‘ ì‚¬ìš©)</span>
db_password:<span class="w"> </span>!vault<span class="w"> </span><span class="p">|</span>
<span class="w">          </span><span class="nv">$ANSIBLE_VAULT</span><span class="p">;</span><span class="m">1</span>.1<span class="p">;</span>AES256
<span class="w">          </span><span class="m">66386439653236</span>...
</code></pre></div>

<hr />
<h2 id="_13">ì—°ìŠµ ë¬¸ì œ<a class="header-link" href="#_13" title="Permanent link">&para;</a></h2>
<h3 id="1">ë¬¸ì œ 1: ì¸ë²¤í† ë¦¬ ì‘ì„±<a class="header-link" href="#1" title="Permanent link">&para;</a></h3>
<p>ë‹¤ìŒ ì„œë²„ë“¤ì˜ ì¸ë²¤í† ë¦¬ë¥¼ YAML í˜•ì‹ìœ¼ë¡œ ì‘ì„±í•˜ì„¸ìš”:
- app1, app2 (webservers ê·¸ë£¹)
- db1 (dbservers ê·¸ë£¹)
- ëª¨ë“  ì„œë²„: ansible_user=deploy
- webservers: http_port=8080</p>
<h3 id="2-playbook">ë¬¸ì œ 2: Playbook ì‘ì„±<a class="header-link" href="#2-playbook" title="Permanent link">&para;</a></h3>
<p>nginxë¥¼ ì„¤ì¹˜í•˜ê³  ì‹œì‘í•˜ëŠ” Playbookì„ ì‘ì„±í•˜ì„¸ìš”:
- RedHatê³¼ Debian ê³„ì—´ ëª¨ë‘ ì§€ì›
- í•¸ë“¤ëŸ¬ë¡œ ì„œë¹„ìŠ¤ ì¬ì‹œì‘
- íƒœê·¸ ì‚¬ìš© (install, configure)</p>
<h3 id="3-role">ë¬¸ì œ 3: Role ì‘ì„±<a class="header-link" href="#3-role" title="Permanent link">&para;</a></h3>
<p>PostgreSQLì„ ì„¤ì¹˜í•˜ëŠ” Roleì˜ tasks/main.ymlì„ ì‘ì„±í•˜ì„¸ìš”:
- íŒ¨í‚¤ì§€ ì„¤ì¹˜
- ì„œë¹„ìŠ¤ ì‹œì‘
- ì´ˆê¸° ë°ì´í„°ë² ì´ìŠ¤ ìƒì„±</p>
<hr />
<h2 id="_14">ì •ë‹µ<a class="header-link" href="#_14" title="Permanent link">&para;</a></h2>
<h3 id="1_1">ë¬¸ì œ 1 ì •ë‹µ<a class="header-link" href="#1_1" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><span class="c1"># inventory/hosts.yml</span>
<span class="nt">all</span><span class="p">:</span>
<span class="w">  </span><span class="nt">vars</span><span class="p">:</span>
<span class="w">    </span><span class="nt">ansible_user</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">deploy</span>
<span class="w">  </span><span class="nt">children</span><span class="p">:</span>
<span class="w">    </span><span class="nt">webservers</span><span class="p">:</span>
<span class="w">      </span><span class="nt">hosts</span><span class="p">:</span>
<span class="w">        </span><span class="nt">app1</span><span class="p">:</span>
<span class="w">        </span><span class="nt">app2</span><span class="p">:</span>
<span class="w">      </span><span class="nt">vars</span><span class="p">:</span>
<span class="w">        </span><span class="nt">http_port</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">8080</span>
<span class="w">    </span><span class="nt">dbservers</span><span class="p">:</span>
<span class="w">      </span><span class="nt">hosts</span><span class="p">:</span>
<span class="w">        </span><span class="nt">db1</span><span class="p">:</span>
</code></pre></div>

<h3 id="2_1">ë¬¸ì œ 2 ì •ë‹µ<a class="header-link" href="#2_1" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><span class="nn">---</span>
<span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Install and configure nginx</span>
<span class="w">  </span><span class="nt">hosts</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">webservers</span>
<span class="w">  </span><span class="nt">become</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">yes</span>

<span class="w">  </span><span class="nt">tasks</span><span class="p">:</span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Install nginx (RedHat)</span>
<span class="w">      </span><span class="nt">yum</span><span class="p">:</span>
<span class="w">        </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">nginx</span>
<span class="w">        </span><span class="nt">state</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">present</span>
<span class="w">      </span><span class="nt">when</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">ansible_os_family == &quot;RedHat&quot;</span>
<span class="w">      </span><span class="nt">tags</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">install</span>

<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Install nginx (Debian)</span>
<span class="w">      </span><span class="nt">apt</span><span class="p">:</span>
<span class="w">        </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">nginx</span>
<span class="w">        </span><span class="nt">state</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">present</span>
<span class="w">        </span><span class="nt">update_cache</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">yes</span>
<span class="w">      </span><span class="nt">when</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">ansible_os_family == &quot;Debian&quot;</span>
<span class="w">      </span><span class="nt">tags</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">install</span>

<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Copy nginx config</span>
<span class="w">      </span><span class="nt">template</span><span class="p">:</span>
<span class="w">        </span><span class="nt">src</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">nginx.conf.j2</span>
<span class="w">        </span><span class="nt">dest</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">/etc/nginx/nginx.conf</span>
<span class="w">      </span><span class="nt">notify</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Restart nginx</span>
<span class="w">      </span><span class="nt">tags</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">configure</span>

<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Start nginx</span>
<span class="w">      </span><span class="nt">service</span><span class="p">:</span>
<span class="w">        </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">nginx</span>
<span class="w">        </span><span class="nt">state</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">started</span>
<span class="w">        </span><span class="nt">enabled</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">yes</span>
<span class="w">      </span><span class="nt">tags</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">install</span>

<span class="w">  </span><span class="nt">handlers</span><span class="p">:</span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Restart nginx</span>
<span class="w">      </span><span class="nt">service</span><span class="p">:</span>
<span class="w">        </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">nginx</span>
<span class="w">        </span><span class="nt">state</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">restarted</span>
</code></pre></div>

<h3 id="3_1">ë¬¸ì œ 3 ì •ë‹µ<a class="header-link" href="#3_1" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><span class="c1"># roles/postgresql/tasks/main.yml</span>
<span class="nn">---</span>
<span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Install PostgreSQL</span>
<span class="w">  </span><span class="nt">apt</span><span class="p">:</span>
<span class="w">    </span><span class="nt">name</span><span class="p">:</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">postgresql</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">postgresql-contrib</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">python3-psycopg2</span>
<span class="w">    </span><span class="nt">state</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">present</span>
<span class="w">    </span><span class="nt">update_cache</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">yes</span>

<span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Start PostgreSQL service</span>
<span class="w">  </span><span class="nt">service</span><span class="p">:</span>
<span class="w">    </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">postgresql</span>
<span class="w">    </span><span class="nt">state</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">started</span>
<span class="w">    </span><span class="nt">enabled</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">yes</span>

<span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Create application database</span>
<span class="w">  </span><span class="nt">become_user</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">postgres</span>
<span class="w">  </span><span class="nt">postgresql_db</span><span class="p">:</span>
<span class="w">    </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;{{</span><span class="nv"> </span><span class="s">pg_database</span><span class="nv"> </span><span class="s">|</span><span class="nv"> </span><span class="s">default(&#39;appdb&#39;)</span><span class="nv"> </span><span class="s">}}&quot;</span>
<span class="w">    </span><span class="nt">state</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">present</span>

<span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Create database user</span>
<span class="w">  </span><span class="nt">become_user</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">postgres</span>
<span class="w">  </span><span class="nt">postgresql_user</span><span class="p">:</span>
<span class="w">    </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;{{</span><span class="nv"> </span><span class="s">pg_user</span><span class="nv"> </span><span class="s">|</span><span class="nv"> </span><span class="s">default(&#39;appuser&#39;)</span><span class="nv"> </span><span class="s">}}&quot;</span>
<span class="w">    </span><span class="nt">password</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;{{</span><span class="nv"> </span><span class="s">pg_password</span><span class="nv"> </span><span class="s">}}&quot;</span>
<span class="w">    </span><span class="nt">db</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;{{</span><span class="nv"> </span><span class="s">pg_database</span><span class="nv"> </span><span class="s">|</span><span class="nv"> </span><span class="s">default(&#39;appdb&#39;)</span><span class="nv"> </span><span class="s">}}&quot;</span>
<span class="w">    </span><span class="nt">priv</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">ALL</span>
<span class="w">    </span><span class="nt">state</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">present</span>
</code></pre></div>

<hr />
<h2 id="_15">ë‹¤ìŒ ë‹¨ê³„<a class="header-link" href="#_15" title="Permanent link">&para;</a></h2>
<ul>
<li><a href="./23_Advanced_Networking.md">23_Advanced_Networking.md</a> - VLAN, bonding, iptables/nftables</li>
</ul>
<hr />
<h2 id="_16">ì°¸ê³  ìë£Œ<a class="header-link" href="#_16" title="Permanent link">&para;</a></h2>
<ul>
<li><a href="https://docs.ansible.com/">Ansible Documentation</a></li>
<li><a href="https://galaxy.ansible.com/">Ansible Galaxy</a></li>
<li><a href="https://docs.ansible.com/ansible/latest/tips_tricks/ansible_tips_tricks.html">Ansible Best Practices</a></li>
<li><code>ansible-doc -l</code>, <code>ansible-doc &lt;module&gt;</code></li>
</ul>
    </div>

    
<div class="lesson-toolbar lesson-toolbar--bottom">
    <div class="toolbar-nav toolbar-nav--prev">
        
        <a href="/study/ko/Linux/21_Virtualization_KVM.html" class="nav-prev">
            <span class="nav-label">Previous</span>
            <span class="nav-title">ê°€ìƒí™” (KVM)</span>
        </a>
        
    </div>
    <div class="toolbar-actions">
        <button class="btn btn-copy-link" data-action="copy-link" title="Copy link">
            <span class="icon">ğŸ”—</span>
            <span class="text">Copy link</span>
        </button>
        <a href="/study/ko/Linux/" class="btn btn-topic-link" title="Back to topic list">
            <span class="icon">ğŸ“‹</span>
            <span class="text">Topic list</span>
        </a>
    </div>
    <div class="toolbar-nav toolbar-nav--next">
        
        <a href="/study/ko/Linux/23_Advanced_Networking.html" class="nav-next">
            <span class="nav-label">Next</span>
            <span class="nav-title">ê³ ê¸‰ ë„¤íŠ¸ì›Œí‚¹</span>
        </a>
        
    </div>
</div>


    <div class="toolbar-keyboard-hint">
        <kbd>&larr;</kbd> <kbd>&rarr;</kbd> to navigate between lessons
    </div>
</article>

<!-- Scroll to top floating button -->
<button class="scroll-to-top" id="scroll-to-top" title="Scroll to top" aria-label="Scroll to top">â†‘</button>

            </div>
        </main>
    </div>

    <script src="/study/static/js/app.js"></script>
    <script>
        function switchLanguage(newLang) {
            const path = window.location.pathname;
            const base = '/study';
            const currentLang = 'ko';
            const newPath = path.replace(base + '/' + currentLang + '/', base + '/' + newLang + '/');
            window.location.href = newPath + window.location.search;
        }
    </script>
    
<script>
    document.addEventListener('DOMContentLoaded', function() {
        // Copy link - independent feedback per button
        document.querySelectorAll('[data-action="copy-link"]').forEach(function(btn) {
            btn.addEventListener('click', function() {
                navigator.clipboard.writeText(window.location.href);
                var textEl = this.querySelector('.text');
                var originalText = textEl.textContent;
                textEl.textContent = 'Copied!';
                setTimeout(function() { textEl.textContent = originalText; }, 2000);
            });
        });

        // Add copy buttons to code blocks
        document.querySelectorAll('.lesson-content pre').forEach(function(pre) {
            var copyBtn = document.createElement('button');
            copyBtn.className = 'code-copy-btn';
            copyBtn.textContent = 'Copy';
            copyBtn.addEventListener('click', function() {
                var code = pre.querySelector('code');
                var text = code ? code.textContent : pre.textContent;
                navigator.clipboard.writeText(text);
                copyBtn.textContent = 'Copied!';
                setTimeout(function() { copyBtn.textContent = 'Copy'; }, 2000);
            });
            pre.style.position = 'relative';
            pre.appendChild(copyBtn);
        });

        // Scroll to top button
        var scrollBtn = document.getElementById('scroll-to-top');
        window.addEventListener('scroll', function() {
            scrollBtn.classList.toggle('visible', window.scrollY > 300);
        });
        scrollBtn.addEventListener('click', function() {
            window.scrollTo({ top: 0, behavior: 'smooth' });
        });

        // Keyboard shortcuts: left/right arrows for lesson navigation
        document.addEventListener('keydown', function(e) {
            var tag = document.activeElement.tagName;
            if (tag === 'INPUT' || tag === 'TEXTAREA' || tag === 'SELECT') return;

            if (e.key === 'ArrowLeft') {
                var prevLink = document.querySelector('.nav-prev');
                if (prevLink) prevLink.click();
            } else if (e.key === 'ArrowRight') {
                var nextLink = document.querySelector('.nav-next');
                if (nextLink) nextLink.click();
            }
        });
    });
</script>

</body>
</html>
{% endraw %}