{% raw %}
<!DOCTYPE html>
<html lang="ko" data-theme="light">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>TCP 프로토콜 - Study Materials</title>
    <link rel="stylesheet" href="/study/static/css/style.css">
    <link rel="stylesheet" href="/study/static/css/highlight.css">
    <!-- KaTeX for LaTeX math rendering -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.16.11/dist/katex.min.css">
    <script defer src="https://cdn.jsdelivr.net/npm/katex@0.16.11/dist/katex.min.js"></script>
    <script defer src="https://cdn.jsdelivr.net/npm/katex@0.16.11/dist/contrib/auto-render.min.js"
        onload="renderMathInElement(document.body, {
            delimiters: [
                {left: '$$', right: '$$', display: true},
                {left: '$', right: '$', display: false}
            ],
            throwOnError: false
        });"></script>
    
</head>
<body>
    <div class="app-container">
        <!-- Sidebar -->
        <aside class="sidebar" id="sidebar">
            <div class="sidebar-header">
                <a href="/study/ko/" class="logo">Study Materials</a>
                <button class="sidebar-toggle" id="sidebar-toggle" aria-label="Toggle sidebar">
                    <span></span>
                </button>
            </div>

            <nav class="sidebar-nav">
                <a href="/study/ko/" class="nav-item ">
                    <span class="nav-icon">🏠</span>
                    <span class="nav-text">Home</span>
                </a>
                <a href="/study/examples/" class="nav-item ">
                    <span class="nav-icon">💻</span>
                    <span class="nav-text">Examples</span>
                </a>
            </nav>

            <div class="sidebar-search">
                <form action="/study/ko/search.html" method="get" id="search-form">
                    <input type="search" name="q" placeholder="Search..." id="search-sidebar-input">
                </form>
            </div>

            <!-- Language Selector -->
            <div class="sidebar-lang">
                <select id="lang-select" class="lang-selector" onchange="switchLanguage(this.value)">
                    
                    <option value="en" >
                        English
                    </option>
                    
                    <option value="ko" selected>
                        한국어
                    </option>
                    
                </select>
            </div>

            <div class="sidebar-footer">
                <button class="theme-toggle" id="theme-toggle" aria-label="Toggle theme">
                    <span class="theme-icon light">☀️</span>
                    <span class="theme-icon dark">🌙</span>
                </button>
            </div>
        </aside>

        <!-- Main Content -->
        <main class="main-content">
            <header class="main-header">
                <button class="menu-toggle" id="menu-toggle" aria-label="Open menu">
                    <span></span>
                </button>
                
<nav class="breadcrumb">
    <a href="/study/ko/">Topics</a>
    <span class="separator">/</span>
    <a href="/study/ko/Networking/">Networking</a>
    <span class="separator">/</span>
    <span class="current">TCP 프로토콜</span>
</nav>

            </header>

            <div class="content">
                
<article class="lesson-article">
    <header class="lesson-header">
        <h1>TCP 프로토콜</h1>
    </header>

    
<div class="lesson-toolbar lesson-toolbar--top">
    <div class="toolbar-nav toolbar-nav--prev">
        
        <a href="/study/ko/Networking/09_Routing_Protocols.html" class="nav-prev">
            <span class="nav-label">Previous</span>
            <span class="nav-title">라우팅 프로토콜</span>
        </a>
        
    </div>
    <div class="toolbar-actions">
        <button class="btn btn-copy-link" data-action="copy-link" title="Copy link">
            <span class="icon">🔗</span>
            <span class="text">Copy link</span>
        </button>
        <a href="/study/ko/Networking/" class="btn btn-topic-link" title="Back to topic list">
            <span class="icon">📋</span>
            <span class="text">Topic list</span>
        </a>
    </div>
    <div class="toolbar-nav toolbar-nav--next">
        
        <a href="/study/ko/Networking/11_UDP_and_Ports.html" class="nav-next">
            <span class="nav-label">Next</span>
            <span class="nav-title">UDP와 포트</span>
        </a>
        
    </div>
</div>


    
    <nav class="toc" id="toc">
        <h2>Table of Contents</h2>
        <div class="toc">
<ul>
<li><a href="#_1">개요</a></li>
<li><a href="#_2">목차</a></li>
<li><a href="#1-tcp">1. TCP의 특징</a><ul>
<li><a href="#11-tcp">1.1 TCP 기본 특성</a></li>
<li><a href="#12-tcp-vs-udp">1.2 TCP vs UDP 간단 비교</a></li>
<li><a href="#13-tcp">1.3 TCP 세그먼트</a></li>
</ul>
</li>
<li><a href="#2-tcp">2. TCP 헤더 구조</a><ul>
<li><a href="#21-tcp">2.1 TCP 헤더 형식</a></li>
<li><a href="#22">2.2 헤더 필드 설명</a></li>
<li><a href="#23-tcp">2.3 TCP 플래그</a></li>
<li><a href="#24-tcp">2.4 주요 TCP 옵션</a></li>
</ul>
</li>
<li><a href="#3-3-way-handshake">3. 3-Way Handshake</a><ul>
<li><a href="#31">3.1 연결 설정 과정</a></li>
<li><a href="#32">3.2 각 단계 상세</a></li>
<li><a href="#33-isn-initial-sequence-number">3.3 ISN (Initial Sequence Number)</a></li>
<li><a href="#34-tcp">3.4 TCP 상태 전이 (연결 설정)</a></li>
</ul>
</li>
<li><a href="#4-4-way-handshake">4. 4-Way Handshake</a><ul>
<li><a href="#41">4.1 연결 종료 과정</a></li>
<li><a href="#42">4.2 각 단계 상세</a></li>
<li><a href="#43-half-close">4.3 Half-Close</a></li>
<li><a href="#44-time_wait">4.4 TIME_WAIT 상태</a></li>
<li><a href="#45-tcp">4.5 TCP 상태 다이어그램</a></li>
</ul>
</li>
<li><a href="#5-ack">5. 시퀀스 번호와 ACK</a><ul>
<li><a href="#51">5.1 시퀀스 번호의 역할</a></li>
<li><a href="#52-cumulative-ack">5.2 누적 확인 응답 (Cumulative ACK)</a></li>
<li><a href="#53-sack-selective-acknowledgment">5.3 SACK (Selective Acknowledgment)</a></li>
<li><a href="#54-rto">5.4 재전송 타이머 (RTO)</a></li>
</ul>
</li>
<li><a href="#6">6. 흐름 제어</a><ul>
<li><a href="#61">6.1 슬라이딩 윈도우</a></li>
<li><a href="#62">6.2 윈도우 크기 조절</a></li>
<li><a href="#63-window-scale">6.3 Window Scale 옵션</a></li>
<li><a href="#64-silly-window-syndrome">6.4 Silly Window Syndrome 방지</a></li>
</ul>
</li>
<li><a href="#7">7. 혼잡 제어</a><ul>
<li><a href="#71">7.1 혼잡 제어 개요</a></li>
<li><a href="#72-slow-start">7.2 Slow Start</a></li>
<li><a href="#73-congestion-avoidance">7.3 Congestion Avoidance</a></li>
<li><a href="#74">7.4 혼잡 감지와 대응</a></li>
<li><a href="#75-fast-retransmit-fast-recovery">7.5 Fast Retransmit과 Fast Recovery</a></li>
<li><a href="#76">7.6 현대 혼잡 제어 알고리즘</a></li>
</ul>
</li>
<li><a href="#8">8. 연습 문제</a><ul>
<li><a href="#1-3-way-handshake">문제 1: 3-Way Handshake 분석</a></li>
<li><a href="#2">문제 2: 시퀀스 번호 계산</a></li>
<li><a href="#3">문제 3: 흐름 제어</a></li>
<li><a href="#4">문제 4: 혼잡 제어</a></li>
</ul>
</li>
<li><a href="#_3">정답</a><ul>
<li><a href="#1">문제 1 정답</a></li>
<li><a href="#2_1">문제 2 정답</a></li>
<li><a href="#3_1">문제 3 정답</a></li>
<li><a href="#4_1">문제 4 정답</a></li>
</ul>
</li>
<li><a href="#9">9. 다음 단계</a><ul>
<li><a href="#_4">다음 레슨</a></li>
<li><a href="#_5">관련 레슨</a></li>
<li><a href="#_6">추천 실습</a></li>
</ul>
</li>
<li><a href="#10">10. 참고 자료</a><ul>
<li><a href="#rfc">RFC 문서</a></li>
<li><a href="#_7">명령어 참고</a></li>
<li><a href="#_8">학습 자료</a></li>
</ul>
</li>
</ul>
</div>

    </nav>
    

    <div class="lesson-content markdown-body">
        <h1 id="tcp">TCP 프로토콜<a class="header-link" href="#tcp" title="Permanent link">&para;</a></h1>
<h2 id="_1">개요<a class="header-link" href="#_1" title="Permanent link">&para;</a></h2>
<p>이 문서에서는 TCP(Transmission Control Protocol)의 핵심 개념을 다룹니다. 연결 지향적이고 신뢰성 있는 데이터 전송을 보장하는 TCP의 동작 원리, 헤더 구조, 흐름 제어, 혼잡 제어 메커니즘을 학습합니다.</p>
<p><strong>난이도</strong>: ⭐⭐⭐
<strong>예상 학습 시간</strong>: 3-4시간
<strong>선수 지식</strong>: <a href="./09_Routing_Protocols.md">09_Routing_Protocols.md</a></p>
<hr />
<h2 id="_2">목차<a class="header-link" href="#_2" title="Permanent link">&para;</a></h2>
<ol>
<li><a href="#1-tcp의-특징">TCP의 특징</a></li>
<li><a href="#2-tcp-헤더-구조">TCP 헤더 구조</a></li>
<li><a href="#3-3-way-handshake">3-Way Handshake</a></li>
<li><a href="#4-4-way-handshake">4-Way Handshake</a></li>
<li><a href="#5-시퀀스-번호와-ack">시퀀스 번호와 ACK</a></li>
<li><a href="#6-흐름-제어">흐름 제어</a></li>
<li><a href="#7-혼잡-제어">혼잡 제어</a></li>
<li><a href="#8-연습-문제">연습 문제</a></li>
<li><a href="#9-다음-단계">다음 단계</a></li>
<li><a href="#10-참고-자료">참고 자료</a></li>
</ol>
<hr />
<h2 id="1-tcp">1. TCP의 특징<a class="header-link" href="#1-tcp" title="Permanent link">&para;</a></h2>
<h3 id="11-tcp">1.1 TCP 기본 특성<a class="header-link" href="#11-tcp" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code>┌─────────────────────────────────────────────────────────────────┐
│                       TCP 특징                                   │
├─────────────────────────────────────────────────────────────────┤
│                                                                  │
│  1. 연결 지향 (Connection-Oriented)                             │
│     - 데이터 전송 전 연결 설정 필요 (3-way handshake)           │
│     - 전송 완료 후 연결 해제 (4-way handshake)                  │
│                                                                  │
│  2. 신뢰성 (Reliability)                                        │
│     - 데이터 전달 보장                                          │
│     - 순서 보장                                                 │
│     - 오류 감지 및 재전송                                       │
│                                                                  │
│  3. 흐름 제어 (Flow Control)                                    │
│     - 수신자의 처리 속도에 맞춰 전송                            │
│     - 슬라이딩 윈도우 사용                                      │
│                                                                  │
│  4. 혼잡 제어 (Congestion Control)                              │
│     - 네트워크 혼잡 상황 대응                                   │
│     - Slow Start, Congestion Avoidance 등                       │
│                                                                  │
│  5. 전이중 통신 (Full-Duplex)                                   │
│     - 양방향 동시 데이터 전송 가능                              │
│                                                                  │
└─────────────────────────────────────────────────────────────────┘
</code></pre></div>

<h3 id="12-tcp-vs-udp">1.2 TCP vs UDP 간단 비교<a class="header-link" href="#12-tcp-vs-udp" title="Permanent link">&para;</a></h3>
<table>
<thead>
<tr>
<th>특성</th>
<th>TCP</th>
<th>UDP</th>
</tr>
</thead>
<tbody>
<tr>
<td>연결</td>
<td>연결 지향</td>
<td>비연결</td>
</tr>
<tr>
<td>신뢰성</td>
<td>신뢰성 보장</td>
<td>비신뢰성</td>
</tr>
<tr>
<td>순서</td>
<td>순서 보장</td>
<td>순서 미보장</td>
</tr>
<tr>
<td>속도</td>
<td>상대적 느림</td>
<td>빠름</td>
</tr>
<tr>
<td>헤더 크기</td>
<td>20-60 바이트</td>
<td>8 바이트</td>
</tr>
<tr>
<td>용도</td>
<td>웹, 이메일, 파일 전송</td>
<td>스트리밍, DNS, 게임</td>
</tr>
</tbody>
</table>
<h3 id="13-tcp">1.3 TCP 세그먼트<a class="header-link" href="#13-tcp" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code>TCP 데이터 캡슐화

┌─────────────────────────────────────────────────────────────────┐
│ Application Layer                                               │
│ ┌─────────────────────────────────────────────────────────────┐ │
│ │                         Data                                 │ │
│ └─────────────────────────────────────────────────────────────┘ │
└────────────────────────────────────────────────────────────────┘
                              │
                              ▼
┌─────────────────────────────────────────────────────────────────┐
│ Transport Layer (TCP)                                           │
│ ┌──────────────┬──────────────────────────────────────────────┐ │
│ │  TCP Header  │                    Data                       │ │
│ │   (20-60B)   │                (Segment)                      │ │
│ └──────────────┴──────────────────────────────────────────────┘ │
│                      TCP Segment                                │
└─────────────────────────────────────────────────────────────────┘
                              │
                              ▼
┌─────────────────────────────────────────────────────────────────┐
│ Network Layer (IP)                                              │
│ ┌──────────────┬──────────────────────────────────────────────┐ │
│ │  IP Header   │              TCP Segment                      │ │
│ │   (20-60B)   │                                               │ │
│ └──────────────┴──────────────────────────────────────────────┘ │
│                       IP Packet                                 │
└─────────────────────────────────────────────────────────────────┘
</code></pre></div>

<hr />
<h2 id="2-tcp">2. TCP 헤더 구조<a class="header-link" href="#2-tcp" title="Permanent link">&para;</a></h2>
<h3 id="21-tcp">2.1 TCP 헤더 형식<a class="header-link" href="#21-tcp" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><span class="c"> 0                   1                   2                   3</span>
<span class="c"> 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1</span>
<span class="nb">+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+</span>
<span class="c">|          Source Port          |       Destination Port        |</span>
<span class="nb">+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+</span>
<span class="c">|                        Sequence Number                        |</span>
<span class="nb">+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+</span>
<span class="c">|                    Acknowledgment Number                      |</span>
<span class="nb">+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+</span>
<span class="c">|  Data |       |C|E|U|A|P|R|S|F|                               |</span>
<span class="c">| Offset| Rsrvd |W|C|R|C|S|S|Y|I|            Window             |</span>
<span class="c">|       |       |R|E|G|K|H|T|N|N|                               |</span>
<span class="nb">+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+</span>
<span class="c">|           Checksum            |         Urgent Pointer        |</span>
<span class="nb">+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+</span>
<span class="c">|                    Options (if any)                           |</span>
<span class="nb">+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+</span>
<span class="c">|                             Data                              |</span>
<span class="nb">+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+</span>
</code></pre></div>

<h3 id="22">2.2 헤더 필드 설명<a class="header-link" href="#22" title="Permanent link">&para;</a></h3>
<table>
<thead>
<tr>
<th>필드</th>
<th>크기</th>
<th>설명</th>
</tr>
</thead>
<tbody>
<tr>
<td>Source Port</td>
<td>16 bits</td>
<td>송신자 포트 번호 (0-65535)</td>
</tr>
<tr>
<td>Destination Port</td>
<td>16 bits</td>
<td>수신자 포트 번호 (0-65535)</td>
</tr>
<tr>
<td>Sequence Number</td>
<td>32 bits</td>
<td>세그먼트 데이터의 첫 번째 바이트 번호</td>
</tr>
<tr>
<td>Acknowledgment Number</td>
<td>32 bits</td>
<td>다음에 받을 것으로 기대하는 바이트 번호</td>
</tr>
<tr>
<td>Data Offset</td>
<td>4 bits</td>
<td>TCP 헤더 길이 (4바이트 단위)</td>
</tr>
<tr>
<td>Reserved</td>
<td>4 bits</td>
<td>예약 (0으로 설정)</td>
</tr>
<tr>
<td>Flags</td>
<td>8 bits</td>
<td>제어 플래그 (CWR, ECE, URG, ACK, PSH, RST, SYN, FIN)</td>
</tr>
<tr>
<td>Window</td>
<td>16 bits</td>
<td>수신 윈도우 크기 (흐름 제어)</td>
</tr>
<tr>
<td>Checksum</td>
<td>16 bits</td>
<td>오류 검출용 체크섬</td>
</tr>
<tr>
<td>Urgent Pointer</td>
<td>16 bits</td>
<td>긴급 데이터 위치 (URG 플래그 설정 시)</td>
</tr>
<tr>
<td>Options</td>
<td>0-40 bytes</td>
<td>추가 옵션 (MSS, Window Scale 등)</td>
</tr>
</tbody>
</table>
<h3 id="23-tcp">2.3 TCP 플래그<a class="header-link" href="#23-tcp" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code>┌─────────────────────────────────────────────────────────────────┐
│                       TCP 플래그                                 │
├─────────┬───────────────────────────────────────────────────────┤
│ CWR     │ Congestion Window Reduced - 혼잡 윈도우 축소 알림     │
│ ECE     │ ECN-Echo - 명시적 혼잡 알림                           │
│ URG     │ Urgent - 긴급 데이터 존재                             │
│ ACK     │ Acknowledgment - 확인 응답 유효                       │
│ PSH     │ Push - 버퍼링 없이 즉시 전달                          │
│ RST     │ Reset - 연결 강제 종료                                │
│ SYN     │ Synchronize - 연결 요청 (시퀀스 번호 동기화)          │
│ FIN     │ Finish - 연결 종료 요청                               │
└─────────┴───────────────────────────────────────────────────────┘
</code></pre></div>

<h3 id="24-tcp">2.4 주요 TCP 옵션<a class="header-link" href="#24-tcp" title="Permanent link">&para;</a></h3>
<table>
<thead>
<tr>
<th>옵션</th>
<th>Kind</th>
<th>설명</th>
</tr>
</thead>
<tbody>
<tr>
<td>MSS</td>
<td>2</td>
<td>Maximum Segment Size (일반적으로 1460 bytes)</td>
</tr>
<tr>
<td>Window Scale</td>
<td>3</td>
<td>윈도우 크기 확장 (최대 1GB까지)</td>
</tr>
<tr>
<td>SACK Permitted</td>
<td>4</td>
<td>Selective ACK 지원 여부</td>
</tr>
<tr>
<td>SACK</td>
<td>5</td>
<td>수신된 세그먼트 범위</td>
</tr>
<tr>
<td>Timestamps</td>
<td>8</td>
<td>RTT 측정 및 PAWS</td>
</tr>
<tr>
<td>NOP</td>
<td>1</td>
<td>패딩용 (No Operation)</td>
</tr>
</tbody>
</table>
<hr />
<h2 id="3-3-way-handshake">3. 3-Way Handshake<a class="header-link" href="#3-3-way-handshake" title="Permanent link">&para;</a></h2>
<h3 id="31">3.1 연결 설정 과정<a class="header-link" href="#31" title="Permanent link">&para;</a></h3>
<p>TCP 연결은 3-way handshake를 통해 설정됩니다.</p>
<div class="highlight"><pre><span></span><code>┌─────────────────────────────────────────────────────────────────┐
│                    3-Way Handshake                              │
├─────────────────────────────────────────────────────────────────┤
│                                                                  │
│     클라이언트                           서버                   │
│         │                                  │                    │
│         │  Step 1: SYN                     │                    │
│         │  ─────────────────────────────►  │                    │
│         │  SYN=1, Seq=100                  │                    │
│  CLOSED │                                  │ LISTEN             │
│    ↓    │                                  │    ↓               │
│ SYN_SENT│  Step 2: SYN-ACK                 │ SYN_RECEIVED       │
│         │  ◄─────────────────────────────  │                    │
│         │  SYN=1, ACK=1, Seq=300, Ack=101  │                    │
│    ↓    │                                  │                    │
│ ESTABLISHED Step 3: ACK                    │                    │
│         │  ─────────────────────────────►  │                    │
│         │  ACK=1, Seq=101, Ack=301         │                    │
│         │                                  │ ESTABLISHED        │
│         │                                  │                    │
│         │        연결 수립 완료            │                    │
│         │  ◄═════════════════════════════► │                    │
│         │         Data Transfer            │                    │
│                                                                  │
└─────────────────────────────────────────────────────────────────┘
</code></pre></div>

<h3 id="32">3.2 각 단계 상세<a class="header-link" href="#32" title="Permanent link">&para;</a></h3>
<p><strong>Step 1: SYN (Synchronize)</strong></p>
<div class="highlight"><pre><span></span><code>클라이언트 → 서버

TCP Header:
  Source Port: 50000 (임의)
  Destination Port: 80 (HTTP)
  Sequence Number: 100 (ISN - Initial Sequence Number)
  Acknowledgment: 0
  Flags: SYN=1
  Window: 65535
  Options: MSS=1460, Window Scale=7

의미: &quot;연결하고 싶습니다. 내 시퀀스 번호는 100부터 시작합니다.&quot;
</code></pre></div>

<p><strong>Step 2: SYN-ACK</strong></p>
<div class="highlight"><pre><span></span><code>서버 → 클라이언트

TCP Header:
  Source Port: 80
  Destination Port: 50000
  Sequence Number: 300 (서버의 ISN)
  Acknowledgment: 101 (클라이언트 Seq + 1)
  Flags: SYN=1, ACK=1
  Window: 65535
  Options: MSS=1460, Window Scale=7

의미: &quot;연결 요청을 받았습니다. 101번 바이트를 기다립니다.
       내 시퀀스 번호는 300부터 시작합니다.&quot;
</code></pre></div>

<p><strong>Step 3: ACK</strong></p>
<div class="highlight"><pre><span></span><code>클라이언트 → 서버

TCP Header:
  Source Port: 50000
  Destination Port: 80
  Sequence Number: 101
  Acknowledgment: 301 (서버 Seq + 1)
  Flags: ACK=1
  Window: 65535

의미: &quot;서버의 응답을 받았습니다. 301번 바이트를 기다립니다.
       이제 데이터를 주고받을 수 있습니다.&quot;
</code></pre></div>

<h3 id="33-isn-initial-sequence-number">3.3 ISN (Initial Sequence Number)<a class="header-link" href="#33-isn-initial-sequence-number" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code>ISN이 랜덤인 이유:

1. 보안
   <span class="k">-</span> 예측 가능한 ISN은 TCP 세션 하이재킹 취약
   <span class="k">-</span> 랜덤 ISN으로 공격 난이도 증가

2. 이전 연결과 구분
   <span class="k">-</span> 동일 소켓(IP:Port 쌍)의 이전 연결 패킷과 혼동 방지
   <span class="k">-</span> TIME_WAIT 상태와 연관

ISN 생성 예시:
  현대 운영체제: 안전한 난수 생성기(CSPRNG) 사용
  과거: 시간 기반 카운터 (4마이크로초마다 1 증가)
</code></pre></div>

<h3 id="34-tcp">3.4 TCP 상태 전이 (연결 설정)<a class="header-link" href="#34-tcp" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code>클라이언트 상태 전이:
CLOSED → SYN_SENT → ESTABLISHED

서버 상태 전이:
CLOSED → LISTEN → SYN_RECEIVED → ESTABLISHED
</code></pre></div>

<hr />
<h2 id="4-4-way-handshake">4. 4-Way Handshake<a class="header-link" href="#4-4-way-handshake" title="Permanent link">&para;</a></h2>
<h3 id="41">4.1 연결 종료 과정<a class="header-link" href="#41" title="Permanent link">&para;</a></h3>
<p>TCP 연결은 4-way handshake를 통해 정상적으로 종료됩니다.</p>
<div class="highlight"><pre><span></span><code>┌─────────────────────────────────────────────────────────────────┐
│                    4-Way Handshake                              │
├─────────────────────────────────────────────────────────────────┤
│                                                                  │
│   클라이언트 (능동적 종료)         서버 (수동적 종료)           │
│         │                                  │                    │
│ ESTABLISHED                          ESTABLISHED               │
│         │                                  │                    │
│         │  Step 1: FIN                     │                    │
│         │  ─────────────────────────────►  │                    │
│         │  FIN=1, Seq=100                  │                    │
│ FIN_WAIT_1                                 │                    │
│         │                                  │ CLOSE_WAIT         │
│         │  Step 2: ACK                     │                    │
│         │  ◄─────────────────────────────  │                    │
│         │  ACK=1, Ack=101                  │                    │
│ FIN_WAIT_2                                 │                    │
│         │                                  │ (남은 데이터 전송)  │
│         │                                  │                    │
│         │  Step 3: FIN                     │                    │
│         │  ◄─────────────────────────────  │                    │
│         │  FIN=1, Seq=300                  │ LAST_ACK           │
│ TIME_WAIT                                  │                    │
│         │  Step 4: ACK                     │                    │
│         │  ─────────────────────────────►  │                    │
│         │  ACK=1, Ack=301                  │                    │
│         │                                  │ CLOSED             │
│  (2MSL 대기)                               │                    │
│ CLOSED                                                          │
│                                                                  │
└─────────────────────────────────────────────────────────────────┘
</code></pre></div>

<h3 id="42">4.2 각 단계 상세<a class="header-link" href="#42" title="Permanent link">&para;</a></h3>
<table>
<thead>
<tr>
<th>단계</th>
<th>발신자</th>
<th>플래그</th>
<th>설명</th>
</tr>
</thead>
<tbody>
<tr>
<td>1</td>
<td>클라이언트</td>
<td>FIN</td>
<td>"보낼 데이터 없음. 연결 종료 요청"</td>
</tr>
<tr>
<td>2</td>
<td>서버</td>
<td>ACK</td>
<td>"FIN 수신 확인. 아직 보낼 데이터 있을 수 있음"</td>
</tr>
<tr>
<td>3</td>
<td>서버</td>
<td>FIN</td>
<td>"나도 보낼 데이터 없음. 연결 종료 동의"</td>
</tr>
<tr>
<td>4</td>
<td>클라이언트</td>
<td>ACK</td>
<td>"FIN 수신 확인. 연결 종료 완료"</td>
</tr>
</tbody>
</table>
<h3 id="43-half-close">4.3 Half-Close<a class="header-link" href="#43-half-close" title="Permanent link">&para;</a></h3>
<p>TCP는 half-close를 지원합니다. 한쪽에서 FIN을 보내도 다른 쪽은 계속 데이터를 보낼 수 있습니다.</p>
<div class="highlight"><pre><span></span><code>Half-Close 시나리오

클라이언트           서버
    │                  │
    │── FIN ─────────►│  클라이언트: &quot;더 보낼 데이터 없음&quot;
    │                  │
    │◄──── ACK ───────│  서버: &quot;알겠음&quot;
    │                  │
    │◄──── Data ──────│  서버: 남은 데이터 계속 전송
    │◄──── Data ──────│
    │                  │
    │── ACK ─────────►│
    │                  │
    │◄──── FIN ───────│  서버: &quot;나도 다 보냄&quot;
    │                  │
    │── ACK ─────────►│  연결 종료
    │                  │
</code></pre></div>

<h3 id="44-time_wait">4.4 TIME_WAIT 상태<a class="header-link" href="#44-time_wait" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code>TIME_WAIT의 목적:

1. 지연 패킷 처리
   <span class="k">-</span> 네트워크에 남아있는 이전 연결의 패킷 소멸 대기
   <span class="k">-</span> 새 연결에서 혼란 방지

2. 마지막 ACK 손실 대비
   <span class="k">-</span> 서버가 마지막 ACK를 못 받으면 FIN 재전송
   <span class="k">-</span> 클라이언트가 TIME_WAIT 상태면 재응답 가능

TIME_WAIT 지속 시간: 2 × MSL (Maximum Segment Lifetime)
  <span class="k">-</span> MSL: 일반적으로 30초 또는 2분
  <span class="k">-</span> TIME_WAIT: 1분 ~ 4분

┌─────────────────────────────────────────────────────────────────┐
│  TIME_WAIT 문제                                                 │
├─────────────────────────────────────────────────────────────────┤
│  - 대량의 단기 연결 시 포트 고갈 가능                          │
│  - 해결책:                                                      │
│    1. SO_REUSEADDR 소켓 옵션 사용                               │
│    2. tcp_tw_reuse 커널 파라미터 (Linux)                        │
│    3. 커넥션 풀링 사용                                          │
└─────────────────────────────────────────────────────────────────┘
</code></pre></div>

<h3 id="45-tcp">4.5 TCP 상태 다이어그램<a class="header-link" href="#45-tcp" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code>┌─────────────────────────────────────────────────────────────────┐
│                 TCP 상태 다이어그램 (간략)                       │
└─────────────────────────────────────────────────────────────────┘

                              CLOSED
                                │
              ┌─────────────────┼─────────────────┐
              │ 능동적 열기     │ 수동적 열기     │
              ▼                 ▼                 │
          SYN_SENT ──────► LISTEN                │
              │                 │                 │
              │  SYN 수신       │ SYN 수신        │
              ▼                 ▼                 │
          ◄──────────── SYN_RCVD ─────────►      │
                              │                   │
                    ACK 수신  │                   │
                              ▼                   │
                        ESTABLISHED               │
                              │                   │
              ┌───────────────┴───────────────┐   │
              │ 능동적 종료    수동적 종료    │   │
              ▼                               ▼   │
          FIN_WAIT_1                    CLOSE_WAIT │
              │                               │   │
              ▼                               ▼   │
          FIN_WAIT_2                     LAST_ACK │
              │                               │   │
              ▼                               │   │
          TIME_WAIT ─────────────────────────►│   │
              │                                   │
              └─── 2MSL ──────────────────────────┘
                              │
                              ▼
                           CLOSED
</code></pre></div>

<hr />
<h2 id="5-ack">5. 시퀀스 번호와 ACK<a class="header-link" href="#5-ack" title="Permanent link">&para;</a></h2>
<h3 id="51">5.1 시퀀스 번호의 역할<a class="header-link" href="#51" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code>시퀀스 번호 동작

클라이언트                               서버
    │                                      │
    │── Seq=1000, 1000 bytes ────────────►│
    │       (1000-1999)                    │
    │                                      │
    │◄─────────────────── ACK=2000 ───────│
    │   &quot;2000번 바이트부터 보내주세요&quot;     │
    │                                      │
    │── Seq=2000, 1000 bytes ────────────►│
    │       (2000-2999)                    │
    │                                      │
    │◄─────────────────── ACK=3000 ───────│
    │                                      │

시퀀스 번호 = 이 세그먼트의 첫 번째 데이터 바이트 번호
ACK 번호 = 다음에 받기를 기대하는 바이트 번호
</code></pre></div>

<h3 id="52-cumulative-ack">5.2 누적 확인 응답 (Cumulative ACK)<a class="header-link" href="#52-cumulative-ack" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code>누적 ACK 동작

송신자                                   수신자
    │                                      │
    │── Seq=1000, 500 bytes ─────────────►│
    │── Seq=1500, 500 bytes ─────────────►│
    │── Seq=2000, 500 bytes ─────────────►│
    │                                      │
    │◄────────────────────── ACK=2500 ────│
    │                                      │
    │  하나의 ACK로 3개 세그먼트 모두 확인 │
    │                                      │

장점:
- ACK 패킷 수 감소
- 네트워크 효율성 향상

단점:
- 중간 패킷 손실 시 이후 패킷도 재전송
  (SACK으로 해결)
</code></pre></div>

<h3 id="53-sack-selective-acknowledgment">5.3 SACK (Selective Acknowledgment)<a class="header-link" href="#53-sack-selective-acknowledgment" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code>SACK 동작

송신자                                   수신자
    │                                      │
    │── Seq=1000, 500B ─────────────────►│ ✓
    │── Seq=1500, 500B ────────────X     │ (손실)
    │── Seq=2000, 500B ─────────────────►│ ✓
    │── Seq=2500, 500B ─────────────────►│ ✓
    │                                      │
    │◄──── ACK=1500, SACK=2000-3000 ─────│
    │      &quot;1500 빠졌는데, 2000-3000은 받음&quot;
    │                                      │
    │── Seq=1500, 500B ─────────────────►│ (재전송)
    │                                      │
    │◄────────────────────── ACK=3000 ────│
    │                                      │

SACK 장점:
- 손실된 세그먼트만 선택적 재전송
- 불필요한 재전송 방지
- 고속 네트워크에서 효율적
</code></pre></div>

<h3 id="54-rto">5.4 재전송 타이머 (RTO)<a class="header-link" href="#54-rto" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code>RTO (Retransmission Timeout) 계산

1. RTT (Round Trip Time) 측정
   - 세그먼트 전송부터 ACK 수신까지 시간

2. SRTT (Smoothed RTT) 계산
   SRTT = (1 - α) × SRTT + α × RTT
   (α = 1/8, 일반적)

3. RTTVAR (RTT Variance) 계산
   RTTVAR = (1 - β) × RTTVAR + β × |SRTT - RTT|
   (β = 1/4, 일반적)

4. RTO 계산
   RTO = SRTT + max(G, 4 × RTTVAR)
   (G = 클럭 granularity)

예시:
  측정된 RTT: 100ms, 120ms, 90ms, 110ms
  SRTT ≈ 105ms
  RTTVAR ≈ 10ms
  RTO = 105 + 4 × 10 = 145ms
</code></pre></div>

<hr />
<h2 id="6">6. 흐름 제어<a class="header-link" href="#6" title="Permanent link">&para;</a></h2>
<h3 id="61">6.1 슬라이딩 윈도우<a class="header-link" href="#61" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code>슬라이딩 윈도우 개념

송신 버퍼:
┌───┬───┬───┬───┬───┬───┬───┬───┬───┬───┬───┬───┐
│ 1 │ 2 │ 3 │ 4 │ 5 │ 6 │ 7 │ 8 │ 9 │10 │11 │12 │
└───┴───┴───┴───┴───┴───┴───┴───┴───┴───┴───┴───┘
│ACK됨│    윈도우 (전송 가능)    │   아직 전송 불가   │
│     │◄────── Window=5 ───────►│                    │

수신 윈도우 크기에 따라 전송량 조절:

Window = 5000:
┌──────────────────────────────────────────────────┐
│     최대 5000 bytes까지 ACK 없이 전송 가능       │
└──────────────────────────────────────────────────┘

Window = 0 (Zero Window):
┌──────────────────────────────────────────────────┐
│     전송 중지! 수신자 버퍼 가득 참               │
│     Window Probe로 주기적 확인                    │
└──────────────────────────────────────────────────┘
</code></pre></div>

<h3 id="62">6.2 윈도우 크기 조절<a class="header-link" href="#62" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code>윈도우 크기 변화

송신자                               수신자
    │                                  │ rcvbuf=4000
    │── 1000B ────────────────────────►│ Window=3000
    │── 1000B ────────────────────────►│ Window=2000
    │── 1000B ────────────────────────►│ Window=1000
    │                                  │
    │◄─── ACK, Window=0 (버퍼 풀) ─────│
    │                                  │
    │     (애플리케이션이 데이터 읽음)  │
    │                                  │
    │◄─── ACK, Window=4000 ────────────│
    │                                  │
    │── 1000B ────────────────────────►│
    │── 1000B ────────────────────────►│
</code></pre></div>

<h3 id="63-window-scale">6.3 Window Scale 옵션<a class="header-link" href="#63-window-scale" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code>기본 윈도우 크기: 16비트 = 최대 65,535 bytes

고속 네트워크에서 부족:
  - 100Mbps, RTT 100ms → BDP = 100 × 0.1 / 8 = 1.25MB 필요
  - 1Gbps, RTT 100ms → BDP = 12.5MB 필요

Window Scale 옵션:
  - 3-way handshake에서 협상
  - 윈도우 값을 왼쪽으로 시프트
  - 최대 스케일: 14 (윈도우 최대 약 1GB)

예시:
  Window = 65535, Scale = 7
  실제 윈도우 = 65535 × 2^7 = 65535 × 128 = 8,388,480 bytes (약 8MB)
</code></pre></div>

<h3 id="64-silly-window-syndrome">6.4 Silly Window Syndrome 방지<a class="header-link" href="#64-silly-window-syndrome" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><span class="err">문제</span><span class="o">:</span><span class="w"> </span><span class="err">작은</span><span class="w"> </span><span class="err">세그먼트</span><span class="w"> </span><span class="err">다수</span><span class="w"> </span><span class="err">전송</span><span class="w"> </span><span class="o">(</span><span class="err">비효율적</span><span class="o">)</span>

<span class="err">송신측</span><span class="w"> </span><span class="err">해결</span><span class="o">:</span><span class="w"> </span><span class="n">Nagle</span><span class="w"> </span><span class="err">알고리즘</span>
<span class="err">┌─────────────────────────────────────────────────────────────────┐</span>
<span class="err">│</span><span class="w">  </span><span class="err">작은</span><span class="w"> </span><span class="err">데이터가</span><span class="w"> </span><span class="err">있을</span><span class="w"> </span><span class="err">때</span><span class="o">:</span><span class="w">                                         </span><span class="err">│</span>
<span class="err">│</span><span class="w">  </span><span class="mi">1</span><span class="o">.</span><span class="w"> </span><span class="err">미전송</span><span class="w"> </span><span class="err">데이터가</span><span class="w"> </span><span class="err">없으면</span><span class="w"> </span><span class="err">즉시</span><span class="w"> </span><span class="err">전송</span><span class="w">                            </span><span class="err">│</span>
<span class="err">│</span><span class="w">  </span><span class="mi">2</span><span class="o">.</span><span class="w"> </span><span class="err">미전송</span><span class="w"> </span><span class="err">데이터가</span><span class="w"> </span><span class="err">있으면</span><span class="w"> </span><span class="n">MSS만큼</span><span class="w"> </span><span class="err">모이거나</span><span class="w"> </span><span class="n">ACK</span><span class="w"> </span><span class="err">올</span><span class="w"> </span><span class="err">때까지</span><span class="w"> </span><span class="err">대기</span><span class="w">   </span><span class="err">│</span>
<span class="err">└─────────────────────────────────────────────────────────────────┘</span>

<span class="err">수신측</span><span class="w"> </span><span class="err">해결</span><span class="o">:</span><span class="w"> </span><span class="n">Delayed</span><span class="w"> </span><span class="n">ACK</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">Clark</span><span class="err">&#39;</span><span class="n">s</span><span class="w"> </span><span class="n">Solution</span>
<span class="err">┌─────────────────────────────────────────────────────────────────┐</span>
<span class="err">│</span><span class="w">  </span><span class="mi">1</span><span class="o">.</span><span class="w"> </span><span class="n">ACK를</span><span class="w"> </span><span class="err">즉시</span><span class="w"> </span><span class="err">보내지</span><span class="w"> </span><span class="err">않고</span><span class="w"> </span><span class="mi">200</span><span class="n">ms</span><span class="w"> </span><span class="err">대기</span><span class="w">                           </span><span class="err">│</span>
<span class="err">│</span><span class="w">  </span><span class="mi">2</span><span class="o">.</span><span class="w"> </span><span class="err">윈도우</span><span class="w"> </span><span class="err">업데이트는</span><span class="w"> </span><span class="n">MSS</span><span class="w"> </span><span class="err">이상</span><span class="w"> </span><span class="err">또는</span><span class="w"> </span><span class="err">버퍼의</span><span class="w"> </span><span class="mi">50</span><span class="o">%</span><span class="w"> </span><span class="err">이상일</span><span class="w"> </span><span class="err">때만</span><span class="w">      </span><span class="err">│</span>
<span class="err">└─────────────────────────────────────────────────────────────────┘</span>
</code></pre></div>

<hr />
<h2 id="7">7. 혼잡 제어<a class="header-link" href="#7" title="Permanent link">&para;</a></h2>
<h3 id="71">7.1 혼잡 제어 개요<a class="header-link" href="#71" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code>┌─────────────────────────────────────────────────────────────────┐
│                     TCP 혼잡 제어                                │
├─────────────────────────────────────────────────────────────────┤
│                                                                  │
│  목적: 네트워크 혼잡을 감지하고 전송률을 조절                   │
│                                                                  │
│  핵심 변수:                                                     │
│  - cwnd (Congestion Window): 송신자가 결정하는 윈도우           │
│  - rwnd (Receive Window): 수신자가 광고하는 윈도우              │
│  - 실제 전송 가능량 = min(cwnd, rwnd)                           │
│                                                                  │
│  ssthresh (Slow Start Threshold):                               │
│  - Slow Start와 Congestion Avoidance의 경계                     │
│  - 혼잡 발생 시 조정                                            │
│                                                                  │
└─────────────────────────────────────────────────────────────────┘
</code></pre></div>

<h3 id="72-slow-start">7.2 Slow Start<a class="header-link" href="#72-slow-start" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code>Slow Start 동작

                cwnd 변화
               │
       64 MSS  ┤                              <span class="gs">* (혼잡 발생)</span>
<span class="gs">               │                            *</span>
       32 MSS  ┤                          <span class="gs">*</span>
<span class="gs">               │                        *</span>
       16 MSS  ┤                      <span class="gs">*</span>
<span class="gs">               │                    *</span>
        8 MSS  ┤                  <span class="gs">*</span>
<span class="gs">               │                *</span>
        4 MSS  ┤              <span class="gs">*</span>
<span class="gs">               │            *</span>
        2 MSS  ┤          <span class="gs">*</span>
<span class="gs">               │        *</span>
        1 MSS  ┤      *
               │
               └──────────────────────────────────── RTT
                    1   2   3   4   5   6

규칙:
<span class="k">-</span> 초기 cwnd = 1 MSS (또는 IW=10 MSS, 최신 구현)
<span class="k">-</span> 각 ACK마다 cwnd += 1 MSS
<span class="k">-</span> 결과: RTT마다 cwnd 2배 증가 (지수적 증가)
<span class="k">-</span> ssthresh 도달 시 Congestion Avoidance로 전환
</code></pre></div>

<h3 id="73-congestion-avoidance">7.3 Congestion Avoidance<a class="header-link" href="#73-congestion-avoidance" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code>Congestion Avoidance 동작

                cwnd 변화
               │
               │  ssthresh                    <span class="gs">* (혼잡 발생)</span>
<span class="gs">        16 MSS ┼─────────────*</span>──────────*──*
               │           <span class="gs">*   *</span>       <span class="gs">*</span>
<span class="gs">               │         *</span>      <span class="gs">*    *</span>
               │       <span class="gs">*          *</span>
               │     <span class="gs">*       선형 증가 (AIMD)</span>
<span class="gs">               │   *</span>
               │ <span class="gs">*  Slow Start (지수)</span>
<span class="gs">               │*</span>
               │
               └──────────────────────────────────── RTT

규칙:
<span class="k">-</span> cwnd &gt;= ssthresh일 때 동작
<span class="k">-</span> 각 RTT마다 cwnd += 1 MSS (또는 cwnd += MSS/cwnd per ACK)
<span class="k">-</span> 선형 증가 (Additive Increase)
</code></pre></div>

<h3 id="74">7.4 혼잡 감지와 대응<a class="header-link" href="#74" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code>혼잡 감지 방법:

1. 타임아웃 (RTO 만료)
   - 심각한 혼잡으로 판단
   - ssthresh = cwnd / 2
   - cwnd = 1 MSS
   - Slow Start 재시작

2. 중복 ACK 3개 (Fast Retransmit)
   - 경미한 혼잡으로 판단
   - ssthresh = cwnd / 2
   - cwnd = ssthresh + 3 MSS
   - Fast Recovery 진입

┌─────────────────────────────────────────────────────────────────┐
│                     혼잡 제어 상태 전이                          │
│                                                                  │
│  Slow Start ──(cwnd &gt;= ssthresh)──► Congestion Avoidance        │
│      │                                        │                  │
│      │                                        │                  │
│   (timeout)                              (3 dup ACKs)            │
│      │                                        │                  │
│      ▼                                        ▼                  │
│  Slow Start ◄──────────────────────── Fast Recovery             │
│                    (recovery 완료)                               │
└─────────────────────────────────────────────────────────────────┘
</code></pre></div>

<h3 id="75-fast-retransmit-fast-recovery">7.5 Fast Retransmit과 Fast Recovery<a class="header-link" href="#75-fast-retransmit-fast-recovery" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code>Fast Retransmit 시나리오

송신자                               수신자
    │                                  │
    │── Seq=1000 ─────────────────────►│
    │── Seq=2000 ──────X              │ (손실)
    │── Seq=3000 ─────────────────────►│
    │                                  │
    │◄───────────────── ACK=2000 (dup1)│
    │                                  │
    │── Seq=4000 ─────────────────────►│
    │◄───────────────── ACK=2000 (dup2)│
    │                                  │
    │── Seq=5000 ─────────────────────►│
    │◄───────────────── ACK=2000 (dup3)│
    │                                  │
    │  3개의 중복 ACK 수신!            │
    │  → RTO 기다리지 않고 즉시 재전송 │
    │                                  │
    │── Seq=2000 (재전송) ────────────►│
    │                                  │
    │◄─────────────────────── ACK=6000 │

Fast Recovery:
- 3 dup ACKs 후 ssthresh = cwnd/2
- cwnd = ssthresh + 3 (이미 수신된 세그먼트 고려)
- 새 ACK 수신 시 cwnd = ssthresh
- Congestion Avoidance로 전환
</code></pre></div>

<h3 id="76">7.6 현대 혼잡 제어 알고리즘<a class="header-link" href="#76" title="Permanent link">&para;</a></h3>
<table>
<thead>
<tr>
<th>알고리즘</th>
<th>특징</th>
<th>사용 환경</th>
</tr>
</thead>
<tbody>
<tr>
<td>Reno</td>
<td>기본 AIMD, Fast Recovery</td>
<td>표준</td>
</tr>
<tr>
<td>NewReno</td>
<td>부분 ACK 개선</td>
<td>Reno 개선</td>
</tr>
<tr>
<td>CUBIC</td>
<td>BIC 개선, Linux 기본</td>
<td>고속 네트워크</td>
</tr>
<tr>
<td>BBR</td>
<td>대역폭/RTT 기반</td>
<td>Google, 고지연 네트워크</td>
</tr>
<tr>
<td>Vegas</td>
<td>RTT 변화 기반</td>
<td>저지연 환경</td>
</tr>
</tbody>
</table>
<div class="highlight"><pre><span></span><code>CUBIC cwnd 증가

cwnd
  │
  │                              <span class="gs">*</span>
<span class="gs">  │                           *</span>     <span class="gs">*</span>
<span class="gs">  │                        *</span>           <span class="gs">*</span>
<span class="gs">  │                     *</span>                 <span class="gs">*</span>
<span class="gs">  │                  *</span>                       <span class="gs">*</span>
<span class="gs">  │               *</span>                             <span class="gs">*</span>
<span class="gs">  │            *</span>          cubic 함수              <span class="gs">*</span>
<span class="gs">  │         *</span>                                        <span class="gs">*</span>
<span class="gs">  │      *</span>
  │   <span class="gs">*</span>
<span class="gs">  │ *</span>
  │*
  └──────────────────────────────────────────────────── time

특징:
<span class="k">-</span> W_max (마지막 혼잡 시 윈도우) 기억
<span class="k">-</span> W_max에 빠르게 접근 후 느리게 증가
<span class="k">-</span> 공정성과 확장성 우수
</code></pre></div>

<hr />
<h2 id="8">8. 연습 문제<a class="header-link" href="#8" title="Permanent link">&para;</a></h2>
<h3 id="1-3-way-handshake">문제 1: 3-Way Handshake 분석<a class="header-link" href="#1-3-way-handshake" title="Permanent link">&para;</a></h3>
<p>다음 패킷 캡처를 분석하세요.</p>
<div class="highlight"><pre><span></span><code>Packet 1: 192.168.1.10:50000 → 10.0.0.5:443
          SYN, Seq=1000000000

Packet 2: 10.0.0.5:443 → 192.168.1.10:50000
          SYN, ACK, Seq=2000000000, Ack=?

Packet 3: 192.168.1.10:50000 → 10.0.0.5:443
          ACK, Seq=?, Ack=?
</code></pre></div>

<p>a) Packet 2의 Ack 값은?
b) Packet 3의 Seq 값은?
c) Packet 3의 Ack 값은?</p>
<h3 id="2">문제 2: 시퀀스 번호 계산<a class="header-link" href="#2" title="Permanent link">&para;</a></h3>
<p>클라이언트가 서버에 5000 bytes 데이터를 전송합니다. MSS=1000 bytes입니다.</p>
<p>초기 시퀀스 번호가 10000일 때, 각 세그먼트의 Seq 번호와 예상 ACK를 계산하세요.</p>
<table>
<thead>
<tr>
<th>세그먼트</th>
<th>데이터 크기</th>
<th>Seq</th>
<th>예상 ACK</th>
</tr>
</thead>
<tbody>
<tr>
<td>1</td>
<td>1000</td>
<td></td>
<td></td>
</tr>
<tr>
<td>2</td>
<td>1000</td>
<td></td>
<td></td>
</tr>
<tr>
<td>3</td>
<td>1000</td>
<td></td>
<td></td>
</tr>
<tr>
<td>4</td>
<td>1000</td>
<td></td>
<td></td>
</tr>
<tr>
<td>5</td>
<td>1000</td>
<td></td>
<td></td>
</tr>
</tbody>
</table>
<h3 id="3">문제 3: 흐름 제어<a class="header-link" href="#3" title="Permanent link">&para;</a></h3>
<p>수신자의 receive buffer가 10000 bytes입니다. 현재 2000 bytes가 버퍼에 있습니다.</p>
<p>a) 광고 윈도우 크기는?
b) 송신자가 4000 bytes를 전송하면, 새로운 윈도우 크기는?
c) 애플리케이션이 3000 bytes를 읽으면, 새로운 윈도우 크기는?</p>
<h3 id="4">문제 4: 혼잡 제어<a class="header-link" href="#4" title="Permanent link">&para;</a></h3>
<p>ssthresh = 16 MSS, cwnd = 1 MSS로 시작합니다.</p>
<p>a) 4번의 RTT 후 cwnd 크기는? (손실 없음)
b) cwnd = 32 MSS일 때 타임아웃 발생. 새로운 ssthresh와 cwnd는?
c) cwnd = 24 MSS일 때 3개의 중복 ACK 발생. 새로운 ssthresh와 cwnd는?</p>
<hr />
<h2 id="_3">정답<a class="header-link" href="#_3" title="Permanent link">&para;</a></h2>
<h3 id="1">문제 1 정답<a class="header-link" href="#1" title="Permanent link">&para;</a></h3>
<p>a) Packet 2의 Ack = <strong>1000000001</strong> (클라이언트 Seq + 1)
b) Packet 3의 Seq = <strong>1000000001</strong> (SYN은 1바이트로 간주)
c) Packet 3의 Ack = <strong>2000000001</strong> (서버 Seq + 1)</p>
<h3 id="2_1">문제 2 정답<a class="header-link" href="#2_1" title="Permanent link">&para;</a></h3>
<table>
<thead>
<tr>
<th>세그먼트</th>
<th>데이터 크기</th>
<th>Seq</th>
<th>예상 ACK</th>
</tr>
</thead>
<tbody>
<tr>
<td>1</td>
<td>1000</td>
<td>10000</td>
<td>11000</td>
</tr>
<tr>
<td>2</td>
<td>1000</td>
<td>11000</td>
<td>12000</td>
</tr>
<tr>
<td>3</td>
<td>1000</td>
<td>12000</td>
<td>13000</td>
</tr>
<tr>
<td>4</td>
<td>1000</td>
<td>13000</td>
<td>14000</td>
</tr>
<tr>
<td>5</td>
<td>1000</td>
<td>14000</td>
<td>15000</td>
</tr>
</tbody>
</table>
<h3 id="3_1">문제 3 정답<a class="header-link" href="#3_1" title="Permanent link">&para;</a></h3>
<p>a) 광고 윈도우 = 10000 - 2000 = <strong>8000 bytes</strong>
b) 새 윈도우 = 10000 - 2000 - 4000 = <strong>4000 bytes</strong>
c) 새 윈도우 = 10000 - (2000 + 4000 - 3000) = <strong>7000 bytes</strong></p>
<h3 id="4_1">문제 4 정답<a class="header-link" href="#4_1" title="Permanent link">&para;</a></h3>
<p>a) Slow Start 단계 (cwnd &lt; ssthresh)
   - RTT 1: cwnd = 2 MSS
   - RTT 2: cwnd = 4 MSS
   - RTT 3: cwnd = 8 MSS
   - RTT 4: cwnd = <strong>16 MSS</strong></p>
<p>b) 타임아웃 발생:
   - 새 ssthresh = 32 / 2 = <strong>16 MSS</strong>
   - 새 cwnd = <strong>1 MSS</strong></p>
<p>c) 3 dup ACKs (Fast Retransmit):
   - 새 ssthresh = 24 / 2 = <strong>12 MSS</strong>
   - 새 cwnd = 12 + 3 = <strong>15 MSS</strong> (Fast Recovery)</p>
<hr />
<h2 id="9">9. 다음 단계<a class="header-link" href="#9" title="Permanent link">&para;</a></h2>
<p>TCP의 핵심 개념을 이해했다면, UDP와 포트에 대해 학습하세요.</p>
<h3 id="_4">다음 레슨<a class="header-link" href="#_4" title="Permanent link">&para;</a></h3>
<ul>
<li><a href="./11_UDP와_포트.md">11_UDP와_포트.md</a> - UDP 특징, 포트 번호</li>
</ul>
<h3 id="_5">관련 레슨<a class="header-link" href="#_5" title="Permanent link">&para;</a></h3>
<ul>
<li><a href="./09_Routing_Protocols.md">09_Routing_Protocols.md</a> - 네트워크 계층</li>
<li><a href="./12_DNS.md">12_DNS.md</a> - DNS 동작 원리</li>
</ul>
<h3 id="_6">추천 실습<a class="header-link" href="#_6" title="Permanent link">&para;</a></h3>
<ol>
<li>Wireshark로 TCP 3-way handshake 캡처</li>
<li><code>ss -i</code> 또는 <code>netstat -s</code>로 TCP 통계 확인</li>
<li><code>tcpdump</code>로 TCP 플래그 분석</li>
</ol>
<hr />
<h2 id="10">10. 참고 자료<a class="header-link" href="#10" title="Permanent link">&para;</a></h2>
<h3 id="rfc">RFC 문서<a class="header-link" href="#rfc" title="Permanent link">&para;</a></h3>
<ul>
<li>RFC 793 - TCP 기본 명세</li>
<li>RFC 5681 - TCP Congestion Control</li>
<li>RFC 7323 - TCP Extensions (Window Scaling, Timestamps)</li>
<li>RFC 2018 - TCP Selective Acknowledgment Options</li>
</ul>
<h3 id="_7">명령어 참고<a class="header-link" href="#_7" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><span class="c1"># TCP 연결 상태 확인 (Linux)</span>
ss<span class="w"> </span>-tan
netstat<span class="w"> </span>-an<span class="w"> </span><span class="p">|</span><span class="w"> </span>grep<span class="w"> </span>tcp

<span class="c1"># TCP 통계</span>
netstat<span class="w"> </span>-s<span class="w"> </span><span class="p">|</span><span class="w"> </span>grep<span class="w"> </span>-i<span class="w"> </span>tcp
cat<span class="w"> </span>/proc/net/snmp<span class="w"> </span><span class="p">|</span><span class="w"> </span>grep<span class="w"> </span>Tcp

<span class="c1"># TCP 튜닝 파라미터 확인</span>
sysctl<span class="w"> </span>net.ipv4.tcp_congestion_control
sysctl<span class="w"> </span>net.core.rmem_max
sysctl<span class="w"> </span>net.ipv4.tcp_window_scaling

<span class="c1"># Wireshark 필터</span>
tcp.flags.syn<span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="m">1</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span>tcp.flags.ack<span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="m">0</span><span class="w">  </span><span class="c1"># SYN 패킷</span>
tcp.analysis.retransmission<span class="w">               </span><span class="c1"># 재전송</span>
tcp.analysis.duplicate_ack<span class="w">                </span><span class="c1"># 중복 ACK</span>
</code></pre></div>

<h3 id="_8">학습 자료<a class="header-link" href="#_8" title="Permanent link">&para;</a></h3>
<ul>
<li><a href="https://www.amazon.com/TCP-Illustrated-Vol-Addison-Wesley-Professional/dp/0201633469">TCP/IP Illustrated, Vol. 1 - W. Richard Stevens</a></li>
<li><a href="https://hpbn.co/">High Performance Browser Networking</a></li>
<li><a href="https://blog.cloudflare.com/tag/tcp/">Cloudflare Blog - TCP</a></li>
</ul>
<hr />
<p><strong>문서 정보</strong>
- 최종 수정: 2024년
- 난이도: ⭐⭐⭐
- 예상 학습 시간: 3-4시간</p>
    </div>

    
<div class="lesson-toolbar lesson-toolbar--bottom">
    <div class="toolbar-nav toolbar-nav--prev">
        
        <a href="/study/ko/Networking/09_Routing_Protocols.html" class="nav-prev">
            <span class="nav-label">Previous</span>
            <span class="nav-title">라우팅 프로토콜</span>
        </a>
        
    </div>
    <div class="toolbar-actions">
        <button class="btn btn-copy-link" data-action="copy-link" title="Copy link">
            <span class="icon">🔗</span>
            <span class="text">Copy link</span>
        </button>
        <a href="/study/ko/Networking/" class="btn btn-topic-link" title="Back to topic list">
            <span class="icon">📋</span>
            <span class="text">Topic list</span>
        </a>
    </div>
    <div class="toolbar-nav toolbar-nav--next">
        
        <a href="/study/ko/Networking/11_UDP_and_Ports.html" class="nav-next">
            <span class="nav-label">Next</span>
            <span class="nav-title">UDP와 포트</span>
        </a>
        
    </div>
</div>


    <div class="toolbar-keyboard-hint">
        <kbd>&larr;</kbd> <kbd>&rarr;</kbd> to navigate between lessons
    </div>
</article>

<!-- Scroll to top floating button -->
<button class="scroll-to-top" id="scroll-to-top" title="Scroll to top" aria-label="Scroll to top">↑</button>

            </div>
        </main>
    </div>

    <script src="/study/static/js/app.js"></script>
    <script>
        function switchLanguage(newLang) {
            const path = window.location.pathname;
            const base = '/study';
            const currentLang = 'ko';
            const newPath = path.replace(base + '/' + currentLang + '/', base + '/' + newLang + '/');
            window.location.href = newPath + window.location.search;
        }
    </script>
    
<script>
    document.addEventListener('DOMContentLoaded', function() {
        // Copy link - independent feedback per button
        document.querySelectorAll('[data-action="copy-link"]').forEach(function(btn) {
            btn.addEventListener('click', function() {
                navigator.clipboard.writeText(window.location.href);
                var textEl = this.querySelector('.text');
                var originalText = textEl.textContent;
                textEl.textContent = 'Copied!';
                setTimeout(function() { textEl.textContent = originalText; }, 2000);
            });
        });

        // Add copy buttons to code blocks
        document.querySelectorAll('.lesson-content pre').forEach(function(pre) {
            var copyBtn = document.createElement('button');
            copyBtn.className = 'code-copy-btn';
            copyBtn.textContent = 'Copy';
            copyBtn.addEventListener('click', function() {
                var code = pre.querySelector('code');
                var text = code ? code.textContent : pre.textContent;
                navigator.clipboard.writeText(text);
                copyBtn.textContent = 'Copied!';
                setTimeout(function() { copyBtn.textContent = 'Copy'; }, 2000);
            });
            pre.style.position = 'relative';
            pre.appendChild(copyBtn);
        });

        // Scroll to top button
        var scrollBtn = document.getElementById('scroll-to-top');
        window.addEventListener('scroll', function() {
            scrollBtn.classList.toggle('visible', window.scrollY > 300);
        });
        scrollBtn.addEventListener('click', function() {
            window.scrollTo({ top: 0, behavior: 'smooth' });
        });

        // Keyboard shortcuts: left/right arrows for lesson navigation
        document.addEventListener('keydown', function(e) {
            var tag = document.activeElement.tagName;
            if (tag === 'INPUT' || tag === 'TEXTAREA' || tag === 'SELECT') return;

            if (e.key === 'ArrowLeft') {
                var prevLink = document.querySelector('.nav-prev');
                if (prevLink) prevLink.click();
            } else if (e.key === 'ArrowRight') {
                var nextLink = document.querySelector('.nav-next');
                if (nextLink) nextLink.click();
            }
        });
    });
</script>

</body>
</html>
{% endraw %}