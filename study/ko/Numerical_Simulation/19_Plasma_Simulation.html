{% raw %}
<!DOCTYPE html>
<html lang="ko" data-theme="light">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>19. í”Œë¼ì¦ˆë§ˆ ì‹œë®¬ë ˆì´ì…˜ (Plasma Simulation) - Study Materials</title>
    <link rel="stylesheet" href="/study/static/css/style.css">
    <link rel="stylesheet" href="/study/static/css/highlight.css">
    <!-- KaTeX for LaTeX math rendering -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.16.11/dist/katex.min.css">
    <script defer src="https://cdn.jsdelivr.net/npm/katex@0.16.11/dist/katex.min.js"></script>
    <script defer src="https://cdn.jsdelivr.net/npm/katex@0.16.11/dist/contrib/auto-render.min.js"
        onload="renderMathInElement(document.body, {
            delimiters: [
                {left: '$$', right: '$$', display: true},
                {left: '$', right: '$', display: false}
            ],
            throwOnError: false
        });"></script>
    
</head>
<body>
    <div class="app-container">
        <!-- Sidebar -->
        <aside class="sidebar" id="sidebar">
            <div class="sidebar-header">
                <a href="/study/ko/" class="logo">Study Materials</a>
                <button class="sidebar-toggle" id="sidebar-toggle" aria-label="Toggle sidebar">
                    <span></span>
                </button>
            </div>

            <nav class="sidebar-nav">
                <a href="/study/ko/" class="nav-item ">
                    <span class="nav-icon">ğŸ </span>
                    <span class="nav-text">Home</span>
                </a>
                <a href="/study/examples/" class="nav-item ">
                    <span class="nav-icon">ğŸ’»</span>
                    <span class="nav-text">Examples</span>
                </a>
            </nav>

            <div class="sidebar-search">
                <form action="/study/ko/search.html" method="get" id="search-form">
                    <input type="search" name="q" placeholder="Search..." id="search-sidebar-input">
                </form>
            </div>

            <!-- Language Selector -->
            <div class="sidebar-lang">
                <select id="lang-select" class="lang-selector" onchange="switchLanguage(this.value)">
                    
                    <option value="en" >
                        English
                    </option>
                    
                    <option value="ko" selected>
                        í•œêµ­ì–´
                    </option>
                    
                </select>
            </div>

            <div class="sidebar-footer">
                <button class="theme-toggle" id="theme-toggle" aria-label="Toggle theme">
                    <span class="theme-icon light">â˜€ï¸</span>
                    <span class="theme-icon dark">ğŸŒ™</span>
                </button>
            </div>
        </aside>

        <!-- Main Content -->
        <main class="main-content">
            <header class="main-header">
                <button class="menu-toggle" id="menu-toggle" aria-label="Open menu">
                    <span></span>
                </button>
                
<nav class="breadcrumb">
    <a href="/study/ko/">Topics</a>
    <span class="separator">/</span>
    <a href="/study/ko/Numerical_Simulation/">Numerical Simulation</a>
    <span class="separator">/</span>
    <span class="current">19. í”Œë¼ì¦ˆë§ˆ ì‹œë®¬ë ˆì´ì…˜ (Plasma Simulation)</span>
</nav>

            </header>

            <div class="content">
                
<article class="lesson-article">
    <header class="lesson-header">
        <h1>19. í”Œë¼ì¦ˆë§ˆ ì‹œë®¬ë ˆì´ì…˜ (Plasma Simulation)</h1>
    </header>

    
<div class="lesson-toolbar lesson-toolbar--top">
    <div class="toolbar-nav toolbar-nav--prev">
        
        <a href="/study/ko/Numerical_Simulation/18_MHD_Numerical_Methods.html" class="nav-prev">
            <span class="nav-label">Previous</span>
            <span class="nav-title">18. MHD ìˆ˜ì¹˜í•´ë²• (MHD Numerical Methods)</span>
        </a>
        
    </div>
    <div class="toolbar-actions">
        <button class="btn btn-copy-link" data-action="copy-link" title="Copy link">
            <span class="icon">ğŸ”—</span>
            <span class="text">Copy link</span>
        </button>
        <a href="/study/ko/Numerical_Simulation/" class="btn btn-topic-link" title="Back to topic list">
            <span class="icon">ğŸ“‹</span>
            <span class="text">Topic list</span>
        </a>
    </div>
    <div class="toolbar-nav toolbar-nav--next">
        
        <a href="/study/ko/Numerical_Simulation/20_Monte_Carlo_Simulation.html" class="nav-next">
            <span class="nav-label">Next</span>
            <span class="nav-title">ëª¬í…Œì¹´ë¥¼ë¡œ ì‹œë®¬ë ˆì´ì…˜</span>
        </a>
        
    </div>
</div>


    
    <nav class="toc" id="toc">
        <h2>Table of Contents</h2>
        <div class="toc">
<ul>
<li><a href="#_1">í•™ìŠµ ëª©í‘œ</a></li>
<li><a href="#1-pic">1. PIC ë°©ë²• ì†Œê°œ</a><ul>
<li><a href="#11">1.1 ê°œë…ê³¼ ì›ë¦¬</a></li>
<li><a href="#12-pic">1.2 PIC ì‹œê°„/ê³µê°„ ìŠ¤ì¼€ì¼</a></li>
</ul>
</li>
<li><a href="#2-boris">2. ì…ì í‘¸ì‹œ: Boris ì•Œê³ ë¦¬ì¦˜</a><ul>
<li><a href="#21">2.1 ìš´ë™ ë°©ì •ì‹</a></li>
</ul>
</li>
<li><a href="#3-field-solve">3. ì¥ í’€ì´ (Field Solve)</a><ul>
<li><a href="#31-poisson">3.1 Poisson ë°©ì •ì‹</a></li>
</ul>
</li>
<li><a href="#4-">4. ì…ì-ê²©ì ë³´ê°„</a><ul>
<li><a href="#41-charge-assignment">4.1 ì „í•˜ í• ë‹¹ (Charge Assignment)</a></li>
</ul>
</li>
<li><a href="#5-1d-pic">5. 1D ì •ì „ê¸° PIC ì‹œë®¬ë ˆì´í„°</a><ul>
<li><a href="#51">5.1 ì™„ì „í•œ êµ¬í˜„</a></li>
<li><a href="#52-langmuir">5.2 Langmuir íŒŒ í…ŒìŠ¤íŠ¸</a></li>
</ul>
</li>
<li><a href="#6-two-stream">6. Two-Stream ë¶ˆì•ˆì •ì„±</a><ul>
<li><a href="#61">6.1 ë¬¼ë¦¬ì  ë°°ê²½</a></li>
</ul>
</li>
<li><a href="#7">7. ê³ ê¸‰ ì£¼ì œ</a><ul>
<li><a href="#71-pic">7.1 ì „ìê¸° PIC</a></li>
</ul>
</li>
<li><a href="#8">8. ì—°ìŠµ ë¬¸ì œ</a><ul>
<li><a href="#1-boris">ì—°ìŠµ 1: Boris ì•Œê³ ë¦¬ì¦˜</a></li>
<li><a href="#2-cic-vs-ngp">ì—°ìŠµ 2: CIC vs NGP</a></li>
<li><a href="#3">ì—°ìŠµ 3: ì—´í‰í˜•</a></li>
<li><a href="#4">ì—°ìŠµ 4: ë‘ ë¹” ë¶ˆì•ˆì •ì„±</a></li>
</ul>
</li>
<li><a href="#9">9. ì°¸ê³ ìë£Œ</a><ul>
<li><a href="#_2">í•µì‹¬ êµì¬</a></li>
<li><a href="#pic">PIC ì½”ë“œ</a></li>
<li><a href="#_3">ì˜¨ë¼ì¸ ìë£Œ</a></li>
</ul>
</li>
<li><a href="#_4">ìš”ì•½</a></li>
</ul>
</div>

    </nav>
    

    <div class="lesson-content markdown-body">
        <h1 id="19-plasma-simulation">19. í”Œë¼ì¦ˆë§ˆ ì‹œë®¬ë ˆì´ì…˜ (Plasma Simulation)<a class="header-link" href="#19-plasma-simulation" title="Permanent link">&para;</a></h1>
<h2 id="_1">í•™ìŠµ ëª©í‘œ<a class="header-link" href="#_1" title="Permanent link">&para;</a></h2>
<ul>
<li>Particle-In-Cell (PIC) ë°©ë²•ì˜ ê¸°ë³¸ ì›ë¦¬ ì´í•´</li>
<li>ì…ì í‘¸ì‹œ (Boris ì•Œê³ ë¦¬ì¦˜) êµ¬í˜„</li>
<li>ì¥ í’€ì´ (Poisson ë°©ì •ì‹)</li>
<li>ì…ì-ê²©ì ë³´ê°„</li>
<li>1D ì •ì „ê¸° PIC ì‹œë®¬ë ˆì´ì…˜ êµ¬í˜„</li>
<li>Two-stream ë¶ˆì•ˆì •ì„± ì‹œë®¬ë ˆì´ì…˜</li>
</ul>
<hr />
<h2 id="1-pic">1. PIC ë°©ë²• ì†Œê°œ<a class="header-link" href="#1-pic" title="Permanent link">&para;</a></h2>
<h3 id="11">1.1 ê°œë…ê³¼ ì›ë¦¬<a class="header-link" href="#11" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code>Particle-In-Cell (PIC) ë°©ë²•:

í•µì‹¬ ì•„ì´ë””ì–´:
- í”Œë¼ì¦ˆë§ˆë¥¼ ì´ì‚°ì ì¸ &quot;ìŠˆí¼ ì…ì&quot;ë¡œ í‘œí˜„
- ì „ìê¸°ì¥ì€ ê²©ì ìœ„ì—ì„œ ê³„ì‚°
- ì…ìì™€ ê²©ì ì‚¬ì´ ë³´ê°„ìœ¼ë¡œ ê²°í•©

ì¥ì :
- ìš´ë™ë¡ ì  íš¨ê³¼ í¬ì°© (ë¹„í‰í˜•, íŒŒë™-ì…ì ìƒí˜¸ì‘ìš©)
- ìƒëŒ€ë¡ ì  íš¨ê³¼ ì‰½ê²Œ í¬í•¨
- ë³µì¡í•œ í˜•ìƒê³¼ ê²½ê³„ì¡°ê±´

ë‹¨ì :
- ê³„ì‚° ë¹„ìš© (ë§ì€ ì…ì í•„ìš”)
- í†µê³„ì  ì¡ìŒ (ìœ í•œ ì…ì ìˆ˜)
- ì‹œê°„ ë‹¨ê³„ ì œí•œ (í”Œë¼ì¦ˆë§ˆ ì£¼íŒŒìˆ˜)

ì—­ì‚¬:
- Buneman, Dawson (1960ë…„ëŒ€)
- Birdsall &amp; Langdon (1991): í‘œì¤€ êµì¬
</code></pre></div>

<div class="highlight"><pre><span></span><code><span class="kn">import</span><span class="w"> </span><span class="nn">numpy</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">np</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">matplotlib.pyplot</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">plt</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">scipy.fft</span><span class="w"> </span><span class="kn">import</span> <span class="n">fft</span><span class="p">,</span> <span class="n">ifft</span><span class="p">,</span> <span class="n">fftfreq</span>

<span class="c1"># ë¬¼ë¦¬ ìƒìˆ˜ (ì •ê·œí™” ë‹¨ìœ„)</span>
<span class="c1"># ê¸¸ì´: Debye ê¸¸ì´ Î»D</span>
<span class="c1"># ì‹œê°„: í”Œë¼ì¦ˆë§ˆ ì£¼ê¸° Ï‰pe^-1</span>
<span class="c1"># ì†ë„: ì—´ì†ë„ vth</span>

<span class="k">def</span><span class="w"> </span><span class="nf">pic_introduction</span><span class="p">():</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;PIC ë°©ë²• ì†Œê°œ&quot;&quot;&quot;</span>

    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;=&quot;</span> <span class="o">*</span> <span class="mi">60</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Particle-In-Cell (PIC) ë°©ë²•&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;=&quot;</span> <span class="o">*</span> <span class="mi">60</span><span class="p">)</span>

    <span class="n">intro</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot;</span>
<span class="s2">    PIC ì•Œê³ ë¦¬ì¦˜ ì‚¬ì´í´:</span>

<span class="s2">    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”</span>
<span class="s2">    â”‚                                                         â”‚</span>
<span class="s2">    â”‚     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”‚</span>
<span class="s2">    â”‚     â”‚ ì…ì    â”‚ â”€â”€â”€â”€ ë³´ê°„ â”€â”€â”€â”€â†’   â”‚ ê²©ì    â”‚         â”‚</span>
<span class="s2">    â”‚     â”‚ (x, v)  â”‚ â† (ì „í•˜/ì „ë¥˜)     â”‚ (Ï, J)  â”‚         â”‚</span>
<span class="s2">    â”‚     â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜                    â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜         â”‚</span>
<span class="s2">    â”‚          â”‚                              â”‚               â”‚</span>
<span class="s2">    â”‚          â”‚                              â”‚ ì¥ í’€ì´       â”‚</span>
<span class="s2">    â”‚   ì…ì   â”‚                              â”‚ (Poisson/    â”‚</span>
<span class="s2">    â”‚   í‘¸ì‹œ   â”‚                              â”‚  Maxwell)    â”‚</span>
<span class="s2">    â”‚          â”‚                              â”‚               â”‚</span>
<span class="s2">    â”‚     â”Œâ”€â”€â”€â”€â”´â”€â”€â”€â”€â”                    â”Œâ”€â”€â”€â”€â”´â”€â”€â”€â”€â”         â”‚</span>
<span class="s2">    â”‚     â”‚ ì…ì    â”‚ â†â”€â”€â”€ ë³´ê°„ â”€â”€â”€â”€    â”‚ ê²©ì    â”‚         â”‚</span>
<span class="s2">    â”‚     â”‚ (x, v)  â”‚   (E, B)â†’ê°€ì†     â”‚ (E, B)  â”‚         â”‚</span>
<span class="s2">    â”‚     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜         â”‚</span>
<span class="s2">    â”‚                                                         â”‚</span>
<span class="s2">    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜</span>

<span class="s2">    ì‹œê°„ ì „ì§„ (Leapfrog):</span>
<span class="s2">    - ìœ„ì¹˜: t^n â†’ t^{n+1}  (x^{n+1} = x^n + v^{n+1/2}Î”t)</span>
<span class="s2">    - ì†ë„: t^{n-1/2} â†’ t^{n+1/2}  (Boris ì•Œê³ ë¦¬ì¦˜)</span>
<span class="s2">    - ì¥: t^n (ìœ„ì¹˜ì™€ ë™ê¸°í™”)</span>
<span class="s2">    &quot;&quot;&quot;</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">intro</span><span class="p">)</span>

<span class="n">pic_introduction</span><span class="p">()</span>
</code></pre></div>

<h3 id="12-pic">1.2 PIC ì‹œê°„/ê³µê°„ ìŠ¤ì¼€ì¼<a class="header-link" href="#12-pic" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">pic_scales</span><span class="p">():</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;PIC ì‹œë®¬ë ˆì´ì…˜ ìŠ¤ì¼€ì¼&quot;&quot;&quot;</span>

    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;=&quot;</span> <span class="o">*</span> <span class="mi">60</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;PIC ì‹œë®¬ë ˆì´ì…˜ ìŠ¤ì¼€ì¼ ì¡°ê±´&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;=&quot;</span> <span class="o">*</span> <span class="mi">60</span><span class="p">)</span>

    <span class="n">scales</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot;</span>
<span class="s2">    ê³µê°„ í•´ìƒë„:</span>
<span class="s2">    Î”x &lt; Î»D (Debye ê¸¸ì´)</span>
<span class="s2">    - Î»D = âˆš(Îµâ‚€kT/(n eÂ²)) = vth/Ï‰pe</span>
<span class="s2">    - Î”x ~ Î»D ì´ë©´ ë¹„ë¬¼ë¦¬ì  ê°€ì—´ ë°œìƒ</span>

<span class="s2">    ì‹œê°„ í•´ìƒë„:</span>
<span class="s2">    Î”t &lt; Ï‰pe^{-1} (í”Œë¼ì¦ˆë§ˆ ì£¼ê¸°)</span>
<span class="s2">    - Ï‰pe = âˆš(neÂ²/(Îµâ‚€m))</span>
<span class="s2">    - Î”t ~ 0.1-0.2 Ã— Ï‰pe^{-1} ê¶Œì¥</span>

<span class="s2">    CFL ì¡°ê±´:</span>
<span class="s2">    Î”t Ã— vmax &lt; Î”x</span>
<span class="s2">    - ì •ì „ê¸°: vmax ~ ì—´ì†ë„</span>
<span class="s2">    - ì „ìê¸°: vmax = c (ê´‘ì†)</span>

<span class="s2">    ì…ì ìˆ˜:</span>
<span class="s2">    N_ppc (particles per cell) &gt; 50-100</span>
<span class="s2">    - ì¡ìŒ ~ 1/âˆšN_ppc</span>
<span class="s2">    - ë” ë§ì„ìˆ˜ë¡ ì¡ìŒ ê°ì†Œ</span>

<span class="s2">    ì‹œë®¬ë ˆì´ì…˜ ë°•ìŠ¤:</span>
<span class="s2">    L &gt; ì—¬ëŸ¬ íŒŒì¥ (ê´€ì‹¬ í˜„ìƒ)</span>
<span class="s2">    - ì£¼ê¸°ì  ê²½ê³„: ì¥íŒŒì¥ ì œí•œ</span>
<span class="s2">    - ì—´ë¦° ê²½ê³„: ë°˜ì‚¬ ì²˜ë¦¬ í•„ìš”</span>
<span class="s2">    &quot;&quot;&quot;</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">scales</span><span class="p">)</span>

    <span class="c1"># ìŠ¤ì¼€ì¼ ê´€ê³„ ì‹œê°í™”</span>
    <span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">6</span><span class="p">))</span>

    <span class="c1"># ì •ê·œí™” ë‹¨ìœ„ì—ì„œ</span>
    <span class="c1"># ê¸¸ì´ ë‹¨ìœ„: Î»D, ì‹œê°„ ë‹¨ìœ„: Ï‰pe^-1</span>

    <span class="n">n_cells</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">100</span><span class="p">)</span>
    <span class="n">n_ppc</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">10</span><span class="p">,</span> <span class="mi">50</span><span class="p">,</span> <span class="mi">100</span><span class="p">,</span> <span class="mi">500</span><span class="p">])</span>

    <span class="k">for</span> <span class="n">ppc</span> <span class="ow">in</span> <span class="n">n_ppc</span><span class="p">:</span>
        <span class="n">noise</span> <span class="o">=</span> <span class="mi">1</span> <span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">ppc</span> <span class="o">*</span> <span class="n">n_cells</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">loglog</span><span class="p">(</span><span class="n">n_cells</span><span class="p">,</span> <span class="n">noise</span> <span class="o">*</span> <span class="mi">100</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="sa">f</span><span class="s1">&#39;N_ppc = </span><span class="si">{</span><span class="n">ppc</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>

    <span class="n">ax</span><span class="o">.</span><span class="n">axhline</span><span class="p">(</span><span class="n">y</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;red&#39;</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;--&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;1% noise level&#39;</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;Number of cells&#39;</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;Relative noise [%]&#39;</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;PIC í†µê³„ì  ì¡ìŒ vs ì…€ ìˆ˜ ë° ì…ì ë°€ë„&#39;</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="kc">True</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.3</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">100</span><span class="p">)</span>

    <span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="s1">&#39;pic_noise.png&#39;</span><span class="p">,</span> <span class="n">dpi</span><span class="o">=</span><span class="mi">150</span><span class="p">,</span> <span class="n">bbox_inches</span><span class="o">=</span><span class="s1">&#39;tight&#39;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>

<span class="c1"># pic_scales()</span>
</code></pre></div>

<hr />
<h2 id="2-boris">2. ì…ì í‘¸ì‹œ: Boris ì•Œê³ ë¦¬ì¦˜<a class="header-link" href="#2-boris" title="Permanent link">&para;</a></h2>
<h3 id="21">2.1 ìš´ë™ ë°©ì •ì‹<a class="header-link" href="#21" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code>í•˜ì „ ì…ìì˜ ìš´ë™ ë°©ì •ì‹:

dx/dt = v

m dv/dt = q(E + v Ã— B)

Boris ì•Œê³ ë¦¬ì¦˜ (1970):
- ì‹œê°„ ì¤‘ì‹¬ (time-centered) ìŠ¤í‚´
- ìê¸°ì¥ì—ì„œ ì—ë„ˆì§€ ë³´ì¡´
- 2ì°¨ ì •í™•ë„

ë‹¨ê³„:
1. ë°˜ê°€ì† (Eì— ì˜í•œ): vâ» = v^{n-1/2} + (qE/m)(Î”t/2)
2. íšŒì „ (Bì— ì˜í•œ): v&#39; â†’ vâº (ì—ë„ˆì§€ ë¶ˆë³€ íšŒì „)
3. ë°˜ê°€ì†: v^{n+1/2} = vâº + (qE/m)(Î”t/2)
4. ìœ„ì¹˜ ì—…ë°ì´íŠ¸: x^{n+1} = x^n + v^{n+1/2}Î”t
</code></pre></div>

<div class="highlight"><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">boris_pusher</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">v</span><span class="p">,</span> <span class="n">E</span><span class="p">,</span> <span class="n">B</span><span class="p">,</span> <span class="n">q</span><span class="p">,</span> <span class="n">m</span><span class="p">,</span> <span class="n">dt</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Boris ì…ì í‘¸ì…”</span>

<span class="sd">    Parameters:</span>
<span class="sd">    - x, v: ì…ì ìœ„ì¹˜, ì†ë„ (ë°°ì—´)</span>
<span class="sd">    - E, B: ì…ì ìœ„ì¹˜ì—ì„œì˜ ì „ê¸°/ìê¸°ì¥</span>
<span class="sd">    - q, m: ì „í•˜, ì§ˆëŸ‰</span>
<span class="sd">    - dt: ì‹œê°„ ë‹¨ê³„</span>

<span class="sd">    Returns:</span>
<span class="sd">    - x_new, v_new: ì—…ë°ì´íŠ¸ëœ ìœ„ì¹˜, ì†ë„</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># í¸ì˜ë¥¼ ìœ„í•œ ê³„ìˆ˜</span>
    <span class="n">qmdt2</span> <span class="o">=</span> <span class="n">q</span> <span class="o">*</span> <span class="n">dt</span> <span class="o">/</span> <span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="n">m</span><span class="p">)</span>

    <span class="c1"># 1. ë°˜ê°€ì† (E)</span>
    <span class="n">v_minus</span> <span class="o">=</span> <span class="n">v</span> <span class="o">+</span> <span class="n">qmdt2</span> <span class="o">*</span> <span class="n">E</span>

    <span class="c1"># 2. íšŒì „ (B)</span>
    <span class="c1"># t = (q/m)(B)(Î”t/2)</span>
    <span class="n">t</span> <span class="o">=</span> <span class="n">qmdt2</span> <span class="o">*</span> <span class="n">B</span>
    <span class="n">s</span> <span class="o">=</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">t</span> <span class="o">/</span> <span class="p">(</span><span class="mi">1</span> <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="n">t</span><span class="p">))</span>

    <span class="c1"># v&#39; = vâ» + vâ» Ã— t</span>
    <span class="n">v_prime</span> <span class="o">=</span> <span class="n">v_minus</span> <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">cross</span><span class="p">(</span><span class="n">v_minus</span><span class="p">,</span> <span class="n">t</span><span class="p">)</span>

    <span class="c1"># vâº = vâ» + v&#39; Ã— s</span>
    <span class="n">v_plus</span> <span class="o">=</span> <span class="n">v_minus</span> <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">cross</span><span class="p">(</span><span class="n">v_prime</span><span class="p">,</span> <span class="n">s</span><span class="p">)</span>

    <span class="c1"># 3. ë°˜ê°€ì† (E)</span>
    <span class="n">v_new</span> <span class="o">=</span> <span class="n">v_plus</span> <span class="o">+</span> <span class="n">qmdt2</span> <span class="o">*</span> <span class="n">E</span>

    <span class="c1"># 4. ìœ„ì¹˜ ì—…ë°ì´íŠ¸</span>
    <span class="n">x_new</span> <span class="o">=</span> <span class="n">x</span> <span class="o">+</span> <span class="n">v_new</span> <span class="o">*</span> <span class="n">dt</span>

    <span class="k">return</span> <span class="n">x_new</span><span class="p">,</span> <span class="n">v_new</span>


<span class="k">def</span><span class="w"> </span><span class="nf">boris_demo</span><span class="p">():</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Boris ì•Œê³ ë¦¬ì¦˜ ì‹œì—°: ê· ì¼ ìê¸°ì¥ì—ì„œì˜ ì…ì ìš´ë™&quot;&quot;&quot;</span>

    <span class="c1"># ì„¤ì •</span>
    <span class="n">q</span> <span class="o">=</span> <span class="mf">1.0</span>   <span class="c1"># ì „í•˜</span>
    <span class="n">m</span> <span class="o">=</span> <span class="mf">1.0</span>   <span class="c1"># ì§ˆëŸ‰</span>
    <span class="n">B0</span> <span class="o">=</span> <span class="mf">1.0</span>  <span class="c1"># ìê¸°ì¥ ê°•ë„ (z ë°©í–¥)</span>

    <span class="c1"># ì‚¬ì´í´ë¡œíŠ¸ë¡  ì£¼íŒŒìˆ˜ì™€ ì£¼ê¸°</span>
    <span class="n">omega_c</span> <span class="o">=</span> <span class="n">q</span> <span class="o">*</span> <span class="n">B0</span> <span class="o">/</span> <span class="n">m</span>
    <span class="n">T_c</span> <span class="o">=</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span> <span class="o">/</span> <span class="n">omega_c</span>

    <span class="c1"># ì‹œê°„ ì„¤ì •</span>
    <span class="n">dt</span> <span class="o">=</span> <span class="mf">0.1</span>  <span class="c1"># T_cì˜ ì•½ 1/63</span>
    <span class="n">n_steps</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="mi">3</span> <span class="o">*</span> <span class="n">T_c</span> <span class="o">/</span> <span class="n">dt</span><span class="p">)</span>

    <span class="c1"># ì´ˆê¸° ì¡°ê±´</span>
    <span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">])</span>
    <span class="n">v</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mf">1.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">])</span>  <span class="c1"># x ë°©í–¥ ì´ˆê¸° ì†ë„</span>
    <span class="n">E</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">])</span>  <span class="c1"># ì „ê¸°ì¥ ì—†ìŒ</span>
    <span class="n">B</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="n">B0</span><span class="p">])</span>   <span class="c1"># z ë°©í–¥ ìê¸°ì¥</span>

    <span class="c1"># ê¶¤ì  ê¸°ë¡</span>
    <span class="n">trajectory</span> <span class="o">=</span> <span class="p">[</span><span class="n">x</span><span class="o">.</span><span class="n">copy</span><span class="p">()]</span>
    <span class="n">velocity</span> <span class="o">=</span> <span class="p">[</span><span class="n">v</span><span class="o">.</span><span class="n">copy</span><span class="p">()]</span>

    <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n_steps</span><span class="p">):</span>
        <span class="n">x</span><span class="p">,</span> <span class="n">v</span> <span class="o">=</span> <span class="n">boris_pusher</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">v</span><span class="p">,</span> <span class="n">E</span><span class="p">,</span> <span class="n">B</span><span class="p">,</span> <span class="n">q</span><span class="p">,</span> <span class="n">m</span><span class="p">,</span> <span class="n">dt</span><span class="p">)</span>
        <span class="n">trajectory</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">x</span><span class="o">.</span><span class="n">copy</span><span class="p">())</span>
        <span class="n">velocity</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">v</span><span class="o">.</span><span class="n">copy</span><span class="p">())</span>

    <span class="n">trajectory</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">trajectory</span><span class="p">)</span>
    <span class="n">velocity</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">velocity</span><span class="p">)</span>

    <span class="c1"># ì‹œê°í™”</span>
    <span class="n">fig</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">14</span><span class="p">,</span> <span class="mi">5</span><span class="p">))</span>

    <span class="c1"># (1) x-y í‰ë©´ ê¶¤ì </span>
    <span class="n">ax1</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="mi">131</span><span class="p">)</span>
    <span class="n">ax1</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">trajectory</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">],</span> <span class="n">trajectory</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">],</span> <span class="s1">&#39;b-&#39;</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mf">1.5</span><span class="p">)</span>
    <span class="n">ax1</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">trajectory</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span> <span class="n">trajectory</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span> <span class="s1">&#39;go&#39;</span><span class="p">,</span> <span class="n">markersize</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;ì‹œì‘&#39;</span><span class="p">)</span>
    <span class="n">ax1</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">trajectory</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span> <span class="n">trajectory</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span> <span class="s1">&#39;r^&#39;</span><span class="p">,</span> <span class="n">markersize</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;ë&#39;</span><span class="p">)</span>

    <span class="c1"># í•´ì„í•´ (ì›)</span>
    <span class="n">r_L</span> <span class="o">=</span> <span class="n">m</span> <span class="o">*</span> <span class="n">v</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">/</span> <span class="p">(</span><span class="n">q</span> <span class="o">*</span> <span class="n">B0</span><span class="p">)</span>  <span class="c1"># Larmor ë°˜ê²½</span>
    <span class="n">theta</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">2</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">,</span> <span class="mi">100</span><span class="p">)</span>
    <span class="n">x_exact</span> <span class="o">=</span> <span class="n">r_L</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">theta</span><span class="p">)</span>
    <span class="n">y_exact</span> <span class="o">=</span> <span class="n">r_L</span> <span class="o">*</span> <span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">theta</span><span class="p">))</span>
    <span class="n">ax1</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x_exact</span><span class="p">,</span> <span class="n">y_exact</span><span class="p">,</span> <span class="s1">&#39;k--&#39;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;í•´ì„í•´&#39;</span><span class="p">)</span>

    <span class="n">ax1</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;x&#39;</span><span class="p">)</span>
    <span class="n">ax1</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;y&#39;</span><span class="p">)</span>
    <span class="n">ax1</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;x-y í‰ë©´ ê¶¤ì  (ì‚¬ì´í´ë¡œíŠ¸ë¡  ìš´ë™)&#39;</span><span class="p">)</span>
    <span class="n">ax1</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
    <span class="n">ax1</span><span class="o">.</span><span class="n">set_aspect</span><span class="p">(</span><span class="s1">&#39;equal&#39;</span><span class="p">)</span>
    <span class="n">ax1</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="kc">True</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.3</span><span class="p">)</span>

    <span class="c1"># (2) ì—ë„ˆì§€ ë³´ì¡´</span>
    <span class="n">ax2</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="mi">132</span><span class="p">)</span>
    <span class="n">KE</span> <span class="o">=</span> <span class="mf">0.5</span> <span class="o">*</span> <span class="n">m</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">velocity</span><span class="o">**</span><span class="mi">2</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
    <span class="n">t</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">KE</span><span class="p">))</span> <span class="o">*</span> <span class="n">dt</span>

    <span class="n">ax2</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">t</span> <span class="o">/</span> <span class="n">T_c</span><span class="p">,</span> <span class="n">KE</span> <span class="o">/</span> <span class="n">KE</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="s1">&#39;b-&#39;</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mf">1.5</span><span class="p">)</span>
    <span class="n">ax2</span><span class="o">.</span><span class="n">axhline</span><span class="p">(</span><span class="n">y</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;red&#39;</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;--&#39;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.5</span><span class="p">)</span>
    <span class="n">ax2</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;t / $T_c$&#39;</span><span class="p">)</span>
    <span class="n">ax2</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;KE / KE$_0$&#39;</span><span class="p">)</span>
    <span class="n">ax2</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;ìš´ë™ ì—ë„ˆì§€ ë³´ì¡´&#39;</span><span class="p">)</span>
    <span class="n">ax2</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="kc">True</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.3</span><span class="p">)</span>
    <span class="n">ax2</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">(</span><span class="mf">0.99</span><span class="p">,</span> <span class="mf">1.01</span><span class="p">)</span>

    <span class="c1"># (3) ì†ë„ ì„±ë¶„</span>
    <span class="n">ax3</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="mi">133</span><span class="p">)</span>
    <span class="n">ax3</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">t</span> <span class="o">/</span> <span class="n">T_c</span><span class="p">,</span> <span class="n">velocity</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">],</span> <span class="s1">&#39;r-&#39;</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mf">1.5</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="sa">r</span><span class="s1">&#39;$v_x$&#39;</span><span class="p">)</span>
    <span class="n">ax3</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">t</span> <span class="o">/</span> <span class="n">T_c</span><span class="p">,</span> <span class="n">velocity</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">],</span> <span class="s1">&#39;b-&#39;</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mf">1.5</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="sa">r</span><span class="s1">&#39;$v_y$&#39;</span><span class="p">)</span>
    <span class="n">ax3</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;t / $T_c$&#39;</span><span class="p">)</span>
    <span class="n">ax3</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;v&#39;</span><span class="p">)</span>
    <span class="n">ax3</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;ì†ë„ ì„±ë¶„&#39;</span><span class="p">)</span>
    <span class="n">ax3</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
    <span class="n">ax3</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="kc">True</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.3</span><span class="p">)</span>

    <span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="s1">&#39;boris_demo.png&#39;</span><span class="p">,</span> <span class="n">dpi</span><span class="o">=</span><span class="mi">150</span><span class="p">,</span> <span class="n">bbox_inches</span><span class="o">=</span><span class="s1">&#39;tight&#39;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>

    <span class="c1"># ì •í™•ë„ ë¶„ì„</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Boris ì•Œê³ ë¦¬ì¦˜ ë¶„ì„:&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  dt = </span><span class="si">{</span><span class="n">dt</span><span class="si">:</span><span class="s2">.3f</span><span class="si">}</span><span class="s2">, Ï‰cÂ·dt = </span><span class="si">{</span><span class="n">omega_c</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">dt</span><span class="si">:</span><span class="s2">.3f</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  ì—ë„ˆì§€ ë³€í™”: </span><span class="si">{</span><span class="p">(</span><span class="n">KE</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="n">KE</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="mi">1</span><span class="p">)</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="mi">100</span><span class="si">:</span><span class="s2">.6f</span><span class="si">}</span><span class="s2">%&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  Larmor ë°˜ê²½: ì´ë¡  </span><span class="si">{</span><span class="n">r_L</span><span class="si">:</span><span class="s2">.3f</span><span class="si">}</span><span class="s2">, ì‹œë®¬ </span><span class="si">{</span><span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">trajectory</span><span class="p">[:,</span><span class="w"> </span><span class="mi">0</span><span class="p">])</span><span class="si">:</span><span class="s2">.3f</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

<span class="c1"># boris_demo()</span>
</code></pre></div>

<hr />
<h2 id="3-field-solve">3. ì¥ í’€ì´ (Field Solve)<a class="header-link" href="#3-field-solve" title="Permanent link">&para;</a></h2>
<h3 id="31-poisson">3.1 Poisson ë°©ì •ì‹<a class="header-link" href="#31-poisson" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code>ì •ì „ê¸° PICì—ì„œì˜ ì¥ í’€ì´:

Poisson ë°©ì •ì‹:
âˆ‡Â²Ï† = -Ï/Îµâ‚€

1D:
dÂ²Ï†/dxÂ² = -Ï/Îµâ‚€

ì´ì‚°í™” (ì¤‘ì‹¬ì°¨ë¶„):
(Ï†_{i+1} - 2Ï†_i + Ï†_{i-1})/Î”xÂ² = -Ï_i/Îµâ‚€

í–‰ë ¬ í˜•íƒœ:
AÂ·Ï† = b

ê²½ê³„ì¡°ê±´:
<span class="k">-</span> ì£¼ê¸°ì : Ï†(0) = Ï†(L)
<span class="k">-</span> Dirichlet: Ï† = ì§€ì •ê°’
<span class="k">-</span> Neumann: dÏ†/dn = ì§€ì •ê°’

ì „ê¸°ì¥:
E = -âˆ‡Ï†
E_i = -(Ï†_{i+1} - Ï†_{i-1})/(2Î”x)
</code></pre></div>

<div class="highlight"><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">solve_poisson_1d_periodic</span><span class="p">(</span><span class="n">rho</span><span class="p">,</span> <span class="n">dx</span><span class="p">,</span> <span class="n">eps0</span><span class="o">=</span><span class="mf">1.0</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    1D Poisson ë°©ì •ì‹ í’€ì´ (ì£¼ê¸°ì  ê²½ê³„ì¡°ê±´)</span>
<span class="sd">    FFT ì‚¬ìš©</span>

<span class="sd">    âˆ‡Â²Ï† = -Ï/Îµâ‚€</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">Nx</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">rho</span><span class="p">)</span>
    <span class="n">L</span> <span class="o">=</span> <span class="n">Nx</span> <span class="o">*</span> <span class="n">dx</span>

    <span class="c1"># FFT</span>
    <span class="n">rho_k</span> <span class="o">=</span> <span class="n">fft</span><span class="p">(</span><span class="n">rho</span><span class="p">)</span>

    <span class="c1"># íŒŒìˆ˜</span>
    <span class="n">k</span> <span class="o">=</span> <span class="n">fftfreq</span><span class="p">(</span><span class="n">Nx</span><span class="p">,</span> <span class="n">dx</span><span class="p">)</span> <span class="o">*</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span>

    <span class="c1"># Poisson í’€ì´ (k=0 ëª¨ë“œ ì œì™¸)</span>
    <span class="n">phi_k</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros_like</span><span class="p">(</span><span class="n">rho_k</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">complex</span><span class="p">)</span>
    <span class="n">phi_k</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span> <span class="o">=</span> <span class="n">rho_k</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span> <span class="o">/</span> <span class="p">(</span><span class="n">eps0</span> <span class="o">*</span> <span class="n">k</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>
    <span class="n">phi_k</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>  <span class="c1"># k=0 ëª¨ë“œ (í‰ê·  í¬í…ì…œ = 0)</span>

    <span class="c1"># ì—­ FFT</span>
    <span class="n">phi</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">real</span><span class="p">(</span><span class="n">ifft</span><span class="p">(</span><span class="n">phi_k</span><span class="p">))</span>

    <span class="k">return</span> <span class="n">phi</span>

<span class="k">def</span><span class="w"> </span><span class="nf">solve_poisson_1d_dirichlet</span><span class="p">(</span><span class="n">rho</span><span class="p">,</span> <span class="n">dx</span><span class="p">,</span> <span class="n">phi_left</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">phi_right</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">eps0</span><span class="o">=</span><span class="mf">1.0</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    1D Poisson ë°©ì •ì‹ í’€ì´ (Dirichlet ê²½ê³„ì¡°ê±´)</span>
<span class="sd">    ì‚¼ì¤‘ëŒ€ê° í–‰ë ¬</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">Nx</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">rho</span><span class="p">)</span>

    <span class="c1"># ì‚¼ì¤‘ëŒ€ê° í–‰ë ¬ í’€ì´ (Thomas ì•Œê³ ë¦¬ì¦˜)</span>
    <span class="n">a</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="n">Nx</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span>         <span class="c1"># í•˜ëŒ€ê°</span>
    <span class="n">b</span> <span class="o">=</span> <span class="o">-</span><span class="mi">2</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="n">Nx</span><span class="p">)</span>        <span class="c1"># ëŒ€ê°</span>
    <span class="n">c</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="n">Nx</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span>         <span class="c1"># ìƒëŒ€ê°</span>
    <span class="n">d</span> <span class="o">=</span> <span class="o">-</span><span class="n">rho</span> <span class="o">*</span> <span class="n">dx</span><span class="o">**</span><span class="mi">2</span> <span class="o">/</span> <span class="n">eps0</span>     <span class="c1"># ìš°ë³€</span>

    <span class="c1"># ê²½ê³„ì¡°ê±´</span>
    <span class="n">d</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">-=</span> <span class="n">phi_left</span>
    <span class="n">d</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">-=</span> <span class="n">phi_right</span>

    <span class="c1"># Forward sweep</span>
    <span class="n">c_star</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">Nx</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span>
    <span class="n">d_star</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">Nx</span><span class="p">)</span>

    <span class="n">c_star</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">c</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">/</span> <span class="n">b</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    <span class="n">d_star</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">d</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">/</span> <span class="n">b</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>

    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">Nx</span> <span class="o">-</span> <span class="mi">1</span><span class="p">):</span>
        <span class="n">c_star</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">c</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">/</span> <span class="p">(</span><span class="n">b</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">-</span> <span class="n">a</span><span class="p">[</span><span class="n">i</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">*</span> <span class="n">c_star</span><span class="p">[</span><span class="n">i</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>

    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">Nx</span><span class="p">):</span>
        <span class="n">d_star</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">d</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">-</span> <span class="n">a</span><span class="p">[</span><span class="n">i</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">*</span> <span class="n">d_star</span><span class="p">[</span><span class="n">i</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span> <span class="o">/</span> <span class="p">(</span><span class="n">b</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">-</span> <span class="n">a</span><span class="p">[</span><span class="n">i</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">*</span> <span class="n">c_star</span><span class="p">[</span><span class="n">i</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="k">if</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">Nx</span><span class="o">-</span><span class="mi">1</span> <span class="k">else</span> <span class="n">b</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">-</span> <span class="n">a</span><span class="p">[</span><span class="n">i</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">*</span> <span class="n">c_star</span><span class="p">[</span><span class="n">i</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>

    <span class="c1"># Back substitution</span>
    <span class="n">phi</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">Nx</span><span class="p">)</span>
    <span class="n">phi</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">d_star</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>

    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">Nx</span> <span class="o">-</span> <span class="mi">2</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">):</span>
        <span class="n">phi</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">d_star</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">-</span> <span class="n">c_star</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">*</span> <span class="n">phi</span><span class="p">[</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span>

    <span class="k">return</span> <span class="n">phi</span>

<span class="k">def</span><span class="w"> </span><span class="nf">electric_field_from_potential</span><span class="p">(</span><span class="n">phi</span><span class="p">,</span> <span class="n">dx</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;í¬í…ì…œì—ì„œ ì „ê¸°ì¥ ê³„ì‚°&quot;&quot;&quot;</span>
    <span class="n">Nx</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">phi</span><span class="p">)</span>
    <span class="n">E</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">Nx</span><span class="p">)</span>

    <span class="c1"># ì¤‘ì‹¬ì°¨ë¶„ (ì£¼ê¸°ì  ê²½ê³„ì¡°ê±´)</span>
    <span class="n">E</span><span class="p">[</span><span class="mi">1</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="o">-</span><span class="p">(</span><span class="n">phi</span><span class="p">[</span><span class="mi">2</span><span class="p">:]</span> <span class="o">-</span> <span class="n">phi</span><span class="p">[:</span><span class="o">-</span><span class="mi">2</span><span class="p">])</span> <span class="o">/</span> <span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="n">dx</span><span class="p">)</span>
    <span class="n">E</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="o">-</span><span class="p">(</span><span class="n">phi</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">phi</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span> <span class="o">/</span> <span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="n">dx</span><span class="p">)</span>
    <span class="n">E</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="o">-</span><span class="p">(</span><span class="n">phi</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">-</span> <span class="n">phi</span><span class="p">[</span><span class="o">-</span><span class="mi">2</span><span class="p">])</span> <span class="o">/</span> <span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="n">dx</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">E</span>
</code></pre></div>

<hr />
<h2 id="4-">4. ì…ì-ê²©ì ë³´ê°„<a class="header-link" href="#4-" title="Permanent link">&para;</a></h2>
<h3 id="41-charge-assignment">4.1 ì „í•˜ í• ë‹¹ (Charge Assignment)<a class="header-link" href="#41-charge-assignment" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code>ì…ìì—ì„œ ê²©ìë¡œ ì „í•˜ í• ë‹¹:

1. NGP (Nearest Grid Point):
   <span class="k">-</span> ê°€ì¥ ê°€ê¹Œìš´ ê²©ìì ì— ì „ì²´ ì „í•˜ í• ë‹¹
   <span class="k">-</span> 1ì°¨ ì •í™•ë„, ë¶ˆì—°ì†, ì¡ìŒ í¼

2. CIC (Cloud-In-Cell) / Linear:
   <span class="k">-</span> ì„ í˜• ê°€ì¤‘ì¹˜ë¡œ ë‘ ì¸ì ‘ ê²©ìì ì— ë¶„ë°°
   <span class="k">-</span> ê°€ì¤‘ì¹˜: W_i = 1 - |x - x_i|/Î”x
   <span class="k">-</span> 2ì°¨ ì •í™•ë„, ì—°ì†, ì¡ìŒ ê°ì†Œ

3. TSC (Triangular-Shaped Cloud):
   <span class="k">-</span> 2ì°¨ ë‹¤í•­ì‹ ê°€ì¤‘ì¹˜
   <span class="k">-</span> 3ê°œ ê²©ìì ì— ë¶„ë°°
   <span class="k">-</span> ë” ë§¤ë„ëŸ¬ì›€

4. Spline ë³´ê°„:
   <span class="k">-</span> ê³ ì°¨ B-spline
   <span class="k">-</span> ë” ë§ì€ ê²©ìì  ê´€ì—¬
</code></pre></div>

<div class="highlight"><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">charge_to_grid_cic</span><span class="p">(</span><span class="n">x_particles</span><span class="p">,</span> <span class="n">q_particles</span><span class="p">,</span> <span class="n">Nx</span><span class="p">,</span> <span class="n">dx</span><span class="p">,</span> <span class="n">L</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    CIC (Cloud-In-Cell) ì „í•˜ í• ë‹¹</span>

<span class="sd">    Parameters:</span>
<span class="sd">    - x_particles: ì…ì ìœ„ì¹˜ ë°°ì—´</span>
<span class="sd">    - q_particles: ì…ì ì „í•˜ ë°°ì—´</span>
<span class="sd">    - Nx: ê²©ìì  ìˆ˜</span>
<span class="sd">    - dx: ê²©ì ê°„ê²©</span>
<span class="sd">    - L: ë„ë©”ì¸ í¬ê¸°</span>

<span class="sd">    Returns:</span>
<span class="sd">    - rho: ê²©ì ìœ„ ì „í•˜ë°€ë„</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">rho</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">Nx</span><span class="p">)</span>

    <span class="k">for</span> <span class="n">x</span><span class="p">,</span> <span class="n">q</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">x_particles</span><span class="p">,</span> <span class="n">q_particles</span><span class="p">):</span>
        <span class="c1"># ì£¼ê¸°ì  ê²½ê³„</span>
        <span class="n">x</span> <span class="o">=</span> <span class="n">x</span> <span class="o">%</span> <span class="n">L</span>

        <span class="c1"># ì™¼ìª½ ê²©ìì  ì¸ë±ìŠ¤</span>
        <span class="n">i</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">x</span> <span class="o">/</span> <span class="n">dx</span><span class="p">)</span>
        <span class="n">i_next</span> <span class="o">=</span> <span class="p">(</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="o">%</span> <span class="n">Nx</span>

        <span class="c1"># CIC ê°€ì¤‘ì¹˜</span>
        <span class="n">frac</span> <span class="o">=</span> <span class="p">(</span><span class="n">x</span> <span class="o">/</span> <span class="n">dx</span><span class="p">)</span> <span class="o">-</span> <span class="n">i</span>
        <span class="n">w_left</span> <span class="o">=</span> <span class="mi">1</span> <span class="o">-</span> <span class="n">frac</span>
        <span class="n">w_right</span> <span class="o">=</span> <span class="n">frac</span>

        <span class="c1"># ì „í•˜ í• ë‹¹</span>
        <span class="n">rho</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">+=</span> <span class="n">q</span> <span class="o">*</span> <span class="n">w_left</span> <span class="o">/</span> <span class="n">dx</span>
        <span class="n">rho</span><span class="p">[</span><span class="n">i_next</span><span class="p">]</span> <span class="o">+=</span> <span class="n">q</span> <span class="o">*</span> <span class="n">w_right</span> <span class="o">/</span> <span class="n">dx</span>

    <span class="k">return</span> <span class="n">rho</span>

<span class="k">def</span><span class="w"> </span><span class="nf">field_to_particle_cic</span><span class="p">(</span><span class="n">E_grid</span><span class="p">,</span> <span class="n">x_particle</span><span class="p">,</span> <span class="n">dx</span><span class="p">,</span> <span class="n">L</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    CIC ì¥ ë³´ê°„ (ê²©ì -&gt; ì…ì)</span>

<span class="sd">    Parameters:</span>
<span class="sd">    - E_grid: ê²©ì ìœ„ ì „ê¸°ì¥</span>
<span class="sd">    - x_particle: ì…ì ìœ„ì¹˜</span>
<span class="sd">    - dx: ê²©ì ê°„ê²©</span>
<span class="sd">    - L: ë„ë©”ì¸ í¬ê¸°</span>

<span class="sd">    Returns:</span>
<span class="sd">    - E_particle: ì…ì ìœ„ì¹˜ì—ì„œì˜ ì „ê¸°ì¥</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">Nx</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">E_grid</span><span class="p">)</span>
    <span class="n">x</span> <span class="o">=</span> <span class="n">x_particle</span> <span class="o">%</span> <span class="n">L</span>

    <span class="n">i</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">x</span> <span class="o">/</span> <span class="n">dx</span><span class="p">)</span>
    <span class="n">i_next</span> <span class="o">=</span> <span class="p">(</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="o">%</span> <span class="n">Nx</span>

    <span class="n">frac</span> <span class="o">=</span> <span class="p">(</span><span class="n">x</span> <span class="o">/</span> <span class="n">dx</span><span class="p">)</span> <span class="o">-</span> <span class="n">i</span>
    <span class="n">w_left</span> <span class="o">=</span> <span class="mi">1</span> <span class="o">-</span> <span class="n">frac</span>
    <span class="n">w_right</span> <span class="o">=</span> <span class="n">frac</span>

    <span class="n">E_particle</span> <span class="o">=</span> <span class="n">w_left</span> <span class="o">*</span> <span class="n">E_grid</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">+</span> <span class="n">w_right</span> <span class="o">*</span> <span class="n">E_grid</span><span class="p">[</span><span class="n">i_next</span><span class="p">]</span>

    <span class="k">return</span> <span class="n">E_particle</span>


<span class="k">def</span><span class="w"> </span><span class="nf">interpolation_demo</span><span class="p">():</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;ë³´ê°„ ë°©ë²• ì‹œì—°&quot;&quot;&quot;</span>

    <span class="n">fig</span><span class="p">,</span> <span class="n">axes</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">14</span><span class="p">,</span> <span class="mi">5</span><span class="p">))</span>

    <span class="c1"># (1) ì „í•˜ í• ë‹¹ ë¹„êµ</span>
    <span class="n">ax1</span> <span class="o">=</span> <span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>

    <span class="n">Nx</span> <span class="o">=</span> <span class="mi">20</span>
    <span class="n">dx</span> <span class="o">=</span> <span class="mf">1.0</span>
    <span class="n">L</span> <span class="o">=</span> <span class="n">Nx</span> <span class="o">*</span> <span class="n">dx</span>

    <span class="c1"># ë‹¨ì¼ ì…ì</span>
    <span class="n">x_particle</span> <span class="o">=</span> <span class="mf">5.3</span> <span class="o">*</span> <span class="n">dx</span>
    <span class="n">q</span> <span class="o">=</span> <span class="mf">1.0</span>

    <span class="c1"># NGP</span>
    <span class="n">rho_ngp</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">Nx</span><span class="p">)</span>
    <span class="n">i_ngp</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="nb">round</span><span class="p">(</span><span class="n">x_particle</span> <span class="o">/</span> <span class="n">dx</span><span class="p">))</span> <span class="o">%</span> <span class="n">Nx</span>
    <span class="n">rho_ngp</span><span class="p">[</span><span class="n">i_ngp</span><span class="p">]</span> <span class="o">=</span> <span class="n">q</span> <span class="o">/</span> <span class="n">dx</span>

    <span class="c1"># CIC</span>
    <span class="n">rho_cic</span> <span class="o">=</span> <span class="n">charge_to_grid_cic</span><span class="p">([</span><span class="n">x_particle</span><span class="p">],</span> <span class="p">[</span><span class="n">q</span><span class="p">],</span> <span class="n">Nx</span><span class="p">,</span> <span class="n">dx</span><span class="p">,</span> <span class="n">L</span><span class="p">)</span>

    <span class="n">x_grid</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">Nx</span><span class="p">)</span> <span class="o">*</span> <span class="n">dx</span>

    <span class="n">ax1</span><span class="o">.</span><span class="n">bar</span><span class="p">(</span><span class="n">x_grid</span> <span class="o">-</span> <span class="mf">0.15</span><span class="p">,</span> <span class="n">rho_ngp</span><span class="p">,</span> <span class="n">width</span><span class="o">=</span><span class="mf">0.3</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;NGP&#39;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.7</span><span class="p">)</span>
    <span class="n">ax1</span><span class="o">.</span><span class="n">bar</span><span class="p">(</span><span class="n">x_grid</span> <span class="o">+</span> <span class="mf">0.15</span><span class="p">,</span> <span class="n">rho_cic</span><span class="p">,</span> <span class="n">width</span><span class="o">=</span><span class="mf">0.3</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;CIC&#39;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.7</span><span class="p">)</span>
    <span class="n">ax1</span><span class="o">.</span><span class="n">axvline</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">x_particle</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;red&#39;</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;--&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;ì…ì ìœ„ì¹˜&#39;</span><span class="p">)</span>

    <span class="n">ax1</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;x&#39;</span><span class="p">)</span>
    <span class="n">ax1</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;$\rho$&#39;</span><span class="p">)</span>
    <span class="n">ax1</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;ì „í•˜ í• ë‹¹: NGP vs CIC&#39;</span><span class="p">)</span>
    <span class="n">ax1</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
    <span class="n">ax1</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="kc">True</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.3</span><span class="p">)</span>

    <span class="c1"># (2) ê°€ì¤‘ì¹˜ í•¨ìˆ˜</span>
    <span class="n">ax2</span> <span class="o">=</span> <span class="n">axes</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>

    <span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="o">-</span><span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">200</span><span class="p">)</span>

    <span class="c1"># NGP</span>
    <span class="n">w_ngp</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mf">0.5</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>

    <span class="c1"># CIC</span>
    <span class="n">w_cic</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">x</span><span class="p">),</span> <span class="mi">0</span><span class="p">)</span>

    <span class="c1"># TSC</span>
    <span class="n">w_tsc</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mf">0.5</span><span class="p">,</span> <span class="mf">0.75</span> <span class="o">-</span> <span class="n">x</span><span class="o">**</span><span class="mi">2</span><span class="p">,</span>
                    <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mf">1.5</span><span class="p">,</span> <span class="mf">0.5</span> <span class="o">*</span> <span class="p">(</span><span class="mf">1.5</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">x</span><span class="p">))</span><span class="o">**</span><span class="mi">2</span><span class="p">,</span> <span class="mi">0</span><span class="p">))</span>

    <span class="n">ax2</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">w_ngp</span><span class="p">,</span> <span class="s1">&#39;b-&#39;</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;NGP&#39;</span><span class="p">)</span>
    <span class="n">ax2</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">w_cic</span><span class="p">,</span> <span class="s1">&#39;r-&#39;</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;CIC&#39;</span><span class="p">)</span>
    <span class="n">ax2</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">w_tsc</span><span class="p">,</span> <span class="s1">&#39;g-&#39;</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;TSC&#39;</span><span class="p">)</span>

    <span class="n">ax2</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;$(x - x_i) / \Delta x$&#39;</span><span class="p">)</span>
    <span class="n">ax2</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;Weight W&#39;</span><span class="p">)</span>
    <span class="n">ax2</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;ë³´ê°„ ê°€ì¤‘ì¹˜ í•¨ìˆ˜&#39;</span><span class="p">)</span>
    <span class="n">ax2</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
    <span class="n">ax2</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="kc">True</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.3</span><span class="p">)</span>

    <span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="s1">&#39;pic_interpolation.png&#39;</span><span class="p">,</span> <span class="n">dpi</span><span class="o">=</span><span class="mi">150</span><span class="p">,</span> <span class="n">bbox_inches</span><span class="o">=</span><span class="s1">&#39;tight&#39;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>

<span class="c1"># interpolation_demo()</span>
</code></pre></div>

<hr />
<h2 id="5-1d-pic">5. 1D ì •ì „ê¸° PIC ì‹œë®¬ë ˆì´í„°<a class="header-link" href="#5-1d-pic" title="Permanent link">&para;</a></h2>
<h3 id="51">5.1 ì™„ì „í•œ êµ¬í˜„<a class="header-link" href="#51" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><span class="k">class</span><span class="w"> </span><span class="nc">PIC_1D_Electrostatic</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;1D ì •ì „ê¸° PIC ì‹œë®¬ë ˆì´í„°&quot;&quot;&quot;</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">Nx</span><span class="p">,</span> <span class="n">L</span><span class="p">,</span> <span class="n">dt</span><span class="p">,</span> <span class="n">n_particles</span><span class="p">,</span> <span class="n">species_params</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Parameters:</span>
<span class="sd">        - Nx: ê²©ìì  ìˆ˜</span>
<span class="sd">        - L: ë„ë©”ì¸ í¬ê¸° (ì •ê·œí™”: Î»D ë‹¨ìœ„)</span>
<span class="sd">        - dt: ì‹œê°„ ë‹¨ê³„ (ì •ê·œí™”: Ï‰pe^-1 ë‹¨ìœ„)</span>
<span class="sd">        - n_particles: ì…ì ìˆ˜</span>
<span class="sd">        - species_params: ì¢…ë³„ íŒŒë¼ë¯¸í„° ë¦¬ìŠ¤íŠ¸</span>
<span class="sd">          [{&#39;q&#39;: ì „í•˜, &#39;m&#39;: ì§ˆëŸ‰, &#39;n&#39;: ì…ì ìˆ˜, &#39;vth&#39;: ì—´ì†ë„}]</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">Nx</span> <span class="o">=</span> <span class="n">Nx</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">L</span> <span class="o">=</span> <span class="n">L</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">dx</span> <span class="o">=</span> <span class="n">L</span> <span class="o">/</span> <span class="n">Nx</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">dt</span> <span class="o">=</span> <span class="n">dt</span>

        <span class="c1"># ê²©ì</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">x_grid</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">L</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">dx</span><span class="p">,</span> <span class="n">Nx</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">rho</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">Nx</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">phi</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">Nx</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">E</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">Nx</span><span class="p">)</span>

        <span class="c1"># ì…ì ë°°ì—´</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">x</span> <span class="o">=</span> <span class="p">[]</span>      <span class="c1"># ìœ„ì¹˜</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">v</span> <span class="o">=</span> <span class="p">[]</span>      <span class="c1"># ì†ë„</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">q</span> <span class="o">=</span> <span class="p">[]</span>      <span class="c1"># ì „í•˜</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">m</span> <span class="o">=</span> <span class="p">[]</span>      <span class="c1"># ì§ˆëŸ‰</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">species</span> <span class="o">=</span> <span class="p">[]</span>  <span class="c1"># ì¢… ì¸ë±ìŠ¤</span>

        <span class="c1"># ì¢…ë³„ ì…ì ì´ˆê¸°í™”</span>
        <span class="k">for</span> <span class="n">sp_idx</span><span class="p">,</span> <span class="n">params</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">species_params</span><span class="p">):</span>
            <span class="n">q_sp</span> <span class="o">=</span> <span class="n">params</span><span class="p">[</span><span class="s1">&#39;q&#39;</span><span class="p">]</span>
            <span class="n">m_sp</span> <span class="o">=</span> <span class="n">params</span><span class="p">[</span><span class="s1">&#39;m&#39;</span><span class="p">]</span>
            <span class="n">n_sp</span> <span class="o">=</span> <span class="n">params</span><span class="p">[</span><span class="s1">&#39;n&#39;</span><span class="p">]</span>
            <span class="n">vth_sp</span> <span class="o">=</span> <span class="n">params</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;vth&#39;</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">)</span>
            <span class="n">v_drift</span> <span class="o">=</span> <span class="n">params</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;v_drift&#39;</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">)</span>

            <span class="c1"># ê· ì¼ ë¶„í¬ ìœ„ì¹˜</span>
            <span class="n">x_sp</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">uniform</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">L</span><span class="p">,</span> <span class="n">n_sp</span><span class="p">)</span>

            <span class="c1"># Maxwell ë¶„í¬ ì†ë„ (drift ì¶”ê°€)</span>
            <span class="n">v_sp</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">normal</span><span class="p">(</span><span class="n">v_drift</span><span class="p">,</span> <span class="n">vth_sp</span><span class="p">,</span> <span class="n">n_sp</span><span class="p">)</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">x</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">x_sp</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">v</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">v_sp</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">q</span><span class="o">.</span><span class="n">extend</span><span class="p">([</span><span class="n">q_sp</span><span class="p">]</span> <span class="o">*</span> <span class="n">n_sp</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">m</span><span class="o">.</span><span class="n">extend</span><span class="p">([</span><span class="n">m_sp</span><span class="p">]</span> <span class="o">*</span> <span class="n">n_sp</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">species</span><span class="o">.</span><span class="n">extend</span><span class="p">([</span><span class="n">sp_idx</span><span class="p">]</span> <span class="o">*</span> <span class="n">n_sp</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">x</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">v</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">v</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">q</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">q</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">m</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">m</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">species</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">species</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">n_particles</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">x</span><span class="p">)</span>

        <span class="c1"># ìŠˆí¼ ì…ì ê°€ì¤‘ì¹˜ (ì „í•˜ ë°€ë„ ì •ê·œí™”)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">weight</span> <span class="o">=</span> <span class="n">L</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">n_particles</span>

        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;PIC 1D ì´ˆê¸°í™”:&quot;</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  ê²©ì: Nx = </span><span class="si">{</span><span class="n">Nx</span><span class="si">}</span><span class="s2">, dx = </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">dx</span><span class="si">:</span><span class="s2">.4f</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  ì‹œê°„: dt = </span><span class="si">{</span><span class="n">dt</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  ì…ì: N = </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">n_particles</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">deposit_charge</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;ì „í•˜ í• ë‹¹ (CIC)&quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">rho</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Nx</span><span class="p">)</span>

        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">n_particles</span><span class="p">):</span>
            <span class="n">x</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">x</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">L</span>
            <span class="n">q</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">q</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>

            <span class="n">j</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">x</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">dx</span><span class="p">)</span>
            <span class="n">j_next</span> <span class="o">=</span> <span class="p">(</span><span class="n">j</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">Nx</span>

            <span class="n">frac</span> <span class="o">=</span> <span class="p">(</span><span class="n">x</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">dx</span><span class="p">)</span> <span class="o">-</span> <span class="n">j</span>
            <span class="n">w_left</span> <span class="o">=</span> <span class="mi">1</span> <span class="o">-</span> <span class="n">frac</span>
            <span class="n">w_right</span> <span class="o">=</span> <span class="n">frac</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">rho</span><span class="p">[</span><span class="n">j</span><span class="p">]</span> <span class="o">+=</span> <span class="n">q</span> <span class="o">*</span> <span class="n">w_left</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">weight</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">dx</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">rho</span><span class="p">[</span><span class="n">j_next</span><span class="p">]</span> <span class="o">+=</span> <span class="n">q</span> <span class="o">*</span> <span class="n">w_right</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">weight</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">dx</span>

        <span class="c1"># ë°°ê²½ ì „í•˜ (ì¤‘ì„±í™”)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">rho</span> <span class="o">-=</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">rho</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">solve_field</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Poisson ë°©ì •ì‹ í’€ì´ (FFT)&quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">phi</span> <span class="o">=</span> <span class="n">solve_poisson_1d_periodic</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">rho</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">dx</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">E</span> <span class="o">=</span> <span class="n">electric_field_from_potential</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">phi</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">dx</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">interpolate_field</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;ì¥ ë³´ê°„ (ê²©ì -&gt; ì…ì)&quot;&quot;&quot;</span>
        <span class="n">E_particles</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">n_particles</span><span class="p">)</span>

        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">n_particles</span><span class="p">):</span>
            <span class="n">x</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">x</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">L</span>
            <span class="n">j</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">x</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">dx</span><span class="p">)</span>
            <span class="n">j_next</span> <span class="o">=</span> <span class="p">(</span><span class="n">j</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">Nx</span>

            <span class="n">frac</span> <span class="o">=</span> <span class="p">(</span><span class="n">x</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">dx</span><span class="p">)</span> <span class="o">-</span> <span class="n">j</span>
            <span class="n">w_left</span> <span class="o">=</span> <span class="mi">1</span> <span class="o">-</span> <span class="n">frac</span>
            <span class="n">w_right</span> <span class="o">=</span> <span class="n">frac</span>

            <span class="n">E_particles</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">w_left</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">E</span><span class="p">[</span><span class="n">j</span><span class="p">]</span> <span class="o">+</span> <span class="n">w_right</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">E</span><span class="p">[</span><span class="n">j_next</span><span class="p">]</span>

        <span class="k">return</span> <span class="n">E_particles</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">push_particles</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;ì…ì í‘¸ì‹œ (Leapfrog)&quot;&quot;&quot;</span>
        <span class="n">E_p</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">interpolate_field</span><span class="p">()</span>

        <span class="c1"># ì†ë„ ì—…ë°ì´íŠ¸: v^{n-1/2} -&gt; v^{n+1/2}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">v</span> <span class="o">+=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">q</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">m</span><span class="p">)</span> <span class="o">*</span> <span class="n">E_p</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">dt</span>

        <span class="c1"># ìœ„ì¹˜ ì—…ë°ì´íŠ¸: x^n -&gt; x^{n+1}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">x</span> <span class="o">+=</span> <span class="bp">self</span><span class="o">.</span><span class="n">v</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">dt</span>

        <span class="c1"># ì£¼ê¸°ì  ê²½ê³„</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">x</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">x</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">L</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">compute_diagnostics</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;ì§„ë‹¨ëŸ‰ ê³„ì‚°&quot;&quot;&quot;</span>
        <span class="c1"># ìš´ë™ ì—ë„ˆì§€</span>
        <span class="n">KE</span> <span class="o">=</span> <span class="mf">0.5</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">m</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">v</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">weight</span>

        <span class="c1"># ì „ê¸°ì¥ ì—ë„ˆì§€ (ì •ì „ê¸°)</span>
        <span class="n">FE</span> <span class="o">=</span> <span class="mf">0.5</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">E</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">dx</span>

        <span class="c1"># ì´ ì—ë„ˆì§€</span>
        <span class="n">TE</span> <span class="o">=</span> <span class="n">KE</span> <span class="o">+</span> <span class="n">FE</span>

        <span class="k">return</span> <span class="p">{</span><span class="s1">&#39;KE&#39;</span><span class="p">:</span> <span class="n">KE</span><span class="p">,</span> <span class="s1">&#39;FE&#39;</span><span class="p">:</span> <span class="n">FE</span><span class="p">,</span> <span class="s1">&#39;TE&#39;</span><span class="p">:</span> <span class="n">TE</span><span class="p">}</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">step</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;í•œ ì‹œê°„ ë‹¨ê³„&quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">deposit_charge</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">solve_field</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">push_particles</span><span class="p">()</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">run</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">n_steps</span><span class="p">,</span> <span class="n">diag_interval</span><span class="o">=</span><span class="mi">10</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;ì‹œë®¬ë ˆì´ì…˜ ì‹¤í–‰&quot;&quot;&quot;</span>
        <span class="n">diagnostics</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;t&#39;</span><span class="p">:</span> <span class="p">[],</span> <span class="s1">&#39;KE&#39;</span><span class="p">:</span> <span class="p">[],</span> <span class="s1">&#39;FE&#39;</span><span class="p">:</span> <span class="p">[],</span> <span class="s1">&#39;TE&#39;</span><span class="p">:</span> <span class="p">[]}</span>

        <span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n_steps</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">n</span> <span class="o">%</span> <span class="n">diag_interval</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">diag</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">compute_diagnostics</span><span class="p">()</span>
                <span class="n">diagnostics</span><span class="p">[</span><span class="s1">&#39;t&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">n</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">dt</span><span class="p">)</span>
                <span class="n">diagnostics</span><span class="p">[</span><span class="s1">&#39;KE&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">diag</span><span class="p">[</span><span class="s1">&#39;KE&#39;</span><span class="p">])</span>
                <span class="n">diagnostics</span><span class="p">[</span><span class="s1">&#39;FE&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">diag</span><span class="p">[</span><span class="s1">&#39;FE&#39;</span><span class="p">])</span>
                <span class="n">diagnostics</span><span class="p">[</span><span class="s1">&#39;TE&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">diag</span><span class="p">[</span><span class="s1">&#39;TE&#39;</span><span class="p">])</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">step</span><span class="p">()</span>

        <span class="k">return</span> <span class="p">{</span><span class="n">k</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">v</span><span class="p">)</span> <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">diagnostics</span><span class="o">.</span><span class="n">items</span><span class="p">()}</span>
</code></pre></div>

<h3 id="52-langmuir">5.2 Langmuir íŒŒ í…ŒìŠ¤íŠ¸<a class="header-link" href="#52-langmuir" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">langmuir_wave_test</span><span class="p">():</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Langmuir íŒŒ (ì „ì í”Œë¼ì¦ˆë§ˆ íŒŒ) í…ŒìŠ¤íŠ¸&quot;&quot;&quot;</span>

    <span class="c1"># ì„¤ì • (ì •ê·œí™” ë‹¨ìœ„)</span>
    <span class="n">Nx</span> <span class="o">=</span> <span class="mi">64</span>
    <span class="n">L</span> <span class="o">=</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span> <span class="o">*</span> <span class="mi">4</span>  <span class="c1"># 4 íŒŒì¥</span>
    <span class="n">dt</span> <span class="o">=</span> <span class="mf">0.1</span>           <span class="c1"># Ï‰pe^-1 ë‹¨ìœ„</span>

    <span class="c1"># ì „ì (ì´ì˜¨ì€ ê³ ì • ë°°ê²½)</span>
    <span class="n">n_electrons</span> <span class="o">=</span> <span class="mi">10000</span>
    <span class="n">vth</span> <span class="o">=</span> <span class="mf">1.0</span>  <span class="c1"># ì—´ì†ë„ (ì •ê·œí™”)</span>

    <span class="n">species</span> <span class="o">=</span> <span class="p">[</span>
        <span class="p">{</span><span class="s1">&#39;q&#39;</span><span class="p">:</span> <span class="o">-</span><span class="mf">1.0</span><span class="p">,</span> <span class="s1">&#39;m&#39;</span><span class="p">:</span> <span class="mf">1.0</span><span class="p">,</span> <span class="s1">&#39;n&#39;</span><span class="p">:</span> <span class="n">n_electrons</span><span class="p">,</span> <span class="s1">&#39;vth&#39;</span><span class="p">:</span> <span class="n">vth</span><span class="p">,</span> <span class="s1">&#39;v_drift&#39;</span><span class="p">:</span> <span class="mf">0.0</span><span class="p">}</span>
    <span class="p">]</span>

    <span class="c1"># ì‹œë®¬ë ˆì´í„° ìƒì„±</span>
    <span class="n">pic</span> <span class="o">=</span> <span class="n">PIC_1D_Electrostatic</span><span class="p">(</span><span class="n">Nx</span><span class="p">,</span> <span class="n">L</span><span class="p">,</span> <span class="n">dt</span><span class="p">,</span> <span class="n">n_electrons</span><span class="p">,</span> <span class="n">species</span><span class="p">)</span>

    <span class="c1"># ì´ˆê¸° ì„­ë™ (ë°€ë„ íŒŒ)</span>
    <span class="n">k</span> <span class="o">=</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span> <span class="o">/</span> <span class="p">(</span><span class="n">L</span> <span class="o">/</span> <span class="mi">4</span><span class="p">)</span>  <span class="c1"># íŒŒìˆ˜ (4íŒŒì¥)</span>
    <span class="n">amplitude</span> <span class="o">=</span> <span class="mf">0.01</span>

    <span class="c1"># ìœ„ì¹˜ ì„­ë™</span>
    <span class="n">pic</span><span class="o">.</span><span class="n">x</span> <span class="o">+=</span> <span class="n">amplitude</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">k</span> <span class="o">*</span> <span class="n">pic</span><span class="o">.</span><span class="n">x</span><span class="p">)</span> <span class="o">/</span> <span class="n">k</span>

    <span class="c1"># ì‹œë®¬ë ˆì´ì…˜ ì‹¤í–‰</span>
    <span class="n">n_steps</span> <span class="o">=</span> <span class="mi">500</span>
    <span class="n">diagnostics</span> <span class="o">=</span> <span class="n">pic</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">n_steps</span><span class="p">,</span> <span class="n">diag_interval</span><span class="o">=</span><span class="mi">5</span><span class="p">)</span>

    <span class="c1"># ì‹œê°í™”</span>
    <span class="n">fig</span><span class="p">,</span> <span class="n">axes</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">12</span><span class="p">,</span> <span class="mi">10</span><span class="p">))</span>

    <span class="c1"># (1) ì—ë„ˆì§€ ì‹œê°„ ì „ê°œ</span>
    <span class="n">ax1</span> <span class="o">=</span> <span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span>
    <span class="n">t</span> <span class="o">=</span> <span class="n">diagnostics</span><span class="p">[</span><span class="s1">&#39;t&#39;</span><span class="p">]</span>
    <span class="n">ax1</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="n">diagnostics</span><span class="p">[</span><span class="s1">&#39;KE&#39;</span><span class="p">],</span> <span class="s1">&#39;b-&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;ìš´ë™ ì—ë„ˆì§€&#39;</span><span class="p">)</span>
    <span class="n">ax1</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="n">diagnostics</span><span class="p">[</span><span class="s1">&#39;FE&#39;</span><span class="p">],</span> <span class="s1">&#39;r-&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;ì „ê¸°ì¥ ì—ë„ˆì§€&#39;</span><span class="p">)</span>
    <span class="n">ax1</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="n">diagnostics</span><span class="p">[</span><span class="s1">&#39;TE&#39;</span><span class="p">],</span> <span class="s1">&#39;k--&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;ì´ ì—ë„ˆì§€&#39;</span><span class="p">)</span>
    <span class="n">ax1</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;t [$\omega_</span><span class="si">{pe}</span><span class="s1">^{-1}$]&#39;</span><span class="p">)</span>
    <span class="n">ax1</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;Energy&#39;</span><span class="p">)</span>
    <span class="n">ax1</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;ì—ë„ˆì§€ ì‹œê°„ ì „ê°œ&#39;</span><span class="p">)</span>
    <span class="n">ax1</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
    <span class="n">ax1</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="kc">True</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.3</span><span class="p">)</span>

    <span class="c1"># (2) ì „ê¸°ì¥ ì—ë„ˆì§€ (ë¡œê·¸ ìŠ¤ì¼€ì¼, ì§„ë™ í™•ì¸)</span>
    <span class="n">ax2</span> <span class="o">=</span> <span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span>
    <span class="n">ax2</span><span class="o">.</span><span class="n">semilogy</span><span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="n">diagnostics</span><span class="p">[</span><span class="s1">&#39;FE&#39;</span><span class="p">],</span> <span class="s1">&#39;r-&#39;</span><span class="p">)</span>
    <span class="n">ax2</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;t [$\omega_</span><span class="si">{pe}</span><span class="s1">^{-1}$]&#39;</span><span class="p">)</span>
    <span class="n">ax2</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;Field Energy&#39;</span><span class="p">)</span>
    <span class="n">ax2</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;ì „ê¸°ì¥ ì—ë„ˆì§€ (Langmuir ì§„ë™)&#39;</span><span class="p">)</span>
    <span class="n">ax2</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="kc">True</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.3</span><span class="p">)</span>

    <span class="c1"># (3) ìœ„ìƒ ê³µê°„</span>
    <span class="n">ax3</span> <span class="o">=</span> <span class="n">axes</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span>
    <span class="n">ax3</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">pic</span><span class="o">.</span><span class="n">x</span><span class="p">,</span> <span class="n">pic</span><span class="o">.</span><span class="n">v</span><span class="p">,</span> <span class="n">s</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.5</span><span class="p">)</span>
    <span class="n">ax3</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;x&#39;</span><span class="p">)</span>
    <span class="n">ax3</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;v&#39;</span><span class="p">)</span>
    <span class="n">ax3</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;ìœ„ìƒ ê³µê°„ (t = </span><span class="si">{</span><span class="n">n_steps</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">dt</span><span class="si">:</span><span class="s1">.1f</span><span class="si">}</span><span class="s1">)&#39;</span><span class="p">)</span>
    <span class="n">ax3</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="kc">True</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.3</span><span class="p">)</span>

    <span class="c1"># (4) ì „í•˜ ë°€ë„</span>
    <span class="n">ax4</span> <span class="o">=</span> <span class="n">axes</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span>
    <span class="n">pic</span><span class="o">.</span><span class="n">deposit_charge</span><span class="p">()</span>
    <span class="n">ax4</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">pic</span><span class="o">.</span><span class="n">x_grid</span><span class="p">,</span> <span class="n">pic</span><span class="o">.</span><span class="n">rho</span><span class="p">,</span> <span class="s1">&#39;b-&#39;</span><span class="p">)</span>
    <span class="n">ax4</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;x&#39;</span><span class="p">)</span>
    <span class="n">ax4</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;$\rho$&#39;</span><span class="p">)</span>
    <span class="n">ax4</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;ì „í•˜ ë°€ë„&#39;</span><span class="p">)</span>
    <span class="n">ax4</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="kc">True</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.3</span><span class="p">)</span>

    <span class="n">plt</span><span class="o">.</span><span class="n">suptitle</span><span class="p">(</span><span class="s1">&#39;Langmuir íŒŒ í…ŒìŠ¤íŠ¸&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">14</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="s1">&#39;langmuir_wave.png&#39;</span><span class="p">,</span> <span class="n">dpi</span><span class="o">=</span><span class="mi">150</span><span class="p">,</span> <span class="n">bbox_inches</span><span class="o">=</span><span class="s1">&#39;tight&#39;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>

    <span class="c1"># ì§„ë™ìˆ˜ ë¶„ì„</span>
    <span class="kn">from</span><span class="w"> </span><span class="nn">scipy.signal</span><span class="w"> </span><span class="kn">import</span> <span class="n">find_peaks</span>

    <span class="n">FE</span> <span class="o">=</span> <span class="n">diagnostics</span><span class="p">[</span><span class="s1">&#39;FE&#39;</span><span class="p">]</span>
    <span class="n">peaks</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">find_peaks</span><span class="p">(</span><span class="n">FE</span><span class="p">)</span>

    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">peaks</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
        <span class="n">T_measured</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">diff</span><span class="p">(</span><span class="n">t</span><span class="p">[</span><span class="n">peaks</span><span class="p">]))</span>
        <span class="n">omega_measured</span> <span class="o">=</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span> <span class="o">/</span> <span class="n">T_measured</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">ì¸¡ì •ëœ ì§„ë™ìˆ˜: Ï‰ = </span><span class="si">{</span><span class="n">omega_measured</span><span class="si">:</span><span class="s2">.3f</span><span class="si">}</span><span class="s2"> Ï‰pe&quot;</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;ì´ë¡ ê°’: Ï‰ â‰ˆ Ï‰pe = 1.0 (kâ†’0 í•œê³„)&quot;</span><span class="p">)</span>

<span class="c1"># langmuir_wave_test()</span>
</code></pre></div>

<hr />
<h2 id="6-two-stream">6. Two-Stream ë¶ˆì•ˆì •ì„±<a class="header-link" href="#6-two-stream" title="Permanent link">&para;</a></h2>
<h3 id="61">6.1 ë¬¼ë¦¬ì  ë°°ê²½<a class="header-link" href="#61" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code>Two-Stream ë¶ˆì•ˆì •ì„±:

ì„¤ì •:
- ë‘ ì „ì ë¹”ì´ ë°˜ëŒ€ ë°©í–¥ìœ¼ë¡œ ì´ë™
- ì´ì˜¨ì€ ê³ ì • ë°°ê²½

ë¶„ì‚° ê´€ê³„:
1 = Ï‰peÂ²/2 Ã— [1/(Ï‰ - kvâ‚€)Â² + 1/(Ï‰ + kvâ‚€)Â²]

ë¶ˆì•ˆì • ì¡°ê±´:
k &lt; kc = Ï‰pe/vâ‚€

ì„±ì¥ë¥  (ìµœëŒ€):
Î³max â‰ˆ âˆš3/2 Ã— Ï‰pe (at k = Ï‰pe/vâ‚€)

ë¬¼ë¦¬ì  ê²°ê³¼:
- ì§€ìˆ˜ì  ì¥ ì„±ì¥
- ì…ì íŠ¸ë˜í•‘ (ìœ„ìƒ ê³µê°„ ì™€ë¥˜)
- ì—´í™” (thermalization)
</code></pre></div>

<div class="highlight"><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">two_stream_instability</span><span class="p">():</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Two-Stream ë¶ˆì•ˆì •ì„± ì‹œë®¬ë ˆì´ì…˜&quot;&quot;&quot;</span>

    <span class="c1"># ì„¤ì •</span>
    <span class="n">Nx</span> <span class="o">=</span> <span class="mi">128</span>
    <span class="n">L</span> <span class="o">=</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span> <span class="o">*</span> <span class="mi">8</span>  <span class="c1"># 8 íŒŒì¥</span>
    <span class="n">dt</span> <span class="o">=</span> <span class="mf">0.1</span>

    <span class="c1"># ë‘ ì „ì ë¹”</span>
    <span class="n">n_per_beam</span> <span class="o">=</span> <span class="mi">20000</span>
    <span class="n">vth</span> <span class="o">=</span> <span class="mf">0.1</span>  <span class="c1"># ì‘ì€ ì—´ì†ë„</span>
    <span class="n">v_drift</span> <span class="o">=</span> <span class="mf">3.0</span>  <span class="c1"># ë“œë¦¬í”„íŠ¸ ì†ë„</span>

    <span class="n">species</span> <span class="o">=</span> <span class="p">[</span>
        <span class="c1"># ë¹” 1 (ì˜¤ë¥¸ìª½ ì´ë™)</span>
        <span class="p">{</span><span class="s1">&#39;q&#39;</span><span class="p">:</span> <span class="o">-</span><span class="mf">1.0</span><span class="p">,</span> <span class="s1">&#39;m&#39;</span><span class="p">:</span> <span class="mf">1.0</span><span class="p">,</span> <span class="s1">&#39;n&#39;</span><span class="p">:</span> <span class="n">n_per_beam</span><span class="p">,</span> <span class="s1">&#39;vth&#39;</span><span class="p">:</span> <span class="n">vth</span><span class="p">,</span> <span class="s1">&#39;v_drift&#39;</span><span class="p">:</span> <span class="n">v_drift</span><span class="p">},</span>
        <span class="c1"># ë¹” 2 (ì™¼ìª½ ì´ë™)</span>
        <span class="p">{</span><span class="s1">&#39;q&#39;</span><span class="p">:</span> <span class="o">-</span><span class="mf">1.0</span><span class="p">,</span> <span class="s1">&#39;m&#39;</span><span class="p">:</span> <span class="mf">1.0</span><span class="p">,</span> <span class="s1">&#39;n&#39;</span><span class="p">:</span> <span class="n">n_per_beam</span><span class="p">,</span> <span class="s1">&#39;vth&#39;</span><span class="p">:</span> <span class="n">vth</span><span class="p">,</span> <span class="s1">&#39;v_drift&#39;</span><span class="p">:</span> <span class="o">-</span><span class="n">v_drift</span><span class="p">}</span>
    <span class="p">]</span>

    <span class="c1"># ì‹œë®¬ë ˆì´í„° ìƒì„±</span>
    <span class="n">pic</span> <span class="o">=</span> <span class="n">PIC_1D_Electrostatic</span><span class="p">(</span><span class="n">Nx</span><span class="p">,</span> <span class="n">L</span><span class="p">,</span> <span class="n">dt</span><span class="p">,</span> <span class="n">n_per_beam</span> <span class="o">*</span> <span class="mi">2</span><span class="p">,</span> <span class="n">species</span><span class="p">)</span>

    <span class="c1"># ì‘ì€ ì´ˆê¸° ì„­ë™</span>
    <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">seed</span><span class="p">(</span><span class="mi">42</span><span class="p">)</span>
    <span class="n">pic</span><span class="o">.</span><span class="n">x</span> <span class="o">+=</span> <span class="mf">0.001</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">randn</span><span class="p">(</span><span class="n">pic</span><span class="o">.</span><span class="n">n_particles</span><span class="p">)</span>
    <span class="n">pic</span><span class="o">.</span><span class="n">x</span> <span class="o">=</span> <span class="n">pic</span><span class="o">.</span><span class="n">x</span> <span class="o">%</span> <span class="n">L</span>

    <span class="c1"># ì‹œë®¬ë ˆì´ì…˜</span>
    <span class="n">n_steps</span> <span class="o">=</span> <span class="mi">600</span>
    <span class="n">diag_interval</span> <span class="o">=</span> <span class="mi">5</span>

    <span class="c1"># ìœ„ìƒ ê³µê°„ ìŠ¤ëƒ…ìƒ· ì €ì¥</span>
    <span class="n">snapshots</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">snapshot_times</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">100</span><span class="p">,</span> <span class="mi">200</span><span class="p">,</span> <span class="mi">300</span><span class="p">,</span> <span class="mi">400</span><span class="p">,</span> <span class="mi">500</span><span class="p">]</span>

    <span class="n">diagnostics</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;t&#39;</span><span class="p">:</span> <span class="p">[],</span> <span class="s1">&#39;FE&#39;</span><span class="p">:</span> <span class="p">[]}</span>

    <span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n_steps</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">n</span> <span class="o">%</span> <span class="n">diag_interval</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">pic</span><span class="o">.</span><span class="n">deposit_charge</span><span class="p">()</span>
            <span class="n">pic</span><span class="o">.</span><span class="n">solve_field</span><span class="p">()</span>
            <span class="n">FE</span> <span class="o">=</span> <span class="mf">0.5</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">pic</span><span class="o">.</span><span class="n">E</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span> <span class="o">*</span> <span class="n">pic</span><span class="o">.</span><span class="n">dx</span>
            <span class="n">diagnostics</span><span class="p">[</span><span class="s1">&#39;t&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">n</span> <span class="o">*</span> <span class="n">dt</span><span class="p">)</span>
            <span class="n">diagnostics</span><span class="p">[</span><span class="s1">&#39;FE&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">FE</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">n</span> <span class="ow">in</span> <span class="n">snapshot_times</span><span class="p">:</span>
            <span class="n">snapshots</span><span class="o">.</span><span class="n">append</span><span class="p">({</span>
                <span class="s1">&#39;t&#39;</span><span class="p">:</span> <span class="n">n</span> <span class="o">*</span> <span class="n">dt</span><span class="p">,</span>
                <span class="s1">&#39;x&#39;</span><span class="p">:</span> <span class="n">pic</span><span class="o">.</span><span class="n">x</span><span class="o">.</span><span class="n">copy</span><span class="p">(),</span>
                <span class="s1">&#39;v&#39;</span><span class="p">:</span> <span class="n">pic</span><span class="o">.</span><span class="n">v</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
            <span class="p">})</span>

        <span class="n">pic</span><span class="o">.</span><span class="n">step</span><span class="p">()</span>

    <span class="n">diagnostics</span> <span class="o">=</span> <span class="p">{</span><span class="n">k</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">v</span><span class="p">)</span> <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">diagnostics</span><span class="o">.</span><span class="n">items</span><span class="p">()}</span>

    <span class="c1"># ì‹œê°í™”</span>
    <span class="n">fig</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">16</span><span class="p">,</span> <span class="mi">12</span><span class="p">))</span>

    <span class="c1"># ìœ„ìƒ ê³µê°„ ìŠ¤ëƒ…ìƒ·</span>
    <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">snap</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">snapshots</span><span class="p">):</span>
        <span class="n">ax</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">snap</span><span class="p">[</span><span class="s1">&#39;x&#39;</span><span class="p">],</span> <span class="n">snap</span><span class="p">[</span><span class="s1">&#39;v&#39;</span><span class="p">],</span> <span class="n">s</span><span class="o">=</span><span class="mf">0.2</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.3</span><span class="p">,</span> <span class="n">c</span><span class="o">=</span><span class="s1">&#39;blue&#39;</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;x&#39;</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;v&#39;</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;t = </span><span class="si">{</span><span class="n">snap</span><span class="p">[</span><span class="s1">&#39;t&#39;</span><span class="p">]</span><span class="si">:</span><span class="s2">.0f</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">L</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">(</span><span class="o">-</span><span class="mi">8</span><span class="p">,</span> <span class="mi">8</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="kc">True</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.3</span><span class="p">)</span>

    <span class="n">plt</span><span class="o">.</span><span class="n">suptitle</span><span class="p">(</span><span class="s1">&#39;Two-Stream ë¶ˆì•ˆì •ì„±: ìœ„ìƒ ê³µê°„ ì „ê°œ&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">14</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="s1">&#39;two_stream_phase_space.png&#39;</span><span class="p">,</span> <span class="n">dpi</span><span class="o">=</span><span class="mi">150</span><span class="p">,</span> <span class="n">bbox_inches</span><span class="o">=</span><span class="s1">&#39;tight&#39;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>

    <span class="c1"># ì—ë„ˆì§€ ë° ì„±ì¥ë¥ </span>
    <span class="n">fig</span><span class="p">,</span> <span class="n">axes</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">14</span><span class="p">,</span> <span class="mi">5</span><span class="p">))</span>

    <span class="c1"># ì „ê¸°ì¥ ì—ë„ˆì§€ (ë¡œê·¸)</span>
    <span class="n">ax1</span> <span class="o">=</span> <span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    <span class="n">t</span> <span class="o">=</span> <span class="n">diagnostics</span><span class="p">[</span><span class="s1">&#39;t&#39;</span><span class="p">]</span>
    <span class="n">FE</span> <span class="o">=</span> <span class="n">diagnostics</span><span class="p">[</span><span class="s1">&#39;FE&#39;</span><span class="p">]</span>

    <span class="n">ax1</span><span class="o">.</span><span class="n">semilogy</span><span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="n">FE</span><span class="p">,</span> <span class="s1">&#39;b-&#39;</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mf">1.5</span><span class="p">)</span>

    <span class="c1"># ì„ í˜• ì„±ì¥ ì˜ì—­ í”¼íŒ…</span>
    <span class="n">linear_region</span> <span class="o">=</span> <span class="p">(</span><span class="n">t</span> <span class="o">&gt;</span> <span class="mi">10</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">t</span> <span class="o">&lt;</span> <span class="mi">35</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">any</span><span class="p">(</span><span class="n">linear_region</span><span class="p">)</span> <span class="ow">and</span> <span class="n">np</span><span class="o">.</span><span class="n">any</span><span class="p">(</span><span class="n">FE</span><span class="p">[</span><span class="n">linear_region</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">):</span>
        <span class="n">log_FE</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">FE</span><span class="p">[</span><span class="n">linear_region</span><span class="p">])</span>
        <span class="n">t_fit</span> <span class="o">=</span> <span class="n">t</span><span class="p">[</span><span class="n">linear_region</span><span class="p">]</span>
        <span class="n">coeffs</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">polyfit</span><span class="p">(</span><span class="n">t_fit</span><span class="p">,</span> <span class="n">log_FE</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
        <span class="n">gamma_measured</span> <span class="o">=</span> <span class="n">coeffs</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">/</span> <span class="mi">2</span>  <span class="c1"># FE âˆ exp(2Î³t)</span>

        <span class="n">ax1</span><span class="o">.</span><span class="n">semilogy</span><span class="p">(</span><span class="n">t_fit</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">polyval</span><span class="p">(</span><span class="n">coeffs</span><span class="p">,</span> <span class="n">t_fit</span><span class="p">)),</span> <span class="s1">&#39;r--&#39;</span><span class="p">,</span>
                    <span class="n">linewidth</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="sa">f</span><span class="s1">&#39;Fit: Î³ = </span><span class="si">{</span><span class="n">gamma_measured</span><span class="si">:</span><span class="s1">.3f</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
        <span class="n">ax1</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>

    <span class="n">ax1</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;t [$\omega_</span><span class="si">{pe}</span><span class="s1">^{-1}$]&#39;</span><span class="p">)</span>
    <span class="n">ax1</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;Field Energy&#39;</span><span class="p">)</span>
    <span class="n">ax1</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;ì „ê¸°ì¥ ì—ë„ˆì§€ ì„±ì¥&#39;</span><span class="p">)</span>
    <span class="n">ax1</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="kc">True</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.3</span><span class="p">)</span>

    <span class="c1"># ì´ë¡ ì  ì„±ì¥ë¥ </span>
    <span class="n">ax2</span> <span class="o">=</span> <span class="n">axes</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>

    <span class="n">k</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mf">0.01</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">100</span><span class="p">)</span>
    <span class="c1"># ê·¼ì‚¬ ë¶„ì‚° ê´€ê³„ì—ì„œì˜ ì„±ì¥ë¥  (ìµœëŒ€ ì„±ì¥)</span>
    <span class="c1"># Î³ â‰ˆ Ï‰pe Ã— âˆš(3)/2 Ã— (k vâ‚€/Ï‰pe)^(1/3) for small k</span>
    <span class="n">gamma_theory</span> <span class="o">=</span> <span class="mf">0.866</span>  <span class="c1"># âˆš3/2</span>

    <span class="n">ax2</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="mf">0.5</span><span class="p">,</span> <span class="mf">0.7</span><span class="p">,</span> <span class="sa">f</span><span class="s1">&#39;ì´ë¡ ì  ìµœëŒ€ ì„±ì¥ë¥ :</span><span class="se">\n</span><span class="s1">Î³max â‰ˆ (âˆš3/2)Ï‰pe â‰ˆ </span><span class="si">{</span><span class="n">gamma_theory</span><span class="si">:</span><span class="s1">.3f</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">,</span>
            <span class="n">transform</span><span class="o">=</span><span class="n">ax2</span><span class="o">.</span><span class="n">transAxes</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">12</span><span class="p">,</span>
            <span class="n">bbox</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">boxstyle</span><span class="o">=</span><span class="s1">&#39;round&#39;</span><span class="p">,</span> <span class="n">facecolor</span><span class="o">=</span><span class="s1">&#39;wheat&#39;</span><span class="p">))</span>

    <span class="n">ax2</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="mf">0.5</span><span class="p">,</span> <span class="mf">0.4</span><span class="p">,</span> <span class="sa">f</span><span class="s1">&#39;ì¸¡ì •ëœ ì„±ì¥ë¥ :</span><span class="se">\n</span><span class="s1">Î³ â‰ˆ </span><span class="si">{</span><span class="n">gamma_measured</span><span class="si">:</span><span class="s1">.3f</span><span class="si">}</span><span class="s1">&#39;</span> <span class="k">if</span> <span class="s1">&#39;gamma_measured&#39;</span> <span class="ow">in</span> <span class="nb">dir</span><span class="p">()</span> <span class="k">else</span> <span class="s1">&#39;&#39;</span><span class="p">,</span>
            <span class="n">transform</span><span class="o">=</span><span class="n">ax2</span><span class="o">.</span><span class="n">transAxes</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">12</span><span class="p">,</span>
            <span class="n">bbox</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">boxstyle</span><span class="o">=</span><span class="s1">&#39;round&#39;</span><span class="p">,</span> <span class="n">facecolor</span><span class="o">=</span><span class="s1">&#39;lightgreen&#39;</span><span class="p">))</span>

    <span class="n">ax2</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="mf">0.1</span><span class="p">,</span> <span class="mf">0.1</span><span class="p">,</span> <span class="s2">&quot;&quot;&quot;</span>
<span class="s2">Two-Stream ë¶ˆì•ˆì •ì„± íŠ¹ì„±:</span>
<span class="s2">1. ì„ í˜• ë‹¨ê³„: ì§€ìˆ˜ì  ì„±ì¥</span>
<span class="s2">2. ë¹„ì„ í˜• ë‹¨ê³„: ì…ì íŠ¸ë˜í•‘</span>
<span class="s2">3. í¬í™” ë‹¨ê³„: ì—´í™” (thermalization)</span>
<span class="s2">    &quot;&quot;&quot;</span><span class="p">,</span> <span class="n">transform</span><span class="o">=</span><span class="n">ax2</span><span class="o">.</span><span class="n">transAxes</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="n">verticalalignment</span><span class="o">=</span><span class="s1">&#39;bottom&#39;</span><span class="p">)</span>

    <span class="n">ax2</span><span class="o">.</span><span class="n">axis</span><span class="p">(</span><span class="s1">&#39;off&#39;</span><span class="p">)</span>
    <span class="n">ax2</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;ë¶ˆì•ˆì •ì„± ë¶„ì„&#39;</span><span class="p">)</span>

    <span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="s1">&#39;two_stream_analysis.png&#39;</span><span class="p">,</span> <span class="n">dpi</span><span class="o">=</span><span class="mi">150</span><span class="p">,</span> <span class="n">bbox_inches</span><span class="o">=</span><span class="s1">&#39;tight&#39;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>

    <span class="k">return</span> <span class="n">pic</span><span class="p">,</span> <span class="n">diagnostics</span>

<span class="c1"># pic, diagnostics = two_stream_instability()</span>
</code></pre></div>

<hr />
<h2 id="7">7. ê³ ê¸‰ ì£¼ì œ<a class="header-link" href="#7" title="Permanent link">&para;</a></h2>
<h3 id="71-pic">7.1 ì „ìê¸° PIC<a class="header-link" href="#71-pic" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code>ì „ìê¸° PIC í™•ì¥:

ì¶”ê°€ ë¬¼ë¦¬:
- ìê¸°ì¥ (B) ê³ ë ¤
- ì „ì²´ Maxwell ë°©ì •ì‹ í’€ì´
- ìƒëŒ€ë¡ ì  ì…ì ìš´ë™

Maxwell ë°©ì •ì‹:
âˆ‚B/âˆ‚t = -âˆ‡Ã—E
âˆ‚E/âˆ‚t = cÂ²âˆ‡Ã—B - J/Îµâ‚€

ì „ë¥˜ í• ë‹¹:
J = Î£áµ¢ qáµ¢váµ¢ Ã— (ë³´ê°„ ê°€ì¤‘ì¹˜)

ì‹œê°„ ì „ì§„:
- E, B: FDTD ìœ ì‚¬
- ì…ì: ìƒëŒ€ë¡ ì  Boris ì•Œê³ ë¦¬ì¦˜

ì‘ìš©:
- ë ˆì´ì €-í”Œë¼ì¦ˆë§ˆ ìƒí˜¸ì‘ìš©
- ìƒëŒ€ë¡ ì  ì¶©ê²©íŒŒ
- ì…ì ê°€ì†
</code></pre></div>

<div class="highlight"><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">em_pic_overview</span><span class="p">():</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;ì „ìê¸° PIC ê°œìš”&quot;&quot;&quot;</span>

    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;=&quot;</span> <span class="o">*</span> <span class="mi">60</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;ì „ìê¸° PIC (Electromagnetic PIC)&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;=&quot;</span> <span class="o">*</span> <span class="mi">60</span><span class="p">)</span>

    <span class="n">overview</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot;</span>
<span class="s2">    ì „ìê¸° PIC ì•Œê³ ë¦¬ì¦˜:</span>

<span class="s2">    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”</span>
<span class="s2">    â”‚ ì‹œê°„ ë‹¨ê³„ n â†’ n+1                                       â”‚</span>
<span class="s2">    â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤</span>
<span class="s2">    â”‚                                                         â”‚</span>
<span class="s2">    â”‚ 1. B^n â†’ B^{n+1/2} (ë°˜ë‹¨ê³„)                             â”‚</span>
<span class="s2">    â”‚    B^{n+1/2} = B^n - (Î”t/2)âˆ‡Ã—E^n                        â”‚</span>
<span class="s2">    â”‚                                                         â”‚</span>
<span class="s2">    â”‚ 2. ì…ì í‘¸ì‹œ: (x^n, v^{n-1/2}) â†’ (x^{n+1}, v^{n+1/2})  â”‚</span>
<span class="s2">    â”‚    - ë³´ê°„: E^n, B^{n+1/2} â†’ ì…ì                        â”‚</span>
<span class="s2">    â”‚    - Boris: ê°€ì† ë° íšŒì „                                â”‚</span>
<span class="s2">    â”‚    - ìœ„ì¹˜ ì—…ë°ì´íŠ¸                                      â”‚</span>
<span class="s2">    â”‚                                                         â”‚</span>
<span class="s2">    â”‚ 3. ì „ë¥˜ í• ë‹¹: J^{n+1/2}                                 â”‚</span>
<span class="s2">    â”‚    Esirkepov (ì „í•˜ ë³´ì¡´) ë˜ëŠ” Villasenor-Buneman       â”‚</span>
<span class="s2">    â”‚                                                         â”‚</span>
<span class="s2">    â”‚ 4. E ì—…ë°ì´íŠ¸: E^n â†’ E^{n+1}                            â”‚</span>
<span class="s2">    â”‚    E^{n+1} = E^n + Î”t(cÂ²âˆ‡Ã—B^{n+1/2} - J^{n+1/2}/Îµâ‚€)    â”‚</span>
<span class="s2">    â”‚                                                         â”‚</span>
<span class="s2">    â”‚ 5. B^{n+1/2} â†’ B^{n+1} (ë°˜ë‹¨ê³„)                         â”‚</span>
<span class="s2">    â”‚    B^{n+1} = B^{n+1/2} - (Î”t/2)âˆ‡Ã—E^{n+1}               â”‚</span>
<span class="s2">    â”‚                                                         â”‚</span>
<span class="s2">    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜</span>

<span class="s2">    ì½”ë“œ ì˜ˆì‹œ:</span>
<span class="s2">    - EPOCH (ì˜êµ­)</span>
<span class="s2">    - OSIRIS (UCLA/IST)</span>
<span class="s2">    - SMILEI (í”„ë‘ìŠ¤)</span>
<span class="s2">    - WarpX (LBNL)</span>
<span class="s2">    &quot;&quot;&quot;</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">overview</span><span class="p">)</span>

<span class="n">em_pic_overview</span><span class="p">()</span>
</code></pre></div>

<hr />
<h2 id="8">8. ì—°ìŠµ ë¬¸ì œ<a class="header-link" href="#8" title="Permanent link">&para;</a></h2>
<h3 id="1-boris">ì—°ìŠµ 1: Boris ì•Œê³ ë¦¬ì¦˜<a class="header-link" href="#1-boris" title="Permanent link">&para;</a></h3>
<p>ê· ì¼ ì „ê¸°ì¥ E = Eâ‚€x ì™€ ìê¸°ì¥ B = Bâ‚€z ì—ì„œì˜ ì…ì ìš´ë™ì„ ì‹œë®¬ë ˆì´ì…˜í•˜ì‹œì˜¤. EÃ—B ë“œë¦¬í”„íŠ¸ë¥¼ í™•ì¸í•˜ì‹œì˜¤.</p>
<h3 id="2-cic-vs-ngp">ì—°ìŠµ 2: CIC vs NGP<a class="header-link" href="#2-cic-vs-ngp" title="Permanent link">&para;</a></h3>
<p>ê°™ì€ ì…ì ë¶„í¬ì— ëŒ€í•´ CICì™€ NGP ì „í•˜ í• ë‹¹ì„ ë¹„êµí•˜ì‹œì˜¤. ì–´ëŠ ê²ƒì´ ë” ë§¤ë„ëŸ¬ìš´ ì „í•˜ ë°€ë„ë¥¼ ì£¼ëŠ”ê°€?</p>
<h3 id="3">ì—°ìŠµ 3: ì—´í‰í˜•<a class="header-link" href="#3" title="Permanent link">&para;</a></h3>
<p>ë‹¨ì¼ ì¢… í”Œë¼ì¦ˆë§ˆì˜ PIC ì‹œë®¬ë ˆì´ì…˜ì—ì„œ Maxwell ë¶„í¬ê°€ ìœ ì§€ë˜ëŠ”ì§€ í™•ì¸í•˜ì‹œì˜¤. ìˆ˜ì¹˜ì  ê°€ì—´ì´ ë°œìƒí•˜ëŠ”ê°€?</p>
<h3 id="4">ì—°ìŠµ 4: ë‘ ë¹” ë¶ˆì•ˆì •ì„±<a class="header-link" href="#4" title="Permanent link">&para;</a></h3>
<p>Two-stream ì‹œë®¬ë ˆì´ì…˜ì—ì„œ ë“œë¦¬í”„íŠ¸ ì†ë„ vâ‚€ë¥¼ ë³€í™”ì‹œí‚¤ë©° ì„±ì¥ë¥  Î³ë¥¼ ì¸¡ì •í•˜ì‹œì˜¤. ì´ë¡ ê°’ê³¼ ë¹„êµí•˜ì‹œì˜¤.</p>
<hr />
<h2 id="9">9. ì°¸ê³ ìë£Œ<a class="header-link" href="#9" title="Permanent link">&para;</a></h2>
<h3 id="_2">í•µì‹¬ êµì¬<a class="header-link" href="#_2" title="Permanent link">&para;</a></h3>
<ul>
<li>Birdsall &amp; Langdon, "Plasma Physics via Computer Simulation" (í‘œì¤€ êµì¬)</li>
<li>Hockney &amp; Eastwood, "Computer Simulation Using Particles"</li>
<li>Arber et al., "Contemporary Particle-In-Cell Approach to Laser-Plasma Modelling"</li>
</ul>
<h3 id="pic">PIC ì½”ë“œ<a class="header-link" href="#pic" title="Permanent link">&para;</a></h3>
<ul>
<li>EPOCH: ë ˆì´ì € í”Œë¼ì¦ˆë§ˆ</li>
<li>OSIRIS: ê³ ì„±ëŠ¥, ìƒëŒ€ë¡ ì </li>
<li>SMILEI: ëª¨ë“ˆì‹, ì˜¤í”ˆì†ŒìŠ¤</li>
<li>WarpX: GPU ê°€ì†, Exascale</li>
</ul>
<h3 id="_3">ì˜¨ë¼ì¸ ìë£Œ<a class="header-link" href="#_3" title="Permanent link">&para;</a></h3>
<ul>
<li>Plasma Theory Group resources</li>
<li>UCLA PICKSC íŠœí† ë¦¬ì–¼</li>
<li>LBNL WarpX ë¬¸ì„œ</li>
</ul>
<hr />
<h2 id="_4">ìš”ì•½<a class="header-link" href="#_4" title="Permanent link">&para;</a></h2>
<div class="highlight"><pre><span></span><code>PIC ì‹œë®¬ë ˆì´ì…˜ í•µì‹¬:

1. ì•Œê³ ë¦¬ì¦˜ ì‚¬ì´í´:
   ì…ì â†’ ì „í•˜/ì „ë¥˜ â†’ ì¥ í’€ì´ â†’ ë³´ê°„ â†’ ì…ì í‘¸ì‹œ

2. ì…ì í‘¸ì‹œ (Boris):
   <span class="k">-</span> ë°˜ê°€ì† â†’ íšŒì „ â†’ ë°˜ê°€ì†
   <span class="k">-</span> ì—ë„ˆì§€ ë³´ì¡´, 2ì°¨ ì •í™•ë„

3. ì¥ í’€ì´:
   <span class="k">-</span> ì •ì „ê¸°: Poisson (âˆ‡Â²Ï† = -Ï/Îµâ‚€)
   <span class="k">-</span> ì „ìê¸°: Maxwell (FDTD ìœ ì‚¬)

4. ë³´ê°„:
   <span class="k">-</span> NGP: 0ì°¨, ë¶ˆì—°ì†
   <span class="k">-</span> CIC: 1ì°¨, ì„ í˜•
   <span class="k">-</span> TSC: 2ì°¨, ë§¤ë„ëŸ¬ì›€

5. ìŠ¤ì¼€ì¼ ì¡°ê±´:
   <span class="k">-</span> Î”x &lt; Î»D
   <span class="k">-</span> Î”t &lt; Ï‰pe^-1
   <span class="k">-</span> N_ppc &gt; 50-100

6. ê²€ì¦ í…ŒìŠ¤íŠ¸:
   <span class="k">-</span> Langmuir íŒŒ (í”Œë¼ì¦ˆë§ˆ ì§„ë™)
   <span class="k">-</span> Two-stream ë¶ˆì•ˆì •ì„±
   <span class="k">-</span> ì…ì ë“œë¦¬í”„íŠ¸

7. ì§„ë‹¨:
   <span class="k">-</span> ì—ë„ˆì§€ ë³´ì¡´
   <span class="k">-</span> ìœ„ìƒ ê³µê°„ ë¶„í¬
   <span class="k">-</span> ë¶„ì‚° ê´€ê³„
</code></pre></div>

<hr />
<p>ì´ê²ƒìœ¼ë¡œ ìˆ˜ì¹˜ ì‹œë®¬ë ˆì´ì…˜ ì‹œë¦¬ì¦ˆì˜ CFD, ì „ìê¸°í•™, MHD, í”Œë¼ì¦ˆë§ˆ ì£¼ì œë¥¼ ë§ˆë¬´ë¦¬í•©ë‹ˆë‹¤.</p>
    </div>

    
<div class="lesson-toolbar lesson-toolbar--bottom">
    <div class="toolbar-nav toolbar-nav--prev">
        
        <a href="/study/ko/Numerical_Simulation/18_MHD_Numerical_Methods.html" class="nav-prev">
            <span class="nav-label">Previous</span>
            <span class="nav-title">18. MHD ìˆ˜ì¹˜í•´ë²• (MHD Numerical Methods)</span>
        </a>
        
    </div>
    <div class="toolbar-actions">
        <button class="btn btn-copy-link" data-action="copy-link" title="Copy link">
            <span class="icon">ğŸ”—</span>
            <span class="text">Copy link</span>
        </button>
        <a href="/study/ko/Numerical_Simulation/" class="btn btn-topic-link" title="Back to topic list">
            <span class="icon">ğŸ“‹</span>
            <span class="text">Topic list</span>
        </a>
    </div>
    <div class="toolbar-nav toolbar-nav--next">
        
        <a href="/study/ko/Numerical_Simulation/20_Monte_Carlo_Simulation.html" class="nav-next">
            <span class="nav-label">Next</span>
            <span class="nav-title">ëª¬í…Œì¹´ë¥¼ë¡œ ì‹œë®¬ë ˆì´ì…˜</span>
        </a>
        
    </div>
</div>


    <div class="toolbar-keyboard-hint">
        <kbd>&larr;</kbd> <kbd>&rarr;</kbd> to navigate between lessons
    </div>
</article>

<!-- Scroll to top floating button -->
<button class="scroll-to-top" id="scroll-to-top" title="Scroll to top" aria-label="Scroll to top">â†‘</button>

            </div>
        </main>
    </div>

    <script src="/study/static/js/app.js"></script>
    <script>
        function switchLanguage(newLang) {
            const path = window.location.pathname;
            const base = '/study';
            const currentLang = 'ko';
            const newPath = path.replace(base + '/' + currentLang + '/', base + '/' + newLang + '/');
            window.location.href = newPath + window.location.search;
        }
    </script>
    
<script>
    document.addEventListener('DOMContentLoaded', function() {
        // Copy link - independent feedback per button
        document.querySelectorAll('[data-action="copy-link"]').forEach(function(btn) {
            btn.addEventListener('click', function() {
                navigator.clipboard.writeText(window.location.href);
                var textEl = this.querySelector('.text');
                var originalText = textEl.textContent;
                textEl.textContent = 'Copied!';
                setTimeout(function() { textEl.textContent = originalText; }, 2000);
            });
        });

        // Add copy buttons to code blocks
        document.querySelectorAll('.lesson-content pre').forEach(function(pre) {
            var copyBtn = document.createElement('button');
            copyBtn.className = 'code-copy-btn';
            copyBtn.textContent = 'Copy';
            copyBtn.addEventListener('click', function() {
                var code = pre.querySelector('code');
                var text = code ? code.textContent : pre.textContent;
                navigator.clipboard.writeText(text);
                copyBtn.textContent = 'Copied!';
                setTimeout(function() { copyBtn.textContent = 'Copy'; }, 2000);
            });
            pre.style.position = 'relative';
            pre.appendChild(copyBtn);
        });

        // Scroll to top button
        var scrollBtn = document.getElementById('scroll-to-top');
        window.addEventListener('scroll', function() {
            scrollBtn.classList.toggle('visible', window.scrollY > 300);
        });
        scrollBtn.addEventListener('click', function() {
            window.scrollTo({ top: 0, behavior: 'smooth' });
        });

        // Keyboard shortcuts: left/right arrows for lesson navigation
        document.addEventListener('keydown', function(e) {
            var tag = document.activeElement.tagName;
            if (tag === 'INPUT' || tag === 'TEXTAREA' || tag === 'SELECT') return;

            if (e.key === 'ArrowLeft') {
                var prevLink = document.querySelector('.nav-prev');
                if (prevLink) prevLink.click();
            } else if (e.key === 'ArrowRight') {
                var nextLink = document.querySelector('.nav-next');
                if (nextLink) nextLink.click();
            }
        });
    });
</script>

</body>
</html>
{% endraw %}