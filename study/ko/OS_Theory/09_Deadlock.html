{% raw %}
<!DOCTYPE html>
<html lang="ko" data-theme="light">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>데드락 - Study Materials</title>
    <link rel="stylesheet" href="/study/static/css/style.css">
    <link rel="stylesheet" href="/study/static/css/highlight.css">
    <!-- KaTeX for LaTeX math rendering -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.16.11/dist/katex.min.css">
    <script defer src="https://cdn.jsdelivr.net/npm/katex@0.16.11/dist/katex.min.js"></script>
    <script defer src="https://cdn.jsdelivr.net/npm/katex@0.16.11/dist/contrib/auto-render.min.js"
        onload="renderMathInElement(document.body, {
            delimiters: [
                {left: '$$', right: '$$', display: true},
                {left: '$', right: '$', display: false}
            ],
            throwOnError: false
        });"></script>
    
</head>
<body>
    <div class="app-container">
        <!-- Sidebar -->
        <aside class="sidebar" id="sidebar">
            <div class="sidebar-header">
                <a href="/study/ko/" class="logo">Study Materials</a>
                <button class="sidebar-toggle" id="sidebar-toggle" aria-label="Toggle sidebar">
                    <span></span>
                </button>
            </div>

            <nav class="sidebar-nav">
                <a href="/study/ko/" class="nav-item ">
                    <span class="nav-icon">🏠</span>
                    <span class="nav-text">Home</span>
                </a>
                <a href="/study/examples/" class="nav-item ">
                    <span class="nav-icon">💻</span>
                    <span class="nav-text">Examples</span>
                </a>
            </nav>

            <div class="sidebar-search">
                <form action="/study/ko/search.html" method="get" id="search-form">
                    <input type="search" name="q" placeholder="Search..." id="search-sidebar-input">
                </form>
            </div>

            <!-- Language Selector -->
            <div class="sidebar-lang">
                <select id="lang-select" class="lang-selector" onchange="switchLanguage(this.value)">
                    
                    <option value="en" >
                        English
                    </option>
                    
                    <option value="ko" selected>
                        한국어
                    </option>
                    
                </select>
            </div>

            <div class="sidebar-footer">
                <button class="theme-toggle" id="theme-toggle" aria-label="Toggle theme">
                    <span class="theme-icon light">☀️</span>
                    <span class="theme-icon dark">🌙</span>
                </button>
            </div>
        </aside>

        <!-- Main Content -->
        <main class="main-content">
            <header class="main-header">
                <button class="menu-toggle" id="menu-toggle" aria-label="Open menu">
                    <span></span>
                </button>
                
<nav class="breadcrumb">
    <a href="/study/ko/">Topics</a>
    <span class="separator">/</span>
    <a href="/study/ko/OS_Theory/">OS Theory</a>
    <span class="separator">/</span>
    <span class="current">데드락</span>
</nav>

            </header>

            <div class="content">
                
<article class="lesson-article">
    <header class="lesson-header">
        <h1>데드락</h1>
    </header>

    
<div class="lesson-toolbar lesson-toolbar--top">
    <div class="toolbar-nav toolbar-nav--prev">
        
        <a href="/study/ko/OS_Theory/08_Synchronization_Tools.html" class="nav-prev">
            <span class="nav-label">Previous</span>
            <span class="nav-title">동기화 도구</span>
        </a>
        
    </div>
    <div class="toolbar-actions">
        <button class="btn btn-copy-link" data-action="copy-link" title="Copy link">
            <span class="icon">🔗</span>
            <span class="text">Copy link</span>
        </button>
        <a href="/study/ko/OS_Theory/" class="btn btn-topic-link" title="Back to topic list">
            <span class="icon">📋</span>
            <span class="text">Topic list</span>
        </a>
    </div>
    <div class="toolbar-nav toolbar-nav--next">
        
        <a href="/study/ko/OS_Theory/10_Memory_Management_Basics.html" class="nav-next">
            <span class="nav-label">Next</span>
            <span class="nav-title">메모리 관리 기초 ⭐⭐</span>
        </a>
        
    </div>
</div>


    
    <nav class="toc" id="toc">
        <h2>Table of Contents</h2>
        <div class="toc">
<ul>
<li><a href="#_2">개요</a></li>
<li><a href="#_3">목차</a></li>
<li><a href="#1">1. 데드락이란?</a><ul>
<li><a href="#_4">정의</a></li>
<li><a href="#_5">실생활 예시</a></li>
<li><a href="#_6">코드 예시</a></li>
</ul>
</li>
<li><a href="#2">2. 데드락 필요조건</a><ul>
<li><a href="#_7">네 가지 필요조건</a></li>
<li><a href="#_8">순환 대기 시각화</a></li>
</ul>
</li>
<li><a href="#3">3. 자원 할당 그래프</a><ul>
<li><a href="#_9">그래프 표기법</a></li>
<li><a href="#_10">데드락 상태의 그래프</a></li>
<li><a href="#_11">사이클과 데드락</a></li>
</ul>
</li>
<li><a href="#4">4. 데드락 예방</a><ul>
<li><a href="#_12">네 조건 중 하나 깨기</a></li>
<li><a href="#_13">순환 대기 예방 코드</a></li>
</ul>
</li>
<li><a href="#5">5. 데드락 회피</a><ul>
<li><a href="#_14">안전 상태와 불안전 상태</a></li>
<li><a href="#bankers-algorithm">은행원 알고리즘 (Banker's Algorithm)</a></li>
<li><a href="#_15">은행원 알고리즘 예제</a></li>
<li><a href="#_16">은행원 알고리즘 코드</a></li>
</ul>
</li>
<li><a href="#6">6. 데드락 탐지와 복구</a><ul>
<li><a href="#_17">탐지 알고리즘</a></li>
<li><a href="#_18">대기 그래프 예시</a></li>
<li><a href="#_19">데드락 복구 방법</a></li>
<li><a href="#_20">데드락 처리 방법 비교</a></li>
</ul>
</li>
<li><a href="#7">7. 연습 문제</a><ul>
<li><a href="#1_1">문제 1: 데드락 필요조건</a></li>
<li><a href="#2_1">문제 2: 자원 할당 그래프</a></li>
<li><a href="#3_1">문제 3: 은행원 알고리즘</a></li>
<li><a href="#4_1">문제 4: 순환 대기 예방</a></li>
<li><a href="#5_1">문제 5: 데드락 복구</a></li>
</ul>
</li>
<li><a href="#_21">다음 단계</a></li>
<li><a href="#_22">참고 자료</a></li>
</ul>
</div>

    </nav>
    

    <div class="lesson-content markdown-body">
        <h1 id="_1">데드락<a class="header-link" href="#_1" title="Permanent link">&para;</a></h1>
<h2 id="_2">개요<a class="header-link" href="#_2" title="Permanent link">&para;</a></h2>
<p>데드락(Deadlock)은 두 개 이상의 프로세스가 서로 상대방이 가진 자원을 기다리며 무한히 대기하는 상태입니다. 이 레슨에서는 데드락의 네 가지 필요조건, 자원 할당 그래프, 그리고 예방, 회피, 탐지, 복구 방법을 학습합니다.</p>
<hr />
<h2 id="_3">목차<a class="header-link" href="#_3" title="Permanent link">&para;</a></h2>
<ol>
<li><a href="#1-데드락이란">데드락이란?</a></li>
<li><a href="#2-데드락-필요조건">데드락 필요조건</a></li>
<li><a href="#3-자원-할당-그래프">자원 할당 그래프</a></li>
<li><a href="#4-데드락-예방">데드락 예방</a></li>
<li><a href="#5-데드락-회피">데드락 회피</a></li>
<li><a href="#6-데드락-탐지와-복구">데드락 탐지와 복구</a></li>
<li><a href="#7-연습-문제">연습 문제</a></li>
</ol>
<hr />
<h2 id="1">1. 데드락이란?<a class="header-link" href="#1" title="Permanent link">&para;</a></h2>
<h3 id="_4">정의<a class="header-link" href="#_4" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code>┌─────────────────────────────────────────────────────────┐
│                    데드락 (Deadlock)                     │
├─────────────────────────────────────────────────────────┤
│                                                         │
│  데드락 = 교착 상태                                     │
│         = 두 개 이상의 프로세스가 서로 상대방의 자원을   │
│           기다리며 무한히 대기하는 상태                  │
│                                                         │
│  ┌─────────────────────────────────────────────────┐    │
│  │                                                 │    │
│  │    프로세스 A                 프로세스 B         │    │
│  │    ┌───────┐                 ┌───────┐         │    │
│  │    │       │ ──R2 요청───▶  │       │         │    │
│  │    │  R1   │                │  R2   │         │    │
│  │    │ 보유  │ ◀──R1 요청─── │ 보유  │         │    │
│  │    │       │                │       │         │    │
│  │    └───────┘                └───────┘         │    │
│  │                                                 │    │
│  │    A는 R2를 기다림, B는 R1을 기다림              │    │
│  │    → 둘 다 영원히 대기 (데드락)                  │    │
│  │                                                 │    │
│  └─────────────────────────────────────────────────┘    │
│                                                         │
└─────────────────────────────────────────────────────────┘
</code></pre></div>

<h3 id="_5">실생활 예시<a class="header-link" href="#_5" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code>┌─────────────────────────────────────────────────────────┐
│                   데드락 실생활 예시                     │
├─────────────────────────────────────────────────────────┤
│                                                         │
│  1. 교차로 데드락:                                      │
│                                                         │
│              │     │                                    │
│              │ ▲   │                                    │
│              │ │   │                                    │
│       ───────┼─────┼───────                             │
│          ◀───│     │                                    │
│       ───────┼─────┼───────                             │
│              │     │───▶                                │
│       ───────┼─────┼───────                             │
│              │   │ │                                    │
│              │   ▼ │                                    │
│                                                         │
│     네 대의 차가 모두 앞 차를 기다림                     │
│                                                         │
│  2. 다리 위 데드락:                                     │
│                                                         │
│     ┌───────────────────────────┐                       │
│     │     ◀───   ───▶          │                       │
│     │  A 차량    B 차량          │                       │
│     └───────────────────────────┘                       │
│     좁은 다리에서 양쪽에서 진입                          │
│                                                         │
└─────────────────────────────────────────────────────────┘
</code></pre></div>

<h3 id="_6">코드 예시<a class="header-link" href="#_6" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;stdio.h&gt;</span>
<span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;pthread.h&gt;</span>
<span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;unistd.h&gt;</span>

<span class="n">pthread_mutex_t</span><span class="w"> </span><span class="n">lock1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">PTHREAD_MUTEX_INITIALIZER</span><span class="p">;</span>
<span class="n">pthread_mutex_t</span><span class="w"> </span><span class="n">lock2</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">PTHREAD_MUTEX_INITIALIZER</span><span class="p">;</span>

<span class="kt">void</span><span class="o">*</span><span class="w"> </span><span class="nf">thread_A</span><span class="p">(</span><span class="kt">void</span><span class="o">*</span><span class="w"> </span><span class="n">arg</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="n">pthread_mutex_lock</span><span class="p">(</span><span class="o">&amp;</span><span class="n">lock1</span><span class="p">);</span>
<span class="w">    </span><span class="n">printf</span><span class="p">(</span><span class="s">&quot;Thread A: lock1 획득</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span>

<span class="w">    </span><span class="n">sleep</span><span class="p">(</span><span class="mi">1</span><span class="p">);</span><span class="w">  </span><span class="c1">// 데드락 발생 확률 높임</span>

<span class="w">    </span><span class="n">printf</span><span class="p">(</span><span class="s">&quot;Thread A: lock2 대기</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span>
<span class="w">    </span><span class="n">pthread_mutex_lock</span><span class="p">(</span><span class="o">&amp;</span><span class="n">lock2</span><span class="p">);</span><span class="w">  </span><span class="c1">// 데드락!</span>

<span class="w">    </span><span class="n">printf</span><span class="p">(</span><span class="s">&quot;Thread A: 둘 다 획득</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span>
<span class="w">    </span><span class="n">pthread_mutex_unlock</span><span class="p">(</span><span class="o">&amp;</span><span class="n">lock2</span><span class="p">);</span>
<span class="w">    </span><span class="n">pthread_mutex_unlock</span><span class="p">(</span><span class="o">&amp;</span><span class="n">lock1</span><span class="p">);</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="nb">NULL</span><span class="p">;</span>
<span class="p">}</span>

<span class="kt">void</span><span class="o">*</span><span class="w"> </span><span class="nf">thread_B</span><span class="p">(</span><span class="kt">void</span><span class="o">*</span><span class="w"> </span><span class="n">arg</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="n">pthread_mutex_lock</span><span class="p">(</span><span class="o">&amp;</span><span class="n">lock2</span><span class="p">);</span>
<span class="w">    </span><span class="n">printf</span><span class="p">(</span><span class="s">&quot;Thread B: lock2 획득</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span>

<span class="w">    </span><span class="n">sleep</span><span class="p">(</span><span class="mi">1</span><span class="p">);</span><span class="w">  </span><span class="c1">// 데드락 발생 확률 높임</span>

<span class="w">    </span><span class="n">printf</span><span class="p">(</span><span class="s">&quot;Thread B: lock1 대기</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span>
<span class="w">    </span><span class="n">pthread_mutex_lock</span><span class="p">(</span><span class="o">&amp;</span><span class="n">lock1</span><span class="p">);</span><span class="w">  </span><span class="c1">// 데드락!</span>

<span class="w">    </span><span class="n">printf</span><span class="p">(</span><span class="s">&quot;Thread B: 둘 다 획득</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span>
<span class="w">    </span><span class="n">pthread_mutex_unlock</span><span class="p">(</span><span class="o">&amp;</span><span class="n">lock1</span><span class="p">);</span>
<span class="w">    </span><span class="n">pthread_mutex_unlock</span><span class="p">(</span><span class="o">&amp;</span><span class="n">lock2</span><span class="p">);</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="nb">NULL</span><span class="p">;</span>
<span class="p">}</span>

<span class="kt">int</span><span class="w"> </span><span class="nf">main</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="n">pthread_t</span><span class="w"> </span><span class="n">tA</span><span class="p">,</span><span class="w"> </span><span class="n">tB</span><span class="p">;</span>

<span class="w">    </span><span class="n">pthread_create</span><span class="p">(</span><span class="o">&amp;</span><span class="n">tA</span><span class="p">,</span><span class="w"> </span><span class="nb">NULL</span><span class="p">,</span><span class="w"> </span><span class="n">thread_A</span><span class="p">,</span><span class="w"> </span><span class="nb">NULL</span><span class="p">);</span>
<span class="w">    </span><span class="n">pthread_create</span><span class="p">(</span><span class="o">&amp;</span><span class="n">tB</span><span class="p">,</span><span class="w"> </span><span class="nb">NULL</span><span class="p">,</span><span class="w"> </span><span class="n">thread_B</span><span class="p">,</span><span class="w"> </span><span class="nb">NULL</span><span class="p">);</span>

<span class="w">    </span><span class="n">pthread_join</span><span class="p">(</span><span class="n">tA</span><span class="p">,</span><span class="w"> </span><span class="nb">NULL</span><span class="p">);</span>
<span class="w">    </span><span class="n">pthread_join</span><span class="p">(</span><span class="n">tB</span><span class="p">,</span><span class="w"> </span><span class="nb">NULL</span><span class="p">);</span>

<span class="w">    </span><span class="n">printf</span><span class="p">(</span><span class="s">&quot;완료</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span><span class="w">  </span><span class="c1">// 데드락 시 도달 못함</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>

<span class="cm">/*</span>
<span class="cm">출력 (데드락 발생 시):</span>
<span class="cm">Thread A: lock1 획득</span>
<span class="cm">Thread B: lock2 획득</span>
<span class="cm">Thread A: lock2 대기</span>
<span class="cm">Thread B: lock1 대기</span>
<span class="cm">... (영원히 대기)</span>
<span class="cm">*/</span>
</code></pre></div>

<hr />
<h2 id="2">2. 데드락 필요조건<a class="header-link" href="#2" title="Permanent link">&para;</a></h2>
<h3 id="_7">네 가지 필요조건<a class="header-link" href="#_7" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code>┌─────────────────────────────────────────────────────────┐
│<span class="w">              </span>데드락의<span class="w"> </span>네<span class="w"> </span>가지<span class="w"> </span>필요조건<span class="w">                   </span>│
├─────────────────────────────────────────────────────────┤
│<span class="w">                                                         </span>│
│<span class="w">  </span>데드락이<span class="w"> </span>발생하려면<span class="w"> </span>다음<span class="w"> </span>네<span class="w"> </span>조건이<span class="w"> </span>동시에<span class="w"> </span>성립해야<span class="w"> </span>함<span class="w">   </span>│
│<span class="w">  </span><span class="ss">(</span>하나라도<span class="w"> </span>깨지면<span class="w"> </span>데드락<span class="w"> </span>발생<span class="w"> </span>안<span class="w"> </span>함<span class="ss">)</span><span class="w">                     </span>│
│<span class="w">                                                         </span>│
│<span class="w">  </span>┌───────────────────────────────────────────────────┐<span class="w">  </span>│
│<span class="w">  </span>│<span class="w"> </span><span class="mi">1</span>.<span class="w"> </span>상호<span class="w"> </span>배제<span class="w"> </span><span class="ss">(</span><span class="nv">Mutual</span><span class="w"> </span><span class="nv">Exclusion</span><span class="ss">)</span><span class="w">                   </span>│<span class="w">  </span>│
│<span class="w">  </span>│<span class="w">    </span><span class="o">-</span><span class="w"> </span>자원은<span class="w"> </span>한<span class="w"> </span>번에<span class="w"> </span>하나의<span class="w"> </span>프로세스만<span class="w"> </span>사용<span class="w"> </span>가능<span class="w">    </span>│<span class="w">  </span>│
│<span class="w">  </span>│<span class="w">    </span><span class="o">-</span><span class="w"> </span>다른<span class="w"> </span>프로세스는<span class="w"> </span>자원이<span class="w"> </span>해제될<span class="w"> </span>때까지<span class="w"> </span>대기<span class="w">     </span>│<span class="w">  </span>│
│<span class="w">  </span>└───────────────────────────────────────────────────┘<span class="w">  </span>│
│<span class="w">                                                         </span>│
│<span class="w">  </span>┌───────────────────────────────────────────────────┐<span class="w">  </span>│
│<span class="w">  </span>│<span class="w"> </span><span class="mi">2</span>.<span class="w"> </span>점유와<span class="w"> </span>대기<span class="w"> </span><span class="ss">(</span><span class="nv">Hold</span><span class="w"> </span><span class="nv">and</span><span class="w"> </span><span class="k">Wait</span><span class="ss">)</span><span class="w">                    </span>│<span class="w">  </span>│
│<span class="w">  </span>│<span class="w">    </span><span class="o">-</span><span class="w"> </span>프로세스가<span class="w"> </span>자원을<span class="w"> </span>보유한<span class="w"> </span>채로<span class="w"> </span>다른<span class="w"> </span>자원<span class="w"> </span>대기<span class="w">  </span>│<span class="w">  </span>│
│<span class="w">  </span>│<span class="w">    </span><span class="o">-</span><span class="w"> </span>이미<span class="w"> </span>할당된<span class="w"> </span>자원을<span class="w"> </span>가지고<span class="w"> </span>있으면서<span class="w"> </span>추가<span class="w"> </span>요청<span class="w">  </span>│<span class="w">  </span>│
│<span class="w">  </span>└───────────────────────────────────────────────────┘<span class="w">  </span>│
│<span class="w">                                                         </span>│
│<span class="w">  </span>┌───────────────────────────────────────────────────┐<span class="w">  </span>│
│<span class="w">  </span>│<span class="w"> </span><span class="mi">3</span>.<span class="w"> </span>비선점<span class="w"> </span><span class="ss">(</span><span class="nv">No</span><span class="w"> </span><span class="nv">Preemption</span><span class="ss">)</span><span class="w">                         </span>│<span class="w">  </span>│
│<span class="w">  </span>│<span class="w">    </span><span class="o">-</span><span class="w"> </span>자원을<span class="w"> </span>강제로<span class="w"> </span>빼앗을<span class="w"> </span>수<span class="w"> </span>없음<span class="w">                  </span>│<span class="w">  </span>│
│<span class="w">  </span>│<span class="w">    </span><span class="o">-</span><span class="w"> </span>프로세스가<span class="w"> </span>자발적으로<span class="w"> </span>해제해야<span class="w"> </span>함<span class="w">             </span>│<span class="w">  </span>│
│<span class="w">  </span>└───────────────────────────────────────────────────┘<span class="w">  </span>│
│<span class="w">                                                         </span>│
│<span class="w">  </span>┌───────────────────────────────────────────────────┐<span class="w">  </span>│
│<span class="w">  </span>│<span class="w"> </span><span class="mi">4</span>.<span class="w"> </span>순환<span class="w"> </span>대기<span class="w"> </span><span class="ss">(</span><span class="nv">Circular</span><span class="w"> </span><span class="k">Wait</span><span class="ss">)</span><span class="w">                      </span>│<span class="w">  </span>│
│<span class="w">  </span>│<span class="w">    </span><span class="o">-</span><span class="w"> </span>프로세스<span class="w"> </span>집합<span class="w"> </span>{<span class="nv">P0</span>,<span class="w"> </span><span class="nv">P1</span>,<span class="w"> </span>...,<span class="w"> </span><span class="nv">Pn</span>}에서<span class="w">          </span>│<span class="w">  </span>│
│<span class="w">  </span>│<span class="w">    </span><span class="o">-</span><span class="w"> </span><span class="nv">P0</span>→<span class="nv">P1</span>→<span class="nv">P2</span>→...→<span class="nv">Pn</span>→<span class="nv">P0</span><span class="w"> </span>순환<span class="w"> </span>대기<span class="w"> </span>존재<span class="w">          </span>│<span class="w">  </span>│
│<span class="w">  </span>└───────────────────────────────────────────────────┘<span class="w">  </span>│
│<span class="w">                                                         </span>│
└─────────────────────────────────────────────────────────┘
</code></pre></div>

<h3 id="_8">순환 대기 시각화<a class="header-link" href="#_8" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code>┌─────────────────────────────────────────────────────────┐
│                    순환 대기 예시                        │
├─────────────────────────────────────────────────────────┤
│                                                         │
│  세 프로세스, 세 자원:                                  │
│                                                         │
│       ┌───────┐                                         │
│       │  P0   │                                         │
│       └───┬───┘                                         │
│      보유: R0                                           │
│      대기: R1 ───────────┐                              │
│           │               │                              │
│           ▼               ▼                              │
│       ┌───────┐       ┌───────┐                         │
│       │  R1   │       │  P1   │                         │
│       └───────┘       └───┬───┘                         │
│                      보유: R1                           │
│                      대기: R2 ─────┐                    │
│                           │        │                    │
│                           ▼        ▼                    │
│                       ┌───────┐┌───────┐                │
│                       │  R2   ││  P2   │                │
│                       └───────┘└───┬───┘                │
│                              보유: R2                   │
│                              대기: R0 ────▶ R0         │
│                                    │       (P0 보유)   │
│                                    └───────────────────┐│
│                                                        ││
│  P0 → R1 → P1 → R2 → P2 → R0 → P0 (순환!)            ││
│  └─────────────────────────────────────────────────────┘│
│                                                         │
└─────────────────────────────────────────────────────────┘
</code></pre></div>

<hr />
<h2 id="3">3. 자원 할당 그래프<a class="header-link" href="#3" title="Permanent link">&para;</a></h2>
<h3 id="_9">그래프 표기법<a class="header-link" href="#_9" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code>┌─────────────────────────────────────────────────────────┐
│               자원 할당 그래프 (RAG)                     │
├─────────────────────────────────────────────────────────┤
│                                                         │
│  노드:                                                  │
│  • 프로세스: ○ (원)                                    │
│  • 자원 유형: □ (사각형)                               │
│    - 내부 점(●): 자원 인스턴스 수                       │
│                                                         │
│  엣지:                                                  │
│  • 요청 엣지: Pi → Rj (Pi가 Rj를 요청)                 │
│  • 할당 엣지: Rj → Pi (Rj가 Pi에게 할당됨)              │
│                                                         │
│  ┌───────────────────────────────────────────────────┐  │
│  │        예시                                       │  │
│  │                                                   │  │
│  │    ○ P1 ────요청───▶ □ R1                        │  │
│  │                       │ ● ●                       │  │
│  │                       │                           │  │
│  │                       ▼ 할당                      │  │
│  │                       ○ P2                        │  │
│  │                                                   │  │
│  │    P1이 R1을 요청                                 │  │
│  │    R1의 한 인스턴스가 P2에게 할당됨               │  │
│  │    R1에는 2개의 인스턴스 존재                     │  │
│  └───────────────────────────────────────────────────┘  │
│                                                         │
└─────────────────────────────────────────────────────────┘
</code></pre></div>

<h3 id="_10">데드락 상태의 그래프<a class="header-link" href="#_10" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code>┌─────────────────────────────────────────────────────────┐
│              데드락 상태 자원 할당 그래프                │
├─────────────────────────────────────────────────────────┤
│                                                         │
│     ┌─────────────────────────────────────────────┐     │
│     │                                             │     │
│     │         ○ P1                               │     │
│     │         │↖                                │     │
│     │    요청 │  ╲ 할당                          │     │
│     │         ▼   ╲                              │     │
│     │      ┌─────┐ ╲                             │     │
│     │      │ R1  │  ╲                            │     │
│     │      │  ●  │   ╲                           │     │
│     │      └──┬──┘    ╲                          │     │
│     │         │        ╲                         │     │
│     │    할당 │         ╲                        │     │
│     │         ▼          ╲                       │     │
│     │         ○ P2 ───요청───▶ ┌─────┐          │     │
│     │         ↖               │ R2  │          │     │
│     │          ╲ 할당         │  ●  │          │     │
│     │           ╲             └──┬──┘          │     │
│     │            ╲               │ 할당         │     │
│     │             ╲              ▼              │     │
│     │              ╲──────────○ P3             │     │
│     │                           │              │     │
│     │                           │ 요청          │     │
│     │                           ▼              │     │
│     │               ┌─────┐                    │     │
│     │               │ R3  │ ◀───────┐         │     │
│     │               │  ●  │         │ 할당     │     │
│     │               └─────┘         │         │     │
│     │                    ○ P1 ◀─────┘         │     │
│     │                                             │     │
│     └─────────────────────────────────────────────┘     │
│                                                         │
│     사이클: P1 → R1 → P2 → R3 → P3 → R2 → P1          │
│             (또는 P2 → R3 → P3 → R2 → P2)              │
│                                                         │
│     → 데드락 발생!                                      │
│                                                         │
└─────────────────────────────────────────────────────────┘
</code></pre></div>

<h3 id="_11">사이클과 데드락<a class="header-link" href="#_11" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code>┌─────────────────────────────────────────────────────────┐
│                사이클과 데드락의 관계                    │
├─────────────────────────────────────────────────────────┤
│                                                         │
│  규칙:                                                  │
│  ┌───────────────────────────────────────────────────┐  │
│  │ • 사이클이 없으면 → 데드락 없음                    │  │
│  │ • 사이클이 있으면:                                 │  │
│  │   - 자원당 인스턴스가 1개 → 데드락 확정           │  │
│  │   - 자원당 인스턴스가 여러 개 → 데드락 가능성     │  │
│  └───────────────────────────────────────────────────┘  │
│                                                         │
│  사이클은 있지만 데드락이 아닌 경우:                    │
│                                                         │
│     ○ P1 ─요청─▶ ┌─────┐ ◀─요청─ ○ P3               │
│     ↑           │ R1  │           ↑                   │
│     │           │ ●●  │           │                   │
│     │           └──┬──┘           │                   │
│     │              │              │                   │
│     │ 할당    할당 ▼  할당        │ 할당              │
│     │              │              │                   │
│     └────── ○ P2  ○ P4 ──────────┘                   │
│                                                         │
│     R1에 2개 인스턴스 → P2와 P4가 해제하면 P1, P3 진행 │
│     → 데드락 아님                                       │
│                                                         │
└─────────────────────────────────────────────────────────┘
</code></pre></div>

<hr />
<h2 id="4">4. 데드락 예방<a class="header-link" href="#4" title="Permanent link">&para;</a></h2>
<h3 id="_12">네 조건 중 하나 깨기<a class="header-link" href="#_12" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code>┌─────────────────────────────────────────────────────────┐
│                    데드락 예방                           │
├─────────────────────────────────────────────────────────┤
│                                                         │
│  1. 상호 배제 깨기                                      │
│  ┌───────────────────────────────────────────────────┐  │
│  │  • 가능하면 공유 가능한 자원 사용                  │  │
│  │  • 예: 읽기 전용 파일                             │  │
│  │  • 한계: 본질적으로 배타적인 자원 (프린터, 뮤텍스) │  │
│  │    → 일반적으로 깨기 어려움                       │  │
│  └───────────────────────────────────────────────────┘  │
│                                                         │
│  2. 점유와 대기 깨기                                    │
│  ┌───────────────────────────────────────────────────┐  │
│  │  방법 1: 시작 시 모든 자원 요청                    │  │
│  │    • 필요한 모든 자원을 한 번에 요청               │  │
│  │    • 단점: 자원 이용률 저하, 기아 가능             │  │
│  │                                                   │  │
│  │  방법 2: 요청 전 모든 자원 해제                    │  │
│  │    • 새 자원 요청 전 보유 자원 반납                │  │
│  │    • 단점: 구현 어려움                            │  │
│  └───────────────────────────────────────────────────┘  │
│                                                         │
│  3. 비선점 깨기                                         │
│  ┌───────────────────────────────────────────────────┐  │
│  │  • 자원 요청 실패 시 보유 자원 강제 해제           │  │
│  │  • 또는 다른 프로세스의 자원 선점                  │  │
│  │  • 적용 가능: CPU 레지스터, 메모리                 │  │
│  │  • 적용 어려움: 뮤텍스, 프린터                    │  │
│  └───────────────────────────────────────────────────┘  │
│                                                         │
│  4. 순환 대기 깨기 ★ 가장 실용적                       │
│  ┌───────────────────────────────────────────────────┐  │
│  │  • 자원에 순서 번호 부여                          │  │
│  │  • 오름차순으로만 자원 요청                        │  │
│  │  • 순환 대기 구조적 불가능                         │  │
│  └───────────────────────────────────────────────────┘  │
│                                                         │
└─────────────────────────────────────────────────────────┘
</code></pre></div>

<h3 id="_13">순환 대기 예방 코드<a class="header-link" href="#_13" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;stdio.h&gt;</span>
<span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;pthread.h&gt;</span>

<span class="c1">// 자원에 순서 번호 부여</span>
<span class="c1">// lock1 = 자원 1 (순서 1)</span>
<span class="c1">// lock2 = 자원 2 (순서 2)</span>
<span class="n">pthread_mutex_t</span><span class="w"> </span><span class="n">lock1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">PTHREAD_MUTEX_INITIALIZER</span><span class="p">;</span>
<span class="n">pthread_mutex_t</span><span class="w"> </span><span class="n">lock2</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">PTHREAD_MUTEX_INITIALIZER</span><span class="p">;</span>

<span class="c1">// 항상 오름차순으로 획득!</span>
<span class="kt">void</span><span class="o">*</span><span class="w"> </span><span class="nf">thread_A</span><span class="p">(</span><span class="kt">void</span><span class="o">*</span><span class="w"> </span><span class="n">arg</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="c1">// lock1(1) → lock2(2) 순서로 획득</span>
<span class="w">    </span><span class="n">pthread_mutex_lock</span><span class="p">(</span><span class="o">&amp;</span><span class="n">lock1</span><span class="p">);</span><span class="w">  </span><span class="c1">// 순서 1</span>
<span class="w">    </span><span class="n">printf</span><span class="p">(</span><span class="s">&quot;Thread A: lock1 획득</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span>

<span class="w">    </span><span class="n">pthread_mutex_lock</span><span class="p">(</span><span class="o">&amp;</span><span class="n">lock2</span><span class="p">);</span><span class="w">  </span><span class="c1">// 순서 2</span>
<span class="w">    </span><span class="n">printf</span><span class="p">(</span><span class="s">&quot;Thread A: lock2 획득</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span>

<span class="w">    </span><span class="c1">// 임계 구역</span>
<span class="w">    </span><span class="n">printf</span><span class="p">(</span><span class="s">&quot;Thread A: 작업 수행</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span>

<span class="w">    </span><span class="n">pthread_mutex_unlock</span><span class="p">(</span><span class="o">&amp;</span><span class="n">lock2</span><span class="p">);</span>
<span class="w">    </span><span class="n">pthread_mutex_unlock</span><span class="p">(</span><span class="o">&amp;</span><span class="n">lock1</span><span class="p">);</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="nb">NULL</span><span class="p">;</span>
<span class="p">}</span>

<span class="kt">void</span><span class="o">*</span><span class="w"> </span><span class="nf">thread_B</span><span class="p">(</span><span class="kt">void</span><span class="o">*</span><span class="w"> </span><span class="n">arg</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="c1">// 동일하게 lock1(1) → lock2(2) 순서로 획득</span>
<span class="w">    </span><span class="n">pthread_mutex_lock</span><span class="p">(</span><span class="o">&amp;</span><span class="n">lock1</span><span class="p">);</span><span class="w">  </span><span class="c1">// 순서 1</span>
<span class="w">    </span><span class="n">printf</span><span class="p">(</span><span class="s">&quot;Thread B: lock1 획득</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span>

<span class="w">    </span><span class="n">pthread_mutex_lock</span><span class="p">(</span><span class="o">&amp;</span><span class="n">lock2</span><span class="p">);</span><span class="w">  </span><span class="c1">// 순서 2</span>
<span class="w">    </span><span class="n">printf</span><span class="p">(</span><span class="s">&quot;Thread B: lock2 획득</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span>

<span class="w">    </span><span class="c1">// 임계 구역</span>
<span class="w">    </span><span class="n">printf</span><span class="p">(</span><span class="s">&quot;Thread B: 작업 수행</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span>

<span class="w">    </span><span class="n">pthread_mutex_unlock</span><span class="p">(</span><span class="o">&amp;</span><span class="n">lock2</span><span class="p">);</span>
<span class="w">    </span><span class="n">pthread_mutex_unlock</span><span class="p">(</span><span class="o">&amp;</span><span class="n">lock1</span><span class="p">);</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="nb">NULL</span><span class="p">;</span>
<span class="p">}</span>

<span class="kt">int</span><span class="w"> </span><span class="nf">main</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="n">pthread_t</span><span class="w"> </span><span class="n">tA</span><span class="p">,</span><span class="w"> </span><span class="n">tB</span><span class="p">;</span>

<span class="w">    </span><span class="n">pthread_create</span><span class="p">(</span><span class="o">&amp;</span><span class="n">tA</span><span class="p">,</span><span class="w"> </span><span class="nb">NULL</span><span class="p">,</span><span class="w"> </span><span class="n">thread_A</span><span class="p">,</span><span class="w"> </span><span class="nb">NULL</span><span class="p">);</span>
<span class="w">    </span><span class="n">pthread_create</span><span class="p">(</span><span class="o">&amp;</span><span class="n">tB</span><span class="p">,</span><span class="w"> </span><span class="nb">NULL</span><span class="p">,</span><span class="w"> </span><span class="n">thread_B</span><span class="p">,</span><span class="w"> </span><span class="nb">NULL</span><span class="p">);</span>

<span class="w">    </span><span class="n">pthread_join</span><span class="p">(</span><span class="n">tA</span><span class="p">,</span><span class="w"> </span><span class="nb">NULL</span><span class="p">);</span>
<span class="w">    </span><span class="n">pthread_join</span><span class="p">(</span><span class="n">tB</span><span class="p">,</span><span class="w"> </span><span class="nb">NULL</span><span class="p">);</span>

<span class="w">    </span><span class="n">printf</span><span class="p">(</span><span class="s">&quot;완료 (데드락 없음!)</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></div>

<hr />
<h2 id="5">5. 데드락 회피<a class="header-link" href="#5" title="Permanent link">&para;</a></h2>
<h3 id="_14">안전 상태와 불안전 상태<a class="header-link" href="#_14" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code>┌─────────────────────────────────────────────────────────┐
│               안전 상태 vs 불안전 상태                   │
├─────────────────────────────────────────────────────────┤
│                                                         │
│  안전 상태 (Safe State):                                │
│  ┌───────────────────────────────────────────────────┐  │
│  │  • 모든 프로세스가 데드락 없이 완료할 수 있는 상태  │  │
│  │  • 안전 순서 (Safe Sequence) 존재                  │  │
│  │                                                   │  │
│  │  안전 순서: &lt;P1, P3, P4, P2, P0&gt;                  │  │
│  │  = 이 순서로 자원을 할당하면 모두 완료 가능        │  │
│  └───────────────────────────────────────────────────┘  │
│                                                         │
│  불안전 상태 (Unsafe State):                            │
│  ┌───────────────────────────────────────────────────┐  │
│  │  • 안전 순서가 존재하지 않는 상태                  │  │
│  │  • 데드락 발생 가능 (반드시 발생하는 건 아님)       │  │
│  └───────────────────────────────────────────────────┘  │
│                                                         │
│  ┌────────────────────────────────────────────────────┐ │
│  │                                                    │ │
│  │  ┌─────────────────────────────────────────────┐  │ │
│  │  │                 안전 상태                   │  │ │
│  │  │     (데드락 발생 불가능)                    │  │ │
│  │  │                                             │  │ │
│  │  └─────────────────────────────────────────────┘  │ │
│  │                                                    │ │
│  │  ┌─────────────────────────────────────────────┐  │ │
│  │  │            불안전 상태                      │  │ │
│  │  │   ┌─────────────────────────────────────┐  │  │ │
│  │  │   │                                     │  │  │ │
│  │  │   │         데드락 상태                  │  │  │ │
│  │  │   │                                     │  │  │ │
│  │  │   └─────────────────────────────────────┘  │  │ │
│  │  └─────────────────────────────────────────────┘  │ │
│  │                                                    │ │
│  └────────────────────────────────────────────────────┘ │
│                                                         │
│  회피 전략: 항상 안전 상태만 유지                        │
│                                                         │
└─────────────────────────────────────────────────────────┘
</code></pre></div>

<h3 id="bankers-algorithm">은행원 알고리즘 (Banker's Algorithm)<a class="header-link" href="#bankers-algorithm" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><span class="err">┌─────────────────────────────────────────────────────────┐</span>
<span class="err">│</span><span class="w">                 </span><span class="n">은행원</span><span class="w"> </span><span class="n">알고리즘</span><span class="w">                          </span><span class="err">│</span>
<span class="err">├─────────────────────────────────────────────────────────┤</span>
<span class="err">│</span><span class="w">                                                         </span><span class="err">│</span>
<span class="err">│</span><span class="w">  </span><span class="n">Dijkstra가</span><span class="w"> </span><span class="n">개발</span><span class="w"> </span><span class="p">(</span><span class="mi">1965</span><span class="p">)</span><span class="w">                                </span><span class="err">│</span>
<span class="err">│</span><span class="w">  </span><span class="n">은행원이</span><span class="w"> </span><span class="n">고객에게</span><span class="w"> </span><span class="n">대출할</span><span class="w"> </span><span class="n">때와</span><span class="w"> </span><span class="n">유사한</span><span class="w"> </span><span class="n">방식</span><span class="w">               </span><span class="err">│</span>
<span class="err">│</span><span class="w">                                                         </span><span class="err">│</span>
<span class="err">│</span><span class="w">  </span><span class="n">데이터</span><span class="w"> </span><span class="nl">구조</span><span class="p">:</span><span class="w">                                           </span><span class="err">│</span>
<span class="err">│</span><span class="w">  </span><span class="err">•</span><span class="w"> </span><span class="n">n</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">프로세스</span><span class="w"> </span><span class="n">수</span><span class="w">                                      </span><span class="err">│</span>
<span class="err">│</span><span class="w">  </span><span class="err">•</span><span class="w"> </span><span class="n">m</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">자원</span><span class="w"> </span><span class="n">유형</span><span class="w"> </span><span class="n">수</span><span class="w">                                     </span><span class="err">│</span>
<span class="err">│</span><span class="w">                                                         </span><span class="err">│</span>
<span class="err">│</span><span class="w">  </span><span class="err">┌───────────────────────────────────────────────────┐</span><span class="w">  </span><span class="err">│</span>
<span class="err">│</span><span class="w">  </span><span class="err">│</span><span class="w"> </span><span class="n">Available</span><span class="o">[</span><span class="n">m</span><span class="o">]</span><span class="w">                                      </span><span class="err">│</span><span class="w">  </span><span class="err">│</span>
<span class="err">│</span><span class="w">  </span><span class="err">│</span><span class="w">   </span><span class="n">각</span><span class="w"> </span><span class="n">자원</span><span class="w"> </span><span class="n">유형별</span><span class="w"> </span><span class="n">사용</span><span class="w"> </span><span class="n">가능한</span><span class="w"> </span><span class="n">인스턴스</span><span class="w"> </span><span class="n">수</span><span class="w">           </span><span class="err">│</span><span class="w">  </span><span class="err">│</span>
<span class="err">│</span><span class="w">  </span><span class="err">│</span><span class="w">                                                   </span><span class="err">│</span><span class="w">  </span><span class="err">│</span>
<span class="err">│</span><span class="w">  </span><span class="err">│</span><span class="w"> </span><span class="nf">Max</span><span class="o">[</span><span class="n">n</span><span class="o">][</span><span class="n">m</span><span class="o">]</span><span class="w">                                         </span><span class="err">│</span><span class="w">  </span><span class="err">│</span>
<span class="err">│</span><span class="w">  </span><span class="err">│</span><span class="w">   </span><span class="n">각</span><span class="w"> </span><span class="n">프로세스가</span><span class="w"> </span><span class="n">요청할</span><span class="w"> </span><span class="n">수</span><span class="w"> </span><span class="n">있는</span><span class="w"> </span><span class="n">최대</span><span class="w"> </span><span class="n">자원</span><span class="w">           </span><span class="err">│</span><span class="w">  </span><span class="err">│</span>
<span class="err">│</span><span class="w">  </span><span class="err">│</span><span class="w">                                                   </span><span class="err">│</span><span class="w">  </span><span class="err">│</span>
<span class="err">│</span><span class="w">  </span><span class="err">│</span><span class="w"> </span><span class="n">Allocation</span><span class="o">[</span><span class="n">n</span><span class="o">][</span><span class="n">m</span><span class="o">]</span><span class="w">                                  </span><span class="err">│</span><span class="w">  </span><span class="err">│</span>
<span class="err">│</span><span class="w">  </span><span class="err">│</span><span class="w">   </span><span class="n">현재</span><span class="w"> </span><span class="n">각</span><span class="w"> </span><span class="n">프로세스에</span><span class="w"> </span><span class="n">할당된</span><span class="w"> </span><span class="n">자원</span><span class="w">                   </span><span class="err">│</span><span class="w">  </span><span class="err">│</span>
<span class="err">│</span><span class="w">  </span><span class="err">│</span><span class="w">                                                   </span><span class="err">│</span><span class="w">  </span><span class="err">│</span>
<span class="err">│</span><span class="w">  </span><span class="err">│</span><span class="w"> </span><span class="n">Need</span><span class="o">[</span><span class="n">n</span><span class="o">][</span><span class="n">m</span><span class="o">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">Max</span><span class="o">[</span><span class="n">n</span><span class="o">][</span><span class="n">m</span><span class="o">]</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">Allocation</span><span class="o">[</span><span class="n">n</span><span class="o">][</span><span class="n">m</span><span class="o">]</span><span class="w">        </span><span class="err">│</span><span class="w">  </span><span class="err">│</span>
<span class="err">│</span><span class="w">  </span><span class="err">│</span><span class="w">   </span><span class="n">각</span><span class="w"> </span><span class="n">프로세스가</span><span class="w"> </span><span class="n">추가로</span><span class="w"> </span><span class="n">필요한</span><span class="w"> </span><span class="n">자원</span><span class="w">                 </span><span class="err">│</span><span class="w">  </span><span class="err">│</span>
<span class="err">│</span><span class="w">  </span><span class="err">└───────────────────────────────────────────────────┘</span><span class="w">  </span><span class="err">│</span>
<span class="err">│</span><span class="w">                                                         </span><span class="err">│</span>
<span class="err">└─────────────────────────────────────────────────────────┘</span>
</code></pre></div>

<h3 id="_15">은행원 알고리즘 예제<a class="header-link" href="#_15" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><span class="err">┌─────────────────────────────────────────────────────────┐</span>
<span class="err">│</span><span class="w">              </span><span class="n">은행원</span><span class="w"> </span><span class="n">알고리즘</span><span class="w"> </span><span class="n">예제</span><span class="w">                        </span><span class="err">│</span>
<span class="err">├─────────────────────────────────────────────────────────┤</span>
<span class="err">│</span><span class="w">                                                         </span><span class="err">│</span>
<span class="err">│</span><span class="w">  </span><span class="n">자원</span><span class="w"> </span><span class="nl">유형</span><span class="p">:</span><span class="w"> </span><span class="n">A</span><span class="p">,</span><span class="w"> </span><span class="n">B</span><span class="p">,</span><span class="w"> </span><span class="n">C</span><span class="w"> </span><span class="p">(</span><span class="n">각각</span><span class="w"> </span><span class="mi">10</span><span class="p">,</span><span class="w"> </span><span class="mi">5</span><span class="p">,</span><span class="w"> </span><span class="mi">7</span><span class="n">개</span><span class="w"> </span><span class="n">존재</span><span class="p">)</span><span class="w">             </span><span class="err">│</span>
<span class="err">│</span><span class="w">  </span><span class="nl">프로세스</span><span class="p">:</span><span class="w"> </span><span class="n">P0</span><span class="p">,</span><span class="w"> </span><span class="n">P1</span><span class="p">,</span><span class="w"> </span><span class="n">P2</span><span class="p">,</span><span class="w"> </span><span class="n">P3</span><span class="p">,</span><span class="w"> </span><span class="n">P4</span><span class="w">                          </span><span class="err">│</span>
<span class="err">│</span><span class="w">                                                         </span><span class="err">│</span>
<span class="err">│</span><span class="w">  </span><span class="n">현재</span><span class="w"> </span><span class="nl">상태</span><span class="p">:</span><span class="w">                                             </span><span class="err">│</span>
<span class="err">│</span><span class="w">  </span><span class="err">┌─────────┬────────────────┬─────────────┬────────────┐│</span>
<span class="err">│</span><span class="w">  </span><span class="err">│</span><span class="w"> </span><span class="n">Process</span><span class="w"> </span><span class="err">│</span><span class="w">   </span><span class="n">Allocation</span><span class="w">   </span><span class="err">│</span><span class="w">     </span><span class="nf">Max</span><span class="w">     </span><span class="err">│</span><span class="w">    </span><span class="n">Need</span><span class="w">    </span><span class="err">││</span>
<span class="err">│</span><span class="w">  </span><span class="err">│</span><span class="w">         </span><span class="err">│</span><span class="w">   </span><span class="n">A</span><span class="w">   </span><span class="n">B</span><span class="w">   </span><span class="n">C</span><span class="w">    </span><span class="err">│</span><span class="w">  </span><span class="n">A</span><span class="w">   </span><span class="n">B</span><span class="w">   </span><span class="n">C</span><span class="w">  </span><span class="err">│</span><span class="w">  </span><span class="n">A</span><span class="w">   </span><span class="n">B</span><span class="w">   </span><span class="n">C</span><span class="w"> </span><span class="err">││</span>
<span class="err">│</span><span class="w">  </span><span class="err">├─────────┼────────────────┼─────────────┼────────────┤│</span>
<span class="err">│</span><span class="w">  </span><span class="err">│</span><span class="w">   </span><span class="n">P0</span><span class="w">    </span><span class="err">│</span><span class="w">   </span><span class="mi">0</span><span class="w">   </span><span class="mi">1</span><span class="w">   </span><span class="mi">0</span><span class="w">    </span><span class="err">│</span><span class="w">  </span><span class="mi">7</span><span class="w">   </span><span class="mi">5</span><span class="w">   </span><span class="mi">3</span><span class="w">  </span><span class="err">│</span><span class="w">  </span><span class="mi">7</span><span class="w">   </span><span class="mi">4</span><span class="w">   </span><span class="mi">3</span><span class="w"> </span><span class="err">││</span>
<span class="err">│</span><span class="w">  </span><span class="err">│</span><span class="w">   </span><span class="n">P1</span><span class="w">    </span><span class="err">│</span><span class="w">   </span><span class="mi">2</span><span class="w">   </span><span class="mi">0</span><span class="w">   </span><span class="mi">0</span><span class="w">    </span><span class="err">│</span><span class="w">  </span><span class="mi">3</span><span class="w">   </span><span class="mi">2</span><span class="w">   </span><span class="mi">2</span><span class="w">  </span><span class="err">│</span><span class="w">  </span><span class="mi">1</span><span class="w">   </span><span class="mi">2</span><span class="w">   </span><span class="mi">2</span><span class="w"> </span><span class="err">││</span>
<span class="err">│</span><span class="w">  </span><span class="err">│</span><span class="w">   </span><span class="n">P2</span><span class="w">    </span><span class="err">│</span><span class="w">   </span><span class="mi">3</span><span class="w">   </span><span class="mi">0</span><span class="w">   </span><span class="mi">2</span><span class="w">    </span><span class="err">│</span><span class="w">  </span><span class="mi">9</span><span class="w">   </span><span class="mi">0</span><span class="w">   </span><span class="mi">2</span><span class="w">  </span><span class="err">│</span><span class="w">  </span><span class="mi">6</span><span class="w">   </span><span class="mi">0</span><span class="w">   </span><span class="mi">0</span><span class="w"> </span><span class="err">││</span>
<span class="err">│</span><span class="w">  </span><span class="err">│</span><span class="w">   </span><span class="n">P3</span><span class="w">    </span><span class="err">│</span><span class="w">   </span><span class="mi">2</span><span class="w">   </span><span class="mi">1</span><span class="w">   </span><span class="mi">1</span><span class="w">    </span><span class="err">│</span><span class="w">  </span><span class="mi">2</span><span class="w">   </span><span class="mi">2</span><span class="w">   </span><span class="mi">2</span><span class="w">  </span><span class="err">│</span><span class="w">  </span><span class="mi">0</span><span class="w">   </span><span class="mi">1</span><span class="w">   </span><span class="mi">1</span><span class="w"> </span><span class="err">││</span>
<span class="err">│</span><span class="w">  </span><span class="err">│</span><span class="w">   </span><span class="n">P4</span><span class="w">    </span><span class="err">│</span><span class="w">   </span><span class="mi">0</span><span class="w">   </span><span class="mi">0</span><span class="w">   </span><span class="mi">2</span><span class="w">    </span><span class="err">│</span><span class="w">  </span><span class="mi">4</span><span class="w">   </span><span class="mi">3</span><span class="w">   </span><span class="mi">3</span><span class="w">  </span><span class="err">│</span><span class="w">  </span><span class="mi">4</span><span class="w">   </span><span class="mi">3</span><span class="w">   </span><span class="mi">1</span><span class="w"> </span><span class="err">││</span>
<span class="err">│</span><span class="w">  </span><span class="err">└─────────┴────────────────┴─────────────┴────────────┘│</span>
<span class="err">│</span><span class="w">                                                         </span><span class="err">│</span>
<span class="err">│</span><span class="w">  </span><span class="n">Available</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">[</span><span class="n">3, 3, 2</span><span class="o">]</span><span class="w">  </span><span class="p">(</span><span class="nl">A</span><span class="p">:</span><span class="mi">3</span><span class="p">,</span><span class="w"> </span><span class="nl">B</span><span class="p">:</span><span class="mi">3</span><span class="p">,</span><span class="w"> </span><span class="nl">C</span><span class="p">:</span><span class="mi">2</span><span class="w"> </span><span class="n">사용</span><span class="w"> </span><span class="n">가능</span><span class="p">)</span><span class="w">      </span><span class="err">│</span>
<span class="err">│</span><span class="w">                                                         </span><span class="err">│</span>
<span class="err">│</span><span class="w">  </span><span class="n">안전성</span><span class="w"> </span><span class="nl">검사</span><span class="p">:</span><span class="w">                                           </span><span class="err">│</span>
<span class="err">│</span><span class="w">  </span><span class="mf">1.</span><span class="w"> </span><span class="n">Need</span><span class="o">[</span><span class="n">P1</span><span class="o">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">[</span><span class="n">1,2,2</span><span class="o">]</span><span class="w"> </span><span class="err">≤</span><span class="w"> </span><span class="n">Available</span><span class="o">[</span><span class="n">3,3,2</span><span class="o">]</span><span class="w"> </span><span class="err">→</span><span class="w"> </span><span class="n">P1</span><span class="w"> </span><span class="n">실행</span><span class="w"> </span><span class="n">가능</span><span class="err">│</span>
<span class="err">│</span><span class="w">     </span><span class="n">P1</span><span class="w"> </span><span class="n">완료</span><span class="w"> </span><span class="n">후</span><span class="w"> </span><span class="n">Available</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">[</span><span class="n">3,3,2</span><span class="o">]</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="o">[</span><span class="n">2,0,0</span><span class="o">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">[</span><span class="n">5,3,2</span><span class="o">]</span><span class="w">  </span><span class="err">│</span>
<span class="err">│</span><span class="w">                                                         </span><span class="err">│</span>
<span class="err">│</span><span class="w">  </span><span class="mf">2.</span><span class="w"> </span><span class="n">Need</span><span class="o">[</span><span class="n">P3</span><span class="o">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">[</span><span class="n">0,1,1</span><span class="o">]</span><span class="w"> </span><span class="err">≤</span><span class="w"> </span><span class="n">Available</span><span class="o">[</span><span class="n">5,3,2</span><span class="o">]</span><span class="w"> </span><span class="err">→</span><span class="w"> </span><span class="n">P3</span><span class="w"> </span><span class="n">실행</span><span class="w"> </span><span class="n">가능</span><span class="err">│</span>
<span class="err">│</span><span class="w">     </span><span class="n">P3</span><span class="w"> </span><span class="n">완료</span><span class="w"> </span><span class="n">후</span><span class="w"> </span><span class="n">Available</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">[</span><span class="n">5,3,2</span><span class="o">]</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="o">[</span><span class="n">2,1,1</span><span class="o">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">[</span><span class="n">7,4,3</span><span class="o">]</span><span class="w">  </span><span class="err">│</span>
<span class="err">│</span><span class="w">                                                         </span><span class="err">│</span>
<span class="err">│</span><span class="w">  </span><span class="mf">3.</span><span class="w"> </span><span class="n">Need</span><span class="o">[</span><span class="n">P4</span><span class="o">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">[</span><span class="n">4,3,1</span><span class="o">]</span><span class="w"> </span><span class="err">≤</span><span class="w"> </span><span class="n">Available</span><span class="o">[</span><span class="n">7,4,3</span><span class="o">]</span><span class="w"> </span><span class="err">→</span><span class="w"> </span><span class="n">P4</span><span class="w"> </span><span class="n">실행</span><span class="w"> </span><span class="n">가능</span><span class="err">│</span>
<span class="err">│</span><span class="w">     </span><span class="n">P4</span><span class="w"> </span><span class="n">완료</span><span class="w"> </span><span class="n">후</span><span class="w"> </span><span class="n">Available</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">[</span><span class="n">7,4,3</span><span class="o">]</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="o">[</span><span class="n">0,0,2</span><span class="o">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">[</span><span class="n">7,4,5</span><span class="o">]</span><span class="w">  </span><span class="err">│</span>
<span class="err">│</span><span class="w">                                                         </span><span class="err">│</span>
<span class="err">│</span><span class="w">  </span><span class="mf">4.</span><span class="w"> </span><span class="n">Need</span><span class="o">[</span><span class="n">P0</span><span class="o">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">[</span><span class="n">7,4,3</span><span class="o">]</span><span class="w"> </span><span class="err">≤</span><span class="w"> </span><span class="n">Available</span><span class="o">[</span><span class="n">7,4,5</span><span class="o">]</span><span class="w"> </span><span class="err">→</span><span class="w"> </span><span class="n">P0</span><span class="w"> </span><span class="n">실행</span><span class="w"> </span><span class="n">가능</span><span class="err">│</span>
<span class="err">│</span><span class="w">     </span><span class="n">P0</span><span class="w"> </span><span class="n">완료</span><span class="w"> </span><span class="n">후</span><span class="w"> </span><span class="n">Available</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">[</span><span class="n">7,4,5</span><span class="o">]</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="o">[</span><span class="n">0,1,0</span><span class="o">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">[</span><span class="n">7,5,5</span><span class="o">]</span><span class="w">  </span><span class="err">│</span>
<span class="err">│</span><span class="w">                                                         </span><span class="err">│</span>
<span class="err">│</span><span class="w">  </span><span class="mf">5.</span><span class="w"> </span><span class="n">Need</span><span class="o">[</span><span class="n">P2</span><span class="o">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">[</span><span class="n">6,0,0</span><span class="o">]</span><span class="w"> </span><span class="err">≤</span><span class="w"> </span><span class="n">Available</span><span class="o">[</span><span class="n">7,5,5</span><span class="o">]</span><span class="w"> </span><span class="err">→</span><span class="w"> </span><span class="n">P2</span><span class="w"> </span><span class="n">실행</span><span class="w"> </span><span class="n">가능</span><span class="err">│</span>
<span class="err">│</span><span class="w">                                                         </span><span class="err">│</span>
<span class="err">│</span><span class="w">  </span><span class="n">안전</span><span class="w"> </span><span class="nl">순서</span><span class="p">:</span><span class="w"> </span><span class="o">&lt;</span><span class="n">P1</span><span class="p">,</span><span class="w"> </span><span class="n">P3</span><span class="p">,</span><span class="w"> </span><span class="n">P4</span><span class="p">,</span><span class="w"> </span><span class="n">P0</span><span class="p">,</span><span class="w"> </span><span class="n">P2</span><span class="o">&gt;</span><span class="w">                       </span><span class="err">│</span>
<span class="err">│</span><span class="w">  </span><span class="err">→</span><span class="w"> </span><span class="n">시스템은</span><span class="w"> </span><span class="n">안전</span><span class="w"> </span><span class="n">상태</span><span class="w">                                   </span><span class="err">│</span>
<span class="err">│</span><span class="w">                                                         </span><span class="err">│</span>
<span class="err">└─────────────────────────────────────────────────────────┘</span>
</code></pre></div>

<h3 id="_16">은행원 알고리즘 코드<a class="header-link" href="#_16" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;stdio.h&gt;</span>
<span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;stdbool.h&gt;</span>

<span class="cp">#define P 5  </span><span class="c1">// 프로세스 수</span>
<span class="cp">#define R 3  </span><span class="c1">// 자원 유형 수</span>

<span class="kt">int</span><span class="w"> </span><span class="n">available</span><span class="p">[</span><span class="n">R</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span><span class="mi">3</span><span class="p">,</span><span class="w"> </span><span class="mi">3</span><span class="p">,</span><span class="w"> </span><span class="mi">2</span><span class="p">};</span>
<span class="kt">int</span><span class="w"> </span><span class="n">maximum</span><span class="p">[</span><span class="n">P</span><span class="p">][</span><span class="n">R</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="p">{</span><span class="mi">7</span><span class="p">,</span><span class="w"> </span><span class="mi">5</span><span class="p">,</span><span class="w"> </span><span class="mi">3</span><span class="p">},</span>
<span class="w">    </span><span class="p">{</span><span class="mi">3</span><span class="p">,</span><span class="w"> </span><span class="mi">2</span><span class="p">,</span><span class="w"> </span><span class="mi">2</span><span class="p">},</span>
<span class="w">    </span><span class="p">{</span><span class="mi">9</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="mi">2</span><span class="p">},</span>
<span class="w">    </span><span class="p">{</span><span class="mi">2</span><span class="p">,</span><span class="w"> </span><span class="mi">2</span><span class="p">,</span><span class="w"> </span><span class="mi">2</span><span class="p">},</span>
<span class="w">    </span><span class="p">{</span><span class="mi">4</span><span class="p">,</span><span class="w"> </span><span class="mi">3</span><span class="p">,</span><span class="w"> </span><span class="mi">3</span><span class="p">}</span>
<span class="p">};</span>
<span class="kt">int</span><span class="w"> </span><span class="n">allocation</span><span class="p">[</span><span class="n">P</span><span class="p">][</span><span class="n">R</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="p">{</span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">},</span>
<span class="w">    </span><span class="p">{</span><span class="mi">2</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">},</span>
<span class="w">    </span><span class="p">{</span><span class="mi">3</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="mi">2</span><span class="p">},</span>
<span class="w">    </span><span class="p">{</span><span class="mi">2</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="p">},</span>
<span class="w">    </span><span class="p">{</span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="mi">2</span><span class="p">}</span>
<span class="p">};</span>

<span class="c1">// Need 계산</span>
<span class="kt">int</span><span class="w"> </span><span class="n">need</span><span class="p">[</span><span class="n">P</span><span class="p">][</span><span class="n">R</span><span class="p">];</span>

<span class="kt">void</span><span class="w"> </span><span class="nf">calculate_need</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="n">P</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="o">++</span><span class="p">)</span>
<span class="w">        </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">j</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w"> </span><span class="n">j</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="n">R</span><span class="p">;</span><span class="w"> </span><span class="n">j</span><span class="o">++</span><span class="p">)</span>
<span class="w">            </span><span class="n">need</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">j</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">maximum</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">j</span><span class="p">]</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">allocation</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">j</span><span class="p">];</span>
<span class="p">}</span>

<span class="kt">bool</span><span class="w"> </span><span class="nf">is_safe</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="kt">int</span><span class="w"> </span><span class="n">work</span><span class="p">[</span><span class="n">R</span><span class="p">];</span>
<span class="w">    </span><span class="kt">bool</span><span class="w"> </span><span class="n">finish</span><span class="p">[</span><span class="n">P</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span><span class="nb">false</span><span class="p">};</span>
<span class="w">    </span><span class="kt">int</span><span class="w"> </span><span class="n">safe_sequence</span><span class="p">[</span><span class="n">P</span><span class="p">];</span>
<span class="w">    </span><span class="kt">int</span><span class="w"> </span><span class="n">count</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>

<span class="w">    </span><span class="c1">// work = available 복사</span>
<span class="w">    </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="n">R</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="o">++</span><span class="p">)</span>
<span class="w">        </span><span class="n">work</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">available</span><span class="p">[</span><span class="n">i</span><span class="p">];</span>

<span class="w">    </span><span class="k">while</span><span class="w"> </span><span class="p">(</span><span class="n">count</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="n">P</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="kt">bool</span><span class="w"> </span><span class="n">found</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">false</span><span class="p">;</span>
<span class="w">        </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="n">P</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="o">++</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="o">!</span><span class="n">finish</span><span class="p">[</span><span class="n">i</span><span class="p">])</span><span class="w"> </span><span class="p">{</span>
<span class="w">                </span><span class="c1">// need[i] &lt;= work 검사</span>
<span class="w">                </span><span class="kt">bool</span><span class="w"> </span><span class="n">can_allocate</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">true</span><span class="p">;</span>
<span class="w">                </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">j</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w"> </span><span class="n">j</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="n">R</span><span class="p">;</span><span class="w"> </span><span class="n">j</span><span class="o">++</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">                    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">need</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">j</span><span class="p">]</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="n">work</span><span class="p">[</span><span class="n">j</span><span class="p">])</span><span class="w"> </span><span class="p">{</span>
<span class="w">                        </span><span class="n">can_allocate</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">false</span><span class="p">;</span>
<span class="w">                        </span><span class="k">break</span><span class="p">;</span>
<span class="w">                    </span><span class="p">}</span>
<span class="w">                </span><span class="p">}</span>

<span class="w">                </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">can_allocate</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">                    </span><span class="c1">// 자원 회수 시뮬레이션</span>
<span class="w">                    </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">j</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w"> </span><span class="n">j</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="n">R</span><span class="p">;</span><span class="w"> </span><span class="n">j</span><span class="o">++</span><span class="p">)</span>
<span class="w">                        </span><span class="n">work</span><span class="p">[</span><span class="n">j</span><span class="p">]</span><span class="w"> </span><span class="o">+=</span><span class="w"> </span><span class="n">allocation</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">j</span><span class="p">];</span>
<span class="w">                    </span><span class="n">finish</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">true</span><span class="p">;</span>
<span class="w">                    </span><span class="n">safe_sequence</span><span class="p">[</span><span class="n">count</span><span class="o">++</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">i</span><span class="p">;</span>
<span class="w">                    </span><span class="n">found</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">true</span><span class="p">;</span>
<span class="w">                </span><span class="p">}</span>
<span class="w">            </span><span class="p">}</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="o">!</span><span class="n">found</span><span class="p">)</span>
<span class="w">            </span><span class="k">return</span><span class="w"> </span><span class="nb">false</span><span class="p">;</span><span class="w">  </span><span class="c1">// 안전 순서 없음</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="n">printf</span><span class="p">(</span><span class="s">&quot;안전 순서: &quot;</span><span class="p">);</span>
<span class="w">    </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="n">P</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="o">++</span><span class="p">)</span>
<span class="w">        </span><span class="n">printf</span><span class="p">(</span><span class="s">&quot;P%d &quot;</span><span class="p">,</span><span class="w"> </span><span class="n">safe_sequence</span><span class="p">[</span><span class="n">i</span><span class="p">]);</span>
<span class="w">    </span><span class="n">printf</span><span class="p">(</span><span class="s">&quot;</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="nb">true</span><span class="p">;</span>
<span class="p">}</span>

<span class="kt">int</span><span class="w"> </span><span class="nf">main</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="n">calculate_need</span><span class="p">();</span>

<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">is_safe</span><span class="p">())</span>
<span class="w">        </span><span class="n">printf</span><span class="p">(</span><span class="s">&quot;시스템은 안전 상태입니다.</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span>
<span class="w">    </span><span class="k">else</span>
<span class="w">        </span><span class="n">printf</span><span class="p">(</span><span class="s">&quot;시스템은 불안전 상태입니다!</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span>

<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></div>

<hr />
<h2 id="6">6. 데드락 탐지와 복구<a class="header-link" href="#6" title="Permanent link">&para;</a></h2>
<h3 id="_17">탐지 알고리즘<a class="header-link" href="#_17" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code>┌─────────────────────────────────────────────────────────┐
│<span class="w">                  </span>데드락<span class="w"> </span>탐지<span class="w"> </span>알고리즘<span class="w">                    </span>│
├─────────────────────────────────────────────────────────┤
│<span class="w">                                                         </span>│
│<span class="w">  </span>단일<span class="w"> </span>인스턴스<span class="w"> </span>자원:<span class="w">                                    </span>│
│<span class="w">  </span>┌───────────────────────────────────────────────────┐<span class="w">  </span>│
│<span class="w">  </span>│<span class="w">  </span>대기<span class="w"> </span>그래프<span class="w"> </span><span class="ss">(</span><span class="k">Wait</span><span class="o">-</span><span class="k">for</span><span class="w"> </span><span class="nv">Graph</span><span class="ss">)</span><span class="w"> </span>사용<span class="w">                 </span>│<span class="w">  </span>│
│<span class="w">  </span>│<span class="w">                                                   </span>│<span class="w">  </span>│
│<span class="w">  </span>│<span class="w">  </span>자원<span class="w"> </span>할당<span class="w"> </span>그래프에서<span class="w"> </span>자원<span class="w"> </span>노드<span class="w"> </span>제거:<span class="w">              </span>│<span class="w">  </span>│
│<span class="w">  </span>│<span class="w">                                                   </span>│<span class="w">  </span>│
│<span class="w">  </span>│<span class="w">  </span><span class="nv">Pi</span><span class="w"> </span>→<span class="w"> </span><span class="nv">Rq</span><span class="w"> </span>→<span class="w"> </span><span class="nv">Pj</span><span class="w">  </span>변환→<span class="w">  </span><span class="nv">Pi</span><span class="w"> </span>→<span class="w"> </span><span class="nv">Pj</span><span class="w">                    </span>│<span class="w">  </span>│
│<span class="w">  </span>│<span class="w">  </span><span class="ss">(</span><span class="nv">Pi</span>가<span class="w"> </span><span class="nv">Rq</span>를<span class="w"> </span>요청,<span class="w"> </span><span class="nv">Rq</span>가<span class="w"> </span><span class="nv">Pj</span>에게<span class="w"> </span>할당<span class="ss">)</span><span class="w">               </span>│<span class="w">  </span>│
│<span class="w">  </span>│<span class="w">                                                   </span>│<span class="w">  </span>│
│<span class="w">  </span>│<span class="w">  </span>대기<span class="w"> </span>그래프에<span class="w"> </span>사이클<span class="w"> </span>→<span class="w"> </span>데드락<span class="w">                    </span>│<span class="w">  </span>│
│<span class="w">  </span>└───────────────────────────────────────────────────┘<span class="w">  </span>│
│<span class="w">                                                         </span>│
│<span class="w">  </span>다중<span class="w"> </span>인스턴스<span class="w"> </span>자원:<span class="w">                                    </span>│
│<span class="w">  </span>┌───────────────────────────────────────────────────┐<span class="w">  </span>│
│<span class="w">  </span>│<span class="w">  </span>은행원<span class="w"> </span>알고리즘과<span class="w"> </span>유사한<span class="w"> </span>방식<span class="w"> </span>사용<span class="w">                </span>│<span class="w">  </span>│
│<span class="w">  </span>│<span class="w">  </span>현재<span class="w"> </span>요청을<span class="w"> </span>기준으로<span class="w"> </span>안전성<span class="w"> </span>검사<span class="w">                  </span>│<span class="w">  </span>│
│<span class="w">  </span>│<span class="w">  </span>데드락<span class="w"> </span>상태인<span class="w"> </span>프로세스<span class="w"> </span>집합<span class="w"> </span>식별<span class="w">                  </span>│<span class="w">  </span>│
│<span class="w">  </span>└───────────────────────────────────────────────────┘<span class="w">  </span>│
│<span class="w">                                                         </span>│
│<span class="w">  </span>탐지<span class="w"> </span>빈도:<span class="w">                                             </span>│
│<span class="w">  </span>•<span class="w"> </span>자원<span class="w"> </span>요청마다<span class="w"> </span>→<span class="w"> </span>오버헤드<span class="w"> </span>높음<span class="w">                       </span>│
│<span class="w">  </span>•<span class="w"> </span>주기적으로<span class="w"> </span><span class="ss">(</span>예:<span class="w"> </span><span class="mi">5</span>분마다<span class="ss">)</span><span class="w">                            </span>│
│<span class="w">  </span>•<span class="w"> </span><span class="nv">CPU</span><span class="w"> </span>이용률이<span class="w"> </span>낮아질<span class="w"> </span>때<span class="w">                              </span>│
│<span class="w">                                                         </span>│
└─────────────────────────────────────────────────────────┘
</code></pre></div>

<h3 id="_18">대기 그래프 예시<a class="header-link" href="#_18" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code>┌─────────────────────────────────────────────────────────┐
│                   대기 그래프 예시                       │
├─────────────────────────────────────────────────────────┤
│                                                         │
│  자원 할당 그래프:              대기 그래프:            │
│                                                         │
│     ○P1 ─요청─▶ □R1           ○P1 ─────────┐          │
│         ↑      ↓ 할당              ↓        │          │
│    할당 │      ○P2              ○P2 ◀───────┘          │
│         │       ↓ 요청              ↓                  │
│       □R2 ◀────┘               ○P3 ────────┐          │
│         ↓ 할당                      ↓        │          │
│        ○P3 ─요청─▶ □R3 ◀할당─ ○P4      ○P4 ◀────┘   │
│                                                         │
│  R1 → P2 → R2 → P3 → R3 ← P4                          │
│                                                         │
│  대기 그래프:                                           │
│  P1 → P2 → P3 → P4 → P3 (사이클!)                     │
│                                                         │
│  → 데드락 발생 (P3, P4가 데드락 상태)                  │
│                                                         │
└─────────────────────────────────────────────────────────┘
</code></pre></div>

<h3 id="_19">데드락 복구 방법<a class="header-link" href="#_19" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code>┌─────────────────────────────────────────────────────────┐
│                  데드락 복구 방법                        │
├─────────────────────────────────────────────────────────┤
│                                                         │
│  1. 프로세스 종료 (Process Termination)                 │
│  ┌───────────────────────────────────────────────────┐  │
│  │  방법 1: 모든 데드락 프로세스 종료                  │  │
│  │    • 확실하지만 비용이 큼                          │  │
│  │    • 오래 실행된 프로세스도 종료됨                 │  │
│  │                                                   │  │
│  │  방법 2: 한 번에 하나씩 종료                       │  │
│  │    • 종료 후 데드락 재검사                         │  │
│  │    • 선택 기준: 우선순위, 실행시간, 자원 사용량     │  │
│  └───────────────────────────────────────────────────┘  │
│                                                         │
│  2. 자원 선점 (Resource Preemption)                     │
│  ┌───────────────────────────────────────────────────┐  │
│  │  • 프로세스의 자원을 강제로 빼앗아 다른 프로세스에  │  │
│  │    할당                                           │  │
│  │                                                   │  │
│  │  고려 사항:                                       │  │
│  │  • 희생자 선택: 어떤 프로세스의 자원을 선점할지    │  │
│  │  • 롤백: 선점된 프로세스를 안전한 상태로 복구      │  │
│  │  • 기아 방지: 같은 프로세스가 계속 희생되지 않도록 │  │
│  └───────────────────────────────────────────────────┘  │
│                                                         │
│  3. 체크포인트/복구 (Checkpoint/Recovery)               │
│  ┌───────────────────────────────────────────────────┐  │
│  │  • 주기적으로 프로세스 상태 저장 (체크포인트)      │  │
│  │  • 데드락 발생 시 이전 체크포인트로 롤백           │  │
│  │  • 데이터베이스 시스템에서 주로 사용               │  │
│  └───────────────────────────────────────────────────┘  │
│                                                         │
└─────────────────────────────────────────────────────────┘
</code></pre></div>

<h3 id="_20">데드락 처리 방법 비교<a class="header-link" href="#_20" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code>┌──────────────┬──────────────┬──────────────┬───────────────┐
│     방법      │    오버헤드   │   자원 이용률 │   구현 복잡도  │
├──────────────┼──────────────┼──────────────┼───────────────┤
│ 예방         │ 높음         │ 낮음         │ 낮음          │
│ (Prevention) │              │              │               │
├──────────────┼──────────────┼──────────────┼───────────────┤
│ 회피         │ 높음         │ 중간         │ 높음          │
│ (Avoidance) │              │              │               │
├──────────────┼──────────────┼──────────────┼───────────────┤
│ 탐지/복구    │ 중간         │ 높음         │ 중간          │
│ (Detection) │              │              │               │
├──────────────┼──────────────┼──────────────┼───────────────┤
│ 무시         │ 없음         │ 최고         │ 없음          │
│ (Ostrich)   │              │              │               │
└──────────────┴──────────────┴──────────────┴───────────────┘

무시 (Ostrich Algorithm):
• 데드락이 드물게 발생한다고 가정
• 발생하면 수동으로 재부팅
• Unix, Linux, Windows 등 대부분의 OS가 채택
• 현실적인 접근법
</code></pre></div>

<hr />
<h2 id="7">7. 연습 문제<a class="header-link" href="#7" title="Permanent link">&para;</a></h2>
<h3 id="1_1">문제 1: 데드락 필요조건<a class="header-link" href="#1_1" title="Permanent link">&para;</a></h3>
<p>다음 중 데드락의 네 가지 필요조건에 해당하지 않는 것은?</p>
<p>A. 상호 배제
B. 순환 대기
C. 우선순위 역전
D. 비선점
E. 점유와 대기</p>
<details>
<summary>정답 보기</summary>

**정답: C. 우선순위 역전**

데드락의 네 가지 필요조건:
1. 상호 배제 (Mutual Exclusion)
2. 점유와 대기 (Hold and Wait)
3. 비선점 (No Preemption)
4. 순환 대기 (Circular Wait)

우선순위 역전은 데드락과는 다른 동시성 문제입니다.

</details>

<h3 id="2_1">문제 2: 자원 할당 그래프<a class="header-link" href="#2_1" title="Permanent link">&para;</a></h3>
<p>다음 자원 할당 그래프가 데드락 상태인지 판별하세요.</p>
<div class="highlight"><pre><span></span><code>P1 → R1, R1 → P2
P2 → R2, R2 → P3
P3 → R1
</code></pre></div>

<details>
<summary>정답 보기</summary>

**분석:**
- P1이 R1 요청
- R1이 P2에게 할당됨
- P2가 R2 요청
- R2가 P3에게 할당됨
- P3가 R1 요청

**대기 관계:**
- P1 → P2 (R1 때문에)
- P2 → P3 (R2 때문에)
- P3 → P2 (R1 때문에, R1은 P2가 보유)

**사이클:** P2 → P3 → P2

**결론: 데드락 상태** (단, 각 자원이 단일 인스턴스라고 가정)

</details>

<h3 id="3_1">문제 3: 은행원 알고리즘<a class="header-link" href="#3_1" title="Permanent link">&para;</a></h3>
<p>다음 상태에서 시스템이 안전 상태인지 확인하세요.</p>
<p>Available = [1, 1, 2]</p>
<table>
<thead>
<tr>
<th>Process</th>
<th>Allocation</th>
<th>Max</th>
</tr>
</thead>
<tbody>
<tr>
<td>P0</td>
<td>(0,1,0)</td>
<td>(2,2,2)</td>
</tr>
<tr>
<td>P1</td>
<td>(1,0,0)</td>
<td>(1,1,2)</td>
</tr>
<tr>
<td>P2</td>
<td>(0,0,1)</td>
<td>(1,2,3)</td>
</tr>
</tbody>
</table>
<details>
<summary>정답 보기</summary>

**Need 계산:**
- P0: (2,2,2) - (0,1,0) = (2,1,2)
- P1: (1,1,2) - (1,0,0) = (0,1,2)
- P2: (1,2,3) - (0,0,1) = (1,2,2)

**안전성 검사:**
1. Available = [1,1,2]
2. Need[P1] = [0,1,2] <= [1,1,2]? Yes!
   - P1 실행 후: Available = [1,1,2] + [1,0,0] = [2,1,2]
3. Need[P0] = [2,1,2] <= [2,1,2]? Yes!
   - P0 실행 후: Available = [2,1,2] + [0,1,0] = [2,2,2]
4. Need[P2] = [1,2,2] <= [2,2,2]? Yes!
   - P2 실행 후: 완료

**안전 순서: <P1, P0, P2>**
**결론: 안전 상태**

</details>

<h3 id="4_1">문제 4: 순환 대기 예방<a class="header-link" href="#4_1" title="Permanent link">&para;</a></h3>
<p>순환 대기를 예방하기 위해 자원에 순서를 부여하는 방법을 설명하고, 왜 이 방법이 데드락을 방지하는지 증명하세요.</p>
<details>
<summary>정답 보기</summary>

**방법:**
- 모든 자원 유형에 고유한 순서 번호 부여
- 프로세스는 반드시 오름차순으로만 자원 요청

**증명:**
순환 대기가 발생하려면:
P0 → R(i0) → P1 → R(i1) → ... → Pn → R(in) → P0

각 화살표는 "보유 후 요청"을 의미:
- P0가 R(i0)를 보유하고 있고 P1이 R(i0)를 기다림
- P1이 R(i1)을 보유하고 P2가 R(i1)을 기다림
- ...
- Pn이 R(in)을 보유하고 P0가 R(in)을 기다림

오름차순 규칙에 따르면:
- P0가 R(in)을 요청하려면 i0 < in 이어야 함
- 하지만 순환이면 in < i0 < i1 < ... < in (모순!)

따라서 순환 대기 불가능 → 데드락 불가능

</details>

<h3 id="5_1">문제 5: 데드락 복구<a class="header-link" href="#5_1" title="Permanent link">&para;</a></h3>
<p>데드락이 발생했을 때 "한 번에 하나씩 프로세스 종료" 방법을 사용할 경우, 어떤 기준으로 희생자를 선택해야 하는지 설명하세요.</p>
<details>
<summary>정답 보기</summary>

**희생자 선택 기준:**

1. **프로세스 우선순위**
   - 낮은 우선순위 프로세스 먼저 종료

2. **실행 시간**
   - 짧게 실행된 프로세스 종료 (손실 최소화)
   - 또는 거의 완료된 프로세스는 보호

3. **사용 자원량**
   - 많은 자원을 보유한 프로세스 종료 (더 많은 자원 확보)

4. **완료까지 남은 자원**
   - 많은 자원이 더 필요한 프로세스 종료

5. **프로세스 유형**
   - 배치 작업보다 대화형 프로세스 우선 보호

6. **기아 방지**
   - 같은 프로세스가 반복적으로 희생되지 않도록
   - 종료 횟수 카운트 및 제한

**최적 선택:** 위 기준들의 가중 합으로 비용 함수 정의 후 최소 비용 프로세스 선택

</details>

<hr />
<h2 id="_21">다음 단계<a class="header-link" href="#_21" title="Permanent link">&para;</a></h2>
<p>이것으로 프로세스 동기화 파트가 완료되었습니다. 다음 학습 주제:
- <a href="./10_Memory_Management_Basics.md">10_Memory_Management_Basics.md</a> - 메모리 관리 (예정)</p>
<hr />
<h2 id="_22">참고 자료<a class="header-link" href="#_22" title="Permanent link">&para;</a></h2>
<ul>
<li><a href="https://pages.cs.wisc.edu/~remzi/OSTEP/threads-bugs.pdf">OSTEP - Deadlock</a></li>
<li><a href="https://www.os-book.com/">Operating System Concepts - Chapter 7</a></li>
<li><a href="https://www.cs.uic.edu/~jbell/CourseNotes/OperatingSystems/7_Deadlocks.html">Banker's Algorithm Visualization</a></li>
</ul>
    </div>

    
<div class="lesson-toolbar lesson-toolbar--bottom">
    <div class="toolbar-nav toolbar-nav--prev">
        
        <a href="/study/ko/OS_Theory/08_Synchronization_Tools.html" class="nav-prev">
            <span class="nav-label">Previous</span>
            <span class="nav-title">동기화 도구</span>
        </a>
        
    </div>
    <div class="toolbar-actions">
        <button class="btn btn-copy-link" data-action="copy-link" title="Copy link">
            <span class="icon">🔗</span>
            <span class="text">Copy link</span>
        </button>
        <a href="/study/ko/OS_Theory/" class="btn btn-topic-link" title="Back to topic list">
            <span class="icon">📋</span>
            <span class="text">Topic list</span>
        </a>
    </div>
    <div class="toolbar-nav toolbar-nav--next">
        
        <a href="/study/ko/OS_Theory/10_Memory_Management_Basics.html" class="nav-next">
            <span class="nav-label">Next</span>
            <span class="nav-title">메모리 관리 기초 ⭐⭐</span>
        </a>
        
    </div>
</div>


    <div class="toolbar-keyboard-hint">
        <kbd>&larr;</kbd> <kbd>&rarr;</kbd> to navigate between lessons
    </div>
</article>

<!-- Scroll to top floating button -->
<button class="scroll-to-top" id="scroll-to-top" title="Scroll to top" aria-label="Scroll to top">↑</button>

            </div>
        </main>
    </div>

    <script src="/study/static/js/app.js"></script>
    <script>
        function switchLanguage(newLang) {
            const path = window.location.pathname;
            const base = '/study';
            const currentLang = 'ko';
            const newPath = path.replace(base + '/' + currentLang + '/', base + '/' + newLang + '/');
            window.location.href = newPath + window.location.search;
        }
    </script>
    
<script>
    document.addEventListener('DOMContentLoaded', function() {
        // Copy link - independent feedback per button
        document.querySelectorAll('[data-action="copy-link"]').forEach(function(btn) {
            btn.addEventListener('click', function() {
                navigator.clipboard.writeText(window.location.href);
                var textEl = this.querySelector('.text');
                var originalText = textEl.textContent;
                textEl.textContent = 'Copied!';
                setTimeout(function() { textEl.textContent = originalText; }, 2000);
            });
        });

        // Add copy buttons to code blocks
        document.querySelectorAll('.lesson-content pre').forEach(function(pre) {
            var copyBtn = document.createElement('button');
            copyBtn.className = 'code-copy-btn';
            copyBtn.textContent = 'Copy';
            copyBtn.addEventListener('click', function() {
                var code = pre.querySelector('code');
                var text = code ? code.textContent : pre.textContent;
                navigator.clipboard.writeText(text);
                copyBtn.textContent = 'Copied!';
                setTimeout(function() { copyBtn.textContent = 'Copy'; }, 2000);
            });
            pre.style.position = 'relative';
            pre.appendChild(copyBtn);
        });

        // Scroll to top button
        var scrollBtn = document.getElementById('scroll-to-top');
        window.addEventListener('scroll', function() {
            scrollBtn.classList.toggle('visible', window.scrollY > 300);
        });
        scrollBtn.addEventListener('click', function() {
            window.scrollTo({ top: 0, behavior: 'smooth' });
        });

        // Keyboard shortcuts: left/right arrows for lesson navigation
        document.addEventListener('keydown', function(e) {
            var tag = document.activeElement.tagName;
            if (tag === 'INPUT' || tag === 'TEXTAREA' || tag === 'SELECT') return;

            if (e.key === 'ArrowLeft') {
                var prevLink = document.querySelector('.nav-prev');
                if (prevLink) prevLink.click();
            } else if (e.key === 'ArrowRight') {
                var nextLink = document.querySelector('.nav-next');
                if (nextLink) nextLink.click();
            }
        });
    });
</script>

</body>
</html>
{% endraw %}