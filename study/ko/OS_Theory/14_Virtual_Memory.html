{% raw %}
<!DOCTYPE html>
<html lang="ko" data-theme="light">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>가상 메모리 ⭐⭐⭐ - Study Materials</title>
    <link rel="stylesheet" href="/study/static/css/style.css">
    <link rel="stylesheet" href="/study/static/css/highlight.css">
    <!-- KaTeX for LaTeX math rendering -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.16.11/dist/katex.min.css">
    <script defer src="https://cdn.jsdelivr.net/npm/katex@0.16.11/dist/katex.min.js"></script>
    <script defer src="https://cdn.jsdelivr.net/npm/katex@0.16.11/dist/contrib/auto-render.min.js"
        onload="renderMathInElement(document.body, {
            delimiters: [
                {left: '$$', right: '$$', display: true},
                {left: '$', right: '$', display: false}
            ],
            throwOnError: false
        });"></script>
    
</head>
<body>
    <div class="app-container">
        <!-- Sidebar -->
        <aside class="sidebar" id="sidebar">
            <div class="sidebar-header">
                <a href="/study/ko/" class="logo">Study Materials</a>
                <button class="sidebar-toggle" id="sidebar-toggle" aria-label="Toggle sidebar">
                    <span></span>
                </button>
            </div>

            <nav class="sidebar-nav">
                <a href="/study/ko/" class="nav-item ">
                    <span class="nav-icon">🏠</span>
                    <span class="nav-text">Home</span>
                </a>
                <a href="/study/examples/" class="nav-item ">
                    <span class="nav-icon">💻</span>
                    <span class="nav-text">Examples</span>
                </a>
            </nav>

            <div class="sidebar-search">
                <form action="/study/ko/search.html" method="get" id="search-form">
                    <input type="search" name="q" placeholder="Search..." id="search-sidebar-input">
                </form>
            </div>

            <!-- Language Selector -->
            <div class="sidebar-lang">
                <select id="lang-select" class="lang-selector" onchange="switchLanguage(this.value)">
                    
                    <option value="en" >
                        English
                    </option>
                    
                    <option value="ko" selected>
                        한국어
                    </option>
                    
                </select>
            </div>

            <div class="sidebar-footer">
                <button class="theme-toggle" id="theme-toggle" aria-label="Toggle theme">
                    <span class="theme-icon light">☀️</span>
                    <span class="theme-icon dark">🌙</span>
                </button>
            </div>
        </aside>

        <!-- Main Content -->
        <main class="main-content">
            <header class="main-header">
                <button class="menu-toggle" id="menu-toggle" aria-label="Open menu">
                    <span></span>
                </button>
                
<nav class="breadcrumb">
    <a href="/study/ko/">Topics</a>
    <span class="separator">/</span>
    <a href="/study/ko/OS_Theory/">OS Theory</a>
    <span class="separator">/</span>
    <span class="current">가상 메모리 ⭐⭐⭐</span>
</nav>

            </header>

            <div class="content">
                
<article class="lesson-article">
    <header class="lesson-header">
        <h1>가상 메모리 ⭐⭐⭐</h1>
    </header>

    
<div class="lesson-toolbar lesson-toolbar--top">
    <div class="toolbar-nav toolbar-nav--prev">
        
        <a href="/study/ko/OS_Theory/13_Segmentation.html" class="nav-prev">
            <span class="nav-label">Previous</span>
            <span class="nav-title">세그멘테이션 ⭐⭐⭐</span>
        </a>
        
    </div>
    <div class="toolbar-actions">
        <button class="btn btn-copy-link" data-action="copy-link" title="Copy link">
            <span class="icon">🔗</span>
            <span class="text">Copy link</span>
        </button>
        <a href="/study/ko/OS_Theory/" class="btn btn-topic-link" title="Back to topic list">
            <span class="icon">📋</span>
            <span class="text">Topic list</span>
        </a>
    </div>
    <div class="toolbar-nav toolbar-nav--next">
        
        <a href="/study/ko/OS_Theory/15_Page_Replacement.html" class="nav-next">
            <span class="nav-label">Next</span>
            <span class="nav-title">페이지 교체 ⭐⭐⭐⭐</span>
        </a>
        
    </div>
</div>


    
    <nav class="toc" id="toc">
        <h2>Table of Contents</h2>
        <div class="toc">
<ul>
<li><a href="#_2">개요</a></li>
<li><a href="#_3">목차</a></li>
<li><a href="#1">1. 가상 메모리의 개념</a><ul>
<li><a href="#11">1.1 가상 메모리란?</a></li>
<li><a href="#12">1.2 가상 메모리의 장점</a></li>
</ul>
</li>
<li><a href="#2">2. 요구 페이징</a><ul>
<li><a href="#21">2.1 개념</a></li>
<li><a href="#22">2.2 유효/무효 비트</a></li>
</ul>
</li>
<li><a href="#3">3. 페이지 폴트</a><ul>
<li><a href="#31-10">3.1 페이지 폴트 처리 과정 (10단계)</a></li>
<li><a href="#32">3.2 하드웨어 지원 요구사항</a></li>
<li><a href="#33">3.3 페이지 폴트 처리 코드 (의사 코드)</a></li>
</ul>
</li>
<li><a href="#4-copy-on-write">4. Copy-on-Write</a><ul>
<li><a href="#41">4.1 개념</a></li>
<li><a href="#42">4.2 쓰기 시 복사</a></li>
<li><a href="#43-cow">4.3 COW 구현</a></li>
</ul>
</li>
<li><a href="#5">5. 메모리 매핑 파일</a><ul>
<li><a href="#51-mmap">5.1 mmap() 개념</a></li>
<li><a href="#52-mmap">5.2 mmap() 사용 예제</a></li>
<li><a href="#53">5.3 매핑 옵션</a></li>
</ul>
</li>
<li><a href="#6">6. 성능 분석</a><ul>
<li><a href="#61">6.1 유효 접근 시간 (페이지 폴트 포함)</a></li>
<li><a href="#62">6.2 페이지 폴트 시간 분해</a></li>
</ul>
</li>
<li><a href="#_4">연습 문제</a><ul>
<li><a href="#1_1">문제 1: 페이지 폴트 시나리오</a></li>
<li><a href="#2-eat">문제 2: EAT 계산</a></li>
<li><a href="#3-copy-on-write">문제 3: Copy-on-Write</a></li>
<li><a href="#4-mmap">문제 4: mmap() 분석</a></li>
<li><a href="#5_1">문제 5: 요구 페이징 설계</a></li>
</ul>
</li>
<li><a href="#_5">다음 단계</a></li>
<li><a href="#_6">참고 자료</a></li>
</ul>
</div>

    </nav>
    

    <div class="lesson-content markdown-body">
        <h1 id="_1">가상 메모리 ⭐⭐⭐<a class="header-link" href="#_1" title="Permanent link">&para;</a></h1>
<h2 id="_2">개요<a class="header-link" href="#_2" title="Permanent link">&para;</a></h2>
<p>가상 메모리(Virtual Memory)는 물리 메모리보다 큰 프로그램을 실행할 수 있게 하는 메모리 관리 기법입니다. 요구 페이징, 페이지 폴트 처리, Copy-on-Write 등 핵심 개념을 학습합니다.</p>
<hr />
<h2 id="_3">목차<a class="header-link" href="#_3" title="Permanent link">&para;</a></h2>
<ol>
<li><a href="#1-가상-메모리의-개념">가상 메모리의 개념</a></li>
<li><a href="#2-요구-페이징">요구 페이징</a></li>
<li><a href="#3-페이지-폴트">페이지 폴트</a></li>
<li><a href="#4-copy-on-write">Copy-on-Write</a></li>
<li><a href="#5-메모리-매핑-파일">메모리 매핑 파일</a></li>
<li><a href="#6-성능-분석">성능 분석</a></li>
<li><a href="#연습-문제">연습 문제</a></li>
</ol>
<hr />
<h2 id="1">1. 가상 메모리의 개념<a class="header-link" href="#1" title="Permanent link">&para;</a></h2>
<h3 id="11">1.1 가상 메모리란?<a class="header-link" href="#11" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code>┌─────────────────────────────────────────────────────────────────────────┐
│                      가상 메모리 개념                                    │
├─────────────────────────────────────────────────────────────────────────┤
│                                                                          │
│   프로세스 관점:                        실제 상황:                       │
│                                                                          │
│   &quot;나는 4GB 메모리를                   물리 메모리: 2GB                 │
│    독점 사용한다!&quot;                     + 디스크 스왑: 8GB               │
│                                                                          │
│   ┌──────────────────┐                ┌──────────────────┐              │
│   │ 가상 주소 공간   │                │    물리 RAM      │              │
│   │    (4GB)        │                │     (2GB)        │              │
│   │                  │                │                  │              │
│   │ ┌──────────────┐ │    일부만     │ ┌──────────────┐ │              │
│   │ │ 페이지 0     │─┼───메모리에───▶│ │ 프레임 100   │ │              │
│   │ ├──────────────┤ │               │ ├──────────────┤ │              │
│   │ │ 페이지 1     │─┼─────────────▶│ │ 프레임 205   │ │              │
│   │ ├──────────────┤ │               │ ├──────────────┤ │              │
│   │ │ 페이지 2     │ │               │ │ 다른 프로세스 │ │              │
│   │ ├──────────────┤ │               │ │      ...     │ │              │
│   │ │     ...      │ │               │ └──────────────┘ │              │
│   │ │ (대부분      │ │                                   │              │
│   │ │  디스크에)   │ │               ┌──────────────────┐              │
│   │ ├──────────────┤ │               │    디스크        │              │
│   │ │ 페이지 N     │ │    나머지는   │  (스왑 영역)     │              │
│   │ └──────────────┘ │    디스크에   │                  │              │
│   └──────────────────┘       ──────▶ │ 페이지 2, 3...  │              │
│                                       └──────────────────┘              │
│                                                                          │
│   핵심: 자주 사용하는 부분만 메모리에, 나머지는 디스크에                │
│                                                                          │
└─────────────────────────────────────────────────────────────────────────┘
</code></pre></div>

<h3 id="12">1.2 가상 메모리의 장점<a class="header-link" href="#12" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code>┌─────────────────────────────────────────────────────────────────────────┐
│<span class="w">                      </span>가상<span class="w"> </span>메모리<span class="w"> </span>장점<span class="w">                                    </span>│
├─────────────────────────────────────────────────────────────────────────┤
│<span class="w">                                                                          </span>│
│<span class="w">  </span><span class="mi">1</span>.<span class="w"> </span>물리<span class="w"> </span>메모리보다<span class="w"> </span>큰<span class="w"> </span>프로그램<span class="w"> </span>실행<span class="w">                                    </span>│
│<span class="w">     </span><span class="o">-</span><span class="w"> </span><span class="mi">4</span><span class="nv">GB</span><span class="w"> </span>프로그램을<span class="w"> </span><span class="mi">2</span><span class="nv">GB</span><span class="w"> </span><span class="nv">RAM</span>에서<span class="w"> </span>실행<span class="w"> </span>가능<span class="w">                              </span>│
│<span class="w">     </span><span class="o">-</span><span class="w"> </span>필요한<span class="w"> </span>부분만<span class="w"> </span>메모리에<span class="w"> </span>로드<span class="w">                                       </span>│
│<span class="w">                                                                          </span>│
│<span class="w">  </span><span class="mi">2</span>.<span class="w"> </span>더<span class="w"> </span>많은<span class="w"> </span>프로세스<span class="w"> </span>동시<span class="w"> </span>실행<span class="w">                                          </span>│
│<span class="w">     </span><span class="o">-</span><span class="w"> </span>각<span class="w"> </span>프로세스가<span class="w"> </span>전체<span class="w"> </span>메모리를<span class="w"> </span>사용하지<span class="w"> </span>않음<span class="w">                         </span>│
│<span class="w">     </span><span class="o">-</span><span class="w"> </span>다중<span class="w"> </span>프로그래밍<span class="w"> </span>수준<span class="w"> </span>향상<span class="w">                                         </span>│
│<span class="w">                                                                          </span>│
│<span class="w">  </span><span class="mi">3</span>.<span class="w"> </span>메모리<span class="w"> </span>공유<span class="w"> </span>용이<span class="w">                                                    </span>│
│<span class="w">     </span><span class="o">-</span><span class="w"> </span>공유<span class="w"> </span>라이브러리<span class="w"> </span><span class="ss">(</span><span class="nv">libc</span>.<span class="nv">so</span><span class="w"> </span>등<span class="ss">)</span><span class="w">                                      </span>│
│<span class="w">     </span><span class="o">-</span><span class="w"> </span>공유<span class="w"> </span>메모리<span class="w"> </span><span class="nv">IPC</span><span class="w">                                                   </span>│
│<span class="w">     </span><span class="o">-</span><span class="w"> </span><span class="nv">fork</span><span class="ss">()</span><span class="w"> </span>후<span class="w"> </span><span class="nv">Copy</span><span class="o">-</span><span class="nv">on</span><span class="o">-</span><span class="nv">Write</span><span class="w">                                           </span>│
│<span class="w">                                                                          </span>│
│<span class="w">  </span><span class="mi">4</span>.<span class="w"> </span>프로세스<span class="w"> </span>생성<span class="w"> </span>가속화<span class="w">                                                </span>│
│<span class="w">     </span><span class="o">-</span><span class="w"> </span><span class="nv">fork</span><span class="ss">()</span>:<span class="w"> </span>페이지<span class="w"> </span>테이블만<span class="w"> </span>복사<span class="w">                                      </span>│
│<span class="w">     </span><span class="o">-</span><span class="w"> </span><span class="k">exec</span><span class="ss">()</span>:<span class="w"> </span>필요한<span class="w"> </span>페이지만<span class="w"> </span>로드<span class="w">                                      </span>│
│<span class="w">                                                                          </span>│
│<span class="w">  </span><span class="mi">5</span>.<span class="w"> </span><span class="nv">I</span><span class="o">/</span><span class="nv">O</span><span class="w"> </span>최적화<span class="w">                                                          </span>│
│<span class="w">     </span><span class="o">-</span><span class="w"> </span>파일을<span class="w"> </span>메모리에<span class="w"> </span>매핑<span class="w"> </span><span class="ss">(</span><span class="nv">mmap</span><span class="ss">)</span><span class="w">                                       </span>│
│<span class="w">     </span><span class="o">-</span><span class="w"> </span>불필요한<span class="w"> </span>복사<span class="w"> </span>감소<span class="w">                                                </span>│
│<span class="w">                                                                          </span>│
└─────────────────────────────────────────────────────────────────────────┘
</code></pre></div>

<hr />
<h2 id="2">2. 요구 페이징<a class="header-link" href="#2" title="Permanent link">&para;</a></h2>
<h3 id="21">2.1 개념<a class="header-link" href="#21" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code>┌─────────────────────────────────────────────────────────────────────────┐
│                        요구 페이징                                       │
├─────────────────────────────────────────────────────────────────────────┤
│                                                                          │
│   전통적 방식:                          요구 페이징:                     │
│   ┌──────────────────┐                 ┌──────────────────┐             │
│   │ 프로그램 시작 시 │                 │ 프로그램 시작 시 │             │
│   │ 전체를 메모리에  │                 │ 아무것도 로드    │             │
│   │ 로드             │                 │ 하지 않음        │             │
│   └──────────────────┘                 └──────────────────┘             │
│                                                 │                        │
│                                                 ▼                        │
│                                        ┌──────────────────┐             │
│                                        │ 첫 명령어 실행   │             │
│                                        │ → 페이지 폴트    │             │
│                                        │ → 해당 페이지    │             │
│                                        │   로드           │             │
│                                        └──────────────────┘             │
│                                                 │                        │
│                                                 ▼                        │
│                                        ┌──────────────────┐             │
│                                        │ 계속 실행하며    │             │
│                                        │ 필요한 페이지만  │             │
│                                        │ 로드             │             │
│                                        └──────────────────┘             │
│                                                                          │
│   Lazy Loading: &quot;필요할 때 로드&quot;                                        │
│   Pure Demand Paging: 절대 미리 로드하지 않음                           │
│                                                                          │
└─────────────────────────────────────────────────────────────────────────┘
</code></pre></div>

<h3 id="22">2.2 유효/무효 비트<a class="header-link" href="#22" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code>┌─────────────────────────────────────────────────────────────────────────┐
│                      페이지 테이블과 유효 비트                           │
├─────────────────────────────────────────────────────────────────────────┤
│                                                                          │
│   페이지 테이블                                                          │
│   ┌────────────┬────────────┬─────────┐                                 │
│   │ 페이지 번호 │ 프레임 번호 │  V 비트  │                                 │
│   ├────────────┼────────────┼─────────┤                                 │
│   │     0      │     4      │    1    │ ← 메모리에 있음                 │
│   │     1      │     -      │    0    │ ← 디스크에 있음 (페이지 폴트)   │
│   │     2      │     7      │    1    │ ← 메모리에 있음                 │
│   │     3      │     -      │    0    │ ← 아직 할당 안 됨               │
│   │     4      │     2      │    1    │ ← 메모리에 있음                 │
│   │     5      │     -      │    0    │ ← 디스크에 있음                 │
│   │     6      │     -      │    i    │ ← 유효하지 않음 (불법 접근)     │
│   └────────────┴────────────┴─────────┘                                 │
│                                                                          │
│   V=1: 유효 (Valid) - 페이지가 메모리에 있음                            │
│   V=0: 무효 (Invalid) - 페이지가 메모리에 없음                          │
│                                                                          │
│   무효인 경우:                                                           │
│   1. 디스크의 스왑 영역에 있음 → 로드 필요                              │
│   2. 아직 한 번도 접근 안 함 → 할당 필요                                │
│   3. 잘못된 주소 → Segmentation Fault                                   │
│                                                                          │
└─────────────────────────────────────────────────────────────────────────┘
</code></pre></div>

<hr />
<h2 id="3">3. 페이지 폴트<a class="header-link" href="#3" title="Permanent link">&para;</a></h2>
<h3 id="31-10">3.1 페이지 폴트 처리 과정 (10단계)<a class="header-link" href="#31-10" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code>┌─────────────────────────────────────────────────────────────────────────┐
│                    페이지 폴트 처리 과정                                 │
├─────────────────────────────────────────────────────────────────────────┤
│                                                                          │
│   ┌─────────────────────────────────────────────────────────────────┐   │
│   │                                                                  │   │
│   │  1. CPU가 메모리 참조 → 페이지 테이블 조회                      │   │
│   │     ↓                                                            │   │
│   │  2. 유효 비트 = 0 발견 → 페이지 폴트 트랩 발생                  │   │
│   │     ↓                                                            │   │
│   │  3. 운영체제가 제어권 획득                                       │   │
│   │     - 레지스터, 프로세스 상태 저장                              │   │
│   │     ↓                                                            │   │
│   │  4. 주소 유효성 검사                                             │   │
│   │     - 불법 주소면 프로세스 종료                                 │   │
│   │     - 정상이면 계속                                             │   │
│   │     ↓                                                            │   │
│   │  5. 빈 프레임 찾기                                               │   │
│   │     - 없으면 페이지 교체 수행                                   │   │
│   │     ↓                                                            │   │
│   │  6. 디스크에서 페이지 읽기 시작                                  │   │
│   │     - 디스크 I/O 요청                                           │   │
│   │     - 프로세스는 대기 상태로                                    │   │
│   │     ↓                                                            │   │
│   │  7. CPU는 다른 프로세스 실행                                     │   │
│   │     - 컨텍스트 스위칭                                           │   │
│   │     ↓                                                            │   │
│   │  8. 디스크 I/O 완료 인터럽트                                     │   │
│   │     - 페이지가 프레임에 로드됨                                  │   │
│   │     ↓                                                            │   │
│   │  9. 페이지 테이블 업데이트                                       │   │
│   │     - 프레임 번호 기록                                          │   │
│   │     - 유효 비트 = 1                                             │   │
│   │     ↓                                                            │   │
│   │  10. 원래 명령어 재실행                                          │   │
│   │      - 프로세스 재개                                            │   │
│   │      - 이번에는 페이지 폴트 없음                                │   │
│   │                                                                  │   │
│   └─────────────────────────────────────────────────────────────────┘   │
│                                                                          │
└─────────────────────────────────────────────────────────────────────────┘
</code></pre></div>

<h3 id="32">3.2 하드웨어 지원 요구사항<a class="header-link" href="#32" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><span class="err">┌─────────────────────────────────────────────────────────────────────────┐</span>
<span class="err">│</span><span class="w">                 </span><span class="n">페이지</span><span class="w"> </span><span class="n">폴트</span><span class="w"> </span><span class="n">처리를</span><span class="w"> </span><span class="n">위한</span><span class="w"> </span><span class="n">하드웨어</span><span class="w"> </span><span class="n">요구사항</span><span class="w">                </span><span class="err">│</span>
<span class="err">├─────────────────────────────────────────────────────────────────────────┤</span>
<span class="err">│</span><span class="w">                                                                          </span><span class="err">│</span>
<span class="err">│</span><span class="w">  </span><span class="mf">1.</span><span class="w"> </span><span class="n">페이지</span><span class="w"> </span><span class="n">테이블</span><span class="w">                                                       </span><span class="err">│</span>
<span class="err">│</span><span class="w">     </span><span class="o">-</span><span class="w"> </span><span class="n">유효</span><span class="o">/</span><span class="n">무효</span><span class="w"> </span><span class="n">비트</span><span class="w"> </span><span class="n">지원</span><span class="w">                                               </span><span class="err">│</span>
<span class="err">│</span><span class="w">     </span><span class="o">-</span><span class="w"> </span><span class="n">참조</span><span class="w"> </span><span class="n">비트</span><span class="p">,</span><span class="w"> </span><span class="n">수정</span><span class="w"> </span><span class="n">비트</span><span class="w">                                              </span><span class="err">│</span>
<span class="err">│</span><span class="w">                                                                          </span><span class="err">│</span>
<span class="err">│</span><span class="w">  </span><span class="mf">2.</span><span class="w"> </span><span class="n">보조</span><span class="w"> </span><span class="n">메모리</span><span class="w"> </span><span class="p">(</span><span class="n">스왑</span><span class="w"> </span><span class="n">공간</span><span class="p">)</span><span class="w">                                             </span><span class="err">│</span>
<span class="err">│</span><span class="w">     </span><span class="o">-</span><span class="w"> </span><span class="n">페이지</span><span class="w"> </span><span class="n">저장용</span><span class="w"> </span><span class="n">디스크</span><span class="w"> </span><span class="n">공간</span><span class="w">                                         </span><span class="err">│</span>
<span class="err">│</span><span class="w">     </span><span class="o">-</span><span class="w"> </span><span class="n">일반</span><span class="w"> </span><span class="n">파일</span><span class="w"> </span><span class="n">시스템보다</span><span class="w"> </span><span class="n">빠른</span><span class="w"> </span><span class="n">접근</span><span class="w">                                    </span><span class="err">│</span>
<span class="err">│</span><span class="w">                                                                          </span><span class="err">│</span>
<span class="err">│</span><span class="w">  </span><span class="mf">3.</span><span class="w"> </span><span class="n">명령어</span><span class="w"> </span><span class="n">재시작</span><span class="w"> </span><span class="p">(</span><span class="n">Instruction</span><span class="w"> </span><span class="n">Restart</span><span class="p">)</span><span class="w">                                 </span><span class="err">│</span>
<span class="err">│</span><span class="w">     </span><span class="o">-</span><span class="w"> </span><span class="n">페이지</span><span class="w"> </span><span class="n">폴트</span><span class="w"> </span><span class="n">후</span><span class="w"> </span><span class="n">동일</span><span class="w"> </span><span class="n">명령어</span><span class="w"> </span><span class="n">재실행</span><span class="w">                                 </span><span class="err">│</span>
<span class="err">│</span><span class="w">     </span><span class="o">-</span><span class="w"> </span><span class="n">부분</span><span class="w"> </span><span class="n">실행된</span><span class="w"> </span><span class="n">명령어</span><span class="w"> </span><span class="n">복구</span><span class="w">                                           </span><span class="err">│</span>
<span class="err">│</span><span class="w">                                                                          </span><span class="err">│</span>
<span class="err">│</span><span class="w">  </span><span class="nl">예</span><span class="p">:</span><span class="w"> </span><span class="k">ADD</span><span class="w"> </span><span class="n">명령어가</span><span class="w"> </span><span class="n">페이지</span><span class="w"> </span><span class="n">폴트</span><span class="w"> </span><span class="n">발생</span><span class="w"> </span><span class="n">시</span><span class="w">                                   </span><span class="err">│</span>
<span class="err">│</span><span class="w">  </span><span class="err">┌──────────────────────────────────────────────────────────────────┐</span><span class="w">   </span><span class="err">│</span>
<span class="err">│</span><span class="w">  </span><span class="err">│</span><span class="w">  </span><span class="k">ADD</span><span class="w"> </span><span class="n">R1</span><span class="p">,</span><span class="w"> </span><span class="o">[</span><span class="n">A</span><span class="o">]</span><span class="p">,</span><span class="w"> </span><span class="o">[</span><span class="n">B</span><span class="o">]</span><span class="w">   </span><span class="p">;</span><span class="w"> </span><span class="n">A와</span><span class="w"> </span><span class="n">B</span><span class="w"> </span><span class="n">주소의</span><span class="w"> </span><span class="n">값을</span><span class="w"> </span><span class="n">더해</span><span class="w"> </span><span class="n">R1에</span><span class="w"> </span><span class="n">저장</span><span class="w">           </span><span class="err">│</span><span class="w">   </span><span class="err">│</span>
<span class="err">│</span><span class="w">  </span><span class="err">│</span><span class="w">                                                                   </span><span class="err">│</span><span class="w">   </span><span class="err">│</span>
<span class="err">│</span><span class="w">  </span><span class="err">│</span><span class="w">  </span><span class="mf">1.</span><span class="w"> </span><span class="o">[</span><span class="n">A</span><span class="o">]</span><span class="w"> </span><span class="n">페치</span><span class="w"> </span><span class="n">중</span><span class="w"> </span><span class="n">페이지</span><span class="w"> </span><span class="n">폴트</span><span class="w"> </span><span class="err">→</span><span class="w"> </span><span class="n">명령어</span><span class="w"> </span><span class="n">처음부터</span><span class="w"> </span><span class="n">재시작</span><span class="w">             </span><span class="err">│</span><span class="w">   </span><span class="err">│</span>
<span class="err">│</span><span class="w">  </span><span class="err">│</span><span class="w">  </span><span class="mf">2.</span><span class="w"> </span><span class="o">[</span><span class="n">B</span><span class="o">]</span><span class="w"> </span><span class="n">페치</span><span class="w"> </span><span class="n">중</span><span class="w"> </span><span class="n">페이지</span><span class="w"> </span><span class="n">폴트</span><span class="w"> </span><span class="err">→</span><span class="w"> </span><span class="n">A</span><span class="w"> </span><span class="n">값</span><span class="w"> </span><span class="n">다시</span><span class="w"> </span><span class="n">페치</span><span class="w"> </span><span class="n">필요</span><span class="w">                </span><span class="err">│</span><span class="w">   </span><span class="err">│</span>
<span class="err">│</span><span class="w">  </span><span class="err">│</span><span class="w">                                                                   </span><span class="err">│</span><span class="w">   </span><span class="err">│</span>
<span class="err">│</span><span class="w">  </span><span class="err">│</span><span class="w">  </span><span class="n">복잡한</span><span class="w"> </span><span class="nl">경우</span><span class="p">:</span><span class="w">                                                     </span><span class="err">│</span><span class="w">   </span><span class="err">│</span>
<span class="err">│</span><span class="w">  </span><span class="err">│</span><span class="w">  </span><span class="n">MVC</span><span class="w"> </span><span class="p">(</span><span class="n">Move</span><span class="w"> </span><span class="k">Character</span><span class="p">)</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">블록</span><span class="w"> </span><span class="n">복사</span><span class="w"> </span><span class="n">명령어</span><span class="w">                         </span><span class="err">│</span><span class="w">   </span><span class="err">│</span>
<span class="err">│</span><span class="w">  </span><span class="err">│</span><span class="w">  </span><span class="o">-</span><span class="w"> </span><span class="n">복사</span><span class="w"> </span><span class="n">중간에</span><span class="w"> </span><span class="n">페이지</span><span class="w"> </span><span class="n">폴트</span><span class="w"> </span><span class="err">→</span><span class="w"> </span><span class="n">부분</span><span class="w"> </span><span class="n">복사</span><span class="w"> </span><span class="n">취소</span><span class="w"> </span><span class="n">필요</span><span class="w">                 </span><span class="err">│</span><span class="w">   </span><span class="err">│</span>
<span class="err">│</span><span class="w">  </span><span class="err">│</span><span class="w">  </span><span class="o">-</span><span class="w"> </span><span class="n">소스와</span><span class="w"> </span><span class="n">대상이</span><span class="w"> </span><span class="n">겹치면</span><span class="w"> </span><span class="n">더</span><span class="w"> </span><span class="n">복잡</span><span class="w">                                  </span><span class="err">│</span><span class="w">   </span><span class="err">│</span>
<span class="err">│</span><span class="w">  </span><span class="err">└──────────────────────────────────────────────────────────────────┘</span><span class="w">   </span><span class="err">│</span>
<span class="err">│</span><span class="w">                                                                          </span><span class="err">│</span>
<span class="err">└─────────────────────────────────────────────────────────────────────────┘</span>
</code></pre></div>

<h3 id="33">3.3 페이지 폴트 처리 코드 (의사 코드)<a class="header-link" href="#33" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;stdint.h&gt;</span>
<span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;stdbool.h&gt;</span>

<span class="cp">#define NUM_FRAMES 1024</span>
<span class="cp">#define PAGE_SIZE 4096</span>

<span class="k">typedef</span><span class="w"> </span><span class="k">struct</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="kt">uint32_t</span><span class="w"> </span><span class="n">frame_number</span><span class="p">;</span>
<span class="w">    </span><span class="kt">bool</span><span class="w"> </span><span class="n">valid</span><span class="p">;</span>
<span class="w">    </span><span class="kt">bool</span><span class="w"> </span><span class="n">dirty</span><span class="p">;</span>
<span class="w">    </span><span class="kt">bool</span><span class="w"> </span><span class="n">referenced</span><span class="p">;</span>
<span class="p">}</span><span class="w"> </span><span class="n">PageTableEntry</span><span class="p">;</span>

<span class="k">typedef</span><span class="w"> </span><span class="k">struct</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="kt">bool</span><span class="w"> </span><span class="n">allocated</span><span class="p">;</span>
<span class="w">    </span><span class="kt">int</span><span class="w"> </span><span class="n">process_id</span><span class="p">;</span>
<span class="w">    </span><span class="kt">int</span><span class="w"> </span><span class="n">page_number</span><span class="p">;</span>
<span class="p">}</span><span class="w"> </span><span class="n">Frame</span><span class="p">;</span>

<span class="n">Frame</span><span class="w"> </span><span class="n">frame_table</span><span class="p">[</span><span class="n">NUM_FRAMES</span><span class="p">];</span>
<span class="n">PageTableEntry</span><span class="o">*</span><span class="w"> </span><span class="n">current_page_table</span><span class="p">;</span>
<span class="kt">int</span><span class="w"> </span><span class="n">current_process_id</span><span class="p">;</span>

<span class="c1">// 페이지 폴트 핸들러</span>
<span class="kt">void</span><span class="w"> </span><span class="nf">page_fault_handler</span><span class="p">(</span><span class="kt">uint32_t</span><span class="w"> </span><span class="n">virtual_address</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="kt">uint32_t</span><span class="w"> </span><span class="n">page_number</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">virtual_address</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="n">PAGE_SIZE</span><span class="p">;</span>

<span class="w">    </span><span class="n">printf</span><span class="p">(</span><span class="s">&quot;[Page Fault] Process %d, Page %u</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span>
<span class="w">           </span><span class="n">current_process_id</span><span class="p">,</span><span class="w"> </span><span class="n">page_number</span><span class="p">);</span>

<span class="w">    </span><span class="c1">// 1. 주소 유효성 검사</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="o">!</span><span class="n">is_valid_address</span><span class="p">(</span><span class="n">current_process_id</span><span class="p">,</span><span class="w"> </span><span class="n">virtual_address</span><span class="p">))</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="c1">// 불법 접근 - 프로세스 종료</span>
<span class="w">        </span><span class="n">printf</span><span class="p">(</span><span class="s">&quot;Segmentation Fault!</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span>
<span class="w">        </span><span class="n">terminate_process</span><span class="p">(</span><span class="n">current_process_id</span><span class="p">);</span>
<span class="w">        </span><span class="k">return</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="c1">// 2. 빈 프레임 찾기</span>
<span class="w">    </span><span class="kt">int</span><span class="w"> </span><span class="n">frame</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">find_free_frame</span><span class="p">();</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">frame</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mi">-1</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="c1">// 빈 프레임 없음 - 페이지 교체 필요</span>
<span class="w">        </span><span class="n">frame</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">select_victim_frame</span><span class="p">();</span><span class="w">  </span><span class="c1">// LRU 등 사용</span>
<span class="w">        </span><span class="n">evict_page</span><span class="p">(</span><span class="n">frame</span><span class="p">);</span><span class="w">              </span><span class="c1">// 희생 페이지 제거</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="c1">// 3. 디스크에서 페이지 로드</span>
<span class="w">    </span><span class="kt">uint32_t</span><span class="w"> </span><span class="n">disk_address</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">get_disk_address</span><span class="p">(</span><span class="n">current_process_id</span><span class="p">,</span><span class="w"> </span><span class="n">page_number</span><span class="p">);</span>
<span class="w">    </span><span class="n">schedule_disk_read</span><span class="p">(</span><span class="n">disk_address</span><span class="p">,</span><span class="w"> </span><span class="n">frame</span><span class="p">);</span>

<span class="w">    </span><span class="c1">// 4. 프로세스를 대기 상태로 전환</span>
<span class="w">    </span><span class="n">block_process</span><span class="p">(</span><span class="n">current_process_id</span><span class="p">);</span>

<span class="w">    </span><span class="c1">// 5. 다른 프로세스 실행 (스케줄러)</span>
<span class="w">    </span><span class="n">schedule_next_process</span><span class="p">();</span>

<span class="w">    </span><span class="c1">// --- 디스크 I/O 완료 후 인터럽트 핸들러에서 ---</span>
<span class="p">}</span>

<span class="c1">// 디스크 I/O 완료 인터럽트 핸들러</span>
<span class="kt">void</span><span class="w"> </span><span class="nf">disk_io_complete_handler</span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">frame</span><span class="p">,</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">process_id</span><span class="p">,</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">page_number</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="c1">// 6. 페이지 테이블 업데이트</span>
<span class="w">    </span><span class="n">PageTableEntry</span><span class="o">*</span><span class="w"> </span><span class="n">pte</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">get_page_table_entry</span><span class="p">(</span><span class="n">process_id</span><span class="p">,</span><span class="w"> </span><span class="n">page_number</span><span class="p">);</span>
<span class="w">    </span><span class="n">pte</span><span class="o">-&gt;</span><span class="n">frame_number</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">frame</span><span class="p">;</span>
<span class="w">    </span><span class="n">pte</span><span class="o">-&gt;</span><span class="n">valid</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">true</span><span class="p">;</span>
<span class="w">    </span><span class="n">pte</span><span class="o">-&gt;</span><span class="n">dirty</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">false</span><span class="p">;</span>
<span class="w">    </span><span class="n">pte</span><span class="o">-&gt;</span><span class="n">referenced</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">true</span><span class="p">;</span>

<span class="w">    </span><span class="c1">// 7. 프레임 테이블 업데이트</span>
<span class="w">    </span><span class="n">frame_table</span><span class="p">[</span><span class="n">frame</span><span class="p">].</span><span class="n">allocated</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">true</span><span class="p">;</span>
<span class="w">    </span><span class="n">frame_table</span><span class="p">[</span><span class="n">frame</span><span class="p">].</span><span class="n">process_id</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">process_id</span><span class="p">;</span>
<span class="w">    </span><span class="n">frame_table</span><span class="p">[</span><span class="n">frame</span><span class="p">].</span><span class="n">page_number</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">page_number</span><span class="p">;</span>

<span class="w">    </span><span class="c1">// 8. 프로세스 준비 상태로 전환</span>
<span class="w">    </span><span class="n">unblock_process</span><span class="p">(</span><span class="n">process_id</span><span class="p">);</span>

<span class="w">    </span><span class="c1">// 프로세스가 다시 스케줄되면 명령어 재실행</span>
<span class="p">}</span>
</code></pre></div>

<hr />
<h2 id="4-copy-on-write">4. Copy-on-Write<a class="header-link" href="#4-copy-on-write" title="Permanent link">&para;</a></h2>
<h3 id="41">4.1 개념<a class="header-link" href="#41" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code>┌─────────────────────────────────────────────────────────────────────────┐
│<span class="w">                      </span><span class="nv">Copy</span><span class="o">-</span><span class="nv">on</span><span class="o">-</span><span class="nv">Write</span><span class="w"> </span><span class="ss">(</span><span class="nv">COW</span><span class="ss">)</span><span class="w">                                 </span>│
├─────────────────────────────────────────────────────────────────────────┤
│<span class="w">                                                                          </span>│
│<span class="w">   </span><span class="nv">fork</span><span class="ss">()</span><span class="w"> </span>호출<span class="w"> </span>시<span class="w"> </span>전통적<span class="w"> </span>방식:<span class="w">                                           </span>│
│<span class="w">   </span>┌───────────────────────────────────────────────────────────────┐<span class="w">     </span>│
│<span class="w">   </span>│<span class="w">                                                                </span>│<span class="w">     </span>│
│<span class="w">   </span>│<span class="w">   </span>부모<span class="w"> </span>프로세스<span class="w">              </span>자식<span class="w"> </span>프로세스<span class="w">                     </span>│<span class="w">     </span>│
│<span class="w">   </span>│<span class="w">   </span>┌──────────────┐<span class="w">          </span>┌──────────────┐<span class="w">                  </span>│<span class="w">     </span>│
│<span class="w">   </span>│<span class="w">   </span>│<span class="w"> </span>메모리<span class="w"> </span>공간<span class="w">   </span>│<span class="w">  </span>복사<span class="w">    </span>│<span class="w"> </span>메모리<span class="w"> </span>공간<span class="w">   </span>│<span class="w">                  </span>│<span class="w">     </span>│
│<span class="w">   </span>│<span class="w">   </span>│<span class="w"> </span><span class="ss">(</span><span class="mi">100</span><span class="nv">MB</span><span class="ss">)</span><span class="w">      </span>│<span class="w"> </span>──────▶<span class="w"> </span>│<span class="w"> </span><span class="ss">(</span><span class="mi">100</span><span class="nv">MB</span><span class="w"> </span>복사<span class="ss">)</span><span class="w">  </span>│<span class="w">                  </span>│<span class="w">     </span>│
│<span class="w">   </span>│<span class="w">   </span>└──────────────┘<span class="w">          </span>└──────────────┘<span class="w">                  </span>│<span class="w">     </span>│
│<span class="w">   </span>│<span class="w">                                                                </span>│<span class="w">     </span>│
│<span class="w">   </span>│<span class="w">   </span>문제:<span class="w"> </span><span class="mi">200</span><span class="nv">MB</span><span class="w"> </span>메모리<span class="w"> </span>사용<span class="w">                                     </span>│<span class="w">     </span>│
│<span class="w">   </span>│<span class="w">   </span>자식이<span class="w"> </span><span class="k">exec</span><span class="ss">()</span><span class="w"> </span>호출하면<span class="w"> </span>복사한<span class="w"> </span>메모리<span class="w"> </span>전부<span class="w"> </span>버려짐<span class="o">!</span><span class="w">           </span>│<span class="w">     </span>│
│<span class="w">   </span>└───────────────────────────────────────────────────────────────┘<span class="w">     </span>│
│<span class="w">                                                                          </span>│
│<span class="w">   </span><span class="nv">Copy</span><span class="o">-</span><span class="nv">on</span><span class="o">-</span><span class="nv">Write</span><span class="w"> </span>방식:<span class="w">                                                   </span>│
│<span class="w">   </span>┌───────────────────────────────────────────────────────────────┐<span class="w">     </span>│
│<span class="w">   </span>│<span class="w">                                                                </span>│<span class="w">     </span>│
│<span class="w">   </span>│<span class="w">   </span><span class="nv">fork</span><span class="ss">()</span><span class="w"> </span>직후:<span class="w">                                                 </span>│<span class="w">     </span>│
│<span class="w">   </span>│<span class="w">   </span>부모<span class="w"> </span><span class="nv">PT</span><span class="w">    </span>자식<span class="w"> </span><span class="nv">PT</span><span class="w">              </span>물리<span class="w"> </span>메모리<span class="w">                  </span>│<span class="w">     </span>│
│<span class="w">   </span>│<span class="w">   </span>┌──────┐<span class="w">  </span>┌──────┐<span class="w">             </span>┌──────────────┐<span class="w">             </span>│<span class="w">     </span>│
│<span class="w">   </span>│<span class="w">   </span>│<span class="w"> </span>페이지<span class="mi">0</span>│──┼──────┼───────────▶│<span class="w"> </span>공유<span class="w"> </span>페이지<span class="mi">0</span><span class="w"> </span>│<span class="w"> </span><span class="ss">(</span>읽기전용<span class="ss">)</span><span class="w">   </span>│<span class="w">     </span>│
│<span class="w">   </span>│<span class="w">   </span>│<span class="w"> </span>페이지<span class="mi">1</span>│──┼──────┼───────────▶│<span class="w"> </span>공유<span class="w"> </span>페이지<span class="mi">1</span><span class="w"> </span>│<span class="w"> </span><span class="ss">(</span>읽기전용<span class="ss">)</span><span class="w">   </span>│<span class="w">     </span>│
│<span class="w">   </span>│<span class="w">   </span>│<span class="w"> </span>페이지<span class="mi">2</span>│──┼──────┼───────────▶│<span class="w"> </span>공유<span class="w"> </span>페이지<span class="mi">2</span><span class="w"> </span>│<span class="w"> </span><span class="ss">(</span>읽기전용<span class="ss">)</span><span class="w">   </span>│<span class="w">     </span>│
│<span class="w">   </span>│<span class="w">   </span>└──────┘<span class="w">  </span>└──────┘<span class="w">             </span>└──────────────┘<span class="w">             </span>│<span class="w">     </span>│
│<span class="w">   </span>│<span class="w">                                                                </span>│<span class="w">     </span>│
│<span class="w">   </span>│<span class="w">   </span>메모리<span class="w"> </span>사용:<span class="w"> </span><span class="mi">100</span><span class="nv">MB</span><span class="w"> </span><span class="ss">(</span>공유<span class="o">!</span><span class="ss">)</span><span class="w">                                  </span>│<span class="w">     </span>│
│<span class="w">   </span>│<span class="w">                                                                </span>│<span class="w">     </span>│
│<span class="w">   </span>└───────────────────────────────────────────────────────────────┘<span class="w">     </span>│
│<span class="w">                                                                          </span>│
└─────────────────────────────────────────────────────────────────────────┘
</code></pre></div>

<h3 id="42">4.2 쓰기 시 복사<a class="header-link" href="#42" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code>┌─────────────────────────────────────────────────────────────────────────┐
│                    쓰기 시 COW 페이지 복사                               │
├─────────────────────────────────────────────────────────────────────────┤
│                                                                          │
│   자식이 페이지 1에 쓰기 시도:                                          │
│                                                                          │
│   1. 쓰기 보호 위반 발생 (페이지가 읽기 전용)                           │
│   2. OS가 COW 페이지임을 확인                                           │
│   3. 새 페이지 할당 및 복사                                             │
│   4. 자식의 페이지 테이블 업데이트                                      │
│   5. 쓰기 실행                                                          │
│                                                                          │
│   결과:                                                                  │
│   부모 PT    자식 PT              물리 메모리                           │
│   ┌──────┐  ┌──────┐             ┌──────────────┐                      │
│   │ 페이지0│──┼──────┼───────────▶│ 공유 페이지0 │ (읽기전용)            │
│   │ 페이지1│──┼──────┼──┐        ├──────────────┤                      │
│   │ 페이지2│──┼──────┼──┼───────▶│ 공유 페이지2 │ (읽기전용)            │
│   └──────┘  └───┬──┘  │        └──────────────┘                      │
│                  │     │                                                │
│                  │     └────────▶┌──────────────┐                      │
│                  │               │ 부모 페이지1 │ (읽기/쓰기)           │
│                  │               └──────────────┘                      │
│                  │                                                      │
│                  └──────────────▶┌──────────────┐                      │
│                                  │ 자식 페이지1 │ (읽기/쓰기)           │
│                                  │ (복사본)     │                      │
│                                  └──────────────┘                      │
│                                                                          │
│   이제 페이지 1은 각자 독립적, 페이지 0,2는 여전히 공유                 │
│                                                                          │
└─────────────────────────────────────────────────────────────────────────┘
</code></pre></div>

<h3 id="43-cow">4.3 COW 구현<a class="header-link" href="#43-cow" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><span class="c1">// COW 페이지 폴트 핸들러 (쓰기 시)</span>
<span class="kt">void</span><span class="w"> </span><span class="nf">cow_page_fault_handler</span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">process_id</span><span class="p">,</span><span class="w"> </span><span class="kt">uint32_t</span><span class="w"> </span><span class="n">virtual_address</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="kt">uint32_t</span><span class="w"> </span><span class="n">page_number</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">virtual_address</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="n">PAGE_SIZE</span><span class="p">;</span>
<span class="w">    </span><span class="n">PageTableEntry</span><span class="o">*</span><span class="w"> </span><span class="n">pte</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">get_page_table_entry</span><span class="p">(</span><span class="n">process_id</span><span class="p">,</span><span class="w"> </span><span class="n">page_number</span><span class="p">);</span>

<span class="w">    </span><span class="c1">// COW 페이지인지 확인</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="o">!</span><span class="n">pte</span><span class="o">-&gt;</span><span class="n">cow_flag</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="c1">// 진짜 보호 위반 - 프로세스 종료</span>
<span class="w">        </span><span class="n">terminate_process</span><span class="p">(</span><span class="n">process_id</span><span class="p">);</span>
<span class="w">        </span><span class="k">return</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="kt">int</span><span class="w"> </span><span class="n">old_frame</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">pte</span><span class="o">-&gt;</span><span class="n">frame_number</span><span class="p">;</span>
<span class="w">    </span><span class="kt">int</span><span class="w"> </span><span class="n">ref_count</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">get_reference_count</span><span class="p">(</span><span class="n">old_frame</span><span class="p">);</span>

<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">ref_count</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="mi">1</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="c1">// 다른 프로세스도 이 페이지 사용 중 - 복사 필요</span>
<span class="w">        </span><span class="kt">int</span><span class="w"> </span><span class="n">new_frame</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">allocate_frame</span><span class="p">();</span>
<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">new_frame</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mi">-1</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="n">new_frame</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">select_victim_and_evict</span><span class="p">();</span>
<span class="w">        </span><span class="p">}</span>

<span class="w">        </span><span class="c1">// 페이지 내용 복사</span>
<span class="w">        </span><span class="n">memcpy</span><span class="p">(</span><span class="n">frame_to_address</span><span class="p">(</span><span class="n">new_frame</span><span class="p">),</span>
<span class="w">               </span><span class="n">frame_to_address</span><span class="p">(</span><span class="n">old_frame</span><span class="p">),</span>
<span class="w">               </span><span class="n">PAGE_SIZE</span><span class="p">);</span>

<span class="w">        </span><span class="c1">// 참조 카운트 감소</span>
<span class="w">        </span><span class="n">decrement_reference_count</span><span class="p">(</span><span class="n">old_frame</span><span class="p">);</span>

<span class="w">        </span><span class="c1">// 페이지 테이블 업데이트</span>
<span class="w">        </span><span class="n">pte</span><span class="o">-&gt;</span><span class="n">frame_number</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">new_frame</span><span class="p">;</span>
<span class="w">        </span><span class="n">pte</span><span class="o">-&gt;</span><span class="n">cow_flag</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">false</span><span class="p">;</span>
<span class="w">        </span><span class="n">pte</span><span class="o">-&gt;</span><span class="n">writable</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">true</span><span class="p">;</span>

<span class="w">        </span><span class="c1">// 새 프레임 참조 카운트 = 1</span>
<span class="w">        </span><span class="n">set_reference_count</span><span class="p">(</span><span class="n">new_frame</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="p">);</span>
<span class="w">    </span><span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="c1">// 이 프로세스만 사용 중 - 복사 불필요, 쓰기 허용</span>
<span class="w">        </span><span class="n">pte</span><span class="o">-&gt;</span><span class="n">cow_flag</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">false</span><span class="p">;</span>
<span class="w">        </span><span class="n">pte</span><span class="o">-&gt;</span><span class="n">writable</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">true</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="c1">// TLB 무효화</span>
<span class="w">    </span><span class="n">invalidate_tlb_entry</span><span class="p">(</span><span class="n">virtual_address</span><span class="p">);</span>
<span class="p">}</span>
</code></pre></div>

<hr />
<h2 id="5">5. 메모리 매핑 파일<a class="header-link" href="#5" title="Permanent link">&para;</a></h2>
<h3 id="51-mmap">5.1 mmap() 개념<a class="header-link" href="#51-mmap" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code>┌─────────────────────────────────────────────────────────────────────────┐
│                      메모리 매핑 파일 (mmap)                             │
├─────────────────────────────────────────────────────────────────────────┤
│                                                                          │
│   전통적 파일 I/O:                                                       │
│   ┌─────────────────────────────────────────────────────────────────┐   │
│   │                                                                  │   │
│   │   프로세스                    커널                    디스크    │   │
│   │   ┌──────────┐              ┌──────────┐           ┌──────────┐│   │
│   │   │ 버퍼     │◀── read() ──│ 커널버퍼 │◀──────────│   파일   ││   │
│   │   └──────────┘              └──────────┘           └──────────┘│   │
│   │                                                                  │   │
│   │   1. 시스템 콜 오버헤드                                         │   │
│   │   2. 데이터 복사 2번 (디스크→커널→사용자)                       │   │
│   │                                                                  │   │
│   └─────────────────────────────────────────────────────────────────┘   │
│                                                                          │
│   메모리 매핑:                                                           │
│   ┌─────────────────────────────────────────────────────────────────┐   │
│   │                                                                  │   │
│   │   프로세스 가상 주소 공간                                       │   │
│   │   ┌──────────────────────────────────────────────┐             │   │
│   │   │        ...                                    │             │   │
│   │   ├──────────────────────────────────────────────┤             │   │
│   │   │        매핑된 영역                            │             │   │
│   │   │   ┌────────────────────────────────────┐     │             │   │
│   │   │   │        파일 내용                    │◀────┼─┐           │   │
│   │   │   │     (직접 접근 가능)                │     │ │           │   │
│   │   │   └────────────────────────────────────┘     │ │           │   │
│   │   ├──────────────────────────────────────────────┤ │           │   │
│   │   │        ...                                    │ │           │   │
│   │   └──────────────────────────────────────────────┘ │           │   │
│   │                                                     │ 페이지   │   │
│   │   디스크                                            │ 폴트로   │   │
│   │   ┌──────────────────────────────────────────────┐ │ 자동 로드│   │
│   │   │              파일                             │◀┘           │   │
│   │   └──────────────────────────────────────────────┘             │   │
│   │                                                                  │   │
│   │   장점:                                                         │   │
│   │   - 복사 없음 (Zero-Copy)                                      │   │
│   │   - 포인터로 직접 접근                                         │   │
│   │   - 여러 프로세스가 파일 공유 가능                             │   │
│   │                                                                  │   │
│   └─────────────────────────────────────────────────────────────────┘   │
│                                                                          │
└─────────────────────────────────────────────────────────────────────────┘
</code></pre></div>

<h3 id="52-mmap">5.2 mmap() 사용 예제<a class="header-link" href="#52-mmap" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;stdio.h&gt;</span>
<span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;stdlib.h&gt;</span>
<span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;sys/mman.h&gt;</span>
<span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;sys/stat.h&gt;</span>
<span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;fcntl.h&gt;</span>
<span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;unistd.h&gt;</span>
<span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;string.h&gt;</span>

<span class="c1">// 파일 읽기 예제</span>
<span class="kt">void</span><span class="w"> </span><span class="nf">read_file_with_mmap</span><span class="p">(</span><span class="k">const</span><span class="w"> </span><span class="kt">char</span><span class="o">*</span><span class="w"> </span><span class="n">filename</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="kt">int</span><span class="w"> </span><span class="n">fd</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">open</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span><span class="w"> </span><span class="n">O_RDONLY</span><span class="p">);</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">fd</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mi">-1</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="n">perror</span><span class="p">(</span><span class="s">&quot;open&quot;</span><span class="p">);</span>
<span class="w">        </span><span class="k">return</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="c1">// 파일 크기 확인</span>
<span class="w">    </span><span class="k">struct</span><span class="w"> </span><span class="nc">stat</span><span class="w"> </span><span class="n">sb</span><span class="p">;</span>
<span class="w">    </span><span class="n">fstat</span><span class="p">(</span><span class="n">fd</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">sb</span><span class="p">);</span>

<span class="w">    </span><span class="c1">// 파일을 메모리에 매핑</span>
<span class="w">    </span><span class="kt">char</span><span class="o">*</span><span class="w"> </span><span class="n">addr</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">mmap</span><span class="p">(</span><span class="nb">NULL</span><span class="p">,</span><span class="w">               </span><span class="c1">// 커널이 주소 선택</span>
<span class="w">                      </span><span class="n">sb</span><span class="p">.</span><span class="n">st_size</span><span class="p">,</span><span class="w">         </span><span class="c1">// 매핑 크기</span>
<span class="w">                      </span><span class="n">PROT_READ</span><span class="p">,</span><span class="w">          </span><span class="c1">// 읽기 전용</span>
<span class="w">                      </span><span class="n">MAP_PRIVATE</span><span class="p">,</span><span class="w">        </span><span class="c1">// 개인 매핑</span>
<span class="w">                      </span><span class="n">fd</span><span class="p">,</span><span class="w">                 </span><span class="c1">// 파일 디스크립터</span>
<span class="w">                      </span><span class="mi">0</span><span class="p">);</span><span class="w">                 </span><span class="c1">// 오프셋</span>

<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">addr</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">MAP_FAILED</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="n">perror</span><span class="p">(</span><span class="s">&quot;mmap&quot;</span><span class="p">);</span>
<span class="w">        </span><span class="n">close</span><span class="p">(</span><span class="n">fd</span><span class="p">);</span>
<span class="w">        </span><span class="k">return</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="c1">// 이제 addr을 통해 파일 내용에 직접 접근 가능</span>
<span class="w">    </span><span class="n">printf</span><span class="p">(</span><span class="s">&quot;파일 크기: %ld 바이트</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">sb</span><span class="p">.</span><span class="n">st_size</span><span class="p">);</span>
<span class="w">    </span><span class="n">printf</span><span class="p">(</span><span class="s">&quot;처음 100바이트:</span><span class="se">\n</span><span class="s">%.100s</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">addr</span><span class="p">);</span>

<span class="w">    </span><span class="c1">// 매핑 해제</span>
<span class="w">    </span><span class="n">munmap</span><span class="p">(</span><span class="n">addr</span><span class="p">,</span><span class="w"> </span><span class="n">sb</span><span class="p">.</span><span class="n">st_size</span><span class="p">);</span>
<span class="w">    </span><span class="n">close</span><span class="p">(</span><span class="n">fd</span><span class="p">);</span>
<span class="p">}</span>

<span class="c1">// 파일 수정 예제 (공유 매핑)</span>
<span class="kt">void</span><span class="w"> </span><span class="nf">modify_file_with_mmap</span><span class="p">(</span><span class="k">const</span><span class="w"> </span><span class="kt">char</span><span class="o">*</span><span class="w"> </span><span class="n">filename</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="kt">int</span><span class="w"> </span><span class="n">fd</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">open</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span><span class="w"> </span><span class="n">O_RDWR</span><span class="p">);</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">fd</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mi">-1</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="n">perror</span><span class="p">(</span><span class="s">&quot;open&quot;</span><span class="p">);</span>
<span class="w">        </span><span class="k">return</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="k">struct</span><span class="w"> </span><span class="nc">stat</span><span class="w"> </span><span class="n">sb</span><span class="p">;</span>
<span class="w">    </span><span class="n">fstat</span><span class="p">(</span><span class="n">fd</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">sb</span><span class="p">);</span>

<span class="w">    </span><span class="c1">// 공유 매핑 - 변경사항이 파일에 반영됨</span>
<span class="w">    </span><span class="kt">char</span><span class="o">*</span><span class="w"> </span><span class="n">addr</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">mmap</span><span class="p">(</span><span class="nb">NULL</span><span class="p">,</span><span class="w"> </span><span class="n">sb</span><span class="p">.</span><span class="n">st_size</span><span class="p">,</span>
<span class="w">                      </span><span class="n">PROT_READ</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">PROT_WRITE</span><span class="p">,</span>
<span class="w">                      </span><span class="n">MAP_SHARED</span><span class="p">,</span><span class="w">          </span><span class="c1">// 공유 매핑!</span>
<span class="w">                      </span><span class="n">fd</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">);</span>

<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">addr</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">MAP_FAILED</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="n">perror</span><span class="p">(</span><span class="s">&quot;mmap&quot;</span><span class="p">);</span>
<span class="w">        </span><span class="n">close</span><span class="p">(</span><span class="n">fd</span><span class="p">);</span>
<span class="w">        </span><span class="k">return</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="c1">// 파일 내용 수정</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">sb</span><span class="p">.</span><span class="n">st_size</span><span class="w"> </span><span class="o">&gt;=</span><span class="w"> </span><span class="mi">5</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="n">memcpy</span><span class="p">(</span><span class="n">addr</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;Hello&quot;</span><span class="p">,</span><span class="w"> </span><span class="mi">5</span><span class="p">);</span><span class="w">  </span><span class="c1">// 첫 5바이트 변경</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="c1">// 변경사항 강제 동기화</span>
<span class="w">    </span><span class="n">msync</span><span class="p">(</span><span class="n">addr</span><span class="p">,</span><span class="w"> </span><span class="n">sb</span><span class="p">.</span><span class="n">st_size</span><span class="p">,</span><span class="w"> </span><span class="n">MS_SYNC</span><span class="p">);</span>

<span class="w">    </span><span class="n">munmap</span><span class="p">(</span><span class="n">addr</span><span class="p">,</span><span class="w"> </span><span class="n">sb</span><span class="p">.</span><span class="n">st_size</span><span class="p">);</span>
<span class="w">    </span><span class="n">close</span><span class="p">(</span><span class="n">fd</span><span class="p">);</span>

<span class="w">    </span><span class="n">printf</span><span class="p">(</span><span class="s">&quot;파일 수정 완료</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span>
<span class="p">}</span>

<span class="c1">// 익명 매핑 (공유 메모리용)</span>
<span class="kt">void</span><span class="o">*</span><span class="w"> </span><span class="nf">create_shared_memory</span><span class="p">(</span><span class="kt">size_t</span><span class="w"> </span><span class="n">size</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="kt">void</span><span class="o">*</span><span class="w"> </span><span class="n">addr</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">mmap</span><span class="p">(</span><span class="nb">NULL</span><span class="p">,</span><span class="w"> </span><span class="n">size</span><span class="p">,</span>
<span class="w">                      </span><span class="n">PROT_READ</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">PROT_WRITE</span><span class="p">,</span>
<span class="w">                      </span><span class="n">MAP_SHARED</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">MAP_ANONYMOUS</span><span class="p">,</span><span class="w">  </span><span class="c1">// 파일 없이 매핑</span>
<span class="w">                      </span><span class="mi">-1</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">);</span>

<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">addr</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">MAP_FAILED</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="nb">NULL</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">addr</span><span class="p">;</span>
<span class="p">}</span>

<span class="kt">int</span><span class="w"> </span><span class="nf">main</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="n">read_file_with_mmap</span><span class="p">(</span><span class="s">&quot;/etc/passwd&quot;</span><span class="p">);</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></div>

<h3 id="53">5.3 매핑 옵션<a class="header-link" href="#53" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code>┌─────────────────────────────────────────────────────────────────────────┐
│                        mmap() 옵션                                       │
├─────────────────────────────────────────────────────────────────────────┤
│                                                                          │
│  보호 플래그 (prot):                                                    │
│  ┌───────────────┬────────────────────────────────────┐                 │
│  │ PROT_READ     │ 읽기 허용                          │                 │
│  │ PROT_WRITE    │ 쓰기 허용                          │                 │
│  │ PROT_EXEC     │ 실행 허용                          │                 │
│  │ PROT_NONE     │ 접근 불가 (가드 페이지)            │                 │
│  └───────────────┴────────────────────────────────────┘                 │
│                                                                          │
│  플래그 (flags):                                                        │
│  ┌───────────────┬────────────────────────────────────┐                 │
│  │ MAP_SHARED    │ 변경사항 파일에 반영, 공유 가능    │                 │
│  │ MAP_PRIVATE   │ COW - 변경사항 개인만 볼 수 있음   │                 │
│  │ MAP_ANONYMOUS │ 파일 없이 메모리만 (fd=-1)         │                 │
│  │ MAP_FIXED     │ 지정한 주소에 정확히 매핑          │                 │
│  │ MAP_LOCKED    │ 페이지를 메모리에 고정 (스왑 안 함)│                 │
│  └───────────────┴────────────────────────────────────┘                 │
│                                                                          │
│  사용 예:                                                               │
│  - 실행 파일 로드: MAP_PRIVATE, PROT_READ|PROT_EXEC                    │
│  - 데이터 파일: MAP_SHARED, PROT_READ|PROT_WRITE                       │
│  - 힙 확장: MAP_PRIVATE|MAP_ANONYMOUS                                  │
│  - 공유 메모리: MAP_SHARED|MAP_ANONYMOUS                               │
│                                                                          │
└─────────────────────────────────────────────────────────────────────────┘
</code></pre></div>

<hr />
<h2 id="6">6. 성능 분석<a class="header-link" href="#6" title="Permanent link">&para;</a></h2>
<h3 id="61">6.1 유효 접근 시간 (페이지 폴트 포함)<a class="header-link" href="#61" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code>┌─────────────────────────────────────────────────────────────────────────┐
│                 페이지 폴트를 포함한 유효 접근 시간                      │
├─────────────────────────────────────────────────────────────────────────┤
│                                                                          │
│   파라미터:                                                              │
│   - p: 페이지 폴트 확률 (0 ≤ p ≤ 1)                                    │
│   - ma: 메모리 접근 시간 (예: 100ns)                                    │
│   - pft: 페이지 폴트 처리 시간 (예: 8ms = 8,000,000ns)                  │
│                                                                          │
│   유효 접근 시간 (EAT):                                                 │
│   EAT = (1 - p) × ma + p × pft                                          │
│                                                                          │
│   예제:                                                                  │
│   ma = 100ns, pft = 8ms, 10% 성능 저하 허용                             │
│                                                                          │
│   허용 EAT = 100ns × 1.1 = 110ns                                        │
│                                                                          │
│   110 = (1-p) × 100 + p × 8,000,000                                     │
│   110 = 100 - 100p + 8,000,000p                                         │
│   10 = 7,999,900p                                                        │
│   p = 10 / 7,999,900                                                    │
│   p ≈ 0.00000125                                                        │
│   p ≈ 1/800,000                                                         │
│                                                                          │
│   결론: 80만 번 접근당 1번 이하의 페이지 폴트만 허용!                   │
│                                                                          │
│   이것이 페이지 교체 알고리즘이 중요한 이유                             │
│                                                                          │
└─────────────────────────────────────────────────────────────────────────┘
</code></pre></div>

<h3 id="62">6.2 페이지 폴트 시간 분해<a class="header-link" href="#62" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code>┌─────────────────────────────────────────────────────────────────────────┐
│                    페이지 폴트 처리 시간 분해                            │
├─────────────────────────────────────────────────────────────────────────┤
│                                                                          │
│   ┌─────────────────────────────────────────────────────────────┐       │
│   │                                                              │       │
│   │   1. 인터럽트 처리              1-100 μs                    │       │
│   │      - 트랩 발생                                            │       │
│   │      - 레지스터/상태 저장                                   │       │
│   │                                                              │       │
│   │   2. 페이지 폴트 처리           1-100 μs                    │       │
│   │      - 주소 유효성 검사                                     │       │
│   │      - 빈 프레임 찾기                                       │       │
│   │                                                              │       │
│   │   3. 디스크 I/O                 8-10 ms  ◀── 대부분 시간!   │       │
│   │      - 탐색 시간                                            │       │
│   │      - 회전 지연                                            │       │
│   │      - 전송 시간                                            │       │
│   │                                                              │       │
│   │   4. 인터럽트 처리              1-100 μs                    │       │
│   │      - I/O 완료 인터럽트                                    │       │
│   │      - 테이블 업데이트                                      │       │
│   │                                                              │       │
│   │   5. 프로세스 재개              1-100 μs                    │       │
│   │      - 레지스터 복원                                        │       │
│   │      - 명령어 재실행                                        │       │
│   │                                                              │       │
│   └─────────────────────────────────────────────────────────────┘       │
│                                                                          │
│   총 시간: 약 8-10ms (대부분 디스크 I/O)                                │
│                                                                          │
│   SSD의 경우: 0.1-0.5ms로 대폭 감소                                     │
│                                                                          │
└─────────────────────────────────────────────────────────────────────────┘
</code></pre></div>

<hr />
<h2 id="_4">연습 문제<a class="header-link" href="#_4" title="Permanent link">&para;</a></h2>
<h3 id="1_1">문제 1: 페이지 폴트 시나리오<a class="header-link" href="#1_1" title="Permanent link">&para;</a></h3>
<p>프로세스가 다음 순서로 페이지에 접근합니다. 메모리에는 3개의 프레임만 있고, 초기에 모두 비어있을 때 페이지 폴트 횟수를 구하시오.</p>
<p>접근 순서: 1, 2, 3, 4, 1, 2, 5, 1, 2, 3, 4, 5</p>
<details>
<summary>정답 보기</summary>


<div class="highlight"><pre><span></span><code>FIFO 교체 알고리즘 가정:

접근  메모리(3프레임)  폴트?
 1    [1, -, -]        폴트
 2    [1, 2, -]        폴트
 3    [1, 2, 3]        폴트
 4    [4, 2, 3]        폴트 (1 교체)
 1    [4, 1, 3]        폴트 (2 교체)
 2    [4, 1, 2]        폴트 (3 교체)
 5    [5, 1, 2]        폴트 (4 교체)
 1    [5, 1, 2]        적중
 2    [5, 1, 2]        적중
 3    [3, 1, 2]        폴트 (5 교체)
 4    [3, 4, 2]        폴트 (1 교체)
 5    [3, 4, 5]        폴트 (2 교체)

총 페이지 폴트: 10번
</code></pre></div>



</details>

<h3 id="2-eat">문제 2: EAT 계산<a class="header-link" href="#2-eat" title="Permanent link">&para;</a></h3>
<p>메모리 접근 시간이 50ns이고 페이지 폴트 처리 시간이 10ms일 때, 성능 저하를 5% 이내로 유지하려면 페이지 폴트 확률이 얼마 이하여야 하는가?</p>
<details>
<summary>정답 보기</summary>


<div class="highlight"><pre><span></span><code>ma = 50ns
pft = 10ms = 10,000,000ns
허용 EAT = 50 × 1.05 = 52.5ns

EAT = (1-p) × ma + p × pft
52.5 = (1-p) × 50 + p × 10,000,000
52.5 = 50 - 50p + 10,000,000p
2.5 = 9,999,950p
p = 2.5 / 9,999,950
p ≈ 2.5 × 10^-7
p ≈ 1 / 4,000,000

결론: 400만 번 접근당 1번 이하의 페이지 폴트
</code></pre></div>



</details>

<h3 id="3-copy-on-write">문제 3: Copy-on-Write<a class="header-link" href="#3-copy-on-write" title="Permanent link">&para;</a></h3>
<p>부모 프로세스가 100개의 페이지를 가지고 있고 fork()를 호출합니다. 자식이 10개의 페이지를 수정한 후 종료하면, 총 몇 개의 페이지가 물리적으로 존재하는가?</p>
<details>
<summary>정답 보기</summary>


<div class="highlight"><pre><span></span><code><span class="mf">1.</span><span class="w"> </span><span class="kr">for</span><span class="n">k</span><span class="p">()</span><span class="w"> </span><span class="n">직후</span><span class="p">:</span>
<span class="w">   </span><span class="o">-</span><span class="w"> </span><span class="mf">100</span><span class="n">개</span><span class="w"> </span><span class="n">페이지가</span><span class="w"> </span><span class="n">부모와</span><span class="w"> </span><span class="n">자식이</span><span class="w"> </span><span class="n">공유</span><span class="w"> </span><span class="p">(</span><span class="n">읽기전용</span><span class="p">)</span>
<span class="w">   </span><span class="o">-</span><span class="w"> </span><span class="n">물리</span><span class="w"> </span><span class="n">페이지</span><span class="p">:</span><span class="w"> </span><span class="mf">100</span><span class="n">개</span>

<span class="mf">2.</span><span class="w"> </span><span class="n">자식이</span><span class="w"> </span><span class="mf">10</span><span class="n">개</span><span class="w"> </span><span class="n">페이지</span><span class="w"> </span><span class="n">수정</span><span class="p">:</span>
<span class="w">   </span><span class="o">-</span><span class="w"> </span><span class="n">각</span><span class="w"> </span><span class="n">수정</span><span class="w"> </span><span class="n">시</span><span class="w"> </span><span class="n">COW</span><span class="w"> </span><span class="n">발생</span><span class="p">,</span><span class="w"> </span><span class="n">새</span><span class="w"> </span><span class="n">페이지</span><span class="w"> </span><span class="n">할당</span>
<span class="w">   </span><span class="o">-</span><span class="w"> </span><span class="n">물리</span><span class="w"> </span><span class="n">페이지</span><span class="p">:</span><span class="w"> </span><span class="mf">100</span><span class="p">(</span><span class="n">기존</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mf">10</span><span class="p">(</span><span class="n">복사본</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">110</span><span class="n">개</span>

<span class="mf">3.</span><span class="w"> </span><span class="n">자식</span><span class="w"> </span><span class="n">종료</span><span class="w"> </span><span class="n">후</span><span class="p">:</span>
<span class="w">   </span><span class="o">-</span><span class="w"> </span><span class="n">자식의</span><span class="w"> </span><span class="mf">10</span><span class="n">개</span><span class="w"> </span><span class="n">복사본</span><span class="w"> </span><span class="n">해제</span>
<span class="w">   </span><span class="o">-</span><span class="w"> </span><span class="n">공유</span><span class="w"> </span><span class="mf">90</span><span class="n">개의</span><span class="w"> </span><span class="n">참조</span><span class="w"> </span><span class="n">카운트</span><span class="w"> </span><span class="n">감소</span><span class="w"> </span><span class="p">(</span><span class="mf">1</span><span class="n">로</span><span class="p">)</span>
<span class="w">   </span><span class="o">-</span><span class="w"> </span><span class="n">물리</span><span class="w"> </span><span class="n">페이지</span><span class="p">:</span><span class="w"> </span><span class="mf">100</span><span class="n">개</span><span class="w"> </span><span class="p">(</span><span class="n">부모만</span><span class="w"> </span><span class="n">남음</span><span class="p">)</span>

<span class="n">각</span><span class="w"> </span><span class="n">시점별</span><span class="w"> </span><span class="n">물리</span><span class="w"> </span><span class="n">페이지</span><span class="p">:</span>
<span class="o">-</span><span class="w"> </span><span class="kr">for</span><span class="n">k</span><span class="p">()</span><span class="w"> </span><span class="n">직후</span><span class="p">:</span><span class="w"> </span><span class="mf">100</span><span class="n">개</span>
<span class="o">-</span><span class="w"> </span><span class="n">자식</span><span class="w"> </span><span class="n">수정</span><span class="w"> </span><span class="n">후</span><span class="p">:</span><span class="w"> </span><span class="mf">110</span><span class="n">개</span>
<span class="o">-</span><span class="w"> </span><span class="n">자식</span><span class="w"> </span><span class="n">종료</span><span class="w"> </span><span class="n">후</span><span class="p">:</span><span class="w"> </span><span class="mf">100</span><span class="n">개</span>
</code></pre></div>



</details>

<h3 id="4-mmap">문제 4: mmap() 분석<a class="header-link" href="#4-mmap" title="Permanent link">&para;</a></h3>
<p>다음 코드의 출력을 예측하시오.</p>
<div class="highlight"><pre><span></span><code><span class="kt">int</span><span class="w"> </span><span class="n">fd</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">open</span><span class="p">(</span><span class="s">&quot;test.txt&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">O_RDWR</span><span class="p">);</span><span class="w">  </span><span class="c1">// 내용: &quot;AAAAAAAAAA&quot;</span>
<span class="kt">char</span><span class="o">*</span><span class="w"> </span><span class="n">p1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">mmap</span><span class="p">(</span><span class="nb">NULL</span><span class="p">,</span><span class="w"> </span><span class="mi">10</span><span class="p">,</span><span class="w"> </span><span class="n">PROT_READ</span><span class="o">|</span><span class="n">PROT_WRITE</span><span class="p">,</span><span class="w"> </span><span class="n">MAP_SHARED</span><span class="p">,</span><span class="w"> </span><span class="n">fd</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">);</span>
<span class="kt">char</span><span class="o">*</span><span class="w"> </span><span class="n">p2</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">mmap</span><span class="p">(</span><span class="nb">NULL</span><span class="p">,</span><span class="w"> </span><span class="mi">10</span><span class="p">,</span><span class="w"> </span><span class="n">PROT_READ</span><span class="o">|</span><span class="n">PROT_WRITE</span><span class="p">,</span><span class="w"> </span><span class="n">MAP_PRIVATE</span><span class="p">,</span><span class="w"> </span><span class="n">fd</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">);</span>

<span class="n">p1</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="sc">&#39;B&#39;</span><span class="p">;</span>
<span class="n">p2</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="sc">&#39;C&#39;</span><span class="p">;</span>

<span class="n">printf</span><span class="p">(</span><span class="s">&quot;p1: %.10s</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">p1</span><span class="p">);</span>
<span class="n">printf</span><span class="p">(</span><span class="s">&quot;p2: %.10s</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">p2</span><span class="p">);</span>
<span class="c1">// 파일을 다시 읽으면?</span>
</code></pre></div>

<details>
<summary>정답 보기</summary>


<div class="highlight"><pre><span></span><code><span class="n">p1</span><span class="o">:</span><span class="w"> </span><span class="n">MAP_SHARED</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="err">변경이</span><span class="w"> </span><span class="err">파일에</span><span class="w"> </span><span class="err">반영</span>
<span class="n">p2</span><span class="o">:</span><span class="w"> </span><span class="n">MAP_PRIVATE</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="err">변경이</span><span class="w"> </span><span class="err">프로세스</span><span class="w"> </span><span class="err">내에서만</span><span class="w"> </span><span class="err">보임</span><span class="w"> </span><span class="o">(</span><span class="n">COW</span><span class="o">)</span>

<span class="n">p1</span><span class="o">[</span><span class="mi">0</span><span class="o">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">&#39;B&#39;</span><span class="o">:</span>
<span class="o">-</span><span class="w"> </span><span class="err">파일의</span><span class="w"> </span><span class="err">첫</span><span class="w"> </span><span class="err">번째</span><span class="w"> </span><span class="err">문자가</span><span class="w"> </span><span class="n">B로</span><span class="w"> </span><span class="err">변경</span>
<span class="o">-</span><span class="w"> </span><span class="n">p1은</span><span class="w"> </span><span class="err">파일과</span><span class="w"> </span><span class="err">공유하므로</span><span class="w"> </span><span class="err">변경</span><span class="w"> </span><span class="err">반영</span>

<span class="n">p2</span><span class="o">[</span><span class="mi">1</span><span class="o">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">&#39;C&#39;</span><span class="o">:</span>
<span class="o">-</span><span class="w"> </span><span class="n">COW</span><span class="w"> </span><span class="err">발생</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">p2의</span><span class="w"> </span><span class="err">페이지</span><span class="w"> </span><span class="err">복사</span>
<span class="o">-</span><span class="w"> </span><span class="err">복사본의</span><span class="w"> </span><span class="err">두</span><span class="w"> </span><span class="err">번째</span><span class="w"> </span><span class="err">문자가</span><span class="w"> </span><span class="n">C로</span><span class="w"> </span><span class="err">변경</span>
<span class="o">-</span><span class="w"> </span><span class="err">파일은</span><span class="w"> </span><span class="err">변경되지</span><span class="w"> </span><span class="err">않음</span>

<span class="err">출력</span><span class="o">:</span>
<span class="n">p1</span><span class="o">:</span><span class="w"> </span><span class="n">BAAAAAAAAA</span><span class="w">  </span><span class="o">(</span><span class="n">p1</span><span class="o">[</span><span class="mi">0</span><span class="o">]</span><span class="err">이</span><span class="w"> </span><span class="n">B</span><span class="o">,</span><span class="w"> </span><span class="err">파일도</span><span class="w"> </span><span class="err">변경됨</span><span class="o">)</span>
<span class="n">p2</span><span class="o">:</span><span class="w"> </span><span class="n">BCAAAAAAAA</span><span class="w">  </span><span class="o">(</span><span class="n">p1의</span><span class="w"> </span><span class="err">변경</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">p2만의</span><span class="w"> </span><span class="err">변경</span><span class="o">)</span>

<span class="err">파일을</span><span class="w"> </span><span class="err">다시</span><span class="w"> </span><span class="err">읽으면</span><span class="o">:</span><span class="w"> </span><span class="n">BAAAAAAAAA</span>
<span class="o">(</span><span class="n">p2의</span><span class="w"> </span><span class="n">C는</span><span class="w"> </span><span class="err">프로세스</span><span class="w"> </span><span class="err">내에서만</span><span class="w"> </span><span class="err">보이고</span><span class="o">,</span><span class="w"> </span><span class="err">파일에는</span><span class="w"> </span><span class="err">반영</span><span class="w"> </span><span class="err">안</span><span class="w"> </span><span class="err">됨</span><span class="o">)</span>
</code></pre></div>



</details>

<h3 id="5_1">문제 5: 요구 페이징 설계<a class="header-link" href="#5_1" title="Permanent link">&para;</a></h3>
<p>새 운영체제를 설계할 때, 순수 요구 페이징(Pure Demand Paging) 대신 프리페칭(Prefetching)을 사용할지 결정하려 합니다. 각 접근법의 장단점을 설명하시오.</p>
<details>
<summary>정답 보기</summary>


<div class="highlight"><pre><span></span><code>순수 요구 페이징:
장점:
<span class="k">-</span> 불필요한 페이지 로드 없음 (정확히 필요한 것만)
<span class="k">-</span> 초기 메모리 사용량 최소화
<span class="k">-</span> 구현 단순

단점:
<span class="k">-</span> 프로그램 시작 시 많은 페이지 폴트
<span class="k">-</span> 지역성이 없는 접근 패턴에서 성능 저하

프리페칭:
장점:
<span class="k">-</span> 예상되는 페이지를 미리 로드하여 폴트 감소
<span class="k">-</span> 순차 접근 패턴에서 효과적
<span class="k">-</span> 지역성의 원리 활용

단점:
<span class="k">-</span> 예측 실패 시 메모리 낭비
<span class="k">-</span> 구현 복잡 (좋은 예측 알고리즘 필요)
<span class="k">-</span> 불필요한 I/O 발생 가능

실제 시스템:
<span class="k">-</span> Linux: 둘 다 사용
  <span class="k">-</span> 기본: 요구 페이징
  <span class="k">-</span> 순차 접근 감지 시: readahead (프리페치)
  <span class="k">-</span> madvise(MADV_SEQUENTIAL): 프리페치 힌트

권장:
<span class="k">-</span> 기본은 요구 페이징
<span class="k">-</span> 순차 접근 패턴 감지 시 적응적 프리페칭
</code></pre></div>



</details>

<hr />
<h2 id="_5">다음 단계<a class="header-link" href="#_5" title="Permanent link">&para;</a></h2>
<p><a href="./15_Page_Replacement.md">15_Page_Replacement.md</a>에서 페이지 교체 알고리즘을 배워봅시다!</p>
<hr />
<h2 id="_6">참고 자료<a class="header-link" href="#_6" title="Permanent link">&para;</a></h2>
<ul>
<li>Silberschatz, "Operating System Concepts" Chapter 10</li>
<li>Linux man pages: <code>mmap(2)</code>, <code>fork(2)</code></li>
<li>Tanenbaum, "Modern Operating Systems" Chapter 3</li>
<li>Linux kernel source: <code>mm/memory.c</code>, <code>mm/mmap.c</code></li>
</ul>
    </div>

    
<div class="lesson-toolbar lesson-toolbar--bottom">
    <div class="toolbar-nav toolbar-nav--prev">
        
        <a href="/study/ko/OS_Theory/13_Segmentation.html" class="nav-prev">
            <span class="nav-label">Previous</span>
            <span class="nav-title">세그멘테이션 ⭐⭐⭐</span>
        </a>
        
    </div>
    <div class="toolbar-actions">
        <button class="btn btn-copy-link" data-action="copy-link" title="Copy link">
            <span class="icon">🔗</span>
            <span class="text">Copy link</span>
        </button>
        <a href="/study/ko/OS_Theory/" class="btn btn-topic-link" title="Back to topic list">
            <span class="icon">📋</span>
            <span class="text">Topic list</span>
        </a>
    </div>
    <div class="toolbar-nav toolbar-nav--next">
        
        <a href="/study/ko/OS_Theory/15_Page_Replacement.html" class="nav-next">
            <span class="nav-label">Next</span>
            <span class="nav-title">페이지 교체 ⭐⭐⭐⭐</span>
        </a>
        
    </div>
</div>


    <div class="toolbar-keyboard-hint">
        <kbd>&larr;</kbd> <kbd>&rarr;</kbd> to navigate between lessons
    </div>
</article>

<!-- Scroll to top floating button -->
<button class="scroll-to-top" id="scroll-to-top" title="Scroll to top" aria-label="Scroll to top">↑</button>

            </div>
        </main>
    </div>

    <script src="/study/static/js/app.js"></script>
    <script>
        function switchLanguage(newLang) {
            const path = window.location.pathname;
            const base = '/study';
            const currentLang = 'ko';
            const newPath = path.replace(base + '/' + currentLang + '/', base + '/' + newLang + '/');
            window.location.href = newPath + window.location.search;
        }
    </script>
    
<script>
    document.addEventListener('DOMContentLoaded', function() {
        // Copy link - independent feedback per button
        document.querySelectorAll('[data-action="copy-link"]').forEach(function(btn) {
            btn.addEventListener('click', function() {
                navigator.clipboard.writeText(window.location.href);
                var textEl = this.querySelector('.text');
                var originalText = textEl.textContent;
                textEl.textContent = 'Copied!';
                setTimeout(function() { textEl.textContent = originalText; }, 2000);
            });
        });

        // Add copy buttons to code blocks
        document.querySelectorAll('.lesson-content pre').forEach(function(pre) {
            var copyBtn = document.createElement('button');
            copyBtn.className = 'code-copy-btn';
            copyBtn.textContent = 'Copy';
            copyBtn.addEventListener('click', function() {
                var code = pre.querySelector('code');
                var text = code ? code.textContent : pre.textContent;
                navigator.clipboard.writeText(text);
                copyBtn.textContent = 'Copied!';
                setTimeout(function() { copyBtn.textContent = 'Copy'; }, 2000);
            });
            pre.style.position = 'relative';
            pre.appendChild(copyBtn);
        });

        // Scroll to top button
        var scrollBtn = document.getElementById('scroll-to-top');
        window.addEventListener('scroll', function() {
            scrollBtn.classList.toggle('visible', window.scrollY > 300);
        });
        scrollBtn.addEventListener('click', function() {
            window.scrollTo({ top: 0, behavior: 'smooth' });
        });

        // Keyboard shortcuts: left/right arrows for lesson navigation
        document.addEventListener('keydown', function(e) {
            var tag = document.activeElement.tagName;
            if (tag === 'INPUT' || tag === 'TEXTAREA' || tag === 'SELECT') return;

            if (e.key === 'ArrowLeft') {
                var prevLink = document.querySelector('.nav-prev');
                if (prevLink) prevLink.click();
            } else if (e.key === 'ArrowRight') {
                var nextLink = document.querySelector('.nav-next');
                if (nextLink) nextLink.click();
            }
        });
    });
</script>

</body>
</html>
{% endraw %}