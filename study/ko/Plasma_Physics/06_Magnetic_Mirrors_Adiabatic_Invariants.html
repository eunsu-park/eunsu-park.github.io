{% raw %}
<!DOCTYPE html>
<html lang="ko" data-theme="light">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>6. 자기 거울과 단열 불변량 - Study Materials</title>
    <link rel="stylesheet" href="/study/static/css/style.css">
    <link rel="stylesheet" href="/study/static/css/highlight.css">
    <!-- KaTeX for LaTeX math rendering -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.16.11/dist/katex.min.css">
    <script defer src="https://cdn.jsdelivr.net/npm/katex@0.16.11/dist/katex.min.js"></script>
    <script defer src="https://cdn.jsdelivr.net/npm/katex@0.16.11/dist/contrib/auto-render.min.js"
        onload="renderMathInElement(document.body, {
            delimiters: [
                {left: '$$', right: '$$', display: true},
                {left: '$', right: '$', display: false}
            ],
            throwOnError: false
        });"></script>
    
</head>
<body>
    <div class="app-container">
        <!-- Sidebar -->
        <aside class="sidebar" id="sidebar">
            <div class="sidebar-header">
                <a href="/study/ko/" class="logo">Study Materials</a>
                <button class="sidebar-toggle" id="sidebar-toggle" aria-label="Toggle sidebar">
                    <span></span>
                </button>
            </div>

            <nav class="sidebar-nav">
                <a href="/study/ko/" class="nav-item ">
                    <span class="nav-icon">🏠</span>
                    <span class="nav-text">Home</span>
                </a>
                <a href="/study/examples/" class="nav-item ">
                    <span class="nav-icon">💻</span>
                    <span class="nav-text">Examples</span>
                </a>
            </nav>

            <div class="sidebar-search">
                <form action="/study/ko/search.html" method="get" id="search-form">
                    <input type="search" name="q" placeholder="Search..." id="search-sidebar-input">
                </form>
            </div>

            <!-- Language Selector -->
            <div class="sidebar-lang">
                <select id="lang-select" class="lang-selector" onchange="switchLanguage(this.value)">
                    
                    <option value="en" >
                        English
                    </option>
                    
                    <option value="ko" selected>
                        한국어
                    </option>
                    
                </select>
            </div>

            <div class="sidebar-footer">
                <button class="theme-toggle" id="theme-toggle" aria-label="Toggle theme">
                    <span class="theme-icon light">☀️</span>
                    <span class="theme-icon dark">🌙</span>
                </button>
            </div>
        </aside>

        <!-- Main Content -->
        <main class="main-content">
            <header class="main-header">
                <button class="menu-toggle" id="menu-toggle" aria-label="Open menu">
                    <span></span>
                </button>
                
<nav class="breadcrumb">
    <a href="/study/ko/">Topics</a>
    <span class="separator">/</span>
    <a href="/study/ko/Plasma_Physics/">Plasma Physics</a>
    <span class="separator">/</span>
    <span class="current">6. 자기 거울과 단열 불변량</span>
</nav>

            </header>

            <div class="content">
                
<article class="lesson-article">
    <header class="lesson-header">
        <h1>6. 자기 거울과 단열 불변량</h1>
    </header>

    
<div class="lesson-toolbar lesson-toolbar--top">
    <div class="toolbar-nav toolbar-nav--prev">
        
        <a href="/study/ko/Plasma_Physics/05_Single_Particle_Motion_II.html" class="nav-prev">
            <span class="nav-label">Previous</span>
            <span class="nav-title">5. 단일 입자 운동 II</span>
        </a>
        
    </div>
    <div class="toolbar-actions">
        <button class="btn btn-copy-link" data-action="copy-link" title="Copy link">
            <span class="icon">🔗</span>
            <span class="text">Copy link</span>
        </button>
        <a href="/study/ko/Plasma_Physics/" class="btn btn-topic-link" title="Back to topic list">
            <span class="icon">📋</span>
            <span class="text">Topic list</span>
        </a>
    </div>
    <div class="toolbar-nav toolbar-nav--next">
        
        <a href="/study/ko/Plasma_Physics/07_Vlasov_Equation.html" class="nav-next">
            <span class="nav-label">Next</span>
            <span class="nav-title">7. Vlasov 방정식</span>
        </a>
        
    </div>
</div>


    
    <nav class="toc" id="toc">
        <h2>Table of Contents</h2>
        <div class="toc">
<ul>
<li><a href="#_1">학습 목표</a></li>
<li><a href="#1">1. 자기 거울 힘</a><ul>
<li><a href="#11">1.1 수렴하는 자기력선</a></li>
<li><a href="#12">1.2 거울 힘의 유도</a></li>
<li><a href="#13">1.3 물리적 해석</a></li>
</ul>
</li>
<li><a href="#2">2. 첫 번째 단열 불변량: 자기 모멘트 μ</a><ul>
<li><a href="#21-">2.1 작용-각 변수를 통한 보존 증명</a></li>
<li><a href="#22">2.2 물리적 의미: 자속 보존</a></li>
<li><a href="#23">2.3 단열성의 붕괴</a></li>
</ul>
</li>
<li><a href="#3">3. 자기 거울과 보틀</a><ul>
<li><a href="#31">3.1 거울 기하학</a></li>
<li><a href="#32">3.2 피치각과 손실 원뿔</a></li>
<li><a href="#33">3.3 손실 원뿔 입체각</a></li>
<li><a href="#34">3.4 자기 보틀</a></li>
</ul>
</li>
<li><a href="#4">4. 바운스 운동</a><ul>
<li><a href="#41">4.1 바운스 궤적</a></li>
<li><a href="#42">4.2 바운스 주파수</a></li>
<li><a href="#43">4.3 바운스 평균 드리프트</a></li>
</ul>
</li>
<li><a href="#5">5. 두 번째와 세 번째 단열 불변량</a><ul>
<li><a href="#51">5.1 시간 규모의 계층</a></li>
<li><a href="#52-j">5.2 두 번째 단열 불변량: J</a></li>
<li><a href="#53-j">5.3 J의 물리적 의미</a></li>
<li><a href="#54">5.4 세 번째 단열 불변량: Φ</a></li>
<li><a href="#55">5.5 단열 불변량 요약</a></li>
</ul>
</li>
<li><a href="#6_1">6. 토카막 궤도</a><ul>
<li><a href="#61">6.1 토카막 기하학 복습</a></li>
<li><a href="#62">6.2 포획된 입자와 통과 입자</a></li>
<li><a href="#63">6.3 바나나 궤도</a></li>
<li><a href="#64">6.4 통과 입자</a></li>
<li><a href="#65">6.5 신고전적 수송</a></li>
</ul>
</li>
<li><a href="#7-van-allen">7. Van Allen 복사대</a><ul>
<li><a href="#71">7.1 자기 거울로서의 지구 자기권</a></li>
<li><a href="#72">7.2 이중대 구조</a></li>
<li><a href="#73">7.3 쌍극자 장에서의 입자 운동</a></li>
<li><a href="#74">7.4 손실 메커니즘</a></li>
</ul>
</li>
<li><a href="#8-python">8. Python 구현</a><ul>
<li><a href="#81">8.1 자기 거울 시뮬레이션</a></li>
<li><a href="#82">8.2 손실 원뿔 시각화</a></li>
<li><a href="#83">8.3 바나나 궤도 시뮬레이션 (단순화된 토카막)</a></li>
</ul>
</li>
<li><a href="#_2">요약</a></li>
<li><a href="#_3">연습 문제</a><ul>
<li><a href="#1_1">문제 1: 거울 구속 시간</a></li>
<li><a href="#2_1">문제 2: 천천히 변하는 장에서 μ의 보존</a></li>
<li><a href="#3_1">문제 3: 포물선 거울에서의 바운스 주파수</a></li>
<li><a href="#4_1">문제 4: 토카막 바나나 폭</a></li>
<li><a href="#5_1">문제 5: 쌍극자 장에서의 두 번째 단열 불변량</a></li>
</ul>
</li>
<li><a href="#_4">내비게이션</a></li>
</ul>
</div>

    </nav>
    

    <div class="lesson-content markdown-body">
        <h1 id="6">6. 자기 거울과 단열 불변량<a class="header-link" href="#6" title="Permanent link">&para;</a></h1>
<h2 id="_1">학습 목표<a class="header-link" href="#_1" title="Permanent link">&para;</a></h2>
<ul>
<li>자기 거울 힘과 입자 구속에서의 역할 이해</li>
<li>첫 번째 단열 불변량(자기 모멘트) 유도 및 보존 증명</li>
<li>자기 거울 기하학, 손실 원뿔, 포획된 입자 대 통과 입자 분석</li>
<li>단열 불변량의 계층과 관련 시간 규모 탐구</li>
<li>토카막 궤도(바나나 궤도와 통과 입자) 연구</li>
<li>Python을 사용하여 자기 거울 구속과 손실 원뿔 동역학 시뮬레이션</li>
</ul>
<h2 id="1">1. 자기 거울 힘<a class="header-link" href="#1" title="Permanent link">&para;</a></h2>
<h3 id="11">1.1 수렴하는 자기력선<a class="header-link" href="#11" title="Permanent link">&para;</a></h3>
<p>자기력선이 수렴하는(자기장 세기가 증가하는) 영역에서, 자이로하는 입자는 더 높은 자기장 영역으로의 운동을 반대하는 힘을 경험합니다. 이것이 <strong>자기 거울 힘</strong>입니다.</p>
<p>호장 $s$에 따라 $B = B(s)$가 변하는 자기력선을 따라 움직이는 입자를 고려하세요:</p>
<div class="highlight"><pre><span></span><code>    약한 장              강한 장
    B_low                   B_high
      ↓                       ↓
      |                       |||
      |        입자            |||
      |  ←──── 움직임 ────→   |||
      |          →            |||
      |                       |||

    큰 r_L              작은 r_L
    (자이로반경)          (자이로반경)
</code></pre></div>

<p>입자의 수직 속도 성분은 반경 $r_L = mv_\perp/(|q|B)$로 자이로합니다. $B$가 증가하면 $r_L$이 감소하지만, 수직 운동 에너지는 Lorentz 힘이 한 일로 인해 변합니다.</p>
<h3 id="12">1.2 거울 힘의 유도<a class="header-link" href="#12" title="Permanent link">&para;</a></h3>
<p>자기 모멘트는 다음과 같이 정의됩니다:</p>
<p>$$
\mu = \frac{mv_\perp^2}{2B} = \frac{W_\perp}{B}
$$</p>
<p>여기서 $W_\perp = \frac{1}{2}mv_\perp^2$는 수직 운동 에너지입니다.</p>
<p>천천히 변하는 장(단열 한계)에 대해, $\mu$가 보존됩니다 (섹션 2에서 엄밀하게 증명). $\mu$ = 상수로 가정:</p>
<p>$$
W_\perp = \mu B = \text{상수} \times B
$$</p>
<p>총 에너지는 보존됩니다:</p>
<p>$$
W = W_\perp + W_\parallel = \frac{1}{2}m(v_\perp^2 + v_\parallel^2) = \text{상수}
$$</p>
<p>따라서:</p>
<p>$$
\frac{dW_\parallel}{ds} = -\frac{dW_\perp}{ds} = -\mu\frac{dB}{ds}
$$</p>
<p>평행 힘은:</p>
<p>$$
F_\parallel = \frac{dW_\parallel}{ds} = -\mu\frac{dB}{ds} = -\mu\nabla_\parallel B
$$</p>
<p><strong>이것이 자기 거울 힘입니다</strong>: 더 높은 $B$ 영역으로의 운동을 반대합니다.</p>
<h3 id="13">1.3 물리적 해석<a class="header-link" href="#13" title="Permanent link">&para;</a></h3>
<p>거울 힘은 $\mathbf{B}$가 불균일할 때 Lorentz 힘 $\mathbf{F} = q\mathbf{v}\times\mathbf{B}$가 자기력선을 따라 성분을 가지기 때문에 발생합니다. 수렴하는 장에서 자이로하는 입자를 고려하세요:</p>
<div class="highlight"><pre><span></span><code>    자이로궤도 상단 (높은 B로 움직임)
         ↑ v_perp
         |
    ────┼──── B 자기력선
         |
         ↓ Lorentz 힘이 운동을 반대하는 성분을 가짐

    자이로궤도 하단 (낮은 B로 움직임)
         |
    ────┼──── B 자기력선
         ↓ v_perp
         ↑ Lorentz 힘이 운동을 돕는 성분을 가짐

    알짜 효과: 높은 B로의 운동을 반대하는 힘
</code></pre></div>

<p>자이로주기에 걸쳐 평균하면 거울 힘 $F_\parallel = -\mu\nabla_\parallel B$를 얻습니다.</p>
<h2 id="2">2. 첫 번째 단열 불변량: 자기 모멘트 μ<a class="header-link" href="#2" title="Permanent link">&para;</a></h2>
<h3 id="21-">2.1 작용-각 변수를 통한 보존 증명<a class="header-link" href="#21-" title="Permanent link">&para;</a></h3>
<p>자기 모멘트 $\mu$는 첫 번째 단열 불변량입니다. 보존을 증명하기 위해, 고전 역학의 작용-각 형식을 사용합니다.</p>
<p>자이로운동과 관련된 작용은:</p>
<p>$$
J_\perp = \oint p_\perp \, dq_\perp
$$</p>
<p>여기서 적분은 한 자이로주기에 걸쳐입니다. 자기장에서의 원운동에 대해:</p>
<p>$$
J_\perp = m v_\perp \cdot 2\pi r_L = m v_\perp \cdot 2\pi \frac{mv_\perp}{|q|B} = \frac{2\pi m^2 v_\perp^2}{|q|B}
$$</p>
<p>단열 불변량은:</p>
<p>$$
I = \frac{J_\perp}{2\pi} = \frac{m^2 v_\perp^2}{|q|B} = \frac{2m}{|q|}\frac{mv_\perp^2}{2B} = \frac{2m}{|q|}\mu
$$</p>
<p>따라서, 장이 자이로주기에 비해 천천히 변할 때 $\mu$가 보존됩니다:</p>
<p>$$
\frac{1}{\omega_c}\frac{dB}{dt} \ll B
$$</p>
<p>이것이 <strong>단열 조건</strong> 또는 <strong>느린 변화 조건</strong>입니다.</p>
<h3 id="22">2.2 물리적 의미: 자속 보존<a class="header-link" href="#22" title="Permanent link">&para;</a></h3>
<p>자기 모멘트는 또한 자이로궤도를 통과하는 자기 자속으로 해석될 수 있습니다:</p>
<p>$$
\Phi_\text{gyro} = \pi r_L^2 B = \pi \left(\frac{mv_\perp}{|q|B}\right)^2 B = \frac{\pi m^2 v_\perp^2}{q^2 B}
$$</p>
<p>이것은 $\mu$에 비례합니다:</p>
<p>$$
\Phi_\text{gyro} = \frac{\pi m^2 v_\perp^2}{q^2 B} = \frac{\pi m}{q^2} \cdot \frac{mv_\perp^2}{B} = \frac{2\pi m}{q^2}\mu
$$</p>
<p><strong>$\mu$의 보존은 자이로궤도를 통과하는 자기 자속이 보존됨을 의미합니다</strong> (천천히 변하는 장에 대해).</p>
<h3 id="23">2.3 단열성의 붕괴<a class="header-link" href="#23" title="Permanent link">&para;</a></h3>
<p>단열 불변성은 다음의 경우 붕괴합니다:</p>
<ol>
<li><strong>빠른 장 변화</strong>: $\frac{1}{\omega_c}\frac{dB}{dt} \sim B$ (자이로주기와 비슷함)</li>
<li><strong>강한 기울기</strong>: $r_L |\nabla B| / B \sim 1$ (기울기 척도가 자이로반경과 비슷함)</li>
<li><strong>공명</strong>: 주파수 $\omega \approx n\omega_c$에서의 외부 섭동 (자이로공명)</li>
</ol>
<p>예: 자기 재결합 영역에서, $B$가 빠르게 변할 수 있어, 단열성을 위반하고 입자가 $\mu$를 변경할 수 있게 합니다.</p>
<h2 id="3">3. 자기 거울과 보틀<a class="header-link" href="#3" title="Permanent link">&para;</a></h2>
<h3 id="31">3.1 거울 기하학<a class="header-link" href="#31" title="Permanent link">&para;</a></h3>
<p>자기 거울은 약한 장 영역으로 분리된 두 강한 장 영역(거울)으로 구성됩니다:</p>
<div class="highlight"><pre><span></span><code>    거울 1              중앙면           거울 2
    B_max                   B_min             B_max
      |||                     |                 |||
      |||                     |                 |||
      ||| ←─── 입자 ───→  |  ←────────────→ |||
      |||      포획됨        |                 |||
      |||                     |                 |||
       ↑                      ↑                  ↑
    반사점                  적도            반사점
</code></pre></div>

<p>거울 비율은:</p>
<p>$$
R = \frac{B_{\text{max}}}{B_{\text{min}}}
$$</p>
<h3 id="32">3.2 피치각과 손실 원뿔<a class="header-link" href="#32" title="Permanent link">&para;</a></h3>
<p>피치각 $\alpha$는 속도와 자기장 사이의 각도입니다:</p>
<p>$$
\alpha = \arctan\left(\frac{v_\perp}{v_\parallel}\right)
$$</p>
<p>중앙면($B = B_0 = B_{\text{min}}$)에서, 피치각은 $\alpha_0$입니다:</p>
<p>$$
\tan\alpha_0 = \frac{v_{\perp,0}}{v_{\parallel,0}}
$$</p>
<p>$\mu$와 총 에너지 보존 사용:</p>
<p>$$
\mu = \frac{mv_\perp^2}{2B} = \text{상수}
$$</p>
<p>$$
v^2 = v_\perp^2 + v_\parallel^2 = \text{상수}
$$</p>
<p>거울점($v_\parallel = 0$)에서, $v_\perp = v$이고 $B = B_{\text{mirror}}$:</p>
<p>$$
\frac{mv^2}{2B_{\text{mirror}}} = \frac{mv_{\perp,0}^2}{2B_0}
$$</p>
<p>따라서:</p>
<p>$$
\frac{v_\perp^2}{v^2}\bigg|_{\text{mirror}} = 1 = \frac{v_{\perp,0}^2}{v^2} \cdot \frac{B_{\text{mirror}}}{B_0}
$$</p>
<p>$v_{\perp,0}^2/v^2 = \sin^2\alpha_0$이므로:</p>
<p>$$
\sin^2\alpha_0 = \frac{B_0}{B_{\text{mirror}}}
$$</p>
<p>입자가 <strong>포획</strong>되려면 ($B_{\text{max}}$에 도달하기 전에 반사):</p>
<p>$$
\sin^2\alpha_0 > \frac{B_0}{B_{\text{max}}} = \frac{1}{R}
$$</p>
<p>또는 동등하게:</p>
<p>$$
\boxed{\alpha_0 > \alpha_c = \arcsin\left(\frac{1}{\sqrt{R}}\right)}
$$</p>
<p>이것이 <strong>손실 원뿔</strong>을 정의합니다: $\alpha_0 < \alpha_c$인 입자는 포획되지 않고 탈출합니다.</p>
<h3 id="33">3.3 손실 원뿔 입체각<a class="header-link" href="#33" title="Permanent link">&para;</a></h3>
<p>속도 공간에서 손실 원뿔은 $v_\parallel$ 축 주위의 원뿔입니다:</p>
<div class="highlight"><pre><span></span><code>    속도 공간

         v_parallel
            ↑
            |       통과 입자
            |      (탈출)
            |     /
            |    / α_c (손실 원뿔 각도)
            |   /
            |  /_______________
            | /               /
            |/_______________/ ← 손실 원뿔
           /|
          / |
         /  |
        /   |
    v_perp  | 포획된 입자
            | (구속됨)
</code></pre></div>

<p>손실 원뿔의 입체각은:</p>
<p>$$
\Delta\Omega = 2\pi(1 - \cos\alpha_c) = 2\pi\left(1 - \sqrt{1 - \frac{1}{R}}\right)
$$</p>
<p>큰 거울 비율 $R \gg 1$에 대해:</p>
<p>$$
\Delta\Omega \approx \frac{\pi}{R}
$$</p>
<p>손실 원뿔에 있는 입자의 비율 (등방성 분포 가정):</p>
<p>$$
f_{\text{loss}} = \frac{\Delta\Omega}{4\pi} \approx \frac{1}{4R}
$$</p>
<h3 id="34">3.4 자기 보틀<a class="header-link" href="#34" title="Permanent link">&para;</a></h3>
<p><strong>자기 보틀</strong>은 닫힌 자기력선을 가진 거울 구성으로, 장에 수직인 모든 방향으로 구속을 제공합니다. 예:
- 단순 거울 장치
- 쌍원뿔 컵
- Minimum-B 구성 (사중극 장)</p>
<p>주요 손실 메커니즘은:
1. <strong>손실 원뿔로의 산란</strong>: 충돌이 피치각을 변경하여, 포획된 입자를 손실 원뿔로 산란시킵니다.
2. <strong>끝단 손실</strong>: 손실 원뿔에 있는 입자가 거울 목을 통해 탈출합니다.</p>
<p>구속 시간은:</p>
<p>$$
\tau_{\text{conf}} \sim \frac{R}{\nu_c}\frac{1}{f_{\text{loss}}}
$$</p>
<p>여기서 $\nu_c$는 충돌 주파수입니다.</p>
<h2 id="4">4. 바운스 운동<a class="header-link" href="#4" title="Permanent link">&para;</a></h2>
<h3 id="41">4.1 바운스 궤적<a class="header-link" href="#41" title="Permanent link">&para;</a></h3>
<p>포획된 입자는 두 거울점 사이를 바운스하며, $\mathbf{B}$에 수직으로 드리프트하면서 (grad-B와 곡률 드리프트로부터) 평행 방향으로 진동합니다.</p>
<p>평행 속도는:</p>
<p>$$
v_\parallel = \pm\sqrt{v^2 - v_\perp^2} = \pm v\sqrt{1 - \frac{\mu B}{W}}
$$</p>
<p>여기서 $\pm$는 운동 방향에 의존합니다. 거울점에서, $v_\parallel = 0$이므로:</p>
<p>$$
B_{\text{mirror}} = \frac{W}{\mu} = \frac{mv^2}{2\mu}
$$</p>
<h3 id="42">4.2 바운스 주파수<a class="header-link" href="#42" title="Permanent link">&para;</a></h3>
<p>바운스 주기는:</p>
<p>$$
\tau_b = 2\int_0^{s_{\text{mirror}}} \frac{ds}{v_\parallel(s)}
$$</p>
<p>여기서 $s$는 자기력선을 따른 호장이고 $s_{\text{mirror}}$는 거울점까지의 거리입니다.</p>
<p>$B(z) = B_0(1 + z^2/L^2)$인 포물선 거울에 대해:</p>
<p>$$
\tau_b \approx \frac{4L}{v_\parallel}
$$</p>
<p>바운스 주파수는:</p>
<p>$$
\omega_b = \frac{2\pi}{\tau_b} \approx \frac{\pi v_\parallel}{2L}
$$</p>
<p>전형적인 매개변수에 대해:
- $v_\parallel \sim 10^5$ m/s
- $L \sim 10$ m (거울 길이)
- $\omega_b \sim 10^4$ rad/s</p>
<p>이것은 자이로주파수 $\omega_c \sim 10^8$ rad/s보다 훨씬 느립니다.</p>
<h3 id="43">4.3 바운스 평균 드리프트<a class="header-link" href="#43" title="Permanent link">&para;</a></h3>
<p>grad-B와 곡률 드리프트는 자기력선을 따라 변합니다. 장기적 동작에 대해, 바운스 주기에 걸쳐 평균합니다:</p>
<p>$$
\langle\mathbf{v}_D\rangle_b = \frac{1}{\tau_b}\int_0^{\tau_b} \mathbf{v}_D(s(t)) \, dt
$$</p>
<p>이 바운스 평균 드리프트가 입자 궤도의 느린 진화를 결정합니다.</p>
<h2 id="5">5. 두 번째와 세 번째 단열 불변량<a class="header-link" href="#5" title="Permanent link">&para;</a></h2>
<h3 id="51">5.1 시간 규모의 계층<a class="header-link" href="#51" title="Permanent link">&para;</a></h3>
<p>자기화된 플라즈마에는 세 가지 자연 시간 규모가 있습니다:</p>
<p>$$
\omega_c \gg \omega_b \gg \omega_d
$$</p>
<p>여기서:
- $\omega_c = |q|B/m$: 자이로주파수
- $\omega_b \sim v_\parallel/L$: 바운스 주파수
- $\omega_d \sim v_D/R$: 드리프트 주파수</p>
<p>각 시간 규모는 단열 불변량과 연관됩니다.</p>
<h3 id="52-j">5.2 두 번째 단열 불변량: J<a class="header-link" href="#52-j" title="Permanent link">&para;</a></h3>
<p>두 번째 불변량은 바운스 운동과 연관됩니다:</p>
<p>$$
\boxed{J = \oint m v_\parallel \, ds}
$$</p>
<p>여기서 적분은 두 거울점 사이의 자기력선을 따릅니다. 이것은 바운스 운동에 대한 작용입니다.</p>
<p><strong>보존</strong>: $J$는 자기장이 바운스 주기에 비해 천천히 변할 때 보존됩니다:</p>
<p>$$
\frac{1}{\omega_b}\frac{\partial B}{\partial t} \ll B
$$</p>
<h3 id="53-j">5.3 J의 물리적 의미<a class="header-link" href="#53-j" title="Permanent link">&para;</a></h3>
<p>$J$는 $(s, p_\parallel)$ 위상 공간에서 둘러싸인 면적과 관련됩니다:</p>
<div class="highlight"><pre><span></span><code>    p_parallel = m v_parallel
         ↑
         |
         |    /\
         |   /  \    입자가 바운스
         |  /    \   거울점 사이
         | /      \
         |/        \___
        ─┼──────────────→ s (자기력선을 따른 위치)
         0       s_mirror

    둘러싸인 면적 = J
</code></pre></div>

<p>$J$의 보존은 장이 천천히 변하면 입자가 같은 바운스 궤도에 남아 있음을 의미합니다.</p>
<h3 id="54">5.4 세 번째 단열 불변량: Φ<a class="header-link" href="#54" title="Permanent link">&para;</a></h3>
<p>세 번째 불변량은 축 주위의 드리프트 운동과 연관됩니다:</p>
<p>$$
\boxed{\Phi = \oint \mathbf{A}\cdot d\mathbf{l}}
$$</p>
<p>여기서 적분은 드리프트 궤도 주위이고 $\mathbf{A}$는 벡터 포텐셜입니다 ($\mathbf{B} = \nabla\times\mathbf{A}$).</p>
<p>Stokes 정리 사용:</p>
<p>$$
\Phi = \int_S (\nabla\times\mathbf{A})\cdot d\mathbf{S} = \int_S \mathbf{B}\cdot d\mathbf{S}
$$</p>
<p><strong>$\Phi$는 드리프트 궤도에 의해 둘러싸인 자기 자속입니다.</strong></p>
<p><strong>보존</strong>: $\Phi$는 자기장이 드리프트 주기에 비해 천천히 변할 때 보존됩니다:</p>
<p>$$
\frac{1}{\omega_d}\frac{\partial B}{\partial t} \ll B
$$</p>
<h3 id="55">5.5 단열 불변량 요약<a class="header-link" href="#55" title="Permanent link">&para;</a></h3>
<table>
<thead>
<tr>
<th>불변량</th>
<th>공식</th>
<th>관련 운동</th>
<th>시간 규모</th>
<th>보존 조건</th>
</tr>
</thead>
<tbody>
<tr>
<td><strong>μ</strong></td>
<td>$\frac{mv_\perp^2}{2B}$</td>
<td>자이로운동</td>
<td>$\omega_c^{-1}$</td>
<td>$\tau_c \ll \tau_{\text{var}}$</td>
</tr>
<tr>
<td><strong>J</strong></td>
<td>$\oint mv_\parallel ds$</td>
<td>바운스</td>
<td>$\omega_b^{-1}$</td>
<td>$\tau_b \ll \tau_{\text{var}}$</td>
</tr>
<tr>
<td><strong>Φ</strong></td>
<td>$\oint \mathbf{A}\cdot d\mathbf{l}$</td>
<td>드리프트</td>
<td>$\omega_d^{-1}$</td>
<td>$\tau_d \ll \tau_{\text{var}}$</td>
</tr>
</tbody>
</table>
<p>여기서 $\tau_{\text{var}}$는 장 변화의 특성 시간입니다.</p>
<p><strong>핵심 원리</strong>: 각 불변량은 장이 관련 운동 주기에 비해 천천히 변할 때 보존됩니다.</p>
<h2 id="6_1">6. 토카막 궤도<a class="header-link" href="#6_1" title="Permanent link">&para;</a></h2>
<h3 id="61">6.1 토카막 기하학 복습<a class="header-link" href="#61" title="Permanent link">&para;</a></h3>
<p>토카막은 다음을 가집니다:
- <strong>환형 장</strong> $B_\phi \propto 1/R$ (주반경이 증가하면서 감소)
- <strong>폴로이달 장</strong> $B_\theta$ (플라즈마 전류로부터)
- <strong>총 장</strong>: $\mathbf{B} = B_\phi\hat{\phi} + B_\theta\hat{\theta}$</p>
<p>장은 내부측(작은 $R$)에서 외부측(큰 $R$)보다 강합니다:</p>
<div class="highlight"><pre><span></span><code>    토카막 위에서 본 모습

         약한 장
         (외부측)
             |
        ─────┼─────
       /     |     \
      /      o      \   ← 플라즈마
     │  (자기       │
     │    축)       │
      \            /
       \          /
        ──────────
             |
         강한 장
         (내부측)
</code></pre></div>

<p>이것은 환형 방향으로 자기 거울 효과를 만듭니다.</p>
<h3 id="62">6.2 포획된 입자와 통과 입자<a class="header-link" href="#62" title="Permanent link">&para;</a></h3>
<p>$B_\phi$의 $1/R$ 변화로 인해, 입자는 다음이 될 수 있습니다:</p>
<ol>
<li><strong>통과 입자</strong>: 토러스 주위로 완전한 폴로이달 회로를 완성합니다.</li>
<li><strong>포획된 입자</strong>: 내부측(높은 $B$)에서 반사되어 회로를 완성할 수 없습니다.</li>
</ol>
<p>포획 조건은 자기 거울과 유사합니다. 외부 중앙면($\theta = 0$, $R = R_0 + a$)에서:</p>
<p>$$
\sin^2\alpha_0 < \frac{B_{\text{out}}}{B_{\text{in}}} \approx \frac{R_{\text{in}}}{R_{\text{out}}} = \frac{R_0 - a}{R_0 + a} \approx 1 - \frac{2a}{R_0} = 1 - 2\epsilon
$$</p>
<p>여기서 $\epsilon = a/R_0$는 역 종횡비입니다.</p>
<p>작은 $\epsilon$에 대해:</p>
<p>$$
\alpha_c \approx \sqrt{2\epsilon}
$$</p>
<p>포획된 입자의 비율은:</p>
<p>$$
f_{\text{trap}} \approx \sqrt{2\epsilon} \approx \sqrt{\frac{a}{R_0}}
$$</p>
<p>$\epsilon \sim 0.3$인 전형적인 토카막에 대해:</p>
<p>$$
f_{\text{trap}} \approx 0.77 \approx 77\%
$$</p>
<h3 id="63">6.3 바나나 궤도<a class="header-link" href="#63" title="Permanent link">&para;</a></h3>
<p>포획된 입자는 수직으로 드리프트하고 (grad-B + 곡률 드리프트) 폴로이달 평면에서 "바나나 모양" 궤도를 그립니다:</p>
<div class="highlight"><pre><span></span><code>    폴로이달 단면

         상단
          |
      ────┼────
     /    |    \
    │  /──┴──\  │  ← 바나나 궤도
    │ │       │ │     (포획된 입자)
    │  \─────/  │
     \         /
      ─────────
          |
        하단

    통과 궤도: 주위로 완전한 원
    바나나 궤도: 반사되고, 드리프트가 바나나 모양 생성
</code></pre></div>

<p>바나나 폭(방사상 이탈)은:</p>
<p>$$
\Delta r_b \sim q\rho_i\sqrt{\epsilon}
$$</p>
<p>여기서:
- $q = rB_\phi/(R_0 B_\theta)$는 안전 인자
- $\rho_i = m_i v_{th,i}/(eB)$는 이온 Larmor 반경
- $\epsilon = a/R_0$</p>
<p><strong>중요성</strong>: 바나나 궤도는 다음에 의해 구속을 감소시킵니다:
1. 방사상 수송에 대한 유효 단계 크기 증가
2. 신고전적 수송 생성 (충돌 탈포획)</p>
<h3 id="64">6.4 통과 입자<a class="header-link" href="#64" title="Permanent link">&para;</a></h3>
<p>통과 입자는 큰 $v_\parallel$를 가지고 완전한 폴로이달 회로를 완성합니다. 그들도 수직으로 드리프트하지만 닫힌 자속 표면에 남습니다 (이상적인 축대칭 기하학에서).</p>
<p>자속 표면으로부터의 궤도 이동은:</p>
<p>$$
\Delta r_{\text{pass}} \sim q\rho_i
$$</p>
<p>바나나 폭보다 훨씬 작습니다.</p>
<h3 id="65">6.5 신고전적 수송<a class="header-link" href="#65" title="Permanent link">&para;</a></h3>
<p>포획된 입자 궤도와 충돌의 조합은 고전적 (충돌 기반) 수송을 초과하는 <strong>신고전적 수송</strong>을 유도합니다:</p>
<p>$$
D_{\text{neo}} = \frac{q^2\rho_i^2}{\tau_e}\epsilon^{3/2}
$$</p>
<p>여기서 $\tau_e$는 전자 충돌 시간입니다.</p>
<p>이것은 고전적 확산 $D_{\text{class}} \sim \rho_i^2/\tau_e$보다 $\sim q^2\epsilon^{3/2}$ 배 더 큽니다.</p>
<h2 id="7-van-allen">7. Van Allen 복사대<a class="header-link" href="#7-van-allen" title="Permanent link">&para;</a></h2>
<h3 id="71">7.1 자기 거울로서의 지구 자기권<a class="header-link" href="#71" title="Permanent link">&para;</a></h3>
<p>지구의 쌍극자 자기장은 자연 자기 보틀을 형성합니다:</p>
<div class="highlight"><pre><span></span><code>    태양풍
    ────────→

         자기권 경계
           ____
          /    \
         /      \
    ────┤ 지구  ├────  적도면
         \      /
          \____/

    자기력선:
    <span class="k">-</span> 주간측에서 압축됨 (태양풍 압력)
    <span class="k">-</span> 야간측에서 연장됨 (자기꼬리)
    <span class="k">-</span> 닫힌 자기력선에 포획된 입자
</code></pre></div>

<p>전하를 띤 입자(태양풍과 우주선으로부터의 전자와 양성자)가 쌍극자 장에 포획되어 Van Allen 복사대를 형성합니다.</p>
<h3 id="72">7.2 이중대 구조<a class="header-link" href="#72" title="Permanent link">&para;</a></h3>
<p>두 개의 주요 대가 있습니다:</p>
<ol>
<li><strong>내부대</strong> ($1.2 - 2$ 지구 반경):</li>
<li>대부분 고에너지 양성자 (10-100 MeV)</li>
<li>출처: 우주선 알베도 중성자 붕괴 (CRAND)</li>
<li>
<p>상대적으로 안정적</p>
</li>
<li>
<p><strong>외부대</strong> ($4 - 6$ 지구 반경):</p>
</li>
<li>대부분 전자 (0.1-10 MeV)</li>
<li>출처: 지자기 폭풍 동안 태양풍 주입</li>
<li>매우 가변적</li>
</ol>
<h3 id="73">7.3 쌍극자 장에서의 입자 운동<a class="header-link" href="#73" title="Permanent link">&para;</a></h3>
<p>입자는 세 가지 운동을 겪습니다:
1. <strong>자이로운동</strong> 자기력선 주위 (양성자에 대해 $\omega_c \sim 10^4$ rad/s)
2. <strong>바운스</strong> 극 근처 거울점 사이 ($\omega_b \sim 1$ rad/s)
3. <strong>드리프트</strong> 지구 주위 ($\omega_d \sim 10^{-3}$ rad/s):
   - 양성자는 서쪽으로 드리프트
   - 전자는 동쪽으로 드리프트</p>
<p>드리프트는 지자기 폭풍 동안 <strong>고리 전류</strong>를 만듭니다.</p>
<h3 id="74">7.4 손실 메커니즘<a class="header-link" href="#74" title="Permanent link">&para;</a></h3>
<p>입자는 다음을 통해 손실됩니다:
1. <strong>대기 산란</strong>: 낮은 고도에서 중성 원자와의 충돌
2. <strong>전하 교환</strong>: 양성자가 전자를 포획하여, 중성이 되어, 탈출
3. <strong>파동-입자 상호작용</strong>: VLF/ELF 파동이 입자를 손실 원뿔로 산란
4. <strong>자기권 경계 그림자</strong>: 자기력선이 자기권 경계와 교차하여, 입자가 탈출</p>
<p>수명은 며칠(외부대 전자)에서 몇 년(내부대 양성자) 범위입니다.</p>
<h2 id="8-python">8. Python 구현<a class="header-link" href="#8-python" title="Permanent link">&para;</a></h2>
<h3 id="81">8.1 자기 거울 시뮬레이션<a class="header-link" href="#81" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><span class="kn">import</span><span class="w"> </span><span class="nn">numpy</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">np</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">matplotlib.pyplot</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">plt</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">mpl_toolkits.mplot3d</span><span class="w"> </span><span class="kn">import</span> <span class="n">Axes3D</span>

<span class="c1"># Constants</span>
<span class="n">m_p</span> <span class="o">=</span> <span class="mf">1.67e-27</span>  <span class="c1"># kg</span>
<span class="n">q_p</span> <span class="o">=</span> <span class="mf">1.6e-19</span>   <span class="c1"># C</span>

<span class="k">def</span><span class="w"> </span><span class="nf">mirror_field</span><span class="p">(</span><span class="n">z</span><span class="p">,</span> <span class="n">B0</span><span class="o">=</span><span class="mf">1e-3</span><span class="p">,</span> <span class="n">L</span><span class="o">=</span><span class="mf">10.0</span><span class="p">,</span> <span class="n">R</span><span class="o">=</span><span class="mf">5.0</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Parabolic mirror field: B(z) = B0 * (1 + (z/L)^2 * (R-1))</span>

<span class="sd">    B0: midplane field (T)</span>
<span class="sd">    L: mirror length scale (m)</span>
<span class="sd">    R: mirror ratio B_max/B_min</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="n">B0</span> <span class="o">*</span> <span class="p">(</span><span class="mi">1</span> <span class="o">+</span> <span class="p">(</span><span class="n">z</span> <span class="o">/</span> <span class="n">L</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span> <span class="o">*</span> <span class="p">(</span><span class="n">R</span> <span class="o">-</span> <span class="mi">1</span><span class="p">))</span>

<span class="k">def</span><span class="w"> </span><span class="nf">mirror_grad</span><span class="p">(</span><span class="n">z</span><span class="p">,</span> <span class="n">B0</span><span class="o">=</span><span class="mf">1e-3</span><span class="p">,</span> <span class="n">L</span><span class="o">=</span><span class="mf">10.0</span><span class="p">,</span> <span class="n">R</span><span class="o">=</span><span class="mf">5.0</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Gradient of mirror field dB/dz&quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="n">B0</span> <span class="o">*</span> <span class="mi">2</span> <span class="o">*</span> <span class="p">(</span><span class="n">R</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="o">*</span> <span class="n">z</span> <span class="o">/</span> <span class="n">L</span><span class="o">**</span><span class="mi">2</span>

<span class="k">def</span><span class="w"> </span><span class="nf">equations_of_motion_mirror</span><span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="n">state</span><span class="p">,</span> <span class="n">q</span><span class="p">,</span> <span class="n">m</span><span class="p">,</span> <span class="n">B0</span><span class="p">,</span> <span class="n">L</span><span class="p">,</span> <span class="n">R</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Equations of motion in mirror field</span>
<span class="sd">    state = [x, y, z, vx, vy, vz]</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">z</span><span class="p">,</span> <span class="n">vx</span><span class="p">,</span> <span class="n">vy</span><span class="p">,</span> <span class="n">vz</span> <span class="o">=</span> <span class="n">state</span>

    <span class="c1"># Magnetic field (z-component only, aligned with z-axis)</span>
    <span class="n">B</span> <span class="o">=</span> <span class="n">mirror_field</span><span class="p">(</span><span class="n">z</span><span class="p">,</span> <span class="n">B0</span><span class="p">,</span> <span class="n">L</span><span class="p">,</span> <span class="n">R</span><span class="p">)</span>
    <span class="n">Bx</span><span class="p">,</span> <span class="n">By</span><span class="p">,</span> <span class="n">Bz</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">B</span>

    <span class="c1"># Lorentz force</span>
    <span class="n">v</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">vx</span><span class="p">,</span> <span class="n">vy</span><span class="p">,</span> <span class="n">vz</span><span class="p">])</span>
    <span class="n">B_vec</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">Bx</span><span class="p">,</span> <span class="n">By</span><span class="p">,</span> <span class="n">Bz</span><span class="p">])</span>
    <span class="n">F_lorentz</span> <span class="o">=</span> <span class="n">q</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">cross</span><span class="p">(</span><span class="n">v</span><span class="p">,</span> <span class="n">B_vec</span><span class="p">)</span>

    <span class="c1"># Mirror force (adiabatic approximation)</span>
    <span class="c1"># mu = m * (vx^2 + vy^2) / (2 * B)</span>
    <span class="n">v_perp_sq</span> <span class="o">=</span> <span class="n">vx</span><span class="o">**</span><span class="mi">2</span> <span class="o">+</span> <span class="n">vy</span><span class="o">**</span><span class="mi">2</span>
    <span class="n">mu</span> <span class="o">=</span> <span class="n">m</span> <span class="o">*</span> <span class="n">v_perp_sq</span> <span class="o">/</span> <span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="n">B</span><span class="p">)</span>
    <span class="n">F_mirror</span> <span class="o">=</span> <span class="o">-</span><span class="n">mu</span> <span class="o">*</span> <span class="n">mirror_grad</span><span class="p">(</span><span class="n">z</span><span class="p">,</span> <span class="n">B0</span><span class="p">,</span> <span class="n">L</span><span class="p">,</span> <span class="n">R</span><span class="p">)</span>

    <span class="c1"># Total force (Lorentz + mirror force in z-direction)</span>
    <span class="n">Fx</span><span class="p">,</span> <span class="n">Fy</span><span class="p">,</span> <span class="n">Fz_lorentz</span> <span class="o">=</span> <span class="n">F_lorentz</span> <span class="o">/</span> <span class="n">m</span>
    <span class="n">Fz</span> <span class="o">=</span> <span class="n">Fz_lorentz</span> <span class="o">+</span> <span class="n">F_mirror</span> <span class="o">/</span> <span class="n">m</span>

    <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">vx</span><span class="p">,</span> <span class="n">vy</span><span class="p">,</span> <span class="n">vz</span><span class="p">,</span> <span class="n">Fx</span><span class="p">,</span> <span class="n">Fy</span><span class="p">,</span> <span class="n">Fz</span><span class="p">])</span>

<span class="k">def</span><span class="w"> </span><span class="nf">rk4_step</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="n">t</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">dt</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;4th-order Runge-Kutta&quot;&quot;&quot;</span>
    <span class="n">k1</span> <span class="o">=</span> <span class="n">f</span><span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">)</span>
    <span class="n">k2</span> <span class="o">=</span> <span class="n">f</span><span class="p">(</span><span class="n">t</span> <span class="o">+</span> <span class="n">dt</span><span class="o">/</span><span class="mi">2</span><span class="p">,</span> <span class="n">y</span> <span class="o">+</span> <span class="n">dt</span><span class="o">*</span><span class="n">k1</span><span class="o">/</span><span class="mi">2</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">)</span>
    <span class="n">k3</span> <span class="o">=</span> <span class="n">f</span><span class="p">(</span><span class="n">t</span> <span class="o">+</span> <span class="n">dt</span><span class="o">/</span><span class="mi">2</span><span class="p">,</span> <span class="n">y</span> <span class="o">+</span> <span class="n">dt</span><span class="o">*</span><span class="n">k2</span><span class="o">/</span><span class="mi">2</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">)</span>
    <span class="n">k4</span> <span class="o">=</span> <span class="n">f</span><span class="p">(</span><span class="n">t</span> <span class="o">+</span> <span class="n">dt</span><span class="p">,</span> <span class="n">y</span> <span class="o">+</span> <span class="n">dt</span><span class="o">*</span><span class="n">k3</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">y</span> <span class="o">+</span> <span class="n">dt</span> <span class="o">*</span> <span class="p">(</span><span class="n">k1</span> <span class="o">+</span> <span class="mi">2</span><span class="o">*</span><span class="n">k2</span> <span class="o">+</span> <span class="mi">2</span><span class="o">*</span><span class="n">k3</span> <span class="o">+</span> <span class="n">k4</span><span class="p">)</span> <span class="o">/</span> <span class="mi">6</span>

<span class="k">def</span><span class="w"> </span><span class="nf">simulate_mirror</span><span class="p">(</span><span class="n">v_perp</span><span class="p">,</span> <span class="n">v_para</span><span class="p">,</span> <span class="n">B0</span><span class="o">=</span><span class="mf">1e-3</span><span class="p">,</span> <span class="n">L</span><span class="o">=</span><span class="mf">10.0</span><span class="p">,</span> <span class="n">R</span><span class="o">=</span><span class="mf">5.0</span><span class="p">,</span>
                   <span class="n">duration</span><span class="o">=</span><span class="mf">1.0</span><span class="p">,</span> <span class="n">dt</span><span class="o">=</span><span class="mf">1e-4</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Simulate particle in magnetic mirror</span>

<span class="sd">    v_perp: initial perpendicular velocity (m/s)</span>
<span class="sd">    v_para: initial parallel velocity (m/s)</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># Initial conditions</span>
    <span class="n">x0</span><span class="p">,</span> <span class="n">y0</span><span class="p">,</span> <span class="n">z0</span> <span class="o">=</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span>
    <span class="n">vx0</span><span class="p">,</span> <span class="n">vy0</span><span class="p">,</span> <span class="n">vz0</span> <span class="o">=</span> <span class="n">v_perp</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="n">v_para</span>
    <span class="n">state</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">x0</span><span class="p">,</span> <span class="n">y0</span><span class="p">,</span> <span class="n">z0</span><span class="p">,</span> <span class="n">vx0</span><span class="p">,</span> <span class="n">vy0</span><span class="p">,</span> <span class="n">vz0</span><span class="p">])</span>

    <span class="c1"># Time array</span>
    <span class="n">num_steps</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">duration</span> <span class="o">/</span> <span class="n">dt</span><span class="p">)</span>
    <span class="n">times</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">duration</span><span class="p">,</span> <span class="n">num_steps</span><span class="p">)</span>

    <span class="c1"># Storage</span>
    <span class="n">trajectory</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">num_steps</span><span class="p">,</span> <span class="mi">6</span><span class="p">))</span>
    <span class="n">trajectory</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">state</span>

    <span class="c1"># Integration</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">num_steps</span><span class="p">):</span>
        <span class="n">state</span> <span class="o">=</span> <span class="n">rk4_step</span><span class="p">(</span><span class="n">equations_of_motion_mirror</span><span class="p">,</span> <span class="n">times</span><span class="p">[</span><span class="n">i</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="n">state</span><span class="p">,</span>
                        <span class="n">dt</span><span class="p">,</span> <span class="n">q_p</span><span class="p">,</span> <span class="n">m_p</span><span class="p">,</span> <span class="n">B0</span><span class="p">,</span> <span class="n">L</span><span class="p">,</span> <span class="n">R</span><span class="p">)</span>
        <span class="n">trajectory</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">state</span>

    <span class="k">return</span> <span class="n">times</span><span class="p">,</span> <span class="n">trajectory</span>

<span class="c1"># Calculate loss cone angle</span>
<span class="n">B0</span> <span class="o">=</span> <span class="mf">1e-3</span>  <span class="c1"># Tesla</span>
<span class="n">L</span> <span class="o">=</span> <span class="mf">10.0</span>   <span class="c1"># meters</span>
<span class="n">R</span> <span class="o">=</span> <span class="mf">5.0</span>    <span class="c1"># mirror ratio</span>

<span class="n">alpha_c</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arcsin</span><span class="p">(</span><span class="mi">1</span><span class="o">/</span><span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">R</span><span class="p">))</span> <span class="o">*</span> <span class="mi">180</span><span class="o">/</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span>  <span class="c1"># degrees</span>

<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Mirror ratio R = </span><span class="si">{</span><span class="n">R</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Loss cone angle: </span><span class="si">{</span><span class="n">alpha_c</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2">°&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Trapping condition: α &gt; </span><span class="si">{</span><span class="n">alpha_c</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2">°</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>

<span class="c1"># Simulate trapped and lost particles</span>
<span class="n">v_total</span> <span class="o">=</span> <span class="mf">1e5</span>  <span class="c1"># m/s</span>

<span class="c1"># Trapped particle (α = 60° &gt; α_c)</span>
<span class="n">alpha_trapped</span> <span class="o">=</span> <span class="mi">60</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">/</span><span class="mi">180</span>
<span class="n">v_perp_trapped</span> <span class="o">=</span> <span class="n">v_total</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">alpha_trapped</span><span class="p">)</span>
<span class="n">v_para_trapped</span> <span class="o">=</span> <span class="n">v_total</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">alpha_trapped</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Trapped particle: α = 60°&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  v_perp = </span><span class="si">{</span><span class="n">v_perp_trapped</span><span class="si">:</span><span class="s2">.2e</span><span class="si">}</span><span class="s2"> m/s&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  v_para = </span><span class="si">{</span><span class="n">v_para_trapped</span><span class="si">:</span><span class="s2">.2e</span><span class="si">}</span><span class="s2"> m/s&quot;</span><span class="p">)</span>

<span class="n">t_trap</span><span class="p">,</span> <span class="n">traj_trap</span> <span class="o">=</span> <span class="n">simulate_mirror</span><span class="p">(</span><span class="n">v_perp_trapped</span><span class="p">,</span> <span class="n">v_para_trapped</span><span class="p">,</span>
                                     <span class="n">B0</span><span class="p">,</span> <span class="n">L</span><span class="p">,</span> <span class="n">R</span><span class="p">,</span> <span class="n">duration</span><span class="o">=</span><span class="mf">2.0</span><span class="p">,</span> <span class="n">dt</span><span class="o">=</span><span class="mf">1e-4</span><span class="p">)</span>

<span class="c1"># Lost particle (α = 20° &lt; α_c)</span>
<span class="n">alpha_lost</span> <span class="o">=</span> <span class="mi">20</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">/</span><span class="mi">180</span>
<span class="n">v_perp_lost</span> <span class="o">=</span> <span class="n">v_total</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">alpha_lost</span><span class="p">)</span>
<span class="n">v_para_lost</span> <span class="o">=</span> <span class="n">v_total</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">alpha_lost</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Lost particle: α = 20°&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  v_perp = </span><span class="si">{</span><span class="n">v_perp_lost</span><span class="si">:</span><span class="s2">.2e</span><span class="si">}</span><span class="s2"> m/s&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  v_para = </span><span class="si">{</span><span class="n">v_para_lost</span><span class="si">:</span><span class="s2">.2e</span><span class="si">}</span><span class="s2"> m/s&quot;</span><span class="p">)</span>

<span class="n">t_lost</span><span class="p">,</span> <span class="n">traj_lost</span> <span class="o">=</span> <span class="n">simulate_mirror</span><span class="p">(</span><span class="n">v_perp_lost</span><span class="p">,</span> <span class="n">v_para_lost</span><span class="p">,</span>
                                     <span class="n">B0</span><span class="p">,</span> <span class="n">L</span><span class="p">,</span> <span class="n">R</span><span class="p">,</span> <span class="n">duration</span><span class="o">=</span><span class="mf">1.0</span><span class="p">,</span> <span class="n">dt</span><span class="o">=</span><span class="mf">1e-4</span><span class="p">)</span>

<span class="c1"># Plotting</span>
<span class="n">fig</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">16</span><span class="p">,</span> <span class="mi">10</span><span class="p">))</span>

<span class="c1"># 3D trajectories</span>
<span class="n">ax1</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">projection</span><span class="o">=</span><span class="s1">&#39;3d&#39;</span><span class="p">)</span>
<span class="n">ax1</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">traj_trap</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">],</span> <span class="n">traj_trap</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">],</span> <span class="n">traj_trap</span><span class="p">[:,</span> <span class="mi">2</span><span class="p">],</span>
        <span class="s1">&#39;b-&#39;</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Trapped&#39;</span><span class="p">)</span>
<span class="n">ax1</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;x (m)&#39;</span><span class="p">)</span>
<span class="n">ax1</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;y (m)&#39;</span><span class="p">)</span>
<span class="n">ax1</span><span class="o">.</span><span class="n">set_zlabel</span><span class="p">(</span><span class="s1">&#39;z (m)&#39;</span><span class="p">)</span>
<span class="n">ax1</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Trapped Particle (α = 60° &gt; α_c = </span><span class="si">{</span><span class="n">alpha_c</span><span class="si">:</span><span class="s1">.1f</span><span class="si">}</span><span class="s1">°)&#39;</span><span class="p">)</span>
<span class="n">ax1</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
<span class="n">ax1</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>

<span class="n">ax2</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="n">projection</span><span class="o">=</span><span class="s1">&#39;3d&#39;</span><span class="p">)</span>
<span class="n">ax2</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">traj_lost</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">],</span> <span class="n">traj_lost</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">],</span> <span class="n">traj_lost</span><span class="p">[:,</span> <span class="mi">2</span><span class="p">],</span>
        <span class="s1">&#39;r-&#39;</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Lost&#39;</span><span class="p">)</span>
<span class="n">ax2</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;x (m)&#39;</span><span class="p">)</span>
<span class="n">ax2</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;y (m)&#39;</span><span class="p">)</span>
<span class="n">ax2</span><span class="o">.</span><span class="n">set_zlabel</span><span class="p">(</span><span class="s1">&#39;z (m)&#39;</span><span class="p">)</span>
<span class="n">ax2</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Lost Particle (α = 20° &lt; α_c = </span><span class="si">{</span><span class="n">alpha_c</span><span class="si">:</span><span class="s1">.1f</span><span class="si">}</span><span class="s1">°)&#39;</span><span class="p">)</span>
<span class="n">ax2</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
<span class="n">ax2</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>

<span class="c1"># Z vs time (bounce motion)</span>
<span class="n">ax3</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span>
<span class="n">ax3</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">t_trap</span><span class="p">,</span> <span class="n">traj_trap</span><span class="p">[:,</span> <span class="mi">2</span><span class="p">],</span> <span class="s1">&#39;b-&#39;</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Trapped&#39;</span><span class="p">)</span>
<span class="n">ax3</span><span class="o">.</span><span class="n">axhline</span><span class="p">(</span><span class="n">y</span><span class="o">=</span><span class="n">L</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;k&#39;</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;--&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="sa">f</span><span class="s1">&#39;Mirror at ±</span><span class="si">{</span><span class="n">L</span><span class="si">}</span><span class="s1"> m&#39;</span><span class="p">)</span>
<span class="n">ax3</span><span class="o">.</span><span class="n">axhline</span><span class="p">(</span><span class="n">y</span><span class="o">=-</span><span class="n">L</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;k&#39;</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;--&#39;</span><span class="p">)</span>
<span class="n">ax3</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;Time (s)&#39;</span><span class="p">)</span>
<span class="n">ax3</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;z (m)&#39;</span><span class="p">)</span>
<span class="n">ax3</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;Bounce Motion&#39;</span><span class="p">)</span>
<span class="n">ax3</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
<span class="n">ax3</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>

<span class="c1"># Magnetic field along z</span>
<span class="n">z_array</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="o">-</span><span class="n">L</span><span class="o">*</span><span class="mf">1.5</span><span class="p">,</span> <span class="n">L</span><span class="o">*</span><span class="mf">1.5</span><span class="p">,</span> <span class="mi">1000</span><span class="p">)</span>
<span class="n">B_array</span> <span class="o">=</span> <span class="n">mirror_field</span><span class="p">(</span><span class="n">z_array</span><span class="p">,</span> <span class="n">B0</span><span class="p">,</span> <span class="n">L</span><span class="p">,</span> <span class="n">R</span><span class="p">)</span>

<span class="n">ax4</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">)</span>
<span class="n">ax4</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">z_array</span><span class="p">,</span> <span class="n">B_array</span> <span class="o">*</span> <span class="mf">1e3</span><span class="p">,</span> <span class="s1">&#39;k-&#39;</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
<span class="n">ax4</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;z (m)&#39;</span><span class="p">)</span>
<span class="n">ax4</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;B (mT)&#39;</span><span class="p">)</span>
<span class="n">ax4</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;Magnetic Field Profile&#39;</span><span class="p">)</span>
<span class="n">ax4</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>

<span class="c1"># Velocity components vs time</span>
<span class="n">ax5</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">5</span><span class="p">)</span>
<span class="n">v_perp_trap</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">traj_trap</span><span class="p">[:,</span> <span class="mi">3</span><span class="p">]</span><span class="o">**</span><span class="mi">2</span> <span class="o">+</span> <span class="n">traj_trap</span><span class="p">[:,</span> <span class="mi">4</span><span class="p">]</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>
<span class="n">v_para_trap</span> <span class="o">=</span> <span class="n">traj_trap</span><span class="p">[:,</span> <span class="mi">5</span><span class="p">]</span>
<span class="n">ax5</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">t_trap</span><span class="p">,</span> <span class="n">v_perp_trap</span><span class="o">/</span><span class="mf">1e3</span><span class="p">,</span> <span class="s1">&#39;b-&#39;</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;v_perp&#39;</span><span class="p">)</span>
<span class="n">ax5</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">t_trap</span><span class="p">,</span> <span class="n">v_para_trap</span><span class="o">/</span><span class="mf">1e3</span><span class="p">,</span> <span class="s1">&#39;r-&#39;</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;v_para&#39;</span><span class="p">)</span>
<span class="n">ax5</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;Time (s)&#39;</span><span class="p">)</span>
<span class="n">ax5</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;Velocity (km/s)&#39;</span><span class="p">)</span>
<span class="n">ax5</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;Velocity Components (Trapped)&#39;</span><span class="p">)</span>
<span class="n">ax5</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
<span class="n">ax5</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>

<span class="c1"># Adiabatic invariant μ</span>
<span class="n">B_traj_trap</span> <span class="o">=</span> <span class="n">mirror_field</span><span class="p">(</span><span class="n">traj_trap</span><span class="p">[:,</span> <span class="mi">2</span><span class="p">],</span> <span class="n">B0</span><span class="p">,</span> <span class="n">L</span><span class="p">,</span> <span class="n">R</span><span class="p">)</span>
<span class="n">mu_trap</span> <span class="o">=</span> <span class="n">m_p</span> <span class="o">*</span> <span class="n">v_perp_trap</span><span class="o">**</span><span class="mi">2</span> <span class="o">/</span> <span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="n">B_traj_trap</span><span class="p">)</span>

<span class="n">ax6</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">6</span><span class="p">)</span>
<span class="n">ax6</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">t_trap</span><span class="p">,</span> <span class="n">mu_trap</span> <span class="o">/</span> <span class="n">mu_trap</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="s1">&#39;b-&#39;</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<span class="n">ax6</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;Time (s)&#39;</span><span class="p">)</span>
<span class="n">ax6</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;μ(t) / μ(0)&#39;</span><span class="p">)</span>
<span class="n">ax6</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;Conservation of Magnetic Moment μ&#39;</span><span class="p">)</span>
<span class="n">ax6</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
<span class="n">ax6</span><span class="o">.</span><span class="n">axhline</span><span class="p">(</span><span class="n">y</span><span class="o">=</span><span class="mf">1.0</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;r&#39;</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;--&#39;</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;μ = const&#39;</span><span class="p">)</span>
<span class="n">ax6</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>

<span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="s1">&#39;magnetic_mirror.png&#39;</span><span class="p">,</span> <span class="n">dpi</span><span class="o">=</span><span class="mi">150</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Saved: magnetic_mirror.png&quot;</span><span class="p">)</span>

<span class="c1"># Calculate bounce period</span>
<span class="n">z_positions</span> <span class="o">=</span> <span class="n">traj_trap</span><span class="p">[:,</span> <span class="mi">2</span><span class="p">]</span>
<span class="c1"># Find turning points (where v_z changes sign)</span>
<span class="n">v_z</span> <span class="o">=</span> <span class="n">traj_trap</span><span class="p">[:,</span> <span class="mi">5</span><span class="p">]</span>
<span class="n">sign_changes</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">diff</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">sign</span><span class="p">(</span><span class="n">v_z</span><span class="p">))</span>
<span class="n">bounce_indices</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">sign_changes</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>

<span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">bounce_indices</span><span class="p">)</span> <span class="o">&gt;=</span> <span class="mi">2</span><span class="p">:</span>
    <span class="n">tau_bounce</span> <span class="o">=</span> <span class="n">t_trap</span><span class="p">[</span><span class="n">bounce_indices</span><span class="p">[</span><span class="mi">1</span><span class="p">]]</span> <span class="o">-</span> <span class="n">t_trap</span><span class="p">[</span><span class="n">bounce_indices</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span>
    <span class="n">omega_bounce</span> <span class="o">=</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span> <span class="o">/</span> <span class="n">tau_bounce</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Bounce period: </span><span class="si">{</span><span class="n">tau_bounce</span><span class="si">:</span><span class="s2">.4f</span><span class="si">}</span><span class="s2"> s&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Bounce frequency: </span><span class="si">{</span><span class="n">omega_bounce</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2"> rad/s&quot;</span><span class="p">)</span>

    <span class="c1"># Compare with gyrofrequency</span>
    <span class="n">omega_c</span> <span class="o">=</span> <span class="n">q_p</span> <span class="o">*</span> <span class="n">B0</span> <span class="o">/</span> <span class="n">m_p</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Gyrofrequency: </span><span class="si">{</span><span class="n">omega_c</span><span class="si">:</span><span class="s2">.2e</span><span class="si">}</span><span class="s2"> rad/s&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Ratio ω_c/ω_b: </span><span class="si">{</span><span class="n">omega_c</span><span class="o">/</span><span class="n">omega_bounce</span><span class="si">:</span><span class="s2">.2e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</code></pre></div>

<h3 id="82">8.2 손실 원뿔 시각화<a class="header-link" href="#82" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><span class="c1"># Loss cone in velocity space</span>
<span class="n">fig</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">12</span><span class="p">,</span> <span class="mi">5</span><span class="p">))</span>

<span class="c1"># 3D velocity space</span>
<span class="n">ax1</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="mi">121</span><span class="p">,</span> <span class="n">projection</span><span class="o">=</span><span class="s1">&#39;3d&#39;</span><span class="p">)</span>

<span class="c1"># Generate loss cone</span>
<span class="n">theta</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">2</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">,</span> <span class="mi">50</span><span class="p">)</span>
<span class="n">alpha_cone</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">alpha_c</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">/</span><span class="mi">180</span><span class="p">,</span> <span class="mi">20</span><span class="p">)</span>
<span class="n">theta_grid</span><span class="p">,</span> <span class="n">alpha_grid</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">meshgrid</span><span class="p">(</span><span class="n">theta</span><span class="p">,</span> <span class="n">alpha_cone</span><span class="p">)</span>

<span class="n">v</span> <span class="o">=</span> <span class="n">v_total</span>
<span class="n">vx_cone</span> <span class="o">=</span> <span class="n">v</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">alpha_grid</span><span class="p">)</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">theta_grid</span><span class="p">)</span>
<span class="n">vy_cone</span> <span class="o">=</span> <span class="n">v</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">alpha_grid</span><span class="p">)</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">theta_grid</span><span class="p">)</span>
<span class="n">vz_cone</span> <span class="o">=</span> <span class="n">v</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">alpha_grid</span><span class="p">)</span>

<span class="n">ax1</span><span class="o">.</span><span class="n">plot_surface</span><span class="p">(</span><span class="n">vx_cone</span><span class="o">/</span><span class="mf">1e3</span><span class="p">,</span> <span class="n">vy_cone</span><span class="o">/</span><span class="mf">1e3</span><span class="p">,</span> <span class="n">vz_cone</span><span class="o">/</span><span class="mf">1e3</span><span class="p">,</span>
                <span class="n">alpha</span><span class="o">=</span><span class="mf">0.3</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;red&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Loss cone&#39;</span><span class="p">)</span>

<span class="c1"># Generate trapped region (example particles)</span>
<span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">seed</span><span class="p">(</span><span class="mi">42</span><span class="p">)</span>
<span class="n">n_particles</span> <span class="o">=</span> <span class="mi">500</span>
<span class="n">alpha_samples</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arccos</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">uniform</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">n_particles</span><span class="p">))</span>
<span class="n">theta_samples</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">uniform</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">2</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">,</span> <span class="n">n_particles</span><span class="p">)</span>

<span class="c1"># Separate trapped and lost</span>
<span class="n">trapped_mask</span> <span class="o">=</span> <span class="n">alpha_samples</span> <span class="o">&gt;</span> <span class="n">alpha_c</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">/</span><span class="mi">180</span>
<span class="n">lost_mask</span> <span class="o">=</span> <span class="o">~</span><span class="n">trapped_mask</span>

<span class="n">vx_trapped</span> <span class="o">=</span> <span class="n">v</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">alpha_samples</span><span class="p">[</span><span class="n">trapped_mask</span><span class="p">])</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">theta_samples</span><span class="p">[</span><span class="n">trapped_mask</span><span class="p">])</span>
<span class="n">vy_trapped</span> <span class="o">=</span> <span class="n">v</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">alpha_samples</span><span class="p">[</span><span class="n">trapped_mask</span><span class="p">])</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">theta_samples</span><span class="p">[</span><span class="n">trapped_mask</span><span class="p">])</span>
<span class="n">vz_trapped</span> <span class="o">=</span> <span class="n">v</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">alpha_samples</span><span class="p">[</span><span class="n">trapped_mask</span><span class="p">])</span>

<span class="n">vx_lost</span> <span class="o">=</span> <span class="n">v</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">alpha_samples</span><span class="p">[</span><span class="n">lost_mask</span><span class="p">])</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">theta_samples</span><span class="p">[</span><span class="n">lost_mask</span><span class="p">])</span>
<span class="n">vy_lost</span> <span class="o">=</span> <span class="n">v</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">alpha_samples</span><span class="p">[</span><span class="n">lost_mask</span><span class="p">])</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">theta_samples</span><span class="p">[</span><span class="n">lost_mask</span><span class="p">])</span>
<span class="n">vz_lost</span> <span class="o">=</span> <span class="n">v</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">alpha_samples</span><span class="p">[</span><span class="n">lost_mask</span><span class="p">])</span>

<span class="n">ax1</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">vx_trapped</span><span class="o">/</span><span class="mf">1e3</span><span class="p">,</span> <span class="n">vy_trapped</span><span class="o">/</span><span class="mf">1e3</span><span class="p">,</span> <span class="n">vz_trapped</span><span class="o">/</span><span class="mf">1e3</span><span class="p">,</span>
           <span class="n">c</span><span class="o">=</span><span class="s1">&#39;blue&#39;</span><span class="p">,</span> <span class="n">s</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Trapped&#39;</span><span class="p">)</span>
<span class="n">ax1</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">vx_lost</span><span class="o">/</span><span class="mf">1e3</span><span class="p">,</span> <span class="n">vy_lost</span><span class="o">/</span><span class="mf">1e3</span><span class="p">,</span> <span class="n">vz_lost</span><span class="o">/</span><span class="mf">1e3</span><span class="p">,</span>
           <span class="n">c</span><span class="o">=</span><span class="s1">&#39;red&#39;</span><span class="p">,</span> <span class="n">s</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.8</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Lost&#39;</span><span class="p">)</span>

<span class="n">ax1</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;vx (km/s)&#39;</span><span class="p">)</span>
<span class="n">ax1</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;vy (km/s)&#39;</span><span class="p">)</span>
<span class="n">ax1</span><span class="o">.</span><span class="n">set_zlabel</span><span class="p">(</span><span class="s1">&#39;vz (km/s)&#39;</span><span class="p">)</span>
<span class="n">ax1</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Loss Cone in Velocity Space</span><span class="se">\n</span><span class="s1">α_c = </span><span class="si">{</span><span class="n">alpha_c</span><span class="si">:</span><span class="s1">.1f</span><span class="si">}</span><span class="s1">°, R = </span><span class="si">{</span><span class="n">R</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
<span class="n">ax1</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>

<span class="c1"># 2D pitch angle distribution</span>
<span class="n">ax2</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="mi">122</span><span class="p">)</span>
<span class="n">alpha_deg</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">180</span><span class="p">,</span> <span class="mi">1000</span><span class="p">)</span>
<span class="n">alpha_rad</span> <span class="o">=</span> <span class="n">alpha_deg</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span> <span class="o">/</span> <span class="mi">180</span>

<span class="c1"># Distribution function (isotropic) proportional to sin(α)</span>
<span class="n">f_alpha</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">alpha_rad</span><span class="p">)</span>

<span class="n">ax2</span><span class="o">.</span><span class="n">fill_between</span><span class="p">(</span><span class="n">alpha_deg</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">f_alpha</span><span class="p">,</span> <span class="n">where</span><span class="o">=</span><span class="p">(</span><span class="n">alpha_deg</span> <span class="o">&lt;</span> <span class="n">alpha_c</span><span class="p">),</span>
                <span class="n">color</span><span class="o">=</span><span class="s1">&#39;red&#39;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Loss cone (escaping)&#39;</span><span class="p">)</span>
<span class="n">ax2</span><span class="o">.</span><span class="n">fill_between</span><span class="p">(</span><span class="n">alpha_deg</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">f_alpha</span><span class="p">,</span> <span class="n">where</span><span class="o">=</span><span class="p">(</span><span class="n">alpha_deg</span> <span class="o">&gt;=</span> <span class="n">alpha_c</span><span class="p">),</span>
                <span class="n">color</span><span class="o">=</span><span class="s1">&#39;blue&#39;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Trapped&#39;</span><span class="p">)</span>
<span class="n">ax2</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">alpha_deg</span><span class="p">,</span> <span class="n">f_alpha</span><span class="p">,</span> <span class="s1">&#39;k-&#39;</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
<span class="n">ax2</span><span class="o">.</span><span class="n">axvline</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">alpha_c</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;red&#39;</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;--&#39;</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span>
           <span class="n">label</span><span class="o">=</span><span class="sa">f</span><span class="s1">&#39;α_c = </span><span class="si">{</span><span class="n">alpha_c</span><span class="si">:</span><span class="s1">.1f</span><span class="si">}</span><span class="s1">°&#39;</span><span class="p">)</span>

<span class="n">ax2</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;Pitch Angle α (degrees)&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">12</span><span class="p">)</span>
<span class="n">ax2</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;f(α) ∝ sin(α)&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">12</span><span class="p">)</span>
<span class="n">ax2</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;Pitch Angle Distribution&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">14</span><span class="p">,</span> <span class="n">fontweight</span><span class="o">=</span><span class="s1">&#39;bold&#39;</span><span class="p">)</span>
<span class="n">ax2</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
<span class="n">ax2</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="kc">True</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.3</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="s1">&#39;loss_cone.png&#39;</span><span class="p">,</span> <span class="n">dpi</span><span class="o">=</span><span class="mi">150</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Saved: loss_cone.png&quot;</span><span class="p">)</span>

<span class="c1"># Calculate fraction in loss cone</span>
<span class="n">solid_angle_loss</span> <span class="o">=</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span> <span class="o">*</span> <span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">alpha_c</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">/</span><span class="mi">180</span><span class="p">))</span>
<span class="n">solid_angle_total</span> <span class="o">=</span> <span class="mi">4</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span>
<span class="n">frac_loss</span> <span class="o">=</span> <span class="n">solid_angle_loss</span> <span class="o">/</span> <span class="n">solid_angle_total</span>

<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Loss cone solid angle: </span><span class="si">{</span><span class="n">solid_angle_loss</span><span class="si">:</span><span class="s2">.4f</span><span class="si">}</span><span class="s2"> sr&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Fraction in loss cone: </span><span class="si">{</span><span class="n">frac_loss</span><span class="si">:</span><span class="s2">.4f</span><span class="si">}</span><span class="s2"> = </span><span class="si">{</span><span class="n">frac_loss</span><span class="o">*</span><span class="mi">100</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2">%&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Fraction trapped: </span><span class="si">{</span><span class="mi">1</span><span class="o">-</span><span class="n">frac_loss</span><span class="si">:</span><span class="s2">.4f</span><span class="si">}</span><span class="s2"> = </span><span class="si">{</span><span class="p">(</span><span class="mi">1</span><span class="o">-</span><span class="n">frac_loss</span><span class="p">)</span><span class="o">*</span><span class="mi">100</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2">%&quot;</span><span class="p">)</span>
</code></pre></div>

<h3 id="83">8.3 바나나 궤도 시뮬레이션 (단순화된 토카막)<a class="header-link" href="#83" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">tokamak_field</span><span class="p">(</span><span class="n">R</span><span class="p">,</span> <span class="n">Z</span><span class="p">,</span> <span class="n">R0</span><span class="o">=</span><span class="mf">2.0</span><span class="p">,</span> <span class="n">a</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span> <span class="n">B0</span><span class="o">=</span><span class="mf">3.0</span><span class="p">,</span> <span class="n">q</span><span class="o">=</span><span class="mf">2.0</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Simplified tokamak field</span>

<span class="sd">    R, Z: cylindrical coordinates (m)</span>
<span class="sd">    R0: major radius (m)</span>
<span class="sd">    a: minor radius (m)</span>
<span class="sd">    B0: field at magnetic axis (T)</span>
<span class="sd">    q: safety factor</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># Toroidal field (1/R dependence)</span>
    <span class="n">B_phi</span> <span class="o">=</span> <span class="n">B0</span> <span class="o">*</span> <span class="n">R0</span> <span class="o">/</span> <span class="n">R</span>

    <span class="c1"># Poloidal field (simplified, from plasma current)</span>
    <span class="n">r</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">((</span><span class="n">R</span> <span class="o">-</span> <span class="n">R0</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span> <span class="o">+</span> <span class="n">Z</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">r</span> <span class="o">&lt;</span> <span class="n">a</span><span class="p">:</span>
        <span class="n">B_theta</span> <span class="o">=</span> <span class="n">B0</span> <span class="o">*</span> <span class="n">r</span> <span class="o">/</span> <span class="p">(</span><span class="n">q</span> <span class="o">*</span> <span class="n">R0</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">B_theta</span> <span class="o">=</span> <span class="n">B0</span> <span class="o">*</span> <span class="n">a</span><span class="o">**</span><span class="mi">2</span> <span class="o">/</span> <span class="p">(</span><span class="n">q</span> <span class="o">*</span> <span class="n">R0</span> <span class="o">*</span> <span class="n">r</span><span class="p">)</span>

    <span class="c1"># Components in cylindrical coordinates</span>
    <span class="n">B_R</span> <span class="o">=</span> <span class="o">-</span><span class="n">B_theta</span> <span class="o">*</span> <span class="n">Z</span> <span class="o">/</span> <span class="n">r</span> <span class="k">if</span> <span class="n">r</span> <span class="o">&gt;</span> <span class="mf">1e-6</span> <span class="k">else</span> <span class="mi">0</span>
    <span class="n">B_Z</span> <span class="o">=</span> <span class="n">B_theta</span> <span class="o">*</span> <span class="p">(</span><span class="n">R</span> <span class="o">-</span> <span class="n">R0</span><span class="p">)</span> <span class="o">/</span> <span class="n">r</span> <span class="k">if</span> <span class="n">r</span> <span class="o">&gt;</span> <span class="mf">1e-6</span> <span class="k">else</span> <span class="mi">0</span>

    <span class="k">return</span> <span class="n">B_R</span><span class="p">,</span> <span class="n">B_Z</span><span class="p">,</span> <span class="n">B_phi</span>

<span class="k">def</span><span class="w"> </span><span class="nf">tokamak_magnitude</span><span class="p">(</span><span class="n">R</span><span class="p">,</span> <span class="n">Z</span><span class="p">,</span> <span class="n">R0</span><span class="o">=</span><span class="mf">2.0</span><span class="p">,</span> <span class="n">a</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span> <span class="n">B0</span><span class="o">=</span><span class="mf">3.0</span><span class="p">,</span> <span class="n">q</span><span class="o">=</span><span class="mf">2.0</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Total field magnitude&quot;&quot;&quot;</span>
    <span class="n">B_R</span><span class="p">,</span> <span class="n">B_Z</span><span class="p">,</span> <span class="n">B_phi</span> <span class="o">=</span> <span class="n">tokamak_field</span><span class="p">(</span><span class="n">R</span><span class="p">,</span> <span class="n">Z</span><span class="p">,</span> <span class="n">R0</span><span class="p">,</span> <span class="n">a</span><span class="p">,</span> <span class="n">B0</span><span class="p">,</span> <span class="n">q</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">B_R</span><span class="o">**</span><span class="mi">2</span> <span class="o">+</span> <span class="n">B_Z</span><span class="o">**</span><span class="mi">2</span> <span class="o">+</span> <span class="n">B_phi</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>

<span class="c1"># Plot tokamak field magnitude</span>
<span class="n">R_grid</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mf">1.0</span><span class="p">,</span> <span class="mf">3.0</span><span class="p">,</span> <span class="mi">100</span><span class="p">)</span>
<span class="n">Z_grid</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="o">-</span><span class="mf">1.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">,</span> <span class="mi">100</span><span class="p">)</span>
<span class="n">R_mesh</span><span class="p">,</span> <span class="n">Z_mesh</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">meshgrid</span><span class="p">(</span><span class="n">R_grid</span><span class="p">,</span> <span class="n">Z_grid</span><span class="p">)</span>

<span class="n">B_mag</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros_like</span><span class="p">(</span><span class="n">R_mesh</span><span class="p">)</span>
<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">Z_grid</span><span class="p">)):</span>
    <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">R_grid</span><span class="p">)):</span>
        <span class="n">B_mag</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">]</span> <span class="o">=</span> <span class="n">tokamak_magnitude</span><span class="p">(</span><span class="n">R_mesh</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">],</span> <span class="n">Z_mesh</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">])</span>

<span class="n">fig</span><span class="p">,</span> <span class="p">(</span><span class="n">ax1</span><span class="p">,</span> <span class="n">ax2</span><span class="p">)</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">14</span><span class="p">,</span> <span class="mi">6</span><span class="p">))</span>

<span class="c1"># Field contours</span>
<span class="n">contour</span> <span class="o">=</span> <span class="n">ax1</span><span class="o">.</span><span class="n">contourf</span><span class="p">(</span><span class="n">R_mesh</span><span class="p">,</span> <span class="n">Z_mesh</span><span class="p">,</span> <span class="n">B_mag</span><span class="p">,</span> <span class="n">levels</span><span class="o">=</span><span class="mi">20</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="s1">&#39;viridis&#39;</span><span class="p">)</span>
<span class="n">ax1</span><span class="o">.</span><span class="n">contour</span><span class="p">(</span><span class="n">R_mesh</span><span class="p">,</span> <span class="n">Z_mesh</span><span class="p">,</span> <span class="n">B_mag</span><span class="p">,</span> <span class="n">levels</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="n">colors</span><span class="o">=</span><span class="s1">&#39;white&#39;</span><span class="p">,</span>
           <span class="n">linewidths</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.5</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">colorbar</span><span class="p">(</span><span class="n">contour</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">ax1</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;B (T)&#39;</span><span class="p">)</span>

<span class="c1"># Mark regions</span>
<span class="n">R0</span><span class="p">,</span> <span class="n">a</span> <span class="o">=</span> <span class="mf">2.0</span><span class="p">,</span> <span class="mf">0.5</span>
<span class="n">circle</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">Circle</span><span class="p">((</span><span class="n">R0</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span> <span class="n">a</span><span class="p">,</span> <span class="n">fill</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;red&#39;</span><span class="p">,</span>
                    <span class="n">linewidth</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Last closed flux surface&#39;</span><span class="p">)</span>
<span class="n">ax1</span><span class="o">.</span><span class="n">add_patch</span><span class="p">(</span><span class="n">circle</span><span class="p">)</span>
<span class="n">ax1</span><span class="o">.</span><span class="n">plot</span><span class="p">([</span><span class="n">R0</span><span class="p">],</span> <span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="s1">&#39;r*&#39;</span><span class="p">,</span> <span class="n">markersize</span><span class="o">=</span><span class="mi">15</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Magnetic axis&#39;</span><span class="p">)</span>

<span class="n">ax1</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;R (m)&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">12</span><span class="p">)</span>
<span class="n">ax1</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;Z (m)&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">12</span><span class="p">)</span>
<span class="n">ax1</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;Tokamak Magnetic Field |B|&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">14</span><span class="p">,</span> <span class="n">fontweight</span><span class="o">=</span><span class="s1">&#39;bold&#39;</span><span class="p">)</span>
<span class="n">ax1</span><span class="o">.</span><span class="n">set_aspect</span><span class="p">(</span><span class="s1">&#39;equal&#39;</span><span class="p">)</span>
<span class="n">ax1</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
<span class="n">ax1</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="kc">True</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.3</span><span class="p">)</span>

<span class="c1"># Field along midplane</span>
<span class="n">R_midplane</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mf">1.0</span><span class="p">,</span> <span class="mf">3.0</span><span class="p">,</span> <span class="mi">200</span><span class="p">)</span>
<span class="n">B_midplane</span> <span class="o">=</span> <span class="p">[</span><span class="n">tokamak_magnitude</span><span class="p">(</span><span class="n">R</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span> <span class="k">for</span> <span class="n">R</span> <span class="ow">in</span> <span class="n">R_midplane</span><span class="p">]</span>

<span class="n">ax2</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">R_midplane</span><span class="p">,</span> <span class="n">B_midplane</span><span class="p">,</span> <span class="s1">&#39;b-&#39;</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
<span class="n">ax2</span><span class="o">.</span><span class="n">axvline</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">R0</span><span class="o">-</span><span class="n">a</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;r&#39;</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;--&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Inboard edge&#39;</span><span class="p">)</span>
<span class="n">ax2</span><span class="o">.</span><span class="n">axvline</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">R0</span><span class="o">+</span><span class="n">a</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;r&#39;</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;--&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Outboard edge&#39;</span><span class="p">)</span>
<span class="n">ax2</span><span class="o">.</span><span class="n">axvline</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">R0</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;g&#39;</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;--&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Magnetic axis&#39;</span><span class="p">)</span>

<span class="n">ax2</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;R (m)&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">12</span><span class="p">)</span>
<span class="n">ax2</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;B (T)&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">12</span><span class="p">)</span>
<span class="n">ax2</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;Field Along Midplane (Z=0)&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">14</span><span class="p">,</span> <span class="n">fontweight</span><span class="o">=</span><span class="s1">&#39;bold&#39;</span><span class="p">)</span>
<span class="n">ax2</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
<span class="n">ax2</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="s1">&#39;tokamak_field.png&#39;</span><span class="p">,</span> <span class="n">dpi</span><span class="o">=</span><span class="mi">150</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Saved: tokamak_field.png&quot;</span><span class="p">)</span>

<span class="c1"># Calculate trapping fraction</span>
<span class="n">epsilon</span> <span class="o">=</span> <span class="n">a</span> <span class="o">/</span> <span class="n">R0</span>
<span class="n">f_trapped</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="n">epsilon</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Tokamak parameters:&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  Major radius R0 = </span><span class="si">{</span><span class="n">R0</span><span class="si">}</span><span class="s2"> m&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  Minor radius a = </span><span class="si">{</span><span class="n">a</span><span class="si">}</span><span class="s2"> m&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  Inverse aspect ratio ε = </span><span class="si">{</span><span class="n">epsilon</span><span class="si">:</span><span class="s2">.3f</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  Trapped fraction ≈ sqrt(2ε) = </span><span class="si">{</span><span class="n">f_trapped</span><span class="si">:</span><span class="s2">.3f</span><span class="si">}</span><span class="s2"> = </span><span class="si">{</span><span class="n">f_trapped</span><span class="o">*</span><span class="mi">100</span><span class="si">:</span><span class="s2">.1f</span><span class="si">}</span><span class="s2">%&quot;</span><span class="p">)</span>

<span class="c1"># Banana width estimate</span>
<span class="n">T_keV</span> <span class="o">=</span> <span class="mi">10</span>  <span class="c1"># keV</span>
<span class="n">T_J</span> <span class="o">=</span> <span class="n">T_keV</span> <span class="o">*</span> <span class="mf">1e3</span> <span class="o">*</span> <span class="n">q_p</span>
<span class="n">v_th_i</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="n">T_J</span> <span class="o">/</span> <span class="n">m_p</span><span class="p">)</span>
<span class="n">rho_i</span> <span class="o">=</span> <span class="n">m_p</span> <span class="o">*</span> <span class="n">v_th_i</span> <span class="o">/</span> <span class="p">(</span><span class="n">q_p</span> <span class="o">*</span> <span class="n">B0</span><span class="p">)</span>
<span class="n">q_safety</span> <span class="o">=</span> <span class="mf">2.0</span>
<span class="n">banana_width</span> <span class="o">=</span> <span class="n">q_safety</span> <span class="o">*</span> <span class="n">rho_i</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">epsilon</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Banana orbit:&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  Ion temperature T_i = </span><span class="si">{</span><span class="n">T_keV</span><span class="si">}</span><span class="s2"> keV&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  Thermal velocity v_th = </span><span class="si">{</span><span class="n">v_th_i</span><span class="si">:</span><span class="s2">.2e</span><span class="si">}</span><span class="s2"> m/s&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  Ion Larmor radius ρ_i = </span><span class="si">{</span><span class="n">rho_i</span><span class="o">*</span><span class="mf">1e3</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2"> mm&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  Banana width Δr_b ≈ </span><span class="si">{</span><span class="n">banana_width</span><span class="o">*</span><span class="mf">1e3</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2"> mm&quot;</span><span class="p">)</span>
</code></pre></div>

<h2 id="_2">요약<a class="header-link" href="#_2" title="Permanent link">&para;</a></h2>
<p>이 레슨에서, 우리는 자기 거울과 단열 불변량을 탐구했습니다:</p>
<ol>
<li>
<p><strong>자기 거울 힘</strong>: $F_\parallel = -\mu\nabla_\parallel B$는 입자를 고장 영역으로부터 반사시켜, 자기 보틀에서 구속을 가능하게 합니다.</p>
</li>
<li>
<p><strong>첫 번째 단열 불변량 μ</strong>: 자기 모멘트 $\mu = mv_\perp^2/(2B)$는 장이 자이로주기에 비해 천천히 변할 때 보존됩니다. 이것은 자이로궤도를 통과하는 자속의 보존에 해당합니다.</p>
</li>
<li>
<p><strong>손실 원뿔</strong>: 피치각 $\alpha < \alpha_c = \arcsin(1/\sqrt{R})$인 입자는 거울 목을 통해 탈출합니다. 큰 $R$에 대해 손실 원뿔에 있는 비율은 $\sim 1/(4R)$입니다.</p>
</li>
<li>
<p><strong>바운스 운동</strong>: 포획된 입자는 주파수 $\omega_b \sim v_\parallel/L$로 거울점 사이를 진동하며, 자이로주파수보다 훨씬 느립니다.</p>
</li>
<li>
<p><strong>불변량의 계층</strong>:</p>
</li>
<li>$\mu$: 자이로운동 (가장 빠름)</li>
<li>$J = \oint mv_\parallel ds$: 바운스 (중간)</li>
<li>
<p>$\Phi = \oint \mathbf{A}\cdot d\mathbf{l}$: 드리프트 (가장 느림)</p>
</li>
<li>
<p><strong>토카막 궤도</strong>: $1/R$ 변화는 포획된 (바나나) 입자와 통과 입자를 만듭니다. 포획된 비율 $\sim\sqrt{\epsilon}$, 여기서 $\epsilon = a/R_0$.</p>
</li>
<li>
<p><strong>Van Allen 복사대</strong>: 지구의 쌍극자 장은 자연 자기 보틀을 형성하여, 우주로부터 전하를 띤 입자를 포획합니다.</p>
</li>
</ol>
<p>단열 불변량을 이해하는 것은 다음에 중요합니다:
- 자기 구속 장치 설계
- 입자 수송 예측
- 우주 플라즈마 동역학 분석</p>
<h2 id="_3">연습 문제<a class="header-link" href="#_3" title="Permanent link">&para;</a></h2>
<h3 id="1_1">문제 1: 거울 구속 시간<a class="header-link" href="#1_1" title="Permanent link">&para;</a></h3>
<p>단순 자기 거울이 $B_{\text{min}} = 0.2$ T, $B_{\text{max}} = 1.0$ T, 길이 $L = 5$ m를 가집니다. 플라즈마 밀도는 $n = 10^{18}$ m$^{-3}$이고 온도는 $T = 100$ eV입니다. 충돌 주파수는 $\nu_c = 10^4$ s$^{-1}$입니다.</p>
<p>(a) 거울 비율 $R$과 손실 원뿔 각도 $\alpha_c$를 계산하세요.</p>
<p>(b) 손실 원뿔에 있는 입자의 비율을 추정하세요 (등방성 분포 가정).</p>
<p>(c) 구속 시간 $\tau_{\text{conf}} \sim (R/\nu_c)(1/f_{\text{loss}})$를 계산하세요.</p>
<p>(d) 충돌 시간 $\tau_c = 1/\nu_c$와 비교하세요. 이것이 잘 구속된 플라즈마인가요?</p>
<hr />
<h3 id="2_1">문제 2: 천천히 변하는 장에서 μ의 보존<a class="header-link" href="#2_1" title="Permanent link">&para;</a></h3>
<p>초기 에너지 $W = 1$ keV이고 피치각 $\alpha_0 = 45°$인 양성자가 거리 $L = 10$ m에 걸쳐 $B_0 = 0.1$ T에서 $B_1 = 0.5$ T로 증가하는 자기장에서 움직입니다.</p>
<p>(a) 초기 자기 모멘트 $\mu$를 계산하세요.</p>
<p>(b) $\mu$가 보존된다고 가정하고, 최종 수직 및 평행 속도를 구하세요.</p>
<p>(c) 최종 피치각 $\alpha_1$은 무엇인가요?</p>
<p>(d) 총 에너지가 보존됨을 확인하세요.</p>
<p>(e) 단열 조건을 확인하세요: $r_L |\nabla B|/B \ll 1$인가요?</p>
<hr />
<h3 id="3_1">문제 3: 포물선 거울에서의 바운스 주파수<a class="header-link" href="#3_1" title="Permanent link">&para;</a></h3>
<p>$B(z) = B_0(1 + z^2/L^2)$인 포물선 거울에서, 여기서 $B_0 = 0.5$ T이고 $L = 10$ m, 중수소 핵이 중앙면($z = 0$)에서 에너지 $W = 10$ keV이고 피치각 $\alpha_0 = 60°$를 가집니다.</p>
<p>(a) $v_\parallel = 0$인 거울점 $z_{\text{mirror}}$를 구하세요.</p>
<p>(b) $\tau_b \approx 4z_{\text{mirror}}/\langle v_\parallel\rangle$를 사용하여 바운스 주기 $\tau_b$를 추정하세요, 여기서 $\langle v_\parallel\rangle$는 평균 평행 속도입니다.</p>
<p>(c) 바운스 주파수 $\omega_b = 2\pi/\tau_b$를 계산하세요.</p>
<p>(d) 중앙면에서 자이로주파수 $\omega_c$와 비교하세요. $\omega_c \gg \omega_b$임을 확인하세요.</p>
<p><strong>힌트</strong>: 에너지 보존 사용: $\frac{1}{2}mv^2\sin^2\alpha_0 = \frac{1}{2}mv^2\frac{B(z_m)}{B_0}$.</p>
<hr />
<h3 id="4_1">문제 4: 토카막 바나나 폭<a class="header-link" href="#4_1" title="Permanent link">&para;</a></h3>
<p>$R_0 = 3$ m, $a = 1$ m, $B_0 = 5$ T이고 안전 인자 $q = 2$인 토카막에서, 온도 $T_i = 20$ keV인 중수소 이온에 대한 바나나 폭을 계산하세요.</p>
<p>(a) 역 종횡비 $\epsilon = a/R_0$를 계산하세요.</p>
<p>(b) 이온 Larmor 반경 $\rho_i = m_i v_{th,i}/(eB_0)$를 계산하세요, 여기서 $v_{th,i} = \sqrt{2k_BT_i/m_i}$.</p>
<p>(c) 바나나 폭 $\Delta r_b \approx q\rho_i\sqrt{\epsilon}$를 추정하세요.</p>
<p>(d) 소반경의 어느 비율이 바나나 폭인가요? 이것이 구속에 중요한가요?</p>
<p>(e) 포획된 입자 비율 $f_{\text{trap}} \approx \sqrt{2\epsilon}$를 계산하세요.</p>
<hr />
<h3 id="5_1">문제 5: 쌍극자 장에서의 두 번째 단열 불변량<a class="header-link" href="#5_1" title="Permanent link">&para;</a></h3>
<p>전자가 $L = 4$ 지구 반경 ($L$은 $R_E = 6.37\times 10^6$ m 단위의 적도 교차 거리)에서 쌍극자 자기력선에 포획되어 있습니다. 이 선의 자기장은 다음과 같이 변합니다:</p>
<p>$$
B(s) = B_{\text{eq}}\sqrt{1 + 3\sin^2\lambda}/\cos^6\lambda
$$</p>
<p>여기서 $\lambda$는 자기 위도이고 $B_{\text{eq}} = 10^{-6}$ T는 적도 장입니다.</p>
<p>(a) 전자가 에너지 $W = 100$ keV이고 적도 피치각 $\alpha_{\text{eq}} = 45°$를 가집니다. 입자가 반사되는 거울 위도 $\lambda_m$을 구하세요.</p>
<p>(b) 적도에서 거울점까지의 호장 $s_m$을 추정하세요 (작은 $\lambda$에 대해 $s \approx LR_E\lambda$ 사용).</p>
<p>(c) 두 번째 불변량 $J = \oint mv_\parallel ds \approx 4m\langle v_\parallel\rangle s_m$ (근사)를 계산하세요.</p>
<p>(d) 장이 천천히 감소하면 (예: 지자기 폭풍 동안), $J$는 일정하게 유지됩니다. 거울 위도가 어떻게 변하는지 정성적으로 설명하세요.</p>
<p><strong>힌트</strong>: $\lambda_m$에 대해, $\sin^2\alpha_{\text{eq}} = B_{\text{eq}}/B(\lambda_m)$를 사용하세요.</p>
<hr />
<h2 id="_4">내비게이션<a class="header-link" href="#_4" title="Permanent link">&para;</a></h2>
<ul>
<li><strong>이전</strong>: <a href="./05_Single_Particle_Motion_II.md">단일 입자 운동 II</a></li>
<li><strong>다음</strong>: <a href="./07_Vlasov_Equation.md">Vlasov 방정식</a></li>
</ul>
    </div>

    
<div class="lesson-toolbar lesson-toolbar--bottom">
    <div class="toolbar-nav toolbar-nav--prev">
        
        <a href="/study/ko/Plasma_Physics/05_Single_Particle_Motion_II.html" class="nav-prev">
            <span class="nav-label">Previous</span>
            <span class="nav-title">5. 단일 입자 운동 II</span>
        </a>
        
    </div>
    <div class="toolbar-actions">
        <button class="btn btn-copy-link" data-action="copy-link" title="Copy link">
            <span class="icon">🔗</span>
            <span class="text">Copy link</span>
        </button>
        <a href="/study/ko/Plasma_Physics/" class="btn btn-topic-link" title="Back to topic list">
            <span class="icon">📋</span>
            <span class="text">Topic list</span>
        </a>
    </div>
    <div class="toolbar-nav toolbar-nav--next">
        
        <a href="/study/ko/Plasma_Physics/07_Vlasov_Equation.html" class="nav-next">
            <span class="nav-label">Next</span>
            <span class="nav-title">7. Vlasov 방정식</span>
        </a>
        
    </div>
</div>


    <div class="toolbar-keyboard-hint">
        <kbd>&larr;</kbd> <kbd>&rarr;</kbd> to navigate between lessons
    </div>
</article>

<!-- Scroll to top floating button -->
<button class="scroll-to-top" id="scroll-to-top" title="Scroll to top" aria-label="Scroll to top">↑</button>

            </div>
        </main>
    </div>

    <script src="/study/static/js/app.js"></script>
    <script>
        function switchLanguage(newLang) {
            const path = window.location.pathname;
            const base = '/study';
            const currentLang = 'ko';
            const newPath = path.replace(base + '/' + currentLang + '/', base + '/' + newLang + '/');
            window.location.href = newPath + window.location.search;
        }
    </script>
    
<script>
    document.addEventListener('DOMContentLoaded', function() {
        // Copy link - independent feedback per button
        document.querySelectorAll('[data-action="copy-link"]').forEach(function(btn) {
            btn.addEventListener('click', function() {
                navigator.clipboard.writeText(window.location.href);
                var textEl = this.querySelector('.text');
                var originalText = textEl.textContent;
                textEl.textContent = 'Copied!';
                setTimeout(function() { textEl.textContent = originalText; }, 2000);
            });
        });

        // Add copy buttons to code blocks
        document.querySelectorAll('.lesson-content pre').forEach(function(pre) {
            var copyBtn = document.createElement('button');
            copyBtn.className = 'code-copy-btn';
            copyBtn.textContent = 'Copy';
            copyBtn.addEventListener('click', function() {
                var code = pre.querySelector('code');
                var text = code ? code.textContent : pre.textContent;
                navigator.clipboard.writeText(text);
                copyBtn.textContent = 'Copied!';
                setTimeout(function() { copyBtn.textContent = 'Copy'; }, 2000);
            });
            pre.style.position = 'relative';
            pre.appendChild(copyBtn);
        });

        // Scroll to top button
        var scrollBtn = document.getElementById('scroll-to-top');
        window.addEventListener('scroll', function() {
            scrollBtn.classList.toggle('visible', window.scrollY > 300);
        });
        scrollBtn.addEventListener('click', function() {
            window.scrollTo({ top: 0, behavior: 'smooth' });
        });

        // Keyboard shortcuts: left/right arrows for lesson navigation
        document.addEventListener('keydown', function(e) {
            var tag = document.activeElement.tagName;
            if (tag === 'INPUT' || tag === 'TEXTAREA' || tag === 'SELECT') return;

            if (e.key === 'ArrowLeft') {
                var prevLink = document.querySelector('.nav-prev');
                if (prevLink) prevLink.click();
            } else if (e.key === 'ArrowRight') {
                var nextLink = document.querySelector('.nav-next');
                if (nextLink) nextLink.click();
            }
        });
    });
</script>

</body>
</html>
{% endraw %}