{% raw %}
<!DOCTYPE html>
<html lang="ko" data-theme="light">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>14. Soft Actor-Critic (SAC) - Study Materials</title>
    <link rel="stylesheet" href="/study/static/css/style.css">
    <link rel="stylesheet" href="/study/static/css/highlight.css">
    <!-- KaTeX for LaTeX math rendering -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.16.11/dist/katex.min.css">
    <script defer src="https://cdn.jsdelivr.net/npm/katex@0.16.11/dist/katex.min.js"></script>
    <script defer src="https://cdn.jsdelivr.net/npm/katex@0.16.11/dist/contrib/auto-render.min.js"
        onload="renderMathInElement(document.body, {
            delimiters: [
                {left: '$$', right: '$$', display: true},
                {left: '$', right: '$', display: false}
            ],
            throwOnError: false
        });"></script>
    
</head>
<body>
    <div class="app-container">
        <!-- Sidebar -->
        <aside class="sidebar" id="sidebar">
            <div class="sidebar-header">
                <a href="/study/ko/" class="logo">Study Materials</a>
                <button class="sidebar-toggle" id="sidebar-toggle" aria-label="Toggle sidebar">
                    <span></span>
                </button>
            </div>

            <nav class="sidebar-nav">
                <a href="/study/ko/" class="nav-item ">
                    <span class="nav-icon">ğŸ </span>
                    <span class="nav-text">Home</span>
                </a>
                <a href="/study/examples/" class="nav-item ">
                    <span class="nav-icon">ğŸ’»</span>
                    <span class="nav-text">Examples</span>
                </a>
            </nav>

            <div class="sidebar-search">
                <form action="/study/ko/search.html" method="get" id="search-form">
                    <input type="search" name="q" placeholder="Search..." id="search-sidebar-input">
                </form>
            </div>

            <!-- Language Selector -->
            <div class="sidebar-lang">
                <select id="lang-select" class="lang-selector" onchange="switchLanguage(this.value)">
                    
                    <option value="en" >
                        English
                    </option>
                    
                    <option value="ko" selected>
                        í•œêµ­ì–´
                    </option>
                    
                </select>
            </div>

            <div class="sidebar-footer">
                <button class="theme-toggle" id="theme-toggle" aria-label="Toggle theme">
                    <span class="theme-icon light">â˜€ï¸</span>
                    <span class="theme-icon dark">ğŸŒ™</span>
                </button>
            </div>
        </aside>

        <!-- Main Content -->
        <main class="main-content">
            <header class="main-header">
                <button class="menu-toggle" id="menu-toggle" aria-label="Open menu">
                    <span></span>
                </button>
                
<nav class="breadcrumb">
    <a href="/study/ko/">Topics</a>
    <span class="separator">/</span>
    <a href="/study/ko/Reinforcement_Learning/">Reinforcement Learning</a>
    <span class="separator">/</span>
    <span class="current">14. Soft Actor-Critic (SAC)</span>
</nav>

            </header>

            <div class="content">
                
<article class="lesson-article">
    <header class="lesson-header">
        <h1>14. Soft Actor-Critic (SAC)</h1>
    </header>

    
<div class="lesson-toolbar lesson-toolbar--top">
    <div class="toolbar-nav toolbar-nav--prev">
        
        <a href="/study/ko/Reinforcement_Learning/13_Model_Based_RL.html" class="nav-prev">
            <span class="nav-label">Previous</span>
            <span class="nav-title">13. ëª¨ë¸ ê¸°ë°˜ ê°•í™”í•™ìŠµ(Model-Based Reinforcement Learning)</span>
        </a>
        
    </div>
    <div class="toolbar-actions">
        <button class="btn btn-copy-link" data-action="copy-link" title="Copy link">
            <span class="icon">ğŸ”—</span>
            <span class="text">Copy link</span>
        </button>
        <a href="/study/ko/Reinforcement_Learning/" class="btn btn-topic-link" title="Back to topic list">
            <span class="icon">ğŸ“‹</span>
            <span class="text">Topic list</span>
        </a>
    </div>
    <div class="toolbar-nav toolbar-nav--next">
        
    </div>
</div>


    
    <nav class="toc" id="toc">
        <h2>Table of Contents</h2>
        <div class="toc">
<ul>
<li><a href="#_1">í•™ìŠµ ëª©í‘œ</a></li>
<li><a href="#_2">ëª©ì°¨</a></li>
<li><a href="#1">1. ìµœëŒ€ ì—”íŠ¸ë¡œí”¼ ê°•í™”í•™ìŠµ</a><ul>
<li><a href="#11-vs">1.1 í‘œì¤€ ê°•í™”í•™ìŠµ vs ìµœëŒ€ ì—”íŠ¸ë¡œí”¼ ê°•í™”í•™ìŠµ</a></li>
<li><a href="#12-soft-bellman-equation">1.2 ì†Œí”„íŠ¸ ë²¨ë§Œ ë°©ì •ì‹(Soft Bellman Equation)</a></li>
</ul>
</li>
<li><a href="#2-sac">2. SAC ì•Œê³ ë¦¬ì¦˜</a><ul>
<li><a href="#21-sac">2.1 SAC êµ¬ì„± ìš”ì†Œ</a></li>
<li><a href="#22-sac">2.2 SAC ì—…ë°ì´íŠ¸ ê·œì¹™</a></li>
</ul>
</li>
<li><a href="#3-sac">3. SAC êµ¬í˜„</a><ul>
<li><a href="#31-squashed-gaussian-policy">3.1 ì•¡í„° ë„¤íŠ¸ì›Œí¬(Squashed Gaussian Policy)</a></li>
<li><a href="#32">3.2 í¬ë¦¬í‹± ë„¤íŠ¸ì›Œí¬</a></li>
<li><a href="#33-sac">3.3 SAC ì—ì´ì „íŠ¸</a></li>
<li><a href="#34">3.4 ë¦¬í”Œë ˆì´ ë²„í¼</a></li>
<li><a href="#35">3.5 í•™ìŠµ ë£¨í”„</a></li>
</ul>
</li>
<li><a href="#4">4. ìë™ ì˜¨ë„ íŠœë‹</a><ul>
<li><a href="#41">4.1 ìë™ íŠœë‹ì˜ ì¤‘ìš”ì„±</a></li>
<li><a href="#42">4.2 ì˜¨ë„ ì†ì‹¤ í•¨ìˆ˜</a></li>
</ul>
</li>
<li><a href="#5-sac-vs">5. SAC vs ë‹¤ë¥¸ ì•Œê³ ë¦¬ì¦˜</a><ul>
<li><a href="#51">5.1 ë¹„êµ í‘œ</a></li>
<li><a href="#52-sac">5.2 SAC ì‚¬ìš© ì‹œê¸°</a></li>
</ul>
</li>
<li><a href="#6">6. ì‹¤ìš©ì  íŒ</a><ul>
<li><a href="#61">6.1 í•˜ì´í¼íŒŒë¼ë¯¸í„°</a></li>
<li><a href="#62">6.2 ì¼ë°˜ì ì¸ ë¬¸ì œì™€ í•´ê²° ë°©ë²•</a></li>
</ul>
</li>
<li><a href="#7">7. ì—°ìŠµ ë¬¸ì œ</a><ul>
<li><a href="#1-pendulum-sac">ì—°ìŠµ 1: Pendulumì—ì„œ SAC</a></li>
<li><a href="#2-sac-vs-ppo">ì—°ìŠµ 2: SAC vs PPO ë¹„êµ</a></li>
<li><a href="#3-ablation-study">ì—°ìŠµ 3: ì ˆì œ ì—°êµ¬(Ablation Study)</a></li>
<li><a href="#4_1">ì—°ìŠµ 4: ì»¤ìŠ¤í…€ í™˜ê²½</a></li>
</ul>
</li>
<li><a href="#_3">ìš”ì•½</a></li>
<li><a href="#_4">ì°¸ê³  ë¬¸í—Œ</a></li>
</ul>
</div>

    </nav>
    

    <div class="lesson-content markdown-body">
        <h1 id="14-soft-actor-critic-sac">14. Soft Actor-Critic (SAC)<a class="header-link" href="#14-soft-actor-critic-sac" title="Permanent link">&para;</a></h1>
<p><strong>ë‚œì´ë„: â­â­â­â­ (ê³ ê¸‰)</strong></p>
<h2 id="_1">í•™ìŠµ ëª©í‘œ<a class="header-link" href="#_1" title="Permanent link">&para;</a></h2>
<ul>
<li>ìµœëŒ€ ì—”íŠ¸ë¡œí”¼ ê°•í™”í•™ìŠµ(maximum entropy reinforcement learning) ì´í•´</li>
<li>ì—°ì† í–‰ë™ ê³µê°„ì„ ìœ„í•œ SAC ì•Œê³ ë¦¬ì¦˜ êµ¬í˜„</li>
<li>ìë™ ì˜¨ë„(alpha) íŠœë‹ í•™ìŠµ</li>
<li>SACì™€ PPO, TD3 ë¹„êµ</li>
<li>ì‹¤ìš©ì ì¸ ì—°ì† ì œì–´ íƒœìŠ¤í¬ì— SAC ì ìš©</li>
</ul>
<hr />
<h2 id="_2">ëª©ì°¨<a class="header-link" href="#_2" title="Permanent link">&para;</a></h2>
<ol>
<li><a href="#1-ìµœëŒ€-ì—”íŠ¸ë¡œí”¼-ê°•í™”í•™ìŠµ">ìµœëŒ€ ì—”íŠ¸ë¡œí”¼ ê°•í™”í•™ìŠµ</a></li>
<li><a href="#2-sac-ì•Œê³ ë¦¬ì¦˜">SAC ì•Œê³ ë¦¬ì¦˜</a></li>
<li><a href="#3-sac-êµ¬í˜„">SAC êµ¬í˜„</a></li>
<li><a href="#4-ìë™-ì˜¨ë„-íŠœë‹">ìë™ ì˜¨ë„ íŠœë‹</a></li>
<li><a href="#5-sac-vs-ë‹¤ë¥¸-ì•Œê³ ë¦¬ì¦˜">SAC vs ë‹¤ë¥¸ ì•Œê³ ë¦¬ì¦˜</a></li>
<li><a href="#6-ì‹¤ìš©ì -íŒ">ì‹¤ìš©ì  íŒ</a></li>
<li><a href="#7-ì—°ìŠµ-ë¬¸ì œ">ì—°ìŠµ ë¬¸ì œ</a></li>
</ol>
<hr />
<h2 id="1">1. ìµœëŒ€ ì—”íŠ¸ë¡œí”¼ ê°•í™”í•™ìŠµ<a class="header-link" href="#1" title="Permanent link">&para;</a></h2>
<h3 id="11-vs">1.1 í‘œì¤€ ê°•í™”í•™ìŠµ vs ìµœëŒ€ ì—”íŠ¸ë¡œí”¼ ê°•í™”í•™ìŠµ<a class="header-link" href="#11-vs" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code>â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              Maximum Entropy Framework                            â”‚
â”‚                                                                 â”‚
â”‚  Standard RL objective:                                         â”‚
â”‚  Ï€* = argmax_Ï€  E [ Î£ Î³^t r_t ]                               â”‚
â”‚                  â†’ maximize expected return only                 â”‚
â”‚                                                                 â”‚
â”‚  Maximum Entropy RL objective:                                  â”‚
â”‚  Ï€* = argmax_Ï€  E [ Î£ Î³^t (r_t + Î± H(Ï€(Â·|s_t))) ]            â”‚
â”‚                  â†’ maximize return + policy entropy             â”‚
â”‚                                                                 â”‚
â”‚  Where:                                                         â”‚
â”‚  â€¢ H(Ï€(Â·|s)) = -E[log Ï€(a|s)] is the policy entropy           â”‚
â”‚  â€¢ Î± (temperature) controls exploration-exploitation balance    â”‚
â”‚                                                                 â”‚
â”‚  Benefits of maximum entropy:                                   â”‚
â”‚  1. Encourages exploration (higher entropy = more random)       â”‚
â”‚  2. Captures multiple modes (doesn&#39;t collapse to one solution)  â”‚
â”‚  3. More robust to perturbations                                â”‚
â”‚  4. Better transfer and fine-tuning                             â”‚
â”‚                                                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
</code></pre></div>

<h3 id="12-soft-bellman-equation">1.2 ì†Œí”„íŠ¸ ë²¨ë§Œ ë°©ì •ì‹(Soft Bellman Equation)<a class="header-link" href="#12-soft-bellman-equation" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code>â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              Soft Value Functions                                 â”‚
â”‚                                                                 â”‚
â”‚  Soft state value:                                              â”‚
â”‚  V(s) = E_a~Ï€ [ Q(s,a) - Î± log Ï€(a|s) ]                      â”‚
â”‚                                                                 â”‚
â”‚  Soft Q-value (Bellman equation):                               â”‚
â”‚  Q(s,a) = r(s,a) + Î³ E_s&#39; [ V(s&#39;) ]                          â”‚
â”‚         = r(s,a) + Î³ E_s&#39; [ E_a&#39;~Ï€ [ Q(s&#39;,a&#39;) - Î± log Ï€(a&#39;|s&#39;) ] ]
â”‚                                                                 â”‚
â”‚  Soft policy improvement:                                       â”‚
â”‚  Ï€_new = argmin_Ï€  D_KL( Ï€(Â·|s) || exp(Q(s,Â·)/Î±) / Z(s) )   â”‚
â”‚                                                                 â”‚
â”‚  In practice: Ï€ outputs mean and std of Gaussian               â”‚
â”‚  a ~ tanh(Î¼ + Ïƒ Â· Îµ),  Îµ ~ N(0, I)                            â”‚
â”‚                                                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
</code></pre></div>

<hr />
<h2 id="2-sac">2. SAC ì•Œê³ ë¦¬ì¦˜<a class="header-link" href="#2-sac" title="Permanent link">&para;</a></h2>
<h3 id="21-sac">2.1 SAC êµ¬ì„± ìš”ì†Œ<a class="header-link" href="#21-sac" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code>â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              SAC Architecture                                    â”‚
â”‚                                                                 â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”           â”‚
â”‚  â”‚                  Actor (Policy)                    â”‚           â”‚
â”‚  â”‚  Ï€_Ï†(a|s): Squashed Gaussian                     â”‚           â”‚
â”‚  â”‚  Input: state s                                   â”‚           â”‚
â”‚  â”‚  Output: Î¼(s), Ïƒ(s) â†’ a = tanh(Î¼ + ÏƒÂ·Îµ)         â”‚           â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜           â”‚
â”‚                                                                 â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”           â”‚
â”‚  â”‚              Twin Critics (Q1, Q2)                 â”‚           â”‚
â”‚  â”‚  Q_Î¸1(s, a), Q_Î¸2(s, a)                          â”‚           â”‚
â”‚  â”‚  Input: state s, action a                         â”‚           â”‚
â”‚  â”‚  Output: Q-value                                  â”‚           â”‚
â”‚  â”‚  â†’ Use min(Q1, Q2) to prevent overestimation     â”‚           â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜           â”‚
â”‚                                                                 â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”           â”‚
â”‚  â”‚              Target Networks (Q1&#39;, Q2&#39;)            â”‚           â”‚
â”‚  â”‚  Soft update: Î¸&#39; â† Ï„Î¸ + (1-Ï„)Î¸&#39;                  â”‚           â”‚
â”‚  â”‚  Provides stable targets for critic training      â”‚           â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜           â”‚
â”‚                                                                 â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”           â”‚
â”‚  â”‚              Temperature (Î±)                       â”‚           â”‚
â”‚  â”‚  Controls entropy bonus                           â”‚           â”‚
â”‚  â”‚  Can be fixed or automatically tuned              â”‚           â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜           â”‚
â”‚                                                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
</code></pre></div>

<h3 id="22-sac">2.2 SAC ì—…ë°ì´íŠ¸ ê·œì¹™<a class="header-link" href="#22-sac" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code>â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              SAC Training Steps                                  â”‚
â”‚                                                                 â”‚
â”‚  For each gradient step:                                        â”‚
â”‚                                                                 â”‚
â”‚  1. Sample batch (s, a, r, s&#39;, done) from replay buffer         â”‚
â”‚                                                                 â”‚
â”‚  2. Compute target:                                             â”‚
â”‚     a&#39; ~ Ï€_Ï†(Â·|s&#39;)                                              â”‚
â”‚     y = r + Î³(1-done) Ã— [min(Q&#39;â‚(s&#39;,a&#39;), Q&#39;â‚‚(s&#39;,a&#39;))          â”‚
â”‚                           - Î± log Ï€_Ï†(a&#39;|s&#39;)]                   â”‚
â”‚                                                                 â”‚
â”‚  3. Update Critics (minimize MSE):                              â”‚
â”‚     L_Q = E[(Q_Î¸i(s,a) - y)Â²]  for i = 1, 2                  â”‚
â”‚                                                                 â”‚
â”‚  4. Update Actor (maximize):                                    â”‚
â”‚     Ã£ ~ Ï€_Ï†(Â·|s)  (reparameterization trick)                   â”‚
â”‚     L_Ï€ = E[Î± log Ï€_Ï†(Ã£|s) - min(Q_Î¸1(s,Ã£), Q_Î¸2(s,Ã£))]    â”‚
â”‚                                                                 â”‚
â”‚  5. Update Temperature (if auto-tuning):                        â”‚
â”‚     L_Î± = E[-Î± (log Ï€_Ï†(Ã£|s) + H_target)]                    â”‚
â”‚                                                                 â”‚
â”‚  6. Soft update target networks:                                â”‚
â”‚     Î¸&#39;i â† Ï„ Î¸i + (1-Ï„) Î¸&#39;i                                    â”‚
â”‚                                                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
</code></pre></div>

<hr />
<h2 id="3-sac">3. SAC êµ¬í˜„<a class="header-link" href="#3-sac" title="Permanent link">&para;</a></h2>
<h3 id="31-squashed-gaussian-policy">3.1 ì•¡í„° ë„¤íŠ¸ì›Œí¬(Squashed Gaussian Policy)<a class="header-link" href="#31-squashed-gaussian-policy" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><span class="kn">import</span><span class="w"> </span><span class="nn">torch</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">torch.nn</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">nn</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">torch.nn.functional</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">F</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">torch.distributions</span><span class="w"> </span><span class="kn">import</span> <span class="n">Normal</span>

<span class="n">LOG_STD_MIN</span> <span class="o">=</span> <span class="o">-</span><span class="mi">20</span>
<span class="n">LOG_STD_MAX</span> <span class="o">=</span> <span class="mi">2</span>

<span class="k">class</span><span class="w"> </span><span class="nc">GaussianActor</span><span class="p">(</span><span class="n">nn</span><span class="o">.</span><span class="n">Module</span><span class="p">):</span>
    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">state_dim</span><span class="p">,</span> <span class="n">action_dim</span><span class="p">,</span> <span class="n">hidden_dim</span><span class="o">=</span><span class="mi">256</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">net</span> <span class="o">=</span> <span class="n">nn</span><span class="o">.</span><span class="n">Sequential</span><span class="p">(</span>
            <span class="n">nn</span><span class="o">.</span><span class="n">Linear</span><span class="p">(</span><span class="n">state_dim</span><span class="p">,</span> <span class="n">hidden_dim</span><span class="p">),</span>
            <span class="n">nn</span><span class="o">.</span><span class="n">ReLU</span><span class="p">(),</span>
            <span class="n">nn</span><span class="o">.</span><span class="n">Linear</span><span class="p">(</span><span class="n">hidden_dim</span><span class="p">,</span> <span class="n">hidden_dim</span><span class="p">),</span>
            <span class="n">nn</span><span class="o">.</span><span class="n">ReLU</span><span class="p">(),</span>
        <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">mean_head</span> <span class="o">=</span> <span class="n">nn</span><span class="o">.</span><span class="n">Linear</span><span class="p">(</span><span class="n">hidden_dim</span><span class="p">,</span> <span class="n">action_dim</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">log_std_head</span> <span class="o">=</span> <span class="n">nn</span><span class="o">.</span><span class="n">Linear</span><span class="p">(</span><span class="n">hidden_dim</span><span class="p">,</span> <span class="n">action_dim</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">forward</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">state</span><span class="p">):</span>
        <span class="n">x</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">net</span><span class="p">(</span><span class="n">state</span><span class="p">)</span>
        <span class="n">mean</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">mean_head</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
        <span class="n">log_std</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">log_std_head</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
        <span class="n">log_std</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">clamp</span><span class="p">(</span><span class="n">log_std</span><span class="p">,</span> <span class="n">LOG_STD_MIN</span><span class="p">,</span> <span class="n">LOG_STD_MAX</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">mean</span><span class="p">,</span> <span class="n">log_std</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">sample</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">state</span><span class="p">):</span>
        <span class="n">mean</span><span class="p">,</span> <span class="n">log_std</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">forward</span><span class="p">(</span><span class="n">state</span><span class="p">)</span>
        <span class="n">std</span> <span class="o">=</span> <span class="n">log_std</span><span class="o">.</span><span class="n">exp</span><span class="p">()</span>
        <span class="n">normal</span> <span class="o">=</span> <span class="n">Normal</span><span class="p">(</span><span class="n">mean</span><span class="p">,</span> <span class="n">std</span><span class="p">)</span>

        <span class="c1"># Reparameterization trick: z = Î¼ + ÏƒÂ·Îµ</span>
        <span class="n">z</span> <span class="o">=</span> <span class="n">normal</span><span class="o">.</span><span class="n">rsample</span><span class="p">()</span>

        <span class="c1"># Squash through tanh</span>
        <span class="n">action</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">tanh</span><span class="p">(</span><span class="n">z</span><span class="p">)</span>

        <span class="c1"># Log probability with correction for tanh squashing</span>
        <span class="n">log_prob</span> <span class="o">=</span> <span class="n">normal</span><span class="o">.</span><span class="n">log_prob</span><span class="p">(</span><span class="n">z</span><span class="p">)</span> <span class="o">-</span> <span class="n">torch</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">action</span><span class="o">.</span><span class="n">pow</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span> <span class="o">+</span> <span class="mf">1e-6</span><span class="p">)</span>
        <span class="n">log_prob</span> <span class="o">=</span> <span class="n">log_prob</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">dim</span><span class="o">=-</span><span class="mi">1</span><span class="p">,</span> <span class="n">keepdim</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">action</span><span class="p">,</span> <span class="n">log_prob</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">deterministic_action</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">state</span><span class="p">):</span>
        <span class="n">mean</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">forward</span><span class="p">(</span><span class="n">state</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">torch</span><span class="o">.</span><span class="n">tanh</span><span class="p">(</span><span class="n">mean</span><span class="p">)</span>
</code></pre></div>

<h3 id="32">3.2 í¬ë¦¬í‹± ë„¤íŠ¸ì›Œí¬<a class="header-link" href="#32" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><span class="k">class</span><span class="w"> </span><span class="nc">TwinQCritic</span><span class="p">(</span><span class="n">nn</span><span class="o">.</span><span class="n">Module</span><span class="p">):</span>
    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">state_dim</span><span class="p">,</span> <span class="n">action_dim</span><span class="p">,</span> <span class="n">hidden_dim</span><span class="o">=</span><span class="mi">256</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">()</span>

        <span class="c1"># Q1 network</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">q1</span> <span class="o">=</span> <span class="n">nn</span><span class="o">.</span><span class="n">Sequential</span><span class="p">(</span>
            <span class="n">nn</span><span class="o">.</span><span class="n">Linear</span><span class="p">(</span><span class="n">state_dim</span> <span class="o">+</span> <span class="n">action_dim</span><span class="p">,</span> <span class="n">hidden_dim</span><span class="p">),</span>
            <span class="n">nn</span><span class="o">.</span><span class="n">ReLU</span><span class="p">(),</span>
            <span class="n">nn</span><span class="o">.</span><span class="n">Linear</span><span class="p">(</span><span class="n">hidden_dim</span><span class="p">,</span> <span class="n">hidden_dim</span><span class="p">),</span>
            <span class="n">nn</span><span class="o">.</span><span class="n">ReLU</span><span class="p">(),</span>
            <span class="n">nn</span><span class="o">.</span><span class="n">Linear</span><span class="p">(</span><span class="n">hidden_dim</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
        <span class="p">)</span>

        <span class="c1"># Q2 network</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">q2</span> <span class="o">=</span> <span class="n">nn</span><span class="o">.</span><span class="n">Sequential</span><span class="p">(</span>
            <span class="n">nn</span><span class="o">.</span><span class="n">Linear</span><span class="p">(</span><span class="n">state_dim</span> <span class="o">+</span> <span class="n">action_dim</span><span class="p">,</span> <span class="n">hidden_dim</span><span class="p">),</span>
            <span class="n">nn</span><span class="o">.</span><span class="n">ReLU</span><span class="p">(),</span>
            <span class="n">nn</span><span class="o">.</span><span class="n">Linear</span><span class="p">(</span><span class="n">hidden_dim</span><span class="p">,</span> <span class="n">hidden_dim</span><span class="p">),</span>
            <span class="n">nn</span><span class="o">.</span><span class="n">ReLU</span><span class="p">(),</span>
            <span class="n">nn</span><span class="o">.</span><span class="n">Linear</span><span class="p">(</span><span class="n">hidden_dim</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
        <span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">forward</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">state</span><span class="p">,</span> <span class="n">action</span><span class="p">):</span>
        <span class="n">x</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">cat</span><span class="p">([</span><span class="n">state</span><span class="p">,</span> <span class="n">action</span><span class="p">],</span> <span class="n">dim</span><span class="o">=-</span><span class="mi">1</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">q1</span><span class="p">(</span><span class="n">x</span><span class="p">),</span> <span class="bp">self</span><span class="o">.</span><span class="n">q2</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">q1_forward</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">state</span><span class="p">,</span> <span class="n">action</span><span class="p">):</span>
        <span class="n">x</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">cat</span><span class="p">([</span><span class="n">state</span><span class="p">,</span> <span class="n">action</span><span class="p">],</span> <span class="n">dim</span><span class="o">=-</span><span class="mi">1</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">q1</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
</code></pre></div>

<h3 id="33-sac">3.3 SAC ì—ì´ì „íŠ¸<a class="header-link" href="#33-sac" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><span class="kn">import</span><span class="w"> </span><span class="nn">copy</span>

<span class="k">class</span><span class="w"> </span><span class="nc">SACAgent</span><span class="p">:</span>
    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">state_dim</span><span class="p">,</span> <span class="n">action_dim</span><span class="p">,</span> <span class="n">hidden_dim</span><span class="o">=</span><span class="mi">256</span><span class="p">,</span>
                 <span class="n">lr</span><span class="o">=</span><span class="mf">3e-4</span><span class="p">,</span> <span class="n">gamma</span><span class="o">=</span><span class="mf">0.99</span><span class="p">,</span> <span class="n">tau</span><span class="o">=</span><span class="mf">0.005</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.2</span><span class="p">,</span>
                 <span class="n">auto_alpha</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">target_entropy</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">gamma</span> <span class="o">=</span> <span class="n">gamma</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">tau</span> <span class="o">=</span> <span class="n">tau</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">auto_alpha</span> <span class="o">=</span> <span class="n">auto_alpha</span>

        <span class="c1"># Networks</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">actor</span> <span class="o">=</span> <span class="n">GaussianActor</span><span class="p">(</span><span class="n">state_dim</span><span class="p">,</span> <span class="n">action_dim</span><span class="p">,</span> <span class="n">hidden_dim</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">critic</span> <span class="o">=</span> <span class="n">TwinQCritic</span><span class="p">(</span><span class="n">state_dim</span><span class="p">,</span> <span class="n">action_dim</span><span class="p">,</span> <span class="n">hidden_dim</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">critic_target</span> <span class="o">=</span> <span class="n">copy</span><span class="o">.</span><span class="n">deepcopy</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">critic</span><span class="p">)</span>

        <span class="c1"># Freeze target parameters</span>
        <span class="k">for</span> <span class="n">param</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">critic_target</span><span class="o">.</span><span class="n">parameters</span><span class="p">():</span>
            <span class="n">param</span><span class="o">.</span><span class="n">requires_grad</span> <span class="o">=</span> <span class="kc">False</span>

        <span class="c1"># Optimizers</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">actor_optimizer</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">optim</span><span class="o">.</span><span class="n">Adam</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">actor</span><span class="o">.</span><span class="n">parameters</span><span class="p">(),</span> <span class="n">lr</span><span class="o">=</span><span class="n">lr</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">critic_optimizer</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">optim</span><span class="o">.</span><span class="n">Adam</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">critic</span><span class="o">.</span><span class="n">parameters</span><span class="p">(),</span> <span class="n">lr</span><span class="o">=</span><span class="n">lr</span><span class="p">)</span>

        <span class="c1"># Temperature (alpha)</span>
        <span class="k">if</span> <span class="n">auto_alpha</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">target_entropy</span> <span class="o">=</span> <span class="n">target_entropy</span> <span class="ow">or</span> <span class="o">-</span><span class="n">action_dim</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">log_alpha</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">requires_grad</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">alpha</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">log_alpha</span><span class="o">.</span><span class="n">exp</span><span class="p">()</span><span class="o">.</span><span class="n">item</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">alpha_optimizer</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">optim</span><span class="o">.</span><span class="n">Adam</span><span class="p">([</span><span class="bp">self</span><span class="o">.</span><span class="n">log_alpha</span><span class="p">],</span> <span class="n">lr</span><span class="o">=</span><span class="n">lr</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">alpha</span> <span class="o">=</span> <span class="n">alpha</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">select_action</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">state</span><span class="p">,</span> <span class="n">deterministic</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
        <span class="n">state</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">FloatTensor</span><span class="p">(</span><span class="n">state</span><span class="p">)</span><span class="o">.</span><span class="n">unsqueeze</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
        <span class="k">with</span> <span class="n">torch</span><span class="o">.</span><span class="n">no_grad</span><span class="p">():</span>
            <span class="k">if</span> <span class="n">deterministic</span><span class="p">:</span>
                <span class="n">action</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">actor</span><span class="o">.</span><span class="n">deterministic_action</span><span class="p">(</span><span class="n">state</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">action</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">actor</span><span class="o">.</span><span class="n">sample</span><span class="p">(</span><span class="n">state</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">action</span><span class="o">.</span><span class="n">squeeze</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">numpy</span><span class="p">()</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">update</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">batch</span><span class="p">):</span>
        <span class="n">states</span><span class="p">,</span> <span class="n">actions</span><span class="p">,</span> <span class="n">rewards</span><span class="p">,</span> <span class="n">next_states</span><span class="p">,</span> <span class="n">dones</span> <span class="o">=</span> <span class="n">batch</span>

        <span class="c1"># --- Update Critics ---</span>
        <span class="k">with</span> <span class="n">torch</span><span class="o">.</span><span class="n">no_grad</span><span class="p">():</span>
            <span class="n">next_actions</span><span class="p">,</span> <span class="n">next_log_probs</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">actor</span><span class="o">.</span><span class="n">sample</span><span class="p">(</span><span class="n">next_states</span><span class="p">)</span>
            <span class="n">q1_target</span><span class="p">,</span> <span class="n">q2_target</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">critic_target</span><span class="p">(</span><span class="n">next_states</span><span class="p">,</span> <span class="n">next_actions</span><span class="p">)</span>
            <span class="n">q_target</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">q1_target</span><span class="p">,</span> <span class="n">q2_target</span><span class="p">)</span>
            <span class="n">target</span> <span class="o">=</span> <span class="n">rewards</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">gamma</span> <span class="o">*</span> <span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">dones</span><span class="p">)</span> <span class="o">*</span> \
                     <span class="p">(</span><span class="n">q_target</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">alpha</span> <span class="o">*</span> <span class="n">next_log_probs</span><span class="p">)</span>

        <span class="n">q1</span><span class="p">,</span> <span class="n">q2</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">critic</span><span class="p">(</span><span class="n">states</span><span class="p">,</span> <span class="n">actions</span><span class="p">)</span>
        <span class="n">critic_loss</span> <span class="o">=</span> <span class="n">F</span><span class="o">.</span><span class="n">mse_loss</span><span class="p">(</span><span class="n">q1</span><span class="p">,</span> <span class="n">target</span><span class="p">)</span> <span class="o">+</span> <span class="n">F</span><span class="o">.</span><span class="n">mse_loss</span><span class="p">(</span><span class="n">q2</span><span class="p">,</span> <span class="n">target</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">critic_optimizer</span><span class="o">.</span><span class="n">zero_grad</span><span class="p">()</span>
        <span class="n">critic_loss</span><span class="o">.</span><span class="n">backward</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">critic_optimizer</span><span class="o">.</span><span class="n">step</span><span class="p">()</span>

        <span class="c1"># --- Update Actor ---</span>
        <span class="n">new_actions</span><span class="p">,</span> <span class="n">log_probs</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">actor</span><span class="o">.</span><span class="n">sample</span><span class="p">(</span><span class="n">states</span><span class="p">)</span>
        <span class="n">q1_new</span><span class="p">,</span> <span class="n">q2_new</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">critic</span><span class="p">(</span><span class="n">states</span><span class="p">,</span> <span class="n">new_actions</span><span class="p">)</span>
        <span class="n">q_new</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">q1_new</span><span class="p">,</span> <span class="n">q2_new</span><span class="p">)</span>

        <span class="n">actor_loss</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">alpha</span> <span class="o">*</span> <span class="n">log_probs</span> <span class="o">-</span> <span class="n">q_new</span><span class="p">)</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">actor_optimizer</span><span class="o">.</span><span class="n">zero_grad</span><span class="p">()</span>
        <span class="n">actor_loss</span><span class="o">.</span><span class="n">backward</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">actor_optimizer</span><span class="o">.</span><span class="n">step</span><span class="p">()</span>

        <span class="c1"># --- Update Temperature ---</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">auto_alpha</span><span class="p">:</span>
            <span class="n">alpha_loss</span> <span class="o">=</span> <span class="o">-</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">log_alpha</span> <span class="o">*</span> <span class="p">(</span><span class="n">log_probs</span><span class="o">.</span><span class="n">detach</span><span class="p">()</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">target_entropy</span><span class="p">))</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">alpha_optimizer</span><span class="o">.</span><span class="n">zero_grad</span><span class="p">()</span>
            <span class="n">alpha_loss</span><span class="o">.</span><span class="n">backward</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">alpha_optimizer</span><span class="o">.</span><span class="n">step</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">alpha</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">log_alpha</span><span class="o">.</span><span class="n">exp</span><span class="p">()</span><span class="o">.</span><span class="n">item</span><span class="p">()</span>

        <span class="c1"># --- Soft Update Target Networks ---</span>
        <span class="k">for</span> <span class="n">param</span><span class="p">,</span> <span class="n">target_param</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">critic</span><span class="o">.</span><span class="n">parameters</span><span class="p">(),</span> <span class="bp">self</span><span class="o">.</span><span class="n">critic_target</span><span class="o">.</span><span class="n">parameters</span><span class="p">()</span>
        <span class="p">):</span>
            <span class="n">target_param</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">copy_</span><span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">tau</span> <span class="o">*</span> <span class="n">param</span><span class="o">.</span><span class="n">data</span> <span class="o">+</span> <span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">tau</span><span class="p">)</span> <span class="o">*</span> <span class="n">target_param</span><span class="o">.</span><span class="n">data</span>
            <span class="p">)</span>

        <span class="k">return</span> <span class="p">{</span>
            <span class="s1">&#39;critic_loss&#39;</span><span class="p">:</span> <span class="n">critic_loss</span><span class="o">.</span><span class="n">item</span><span class="p">(),</span>
            <span class="s1">&#39;actor_loss&#39;</span><span class="p">:</span> <span class="n">actor_loss</span><span class="o">.</span><span class="n">item</span><span class="p">(),</span>
            <span class="s1">&#39;alpha&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">alpha</span><span class="p">,</span>
            <span class="s1">&#39;entropy&#39;</span><span class="p">:</span> <span class="o">-</span><span class="n">log_probs</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span><span class="o">.</span><span class="n">item</span><span class="p">()</span>
        <span class="p">}</span>
</code></pre></div>

<h3 id="34">3.4 ë¦¬í”Œë ˆì´ ë²„í¼<a class="header-link" href="#34" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><span class="kn">import</span><span class="w"> </span><span class="nn">numpy</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">np</span>

<span class="k">class</span><span class="w"> </span><span class="nc">ReplayBuffer</span><span class="p">:</span>
    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">state_dim</span><span class="p">,</span> <span class="n">action_dim</span><span class="p">,</span> <span class="n">capacity</span><span class="o">=</span><span class="mi">1_000_000</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">capacity</span> <span class="o">=</span> <span class="n">capacity</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">idx</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">size</span> <span class="o">=</span> <span class="mi">0</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">states</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">capacity</span><span class="p">,</span> <span class="n">state_dim</span><span class="p">),</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">float32</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">actions</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">capacity</span><span class="p">,</span> <span class="n">action_dim</span><span class="p">),</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">float32</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">rewards</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">capacity</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">float32</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">next_states</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">capacity</span><span class="p">,</span> <span class="n">state_dim</span><span class="p">),</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">float32</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">dones</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">capacity</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">float32</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">add</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">state</span><span class="p">,</span> <span class="n">action</span><span class="p">,</span> <span class="n">reward</span><span class="p">,</span> <span class="n">next_state</span><span class="p">,</span> <span class="n">done</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">states</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">idx</span><span class="p">]</span> <span class="o">=</span> <span class="n">state</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">actions</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">idx</span><span class="p">]</span> <span class="o">=</span> <span class="n">action</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">rewards</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">idx</span><span class="p">]</span> <span class="o">=</span> <span class="n">reward</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">next_states</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">idx</span><span class="p">]</span> <span class="o">=</span> <span class="n">next_state</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">dones</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">idx</span><span class="p">]</span> <span class="o">=</span> <span class="n">done</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">idx</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">idx</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">capacity</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">size</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">size</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">capacity</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">sample</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">batch_size</span><span class="p">):</span>
        <span class="n">idxs</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">randint</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">size</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="n">batch_size</span><span class="p">)</span>
        <span class="k">return</span> <span class="p">(</span>
            <span class="n">torch</span><span class="o">.</span><span class="n">FloatTensor</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">states</span><span class="p">[</span><span class="n">idxs</span><span class="p">]),</span>
            <span class="n">torch</span><span class="o">.</span><span class="n">FloatTensor</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">actions</span><span class="p">[</span><span class="n">idxs</span><span class="p">]),</span>
            <span class="n">torch</span><span class="o">.</span><span class="n">FloatTensor</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">rewards</span><span class="p">[</span><span class="n">idxs</span><span class="p">]),</span>
            <span class="n">torch</span><span class="o">.</span><span class="n">FloatTensor</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">next_states</span><span class="p">[</span><span class="n">idxs</span><span class="p">]),</span>
            <span class="n">torch</span><span class="o">.</span><span class="n">FloatTensor</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dones</span><span class="p">[</span><span class="n">idxs</span><span class="p">])</span>
        <span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__len__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">size</span>
</code></pre></div>

<h3 id="35">3.5 í•™ìŠµ ë£¨í”„<a class="header-link" href="#35" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><span class="kn">import</span><span class="w"> </span><span class="nn">gymnasium</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">gym</span>

<span class="k">def</span><span class="w"> </span><span class="nf">train_sac</span><span class="p">(</span><span class="n">env_name</span><span class="o">=</span><span class="s1">&#39;Pendulum-v1&#39;</span><span class="p">,</span> <span class="n">total_steps</span><span class="o">=</span><span class="mi">100_000</span><span class="p">,</span>
              <span class="n">batch_size</span><span class="o">=</span><span class="mi">256</span><span class="p">,</span> <span class="n">start_steps</span><span class="o">=</span><span class="mi">5000</span><span class="p">):</span>
    <span class="n">env</span> <span class="o">=</span> <span class="n">gym</span><span class="o">.</span><span class="n">make</span><span class="p">(</span><span class="n">env_name</span><span class="p">)</span>
    <span class="n">state_dim</span> <span class="o">=</span> <span class="n">env</span><span class="o">.</span><span class="n">observation_space</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    <span class="n">action_dim</span> <span class="o">=</span> <span class="n">env</span><span class="o">.</span><span class="n">action_space</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    <span class="n">action_scale</span> <span class="o">=</span> <span class="n">env</span><span class="o">.</span><span class="n">action_space</span><span class="o">.</span><span class="n">high</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>

    <span class="n">agent</span> <span class="o">=</span> <span class="n">SACAgent</span><span class="p">(</span><span class="n">state_dim</span><span class="p">,</span> <span class="n">action_dim</span><span class="p">)</span>
    <span class="n">buffer</span> <span class="o">=</span> <span class="n">ReplayBuffer</span><span class="p">(</span><span class="n">state_dim</span><span class="p">,</span> <span class="n">action_dim</span><span class="p">)</span>

    <span class="n">state</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">env</span><span class="o">.</span><span class="n">reset</span><span class="p">()</span>
    <span class="n">episode_reward</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="n">episode_rewards</span> <span class="o">=</span> <span class="p">[]</span>

    <span class="k">for</span> <span class="n">step</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">total_steps</span><span class="p">):</span>
        <span class="c1"># Random actions for initial exploration</span>
        <span class="k">if</span> <span class="n">step</span> <span class="o">&lt;</span> <span class="n">start_steps</span><span class="p">:</span>
            <span class="n">action</span> <span class="o">=</span> <span class="n">env</span><span class="o">.</span><span class="n">action_space</span><span class="o">.</span><span class="n">sample</span><span class="p">()</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">action</span> <span class="o">=</span> <span class="n">agent</span><span class="o">.</span><span class="n">select_action</span><span class="p">(</span><span class="n">state</span><span class="p">)</span> <span class="o">*</span> <span class="n">action_scale</span>

        <span class="n">next_state</span><span class="p">,</span> <span class="n">reward</span><span class="p">,</span> <span class="n">terminated</span><span class="p">,</span> <span class="n">truncated</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">env</span><span class="o">.</span><span class="n">step</span><span class="p">(</span><span class="n">action</span><span class="p">)</span>
        <span class="n">done</span> <span class="o">=</span> <span class="n">terminated</span> <span class="ow">or</span> <span class="n">truncated</span>
        <span class="n">buffer</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">state</span><span class="p">,</span> <span class="n">action</span> <span class="o">/</span> <span class="n">action_scale</span><span class="p">,</span> <span class="n">reward</span><span class="p">,</span> <span class="n">next_state</span><span class="p">,</span> <span class="nb">float</span><span class="p">(</span><span class="n">terminated</span><span class="p">))</span>

        <span class="n">state</span> <span class="o">=</span> <span class="n">next_state</span>
        <span class="n">episode_reward</span> <span class="o">+=</span> <span class="n">reward</span>

        <span class="k">if</span> <span class="n">done</span><span class="p">:</span>
            <span class="n">episode_rewards</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">episode_reward</span><span class="p">)</span>
            <span class="n">state</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">env</span><span class="o">.</span><span class="n">reset</span><span class="p">()</span>
            <span class="n">episode_reward</span> <span class="o">=</span> <span class="mi">0</span>

        <span class="c1"># Update after collecting enough data</span>
        <span class="k">if</span> <span class="n">step</span> <span class="o">&gt;=</span> <span class="n">start_steps</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="n">buffer</span><span class="p">)</span> <span class="o">&gt;=</span> <span class="n">batch_size</span><span class="p">:</span>
            <span class="n">batch</span> <span class="o">=</span> <span class="n">buffer</span><span class="o">.</span><span class="n">sample</span><span class="p">(</span><span class="n">batch_size</span><span class="p">)</span>
            <span class="n">metrics</span> <span class="o">=</span> <span class="n">agent</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">batch</span><span class="p">)</span>

            <span class="k">if</span> <span class="n">step</span> <span class="o">%</span> <span class="mi">1000</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">avg_reward</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">episode_rewards</span><span class="p">[</span><span class="o">-</span><span class="mi">10</span><span class="p">:])</span> <span class="k">if</span> <span class="n">episode_rewards</span> <span class="k">else</span> <span class="mi">0</span>
                <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Step </span><span class="si">{</span><span class="n">step</span><span class="si">}</span><span class="s2">: avg_reward=</span><span class="si">{</span><span class="n">avg_reward</span><span class="si">:</span><span class="s2">.1f</span><span class="si">}</span><span class="s2">, &quot;</span>
                      <span class="sa">f</span><span class="s2">&quot;alpha=</span><span class="si">{</span><span class="n">metrics</span><span class="p">[</span><span class="s1">&#39;alpha&#39;</span><span class="p">]</span><span class="si">:</span><span class="s2">.3f</span><span class="si">}</span><span class="s2">, &quot;</span>
                      <span class="sa">f</span><span class="s2">&quot;entropy=</span><span class="si">{</span><span class="n">metrics</span><span class="p">[</span><span class="s1">&#39;entropy&#39;</span><span class="p">]</span><span class="si">:</span><span class="s2">.3f</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">agent</span><span class="p">,</span> <span class="n">episode_rewards</span>
</code></pre></div>

<hr />
<h2 id="4">4. ìë™ ì˜¨ë„ íŠœë‹<a class="header-link" href="#4" title="Permanent link">&para;</a></h2>
<h3 id="41">4.1 ìë™ íŠœë‹ì˜ ì¤‘ìš”ì„±<a class="header-link" href="#41" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code>â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              Temperature (Î±) Effect                              â”‚
â”‚                                                                 â”‚
â”‚  Î± too high:                     Î± too low:                     â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”       â”‚
â”‚  â”‚ Entropy dominates    â”‚         â”‚ Return dominates     â”‚       â”‚
â”‚  â”‚ â†’ nearly random     â”‚         â”‚ â†’ premature          â”‚       â”‚
â”‚  â”‚ â†’ slow learning     â”‚         â”‚   convergence        â”‚       â”‚
â”‚  â”‚ â†’ poor performance  â”‚         â”‚ â†’ poor exploration   â”‚       â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜       â”‚
â”‚                                                                 â”‚
â”‚  Auto-tuning:                                                   â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”           â”‚
â”‚  â”‚ Constraint: H(Ï€(Â·|s)) â‰¥ H_target               â”‚           â”‚
â”‚  â”‚ If entropy &lt; target: increase Î± (explore more)   â”‚           â”‚
â”‚  â”‚ If entropy &gt; target: decrease Î± (exploit more)   â”‚           â”‚
â”‚  â”‚ H_target = -dim(A) (heuristic for continuous)    â”‚           â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜           â”‚
â”‚                                                                 â”‚
â”‚  Typical Î± trajectory during training:                          â”‚
â”‚  Î±                                                              â”‚
â”‚  â”‚                                                              â”‚
â”‚  â”‚  â•²                                                           â”‚
â”‚  â”‚   â•²                                                          â”‚
â”‚  â”‚    â•²___                                                      â”‚
â”‚  â”‚        â•²____                                                 â”‚
â”‚  â”‚             â•²_________                                       â”‚
â”‚  â”‚                       â”€â”€â”€â”€â”€                                  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¶ steps                        â”‚
â”‚  (starts high for exploration, decreases as policy converges)   â”‚
â”‚                                                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
</code></pre></div>

<h3 id="42">4.2 ì˜¨ë„ ì†ì‹¤ í•¨ìˆ˜<a class="header-link" href="#42" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><span class="c1"># Automatic temperature tuning objective</span>
<span class="c1"># L(Î±) = E_a~Ï€ [-Î± log Ï€(a|s) - Î± H_target]</span>
<span class="c1"># = E_a~Ï€ [-Î± (log Ï€(a|s) + H_target)]</span>

<span class="c1"># In the update step:</span>
<span class="n">alpha_loss</span> <span class="o">=</span> <span class="o">-</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">log_alpha</span> <span class="o">*</span> <span class="p">(</span><span class="n">log_probs</span><span class="o">.</span><span class="n">detach</span><span class="p">()</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">target_entropy</span><span class="p">))</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span>

<span class="c1"># Intuition:</span>
<span class="c1"># When entropy (-log_probs) &lt; H_target: log_probs + H_target &gt; 0</span>
<span class="c1"># â†’ gradient pushes log_alpha up â†’ Î± increases â†’ more entropy encouraged</span>
<span class="c1"># When entropy &gt; H_target: log_probs + H_target &lt; 0</span>
<span class="c1"># â†’ gradient pushes log_alpha down â†’ Î± decreases</span>
</code></pre></div>

<hr />
<h2 id="5-sac-vs">5. SAC vs ë‹¤ë¥¸ ì•Œê³ ë¦¬ì¦˜<a class="header-link" href="#5-sac-vs" title="Permanent link">&para;</a></h2>
<h3 id="51">5.1 ë¹„êµ í‘œ<a class="header-link" href="#51" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><span class="err">â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”</span>
<span class="err">â”‚</span><span class="w">               </span><span class="err">â”‚</span><span class="w"> </span><span class="nx">SAC</span><span class="w">      </span><span class="err">â”‚</span><span class="w"> </span><span class="nx">PPO</span><span class="w">      </span><span class="err">â”‚</span><span class="w"> </span><span class="nx">TD3</span><span class="w">      </span><span class="err">â”‚</span><span class="w"> </span><span class="nx">DDPG</span><span class="w">          </span><span class="err">â”‚</span>
<span class="err">â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤</span>
<span class="err">â”‚</span><span class="w"> </span><span class="nx">Policy</span><span class="w"> </span><span class="k">type</span><span class="w">   </span><span class="err">â”‚</span><span class="w"> </span><span class="nx">Stochas</span><span class="p">.</span><span class="w"> </span><span class="err">â”‚</span><span class="w"> </span><span class="nx">Stochas</span><span class="p">.</span><span class="w"> </span><span class="err">â”‚</span><span class="w"> </span><span class="nx">Determin</span><span class="p">.</span><span class="err">â”‚</span><span class="w"> </span><span class="nx">Deterministic</span><span class="w"> </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w"> </span><span class="nx">On</span><span class="o">/</span><span class="nx">Off</span><span class="w"> </span><span class="nx">policy</span><span class="w"> </span><span class="err">â”‚</span><span class="w"> </span><span class="nx">Off</span><span class="w">      </span><span class="err">â”‚</span><span class="w"> </span><span class="nx">On</span><span class="w">       </span><span class="err">â”‚</span><span class="w"> </span><span class="nx">Off</span><span class="w">      </span><span class="err">â”‚</span><span class="w"> </span><span class="nx">Off</span><span class="w">           </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w"> </span><span class="nx">Action</span><span class="w"> </span><span class="nx">space</span><span class="w">  </span><span class="err">â”‚</span><span class="w"> </span><span class="nx">Contin</span><span class="p">.</span><span class="w">  </span><span class="err">â”‚</span><span class="w"> </span><span class="nx">Both</span><span class="w">     </span><span class="err">â”‚</span><span class="w"> </span><span class="nx">Contin</span><span class="p">.</span><span class="w">  </span><span class="err">â”‚</span><span class="w"> </span><span class="nx">Continuous</span><span class="w">    </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w"> </span><span class="nx">Entropy</span><span class="w"> </span><span class="nx">reg</span><span class="p">.</span><span class="w">  </span><span class="err">â”‚</span><span class="w"> </span><span class="nx">Yes</span><span class="w">      </span><span class="err">â”‚</span><span class="w"> </span><span class="nx">Yes</span><span class="w">      </span><span class="err">â”‚</span><span class="w"> </span><span class="nx">No</span><span class="w">       </span><span class="err">â”‚</span><span class="w"> </span><span class="nx">No</span><span class="w">            </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w"> </span><span class="nx">Twin</span><span class="w"> </span><span class="nx">critics</span><span class="w">  </span><span class="err">â”‚</span><span class="w"> </span><span class="nx">Yes</span><span class="w">      </span><span class="err">â”‚</span><span class="w"> </span><span class="nx">No</span><span class="w">       </span><span class="err">â”‚</span><span class="w"> </span><span class="nx">Yes</span><span class="w">      </span><span class="err">â”‚</span><span class="w"> </span><span class="nx">No</span><span class="w">            </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w"> </span><span class="nx">Sample</span><span class="w"> </span><span class="nx">eff</span><span class="p">.</span><span class="w">   </span><span class="err">â”‚</span><span class="w"> </span><span class="nx">High</span><span class="w">     </span><span class="err">â”‚</span><span class="w"> </span><span class="nx">Low</span><span class="w">      </span><span class="err">â”‚</span><span class="w"> </span><span class="nx">High</span><span class="w">     </span><span class="err">â”‚</span><span class="w"> </span><span class="nx">Medium</span><span class="w">        </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w"> </span><span class="nx">Stability</span><span class="w">     </span><span class="err">â”‚</span><span class="w"> </span><span class="nx">High</span><span class="w">     </span><span class="err">â”‚</span><span class="w"> </span><span class="nx">High</span><span class="w">     </span><span class="err">â”‚</span><span class="w"> </span><span class="nx">Medium</span><span class="w">   </span><span class="err">â”‚</span><span class="w"> </span><span class="nx">Low</span><span class="w">           </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w"> </span><span class="nx">Hyperparams</span><span class="w">   </span><span class="err">â”‚</span><span class="w"> </span><span class="nx">Few</span><span class="w">      </span><span class="err">â”‚</span><span class="w"> </span><span class="nx">Many</span><span class="w">     </span><span class="err">â”‚</span><span class="w"> </span><span class="nx">Medium</span><span class="w">   </span><span class="err">â”‚</span><span class="w"> </span><span class="nx">Many</span><span class="w">          </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w"> </span><span class="nx">Auto</span><span class="o">-</span><span class="nx">tuning</span><span class="w">   </span><span class="err">â”‚</span><span class="w"> </span><span class="nx">Î±</span><span class="w"> </span><span class="nx">tuning</span><span class="w"> </span><span class="err">â”‚</span><span class="w"> </span><span class="nx">No</span><span class="w">       </span><span class="err">â”‚</span><span class="w"> </span><span class="nx">No</span><span class="w">       </span><span class="err">â”‚</span><span class="w"> </span><span class="nx">No</span><span class="w">            </span><span class="err">â”‚</span>
<span class="err">â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜</span>
</code></pre></div>

<h3 id="52-sac">5.2 SAC ì‚¬ìš© ì‹œê¸°<a class="header-link" href="#52-sac" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><span class="nx">Use</span><span class="w"> </span><span class="nx">SAC</span><span class="w"> </span><span class="nx">when</span><span class="p">:</span>
<span class="err">âœ“</span><span class="w"> </span><span class="nx">Continuous</span><span class="w"> </span><span class="nx">action</span><span class="w"> </span><span class="nx">spaces</span><span class="w"> </span><span class="p">(</span><span class="nx">robotics</span><span class="p">,</span><span class="w"> </span><span class="nx">control</span><span class="p">)</span>
<span class="err">âœ“</span><span class="w"> </span><span class="nx">Sample</span><span class="w"> </span><span class="nx">efficiency</span><span class="w"> </span><span class="nx">matters</span><span class="w"> </span><span class="p">(</span><span class="nx">real</span><span class="o">-</span><span class="nx">world</span><span class="p">,</span><span class="w"> </span><span class="nx">expensive</span><span class="w"> </span><span class="nx">simulation</span><span class="p">)</span>
<span class="err">âœ“</span><span class="w"> </span><span class="nx">You</span><span class="w"> </span><span class="nx">want</span><span class="w"> </span><span class="nx">stable</span><span class="w"> </span><span class="nx">training</span><span class="w"> </span><span class="nx">with</span><span class="w"> </span><span class="nx">minimal</span><span class="w"> </span><span class="nx">tuning</span>
<span class="err">âœ“</span><span class="w"> </span><span class="nx">Multi</span><span class="o">-</span><span class="nx">modal</span><span class="w"> </span><span class="nx">optimal</span><span class="w"> </span><span class="nx">policies</span><span class="w"> </span><span class="nx">exist</span>

<span class="nx">Use</span><span class="w"> </span><span class="nx">PPO</span><span class="w"> </span><span class="nx">instead</span><span class="w"> </span><span class="nx">when</span><span class="p">:</span>
<span class="err">âœ“</span><span class="w"> </span><span class="nx">Discrete</span><span class="w"> </span><span class="nx">action</span><span class="w"> </span><span class="nx">spaces</span>
<span class="err">âœ“</span><span class="w"> </span><span class="nx">On</span><span class="o">-</span><span class="nx">policy</span><span class="w"> </span><span class="nx">learning</span><span class="w"> </span><span class="k">is</span><span class="w"> </span><span class="nx">preferred</span>
<span class="err">âœ“</span><span class="w"> </span><span class="nx">Simulation</span><span class="w"> </span><span class="k">is</span><span class="w"> </span><span class="nx">cheap</span><span class="w"> </span><span class="p">(</span><span class="nx">can</span><span class="w"> </span><span class="nx">generate</span><span class="w"> </span><span class="nx">many</span><span class="w"> </span><span class="nx">samples</span><span class="p">)</span>
<span class="err">âœ“</span><span class="w"> </span><span class="nx">Distributed</span><span class="w"> </span><span class="nx">training</span><span class="w"> </span><span class="p">(</span><span class="nx">PPO</span><span class="w"> </span><span class="nx">scales</span><span class="w"> </span><span class="nx">better</span><span class="p">)</span>

<span class="nx">Use</span><span class="w"> </span><span class="nx">TD3</span><span class="w"> </span><span class="nx">instead</span><span class="w"> </span><span class="nx">when</span><span class="p">:</span>
<span class="err">âœ“</span><span class="w"> </span><span class="nx">Deterministic</span><span class="w"> </span><span class="nx">policy</span><span class="w"> </span><span class="k">is</span><span class="w"> </span><span class="nx">preferred</span>
<span class="err">âœ“</span><span class="w"> </span><span class="nx">Simpler</span><span class="w"> </span><span class="nx">implementation</span><span class="w"> </span><span class="nx">needed</span>
<span class="err">âœ“</span><span class="w"> </span><span class="nx">No</span><span class="w"> </span><span class="nx">entropy</span><span class="w"> </span><span class="nx">regularization</span><span class="w"> </span><span class="nx">wanted</span>
</code></pre></div>

<hr />
<h2 id="6">6. ì‹¤ìš©ì  íŒ<a class="header-link" href="#6" title="Permanent link">&para;</a></h2>
<h3 id="61">6.1 í•˜ì´í¼íŒŒë¼ë¯¸í„°<a class="header-link" href="#61" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code>â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚<span class="w"> </span><span class="nv">Hyperparameter</span><span class="w">         </span>â”‚<span class="w"> </span><span class="nv">Default</span><span class="w">      </span>â”‚<span class="w"> </span><span class="nv">Notes</span><span class="w">                    </span>â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚<span class="w"> </span><span class="nv">Learning</span><span class="w"> </span><span class="nv">rate</span><span class="w">          </span>â”‚<span class="w"> </span><span class="mi">3</span><span class="nv">e</span><span class="o">-</span><span class="mi">4</span><span class="w">         </span>â”‚<span class="w"> </span><span class="nv">Same</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="nv">actor</span><span class="w"> </span><span class="o">&amp;</span><span class="w"> </span><span class="nv">critic</span><span class="w">  </span>â”‚
â”‚<span class="w"> </span><span class="nv">Discount</span><span class="w"> </span><span class="ss">(</span>Î³<span class="ss">)</span><span class="w">           </span>â”‚<span class="w"> </span><span class="mi">0</span>.<span class="mi">99</span><span class="w">         </span>â”‚<span class="w"> </span><span class="nv">Standard</span><span class="w">                 </span>â”‚
â”‚<span class="w"> </span><span class="nv">Soft</span><span class="w"> </span><span class="nv">update</span><span class="w"> </span><span class="ss">(</span>Ï„<span class="ss">)</span><span class="w">        </span>â”‚<span class="w"> </span><span class="mi">0</span>.<span class="mi">005</span><span class="w">        </span>â”‚<span class="w"> </span><span class="nv">Slow</span><span class="w"> </span><span class="nv">target</span><span class="w"> </span><span class="nv">updates</span><span class="w">      </span>â”‚
â”‚<span class="w"> </span><span class="nv">Batch</span><span class="w"> </span><span class="nv">size</span><span class="w">             </span>â”‚<span class="w"> </span><span class="mi">256</span><span class="w">          </span>â”‚<span class="w"> </span><span class="nv">Larger</span><span class="w"> </span><span class="nv">is</span><span class="w"> </span><span class="nv">more</span><span class="w"> </span><span class="nv">stable</span><span class="w">    </span>â”‚
â”‚<span class="w"> </span><span class="nv">Buffer</span><span class="w"> </span><span class="nv">size</span><span class="w">            </span>â”‚<span class="w"> </span><span class="mi">1</span><span class="nv">M</span><span class="w">           </span>â”‚<span class="w"> </span><span class="nv">Large</span><span class="w"> </span><span class="nv">replay</span><span class="w"> </span><span class="nv">buffer</span><span class="w">      </span>â”‚
â”‚<span class="w"> </span><span class="nv">Hidden</span><span class="w"> </span><span class="nv">layers</span><span class="w">          </span>â”‚<span class="w"> </span><span class="ss">(</span><span class="mi">256</span>,<span class="w"> </span><span class="mi">256</span><span class="ss">)</span><span class="w">   </span>â”‚<span class="w"> </span><span class="mi">2</span><span class="w"> </span><span class="nv">layers</span><span class="w"> </span><span class="nv">is</span><span class="w"> </span><span class="nv">standard</span><span class="w">     </span>â”‚
â”‚<span class="w"> </span><span class="nv">Start</span><span class="w"> </span><span class="nv">steps</span><span class="w">            </span>â”‚<span class="w"> </span><span class="mi">5000</span><span class="o">-</span><span class="mi">10000</span><span class="w">   </span>â”‚<span class="w"> </span><span class="k">Random</span><span class="w"> </span><span class="nv">exploration</span><span class="w"> </span><span class="nv">first</span><span class="w"> </span>â”‚
â”‚<span class="w"> </span><span class="nv">Target</span><span class="w"> </span><span class="nv">entropy</span><span class="w">         </span>â”‚<span class="w"> </span><span class="o">-</span><span class="nv">dim</span><span class="ss">(</span><span class="nv">A</span><span class="ss">)</span><span class="w">      </span>â”‚<span class="w"> </span><span class="nv">Heuristic</span>,<span class="w"> </span><span class="nv">works</span><span class="w"> </span><span class="nv">well</span><span class="w">    </span>â”‚
â”‚<span class="w"> </span><span class="nv">Gradient</span><span class="w"> </span><span class="nv">steps</span><span class="o">/</span><span class="nv">env</span><span class="w"> </span><span class="nv">step</span>â”‚<span class="w"> </span><span class="mi">1</span><span class="w">            </span>â”‚<span class="w"> </span><span class="mi">1</span>:<span class="mi">1</span><span class="w"> </span><span class="nv">ratio</span><span class="w"> </span><span class="nv">is</span><span class="w"> </span><span class="nv">standard</span><span class="w">    </span>â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
</code></pre></div>

<h3 id="62">6.2 ì¼ë°˜ì ì¸ ë¬¸ì œì™€ í•´ê²° ë°©ë²•<a class="header-link" href="#62" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><span class="n">Issue</span><span class="o">:</span><span class="w"> </span><span class="n">Training</span><span class="w"> </span><span class="n">instability</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="n">Q</span><span class="o">-</span><span class="n">values</span><span class="w"> </span><span class="n">diverge</span>
<span class="err">â†’</span><span class="w"> </span><span class="n">Check</span><span class="w"> </span><span class="n">reward</span><span class="w"> </span><span class="n">scale</span><span class="w"> </span><span class="o">(</span><span class="n">normalize</span><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="n">needed</span><span class="o">)</span>
<span class="err">â†’</span><span class="w"> </span><span class="n">Reduce</span><span class="w"> </span><span class="n">learning</span><span class="w"> </span><span class="n">rate</span>
<span class="err">â†’</span><span class="w"> </span><span class="n">Increase</span><span class="w"> </span><span class="n">batch</span><span class="w"> </span><span class="n">size</span>

<span class="n">Issue</span><span class="o">:</span><span class="w"> </span><span class="n">Low</span><span class="w"> </span><span class="n">entropy</span><span class="w"> </span><span class="o">(</span><span class="n">premature</span><span class="w"> </span><span class="n">convergence</span><span class="o">)</span>
<span class="err">â†’</span><span class="w"> </span><span class="n">Enable</span><span class="w"> </span><span class="n">auto</span><span class="w"> </span><span class="n">alpha</span><span class="w"> </span><span class="n">tuning</span>
<span class="err">â†’</span><span class="w"> </span><span class="n">Increase</span><span class="w"> </span><span class="n">initial</span><span class="w"> </span><span class="n">alpha</span>
<span class="err">â†’</span><span class="w"> </span><span class="n">Check</span><span class="w"> </span><span class="n">action</span><span class="w"> </span><span class="n">bounds</span>

<span class="n">Issue</span><span class="o">:</span><span class="w"> </span><span class="n">Slow</span><span class="w"> </span><span class="n">learning</span>
<span class="err">â†’</span><span class="w"> </span><span class="n">Increase</span><span class="w"> </span><span class="n">start_steps</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="n">better</span><span class="w"> </span><span class="n">initial</span><span class="w"> </span><span class="n">exploration</span>
<span class="err">â†’</span><span class="w"> </span><span class="n">Try</span><span class="w"> </span><span class="n">larger</span><span class="w"> </span><span class="n">networks</span>
<span class="err">â†’</span><span class="w"> </span><span class="n">Check</span><span class="w"> </span><span class="n">reward</span><span class="w"> </span><span class="n">shaping</span>

<span class="n">Issue</span><span class="o">:</span><span class="w"> </span><span class="n">Action</span><span class="w"> </span><span class="n">values</span><span class="w"> </span><span class="n">saturating</span><span class="w"> </span><span class="n">at</span><span class="w"> </span><span class="n">bounds</span>
<span class="err">â†’</span><span class="w"> </span><span class="n">Ensure</span><span class="w"> </span><span class="n">proper</span><span class="w"> </span><span class="n">action</span><span class="w"> </span><span class="n">scaling</span>
<span class="err">â†’</span><span class="w"> </span><span class="n">Check</span><span class="w"> </span><span class="n">tanh</span><span class="w"> </span><span class="n">squashing</span><span class="w"> </span><span class="n">implementation</span>
<span class="err">â†’</span><span class="w"> </span><span class="n">Verify</span><span class="w"> </span><span class="n">log_prob</span><span class="w"> </span><span class="n">correction</span><span class="w"> </span><span class="n">term</span>
</code></pre></div>

<hr />
<h2 id="7">7. ì—°ìŠµ ë¬¸ì œ<a class="header-link" href="#7" title="Permanent link">&para;</a></h2>
<h3 id="1-pendulum-sac">ì—°ìŠµ 1: Pendulumì—ì„œ SAC<a class="header-link" href="#1-pendulum-sac" title="Permanent link">&para;</a></h3>
<p><code>Pendulum-v1</code>ì—ì„œ SACë¥¼ í•™ìŠµí•˜ê³  í•™ìŠµ ê³¡ì„ ì„ ê·¸ë¦¬ì„¸ìš”.</p>
<div class="highlight"><pre><span></span><code><span class="c1"># Train SAC</span>
<span class="n">agent</span><span class="p">,</span> <span class="n">rewards</span> <span class="o">=</span> <span class="n">train_sac</span><span class="p">(</span><span class="s1">&#39;Pendulum-v1&#39;</span><span class="p">,</span> <span class="n">total_steps</span><span class="o">=</span><span class="mi">50_000</span><span class="p">)</span>

<span class="c1"># Plot learning curve</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">matplotlib.pyplot</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">plt</span>
<span class="n">window</span> <span class="o">=</span> <span class="mi">10</span>
<span class="n">smoothed</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">convolve</span><span class="p">(</span><span class="n">rewards</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="n">window</span><span class="p">)</span><span class="o">/</span><span class="n">window</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="s1">&#39;valid&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">smoothed</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;Episode&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;Episode Reward&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;SAC on Pendulum-v1&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>

<span class="c1"># Expected: converges to ~-200 within 20K steps</span>
</code></pre></div>

<h3 id="2-sac-vs-ppo">ì—°ìŠµ 2: SAC vs PPO ë¹„êµ<a class="header-link" href="#2-sac-vs-ppo" title="Permanent link">&para;</a></h3>
<p>ì—°ì† ì œì–´ íƒœìŠ¤í¬ì—ì„œ SACì™€ PPOë¥¼ ëª¨ë‘ í•™ìŠµí•˜ê³  ìƒ˜í”Œ íš¨ìœ¨ì„±ì„ ë¹„êµí•˜ì„¸ìš”.</p>
<div class="highlight"><pre><span></span><code><span class="c1"># Use HalfCheetah-v4 or Hopper-v4</span>
<span class="c1"># Plot reward vs environment steps for both algorithms</span>
<span class="c1"># Expected: SAC reaches same performance in ~5x fewer environment steps</span>
<span class="c1"># But PPO may have lower wall-clock time per step</span>
</code></pre></div>

<h3 id="3-ablation-study">ì—°ìŠµ 3: ì ˆì œ ì—°êµ¬(Ablation Study)<a class="header-link" href="#3-ablation-study" title="Permanent link">&para;</a></h3>
<p>ë‹¤ìŒ ë³€í˜•ìœ¼ë¡œ SACë¥¼ ì‹¤í–‰í•˜ê³  ë¹„êµí•˜ì„¸ìš”:
1. ê³ ì • alpha = 0.2 (ìë™ íŠœë‹ ì—†ìŒ)
2. ìë™ alpha (ê¸°ë³¸ê°’)
3. ì—”íŠ¸ë¡œí”¼ í•­ ì—†ìŒ (alpha = 0, TD3ì™€ ìœ ì‚¬)
4. ë‹¨ì¼ Q-ë„¤íŠ¸ì›Œí¬ (íŠ¸ìœˆ í¬ë¦¬í‹± ì—†ìŒ)</p>
<div class="highlight"><pre><span></span><code><span class="c1"># Expected findings:</span>
<span class="c1"># - Auto alpha &gt; fixed alpha (adapts to task)</span>
<span class="c1"># - With entropy &gt; without (better exploration)</span>
<span class="c1"># - Twin critics &gt; single (prevents overestimation)</span>
</code></pre></div>

<h3 id="4_1">ì—°ìŠµ 4: ì»¤ìŠ¤í…€ í™˜ê²½<a class="header-link" href="#4_1" title="Permanent link">&para;</a></h3>
<p>ì»¤ìŠ¤í…€ ì—°ì† ì œì–´ íƒœìŠ¤í¬ì— SACë¥¼ ì ìš©í•˜ì„¸ìš”.</p>
<div class="highlight"><pre><span></span><code><span class="c1"># Example: reaching task</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">gymnasium</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">gym</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">gymnasium</span><span class="w"> </span><span class="kn">import</span> <span class="n">spaces</span>

<span class="k">class</span><span class="w"> </span><span class="nc">ReachingEnv</span><span class="p">(</span><span class="n">gym</span><span class="o">.</span><span class="n">Env</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;2D reaching task: move arm tip to target.&quot;&quot;&quot;</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">observation_space</span> <span class="o">=</span> <span class="n">spaces</span><span class="o">.</span><span class="n">Box</span><span class="p">(</span><span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">inf</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">inf</span><span class="p">,</span> <span class="n">shape</span><span class="o">=</span><span class="p">(</span><span class="mi">4</span><span class="p">,))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">action_space</span> <span class="o">=</span> <span class="n">spaces</span><span class="o">.</span><span class="n">Box</span><span class="p">(</span><span class="o">-</span><span class="mf">1.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">,</span> <span class="n">shape</span><span class="o">=</span><span class="p">(</span><span class="mi">2</span><span class="p">,))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">target</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mf">0.5</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">])</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">reset</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">seed</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">reset</span><span class="p">(</span><span class="n">seed</span><span class="o">=</span><span class="n">seed</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">pos</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">uniform</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">([</span><span class="bp">self</span><span class="o">.</span><span class="n">pos</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">target</span><span class="p">]),</span> <span class="p">{}</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">step</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">action</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">pos</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">clip</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">pos</span> <span class="o">+</span> <span class="n">action</span> <span class="o">*</span> <span class="mf">0.1</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
        <span class="n">dist</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">norm</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">pos</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">target</span><span class="p">)</span>
        <span class="n">reward</span> <span class="o">=</span> <span class="o">-</span><span class="n">dist</span>
        <span class="n">done</span> <span class="o">=</span> <span class="n">dist</span> <span class="o">&lt;</span> <span class="mf">0.05</span>
        <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">([</span><span class="bp">self</span><span class="o">.</span><span class="n">pos</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">target</span><span class="p">]),</span> <span class="n">reward</span><span class="p">,</span> <span class="n">done</span><span class="p">,</span> <span class="kc">False</span><span class="p">,</span> <span class="p">{}</span>
</code></pre></div>

<hr />
<h2 id="_3">ìš”ì•½<a class="header-link" href="#_3" title="Permanent link">&para;</a></h2>
<div class="highlight"><pre><span></span><code><span class="err">â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”</span>
<span class="err">â”‚</span><span class="w">              </span><span class="n">SAC</span><span class="w"> </span><span class="k">Key</span><span class="w"> </span><span class="n">Components</span><span class="w">                                  </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">                                                                 </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">  </span><span class="mf">1.</span><span class="w"> </span><span class="n">Maximum</span><span class="w"> </span><span class="n">entropy</span><span class="w"> </span><span class="nl">objective</span><span class="p">:</span><span class="w"> </span><span class="n">reward</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">Î±</span><span class="w"> </span><span class="err">Ã—</span><span class="w"> </span><span class="n">entropy</span><span class="w">             </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">  </span><span class="mf">2.</span><span class="w"> </span><span class="n">Squashed</span><span class="w"> </span><span class="n">Gaussian</span><span class="w"> </span><span class="nl">policy</span><span class="p">:</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">tanh</span><span class="p">(</span><span class="n">Î¼</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">ÏƒÎµ</span><span class="p">)</span><span class="w">                 </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">  </span><span class="mf">3.</span><span class="w"> </span><span class="n">Twin</span><span class="w"> </span><span class="n">Q</span><span class="o">-</span><span class="nl">critics</span><span class="p">:</span><span class="w"> </span><span class="nf">min</span><span class="p">(</span><span class="n">Q1</span><span class="p">,</span><span class="w"> </span><span class="n">Q2</span><span class="p">)</span><span class="w"> </span><span class="n">prevents</span><span class="w"> </span><span class="n">overestimation</span><span class="w">        </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">  </span><span class="mf">4.</span><span class="w"> </span><span class="n">Automatic</span><span class="w"> </span><span class="nl">temperature</span><span class="p">:</span><span class="w"> </span><span class="n">Î±</span><span class="w"> </span><span class="n">adapts</span><span class="w"> </span><span class="k">to</span><span class="w"> </span><span class="n">maintain</span><span class="w"> </span><span class="n">target</span><span class="w"> </span><span class="n">entropy</span><span class="w">  </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">  </span><span class="mf">5.</span><span class="w"> </span><span class="k">Off</span><span class="o">-</span><span class="nl">policy</span><span class="p">:</span><span class="w"> </span><span class="n">high</span><span class="w"> </span><span class="n">sample</span><span class="w"> </span><span class="n">efficiency</span><span class="w"> </span><span class="n">via</span><span class="w"> </span><span class="n">replay</span><span class="w"> </span><span class="n">buffer</span><span class="w">        </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">                                                                 </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">  </span><span class="n">SAC</span><span class="w"> </span><span class="k">is</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="k">go</span><span class="o">-</span><span class="k">to</span><span class="w"> </span><span class="n">algorithm</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="n">continuous</span><span class="w"> </span><span class="n">control</span><span class="w"> </span><span class="n">tasks</span><span class="w">         </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">  </span><span class="n">due</span><span class="w"> </span><span class="k">to</span><span class="w"> </span><span class="n">its</span><span class="w"> </span><span class="n">stability</span><span class="p">,</span><span class="w"> </span><span class="n">sample</span><span class="w"> </span><span class="n">efficiency</span><span class="p">,</span><span class="w"> </span><span class="ow">and</span><span class="w"> </span><span class="n">minimal</span><span class="w"> </span><span class="n">tuning</span><span class="p">.</span><span class="w">   </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">                                                                 </span><span class="err">â”‚</span>
<span class="err">â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜</span>
</code></pre></div>

<hr />
<h2 id="_4">ì°¸ê³  ë¬¸í—Œ<a class="header-link" href="#_4" title="Permanent link">&para;</a></h2>
<ul>
<li><a href="https://arxiv.org/abs/1801.01290">SAC Paper (v1)</a> â€” Haarnoja et al. 2018</li>
<li><a href="https://arxiv.org/abs/1812.05905">SAC Paper (v2, auto-alpha)</a> â€” Haarnoja et al. 2018</li>
<li><a href="https://spinningup.openai.com/en/latest/algorithms/sac.html">Spinning Up: SAC</a></li>
<li><a href="https://stable-baselines3.readthedocs.io/en/master/modules/sac.html">Stable-Baselines3 SAC</a></li>
<li><a href="https://docs.cleanrl.dev/rl-algorithms/sac/">CleanRL SAC Implementation</a></li>
</ul>
    </div>

    
<div class="lesson-toolbar lesson-toolbar--bottom">
    <div class="toolbar-nav toolbar-nav--prev">
        
        <a href="/study/ko/Reinforcement_Learning/13_Model_Based_RL.html" class="nav-prev">
            <span class="nav-label">Previous</span>
            <span class="nav-title">13. ëª¨ë¸ ê¸°ë°˜ ê°•í™”í•™ìŠµ(Model-Based Reinforcement Learning)</span>
        </a>
        
    </div>
    <div class="toolbar-actions">
        <button class="btn btn-copy-link" data-action="copy-link" title="Copy link">
            <span class="icon">ğŸ”—</span>
            <span class="text">Copy link</span>
        </button>
        <a href="/study/ko/Reinforcement_Learning/" class="btn btn-topic-link" title="Back to topic list">
            <span class="icon">ğŸ“‹</span>
            <span class="text">Topic list</span>
        </a>
    </div>
    <div class="toolbar-nav toolbar-nav--next">
        
    </div>
</div>


    <div class="toolbar-keyboard-hint">
        <kbd>&larr;</kbd> <kbd>&rarr;</kbd> to navigate between lessons
    </div>
</article>

<!-- Scroll to top floating button -->
<button class="scroll-to-top" id="scroll-to-top" title="Scroll to top" aria-label="Scroll to top">â†‘</button>

            </div>
        </main>
    </div>

    <script src="/study/static/js/app.js"></script>
    <script>
        function switchLanguage(newLang) {
            const path = window.location.pathname;
            const base = '/study';
            const currentLang = 'ko';
            const newPath = path.replace(base + '/' + currentLang + '/', base + '/' + newLang + '/');
            window.location.href = newPath + window.location.search;
        }
    </script>
    
<script>
    document.addEventListener('DOMContentLoaded', function() {
        // Copy link - independent feedback per button
        document.querySelectorAll('[data-action="copy-link"]').forEach(function(btn) {
            btn.addEventListener('click', function() {
                navigator.clipboard.writeText(window.location.href);
                var textEl = this.querySelector('.text');
                var originalText = textEl.textContent;
                textEl.textContent = 'Copied!';
                setTimeout(function() { textEl.textContent = originalText; }, 2000);
            });
        });

        // Add copy buttons to code blocks
        document.querySelectorAll('.lesson-content pre').forEach(function(pre) {
            var copyBtn = document.createElement('button');
            copyBtn.className = 'code-copy-btn';
            copyBtn.textContent = 'Copy';
            copyBtn.addEventListener('click', function() {
                var code = pre.querySelector('code');
                var text = code ? code.textContent : pre.textContent;
                navigator.clipboard.writeText(text);
                copyBtn.textContent = 'Copied!';
                setTimeout(function() { copyBtn.textContent = 'Copy'; }, 2000);
            });
            pre.style.position = 'relative';
            pre.appendChild(copyBtn);
        });

        // Scroll to top button
        var scrollBtn = document.getElementById('scroll-to-top');
        window.addEventListener('scroll', function() {
            scrollBtn.classList.toggle('visible', window.scrollY > 300);
        });
        scrollBtn.addEventListener('click', function() {
            window.scrollTo({ top: 0, behavior: 'smooth' });
        });

        // Keyboard shortcuts: left/right arrows for lesson navigation
        document.addEventListener('keydown', function(e) {
            var tag = document.activeElement.tagName;
            if (tag === 'INPUT' || tag === 'TEXTAREA' || tag === 'SELECT') return;

            if (e.key === 'ArrowLeft') {
                var prevLink = document.querySelector('.nav-prev');
                if (prevLink) prevLink.click();
            } else if (e.key === 'ArrowRight') {
                var nextLink = document.querySelector('.nav-next');
                if (nextLink) nextLink.click();
            }
        });
    });
</script>

</body>
</html>
{% endraw %}