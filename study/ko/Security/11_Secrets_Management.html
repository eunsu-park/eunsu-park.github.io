{% raw %}
<!DOCTYPE html>
<html lang="ko" data-theme="light">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Secrets Managementì™€ í™˜ê²½ ì„¤ì • - Study Materials</title>
    <link rel="stylesheet" href="/study/static/css/style.css">
    <link rel="stylesheet" href="/study/static/css/highlight.css">
    <!-- KaTeX for LaTeX math rendering -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.16.11/dist/katex.min.css">
    <script defer src="https://cdn.jsdelivr.net/npm/katex@0.16.11/dist/katex.min.js"></script>
    <script defer src="https://cdn.jsdelivr.net/npm/katex@0.16.11/dist/contrib/auto-render.min.js"
        onload="renderMathInElement(document.body, {
            delimiters: [
                {left: '$$', right: '$$', display: true},
                {left: '$', right: '$', display: false}
            ],
            throwOnError: false
        });"></script>
    
</head>
<body>
    <div class="app-container">
        <!-- Sidebar -->
        <aside class="sidebar" id="sidebar">
            <div class="sidebar-header">
                <a href="/study/ko/" class="logo">Study Materials</a>
                <button class="sidebar-toggle" id="sidebar-toggle" aria-label="Toggle sidebar">
                    <span></span>
                </button>
            </div>

            <nav class="sidebar-nav">
                <a href="/study/ko/" class="nav-item ">
                    <span class="nav-icon">ğŸ </span>
                    <span class="nav-text">Home</span>
                </a>
                <a href="/study/examples/" class="nav-item ">
                    <span class="nav-icon">ğŸ’»</span>
                    <span class="nav-text">Examples</span>
                </a>
            </nav>

            <div class="sidebar-search">
                <form action="/study/ko/search.html" method="get" id="search-form">
                    <input type="search" name="q" placeholder="Search..." id="search-sidebar-input">
                </form>
            </div>

            <!-- Language Selector -->
            <div class="sidebar-lang">
                <select id="lang-select" class="lang-selector" onchange="switchLanguage(this.value)">
                    
                    <option value="en" >
                        English
                    </option>
                    
                    <option value="ko" selected>
                        í•œêµ­ì–´
                    </option>
                    
                </select>
            </div>

            <div class="sidebar-footer">
                <button class="theme-toggle" id="theme-toggle" aria-label="Toggle theme">
                    <span class="theme-icon light">â˜€ï¸</span>
                    <span class="theme-icon dark">ğŸŒ™</span>
                </button>
            </div>
        </aside>

        <!-- Main Content -->
        <main class="main-content">
            <header class="main-header">
                <button class="menu-toggle" id="menu-toggle" aria-label="Open menu">
                    <span></span>
                </button>
                
<nav class="breadcrumb">
    <a href="/study/ko/">Topics</a>
    <span class="separator">/</span>
    <a href="/study/ko/Security/">Security</a>
    <span class="separator">/</span>
    <span class="current">Secrets Managementì™€ í™˜ê²½ ì„¤ì •</span>
</nav>

            </header>

            <div class="content">
                
<article class="lesson-article">
    <header class="lesson-header">
        <h1>Secrets Managementì™€ í™˜ê²½ ì„¤ì •</h1>
    </header>

    
<div class="lesson-toolbar lesson-toolbar--top">
    <div class="toolbar-nav toolbar-nav--prev">
        
        <a href="/study/ko/Security/10_API_Security.html" class="nav-prev">
            <span class="nav-label">Previous</span>
            <span class="nav-title">API ë³´ì•ˆ</span>
        </a>
        
    </div>
    <div class="toolbar-actions">
        <button class="btn btn-copy-link" data-action="copy-link" title="Copy link">
            <span class="icon">ğŸ”—</span>
            <span class="text">Copy link</span>
        </button>
        <a href="/study/ko/Security/" class="btn btn-topic-link" title="Back to topic list">
            <span class="icon">ğŸ“‹</span>
            <span class="text">Topic list</span>
        </a>
    </div>
    <div class="toolbar-nav toolbar-nav--next">
        
        <a href="/study/ko/Security/12_Container_Security.html" class="nav-next">
            <span class="nav-label">Next</span>
            <span class="nav-title">ì»¨í…Œì´ë„ˆ ë° í´ë¼ìš°ë“œ ë³´ì•ˆ</span>
        </a>
        
    </div>
</div>


    
    <nav class="toc" id="toc">
        <h2>Table of Contents</h2>
        <div class="toc">
<ul>
<li><a href="#_1">í•™ìŠµ ëª©í‘œ</a></li>
<li><a href="#1-secrets">1. Secrets ê¸°ì´ˆ</a><ul>
<li><a href="#11-secret">1.1 ë¬´ì—‡ì´ Secretì¸ê°€?</a></li>
<li><a href="#12-secret">1.2 Secret ìƒëª…ì£¼ê¸°</a></li>
</ul>
</li>
<li><a href="#2-env">2. í™˜ê²½ ë³€ìˆ˜ì™€ .env íŒŒì¼</a><ul>
<li><a href="#21-12-factor-app">2.1 12-Factor App ì ‘ê·¼ ë°©ì‹</a></li>
<li><a href="#22-python-dotenv">2.2 python-dotenv ì‚¬ìš©</a></li>
<li><a href="#23-env">2.3 .env íŒŒì¼</a></li>
<li><a href="#24-gitignore">2.4 .gitignore êµ¬ì„±</a></li>
<li><a href="#25-pydantic-settings">2.5 Pydantic Settings (íƒ€ì… ì•ˆì „ êµ¬ì„±)</a></li>
</ul>
</li>
<li><a href="#3-secret">3. Secret êµì²´ ì „ëµ</a><ul>
<li><a href="#31-secrets">3.1 ì™œ Secretsë¥¼ êµì²´í•˜ëŠ”ê°€?</a></li>
<li><a href="#32">3.2 ë‹¤ìš´íƒ€ì„ ì—†ëŠ” êµì²´ íŒ¨í„´</a></li>
<li><a href="#33">3.3 ë°ì´í„°ë² ì´ìŠ¤ ë¹„ë°€ë²ˆí˜¸ êµì²´</a></li>
</ul>
</li>
<li><a href="#4-hashicorp-vault">4. HashiCorp Vault</a><ul>
<li><a href="#41-vault">4.1 Vault ì•„í‚¤í…ì²˜</a></li>
<li><a href="#42-vault">4.2 Vault ë¹ ë¥¸ ì‹œì‘</a></li>
<li><a href="#43-python-vault-hvac">4.3 Pythonê³¼ Vault (hvac)</a></li>
<li><a href="#44-vault-approle">4.4 Vault AppRole ì¸ì¦</a></li>
</ul>
</li>
<li><a href="#5-secret">5. í´ë¼ìš°ë“œ Secret ê´€ë¦¬ì</a><ul>
<li><a href="#51-aws-secrets-manager">5.1 AWS Secrets Manager</a></li>
<li><a href="#52-gcp-secret-manager">5.2 GCP Secret Manager</a></li>
</ul>
</li>
<li><a href="#6-git-secrets">6. Git Secrets ìŠ¤ìºë‹</a><ul>
<li><a href="#61">6.1 ë¬¸ì œì </a></li>
<li><a href="#62-pre-commit">6.2 Pre-Commit í›…</a></li>
<li><a href="#63">6.3 ìŠ¤ìºë‹ ë„êµ¬</a></li>
<li><a href="#64-gitleaks">6.4 ì»¤ìŠ¤í…€ gitleaks êµ¬ì„±</a></li>
<li><a href="#65-git-secrets">6.5 Git íˆìŠ¤í† ë¦¬ì—ì„œ Secrets ì œê±°</a></li>
</ul>
</li>
<li><a href="#7-cicd-secrets">7. CI/CD Secrets</a><ul>
<li><a href="#71-github-actions-secrets">7.1 GitHub Actions Secrets</a></li>
<li><a href="#72-gitlab-ci">7.2 GitLab CI ë³€ìˆ˜</a></li>
</ul>
</li>
<li><a href="#8">8. ì €ì¥ ì‹œ ì•”í˜¸í™”</a><ul>
<li><a href="#81">8.1 êµ¬ì„± íŒŒì¼ ì•”í˜¸í™”</a></li>
<li><a href="#82-sops-secrets-operations">8.2 SOPS (Secrets OPerationS)</a></li>
</ul>
</li>
<li><a href="#9">9. ì¼ë°˜ì ì¸ ì‹¤ìˆ˜</a><ul>
<li><a href="#91">9.1 ì•ˆí‹°íŒ¨í„´</a></li>
<li><a href="#92-secret">9.2 Secret ê°ì§€ ì²´í¬ë¦¬ìŠ¤íŠ¸</a></li>
</ul>
</li>
<li><a href="#10">10. ì—°ìŠµ ë¬¸ì œ</a><ul>
<li><a href="#1">ì—°ìŠµ ë¬¸ì œ 1: í™˜ê²½ êµ¬ì„± ì‹œìŠ¤í…œ</a></li>
<li><a href="#2-secret">ì—°ìŠµ ë¬¸ì œ 2: Secret êµì²´ ì„œë¹„ìŠ¤</a></li>
<li><a href="#3-git-secret">ì—°ìŠµ ë¬¸ì œ 3: Git Secret ìŠ¤ìºë„ˆ</a></li>
<li><a href="#4-vault">ì—°ìŠµ ë¬¸ì œ 4: Vault í†µí•© ë¼ì´ë¸ŒëŸ¬ë¦¬</a></li>
<li><a href="#5-sops">ì—°ìŠµ ë¬¸ì œ 5: SOPS ì›Œí¬í”Œë¡œ ìë™í™”</a></li>
<li><a href="#6-cicd-secrets">ì—°ìŠµ ë¬¸ì œ 6: CI/CD Secrets ê°ì‚¬</a></li>
</ul>
</li>
<li><a href="#_2">ìš”ì•½</a><ul>
<li><a href="#secrets">Secrets ê´€ë¦¬ ì„±ìˆ™ë„ ëª¨ë¸</a></li>
<li><a href="#_3">í•µì‹¬ ìš”ì </a></li>
</ul>
</li>
</ul>
</div>

    </nav>
    

    <div class="lesson-content markdown-body">
        <h1 id="secrets-management">Secrets Managementì™€ í™˜ê²½ ì„¤ì •<a class="header-link" href="#secrets-management" title="Permanent link">&para;</a></h1>
<p><strong>ì´ì „</strong>: <a href="./10_API_Security.md">10_API_Security.md</a> | <strong>ë‹¤ìŒ</strong>: <a href="./12_Container_Security.md">12_Container_Security.md</a></p>
<hr />
<p>Secrets â€” API í‚¤, ë°ì´í„°ë² ì´ìŠ¤ ë¹„ë°€ë²ˆí˜¸, ì•”í˜¸í™” í‚¤, OAuth í´ë¼ì´ì–¸íŠ¸ ë¹„ë°€ â€” ëŠ” ëª¨ë“  ì• í”Œë¦¬ì¼€ì´ì…˜ì˜ ê°€ì¥ ì¤‘ìš”í•œ ìì‚°ì…ë‹ˆë‹¤. í•˜ë‚˜ì˜ ìœ ì¶œëœ secretë§Œìœ¼ë¡œë„ ì „ì²´ ì‹œìŠ¤í…œì´ ì†ìƒë  ìˆ˜ ìˆìŠµë‹ˆë‹¤. ê·¸ëŸ¼ì—ë„ ë¶ˆêµ¬í•˜ê³  secrets ê´€ë¦¬ëŠ” ì†Œí”„íŠ¸ì›¨ì–´ ê°œë°œì—ì„œ ê°€ì¥ í”íˆ ì˜ëª» ë‹¤ë£¨ì–´ì§€ëŠ” ì˜ì—­ ì¤‘ í•˜ë‚˜ë¡œ ë‚¨ì•„ìˆìŠµë‹ˆë‹¤. ì´ ë ˆìŠ¨ì—ì„œëŠ” secretsì˜ ì „ì²´ ìƒëª…ì£¼ê¸°ë¥¼ ë‹¤ë£¹ë‹ˆë‹¤: ì €ì¥, êµì²´, ëŸ°íƒ€ì„ ì£¼ì…, ìš°ë°œì  ìœ ì¶œ ìŠ¤ìºë‹, CI/CD íŒŒì´í”„ë¼ì¸ê³¼ í´ë¼ìš°ë“œ í™˜ê²½ì—ì„œì˜ ê´€ë¦¬ ë°©ë²•.</p>
<h2 id="_1">í•™ìŠµ ëª©í‘œ<a class="header-link" href="#_1" title="Permanent link">&para;</a></h2>
<ul>
<li>12-factor appì˜ êµ¬ì„± ë° secrets ì ‘ê·¼ ë°©ì‹ ì´í•´</li>
<li>python-dotenvë¥¼ ì‚¬ìš©í•˜ì—¬ í™˜ê²½ ë³€ìˆ˜ì™€ .env íŒŒì¼ì„ ì•ˆì „í•˜ê²Œ ì‚¬ìš©</li>
<li>ë‹¤ìš´íƒ€ì„ ì—†ëŠ” secret êµì²´ ì „ëµ êµ¬í˜„</li>
<li>ì¤‘ì•™ ì§‘ì¤‘ì‹ secrets ê´€ë¦¬ë¥¼ ìœ„í•œ HashiCorp Vault êµ¬ì„±</li>
<li>í´ë¼ìš°ë“œ ë„¤ì´í‹°ë¸Œ secret ì €ì¥ì†Œ(AWS Secrets Manager, GCP Secret Manager) ì‚¬ìš©</li>
<li>git íˆìŠ¤í† ë¦¬ì—ì„œ ìœ ì¶œëœ secretsë¥¼ ìŠ¤ìºë‹ ë„êµ¬ë¡œ ê°ì§€</li>
<li>CI/CD íŒŒì´í”„ë¼ì¸ì—ì„œ secrets ê´€ë¦¬(GitHub Actions, GitLab CI)</li>
<li>êµ¬ì„± íŒŒì¼ì˜ ì•”í˜¸í™”</li>
<li>secret ë…¸ì¶œë¡œ ì´ì–´ì§€ëŠ” ì¼ë°˜ì ì¸ ì‹¤ìˆ˜ ë°©ì§€</li>
</ul>
<hr />
<h2 id="1-secrets">1. Secrets ê¸°ì´ˆ<a class="header-link" href="#1-secrets" title="Permanent link">&para;</a></h2>
<h3 id="11-secret">1.1 ë¬´ì—‡ì´ Secretì¸ê°€?<a class="header-link" href="#11-secret" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code>â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    Secretsì˜ ìœ í˜•                                     â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                      â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚  ìê²© ì¦ëª…                                                   â”‚    â”‚
â”‚  â”‚  â”œâ”€â”€ ë°ì´í„°ë² ì´ìŠ¤ ë¹„ë°€ë²ˆí˜¸ (PostgreSQL, MySQL, Redis)        â”‚    â”‚
â”‚  â”‚  â”œâ”€â”€ ì„œë¹„ìŠ¤ ê³„ì • ë¹„ë°€ë²ˆí˜¸                                    â”‚    â”‚
â”‚  â”‚  â”œâ”€â”€ SMTP/ì´ë©”ì¼ ìê²© ì¦ëª…                                   â”‚    â”‚
â”‚  â”‚  â””â”€â”€ SSH ë¹„ë°€ë²ˆí˜¸                                            â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚                                                                      â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚  API í‚¤ì™€ í† í°                                               â”‚    â”‚
â”‚  â”‚  â”œâ”€â”€ ì„œë“œíŒŒí‹° API í‚¤ (Stripe, Twilio, AWS)                  â”‚    â”‚
â”‚  â”‚  â”œâ”€â”€ OAuth í´ë¼ì´ì–¸íŠ¸ ë¹„ë°€                                   â”‚    â”‚
â”‚  â”‚  â”œâ”€â”€ JWT ì„œëª… í‚¤                                             â”‚    â”‚
â”‚  â”‚  â””â”€â”€ ê°œì¸ ì•¡ì„¸ìŠ¤ í† í°                                        â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚                                                                      â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚  ì•”í˜¸í™” ìë£Œ                                                 â”‚    â”‚
â”‚  â”‚  â”œâ”€â”€ TLS ê°œì¸ í‚¤                                             â”‚    â”‚
â”‚  â”‚  â”œâ”€â”€ ì•”í˜¸í™” í‚¤ (AES, RSA ê°œì¸ í‚¤)                            â”‚    â”‚
â”‚  â”‚  â”œâ”€â”€ SSH ê°œì¸ í‚¤                                             â”‚    â”‚
â”‚  â”‚  â””â”€â”€ ì½”ë“œ ì„œëª… í‚¤                                            â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚                                                                      â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚  ì¸í”„ë¼ Secrets                                              â”‚    â”‚
â”‚  â”‚  â”œâ”€â”€ í´ë¼ìš°ë“œ ì œê³µì ìê²© ì¦ëª… (AWS ì•¡ì„¸ìŠ¤ í‚¤)               â”‚    â”‚
â”‚  â”‚  â”œâ”€â”€ ì»¨í…Œì´ë„ˆ ë ˆì§€ìŠ¤íŠ¸ë¦¬ ìê²© ì¦ëª…                           â”‚    â”‚
â”‚  â”‚  â”œâ”€â”€ Kubernetes secrets                                     â”‚    â”‚
â”‚  â”‚  â””â”€â”€ Terraform ìƒíƒœ ì•”í˜¸í™” í‚¤                                â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚                                                                      â”‚
â”‚  ê²½í—˜ ë²•ì¹™: ë…¸ì¶œë˜ë©´ í”¼í•´ë¥¼ ì…í ìˆ˜ ìˆë‹¤ë©´, ê·¸ê²ƒì€ secretì…ë‹ˆë‹¤.      â”‚
â”‚                                                                      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
</code></pre></div>

<h3 id="12-secret">1.2 Secret ìƒëª…ì£¼ê¸°<a class="header-link" href="#12-secret" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code>â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    Secret ìƒëª…ì£¼ê¸°                                    â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                      â”‚
â”‚  1. ìƒì„± â”€â”€â–¶ 2. ì €ì¥ â”€â”€â–¶ 3. ë°°í¬ â”€â”€â–¶ 4. ì‚¬ìš©                        â”‚
â”‚       â”‚                â”‚               â”‚                  â”‚          â”‚
â”‚       â”‚                â”‚               â”‚                  â”‚          â”‚
â”‚       â–¼                â–¼               â–¼                  â–¼          â”‚
â”‚  ê°•ë ¥í•œ ë¬´ì‘ìœ„       ì €ì¥ ì‹œ          ë³´ì•ˆ ì±„ë„         ìµœì†Œ ë…¸ì¶œ      â”‚
â”‚  ìƒì„±                ì•”í˜¸í™”           (TLS, IAM)                      â”‚
â”‚                                                                      â”‚
â”‚  5. êµì²´ â”€â”€â–¶ 6. íê¸° â”€â”€â–¶ 7. ê°ì‚¬                                    â”‚
â”‚       â”‚                â”‚                â”‚                            â”‚
â”‚       â–¼                â–¼                â–¼                            â”‚
â”‚  ìë™í™”ëœ           ì†ìƒ ì‹œ          ì•¡ì„¸ìŠ¤ ë°                        â”‚
â”‚  ì£¼ê¸°ì              ì¦‰ì‹œ             ë³€ê²½ ê¸°ë¡                        â”‚
â”‚                                                                      â”‚
â”‚  ì£¼ìš” ì›ì¹™:                                                           â”‚
â”‚  â€¢ ìµœì†Œ ê¶Œí•œ: í•„ìš”í•œ ì‚¬ëŒì—ê²Œë§Œ ì•¡ì„¸ìŠ¤ ë¶€ì—¬                            â”‚
â”‚  â€¢ ë‹¨ê¸°ê°„: ì˜êµ¬ ìê²© ì¦ëª…ë³´ë‹¤ ì„ì‹œ ìê²© ì¦ëª… ì„ í˜¸                      â”‚
â”‚  â€¢ ì €ì¥ ì‹œ ì•”í˜¸í™”: ì ˆëŒ€ í‰ë¬¸ìœ¼ë¡œ secrets ì €ì¥ ê¸ˆì§€                    â”‚
â”‚  â€¢ ê°ì‚¬ ê°€ëŠ¥: ëˆ„ê°€ ì–¸ì œ ì–´ë–¤ secretì— ì•¡ì„¸ìŠ¤í–ˆëŠ”ì§€ ê¸°ë¡                â”‚
â”‚  â€¢ êµì²´ ê°€ëŠ¥: secret êµì²´ë¥¼ ì²˜ë¦¬í•  ìˆ˜ ìˆë„ë¡ ì‹œìŠ¤í…œ ì„¤ê³„               â”‚
â”‚                                                                      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
</code></pre></div>

<hr />
<h2 id="2-env">2. í™˜ê²½ ë³€ìˆ˜ì™€ .env íŒŒì¼<a class="header-link" href="#2-env" title="Permanent link">&para;</a></h2>
<h3 id="21-12-factor-app">2.1 12-Factor App ì ‘ê·¼ ë°©ì‹<a class="header-link" href="#21-12-factor-app" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code>â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    12-Factor App: êµ¬ì„±                                â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                      â”‚
â”‚  Factor III: í™˜ê²½ì— êµ¬ì„± ì €ì¥                                         â”‚
â”‚                                                                      â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                                â”‚
â”‚  â”‚  ì• í”Œë¦¬ì¼€ì´ì…˜     â”‚                                               â”‚
â”‚  â”‚  ì½”ë“œ            â”‚ â† ë™ì¼í•œ ì½”ë“œê°€ ëª¨ë“  ê³³ì— ë°°í¬ë¨                 â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                                â”‚
â”‚           â”‚                                                          â”‚
â”‚           â–¼                                                          â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”‚
â”‚  â”‚  ê°œë°œ í™˜ê²½       â”‚  â”‚  ìŠ¤í…Œì´ì§•        â”‚  â”‚  í”„ë¡œë•ì…˜        â”‚    â”‚
â”‚  â”‚  DB=localhost    â”‚  â”‚  DB=staging.db   â”‚  â”‚  DB=prod.db      â”‚    â”‚
â”‚  â”‚  DEBUG=true      â”‚  â”‚  DEBUG=false     â”‚  â”‚  DEBUG=false     â”‚    â”‚
â”‚  â”‚  KEY=dev_key     â”‚  â”‚  KEY=stage_key   â”‚  â”‚  KEY=prod_key    â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â”‚
â”‚                                                                      â”‚
â”‚  ë°°í¬ ê°„ ë³€ê²½ë˜ëŠ” êµ¬ì„±:                                                â”‚
â”‚  âœ“ ë°ì´í„°ë² ì´ìŠ¤ URL, API í‚¤, ê¸°ëŠ¥ í”Œë˜ê·¸                              â”‚
â”‚                                                                      â”‚
â”‚  ë³€ê²½ë˜ì§€ ì•ŠëŠ” êµ¬ì„±:                                                   â”‚
â”‚  âœ— í”„ë ˆì„ì›Œí¬ ì„¤ì •, ë¡œê¹… í¬ë§·, ë¼ìš°íŠ¸                                  â”‚
â”‚  (ì´ê²ƒë“¤ì€ ì½”ë“œ/êµ¬ì„± íŒŒì¼ì— ì†í•˜ë©°, í™˜ê²½ ë³€ìˆ˜ê°€ ì•„ë‹˜)                   â”‚
â”‚                                                                      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
</code></pre></div>

<h3 id="22-python-dotenv">2.2 python-dotenv ì‚¬ìš©<a class="header-link" href="#22-python-dotenv" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">python-dotenvë¥¼ ì‚¬ìš©í•˜ì—¬ .env íŒŒì¼ì—ì„œ êµ¬ì„± ë¡œë“œ.</span>
<span class="sd">pip install python-dotenv</span>
<span class="sd">&quot;&quot;&quot;</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">os</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">pathlib</span><span class="w"> </span><span class="kn">import</span> <span class="n">Path</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">dotenv</span><span class="w"> </span><span class="kn">import</span> <span class="n">load_dotenv</span>

<span class="c1"># â”€â”€ ê¸°ë³¸ ì‚¬ìš©ë²• â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€</span>
<span class="c1"># í˜„ì¬ ë””ë ‰í† ë¦¬ì—ì„œ .env íŒŒì¼ ë¡œë“œ</span>
<span class="n">load_dotenv</span><span class="p">()</span>

<span class="c1"># í™˜ê²½ ë³€ìˆ˜ ì•¡ì„¸ìŠ¤</span>
<span class="n">database_url</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">getenv</span><span class="p">(</span><span class="s1">&#39;DATABASE_URL&#39;</span><span class="p">)</span>
<span class="n">secret_key</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">getenv</span><span class="p">(</span><span class="s1">&#39;SECRET_KEY&#39;</span><span class="p">)</span>
<span class="n">debug</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">getenv</span><span class="p">(</span><span class="s1">&#39;DEBUG&#39;</span><span class="p">,</span> <span class="s1">&#39;false&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="o">==</span> <span class="s1">&#39;true&#39;</span>

<span class="c1"># â”€â”€ íŠ¹ì • ê²½ë¡œì—ì„œ ë¡œë“œ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€</span>
<span class="n">env_path</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="vm">__file__</span><span class="p">)</span><span class="o">.</span><span class="n">parent</span> <span class="o">/</span> <span class="s1">&#39;.env.production&#39;</span>
<span class="n">load_dotenv</span><span class="p">(</span><span class="n">dotenv_path</span><span class="o">=</span><span class="n">env_path</span><span class="p">)</span>

<span class="c1"># â”€â”€ ê¸°ì¡´ í™˜ê²½ ë³€ìˆ˜ ë®ì–´ì“°ê¸° â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€</span>
<span class="c1"># ê¸°ë³¸ì ìœ¼ë¡œ dotenvëŠ” ê¸°ì¡´ í™˜ê²½ ë³€ìˆ˜ë¥¼ ë®ì–´ì“°ì§€ ì•ŠìŒ</span>
<span class="c1"># ì´ëŠ” ì•ˆì „í•¨: ì‹œìŠ¤í…œ í™˜ê²½ ë³€ìˆ˜ê°€ ìš°ì„ ìˆœìœ„ë¥¼ ê°€ì§</span>
<span class="n">load_dotenv</span><span class="p">(</span><span class="n">override</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>  <span class="c1"># ê¸°ë³¸ ë™ì‘</span>

<span class="c1"># ë®ì–´ì“°ê¸° ê°•ì œ(ê±°ì˜ í•„ìš”í•˜ì§€ ì•ŠìŒ):</span>
<span class="n">load_dotenv</span><span class="p">(</span><span class="n">override</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>


<span class="c1"># â”€â”€ êµ¬ì¡°í™”ëœ êµ¬ì„± í´ë˜ìŠ¤ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">dataclasses</span><span class="w"> </span><span class="kn">import</span> <span class="n">dataclass</span>

<span class="nd">@dataclass</span>
<span class="k">class</span><span class="w"> </span><span class="nc">AppConfig</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;í™˜ê²½ì—ì„œ ë¡œë“œëœ ì• í”Œë¦¬ì¼€ì´ì…˜ êµ¬ì„±.&quot;&quot;&quot;</span>

    <span class="c1"># ë°ì´í„°ë² ì´ìŠ¤</span>
    <span class="n">database_url</span><span class="p">:</span> <span class="nb">str</span>
    <span class="n">database_pool_size</span><span class="p">:</span> <span class="nb">int</span>

    <span class="c1"># ë³´ì•ˆ</span>
    <span class="n">secret_key</span><span class="p">:</span> <span class="nb">str</span>
    <span class="n">jwt_secret</span><span class="p">:</span> <span class="nb">str</span>
    <span class="n">jwt_expiry_minutes</span><span class="p">:</span> <span class="nb">int</span>

    <span class="c1"># ì™¸ë¶€ ì„œë¹„ìŠ¤</span>
    <span class="n">stripe_api_key</span><span class="p">:</span> <span class="nb">str</span>
    <span class="n">sendgrid_api_key</span><span class="p">:</span> <span class="nb">str</span>

    <span class="c1"># ì• í”Œë¦¬ì¼€ì´ì…˜</span>
    <span class="n">debug</span><span class="p">:</span> <span class="nb">bool</span>
    <span class="n">log_level</span><span class="p">:</span> <span class="nb">str</span>

    <span class="nd">@classmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">from_env</span><span class="p">(</span><span class="bp">cls</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="s1">&#39;AppConfig&#39;</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;í™˜ê²½ ë³€ìˆ˜ì—ì„œ êµ¬ì„± ë¡œë“œ.&quot;&quot;&quot;</span>
        <span class="n">load_dotenv</span><span class="p">()</span>

        <span class="k">def</span><span class="w"> </span><span class="nf">require_env</span><span class="p">(</span><span class="n">key</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">            </span><span class="sd">&quot;&quot;&quot;í•„ìˆ˜ í™˜ê²½ ë³€ìˆ˜ë¥¼ ê°€ì ¸ì˜¤ê±°ë‚˜ ì˜¤ë¥˜ ë°œìƒ.&quot;&quot;&quot;</span>
            <span class="n">value</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">getenv</span><span class="p">(</span><span class="n">key</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">value</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">EnvironmentError</span><span class="p">(</span>
                    <span class="sa">f</span><span class="s2">&quot;Required environment variable &#39;</span><span class="si">{</span><span class="n">key</span><span class="si">}</span><span class="s2">&#39; is not set. &quot;</span>
                    <span class="sa">f</span><span class="s2">&quot;Check your .env file or environment configuration.&quot;</span>
                <span class="p">)</span>
            <span class="k">return</span> <span class="n">value</span>

        <span class="k">return</span> <span class="bp">cls</span><span class="p">(</span>
            <span class="n">database_url</span><span class="o">=</span><span class="n">require_env</span><span class="p">(</span><span class="s1">&#39;DATABASE_URL&#39;</span><span class="p">),</span>
            <span class="n">database_pool_size</span><span class="o">=</span><span class="nb">int</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">getenv</span><span class="p">(</span><span class="s1">&#39;DATABASE_POOL_SIZE&#39;</span><span class="p">,</span> <span class="s1">&#39;5&#39;</span><span class="p">)),</span>
            <span class="n">secret_key</span><span class="o">=</span><span class="n">require_env</span><span class="p">(</span><span class="s1">&#39;SECRET_KEY&#39;</span><span class="p">),</span>
            <span class="n">jwt_secret</span><span class="o">=</span><span class="n">require_env</span><span class="p">(</span><span class="s1">&#39;JWT_SECRET&#39;</span><span class="p">),</span>
            <span class="n">jwt_expiry_minutes</span><span class="o">=</span><span class="nb">int</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">getenv</span><span class="p">(</span><span class="s1">&#39;JWT_EXPIRY_MINUTES&#39;</span><span class="p">,</span> <span class="s1">&#39;15&#39;</span><span class="p">)),</span>
            <span class="n">stripe_api_key</span><span class="o">=</span><span class="n">require_env</span><span class="p">(</span><span class="s1">&#39;STRIPE_API_KEY&#39;</span><span class="p">),</span>
            <span class="n">sendgrid_api_key</span><span class="o">=</span><span class="n">require_env</span><span class="p">(</span><span class="s1">&#39;SENDGRID_API_KEY&#39;</span><span class="p">),</span>
            <span class="n">debug</span><span class="o">=</span><span class="n">os</span><span class="o">.</span><span class="n">getenv</span><span class="p">(</span><span class="s1">&#39;DEBUG&#39;</span><span class="p">,</span> <span class="s1">&#39;false&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="o">==</span> <span class="s1">&#39;true&#39;</span><span class="p">,</span>
            <span class="n">log_level</span><span class="o">=</span><span class="n">os</span><span class="o">.</span><span class="n">getenv</span><span class="p">(</span><span class="s1">&#39;LOG_LEVEL&#39;</span><span class="p">,</span> <span class="s1">&#39;INFO&#39;</span><span class="p">),</span>
        <span class="p">)</span>


<span class="c1"># â”€â”€ ì‚¬ìš©ë²• â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€</span>
<span class="n">config</span> <span class="o">=</span> <span class="n">AppConfig</span><span class="o">.</span><span class="n">from_env</span><span class="p">()</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Debug mode: </span><span class="si">{</span><span class="n">config</span><span class="o">.</span><span class="n">debug</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Database: </span><span class="si">{</span><span class="n">config</span><span class="o">.</span><span class="n">database_url</span><span class="p">[:</span><span class="mi">20</span><span class="p">]</span><span class="si">}</span><span class="s2">...&quot;</span><span class="p">)</span>  <span class="c1"># ì „ì²´ URL ë¡œê¹…í•˜ì§€ ì•Šê¸°</span>
</code></pre></div>

<h3 id="23-env">2.3 .env íŒŒì¼<a class="header-link" href="#23-env" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><span class="c1"># â”€â”€ .env íŒŒì¼ (ì ˆëŒ€ gitì— ì»¤ë°‹í•˜ì§€ ë§ ê²ƒ) â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€</span>

<span class="c1"># ë°ì´í„°ë² ì´ìŠ¤</span>
<span class="nv">DATABASE_URL</span><span class="o">=</span>postgresql://user:password@localhost:5432/mydb
<span class="nv">DATABASE_POOL_SIZE</span><span class="o">=</span><span class="m">5</span>

<span class="c1"># ë³´ì•ˆ</span>
<span class="nv">SECRET_KEY</span><span class="o">=</span>your-256-bit-secret-key-here-change-me
<span class="nv">JWT_SECRET</span><span class="o">=</span>another-different-secret-key-for-jwt

<span class="c1"># ì™¸ë¶€ API</span>
<span class="nv">STRIPE_API_KEY</span><span class="o">=</span>sk_test_EXAMPLE_KEY_REPLACE_ME
<span class="nv">SENDGRID_API_KEY</span><span class="o">=</span>SG.xxxxxxxxxxxxx

<span class="c1"># ì• í”Œë¦¬ì¼€ì´ì…˜</span>
<span class="nv">DEBUG</span><span class="o">=</span><span class="nb">false</span>
<span class="nv">LOG_LEVEL</span><span class="o">=</span>INFO
</code></pre></div>

<div class="highlight"><pre><span></span><code><span class="c1"># â”€â”€ .env.example íŒŒì¼ (gitì— ì»¤ë°‹í•  ê²ƒ) â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€</span>
<span class="c1"># ì´ íŒŒì¼ì„ .envë¡œ ë³µì‚¬í•˜ê³  ê°’ì„ ì±„ìš°ì„¸ìš”</span>
<span class="c1"># cp .env.example .env</span>

<span class="c1"># ë°ì´í„°ë² ì´ìŠ¤</span>
<span class="nv">DATABASE_URL</span><span class="o">=</span>postgresql://user:password@localhost:5432/mydb
<span class="nv">DATABASE_POOL_SIZE</span><span class="o">=</span><span class="m">5</span>

<span class="c1"># ë³´ì•ˆ (ìƒì„±: python -c &quot;import secrets; print(secrets.token_hex(32))&quot;)</span>
<span class="nv">SECRET_KEY</span><span class="o">=</span>change-me-generate-a-real-secret
<span class="nv">JWT_SECRET</span><span class="o">=</span>change-me-use-a-different-secret

<span class="c1"># ì™¸ë¶€ API</span>
<span class="nv">STRIPE_API_KEY</span><span class="o">=</span>sk_test_your_test_key_here
<span class="nv">SENDGRID_API_KEY</span><span class="o">=</span>SG.your_api_key_here

<span class="c1"># ì• í”Œë¦¬ì¼€ì´ì…˜</span>
<span class="nv">DEBUG</span><span class="o">=</span><span class="nb">true</span>
<span class="nv">LOG_LEVEL</span><span class="o">=</span>DEBUG
</code></pre></div>

<h3 id="24-gitignore">2.4 .gitignore êµ¬ì„±<a class="header-link" href="#24-gitignore" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><span class="c1"># â”€â”€ Secrets ë° í™˜ê²½ íŒŒì¼ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€</span>
<span class="na">.env</span>
<span class="na">.env.local</span>
<span class="na">.env.production</span>
<span class="na">.env.staging</span>
<span class="na">.env.</span><span class="p">*.</span><span class="no">local</span>

<span class="c1"># ì˜ˆì œ íŒŒì¼ ìœ ì§€</span>
<span class="err">!</span><span class="na">.env.example</span>
<span class="err">!</span><span class="na">.env.template</span>

<span class="c1"># ê°œì¸ í‚¤</span>
<span class="err">*</span><span class="na">.pem</span>
<span class="err">*</span><span class="na">.key</span>
<span class="err">*</span><span class="na">.p12</span>
<span class="err">*</span><span class="na">.pfx</span>

<span class="c1"># í´ë¼ìš°ë“œ ìê²© ì¦ëª…</span>
<span class="nf">credentials.json</span>
<span class="nf">service-account</span><span class="p">*.</span><span class="no">json</span>
<span class="na">.gcloud</span><span class="err">/</span>
<span class="na">.aws</span><span class="err">/</span><span class="no">credentials</span>

<span class="c1"># IDE secrets</span>
<span class="na">.idea</span><span class="err">/</span><span class="no">dataSources</span><span class="err">/</span>
<span class="na">.vscode</span><span class="err">/</span><span class="no">settings.json</span>
</code></pre></div>

<h3 id="25-pydantic-settings">2.5 Pydantic Settings (íƒ€ì… ì•ˆì „ êµ¬ì„±)<a class="header-link" href="#25-pydantic-settings" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">Pydantic Settingsë¥¼ ì‚¬ìš©í•œ íƒ€ì… ì•ˆì „ êµ¬ì„±.</span>
<span class="sd">pip install pydantic-settings</span>
<span class="sd">&quot;&quot;&quot;</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">pydantic_settings</span><span class="w"> </span><span class="kn">import</span> <span class="n">BaseSettings</span><span class="p">,</span> <span class="n">SettingsConfigDict</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">pydantic</span><span class="w"> </span><span class="kn">import</span> <span class="n">Field</span><span class="p">,</span> <span class="n">SecretStr</span><span class="p">,</span> <span class="n">PostgresDsn</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">typing</span><span class="w"> </span><span class="kn">import</span> <span class="n">Optional</span>


<span class="k">class</span><span class="w"> </span><span class="nc">Settings</span><span class="p">(</span><span class="n">BaseSettings</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;ê²€ì¦ ë° íƒ€ì… ê°•ì œê°€ ìˆëŠ” ì• í”Œë¦¬ì¼€ì´ì…˜ ì„¤ì •.&quot;&quot;&quot;</span>

    <span class="n">model_config</span> <span class="o">=</span> <span class="n">SettingsConfigDict</span><span class="p">(</span>
        <span class="n">env_file</span><span class="o">=</span><span class="s1">&#39;.env&#39;</span><span class="p">,</span>
        <span class="n">env_file_encoding</span><span class="o">=</span><span class="s1">&#39;utf-8&#39;</span><span class="p">,</span>
        <span class="n">case_sensitive</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
        <span class="c1"># ì¶©ëŒì„ í”¼í•˜ê¸° ìœ„í•´ ëª¨ë“  í™˜ê²½ ë³€ìˆ˜ ì•ì— APP_ ì ‘ë‘ì‚¬ ì¶”ê°€</span>
        <span class="n">env_prefix</span><span class="o">=</span><span class="s1">&#39;APP_&#39;</span><span class="p">,</span>
    <span class="p">)</span>

    <span class="c1"># ë°ì´í„°ë² ì´ìŠ¤</span>
    <span class="n">database_url</span><span class="p">:</span> <span class="n">PostgresDsn</span>
    <span class="n">database_pool_size</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="n">Field</span><span class="p">(</span><span class="n">default</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span> <span class="n">ge</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">le</span><span class="o">=</span><span class="mi">50</span><span class="p">)</span>

    <span class="c1"># ë³´ì•ˆ â€” SecretStrì€ ë¡œê·¸ì™€ reprì—ì„œ ê°’ì„ ìˆ¨ê¹€</span>
    <span class="n">secret_key</span><span class="p">:</span> <span class="n">SecretStr</span>
    <span class="n">jwt_secret</span><span class="p">:</span> <span class="n">SecretStr</span>
    <span class="n">jwt_expiry_minutes</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="n">Field</span><span class="p">(</span><span class="n">default</span><span class="o">=</span><span class="mi">15</span><span class="p">,</span> <span class="n">ge</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">le</span><span class="o">=</span><span class="mi">1440</span><span class="p">)</span>

    <span class="c1"># ì™¸ë¶€ API</span>
    <span class="n">stripe_api_key</span><span class="p">:</span> <span class="n">SecretStr</span>
    <span class="n">sendgrid_api_key</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">SecretStr</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>

    <span class="c1"># ì• í”Œë¦¬ì¼€ì´ì…˜</span>
    <span class="n">debug</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span>
    <span class="n">log_level</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="n">Field</span><span class="p">(</span><span class="n">default</span><span class="o">=</span><span class="s2">&quot;INFO&quot;</span><span class="p">,</span> <span class="n">pattern</span><span class="o">=</span><span class="sa">r</span><span class="s1">&#39;^(DEBUG|INFO|WARNING|ERROR|CRITICAL)$&#39;</span><span class="p">)</span>

    <span class="c1"># ì„œë²„</span>
    <span class="n">host</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;0.0.0.0&quot;</span>
    <span class="n">port</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="n">Field</span><span class="p">(</span><span class="n">default</span><span class="o">=</span><span class="mi">8000</span><span class="p">,</span> <span class="n">ge</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">le</span><span class="o">=</span><span class="mi">65535</span><span class="p">)</span>


<span class="c1"># â”€â”€ ì‚¬ìš©ë²• â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€</span>
<span class="n">settings</span> <span class="o">=</span> <span class="n">Settings</span><span class="p">()</span>

<span class="c1"># SecretStrì€ ìš°ë°œì  ë¡œê¹… ë°©ì§€</span>
<span class="nb">print</span><span class="p">(</span><span class="n">settings</span><span class="o">.</span><span class="n">secret_key</span><span class="p">)</span>
<span class="c1"># ì¶œë ¥: SecretStr(&#39;**********&#39;)</span>

<span class="c1"># í•„ìš”í•  ë•Œ ì‹¤ì œ ê°’ ì•¡ì„¸ìŠ¤</span>
<span class="n">actual_key</span> <span class="o">=</span> <span class="n">settings</span><span class="o">.</span><span class="n">secret_key</span><span class="o">.</span><span class="n">get_secret_value</span><span class="p">()</span>

<span class="c1"># ë¹„ë°€ì´ ì•„ë‹Œ ì„¤ì •ì€ ì•ˆì „í•˜ê²Œ ì¶œë ¥</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Debug: </span><span class="si">{</span><span class="n">settings</span><span class="o">.</span><span class="n">debug</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Port: </span><span class="si">{</span><span class="n">settings</span><span class="o">.</span><span class="n">port</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

<span class="c1"># ì´ê²ƒì€ secret ê°’ì„ ë“œëŸ¬ë‚´ì§€ ì•ŠìŒ</span>
<span class="nb">print</span><span class="p">(</span><span class="n">settings</span><span class="o">.</span><span class="n">model_dump</span><span class="p">())</span>
<span class="c1"># {&#39;database_url&#39;: ..., &#39;secret_key&#39;: SecretStr(&#39;**********&#39;), ...}</span>
</code></pre></div>

<hr />
<h2 id="3-secret">3. Secret êµì²´ ì „ëµ<a class="header-link" href="#3-secret" title="Permanent link">&para;</a></h2>
<h3 id="31-secrets">3.1 ì™œ Secretsë¥¼ êµì²´í•˜ëŠ”ê°€?<a class="header-link" href="#31-secrets" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code>â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    Secret êµì²´ ì´ìœ                                    â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                      â”‚
â”‚  1. ì†ìƒì˜ í­ë°œ ë°˜ê²½ ì œí•œ                                              â”‚
â”‚     ì´ì „ secret ì†ìƒë¨ â”€â”€â–¶ ë‹¤ìŒ êµì²´ê¹Œì§€ë§Œ ìœ íš¨                        â”‚
â”‚                                                                      â”‚
â”‚  2. ê·œì • ì¤€ìˆ˜ ìš”êµ¬ì‚¬í•­                                                 â”‚
â”‚     PCI DSS, SOC 2, HIPAAëŠ” ì£¼ê¸°ì  êµì²´ ìš”êµ¬                           â”‚
â”‚                                                                      â”‚
â”‚  3. ì¸ì‚¬ ë³€ê²½                                                         â”‚
â”‚     ì§ì› í‡´ì‚¬ â”€â”€â–¶ ê·¸ë“¤ì´ ì•¡ì„¸ìŠ¤í•œ ëª¨ë“  secrets êµì²´                     â”‚
â”‚                                                                      â”‚
â”‚  4. ë„ë‚œë‹¹í•œ secretsì˜ ê°€ì¹˜ ê°ì†Œ                                       â”‚
â”‚     ë‹¨ê¸°ê°„ secretsëŠ” ê³µê²©ìì—ê²Œ ëœ ìœ ìš©                                 â”‚
â”‚                                                                      â”‚
â”‚  êµì²´ ë¹ˆë„ ê¶Œì¥ì‚¬í•­:                                                   â”‚
â”‚  â”œâ”€â”€ API í‚¤:         90ì¼ë§ˆë‹¤                                         â”‚
â”‚  â”œâ”€â”€ ë°ì´í„°ë² ì´ìŠ¤ ë¹„ë°€ë²ˆí˜¸: 30-90ì¼ë§ˆë‹¤                                â”‚
â”‚  â”œâ”€â”€ TLS ì¸ì¦ì„œ:     ë§Œë£Œ ì „ (ACME/Let&#39;s Encryptë¡œ ìë™í™”)             â”‚
â”‚  â”œâ”€â”€ JWT ì„œëª… í‚¤:    30ì¼ë§ˆë‹¤                                         â”‚
â”‚  â””â”€â”€ ì•”í˜¸í™” í‚¤:      365ì¼ë§ˆë‹¤ (ì¬ì•”í˜¸í™” ê³„íš í¬í•¨)                     â”‚
â”‚                                                                      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
</code></pre></div>

<h3 id="32">3.2 ë‹¤ìš´íƒ€ì„ ì—†ëŠ” êµì²´ íŒ¨í„´<a class="header-link" href="#32" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code>â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚               ë‹¤ìš´íƒ€ì„ ì—†ëŠ” Secret êµì²´                               â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                      â”‚
â”‚  ë‹¨ê³„ 1: ìƒˆ secret ìƒì„± (ì´ì „ ê²ƒì€ í™œì„± ìœ ì§€)                          â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                                       â”‚
â”‚  â”‚ Secret A â”‚ â† í˜„ì¬ (í™œì„±)                                         â”‚
â”‚  â”‚ Secret B â”‚ â† ìƒˆê²ƒ (í™œì„±)                                         â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                                       â”‚
â”‚  ë‘ secretsê°€ ë™ì‹œì— ìœ íš¨í•¨                                           â”‚
â”‚                                                                      â”‚
â”‚  ë‹¨ê³„ 2: ëª¨ë“  ì†Œë¹„ìë¥¼ ìƒˆ secret ì‚¬ìš©ìœ¼ë¡œ ì—…ë°ì´íŠ¸                      â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                                       â”‚
â”‚  â”‚ Secret A â”‚ â† ì´ì „ ê²ƒ (ìœ ì˜ˆ ê¸°ê°„ ë™ì•ˆ ì—¬ì „íˆ í™œì„±)                  â”‚
â”‚  â”‚ Secret B â”‚ â† ëª¨ë“  ì„œë¹„ìŠ¤ê°€ ì´ì œ ì´ê²ƒì„ ì‚¬ìš©                        â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                                       â”‚
â”‚                                                                      â”‚
â”‚  ë‹¨ê³„ 3: ìœ ì˜ˆ ê¸°ê°„ í›„ ì´ì „ secret íê¸°                                 â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                                       â”‚
â”‚  â”‚ Secret A â”‚ â† íê¸°ë¨                                               â”‚
â”‚  â”‚ Secret B â”‚ â† ìœ ì¼í•œ í™œì„± secret                                   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                                       â”‚
â”‚                                                                      â”‚
â”‚  ì´ ì´ì¤‘ secret ê¸°ê°„ì€ êµì²´ ì¤‘ ë‹¤ìš´íƒ€ì„ì„ ë°©ì§€í•©ë‹ˆë‹¤.                   â”‚
â”‚                                                                      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
</code></pre></div>

<div class="highlight"><pre><span></span><code><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">JWT ì„œëª… í‚¤ì— ëŒ€í•œ ë‹¤ìš´íƒ€ì„ ì—†ëŠ” secret êµì²´ êµ¬í˜„.</span>
<span class="sd">&quot;&quot;&quot;</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">jwt</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">time</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">datetime</span><span class="w"> </span><span class="kn">import</span> <span class="n">datetime</span><span class="p">,</span> <span class="n">timedelta</span><span class="p">,</span> <span class="n">timezone</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">dataclasses</span><span class="w"> </span><span class="kn">import</span> <span class="n">dataclass</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">typing</span><span class="w"> </span><span class="kn">import</span> <span class="n">Optional</span>

<span class="nd">@dataclass</span>
<span class="k">class</span><span class="w"> </span><span class="nc">SigningKey</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;ë©”íƒ€ë°ì´í„°ë¥¼ ê°€ì§„ JWT ì„œëª… í‚¤.&quot;&quot;&quot;</span>
    <span class="n">key_id</span><span class="p">:</span> <span class="nb">str</span>
    <span class="n">secret</span><span class="p">:</span> <span class="nb">str</span>
    <span class="n">created_at</span><span class="p">:</span> <span class="n">datetime</span>
    <span class="n">expires_at</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">datetime</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="n">revoked</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span>


<span class="k">class</span><span class="w"> </span><span class="nc">KeyRotationManager</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;ë‹¤ìš´íƒ€ì„ ì—†ì´ JWT ì„œëª… í‚¤ êµì²´ë¥¼ ê´€ë¦¬.&quot;&quot;&quot;</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">rotation_interval_days</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">30</span><span class="p">,</span>
                 <span class="n">grace_period_days</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">7</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">rotation_interval</span> <span class="o">=</span> <span class="n">timedelta</span><span class="p">(</span><span class="n">days</span><span class="o">=</span><span class="n">rotation_interval_days</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">grace_period</span> <span class="o">=</span> <span class="n">timedelta</span><span class="p">(</span><span class="n">days</span><span class="o">=</span><span class="n">grace_period_days</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">keys</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="n">SigningKey</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_generate_new_key</span><span class="p">()</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_generate_new_key</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">SigningKey</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;ìƒˆ ì„œëª… í‚¤ ìƒì„±.&quot;&quot;&quot;</span>
        <span class="kn">import</span><span class="w"> </span><span class="nn">secrets</span>
        <span class="n">now</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">(</span><span class="n">timezone</span><span class="o">.</span><span class="n">utc</span><span class="p">)</span>
        <span class="n">key</span> <span class="o">=</span> <span class="n">SigningKey</span><span class="p">(</span>
            <span class="n">key_id</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;key_</span><span class="si">{</span><span class="n">secrets</span><span class="o">.</span><span class="n">token_hex</span><span class="p">(</span><span class="mi">8</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
            <span class="n">secret</span><span class="o">=</span><span class="n">secrets</span><span class="o">.</span><span class="n">token_hex</span><span class="p">(</span><span class="mi">32</span><span class="p">),</span>
            <span class="n">created_at</span><span class="o">=</span><span class="n">now</span><span class="p">,</span>
            <span class="n">expires_at</span><span class="o">=</span><span class="n">now</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">rotation_interval</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">grace_period</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">keys</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">key</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">key</span>

    <span class="nd">@property</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">current_key</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">SigningKey</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;í˜„ì¬(ê°€ì¥ ìƒˆë¡œìš´) íê¸°ë˜ì§€ ì•Šì€ ì„œëª… í‚¤ ê°€ì ¸ì˜¤ê¸°.&quot;&quot;&quot;</span>
        <span class="n">active_keys</span> <span class="o">=</span> <span class="p">[</span><span class="n">k</span> <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">keys</span> <span class="k">if</span> <span class="ow">not</span> <span class="n">k</span><span class="o">.</span><span class="n">revoked</span><span class="p">]</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">active_keys</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_generate_new_key</span><span class="p">()</span>
        <span class="k">return</span> <span class="n">active_keys</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>  <span class="c1"># ê°€ì¥ ìµœê·¼ì— ìƒì„±ë¨</span>

    <span class="nd">@property</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">valid_keys</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">[</span><span class="n">SigningKey</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;ëª¨ë“  ìœ íš¨í•œ(íê¸°ë˜ì§€ ì•Šê³  ë§Œë£Œë˜ì§€ ì•Šì€) í‚¤ ê°€ì ¸ì˜¤ê¸°.&quot;&quot;&quot;</span>
        <span class="n">now</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">(</span><span class="n">timezone</span><span class="o">.</span><span class="n">utc</span><span class="p">)</span>
        <span class="k">return</span> <span class="p">[</span>
            <span class="n">k</span> <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">keys</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">k</span><span class="o">.</span><span class="n">revoked</span> <span class="ow">and</span> <span class="p">(</span><span class="n">k</span><span class="o">.</span><span class="n">expires_at</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">or</span> <span class="n">k</span><span class="o">.</span><span class="n">expires_at</span> <span class="o">&gt;</span> <span class="n">now</span><span class="p">)</span>
        <span class="p">]</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">rotate</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">SigningKey</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;ìƒˆ ì„œëª… í‚¤ë¡œ êµì²´.&quot;&quot;&quot;</span>
        <span class="c1"># ìƒˆ í‚¤ ìƒì„±</span>
        <span class="n">new_key</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_generate_new_key</span><span class="p">()</span>

        <span class="c1"># ì´ì „ í‚¤ëŠ” ë§Œë£Œë  ë•Œê¹Œì§€ ìœ íš¨ ìœ ì§€(ìœ ì˜ˆ ê¸°ê°„)</span>
        <span class="c1"># ì´ë¥¼ í†µí•´ ì´ì „ í‚¤ë¡œ ì„œëª…ëœ ê¸°ì¡´ í† í°ì´ ìœ íš¨í•˜ê²Œ ìœ ì§€ë¨</span>

        <span class="c1"># ë§Œë£Œë˜ê³  íê¸°ëœ í‚¤ ì •ë¦¬</span>
        <span class="n">now</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">(</span><span class="n">timezone</span><span class="o">.</span><span class="n">utc</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">keys</span> <span class="o">=</span> <span class="p">[</span>
            <span class="n">k</span> <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">keys</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">k</span><span class="o">.</span><span class="n">revoked</span> <span class="ow">and</span> <span class="p">(</span><span class="n">k</span><span class="o">.</span><span class="n">expires_at</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">or</span> <span class="n">k</span><span class="o">.</span><span class="n">expires_at</span> <span class="o">&gt;</span> <span class="n">now</span><span class="p">)</span>
        <span class="p">]</span>

        <span class="k">return</span> <span class="n">new_key</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">sign_token</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">payload</span><span class="p">:</span> <span class="nb">dict</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;í˜„ì¬ í‚¤ë¡œ JWT ì„œëª….&quot;&quot;&quot;</span>
        <span class="n">key</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">current_key</span>
        <span class="n">headers</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;kid&quot;</span><span class="p">:</span> <span class="n">key</span><span class="o">.</span><span class="n">key_id</span><span class="p">}</span>
        <span class="k">return</span> <span class="n">jwt</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span><span class="n">payload</span><span class="p">,</span> <span class="n">key</span><span class="o">.</span><span class="n">secret</span><span class="p">,</span> <span class="n">algorithm</span><span class="o">=</span><span class="s2">&quot;HS256&quot;</span><span class="p">,</span>
                         <span class="n">headers</span><span class="o">=</span><span class="n">headers</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">verify_token</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">token</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;ëª¨ë“  ìœ íš¨í•œ í‚¤ë¥¼ ì‹œë„í•˜ì—¬ JWT ê²€ì¦.&quot;&quot;&quot;</span>
        <span class="c1"># ë¨¼ì € í—¤ë”ì—ì„œ kid ê°€ì ¸ì˜¤ê¸° ì‹œë„</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">unverified_header</span> <span class="o">=</span> <span class="n">jwt</span><span class="o">.</span><span class="n">get_unverified_header</span><span class="p">(</span><span class="n">token</span><span class="p">)</span>
            <span class="n">kid</span> <span class="o">=</span> <span class="n">unverified_header</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;kid&quot;</span><span class="p">)</span>
        <span class="k">except</span> <span class="n">jwt</span><span class="o">.</span><span class="n">DecodeError</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Invalid token format&quot;</span><span class="p">)</span>

        <span class="c1"># kidê°€ ìˆìœ¼ë©´ íŠ¹ì • í‚¤ ì°¾ê¸°</span>
        <span class="k">if</span> <span class="n">kid</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">valid_keys</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">key</span><span class="o">.</span><span class="n">key_id</span> <span class="o">==</span> <span class="n">kid</span><span class="p">:</span>
                    <span class="k">return</span> <span class="n">jwt</span><span class="o">.</span><span class="n">decode</span><span class="p">(</span><span class="n">token</span><span class="p">,</span> <span class="n">key</span><span class="o">.</span><span class="n">secret</span><span class="p">,</span>
                                     <span class="n">algorithms</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;HS256&quot;</span><span class="p">])</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Unknown key ID: </span><span class="si">{</span><span class="n">kid</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

        <span class="c1"># í´ë°±: ëª¨ë“  ìœ íš¨í•œ í‚¤ ì‹œë„(kidê°€ ì—†ëŠ” í† í°ìš©)</span>
        <span class="n">errors</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">valid_keys</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">jwt</span><span class="o">.</span><span class="n">decode</span><span class="p">(</span><span class="n">token</span><span class="p">,</span> <span class="n">key</span><span class="o">.</span><span class="n">secret</span><span class="p">,</span>
                                 <span class="n">algorithms</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;HS256&quot;</span><span class="p">])</span>
            <span class="k">except</span> <span class="n">jwt</span><span class="o">.</span><span class="n">InvalidSignatureError</span><span class="p">:</span>
                <span class="n">errors</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Key </span><span class="si">{</span><span class="n">key</span><span class="o">.</span><span class="n">key_id</span><span class="si">}</span><span class="s2">: signature mismatch&quot;</span><span class="p">)</span>
                <span class="k">continue</span>

        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Token verification failed with all keys&quot;</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">should_rotate</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;í˜„ì¬ í‚¤ë¥¼ êµì²´í•´ì•¼ í•˜ëŠ”ì§€ í™•ì¸.&quot;&quot;&quot;</span>
        <span class="n">key</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">current_key</span>
        <span class="n">age</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">(</span><span class="n">timezone</span><span class="o">.</span><span class="n">utc</span><span class="p">)</span> <span class="o">-</span> <span class="n">key</span><span class="o">.</span><span class="n">created_at</span>
        <span class="k">return</span> <span class="n">age</span> <span class="o">&gt;=</span> <span class="bp">self</span><span class="o">.</span><span class="n">rotation_interval</span>


<span class="c1"># â”€â”€ ì‚¬ìš©ë²• â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€</span>
<span class="n">manager</span> <span class="o">=</span> <span class="n">KeyRotationManager</span><span class="p">(</span>
    <span class="n">rotation_interval_days</span><span class="o">=</span><span class="mi">30</span><span class="p">,</span>
    <span class="n">grace_period_days</span><span class="o">=</span><span class="mi">7</span><span class="p">,</span>
<span class="p">)</span>

<span class="c1"># í† í° ì„œëª…</span>
<span class="n">token</span> <span class="o">=</span> <span class="n">manager</span><span class="o">.</span><span class="n">sign_token</span><span class="p">({</span><span class="s2">&quot;sub&quot;</span><span class="p">:</span> <span class="s2">&quot;user_123&quot;</span><span class="p">,</span> <span class="s2">&quot;role&quot;</span><span class="p">:</span> <span class="s2">&quot;admin&quot;</span><span class="p">})</span>

<span class="c1"># ë‚˜ì¤‘ì— í† í° ê²€ì¦ (êµì²´ í›„ì—ë„ ì‘ë™)</span>
<span class="n">payload</span> <span class="o">=</span> <span class="n">manager</span><span class="o">.</span><span class="n">verify_token</span><span class="p">(</span><span class="n">token</span><span class="p">)</span>

<span class="c1"># ì£¼ê¸°ì  êµì²´ (ì˜ˆì•½ëœ ì‘ì—…ì—ì„œ í˜¸ì¶œ)</span>
<span class="k">if</span> <span class="n">manager</span><span class="o">.</span><span class="n">should_rotate</span><span class="p">():</span>
    <span class="n">new_key</span> <span class="o">=</span> <span class="n">manager</span><span class="o">.</span><span class="n">rotate</span><span class="p">()</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Rotated to new key: </span><span class="si">{</span><span class="n">new_key</span><span class="o">.</span><span class="n">key_id</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</code></pre></div>

<h3 id="33">3.3 ë°ì´í„°ë² ì´ìŠ¤ ë¹„ë°€ë²ˆí˜¸ êµì²´<a class="header-link" href="#33" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">ë°ì´í„°ë² ì´ìŠ¤ ë¹„ë°€ë²ˆí˜¸ êµì²´ ì „ëµ.</span>
<span class="sd">&quot;&quot;&quot;</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">psycopg2</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">secrets</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">logging</span>

<span class="n">logger</span> <span class="o">=</span> <span class="n">logging</span><span class="o">.</span><span class="n">getLogger</span><span class="p">(</span><span class="s1">&#39;secret_rotation&#39;</span><span class="p">)</span>


<span class="k">class</span><span class="w"> </span><span class="nc">DatabasePasswordRotator</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;ë‹¤ìš´íƒ€ì„ ì—†ì´ ë°ì´í„°ë² ì´ìŠ¤ ë¹„ë°€ë²ˆí˜¸ êµì²´.&quot;&quot;&quot;</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">admin_conn_string</span><span class="p">:</span> <span class="nb">str</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">admin_conn_string</span> <span class="o">=</span> <span class="n">admin_conn_string</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">rotate_password</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">username</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;ë°ì´í„°ë² ì´ìŠ¤ ì‚¬ìš©ìì˜ ë¹„ë°€ë²ˆí˜¸ êµì²´.</span>

<span class="sd">        ì „ëµ:</span>
<span class="sd">        1. ìƒˆ ë¹„ë°€ë²ˆí˜¸ ìƒì„±</span>
<span class="sd">        2. ë°ì´í„°ë² ì´ìŠ¤ì—ì„œ ë¹„ë°€ë²ˆí˜¸ ì—…ë°ì´íŠ¸</span>
<span class="sd">        3. ì• í”Œë¦¬ì¼€ì´ì…˜ êµ¬ì„± ì—…ë°ì´íŠ¸</span>
<span class="sd">        4. ìƒˆ ë¹„ë°€ë²ˆí˜¸ë¡œ ì—°ê²° í™•ì¸</span>
<span class="sd">        5. ê²€ì¦ ì‹¤íŒ¨ ì‹œ ë¡¤ë°±</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">new_password</span> <span class="o">=</span> <span class="n">secrets</span><span class="o">.</span><span class="n">token_urlsafe</span><span class="p">(</span><span class="mi">32</span><span class="p">)</span>

        <span class="n">conn</span> <span class="o">=</span> <span class="n">psycopg2</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">admin_conn_string</span><span class="p">)</span>
        <span class="n">conn</span><span class="o">.</span><span class="n">autocommit</span> <span class="o">=</span> <span class="kc">True</span>

        <span class="k">try</span><span class="p">:</span>
            <span class="k">with</span> <span class="n">conn</span><span class="o">.</span><span class="n">cursor</span><span class="p">()</span> <span class="k">as</span> <span class="n">cur</span><span class="p">:</span>
                <span class="c1"># ë‹¨ê³„ 1: ë¹„ë°€ë²ˆí˜¸ ë³€ê²½</span>
                <span class="c1"># format()ì„ ì£¼ì˜í•´ì„œ ì‚¬ìš© â€” ì´ê²ƒì€ DDL ëª…ë ¹ì´ë¯€ë¡œ</span>
                <span class="c1"># ë§¤ê°œë³€ìˆ˜í™”ëœ ì¿¼ë¦¬ë¥¼ ì‚¬ìš©í•  ìˆ˜ ì—†ìŒ</span>
                <span class="n">cur</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span>
                    <span class="sa">f</span><span class="s2">&quot;ALTER USER </span><span class="si">{</span><span class="n">username</span><span class="si">}</span><span class="s2"> WITH PASSWORD %s&quot;</span><span class="p">,</span>
                    <span class="p">(</span><span class="n">new_password</span><span class="p">,)</span>
                <span class="p">)</span>
                <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Password rotated for user: </span><span class="si">{</span><span class="n">username</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

            <span class="c1"># ë‹¨ê³„ 2: ìƒˆ ë¹„ë°€ë²ˆí˜¸ê°€ ì‘ë™í•˜ëŠ”ì§€ í™•ì¸</span>
            <span class="n">test_conn_string</span> <span class="o">=</span> <span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;postgresql://</span><span class="si">{</span><span class="n">username</span><span class="si">}</span><span class="s2">:</span><span class="si">{</span><span class="n">new_password</span><span class="si">}</span><span class="s2">&quot;</span>
                <span class="sa">f</span><span class="s2">&quot;@localhost:5432/mydb&quot;</span>
            <span class="p">)</span>
            <span class="n">test_conn</span> <span class="o">=</span> <span class="n">psycopg2</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="n">test_conn_string</span><span class="p">)</span>
            <span class="n">test_conn</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;New password verified for user: </span><span class="si">{</span><span class="n">username</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

            <span class="k">return</span> <span class="n">new_password</span>

        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Password rotation failed: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="k">raise</span>
        <span class="k">finally</span><span class="p">:</span>
            <span class="n">conn</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>


<span class="c1"># â”€â”€ ìŠ¤ì¼€ì¤„ëŸ¬ë¥¼ ì‚¬ìš©í•œ ìë™ êµì²´ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€</span>
<span class="sd">&quot;&quot;&quot;</span>
<span class="sd"># APScheduler ì‚¬ìš©</span>
<span class="sd">from apscheduler.schedulers.blocking import BlockingScheduler</span>

<span class="sd">scheduler = BlockingScheduler()</span>

<span class="sd">@scheduler.scheduled_job(&#39;cron&#39;, day=&#39;1&#39;, hour=&#39;3&#39;)  # ë§¤ì›” 1ì¼ ì˜¤ì „ 3ì‹œ</span>
<span class="sd">def rotate_db_passwords():</span>
<span class="sd">    rotator = DatabasePasswordRotator(admin_conn_string=ADMIN_DB_URL)</span>
<span class="sd">    new_password = rotator.rotate_password(&#39;app_user&#39;)</span>

<span class="sd">    # secret ì €ì¥ì†Œ ì—…ë°ì´íŠ¸ (Vault, AWS Secrets Manager ë“±)</span>
<span class="sd">    update_secret_store(&#39;db_password&#39;, new_password)</span>

<span class="sd">    # ì• í”Œë¦¬ì¼€ì´ì…˜ì— êµ¬ì„± ì¬ë¡œë“œ ì•Œë¦¼</span>
<span class="sd">    notify_config_reload()</span>

<span class="sd">scheduler.start()</span>
<span class="sd">&quot;&quot;&quot;</span>
</code></pre></div>

<hr />
<h2 id="4-hashicorp-vault">4. HashiCorp Vault<a class="header-link" href="#4-hashicorp-vault" title="Permanent link">&para;</a></h2>
<h3 id="41-vault">4.1 Vault ì•„í‚¤í…ì²˜<a class="header-link" href="#41-vault" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code>â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    HashiCorp Vault ì•„í‚¤í…ì²˜                          â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                      â”‚
â”‚                     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                             â”‚
â”‚                     â”‚   Vault Server   â”‚                             â”‚
â”‚                     â”‚                  â”‚                             â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”       â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚       â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”        â”‚
â”‚  â”‚  Client   â”‚â”€â”€â”€â”€â”€â”€â”‚â”€â”€â”‚  Auth      â”‚  â”‚â”€â”€â”€â”€â”€â”€â”€â”‚  Backend â”‚        â”‚
â”‚  â”‚  (App)    â”‚      â”‚  â”‚  Methods   â”‚  â”‚       â”‚  Storage â”‚        â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜       â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤  â”‚       â”‚  (Consul,â”‚        â”‚
â”‚                     â”‚  â”‚  Token     â”‚  â”‚       â”‚   Raft,  â”‚        â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”       â”‚  â”‚  AppRole   â”‚  â”‚       â”‚   File)  â”‚        â”‚
â”‚  â”‚  Client   â”‚â”€â”€â”€â”€â”€â”€â”‚â”€â”€â”‚  LDAP      â”‚  â”‚       â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜        â”‚
â”‚  â”‚  (CI/CD)  â”‚      â”‚  â”‚  K8s       â”‚  â”‚                           â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜       â”‚  â”‚  AWS IAM   â”‚  â”‚       â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”        â”‚
â”‚                     â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚       â”‚  Audit   â”‚        â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”       â”‚                  â”‚â”€â”€â”€â”€â”€â”€â”€â”‚  Log     â”‚        â”‚
â”‚  â”‚  Client   â”‚â”€â”€â”€â”€â”€â”€â”‚â”€â”€â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚       â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜        â”‚
â”‚  â”‚  (Admin)  â”‚      â”‚  â”‚  Secret    â”‚  â”‚                           â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜       â”‚  â”‚  Engines   â”‚  â”‚                           â”‚
â”‚                     â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤  â”‚                           â”‚
â”‚                     â”‚  â”‚  KV v2     â”‚  â”‚  (ì •ì  í‚¤-ê°’)              â”‚
â”‚                     â”‚  â”‚  Database  â”‚  â”‚  (ë™ì  ìê²© ì¦ëª…)          â”‚
â”‚                     â”‚  â”‚  PKI       â”‚  â”‚  (ì¸ì¦ ê¸°ê´€)               â”‚
â”‚                     â”‚  â”‚  Transit   â”‚  â”‚  (ì„œë¹„ìŠ¤ë¡œì„œì˜ ì•”í˜¸í™”)     â”‚
â”‚                     â”‚  â”‚  AWS       â”‚  â”‚  (ë™ì  IAM ìê²© ì¦ëª…)      â”‚
â”‚                     â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚                           â”‚
â”‚                     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                             â”‚
â”‚                                                                      â”‚
â”‚  ì£¼ìš” ê¸°ëŠ¥:                                                           â”‚
â”‚  â€¢ ë™ì  secrets: í•„ìš” ì‹œ ìê²© ì¦ëª… ìƒì„±                                â”‚
â”‚  â€¢ ë¦¬ìŠ¤: secretsì— TTL ì„¤ì •, ìë™ ë§Œë£Œ                                 â”‚
â”‚  â€¢ íê¸°: ì¦‰ì‹œ ëª¨ë“  secret ë˜ëŠ” secret íŠ¸ë¦¬ íê¸°                        â”‚
â”‚  â€¢ ì„œë¹„ìŠ¤ë¡œì„œì˜ ì•”í˜¸í™”: í‚¤ë¥¼ ë³´ì§€ ì•Šê³  ì•”í˜¸í™”/ë³µí˜¸í™”                    â”‚
â”‚  â€¢ ê°ì‚¬ ë¡œê¹…: ëª¨ë“  ì•¡ì„¸ìŠ¤ê°€ ê¸°ë¡ë¨                                     â”‚
â”‚                                                                      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
</code></pre></div>

<h3 id="42-vault">4.2 Vault ë¹ ë¥¸ ì‹œì‘<a class="header-link" href="#42-vault" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><span class="c1"># â”€â”€ Vault ì„¤ì¹˜ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€</span>
<span class="c1"># macOS</span>
brew<span class="w"> </span>install<span class="w"> </span>vault

<span class="c1"># Linux</span>
wget<span class="w"> </span>https://releases.hashicorp.com/vault/1.15.0/vault_1.15.0_linux_amd64.zip
unzip<span class="w"> </span>vault_1.15.0_linux_amd64.zip
sudo<span class="w"> </span>mv<span class="w"> </span>vault<span class="w"> </span>/usr/local/bin/

<span class="c1"># â”€â”€ ê°œë°œ ì„œë²„ ì‹œì‘ (í”„ë¡œë•ì…˜ìš© ì•„ë‹˜) â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€</span>
vault<span class="w"> </span>server<span class="w"> </span>-dev
<span class="c1"># Root í† í°ì´ ì¶œë ¥ë¨ â€” ì €ì¥í•˜ì„¸ìš”</span>
<span class="c1"># export VAULT_ADDR=&#39;http://127.0.0.1:8200&#39;</span>
<span class="c1"># export VAULT_TOKEN=&#39;hvs.xxxxxxxxxxxxx&#39;</span>

<span class="c1"># â”€â”€ KV secrets ì—”ì§„ í™œì„±í™” â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€</span>
vault<span class="w"> </span>secrets<span class="w"> </span><span class="nb">enable</span><span class="w"> </span>-path<span class="o">=</span>secret<span class="w"> </span>kv-v2

<span class="c1"># â”€â”€ secret ì €ì¥ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€</span>
vault<span class="w"> </span>kv<span class="w"> </span>put<span class="w"> </span>secret/myapp/database<span class="w"> </span><span class="se">\</span>
<span class="w">    </span><span class="nv">username</span><span class="o">=</span><span class="s2">&quot;dbuser&quot;</span><span class="w"> </span><span class="se">\</span>
<span class="w">    </span><span class="nv">password</span><span class="o">=</span><span class="s2">&quot;supersecretpassword&quot;</span><span class="w"> </span><span class="se">\</span>
<span class="w">    </span><span class="nv">host</span><span class="o">=</span><span class="s2">&quot;db.example.com&quot;</span><span class="w"> </span><span class="se">\</span>
<span class="w">    </span><span class="nv">port</span><span class="o">=</span><span class="s2">&quot;5432&quot;</span>

<span class="c1"># â”€â”€ secret ì½ê¸° â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€</span>
vault<span class="w"> </span>kv<span class="w"> </span>get<span class="w"> </span>secret/myapp/database
vault<span class="w"> </span>kv<span class="w"> </span>get<span class="w"> </span>-format<span class="o">=</span>json<span class="w"> </span>secret/myapp/database

<span class="c1"># â”€â”€ íŠ¹ì • í•„ë“œ ì½ê¸° â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€</span>
vault<span class="w"> </span>kv<span class="w"> </span>get<span class="w"> </span>-field<span class="o">=</span>password<span class="w"> </span>secret/myapp/database

<span class="c1"># â”€â”€ secrets ëª©ë¡ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€</span>
vault<span class="w"> </span>kv<span class="w"> </span>list<span class="w"> </span>secret/myapp/

<span class="c1"># â”€â”€ secret ì‚­ì œ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€</span>
vault<span class="w"> </span>kv<span class="w"> </span>delete<span class="w"> </span>secret/myapp/database

<span class="c1"># â”€â”€ ë²„ì „ íˆìŠ¤í† ë¦¬ (KV v2) â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€</span>
vault<span class="w"> </span>kv<span class="w"> </span>get<span class="w"> </span>-version<span class="o">=</span><span class="m">1</span><span class="w"> </span>secret/myapp/database
</code></pre></div>

<h3 id="43-python-vault-hvac">4.3 Pythonê³¼ Vault (hvac)<a class="header-link" href="#43-python-vault-hvac" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">Pythonìš© HashiCorp Vault í´ë¼ì´ì–¸íŠ¸.</span>
<span class="sd">pip install hvac</span>
<span class="sd">&quot;&quot;&quot;</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">hvac</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">os</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">typing</span><span class="w"> </span><span class="kn">import</span> <span class="n">Optional</span>


<span class="k">class</span><span class="w"> </span><span class="nc">VaultClient</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;HashiCorp Vault ì‘ì—…ì„ ìœ„í•œ ë˜í¼.&quot;&quot;&quot;</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">url</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">token</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">client</span> <span class="o">=</span> <span class="n">hvac</span><span class="o">.</span><span class="n">Client</span><span class="p">(</span>
            <span class="n">url</span><span class="o">=</span><span class="n">url</span> <span class="ow">or</span> <span class="n">os</span><span class="o">.</span><span class="n">getenv</span><span class="p">(</span><span class="s1">&#39;VAULT_ADDR&#39;</span><span class="p">,</span> <span class="s1">&#39;http://127.0.0.1:8200&#39;</span><span class="p">),</span>
            <span class="n">token</span><span class="o">=</span><span class="n">token</span> <span class="ow">or</span> <span class="n">os</span><span class="o">.</span><span class="n">getenv</span><span class="p">(</span><span class="s1">&#39;VAULT_TOKEN&#39;</span><span class="p">),</span>
        <span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">client</span><span class="o">.</span><span class="n">is_authenticated</span><span class="p">():</span>
            <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="s2">&quot;Vault authentication failed&quot;</span><span class="p">)</span>

    <span class="c1"># â”€â”€ KV Secrets â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">get_secret</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">path</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">mount_point</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s1">&#39;secret&#39;</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;KV v2ì—ì„œ secret ì½ê¸°.&quot;&quot;&quot;</span>
        <span class="n">response</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">client</span><span class="o">.</span><span class="n">secrets</span><span class="o">.</span><span class="n">kv</span><span class="o">.</span><span class="n">v2</span><span class="o">.</span><span class="n">read_secret_version</span><span class="p">(</span>
            <span class="n">path</span><span class="o">=</span><span class="n">path</span><span class="p">,</span>
            <span class="n">mount_point</span><span class="o">=</span><span class="n">mount_point</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="k">return</span> <span class="n">response</span><span class="p">[</span><span class="s1">&#39;data&#39;</span><span class="p">][</span><span class="s1">&#39;data&#39;</span><span class="p">]</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">set_secret</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">path</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">data</span><span class="p">:</span> <span class="nb">dict</span><span class="p">,</span>
                   <span class="n">mount_point</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s1">&#39;secret&#39;</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;KV v2ì— secret ì“°ê¸°.&quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">client</span><span class="o">.</span><span class="n">secrets</span><span class="o">.</span><span class="n">kv</span><span class="o">.</span><span class="n">v2</span><span class="o">.</span><span class="n">create_or_update_secret</span><span class="p">(</span>
            <span class="n">path</span><span class="o">=</span><span class="n">path</span><span class="p">,</span>
            <span class="n">secret</span><span class="o">=</span><span class="n">data</span><span class="p">,</span>
            <span class="n">mount_point</span><span class="o">=</span><span class="n">mount_point</span><span class="p">,</span>
        <span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">delete_secret</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">path</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
                      <span class="n">mount_point</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s1">&#39;secret&#39;</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;secret ì‚­ì œ.&quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">client</span><span class="o">.</span><span class="n">secrets</span><span class="o">.</span><span class="n">kv</span><span class="o">.</span><span class="n">v2</span><span class="o">.</span><span class="n">delete_metadata_and_all_versions</span><span class="p">(</span>
            <span class="n">path</span><span class="o">=</span><span class="n">path</span><span class="p">,</span>
            <span class="n">mount_point</span><span class="o">=</span><span class="n">mount_point</span><span class="p">,</span>
        <span class="p">)</span>

    <span class="c1"># â”€â”€ ë™ì  ë°ì´í„°ë² ì´ìŠ¤ ìê²© ì¦ëª… â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">get_database_creds</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">role</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;ë™ì  ë°ì´í„°ë² ì´ìŠ¤ ìê²© ì¦ëª… ê°€ì ¸ì˜¤ê¸°.&quot;&quot;&quot;</span>
        <span class="n">response</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">client</span><span class="o">.</span><span class="n">secrets</span><span class="o">.</span><span class="n">database</span><span class="o">.</span><span class="n">generate_credentials</span><span class="p">(</span>
            <span class="n">name</span><span class="o">=</span><span class="n">role</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="k">return</span> <span class="p">{</span>
            <span class="s1">&#39;username&#39;</span><span class="p">:</span> <span class="n">response</span><span class="p">[</span><span class="s1">&#39;data&#39;</span><span class="p">][</span><span class="s1">&#39;username&#39;</span><span class="p">],</span>
            <span class="s1">&#39;password&#39;</span><span class="p">:</span> <span class="n">response</span><span class="p">[</span><span class="s1">&#39;data&#39;</span><span class="p">][</span><span class="s1">&#39;password&#39;</span><span class="p">],</span>
            <span class="s1">&#39;lease_id&#39;</span><span class="p">:</span> <span class="n">response</span><span class="p">[</span><span class="s1">&#39;lease_id&#39;</span><span class="p">],</span>
            <span class="s1">&#39;lease_duration&#39;</span><span class="p">:</span> <span class="n">response</span><span class="p">[</span><span class="s1">&#39;lease_duration&#39;</span><span class="p">],</span>
        <span class="p">}</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">revoke_lease</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">lease_id</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;ë™ì  secret ë¦¬ìŠ¤ íê¸°.&quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">client</span><span class="o">.</span><span class="n">sys</span><span class="o">.</span><span class="n">revoke_lease</span><span class="p">(</span><span class="n">lease_id</span><span class="p">)</span>

    <span class="c1"># â”€â”€ Transit ì•”í˜¸í™” â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">encrypt</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">plaintext</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Vault Transit ì—”ì§„ì„ ì‚¬ìš©í•˜ì—¬ ë°ì´í„° ì•”í˜¸í™”.&quot;&quot;&quot;</span>
        <span class="kn">import</span><span class="w"> </span><span class="nn">base64</span>
        <span class="n">b64</span> <span class="o">=</span> <span class="n">base64</span><span class="o">.</span><span class="n">b64encode</span><span class="p">(</span><span class="n">plaintext</span><span class="o">.</span><span class="n">encode</span><span class="p">())</span><span class="o">.</span><span class="n">decode</span><span class="p">()</span>
        <span class="n">response</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">client</span><span class="o">.</span><span class="n">secrets</span><span class="o">.</span><span class="n">transit</span><span class="o">.</span><span class="n">encrypt_data</span><span class="p">(</span>
            <span class="n">name</span><span class="o">=</span><span class="n">key_name</span><span class="p">,</span>
            <span class="n">plaintext</span><span class="o">=</span><span class="n">b64</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="k">return</span> <span class="n">response</span><span class="p">[</span><span class="s1">&#39;data&#39;</span><span class="p">][</span><span class="s1">&#39;ciphertext&#39;</span><span class="p">]</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">decrypt</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">ciphertext</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Vault Transit ì—”ì§„ì„ ì‚¬ìš©í•˜ì—¬ ë°ì´í„° ë³µí˜¸í™”.&quot;&quot;&quot;</span>
        <span class="kn">import</span><span class="w"> </span><span class="nn">base64</span>
        <span class="n">response</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">client</span><span class="o">.</span><span class="n">secrets</span><span class="o">.</span><span class="n">transit</span><span class="o">.</span><span class="n">decrypt_data</span><span class="p">(</span>
            <span class="n">name</span><span class="o">=</span><span class="n">key_name</span><span class="p">,</span>
            <span class="n">ciphertext</span><span class="o">=</span><span class="n">ciphertext</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="k">return</span> <span class="n">base64</span><span class="o">.</span><span class="n">b64decode</span><span class="p">(</span><span class="n">response</span><span class="p">[</span><span class="s1">&#39;data&#39;</span><span class="p">][</span><span class="s1">&#39;plaintext&#39;</span><span class="p">])</span><span class="o">.</span><span class="n">decode</span><span class="p">()</span>


<span class="c1"># â”€â”€ ì‚¬ìš©ë²• â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€</span>
<span class="n">vault</span> <span class="o">=</span> <span class="n">VaultClient</span><span class="p">()</span>

<span class="c1"># secret ì €ì¥</span>
<span class="n">vault</span><span class="o">.</span><span class="n">set_secret</span><span class="p">(</span><span class="s1">&#39;myapp/database&#39;</span><span class="p">,</span> <span class="p">{</span>
    <span class="s1">&#39;username&#39;</span><span class="p">:</span> <span class="s1">&#39;dbuser&#39;</span><span class="p">,</span>
    <span class="s1">&#39;password&#39;</span><span class="p">:</span> <span class="s1">&#39;supersecret&#39;</span><span class="p">,</span>
    <span class="s1">&#39;host&#39;</span><span class="p">:</span> <span class="s1">&#39;db.example.com&#39;</span><span class="p">,</span>
<span class="p">})</span>

<span class="c1"># secret ì½ê¸°</span>
<span class="n">db_config</span> <span class="o">=</span> <span class="n">vault</span><span class="o">.</span><span class="n">get_secret</span><span class="p">(</span><span class="s1">&#39;myapp/database&#39;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Connecting to </span><span class="si">{</span><span class="n">db_config</span><span class="p">[</span><span class="s1">&#39;host&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2"> as </span><span class="si">{</span><span class="n">db_config</span><span class="p">[</span><span class="s1">&#39;username&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

<span class="c1"># ë™ì  ë°ì´í„°ë² ì´ìŠ¤ ìê²© ì¦ëª… ê°€ì ¸ì˜¤ê¸° (ìë™ ë§Œë£Œ)</span>
<span class="n">creds</span> <span class="o">=</span> <span class="n">vault</span><span class="o">.</span><span class="n">get_database_creds</span><span class="p">(</span><span class="s1">&#39;readonly&#39;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Temporary user: </span><span class="si">{</span><span class="n">creds</span><span class="p">[</span><span class="s1">&#39;username&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Expires in: </span><span class="si">{</span><span class="n">creds</span><span class="p">[</span><span class="s1">&#39;lease_duration&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2"> seconds&quot;</span><span class="p">)</span>

<span class="c1"># ë¯¼ê°í•œ ë°ì´í„° ì•”í˜¸í™”</span>
<span class="n">ciphertext</span> <span class="o">=</span> <span class="n">vault</span><span class="o">.</span><span class="n">encrypt</span><span class="p">(</span><span class="s1">&#39;my-key&#39;</span><span class="p">,</span> <span class="s1">&#39;Social Security: 123-45-6789&#39;</span><span class="p">)</span>
<span class="c1"># ciphertext: vault:v1:8SDd3WHDOjf7mq69CyCqYjBXAiQQAVZRkFM13ok481zVCKqkLQ==</span>

<span class="c1"># ë³µí˜¸í™”</span>
<span class="n">plaintext</span> <span class="o">=</span> <span class="n">vault</span><span class="o">.</span><span class="n">decrypt</span><span class="p">(</span><span class="s1">&#39;my-key&#39;</span><span class="p">,</span> <span class="n">ciphertext</span><span class="p">)</span>
<span class="c1"># plaintext: Social Security: 123-45-6789</span>
</code></pre></div>

<h3 id="44-vault-approle">4.4 Vault AppRole ì¸ì¦<a class="header-link" href="#44-vault-approle" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">ì• í”Œë¦¬ì¼€ì´ì…˜ìš©(ì‚¬ëŒì´ ì•„ë‹Œ) Vault AppRole ì¸ì¦.</span>
<span class="sd">&quot;&quot;&quot;</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">hvac</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">os</span>


<span class="k">def</span><span class="w"> </span><span class="nf">authenticate_with_approle</span><span class="p">(</span><span class="n">vault_addr</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">role_id</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
                               <span class="n">secret_id</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">hvac</span><span class="o">.</span><span class="n">Client</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;AppRole ë°©ë²•ì„ ì‚¬ìš©í•˜ì—¬ Vaultì— ì¸ì¦.</span>

<span class="sd">    AppRoleì€ ë¨¸ì‹  ê°„ ì¸ì¦ì„ ìœ„í•´ ì„¤ê³„ë¨.</span>
<span class="sd">    role_id = ì‚¬ìš©ì ì´ë¦„ê³¼ ê°™ìŒ (ì•ˆì •ì , Vaultì—ì„œ êµ¬ì„±ë¨)</span>
<span class="sd">    secret_id = ë¹„ë°€ë²ˆí˜¸ì™€ ê°™ìŒ (êµì²´ ê°€ëŠ¥, ë‹¨ê¸°ê°„)</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">client</span> <span class="o">=</span> <span class="n">hvac</span><span class="o">.</span><span class="n">Client</span><span class="p">(</span><span class="n">url</span><span class="o">=</span><span class="n">vault_addr</span><span class="p">)</span>

    <span class="c1"># AppRoleë¡œ ë¡œê·¸ì¸</span>
    <span class="n">response</span> <span class="o">=</span> <span class="n">client</span><span class="o">.</span><span class="n">auth</span><span class="o">.</span><span class="n">approle</span><span class="o">.</span><span class="n">login</span><span class="p">(</span>
        <span class="n">role_id</span><span class="o">=</span><span class="n">role_id</span><span class="p">,</span>
        <span class="n">secret_id</span><span class="o">=</span><span class="n">secret_id</span><span class="p">,</span>
    <span class="p">)</span>

    <span class="c1"># í´ë¼ì´ì–¸íŠ¸ê°€ ì´ì œ ì¸ì¦ë¨</span>
    <span class="n">client</span><span class="o">.</span><span class="n">token</span> <span class="o">=</span> <span class="n">response</span><span class="p">[</span><span class="s1">&#39;auth&#39;</span><span class="p">][</span><span class="s1">&#39;client_token&#39;</span><span class="p">]</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Authenticated. Token TTL: </span><span class="si">{</span><span class="n">response</span><span class="p">[</span><span class="s1">&#39;auth&#39;</span><span class="p">][</span><span class="s1">&#39;lease_duration&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">s&quot;</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">client</span>


<span class="c1"># â”€â”€ í”„ë¡œë•ì…˜ì—ì„œëŠ” secret_idê°€ ì˜¤ì¼€ìŠ¤íŠ¸ë ˆì´í„°ì— ì˜í•´ ì£¼ì…ë¨ â”€â”€â”€â”€</span>
<span class="c1"># Kubernetes: íŒŒì¼ë¡œ ë§ˆìš´íŠ¸ë¨</span>
<span class="c1"># Docker: í™˜ê²½ ë³€ìˆ˜ë¡œ ì „ë‹¬ë¨</span>
<span class="c1"># CI/CD: íŒŒì´í”„ë¼ì¸ secretsì— ì €ì¥ë¨</span>

<span class="n">vault</span> <span class="o">=</span> <span class="n">authenticate_with_approle</span><span class="p">(</span>
    <span class="n">vault_addr</span><span class="o">=</span><span class="n">os</span><span class="o">.</span><span class="n">getenv</span><span class="p">(</span><span class="s1">&#39;VAULT_ADDR&#39;</span><span class="p">),</span>
    <span class="n">role_id</span><span class="o">=</span><span class="n">os</span><span class="o">.</span><span class="n">getenv</span><span class="p">(</span><span class="s1">&#39;VAULT_ROLE_ID&#39;</span><span class="p">),</span>
    <span class="n">secret_id</span><span class="o">=</span><span class="n">os</span><span class="o">.</span><span class="n">getenv</span><span class="p">(</span><span class="s1">&#39;VAULT_SECRET_ID&#39;</span><span class="p">),</span>  <span class="c1"># ë‹¨ê¸°ê°„</span>
<span class="p">)</span>

<span class="c1"># ì´ì œ vaultë¥¼ ì‚¬ìš©í•˜ì—¬ ì• í”Œë¦¬ì¼€ì´ì…˜ secrets ê°€ì ¸ì˜¤ê¸°</span>
<span class="n">secrets</span> <span class="o">=</span> <span class="n">vault</span><span class="o">.</span><span class="n">secrets</span><span class="o">.</span><span class="n">kv</span><span class="o">.</span><span class="n">v2</span><span class="o">.</span><span class="n">read_secret_version</span><span class="p">(</span><span class="n">path</span><span class="o">=</span><span class="s1">&#39;myapp/config&#39;</span><span class="p">)</span>
</code></pre></div>

<hr />
<h2 id="5-secret">5. í´ë¼ìš°ë“œ Secret ê´€ë¦¬ì<a class="header-link" href="#5-secret" title="Permanent link">&para;</a></h2>
<h3 id="51-aws-secrets-manager">5.1 AWS Secrets Manager<a class="header-link" href="#51-aws-secrets-manager" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">AWS Secrets Manager í´ë¼ì´ì–¸íŠ¸.</span>
<span class="sd">pip install boto3</span>
<span class="sd">&quot;&quot;&quot;</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">boto3</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">json</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">botocore.exceptions</span><span class="w"> </span><span class="kn">import</span> <span class="n">ClientError</span>


<span class="k">class</span><span class="w"> </span><span class="nc">AWSSecretsManager</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;AWS Secrets Manager ì¸í„°í˜ì´ìŠ¤.&quot;&quot;&quot;</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">region</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s1">&#39;us-east-1&#39;</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">client</span> <span class="o">=</span> <span class="n">boto3</span><span class="o">.</span><span class="n">client</span><span class="p">(</span>
            <span class="s1">&#39;secretsmanager&#39;</span><span class="p">,</span>
            <span class="n">region_name</span><span class="o">=</span><span class="n">region</span><span class="p">,</span>
        <span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">get_secret</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">secret_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;secret ê°’ ê°€ì ¸ì˜¤ê¸°.&quot;&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">response</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">client</span><span class="o">.</span><span class="n">get_secret_value</span><span class="p">(</span>
                <span class="n">SecretId</span><span class="o">=</span><span class="n">secret_name</span><span class="p">,</span>
            <span class="p">)</span>
            <span class="c1"># SecretsëŠ” ë¬¸ìì—´ ë˜ëŠ” ë°”ì´ë„ˆë¦¬ì¼ ìˆ˜ ìˆìŒ</span>
            <span class="k">if</span> <span class="s1">&#39;SecretString&#39;</span> <span class="ow">in</span> <span class="n">response</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">json</span><span class="o">.</span><span class="n">loads</span><span class="p">(</span><span class="n">response</span><span class="p">[</span><span class="s1">&#39;SecretString&#39;</span><span class="p">])</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="kn">import</span><span class="w"> </span><span class="nn">base64</span>
                <span class="k">return</span> <span class="n">json</span><span class="o">.</span><span class="n">loads</span><span class="p">(</span>
                    <span class="n">base64</span><span class="o">.</span><span class="n">b64decode</span><span class="p">(</span><span class="n">response</span><span class="p">[</span><span class="s1">&#39;SecretBinary&#39;</span><span class="p">])</span>
                <span class="p">)</span>
        <span class="k">except</span> <span class="n">ClientError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="n">error_code</span> <span class="o">=</span> <span class="n">e</span><span class="o">.</span><span class="n">response</span><span class="p">[</span><span class="s1">&#39;Error&#39;</span><span class="p">][</span><span class="s1">&#39;Code&#39;</span><span class="p">]</span>
            <span class="k">if</span> <span class="n">error_code</span> <span class="o">==</span> <span class="s1">&#39;ResourceNotFoundException&#39;</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">KeyError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Secret not found: </span><span class="si">{</span><span class="n">secret_name</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="k">elif</span> <span class="n">error_code</span> <span class="o">==</span> <span class="s1">&#39;AccessDeniedException&#39;</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">PermissionError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Access denied to: </span><span class="si">{</span><span class="n">secret_name</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="k">raise</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">create_secret</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">value</span><span class="p">:</span> <span class="nb">dict</span><span class="p">,</span>
                      <span class="n">description</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;ìƒˆ secret ìƒì„±.&quot;&quot;&quot;</span>
        <span class="n">response</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">client</span><span class="o">.</span><span class="n">create_secret</span><span class="p">(</span>
            <span class="n">Name</span><span class="o">=</span><span class="n">name</span><span class="p">,</span>
            <span class="n">Description</span><span class="o">=</span><span class="n">description</span><span class="p">,</span>
            <span class="n">SecretString</span><span class="o">=</span><span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="n">value</span><span class="p">),</span>
        <span class="p">)</span>
        <span class="k">return</span> <span class="n">response</span><span class="p">[</span><span class="s1">&#39;ARN&#39;</span><span class="p">]</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">update_secret</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">value</span><span class="p">:</span> <span class="nb">dict</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;ê¸°ì¡´ secret ì—…ë°ì´íŠ¸.&quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">client</span><span class="o">.</span><span class="n">update_secret</span><span class="p">(</span>
            <span class="n">SecretId</span><span class="o">=</span><span class="n">name</span><span class="p">,</span>
            <span class="n">SecretString</span><span class="o">=</span><span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="n">value</span><span class="p">),</span>
        <span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">rotate_secret</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">rotation_lambda_arn</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
                      <span class="n">rotation_days</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">30</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;secretì˜ ìë™ êµì²´ í™œì„±í™”.&quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">client</span><span class="o">.</span><span class="n">rotate_secret</span><span class="p">(</span>
            <span class="n">SecretId</span><span class="o">=</span><span class="n">name</span><span class="p">,</span>
            <span class="n">RotationLambdaARN</span><span class="o">=</span><span class="n">rotation_lambda_arn</span><span class="p">,</span>
            <span class="n">RotationRules</span><span class="o">=</span><span class="p">{</span>
                <span class="s1">&#39;AutomaticallyAfterDays&#39;</span><span class="p">:</span> <span class="n">rotation_days</span><span class="p">,</span>
            <span class="p">},</span>
        <span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">delete_secret</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
                      <span class="n">recovery_days</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">30</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;ë³µêµ¬ ê¸°ê°„ì´ ìˆëŠ” secret ì‚­ì œ.&quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">client</span><span class="o">.</span><span class="n">delete_secret</span><span class="p">(</span>
            <span class="n">SecretId</span><span class="o">=</span><span class="n">name</span><span class="p">,</span>
            <span class="n">RecoveryWindowInDays</span><span class="o">=</span><span class="n">recovery_days</span><span class="p">,</span>
        <span class="p">)</span>


<span class="c1"># â”€â”€ ì‚¬ìš©ë²• â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€</span>
<span class="n">sm</span> <span class="o">=</span> <span class="n">AWSSecretsManager</span><span class="p">(</span><span class="n">region</span><span class="o">=</span><span class="s1">&#39;us-east-1&#39;</span><span class="p">)</span>

<span class="c1"># ë°ì´í„°ë² ì´ìŠ¤ ìê²© ì¦ëª… ì €ì¥</span>
<span class="n">sm</span><span class="o">.</span><span class="n">create_secret</span><span class="p">(</span>
    <span class="n">name</span><span class="o">=</span><span class="s1">&#39;prod/myapp/database&#39;</span><span class="p">,</span>
    <span class="n">value</span><span class="o">=</span><span class="p">{</span>
        <span class="s1">&#39;engine&#39;</span><span class="p">:</span> <span class="s1">&#39;postgresql&#39;</span><span class="p">,</span>
        <span class="s1">&#39;host&#39;</span><span class="p">:</span> <span class="s1">&#39;db.example.com&#39;</span><span class="p">,</span>
        <span class="s1">&#39;port&#39;</span><span class="p">:</span> <span class="mi">5432</span><span class="p">,</span>
        <span class="s1">&#39;username&#39;</span><span class="p">:</span> <span class="s1">&#39;app_user&#39;</span><span class="p">,</span>
        <span class="s1">&#39;password&#39;</span><span class="p">:</span> <span class="s1">&#39;strong_password_here&#39;</span><span class="p">,</span>
        <span class="s1">&#39;dbname&#39;</span><span class="p">:</span> <span class="s1">&#39;production&#39;</span><span class="p">,</span>
    <span class="p">},</span>
    <span class="n">description</span><span class="o">=</span><span class="s1">&#39;Production database credentials&#39;</span><span class="p">,</span>
<span class="p">)</span>

<span class="c1"># ê°€ì ¸ì˜¤ê³  ì‚¬ìš©</span>
<span class="n">db_config</span> <span class="o">=</span> <span class="n">sm</span><span class="o">.</span><span class="n">get_secret</span><span class="p">(</span><span class="s1">&#39;prod/myapp/database&#39;</span><span class="p">)</span>
<span class="n">connection_string</span> <span class="o">=</span> <span class="p">(</span>
    <span class="sa">f</span><span class="s2">&quot;postgresql://</span><span class="si">{</span><span class="n">db_config</span><span class="p">[</span><span class="s1">&#39;username&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">:</span><span class="si">{</span><span class="n">db_config</span><span class="p">[</span><span class="s1">&#39;password&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span>
    <span class="sa">f</span><span class="s2">&quot;@</span><span class="si">{</span><span class="n">db_config</span><span class="p">[</span><span class="s1">&#39;host&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">:</span><span class="si">{</span><span class="n">db_config</span><span class="p">[</span><span class="s1">&#39;port&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">/</span><span class="si">{</span><span class="n">db_config</span><span class="p">[</span><span class="s1">&#39;dbname&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span>
<span class="p">)</span>
</code></pre></div>

<h3 id="52-gcp-secret-manager">5.2 GCP Secret Manager<a class="header-link" href="#52-gcp-secret-manager" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">Google Cloud Secret Manager í´ë¼ì´ì–¸íŠ¸.</span>
<span class="sd">pip install google-cloud-secret-manager</span>
<span class="sd">&quot;&quot;&quot;</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">google.cloud</span><span class="w"> </span><span class="kn">import</span> <span class="n">secretmanager</span>


<span class="k">class</span><span class="w"> </span><span class="nc">GCPSecretManager</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;GCP Secret Manager ì¸í„°í˜ì´ìŠ¤.&quot;&quot;&quot;</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">project_id</span><span class="p">:</span> <span class="nb">str</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">client</span> <span class="o">=</span> <span class="n">secretmanager</span><span class="o">.</span><span class="n">SecretManagerServiceClient</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">project_id</span> <span class="o">=</span> <span class="n">project_id</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_secret_path</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">secret_id</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">version</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s1">&#39;latest&#39;</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;ì „ì²´ ë¦¬ì†ŒìŠ¤ ê²½ë¡œ êµ¬ì¶•.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="p">(</span>
            <span class="sa">f</span><span class="s2">&quot;projects/</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">project_id</span><span class="si">}</span><span class="s2">/secrets/</span><span class="si">{</span><span class="n">secret_id</span><span class="si">}</span><span class="s2">&quot;</span>
            <span class="sa">f</span><span class="s2">&quot;/versions/</span><span class="si">{</span><span class="n">version</span><span class="si">}</span><span class="s2">&quot;</span>
        <span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">get_secret</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">secret_id</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
                   <span class="n">version</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s1">&#39;latest&#39;</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;secret ê°’ ê°€ì ¸ì˜¤ê¸°.&quot;&quot;&quot;</span>
        <span class="n">name</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_secret_path</span><span class="p">(</span><span class="n">secret_id</span><span class="p">,</span> <span class="n">version</span><span class="p">)</span>
        <span class="n">response</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">client</span><span class="o">.</span><span class="n">access_secret_version</span><span class="p">(</span>
            <span class="n">request</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;name&quot;</span><span class="p">:</span> <span class="n">name</span><span class="p">}</span>
        <span class="p">)</span>
        <span class="k">return</span> <span class="n">response</span><span class="o">.</span><span class="n">payload</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">decode</span><span class="p">(</span><span class="s1">&#39;UTF-8&#39;</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">create_secret</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">secret_id</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">value</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;ì´ˆê¸° ë²„ì „ìœ¼ë¡œ ìƒˆ secret ìƒì„±.&quot;&quot;&quot;</span>
        <span class="n">parent</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;projects/</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">project_id</span><span class="si">}</span><span class="s2">&quot;</span>

        <span class="c1"># secret ìƒì„±</span>
        <span class="n">secret</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">client</span><span class="o">.</span><span class="n">create_secret</span><span class="p">(</span>
            <span class="n">request</span><span class="o">=</span><span class="p">{</span>
                <span class="s2">&quot;parent&quot;</span><span class="p">:</span> <span class="n">parent</span><span class="p">,</span>
                <span class="s2">&quot;secret_id&quot;</span><span class="p">:</span> <span class="n">secret_id</span><span class="p">,</span>
                <span class="s2">&quot;secret&quot;</span><span class="p">:</span> <span class="p">{</span>
                    <span class="s2">&quot;replication&quot;</span><span class="p">:</span> <span class="p">{</span>
                        <span class="s2">&quot;automatic&quot;</span><span class="p">:</span> <span class="p">{},</span>
                    <span class="p">},</span>
                <span class="p">},</span>
            <span class="p">}</span>
        <span class="p">)</span>

        <span class="c1"># ì‹¤ì œ ê°’ìœ¼ë¡œ ë²„ì „ ì¶”ê°€</span>
        <span class="n">version</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">client</span><span class="o">.</span><span class="n">add_secret_version</span><span class="p">(</span>
            <span class="n">request</span><span class="o">=</span><span class="p">{</span>
                <span class="s2">&quot;parent&quot;</span><span class="p">:</span> <span class="n">secret</span><span class="o">.</span><span class="n">name</span><span class="p">,</span>
                <span class="s2">&quot;payload&quot;</span><span class="p">:</span> <span class="p">{</span>
                    <span class="s2">&quot;data&quot;</span><span class="p">:</span> <span class="n">value</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span><span class="s1">&#39;UTF-8&#39;</span><span class="p">),</span>
                <span class="p">},</span>
            <span class="p">}</span>
        <span class="p">)</span>

        <span class="k">return</span> <span class="n">version</span><span class="o">.</span><span class="n">name</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">add_version</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">secret_id</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">value</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;ê¸°ì¡´ secretì— ìƒˆ ë²„ì „ ì¶”ê°€.&quot;&quot;&quot;</span>
        <span class="n">parent</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;projects/</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">project_id</span><span class="si">}</span><span class="s2">/secrets/</span><span class="si">{</span><span class="n">secret_id</span><span class="si">}</span><span class="s2">&quot;</span>
        <span class="n">version</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">client</span><span class="o">.</span><span class="n">add_secret_version</span><span class="p">(</span>
            <span class="n">request</span><span class="o">=</span><span class="p">{</span>
                <span class="s2">&quot;parent&quot;</span><span class="p">:</span> <span class="n">parent</span><span class="p">,</span>
                <span class="s2">&quot;payload&quot;</span><span class="p">:</span> <span class="p">{</span>
                    <span class="s2">&quot;data&quot;</span><span class="p">:</span> <span class="n">value</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span><span class="s1">&#39;UTF-8&#39;</span><span class="p">),</span>
                <span class="p">},</span>
            <span class="p">}</span>
        <span class="p">)</span>
        <span class="k">return</span> <span class="n">version</span><span class="o">.</span><span class="n">name</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">disable_version</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">secret_id</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">version</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;secret ë²„ì „ ë¹„í™œì„±í™”(ì†Œí”„íŠ¸ ì‚­ì œ).&quot;&quot;&quot;</span>
        <span class="n">name</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_secret_path</span><span class="p">(</span><span class="n">secret_id</span><span class="p">,</span> <span class="n">version</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">client</span><span class="o">.</span><span class="n">disable_secret_version</span><span class="p">(</span>
            <span class="n">request</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;name&quot;</span><span class="p">:</span> <span class="n">name</span><span class="p">}</span>
        <span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">delete_secret</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">secret_id</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;secretì™€ ëª¨ë“  ë²„ì „ ì‚­ì œ.&quot;&quot;&quot;</span>
        <span class="n">name</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;projects/</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">project_id</span><span class="si">}</span><span class="s2">/secrets/</span><span class="si">{</span><span class="n">secret_id</span><span class="si">}</span><span class="s2">&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">client</span><span class="o">.</span><span class="n">delete_secret</span><span class="p">(</span><span class="n">request</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;name&quot;</span><span class="p">:</span> <span class="n">name</span><span class="p">})</span>


<span class="c1"># â”€â”€ ì‚¬ìš©ë²• â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€</span>
<span class="n">sm</span> <span class="o">=</span> <span class="n">GCPSecretManager</span><span class="p">(</span><span class="n">project_id</span><span class="o">=</span><span class="s1">&#39;my-project-123&#39;</span><span class="p">)</span>

<span class="c1"># secret ìƒì„±</span>
<span class="n">sm</span><span class="o">.</span><span class="n">create_secret</span><span class="p">(</span><span class="s1">&#39;database-password&#39;</span><span class="p">,</span> <span class="s1">&#39;my_secret_password&#39;</span><span class="p">)</span>

<span class="c1"># ìµœì‹  ë²„ì „ ì½ê¸°</span>
<span class="n">password</span> <span class="o">=</span> <span class="n">sm</span><span class="o">.</span><span class="n">get_secret</span><span class="p">(</span><span class="s1">&#39;database-password&#39;</span><span class="p">)</span>

<span class="c1"># êµì²´: ìƒˆ ë²„ì „ ì¶”ê°€</span>
<span class="n">sm</span><span class="o">.</span><span class="n">add_version</span><span class="p">(</span><span class="s1">&#39;database-password&#39;</span><span class="p">,</span> <span class="s1">&#39;new_rotated_password&#39;</span><span class="p">)</span>

<span class="c1"># ì´ì „ ë²„ì „ì€ ë²„ì „ ë²ˆí˜¸ë¡œ ì—¬ì „íˆ ì•¡ì„¸ìŠ¤ ê°€ëŠ¥</span>
<span class="n">old_password</span> <span class="o">=</span> <span class="n">sm</span><span class="o">.</span><span class="n">get_secret</span><span class="p">(</span><span class="s1">&#39;database-password&#39;</span><span class="p">,</span> <span class="n">version</span><span class="o">=</span><span class="s1">&#39;1&#39;</span><span class="p">)</span>
</code></pre></div>

<hr />
<h2 id="6-git-secrets">6. Git Secrets ìŠ¤ìºë‹<a class="header-link" href="#6-git-secrets" title="Permanent link">&para;</a></h2>
<h3 id="61">6.1 ë¬¸ì œì <a class="header-link" href="#61" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code>â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    Gitì˜ Secrets â€” ë¬¸ì œì                              â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                      â”‚
â”‚  secret ìœ ì¶œì˜ ì¼ë°˜ì ì¸ ì‹œë‚˜ë¦¬ì˜¤:                                      â”‚
â”‚                                                                      â”‚
â”‚  1. .env íŒŒì¼ì˜ ìš°ë°œì  ì»¤ë°‹                                           â”‚
â”‚     $ git add .                                                      â”‚
â”‚     $ git commit -m &quot;initial commit&quot;                                 â”‚
â”‚     # ì‹¤ì œ ë¹„ë°€ë²ˆí˜¸ê°€ ìˆëŠ” .envê°€ ì´ì œ git íˆìŠ¤í† ë¦¬ì— ì˜ì›íˆ ë‚¨ìŒ       â”‚
â”‚                                                                      â”‚
â”‚  2. ì†ŒìŠ¤ ì½”ë“œì— í•˜ë“œì½”ë”©ëœ API í‚¤                                      â”‚
â”‚     api_key = &quot;sk_live_EXAMPLE_KEY_REPLACE_ME&quot;                   â”‚
â”‚     # ë‚˜ì¤‘ì— ì‚­ì œí•´ë„ git íˆìŠ¤í† ë¦¬ì— ì¡´ì¬í•¨                            â”‚
â”‚                                                                      â”‚
â”‚  3. ìê²© ì¦ëª…ì´ ìˆëŠ” êµ¬ì„± íŒŒì¼                                         â”‚
â”‚     database:                                                        â”‚
â”‚       password: &quot;production_password_123&quot;                            â”‚
â”‚                                                                      â”‚
â”‚  4. ì‹¤ì œ ìê²© ì¦ëª…ì´ ìˆëŠ” í…ŒìŠ¤íŠ¸ í”½ìŠ¤ì²˜                                 â”‚
â”‚     STRIPE_KEY = &quot;sk_live_...&quot; # &quot;test&quot; í‚¤ê°€ ì‹¤ì œë¡œëŠ” ë¼ì´ë¸Œ          â”‚
â”‚                                                                      â”‚
â”‚  ì¤‘ìš”: git rmì€ íˆìŠ¤í† ë¦¬ì—ì„œ ì œê±°í•˜ì§€ ì•ŠìŒ!                             â”‚
â”‚  secretì€ ë‹¤ìŒì„ í†µí•´ ì—¬ì „íˆ ì•¡ì„¸ìŠ¤ ê°€ëŠ¥: git log --all --full-history â”‚
â”‚  ì œê±°í•˜ë ¤ë©´: git filter-branch ë˜ëŠ” BFG Repo-Cleanerê°€ í•„ìš”            â”‚
â”‚                                                                      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
</code></pre></div>

<h3 id="62-pre-commit">6.2 Pre-Commit í›…<a class="header-link" href="#62-pre-commit" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><span class="c1"># â”€â”€ git-secrets (AWS) â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€</span>
<span class="c1"># ì„¤ì¹˜</span>
brew<span class="w"> </span>install<span class="w"> </span>git-secrets<span class="w">  </span><span class="c1"># macOS</span>
<span class="c1"># ë˜ëŠ”: git clone https://github.com/awslabs/git-secrets.git &amp;&amp; make install</span>

<span class="c1"># ì €ì¥ì†Œì— ì„¤ì •</span>
<span class="nb">cd</span><span class="w"> </span>/path/to/repo
git<span class="w"> </span>secrets<span class="w"> </span>--install<span class="w">        </span><span class="c1"># í›… ì„¤ì¹˜</span>
git<span class="w"> </span>secrets<span class="w"> </span>--register-aws<span class="w">   </span><span class="c1"># AWS íŒ¨í„´ ë“±ë¡</span>

<span class="c1"># ì»¤ìŠ¤í…€ íŒ¨í„´ ì¶”ê°€</span>
git<span class="w"> </span>secrets<span class="w"> </span>--add<span class="w"> </span><span class="s1">&#39;PRIVATE_KEY&#39;</span>
git<span class="w"> </span>secrets<span class="w"> </span>--add<span class="w"> </span><span class="s1">&#39;password\s*=\s*.+&#39;</span>
git<span class="w"> </span>secrets<span class="w"> </span>--add<span class="w"> </span>--allowed<span class="w"> </span><span class="s1">&#39;password\s*=\s*os\.getenv&#39;</span><span class="w">  </span><span class="c1"># í™˜ê²½ ì¡°íšŒ í—ˆìš©</span>

<span class="c1"># ìŠ¤ìºë‹ í…ŒìŠ¤íŠ¸</span>
git<span class="w"> </span>secrets<span class="w"> </span>--scan<span class="w">           </span><span class="c1"># ìŠ¤í…Œì´ì§•ëœ ë³€ê²½ì‚¬í•­ ìŠ¤ìº”</span>
git<span class="w"> </span>secrets<span class="w"> </span>--scan-history<span class="w">   </span><span class="c1"># ì „ì²´ íˆìŠ¤í† ë¦¬ ìŠ¤ìº”</span>

<span class="c1"># â”€â”€ pre-commit í”„ë ˆì„ì›Œí¬ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€</span>
<span class="c1"># pip install pre-commit</span>
</code></pre></div>

<div class="highlight"><pre><span></span><code><span class="c1"># .pre-commit-config.yaml</span>
<span class="nt">repos</span><span class="p">:</span>
<span class="w">  </span><span class="c1"># ì»¤ë°‹ ì „ì— secrets ê°ì§€</span>
<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">repo</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">https://github.com/Yelp/detect-secrets</span>
<span class="w">    </span><span class="nt">rev</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">v1.4.0</span>
<span class="w">    </span><span class="nt">hooks</span><span class="p">:</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">id</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">detect-secrets</span>
<span class="w">        </span><span class="nt">args</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">[</span><span class="s">&#39;--baseline&#39;</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="s">&#39;.secrets.baseline&#39;</span><span class="p p-Indicator">]</span>

<span class="w">  </span><span class="c1"># gitleaks â€” í¬ê´„ì ì¸ secret ìŠ¤ìºë„ˆ</span>
<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">repo</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">https://github.com/gitleaks/gitleaks</span>
<span class="w">    </span><span class="nt">rev</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">v8.18.0</span>
<span class="w">    </span><span class="nt">hooks</span><span class="p">:</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">id</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">gitleaks</span>

<span class="w">  </span><span class="c1"># ê°œì¸ í‚¤ í™•ì¸</span>
<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">repo</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">https://github.com/pre-commit/pre-commit-hooks</span>
<span class="w">    </span><span class="nt">rev</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">v4.5.0</span>
<span class="w">    </span><span class="nt">hooks</span><span class="p">:</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">id</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">detect-private-key</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">id</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">check-added-large-files</span>
<span class="w">        </span><span class="nt">args</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">[</span><span class="s">&#39;--maxkb=100&#39;</span><span class="p p-Indicator">]</span>
</code></pre></div>

<div class="highlight"><pre><span></span><code><span class="c1"># pre-commit í›… ì„¤ì¹˜</span>
pre-commit<span class="w"> </span>install

<span class="c1"># ëª¨ë“  íŒŒì¼ì— ìˆ˜ë™ ì‹¤í–‰</span>
pre-commit<span class="w"> </span>run<span class="w"> </span>--all-files

<span class="c1"># íŠ¹ì • í›… ì‹¤í–‰</span>
pre-commit<span class="w"> </span>run<span class="w"> </span>detect-secrets<span class="w"> </span>--all-files
</code></pre></div>

<h3 id="63">6.3 ìŠ¤ìºë‹ ë„êµ¬<a class="header-link" href="#63" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><span class="c1"># â”€â”€ gitleaks â€” ë¹ ë¥´ê³  í¬ê´„ì ì¸ ìŠ¤ìºë„ˆ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€</span>
<span class="c1"># ì„¤ì¹˜</span>
brew<span class="w"> </span>install<span class="w"> </span>gitleaks<span class="w">  </span><span class="c1"># macOS</span>
<span class="c1"># ë˜ëŠ”: go install github.com/gitleaks/gitleaks/v8@latest</span>

<span class="c1"># í˜„ì¬ ì €ì¥ì†Œ ìŠ¤ìº”</span>
gitleaks<span class="w"> </span>detect<span class="w"> </span>--source<span class="w"> </span>.<span class="w"> </span>--verbose

<span class="c1"># íŠ¹ì • ì»¤ë°‹ ë²”ìœ„ ìŠ¤ìº”</span>
gitleaks<span class="w"> </span>detect<span class="w"> </span>--source<span class="w"> </span>.<span class="w"> </span>--log-opts<span class="o">=</span><span class="s2">&quot;HEAD~10..HEAD&quot;</span>

<span class="c1"># ì „ì²´ íˆìŠ¤í† ë¦¬ ìŠ¤ìº”</span>
gitleaks<span class="w"> </span>detect<span class="w"> </span>--source<span class="w"> </span>.<span class="w"> </span>--log-opts<span class="o">=</span><span class="s2">&quot;--all&quot;</span>

<span class="c1"># ë³´ê³ ì„œ ìƒì„±</span>
gitleaks<span class="w"> </span>detect<span class="w"> </span>--source<span class="w"> </span>.<span class="w"> </span>--report-format<span class="w"> </span>json<span class="w"> </span>--report-path<span class="w"> </span>report.json

<span class="c1"># ì»¤ìŠ¤í…€ ê·œì¹™ ì‚¬ìš©</span>
gitleaks<span class="w"> </span>detect<span class="w"> </span>--source<span class="w"> </span>.<span class="w"> </span>--config<span class="w"> </span>gitleaks.toml

<span class="c1"># â”€â”€ trufflehog â€” ë†’ì€ ì •í™•ë„ ìŠ¤ìºë„ˆ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€</span>
<span class="c1"># ì„¤ì¹˜</span>
pip<span class="w"> </span>install<span class="w"> </span>trufflehog

<span class="c1"># ë˜ëŠ” Docker ì‚¬ìš©</span>
docker<span class="w"> </span>run<span class="w"> </span>--rm<span class="w"> </span>-v<span class="w"> </span><span class="s2">&quot;</span><span class="nv">$PWD</span><span class="s2">:/repo&quot;</span><span class="w"> </span>trufflesecurity/trufflehog:latest<span class="w"> </span><span class="se">\</span>
<span class="w">    </span>git<span class="w"> </span>file:///repo<span class="w"> </span>--only-verified

<span class="c1"># ì €ì¥ì†Œ ìŠ¤ìº”</span>
trufflehog<span class="w"> </span>git<span class="w"> </span>file:///path/to/repo<span class="w"> </span>--only-verified

<span class="c1"># GitHub ì €ì¥ì†Œ ì§ì ‘ ìŠ¤ìº”</span>
trufflehog<span class="w"> </span>github<span class="w"> </span>--org<span class="w"> </span>your-org<span class="w"> </span>--only-verified

<span class="c1"># â”€â”€ detect-secrets (Yelp) â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€</span>
<span class="c1"># ì„¤ì¹˜</span>
pip<span class="w"> </span>install<span class="w"> </span>detect-secrets

<span class="c1"># ë² ì´ìŠ¤ë¼ì¸ ìƒì„± (ê¸°ì¡´ ê²°ê³¼ë¥¼ í—ˆìš©ë¨ìœ¼ë¡œ í‘œì‹œ)</span>
detect-secrets<span class="w"> </span>scan<span class="w"> </span>&gt;<span class="w"> </span>.secrets.baseline

<span class="c1"># ë² ì´ìŠ¤ë¼ì¸ ëŒ€í™”ì‹ìœ¼ë¡œ ê°ì‚¬</span>
detect-secrets<span class="w"> </span>audit<span class="w"> </span>.secrets.baseline

<span class="c1"># ìƒˆ secrets ìŠ¤ìº” (ë² ì´ìŠ¤ë¼ì¸ê³¼ ë¹„êµ)</span>
detect-secrets<span class="w"> </span>scan<span class="w"> </span>--baseline<span class="w"> </span>.secrets.baseline
</code></pre></div>

<h3 id="64-gitleaks">6.4 ì»¤ìŠ¤í…€ gitleaks êµ¬ì„±<a class="header-link" href="#64-gitleaks" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><span class="c1"># gitleaks.toml â€” secret ê°ì§€ë¥¼ ìœ„í•œ ì»¤ìŠ¤í…€ ê·œì¹™</span>
<span class="n">title</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;Custom Gitleaks Config&quot;</span>

<span class="c1"># ê¸°ë³¸ ê·œì¹™ í™•ì¥</span>
<span class="k">[extend]</span>
<span class="n">useDefault</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">true</span>

<span class="c1"># ì»¤ìŠ¤í…€ ê·œì¹™</span>
<span class="k">[[rules]]</span>
<span class="n">id</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;custom-api-key&quot;</span>
<span class="n">description</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;Custom API Key Pattern&quot;</span>
<span class="n">regex</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">&#39;&#39;&#39;(?i)(api[_-]?key|apikey)\s*[=:]\s*[&#39;&quot;]?([a-zA-Z0-9_\-]{20,})[&#39;&quot;]?&#39;&#39;&#39;</span>
<span class="n">secretGroup</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">2</span>

<span class="k">[[rules]]</span>
<span class="n">id</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;slack-webhook&quot;</span>
<span class="n">description</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;Slack Webhook URL&quot;</span>
<span class="n">regex</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">&#39;&#39;&#39;https://hooks\.slack\.com/services/T[a-zA-Z0-9_]{8,}/B[a-zA-Z0-9_]{8,}/[a-zA-Z0-9_]{24,}&#39;&#39;&#39;</span>

<span class="k">[[rules]]</span>
<span class="n">id</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;internal-password&quot;</span>
<span class="n">description</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;Hardcoded Password&quot;</span>
<span class="n">regex</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">&#39;&#39;&#39;(?i)(password|passwd|pwd)\s*[=:]\s*[&#39;&quot;]([^&#39;&quot;]{8,})[&#39;&quot;]&#39;&#39;&#39;</span>
<span class="n">secretGroup</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">2</span>

<span class="c1"># í—ˆìš© ëª©ë¡ (ì˜¤íƒì§€ ì–µì œ)</span>
<span class="k">[allowlist]</span>
<span class="n">paths</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">[</span>
<span class="w">    </span><span class="s1">&#39;&#39;&#39;\.env\.example&#39;&#39;&#39;</span><span class="p">,</span>
<span class="w">    </span><span class="s1">&#39;&#39;&#39;\.env\.template&#39;&#39;&#39;</span><span class="p">,</span>
<span class="w">    </span><span class="s1">&#39;&#39;&#39;test_.*\.py&#39;&#39;&#39;</span><span class="p">,</span><span class="w">        </span><span class="c1"># ì£¼ì˜í•´ì„œ ì‚¬ìš©</span>
<span class="w">    </span><span class="s1">&#39;&#39;&#39;docs/.*\.md&#39;&#39;&#39;</span><span class="p">,</span>
<span class="p">]</span>
<span class="n">regexes</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">[</span>
<span class="w">    </span><span class="s1">&#39;&#39;&#39;password\s*=\s*os\.getenv&#39;&#39;&#39;</span><span class="p">,</span><span class="w">    </span><span class="c1"># í™˜ê²½ì—ì„œ ì½ëŠ” ê²ƒì€ í—ˆìš©</span>
<span class="w">    </span><span class="s1">&#39;&#39;&#39;password\s*=\s*[&quot;&#39;]changeme[&quot;&#39;]&#39;&#39;&#39;</span><span class="p">,</span><span class="w">  </span><span class="c1"># í”Œë ˆì´ìŠ¤í™€ë” ê°’</span>
<span class="w">    </span><span class="s1">&#39;&#39;&#39;EXAMPLE_KEY_DO_NOT_USE&#39;&#39;&#39;</span><span class="p">,</span>
<span class="p">]</span>
</code></pre></div>

<h3 id="65-git-secrets">6.5 Git íˆìŠ¤í† ë¦¬ì—ì„œ Secrets ì œê±°<a class="header-link" href="#65-git-secrets" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><span class="c1"># â”€â”€ BFG Repo-Cleaner (ê¶Œì¥) â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€</span>
<span class="c1"># ì„¤ì¹˜: brew install bfg</span>

<span class="c1"># ëª¨ë“  íˆìŠ¤í† ë¦¬ì—ì„œ íŒŒì¼ ì œê±°</span>
bfg<span class="w"> </span>--delete-files<span class="w"> </span><span class="s1">&#39;.env&#39;</span><span class="w"> </span>my-repo.git

<span class="c1"># ëª¨ë“  íŒŒì¼ì—ì„œ í…ìŠ¤íŠ¸ êµì²´</span>
<span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;sk_live_EXAMPLE_KEY_REPLACE_ME&quot;</span><span class="w"> </span>&gt;<span class="w"> </span>passwords.txt
bfg<span class="w"> </span>--replace-text<span class="w"> </span>passwords.txt<span class="w"> </span>my-repo.git

<span class="c1"># BFG í›„ ì •ë¦¬</span>
<span class="nb">cd</span><span class="w"> </span>my-repo.git
git<span class="w"> </span>reflog<span class="w"> </span>expire<span class="w"> </span>--expire<span class="o">=</span>now<span class="w"> </span>--all
git<span class="w"> </span>gc<span class="w"> </span>--prune<span class="o">=</span>now<span class="w"> </span>--aggressive

<span class="c1"># ê°•ì œ í‘¸ì‹œ (ê²½ê³ : íˆìŠ¤í† ë¦¬ ì¬ì‘ì„±)</span>
git<span class="w"> </span>push<span class="w"> </span>--force

<span class="c1"># â”€â”€ git filter-repo (ëŒ€ì•ˆ) â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€</span>
<span class="c1"># pip install git-filter-repo</span>

<span class="c1"># íˆìŠ¤í† ë¦¬ì—ì„œ íŒŒì¼ ì œê±°</span>
git<span class="w"> </span>filter-repo<span class="w"> </span>--path<span class="w"> </span>.env<span class="w"> </span>--invert-paths

<span class="c1"># ëª¨ë“  íŒŒì¼ì—ì„œ ë¬¸ìì—´ êµì²´</span>
git<span class="w"> </span>filter-repo<span class="w"> </span>--replace-text<span class="w"> </span>&lt;<span class="o">(</span><span class="nb">echo</span><span class="w"> </span><span class="s1">&#39;literal:sk_live_EXAMPLE_KEY_REPLACE_ME==&gt;REDACTED&#39;</span><span class="o">)</span>

<span class="c1"># â”€â”€ ì¤‘ìš” â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€</span>
<span class="c1"># íˆìŠ¤í† ë¦¬ì—ì„œ secrets ì œê±° í›„:</span>
<span class="c1"># 1. ì›ê²©ì— ê°•ì œ í‘¸ì‹œ (ëª¨ë“  í˜‘ì—…ìëŠ” ì¬ë³µì œí•´ì•¼ í•¨)</span>
<span class="c1"># 2. ì¦‰ì‹œ ì†ìƒëœ secret êµì²´</span>
<span class="c1"># 3. secretì€ ì´ë¯¸ ë…¸ì¶œë¨ â€” gitì—ì„œ ì œê±°ëŠ” í”¼í•´ í†µì œì„</span>
<span class="c1"># 4. GitHub ìºì‹œëŠ” ì¼ì‹œì ìœ¼ë¡œ ì—¬ì „íˆ ë°ì´í„°ë¥¼ ê°€ì§ˆ ìˆ˜ ìˆìŒ</span>
<span class="c1"># 5. ëª¨ë“  í¬í¬ëŠ” ì—¬ì „íˆ secretì„ í¬í•¨í•  ìˆ˜ ìˆìŒ</span>
</code></pre></div>

<hr />
<h2 id="7-cicd-secrets">7. CI/CD Secrets<a class="header-link" href="#7-cicd-secrets" title="Permanent link">&para;</a></h2>
<h3 id="71-github-actions-secrets">7.1 GitHub Actions Secrets<a class="header-link" href="#71-github-actions-secrets" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><span class="c1"># .github/workflows/deploy.yml</span>
<span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Deploy</span>

<span class="nt">on</span><span class="p">:</span>
<span class="w">  </span><span class="nt">push</span><span class="p">:</span>
<span class="w">    </span><span class="nt">branches</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">[</span><span class="nv">main</span><span class="p p-Indicator">]</span>

<span class="c1"># â”€â”€ GitHub Actionsì—ì„œ secrets ì•¡ì„¸ìŠ¤ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€</span>
<span class="nt">jobs</span><span class="p">:</span>
<span class="w">  </span><span class="nt">deploy</span><span class="p">:</span>
<span class="w">    </span><span class="nt">runs-on</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">ubuntu-latest</span>

<span class="w">    </span><span class="c1"># ë‹¤ë¥¸ ë‹¨ê³„ë¥¼ ìœ„í•œ í™˜ê²½ ìˆ˜ì¤€ secrets ì‚¬ìš©</span>
<span class="w">    </span><span class="nt">environment</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">production</span>

<span class="w">    </span><span class="nt">steps</span><span class="p">:</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">uses</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">actions/checkout@v4</span>

<span class="w">      </span><span class="c1"># SecretsëŠ” í™˜ê²½ ë³€ìˆ˜ë¡œ ì‚¬ìš© ê°€ëŠ¥</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Configure AWS</span>
<span class="w">        </span><span class="nt">env</span><span class="p">:</span>
<span class="w">          </span><span class="nt">AWS_ACCESS_KEY_ID</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">${{ secrets.AWS_ACCESS_KEY_ID }}</span>
<span class="w">          </span><span class="nt">AWS_SECRET_ACCESS_KEY</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">${{ secrets.AWS_SECRET_ACCESS_KEY }}</span>
<span class="w">          </span><span class="nt">AWS_REGION</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">us-east-1</span>
<span class="w">        </span><span class="nt">run</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">|</span>
<span class="w">          </span><span class="no">aws configure set aws_access_key_id $AWS_ACCESS_KEY_ID</span>
<span class="w">          </span><span class="no">aws configure set aws_secret_access_key $AWS_SECRET_ACCESS_KEY</span>
<span class="w">          </span><span class="no">aws configure set region $AWS_REGION</span>

<span class="w">      </span><span class="c1"># secretsë¥¼ ì§ì ‘ ì‚¬ìš© (ë¡œê·¸ì—ì„œ ë§ˆìŠ¤í‚¹ë¨)</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Deploy</span>
<span class="w">        </span><span class="nt">run</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">|</span>
<span class="w">          </span><span class="no">echo &quot;Deploying to production...&quot;</span>
<span class="w">          </span><span class="no"># ${{ secrets.DEPLOY_KEY }}ëŠ” ë¡œê·¸ì—ì„œ ***ë¡œ ë§ˆìŠ¤í‚¹ë¨</span>
<span class="w">          </span><span class="no">./deploy.sh --key &quot;${{ secrets.DEPLOY_KEY }}&quot;</span>

<span class="w">      </span><span class="c1"># secretsë¡œ Docker ë¡œê·¸ì¸</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Login to Docker Hub</span>
<span class="w">        </span><span class="nt">uses</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">docker/login-action@v3</span>
<span class="w">        </span><span class="nt">with</span><span class="p">:</span>
<span class="w">          </span><span class="nt">username</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">${{ secrets.DOCKER_USERNAME }}</span>
<span class="w">          </span><span class="nt">password</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">${{ secrets.DOCKER_PASSWORD }}</span>

<span class="w">      </span><span class="c1"># OIDC ì¸ì¦ (ì •ì  ìê²© ì¦ëª…ë³´ë‹¤ ì„ í˜¸ë¨)</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Configure AWS with OIDC</span>
<span class="w">        </span><span class="nt">uses</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">aws-actions/configure-aws-credentials@v4</span>
<span class="w">        </span><span class="nt">with</span><span class="p">:</span>
<span class="w">          </span><span class="nt">role-to-assume</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">arn:aws:iam::123456789:role/github-actions</span>
<span class="w">          </span><span class="nt">aws-region</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">us-east-1</span>
<span class="w">          </span><span class="c1"># ì •ì  ìê²© ì¦ëª… ë¶ˆí•„ìš”!</span>
</code></pre></div>

<div class="highlight"><pre><span></span><code><span class="c1"># â”€â”€ GitHub Actions ë³´ì•ˆ ëª¨ë²” ì‚¬ë¡€ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€</span>
<span class="c1"># 1. í•„ìˆ˜ ê²€í† ìê°€ ìˆëŠ” í™˜ê²½ ìˆ˜ì¤€ secrets ì‚¬ìš©</span>
<span class="c1"># 2. ê°€ëŠ¥í•œ ê²½ìš° ì •ì  ìê²© ì¦ëª… ëŒ€ì‹  OIDC ì‚¬ìš©</span>
<span class="c1"># 3. actionsë¥¼ íƒœê·¸ê°€ ì•„ë‹Œ íŠ¹ì • SHAì— ê³ ì •</span>
<span class="c1"># 4. secret ì•¡ì„¸ìŠ¤ë¥¼ íŠ¹ì • í™˜ê²½ìœ¼ë¡œ ì œí•œ</span>
<span class="c1"># 5. PATê°€ ì•„ë‹Œ GITHUB_TOKENì˜ ìë™ ê¶Œí•œ ì‚¬ìš©</span>

<span class="c1"># .github/workflows/secure.yml</span>
<span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Secure Workflow</span>

<span class="nt">on</span><span class="p">:</span>
<span class="w">  </span><span class="nt">push</span><span class="p">:</span>
<span class="w">    </span><span class="nt">branches</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">[</span><span class="nv">main</span><span class="p p-Indicator">]</span>

<span class="nt">permissions</span><span class="p">:</span>
<span class="w">  </span><span class="nt">contents</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">read</span><span class="w">  </span><span class="c1"># ìµœì†Œ ê¶Œí•œ</span>

<span class="nt">jobs</span><span class="p">:</span>
<span class="w">  </span><span class="nt">build</span><span class="p">:</span>
<span class="w">    </span><span class="nt">runs-on</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">ubuntu-latest</span>
<span class="w">    </span><span class="nt">steps</span><span class="p">:</span>
<span class="w">      </span><span class="c1"># actionsë¥¼ SHAì— ê³ ì • (íƒœê·¸ ì•„ë‹˜) â€” ê³µê¸‰ë§ ê³µê²© ë°©ì§€</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">uses</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">actions/checkout@b4ffde65f46336ab88eb53be808477a3936bae11</span><span class="w">  </span><span class="c1"># v4.1.1</span>

<span class="w">      </span><span class="c1"># ì €ì¥ì†Œ ì•¡ì„¸ìŠ¤ë¥¼ ìœ„í•´ GITHUB_TOKEN ì‚¬ìš© (ìë™ ë²”ìœ„ ì§€ì •)</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Create Release</span>
<span class="w">        </span><span class="nt">env</span><span class="p">:</span>
<span class="w">          </span><span class="nt">GH_TOKEN</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">${{ github.token }}</span>
<span class="w">        </span><span class="nt">run</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">gh release create v1.0 --generate-notes</span>

<span class="w">      </span><span class="c1"># secretsë¥¼ ì ˆëŒ€ echoí•˜ì§€ ë§ ê²ƒ (ì‹¤ìˆ˜ë¡œë¼ë„)</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Safe Logging</span>
<span class="w">        </span><span class="nt">env</span><span class="p">:</span>
<span class="w">          </span><span class="nt">API_KEY</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">${{ secrets.API_KEY }}</span>
<span class="w">        </span><span class="nt">run</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">|</span>
<span class="w">          </span><span class="no"># ë‚˜ì¨: echo &quot;Key is: $API_KEY&quot;</span>
<span class="w">          </span><span class="no"># ì¢‹ìŒ: ì¶œë ¥í•˜ì§€ ì•Šê³  í‚¤ê°€ ì‘ë™í•˜ëŠ”ì§€ í…ŒìŠ¤íŠ¸</span>
<span class="w">          </span><span class="no">curl -sf -H &quot;Authorization: Bearer $API_KEY&quot; \</span>
<span class="w">               </span><span class="no">https://api.example.com/health || exit 1</span>
</code></pre></div>

<h3 id="72-gitlab-ci">7.2 GitLab CI ë³€ìˆ˜<a class="header-link" href="#72-gitlab-ci" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><span class="c1"># .gitlab-ci.yml</span>
<span class="c1"># ë³€ìˆ˜ëŠ” GitLab UIì—ì„œ ì„¤ì •ë¨:</span>
<span class="c1"># Settings â†’ CI/CD â†’ Variables</span>

<span class="nt">stages</span><span class="p">:</span>
<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">test</span>
<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">deploy</span>

<span class="nt">test</span><span class="p">:</span>
<span class="w">  </span><span class="nt">stage</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">test</span>
<span class="w">  </span><span class="nt">variables</span><span class="p">:</span>
<span class="w">    </span><span class="c1"># ë¯¼ê°í•˜ì§€ ì•Šì€ ê²ƒì€ ì—¬ê¸°ì— ì„¤ì • ê°€ëŠ¥</span>
<span class="w">    </span><span class="nt">NODE_ENV</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">test</span>
<span class="w">  </span><span class="nt">script</span><span class="p">:</span>
<span class="w">    </span><span class="c1"># Protected ë³€ìˆ˜ëŠ” protected ë¸Œëœì¹˜ì—ì„œë§Œ ì‚¬ìš© ê°€ëŠ¥</span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">echo &quot;Running tests...&quot;</span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">pytest --cov</span>
<span class="w">    </span><span class="c1"># Masked ë³€ìˆ˜ëŠ” ì‘ì—… ë¡œê·¸ì—ì„œ ìˆ¨ê²¨ì§</span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">echo &quot;DB URL is $DATABASE_URL&quot;</span><span class="w">  </span><span class="c1"># [MASKED]ë¡œ í‘œì‹œë¨</span>

<span class="nt">deploy</span><span class="p">:</span>
<span class="w">  </span><span class="nt">stage</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">deploy</span>
<span class="w">  </span><span class="c1"># protected ë¸Œëœì¹˜ë¡œë§Œ ì œí•œ</span>
<span class="w">  </span><span class="nt">only</span><span class="p">:</span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">main</span>
<span class="w">  </span><span class="nt">variables</span><span class="p">:</span>
<span class="w">    </span><span class="c1"># ì—¬ëŸ¬ ì¤„ secrets(ì¸ì¦ì„œ ê°™ì€)ë¥¼ ìœ„í•œ íŒŒì¼ íƒ€ì… ë³€ìˆ˜ ì‚¬ìš©</span>
<span class="w">    </span><span class="c1"># GitLabì€ ê°’ì„ íŒŒì¼ì— ì“°ê³  ë³€ìˆ˜ë¥¼ ê²½ë¡œë¡œ ì„¤ì •</span>
<span class="w">    </span><span class="nt">KUBE_CONFIG</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">$KUBE_CONFIG_FILE</span><span class="w">  </span><span class="c1"># ì´ê²ƒì€ íŒŒì¼ ê²½ë¡œì„</span>
<span class="w">  </span><span class="nt">script</span><span class="p">:</span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">kubectl --kubeconfig=&quot;$KUBE_CONFIG&quot; apply -f deployment.yaml</span>
<span class="w">  </span><span class="nt">environment</span><span class="p">:</span>
<span class="w">    </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">production</span>

<span class="c1"># â”€â”€ GitLab CI Secret ëª¨ë²” ì‚¬ë¡€ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€</span>
<span class="c1"># 1. ë¯¼ê°í•œ ë³€ìˆ˜ë¥¼ &quot;Masked&quot;ë¡œ í‘œì‹œ (ë¡œê·¸ì—ì„œ ìˆ¨ê¹€)</span>
<span class="c1"># 2. ë°°í¬ secretsë¥¼ &quot;Protected&quot;ë¡œ í‘œì‹œ (protected ë¸Œëœì¹˜ì—ì„œë§Œ)</span>
<span class="c1"># 3. ì—¬ëŸ¬ ì¤„ secrets(ì¸ì¦ì„œ, í‚¤)ë¥¼ ìœ„í•´ &quot;File&quot; íƒ€ì… ì‚¬ìš©</span>
<span class="c1"># 4. ë³€ìˆ˜ë¥¼ íŠ¹ì • í™˜ê²½ìœ¼ë¡œ ë²”ìœ„ ì§€ì •</span>
<span class="c1"># 5. GitLabì˜ ì™¸ë¶€ secrets í†µí•© ì‚¬ìš© (Vault, AWS, GCP)</span>
</code></pre></div>

<hr />
<h2 id="8">8. ì €ì¥ ì‹œ ì•”í˜¸í™”<a class="header-link" href="#8" title="Permanent link">&para;</a></h2>
<h3 id="81">8.1 êµ¬ì„± íŒŒì¼ ì•”í˜¸í™”<a class="header-link" href="#81" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">Fernet(ëŒ€ì¹­ ì•”í˜¸í™”)ë¥¼ ì‚¬ìš©í•˜ì—¬ êµ¬ì„± íŒŒì¼ ì•”í˜¸í™”.</span>
<span class="sd">pip install cryptography</span>
<span class="sd">&quot;&quot;&quot;</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">cryptography.fernet</span><span class="w"> </span><span class="kn">import</span> <span class="n">Fernet</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">json</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">os</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">pathlib</span><span class="w"> </span><span class="kn">import</span> <span class="n">Path</span>


<span class="k">class</span><span class="w"> </span><span class="nc">ConfigEncryptor</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;êµ¬ì„± íŒŒì¼ ì•”í˜¸í™” ë° ë³µí˜¸í™”.&quot;&quot;&quot;</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key</span><span class="p">:</span> <span class="nb">bytes</span> <span class="o">=</span> <span class="kc">None</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">key</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="c1"># í™˜ê²½ì—ì„œ í‚¤ ë¡œë“œ</span>
            <span class="n">key_str</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">getenv</span><span class="p">(</span><span class="s1">&#39;CONFIG_ENCRYPTION_KEY&#39;</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">key_str</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                    <span class="s2">&quot;CONFIG_ENCRYPTION_KEY environment variable not set&quot;</span>
                <span class="p">)</span>
            <span class="n">key</span> <span class="o">=</span> <span class="n">key_str</span><span class="o">.</span><span class="n">encode</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cipher</span> <span class="o">=</span> <span class="n">Fernet</span><span class="p">(</span><span class="n">key</span><span class="p">)</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">generate_key</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;ìƒˆ ì•”í˜¸í™” í‚¤ ìƒì„±.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">Fernet</span><span class="o">.</span><span class="n">generate_key</span><span class="p">()</span><span class="o">.</span><span class="n">decode</span><span class="p">()</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">encrypt_config</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">config</span><span class="p">:</span> <span class="nb">dict</span><span class="p">,</span> <span class="n">output_path</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;êµ¬ì„± ë”•ì…”ë„ˆë¦¬ë¥¼ ì•”í˜¸í™”í•˜ê³  íŒŒì¼ì— ì“°ê¸°.&quot;&quot;&quot;</span>
        <span class="n">json_data</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="n">config</span><span class="p">,</span> <span class="n">indent</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span><span class="o">.</span><span class="n">encode</span><span class="p">()</span>
        <span class="n">encrypted</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cipher</span><span class="o">.</span><span class="n">encrypt</span><span class="p">(</span><span class="n">json_data</span><span class="p">)</span>

        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">output_path</span><span class="p">,</span> <span class="s1">&#39;wb&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
            <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">encrypted</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">decrypt_config</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">input_path</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;êµ¬ì„± íŒŒì¼ ì½ê³  ë³µí˜¸í™”.&quot;&quot;&quot;</span>
        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">input_path</span><span class="p">,</span> <span class="s1">&#39;rb&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
            <span class="n">encrypted</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>

        <span class="n">decrypted</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cipher</span><span class="o">.</span><span class="n">decrypt</span><span class="p">(</span><span class="n">encrypted</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">json</span><span class="o">.</span><span class="n">loads</span><span class="p">(</span><span class="n">decrypted</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">encrypt_value</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;ë‹¨ì¼ ê°’ ì•”í˜¸í™”.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">cipher</span><span class="o">.</span><span class="n">encrypt</span><span class="p">(</span><span class="n">value</span><span class="o">.</span><span class="n">encode</span><span class="p">())</span><span class="o">.</span><span class="n">decode</span><span class="p">()</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">decrypt_value</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">encrypted_value</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;ë‹¨ì¼ ê°’ ë³µí˜¸í™”.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">cipher</span><span class="o">.</span><span class="n">decrypt</span><span class="p">(</span><span class="n">encrypted_value</span><span class="o">.</span><span class="n">encode</span><span class="p">())</span><span class="o">.</span><span class="n">decode</span><span class="p">()</span>


<span class="c1"># â”€â”€ ì‚¬ìš©ë²• â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€</span>
<span class="c1"># ì²˜ìŒ: í‚¤ ìƒì„±</span>
<span class="n">key</span> <span class="o">=</span> <span class="n">ConfigEncryptor</span><span class="o">.</span><span class="n">generate_key</span><span class="p">()</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Store this key securely: </span><span class="si">{</span><span class="n">key</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="c1"># ì €ì¥ ìœ„ì¹˜: í™˜ê²½ ë³€ìˆ˜, Vault, í´ë¼ìš°ë“œ KMS</span>

<span class="c1"># êµ¬ì„± ì•”í˜¸í™”</span>
<span class="n">encryptor</span> <span class="o">=</span> <span class="n">ConfigEncryptor</span><span class="p">(</span><span class="n">key</span><span class="o">.</span><span class="n">encode</span><span class="p">())</span>
<span class="n">encryptor</span><span class="o">.</span><span class="n">encrypt_config</span><span class="p">(</span>
    <span class="n">config</span><span class="o">=</span><span class="p">{</span>
        <span class="s1">&#39;database_url&#39;</span><span class="p">:</span> <span class="s1">&#39;postgresql://user:pass@host/db&#39;</span><span class="p">,</span>
        <span class="s1">&#39;api_key&#39;</span><span class="p">:</span> <span class="s1">&#39;sk_live_xxxxx&#39;</span><span class="p">,</span>
        <span class="s1">&#39;jwt_secret&#39;</span><span class="p">:</span> <span class="s1">&#39;supersecret&#39;</span><span class="p">,</span>
    <span class="p">},</span>
    <span class="n">output_path</span><span class="o">=</span><span class="s1">&#39;config.enc&#39;</span><span class="p">,</span>
<span class="p">)</span>

<span class="c1"># êµ¬ì„± ë³µí˜¸í™” (ì• í”Œë¦¬ì¼€ì´ì…˜ ì‹œì‘ ì‹œ)</span>
<span class="n">config</span> <span class="o">=</span> <span class="n">encryptor</span><span class="o">.</span><span class="n">decrypt_config</span><span class="p">(</span><span class="s1">&#39;config.enc&#39;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">config</span><span class="p">[</span><span class="s1">&#39;database_url&#39;</span><span class="p">])</span>
</code></pre></div>

<h3 id="82-sops-secrets-operations">8.2 SOPS (Secrets OPerationS)<a class="header-link" href="#82-sops-secrets-operations" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><span class="c1"># â”€â”€ SOPS: ì•”í˜¸í™”ëœ íŒŒì¼ ê´€ë¦¬ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€</span>
<span class="c1"># SOPSëŠ” í‚¤ë¥¼ ë³´ì´ê²Œ ìœ ì§€í•˜ë©´ì„œ YAML/JSON/ENV íŒŒì¼ì˜ ê°’ì„ ì•”í˜¸í™”</span>
<span class="c1"># ì´ëŠ” diff, ê²€í† , ì•”í˜¸í™”ëœ íŒŒì¼ ì»¤ë°‹ì´ ê°€ëŠ¥í•¨ì„ ì˜ë¯¸</span>

<span class="c1"># ì„¤ì¹˜</span>
brew<span class="w"> </span>install<span class="w"> </span>sops

<span class="c1"># â”€â”€ age ì•”í˜¸í™”ì™€ SOPS ì‚¬ìš© â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€</span>
<span class="c1"># age í‚¤ ìƒì„±</span>
age-keygen<span class="w"> </span>-o<span class="w"> </span>keys.txt
<span class="c1"># ê³µê°œ í‚¤: age1xxxxxxx...</span>
<span class="c1"># ê°œì¸ í‚¤ë¥¼ ì•ˆì „í•˜ê²Œ ì €ì¥</span>

<span class="c1"># .sops.yaml êµ¬ì„± ìƒì„±</span>
cat<span class="w"> </span>&gt;<span class="w"> </span>.sops.yaml<span class="w"> </span><span class="s">&lt;&lt; &#39;EOF&#39;</span>
<span class="s">creation_rules:</span>
<span class="s">  - path_regex: \.enc\.yaml$</span>
<span class="s">    age: age1xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx</span>
<span class="s">  - path_regex: \.enc\.json$</span>
<span class="s">    age: age1xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx</span>
<span class="s">EOF</span>

<span class="c1"># íŒŒì¼ ì•”í˜¸í™”</span>
sops<span class="w"> </span>--encrypt<span class="w"> </span>secrets.yaml<span class="w"> </span>&gt;<span class="w"> </span>secrets.enc.yaml

<span class="c1"># íŒŒì¼ ë³µí˜¸í™”</span>
sops<span class="w"> </span>--decrypt<span class="w"> </span>secrets.enc.yaml<span class="w"> </span>&gt;<span class="w"> </span>secrets.yaml

<span class="c1"># ì œìë¦¬ì—ì„œ ì•”í˜¸í™”ëœ íŒŒì¼ í¸ì§‘ (ë³µí˜¸í™”, ì—ë””í„° ì—´ê¸°, ì¬ì•”í˜¸í™”)</span>
sops<span class="w"> </span>secrets.enc.yaml
</code></pre></div>

<div class="highlight"><pre><span></span><code><span class="c1"># secrets.enc.yaml â€” ê°’ì€ ì•”í˜¸í™”ë˜ê³ , í‚¤ëŠ” ì½ì„ ìˆ˜ ìˆìŒ</span>
<span class="nt">database</span><span class="p">:</span>
<span class="w">    </span><span class="nt">host</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">ENC[AES256_GCM,data:kDf5...,iv:abc...,tag:def...,type:str]</span>
<span class="w">    </span><span class="nt">port</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">ENC[AES256_GCM,data:NTQzMg==,iv:ghi...,tag:jkl...,type:int]</span>
<span class="w">    </span><span class="nt">username</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">ENC[AES256_GCM,data:mno...,iv:pqr...,tag:stu...,type:str]</span>
<span class="w">    </span><span class="nt">password</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">ENC[AES256_GCM,data:vwx...,iv:yza...,tag:bcd...,type:str]</span>
<span class="nt">api_keys</span><span class="p">:</span>
<span class="w">    </span><span class="nt">stripe</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">ENC[AES256_GCM,data:efg...,iv:hij...,tag:klm...,type:str]</span>
<span class="w">    </span><span class="nt">sendgrid</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">ENC[AES256_GCM,data:nop...,iv:qrs...,tag:tuv...,type:str]</span>
<span class="nt">sops</span><span class="p">:</span>
<span class="w">    </span><span class="nt">kms</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">[]</span>
<span class="w">    </span><span class="nt">age</span><span class="p">:</span>
<span class="w">        </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">recipient</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">age1xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx</span>
<span class="w">          </span><span class="nt">enc</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">|</span>
<span class="w">            </span><span class="no">-----BEGIN AGE ENCRYPTED FILE-----</span>
<span class="w">            </span><span class="no">...</span>
<span class="w">            </span><span class="no">-----END AGE ENCRYPTED FILE-----</span>
<span class="w">    </span><span class="nt">lastmodified</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;2025-01-15T10:30:00Z&quot;</span>
<span class="w">    </span><span class="nt">version</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">3.8.0</span>
</code></pre></div>

<div class="highlight"><pre><span></span><code><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">Pythonì—ì„œ SOPSë¡œ ì•”í˜¸í™”ëœ êµ¬ì„± ë¡œë“œ.</span>
<span class="sd">&quot;&quot;&quot;</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">subprocess</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">json</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">yaml</span>


<span class="k">def</span><span class="w"> </span><span class="nf">load_sops_config</span><span class="p">(</span><span class="n">path</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;SOPS íŒŒì¼ì„ ë³µí˜¸í™”í•˜ê³  ë”•ì…”ë„ˆë¦¬ë¡œ ë°˜í™˜.&quot;&quot;&quot;</span>
    <span class="n">result</span> <span class="o">=</span> <span class="n">subprocess</span><span class="o">.</span><span class="n">run</span><span class="p">(</span>
        <span class="p">[</span><span class="s1">&#39;sops&#39;</span><span class="p">,</span> <span class="s1">&#39;--decrypt&#39;</span><span class="p">,</span> <span class="n">path</span><span class="p">],</span>
        <span class="n">capture_output</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="n">text</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="n">check</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
    <span class="p">)</span>

    <span class="k">if</span> <span class="n">path</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="s1">&#39;.json&#39;</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">json</span><span class="o">.</span><span class="n">loads</span><span class="p">(</span><span class="n">result</span><span class="o">.</span><span class="n">stdout</span><span class="p">)</span>
    <span class="k">elif</span> <span class="n">path</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="s1">&#39;.yaml&#39;</span><span class="p">)</span> <span class="ow">or</span> <span class="n">path</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="s1">&#39;.yml&#39;</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">yaml</span><span class="o">.</span><span class="n">safe_load</span><span class="p">(</span><span class="n">result</span><span class="o">.</span><span class="n">stdout</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Unsupported file format: </span><span class="si">{</span><span class="n">path</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>


<span class="c1"># ì‚¬ìš©ë²•</span>
<span class="n">config</span> <span class="o">=</span> <span class="n">load_sops_config</span><span class="p">(</span><span class="s1">&#39;secrets.enc.yaml&#39;</span><span class="p">)</span>
<span class="n">db_password</span> <span class="o">=</span> <span class="n">config</span><span class="p">[</span><span class="s1">&#39;database&#39;</span><span class="p">][</span><span class="s1">&#39;password&#39;</span><span class="p">]</span>
</code></pre></div>

<hr />
<h2 id="9">9. ì¼ë°˜ì ì¸ ì‹¤ìˆ˜<a class="header-link" href="#9" title="Permanent link">&para;</a></h2>
<h3 id="91">9.1 ì•ˆí‹°íŒ¨í„´<a class="header-link" href="#91" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">ì¼ë°˜ì ì¸ secrets ê´€ë¦¬ ì‹¤ìˆ˜ â€” ì´ê²ƒë“¤ì„ í•˜ì§€ ë§ˆì„¸ìš”.</span>
<span class="sd">&quot;&quot;&quot;</span>

<span class="c1"># â”€â”€ ì‹¤ìˆ˜ 1: í•˜ë“œì½”ë”©ëœ secrets â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€</span>
<span class="c1"># ë‚˜ì¨</span>
<span class="n">API_KEY</span> <span class="o">=</span> <span class="s2">&quot;sk_live_EXAMPLE_KEY_REPLACE_ME&quot;</span>
<span class="n">DB_PASSWORD</span> <span class="o">=</span> <span class="s2">&quot;production_password_123&quot;</span>

<span class="c1"># ì¢‹ìŒ</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">os</span>
<span class="n">API_KEY</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">getenv</span><span class="p">(</span><span class="s2">&quot;API_KEY&quot;</span><span class="p">)</span>
<span class="n">DB_PASSWORD</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">getenv</span><span class="p">(</span><span class="s2">&quot;DB_PASSWORD&quot;</span><span class="p">)</span>


<span class="c1"># â”€â”€ ì‹¤ìˆ˜ 2: ë¡œê·¸ì˜ Secrets â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€</span>
<span class="c1"># ë‚˜ì¨</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">logging</span>
<span class="n">logger</span> <span class="o">=</span> <span class="n">logging</span><span class="o">.</span><span class="n">getLogger</span><span class="p">(</span><span class="vm">__name__</span><span class="p">)</span>
<span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Connecting to database with password: </span><span class="si">{</span><span class="n">password</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;API response: </span><span class="si">{</span><span class="n">response</span><span class="o">.</span><span class="n">headers</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>  <span class="c1"># ì¸ì¦ í—¤ë”ë¥¼ í¬í•¨í•  ìˆ˜ ìˆìŒ</span>

<span class="c1"># ì¢‹ìŒ</span>
<span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Connecting to database as user: </span><span class="si">%s</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">username</span><span class="p">)</span>
<span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;API response status: </span><span class="si">%s</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">response</span><span class="o">.</span><span class="n">status_code</span><span class="p">)</span>


<span class="c1"># â”€â”€ ì‹¤ìˆ˜ 3: URLì˜ Secrets â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€</span>
<span class="c1"># ë‚˜ì¨ â€” ë¹„ë°€ë²ˆí˜¸ê°€ ì„œë²„ ë¡œê·¸, ë¸Œë¼ìš°ì € íˆìŠ¤í† ë¦¬, Referer í—¤ë”ì— ë‚˜íƒ€ë‚¨</span>
<span class="n">DATABASE_URL</span> <span class="o">=</span> <span class="s2">&quot;postgresql://admin:P@ssw0rd@db.example.com/prod&quot;</span>

<span class="c1"># ì¢‹ìŒ â€” ë³„ë„ì˜ ë³€ìˆ˜ ì‚¬ìš©</span>
<span class="n">DATABASE_HOST</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">getenv</span><span class="p">(</span><span class="s2">&quot;DB_HOST&quot;</span><span class="p">)</span>
<span class="n">DATABASE_USER</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">getenv</span><span class="p">(</span><span class="s2">&quot;DB_USER&quot;</span><span class="p">)</span>
<span class="n">DATABASE_PASS</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">getenv</span><span class="p">(</span><span class="s2">&quot;DB_PASS&quot;</span><span class="p">)</span>


<span class="c1"># â”€â”€ ì‹¤ìˆ˜ 4: ì—ëŸ¬ ë©”ì‹œì§€ì˜ Secrets â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€</span>
<span class="c1"># ë‚˜ì¨</span>
<span class="k">try</span><span class="p">:</span>
    <span class="n">conn</span> <span class="o">=</span> <span class="n">connect</span><span class="p">(</span><span class="n">password</span><span class="o">=</span><span class="n">secret_password</span><span class="p">)</span>
<span class="k">except</span> <span class="ne">ConnectionError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
    <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Failed to connect with password </span><span class="si">{</span><span class="n">secret_password</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

<span class="c1"># ì¢‹ìŒ</span>
<span class="k">try</span><span class="p">:</span>
    <span class="n">conn</span> <span class="o">=</span> <span class="n">connect</span><span class="p">(</span><span class="n">password</span><span class="o">=</span><span class="n">secret_password</span><span class="p">)</span>
<span class="k">except</span> <span class="ne">ConnectionError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
    <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Database connection failed: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>


<span class="c1"># â”€â”€ ì‹¤ìˆ˜ 5: .envë¥¼ gitì— ì»¤ë°‹ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€</span>
<span class="c1"># ë‚˜ì¨: .gitignoreì—ì„œ .env ìŠìŒ</span>
<span class="c1"># ë” ë‚˜ì¨: .envë¥¼ ì¶”ê°€í•œ í›„ ì œê±° (íˆìŠ¤í† ë¦¬ì— ì—¬ì „íˆ ë‚¨ìŒ)</span>

<span class="c1"># ì¢‹ìŒ: íŒŒì¼ ìƒì„± ì „ì— .gitignoreì— ì¶”ê°€</span>
<span class="c1"># ê·¸ë¦¬ê³  ìš°ë°œì  ì»¤ë°‹ ë°©ì§€ë¥¼ ìœ„í•´ pre-commit í›… ì‚¬ìš©</span>


<span class="c1"># â”€â”€ ì‹¤ìˆ˜ 6: ëª¨ë“  í™˜ê²½ì—ì„œ ë™ì¼í•œ secret ì‚¬ìš© â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€</span>
<span class="c1"># ë‚˜ì¨: ê°œë°œ í™˜ê²½ì—ì„œ í”„ë¡œë•ì…˜ í‚¤ ì‚¬ìš©</span>
<span class="c1"># ì´ëŠ” ê°œë°œ ë¨¸ì‹  ì†ìƒì˜ í­ë°œ ë°˜ê²½ì„ ì¦ê°€ì‹œí‚´</span>

<span class="c1"># ì¢‹ìŒ: dev, staging, prodë¥¼ ìœ„í•œ ë‹¤ë¥¸ secrets</span>
<span class="c1"># ê°œë°œì€ í…ŒìŠ¤íŠ¸/ìƒŒë“œë°•ìŠ¤ API í‚¤ ì‚¬ìš©</span>
<span class="c1"># í”„ë¡œë•ì…˜ í‚¤ëŠ” í”„ë¡œë•ì…˜ ì„œë²„ì—ë§Œ ì¡´ì¬</span>


<span class="c1"># â”€â”€ ì‹¤ìˆ˜ 7: secretsë¥¼ ì ˆëŒ€ êµì²´í•˜ì§€ ì•ŠìŒ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€</span>
<span class="c1"># ë‚˜ì¨: 2019ë…„ì— ìƒì„±ëœ API í‚¤, ì ˆëŒ€ ë³€ê²½í•˜ì§€ ì•ŠìŒ</span>
<span class="c1"># ì†ìƒë˜ë©´ ê³µê²©ìê°€ ìˆ˜ë…„ê°„ ì•¡ì„¸ìŠ¤ ê¶Œí•œì„ ê°€ì¡ŒìŒ</span>

<span class="c1"># ì¢‹ìŒ: ë‹¤ìš´íƒ€ì„ ì—†ëŠ” ì „ëµìœ¼ë¡œ ìë™ êµì²´</span>


<span class="c1"># â”€â”€ ì‹¤ìˆ˜ 8: íŒ€ì› ê°„ secrets ê³µìœ  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€</span>
<span class="c1"># ë‚˜ì¨: &quot;í”„ë¡œë•ì…˜ DB ë¹„ë°€ë²ˆí˜¸ë¥¼ Slackìœ¼ë¡œ ë³´ë‚´ì¤„ ìˆ˜ ìˆë‚˜ìš”?&quot;</span>

<span class="c1"># ì¢‹ìŒ:</span>
<span class="c1"># - secret ê´€ë¦¬ì ì‚¬ìš© (Vault, AWS SM, 1Password)</span>
<span class="c1"># - ê° ì‚¬ëŒì´ ìì‹ ì˜ ìê²© ì¦ëª…ì„ ê°€ì§</span>
<span class="c1"># - ê°€ëŠ¥í•œ ê³³ì—ì„œ SSO/OIDC ì‚¬ìš© (ê³µìœ  secrets ì—†ìŒ)</span>
<span class="c1"># - SecretsëŠ” ì‚¬ëŒì´ ì•„ë‹Œ í”„ë¡œê·¸ë˜ë° ë°©ì‹ìœ¼ë¡œ ì•¡ì„¸ìŠ¤ë¨</span>


<span class="c1"># â”€â”€ ì‹¤ìˆ˜ 9: Docker ì´ë¯¸ì§€ì˜ Secrets â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€</span>
<span class="c1"># ë‚˜ì¨</span>
<span class="c1"># Dockerfile:</span>
<span class="c1"># ENV API_KEY=sk_live_xxxxx</span>
<span class="c1"># COPY .env /app/.env</span>

<span class="c1"># ì¢‹ìŒ: ëŸ°íƒ€ì„ì— ì£¼ì…</span>
<span class="c1"># docker run -e API_KEY=$API_KEY myimage</span>
<span class="c1"># ë˜ëŠ” Docker secrets / Kubernetes secrets ì‚¬ìš©</span>


<span class="c1"># â”€â”€ ì‹¤ìˆ˜ 10: í´ë¼ì´ì–¸íŠ¸ ì¸¡ secrets â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€</span>
<span class="c1"># ë‚˜ì¨: JavaScript/ëª¨ë°”ì¼ ì•±ì— API í‚¤ ì„ë² ë”©</span>
<span class="c1"># &lt;script&gt;</span>
<span class="c1">#   const API_KEY = &quot;sk_live_xxxxx&quot;;  // ëˆ„êµ¬ë‚˜ ë³¼ ìˆ˜ ìˆìŒ</span>
<span class="c1"># &lt;/script&gt;</span>

<span class="c1"># ì¢‹ìŒ: ë°±ì—”ë“œ í”„ë¡ì‹œ ì‚¬ìš©</span>
<span class="c1"># í´ë¼ì´ì–¸íŠ¸ â†’ ë‹¹ì‹ ì˜ ë°±ì—”ë“œ (secret ë³´ìœ ) â†’ ì„œë“œíŒŒí‹° API</span>
</code></pre></div>

<h3 id="92-secret">9.2 Secret ê°ì§€ ì²´í¬ë¦¬ìŠ¤íŠ¸<a class="header-link" href="#92-secret" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">ì½”ë“œì—ì„œ ì¼ë°˜ì ì¸ secret íŒ¨í„´ì— ëŒ€í•œ ìë™ í™•ì¸.</span>
<span class="sd">&quot;&quot;&quot;</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">re</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">pathlib</span><span class="w"> </span><span class="kn">import</span> <span class="n">Path</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">dataclasses</span><span class="w"> </span><span class="kn">import</span> <span class="n">dataclass</span>

<span class="nd">@dataclass</span>
<span class="k">class</span><span class="w"> </span><span class="nc">SecretFinding</span><span class="p">:</span>
    <span class="n">file</span><span class="p">:</span> <span class="nb">str</span>
    <span class="n">line_number</span><span class="p">:</span> <span class="nb">int</span>
    <span class="n">pattern_name</span><span class="p">:</span> <span class="nb">str</span>
    <span class="n">matched_text</span><span class="p">:</span> <span class="nb">str</span>

<span class="c1"># ì ì¬ì  secretsë¥¼ ë‚˜íƒ€ë‚´ëŠ” íŒ¨í„´</span>
<span class="n">SECRET_PATTERNS</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s2">&quot;aws_access_key&quot;</span><span class="p">:</span> <span class="n">re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span>
        <span class="sa">r</span><span class="s1">&#39;(?:A3T[A-Z0-9]|AKIA|AGPA|AIDA|AROA|AIPA|ANPA|ANVA|ASIA)&#39;</span>
        <span class="sa">r</span><span class="s1">&#39;[A-Z0-9]</span><span class="si">{16}</span><span class="s1">&#39;</span>
    <span class="p">),</span>
    <span class="s2">&quot;aws_secret_key&quot;</span><span class="p">:</span> <span class="n">re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span>
        <span class="sa">r</span><span class="s1">&#39;(?i)aws_secret_access_key\s*[=:]\s*[&quot;</span><span class="se">\&#39;</span><span class="s1">]?[A-Za-z0-9/+=]</span><span class="si">{40}</span><span class="s1">&#39;</span>
    <span class="p">),</span>
    <span class="s2">&quot;generic_password&quot;</span><span class="p">:</span> <span class="n">re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span>
        <span class="sa">r</span><span class="s1">&#39;(?i)(password|passwd|pwd)\s*[=:]\s*[&quot;</span><span class="se">\&#39;</span><span class="s1">][^&quot;</span><span class="se">\&#39;</span><span class="s1">]{8,}[&quot;</span><span class="se">\&#39;</span><span class="s1">]&#39;</span>
    <span class="p">),</span>
    <span class="s2">&quot;generic_api_key&quot;</span><span class="p">:</span> <span class="n">re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span>
        <span class="sa">r</span><span class="s1">&#39;(?i)(api[_-]?key|apikey)\s*[=:]\s*[&quot;</span><span class="se">\&#39;</span><span class="s1">][A-Za-z0-9_\-]{20,}[&quot;</span><span class="se">\&#39;</span><span class="s1">]&#39;</span>
    <span class="p">),</span>
    <span class="s2">&quot;private_key&quot;</span><span class="p">:</span> <span class="n">re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span>
        <span class="sa">r</span><span class="s1">&#39;-----BEGIN (?:RSA|EC|DSA|OPENSSH)? ?PRIVATE KEY-----&#39;</span>
    <span class="p">),</span>
    <span class="s2">&quot;jwt_token&quot;</span><span class="p">:</span> <span class="n">re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span>
        <span class="sa">r</span><span class="s1">&#39;eyJ[A-Za-z0-9_-]{10,}\.eyJ[A-Za-z0-9_-]{10,}\.[A-Za-z0-9_-]+&#39;</span>
    <span class="p">),</span>
    <span class="s2">&quot;github_token&quot;</span><span class="p">:</span> <span class="n">re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span>
        <span class="sa">r</span><span class="s1">&#39;gh[pousr]_[A-Za-z0-9_]{36,}&#39;</span>
    <span class="p">),</span>
    <span class="s2">&quot;slack_webhook&quot;</span><span class="p">:</span> <span class="n">re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span>
        <span class="sa">r</span><span class="s1">&#39;https://hooks\.slack\.com/services/T[a-zA-Z0-9_]+/B[a-zA-Z0-9_]+/[a-zA-Z0-9_]+&#39;</span>
    <span class="p">),</span>
    <span class="s2">&quot;stripe_key&quot;</span><span class="p">:</span> <span class="n">re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span>
        <span class="sa">r</span><span class="s1">&#39;[sr]k_(live|test)_[A-Za-z0-9]{20,}&#39;</span>
    <span class="p">),</span>
<span class="p">}</span>

<span class="c1"># ì˜¤íƒì§€ë¥¼ ë‚˜íƒ€ë‚´ëŠ” íŒ¨í„´</span>
<span class="n">FALSE_POSITIVE_PATTERNS</span> <span class="o">=</span> <span class="p">[</span>
    <span class="n">re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;(?i)password\s*=\s*os\.getenv&#39;</span><span class="p">),</span>
    <span class="n">re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;(?i)password\s*=\s*[&quot;</span><span class="se">\&#39;</span><span class="s1">]changeme[&quot;</span><span class="se">\&#39;</span><span class="s1">]&#39;</span><span class="p">),</span>
    <span class="n">re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;(?i)password\s*=\s*[&quot;</span><span class="se">\&#39;</span><span class="s1">]&lt;.*&gt;[&quot;</span><span class="se">\&#39;</span><span class="s1">]&#39;</span><span class="p">),</span>
    <span class="n">re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;(?i)password\s*=\s*[&quot;</span><span class="se">\&#39;</span><span class="s1">]your_password_here[&quot;</span><span class="se">\&#39;</span><span class="s1">]&#39;</span><span class="p">),</span>
    <span class="n">re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;(?i)password\s*=\s*[&quot;</span><span class="se">\&#39;</span><span class="s1">]placeholder[&quot;</span><span class="se">\&#39;</span><span class="s1">]&#39;</span><span class="p">),</span>
    <span class="n">re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;#.*password&#39;</span><span class="p">),</span>  <span class="c1"># ì£¼ì„</span>
<span class="p">]</span>

<span class="n">SKIP_DIRS</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;.git&#39;</span><span class="p">,</span> <span class="s1">&#39;node_modules&#39;</span><span class="p">,</span> <span class="s1">&#39;__pycache__&#39;</span><span class="p">,</span> <span class="s1">&#39;.venv&#39;</span><span class="p">,</span> <span class="s1">&#39;venv&#39;</span><span class="p">}</span>
<span class="n">SKIP_EXTENSIONS</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;.pyc&#39;</span><span class="p">,</span> <span class="s1">&#39;.pyo&#39;</span><span class="p">,</span> <span class="s1">&#39;.so&#39;</span><span class="p">,</span> <span class="s1">&#39;.dylib&#39;</span><span class="p">,</span> <span class="s1">&#39;.png&#39;</span><span class="p">,</span> <span class="s1">&#39;.jpg&#39;</span><span class="p">,</span> <span class="s1">&#39;.gif&#39;</span><span class="p">}</span>


<span class="k">def</span><span class="w"> </span><span class="nf">scan_directory</span><span class="p">(</span><span class="n">root</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">[</span><span class="n">SecretFinding</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;ë””ë ‰í† ë¦¬ì—ì„œ ì ì¬ì  secrets ìŠ¤ìº”.&quot;&quot;&quot;</span>
    <span class="n">findings</span> <span class="o">=</span> <span class="p">[]</span>

    <span class="k">for</span> <span class="n">path</span> <span class="ow">in</span> <span class="n">Path</span><span class="p">(</span><span class="n">root</span><span class="p">)</span><span class="o">.</span><span class="n">rglob</span><span class="p">(</span><span class="s1">&#39;*&#39;</span><span class="p">):</span>
        <span class="c1"># ë””ë ‰í† ë¦¬ ê±´ë„ˆë›°ê¸°</span>
        <span class="k">if</span> <span class="nb">any</span><span class="p">(</span><span class="n">part</span> <span class="ow">in</span> <span class="n">SKIP_DIRS</span> <span class="k">for</span> <span class="n">part</span> <span class="ow">in</span> <span class="n">path</span><span class="o">.</span><span class="n">parts</span><span class="p">):</span>
            <span class="k">continue</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">path</span><span class="o">.</span><span class="n">is_file</span><span class="p">():</span>
            <span class="k">continue</span>
        <span class="k">if</span> <span class="n">path</span><span class="o">.</span><span class="n">suffix</span> <span class="ow">in</span> <span class="n">SKIP_EXTENSIONS</span><span class="p">:</span>
            <span class="k">continue</span>

        <span class="k">try</span><span class="p">:</span>
            <span class="n">content</span> <span class="o">=</span> <span class="n">path</span><span class="o">.</span><span class="n">read_text</span><span class="p">(</span><span class="n">encoding</span><span class="o">=</span><span class="s1">&#39;utf-8&#39;</span><span class="p">,</span> <span class="n">errors</span><span class="o">=</span><span class="s1">&#39;ignore&#39;</span><span class="p">)</span>
        <span class="k">except</span> <span class="p">(</span><span class="ne">PermissionError</span><span class="p">,</span> <span class="ne">UnicodeDecodeError</span><span class="p">):</span>
            <span class="k">continue</span>

        <span class="k">for</span> <span class="n">line_num</span><span class="p">,</span> <span class="n">line</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">content</span><span class="o">.</span><span class="n">splitlines</span><span class="p">(),</span> <span class="mi">1</span><span class="p">):</span>
            <span class="k">for</span> <span class="n">pattern_name</span><span class="p">,</span> <span class="n">pattern</span> <span class="ow">in</span> <span class="n">SECRET_PATTERNS</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                <span class="k">if</span> <span class="n">pattern</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="n">line</span><span class="p">):</span>
                    <span class="c1"># ì˜¤íƒì§€ í™•ì¸</span>
                    <span class="n">is_false_positive</span> <span class="o">=</span> <span class="nb">any</span><span class="p">(</span>
                        <span class="n">fp</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="n">line</span><span class="p">)</span> <span class="k">for</span> <span class="n">fp</span> <span class="ow">in</span> <span class="n">FALSE_POSITIVE_PATTERNS</span>
                    <span class="p">)</span>
                    <span class="k">if</span> <span class="ow">not</span> <span class="n">is_false_positive</span><span class="p">:</span>
                        <span class="n">findings</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">SecretFinding</span><span class="p">(</span>
                            <span class="n">file</span><span class="o">=</span><span class="nb">str</span><span class="p">(</span><span class="n">path</span><span class="p">),</span>
                            <span class="n">line_number</span><span class="o">=</span><span class="n">line_num</span><span class="p">,</span>
                            <span class="n">pattern_name</span><span class="o">=</span><span class="n">pattern_name</span><span class="p">,</span>
                            <span class="n">matched_text</span><span class="o">=</span><span class="n">line</span><span class="o">.</span><span class="n">strip</span><span class="p">()[:</span><span class="mi">100</span><span class="p">],</span>
                        <span class="p">))</span>

    <span class="k">return</span> <span class="n">findings</span>


<span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s1">&#39;__main__&#39;</span><span class="p">:</span>
    <span class="kn">import</span><span class="w"> </span><span class="nn">sys</span>
    <span class="n">root</span> <span class="o">=</span> <span class="n">sys</span><span class="o">.</span><span class="n">argv</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">sys</span><span class="o">.</span><span class="n">argv</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span> <span class="k">else</span> <span class="s1">&#39;.&#39;</span>
    <span class="n">findings</span> <span class="o">=</span> <span class="n">scan_directory</span><span class="p">(</span><span class="n">root</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">findings</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Found </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">findings</span><span class="p">)</span><span class="si">}</span><span class="s2"> potential secrets:</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="n">findings</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  [</span><span class="si">{</span><span class="n">f</span><span class="o">.</span><span class="n">pattern_name</span><span class="si">}</span><span class="s2">] </span><span class="si">{</span><span class="n">f</span><span class="o">.</span><span class="n">file</span><span class="si">}</span><span class="s2">:</span><span class="si">{</span><span class="n">f</span><span class="o">.</span><span class="n">line_number</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;    </span><span class="si">{</span><span class="n">f</span><span class="o">.</span><span class="n">matched_text</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="nb">print</span><span class="p">()</span>
        <span class="n">sys</span><span class="o">.</span><span class="n">exit</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;No secrets detected.&quot;</span><span class="p">)</span>
        <span class="n">sys</span><span class="o">.</span><span class="n">exit</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
</code></pre></div>

<hr />
<h2 id="10">10. ì—°ìŠµ ë¬¸ì œ<a class="header-link" href="#10" title="Permanent link">&para;</a></h2>
<h3 id="1">ì—°ìŠµ ë¬¸ì œ 1: í™˜ê²½ êµ¬ì„± ì‹œìŠ¤í…œ<a class="header-link" href="#1" title="Permanent link">&para;</a></h3>
<p>ë‹¤ìŒì„ ìˆ˜í–‰í•˜ëŠ” êµ¬ì„± ê´€ë¦¬ ì‹œìŠ¤í…œ êµ¬ì¶•:</p>
<ol>
<li>ìš°ì„ ìˆœìœ„ ìˆœì„œë¡œ ì—¬ëŸ¬ ì†ŒìŠ¤ì—ì„œ ì„¤ì • ë¡œë“œ:</li>
<li>í™˜ê²½ ë³€ìˆ˜(ìµœìš°ì„ )</li>
<li><code>.env.local</code> íŒŒì¼</li>
<li><code>.env</code> íŒŒì¼</li>
<li>ê¸°ë³¸ê°’(ìµœí•˜ìœ„)</li>
<li>ì‹œì‘ ì‹œ ëª¨ë“  í•„ìˆ˜ ì„¤ì • ê²€ì¦(ë¹ ë¥¸ ì‹¤íŒ¨)</li>
<li>Pydantic <code>SecretStr</code>ì„ ì‚¬ìš©í•˜ì—¬ ìš°ë°œì  secrets ë¡œê¹… ë°©ì§€</li>
<li>secretsë¥¼ ë§ˆìŠ¤í‚¹í•˜ì—¬ ëª¨ë“  ì„¤ì •ì„ ë³´ì—¬ì£¼ëŠ” <code>config.dump_safe()</code> ë©”ì„œë“œ ì œê³µ</li>
<li>íƒ€ì… ê°•ì œ ì§€ì›(ë¬¸ìì—´ì„ int, bool, listë¡œ)</li>
<li>ìš°ì„ ìˆœìœ„ ìˆœì„œì™€ ê²€ì¦ì„ í™•ì¸í•˜ëŠ” í…ŒìŠ¤íŠ¸ ì‘ì„±</li>
</ol>
<h3 id="2-secret">ì—°ìŠµ ë¬¸ì œ 2: Secret êµì²´ ì„œë¹„ìŠ¤<a class="header-link" href="#2-secret" title="Permanent link">&para;</a></h3>
<p>ë‹¤ìŒì„ ìˆ˜í–‰í•˜ëŠ” ìë™ secret êµì²´ ì„œë¹„ìŠ¤ êµ¬í˜„:</p>
<ol>
<li>êµ¬ì„± ê°€ëŠ¥í•œ êµì²´ ê°„ê²©ìœ¼ë¡œ secrets ì„¸íŠ¸ ê´€ë¦¬</li>
<li>ë‹¤ìš´íƒ€ì„ ì—†ëŠ” êµì²´ ì§€ì›(ì´ì¤‘ secret ê¸°ê°„)</li>
<li>secretsê°€ êµì²´ë  ë•Œ ë“±ë¡ëœ ì†Œë¹„ìì—ê²Œ ì•Œë¦¼</li>
<li>ê°ì‚¬ë¥¼ ìœ„í•œ ëª¨ë“  êµì²´ ì´ë²¤íŠ¸ ê¸°ë¡</li>
<li>ìƒˆ secret ê²€ì¦ ì‹¤íŒ¨ ì‹œ ë¡¤ë°± ì§€ì›</li>
<li>ìŠ¤ì¼€ì¤„ëŸ¬ì™€ í†µí•© ê°€ëŠ¥(ë§¤ì‹œê°„ êµì²´ í™•ì¸ ì‹¤í–‰)</li>
<li>ê·œì • ì¤€ìˆ˜ë¥¼ ìœ„í•œ êµì²´ íˆìŠ¤í† ë¦¬ ì €ì¥</li>
</ol>
<h3 id="3-git-secret">ì—°ìŠµ ë¬¸ì œ 3: Git Secret ìŠ¤ìºë„ˆ<a class="header-link" href="#3-git-secret" title="Permanent link">&para;</a></h3>
<p>ë‹¤ìŒì„ ìˆ˜í–‰í•˜ëŠ” í¬ê´„ì ì¸ git secret ìŠ¤ìºë„ˆ êµ¬ì¶•:</p>
<ol>
<li>ìŠ¤í…Œì´ì§•ëœ íŒŒì¼ ìŠ¤ìº”(pre-commit í›…)</li>
<li>ê³¼ê±° ìœ ì¶œì„ ìœ„í•œ ì „ì²´ git íˆìŠ¤í† ë¦¬ ìŠ¤ìº”</li>
<li>êµ¬ì„± ê°€ëŠ¥í•œ íŒ¨í„´ ì§€ì›(ì •ê·œì‹ ê¸°ë°˜)</li>
<li>ì•Œë ¤ì§„ ì˜¤íƒì§€ë¥¼ ìœ„í•œ ë² ì´ìŠ¤ë¼ì¸/í—ˆìš© ëª©ë¡</li>
<li>JSON ë° ì‚¬ëŒì´ ì½ì„ ìˆ˜ ìˆëŠ” í˜•ì‹ìœ¼ë¡œ ë³´ê³ ì„œ ìƒì„±</li>
<li>pre-commit í›… ë˜ëŠ” CI/CD ë‹¨ê³„ë¡œ ì‹¤í–‰ ê°€ëŠ¥</li>
<li>ì¦ë¶„ ìŠ¤ìºë‹ ì§€ì›(ìƒˆ ì»¤ë°‹ë§Œ)</li>
</ol>
<h3 id="4-vault">ì—°ìŠµ ë¬¸ì œ 4: Vault í†µí•© ë¼ì´ë¸ŒëŸ¬ë¦¬<a class="header-link" href="#4-vault" title="Permanent link">&para;</a></h3>
<p>ë‹¤ìŒì„ ìˆ˜í–‰í•˜ëŠ” Python ë¼ì´ë¸ŒëŸ¬ë¦¬ ìƒì„±:</p>
<ol>
<li>AppRole ë˜ëŠ” Tokenì„ ì‚¬ìš©í•˜ì—¬ Vaultì— ì¸ì¦</li>
<li>TTLë¡œ secretsë¥¼ ë¡œì»¬ì— ìºì‹±(ë°˜ë³µë˜ëŠ” Vault í˜¸ì¶œ ë°©ì§€)</li>
<li>ë§Œë£Œ ì „ì— secrets ìë™ ê°±ì‹ </li>
<li>Vaultë¥¼ ì‚¬ìš©í•  ìˆ˜ ì—†ì„ ë•Œ í™˜ê²½ ë³€ìˆ˜ë¡œ í´ë°±</li>
<li>Django/Flask ì„¤ì • í†µí•© ì œê³µ</li>
<li>Vault í† í° ê°±ì‹ ì„ íˆ¬ëª…í•˜ê²Œ ì²˜ë¦¬</li>
<li>secret ê°’ì„ ë“œëŸ¬ë‚´ì§€ ì•Šê³  ì•¡ì„¸ìŠ¤ íŒ¨í„´ ê¸°ë¡</li>
</ol>
<h3 id="5-sops">ì—°ìŠµ ë¬¸ì œ 5: SOPS ì›Œí¬í”Œë¡œ ìë™í™”<a class="header-link" href="#5-sops" title="Permanent link">&para;</a></h3>
<p>ë‹¤ìŒì„ ìˆ˜í–‰í•˜ëŠ” ëª…ë ¹ì¤„ ë„êµ¬ êµ¬ì¶•:</p>
<ol>
<li>ì—¬ëŸ¬ í™˜ê²½(dev, staging, prod)ì„ ìœ„í•œ ì•”í˜¸í™”ëœ êµ¬ì„± íŒŒì¼ ìƒì„±</li>
<li>ì•”í˜¸í™”ëœ íŒŒì¼ì— í•„ìš”í•œ ëª¨ë“  í‚¤ê°€ í¬í•¨ë˜ì–´ ìˆëŠ”ì§€ ê²€ì¦</li>
<li>ë³µí˜¸í™”í•˜ì§€ ì•Šê³  ë‘ ì•”í˜¸í™”ëœ íŒŒì¼ diff(êµ¬ì¡° ë¹„êµ)</li>
<li>ì•”í˜¸í™” í‚¤ êµì²´(ìƒˆ í‚¤ë¡œ ëª¨ë“  íŒŒì¼ ì¬ì•”í˜¸í™”)</li>
<li>ì•”í˜¸í™”ë˜ì§€ ì•Šì€ íŒŒì¼ì˜ ì»¤ë°‹ì„ ë°©ì§€í•˜ê¸° ìœ„í•´ git í›…ê³¼ í†µí•©</li>
<li>ë¡œì»¬ ê°œë°œì„ ìœ„í•´ ì•”í˜¸í™”ëœ êµ¬ì„±ì—ì„œ <code>.env</code> íŒŒì¼ ìƒì„±</li>
</ol>
<h3 id="6-cicd-secrets">ì—°ìŠµ ë¬¸ì œ 6: CI/CD Secrets ê°ì‚¬<a class="header-link" href="#6-cicd-secrets" title="Permanent link">&para;</a></h3>
<p>ë‹¤ìŒì„ ìˆ˜í–‰í•˜ëŠ” ê°ì‚¬ ë„êµ¬ ì‘ì„±:</p>
<ol>
<li>secret ì‚¬ìš© íŒ¨í„´ì„ ìœ„í•œ GitHub Actions ì›Œí¬í”Œë¡œ íŒŒì¼ ìŠ¤ìº”</li>
<li>ì•ˆì „í•˜ì§€ ì•Šê²Œ ì „ë‹¬ëœ secrets ì‹ë³„(ì˜ˆ: ë¡œê·¸ì— ë³´ì´ëŠ” ëª…ë ¹ ì¸ì)</li>
<li>actionsê°€ SHAì— ê³ ì •ë˜ì–´ ìˆëŠ”ì§€ í™•ì¸(ë³€ê²½ ê°€ëŠ¥í•œ íƒœê·¸ ì•„ë‹˜)</li>
<li>secretsê°€ ì˜¬ë°”ë¥¸ í™˜ê²½ìœ¼ë¡œ ë²”ìœ„ ì§€ì •ë˜ì—ˆëŠ”ì§€ í™•ì¸</li>
<li><code>GITHUB_TOKEN</code> ê¶Œí•œì´ ê³¼ë„í•˜ê²Œ ë„“ì€ì§€ ê°ì§€</li>
<li>ê·œì • ì¤€ìˆ˜ ë³´ê³ ì„œ ìƒì„±</li>
</ol>
<hr />
<h2 id="_2">ìš”ì•½<a class="header-link" href="#_2" title="Permanent link">&para;</a></h2>
<h3 id="secrets">Secrets ê´€ë¦¬ ì„±ìˆ™ë„ ëª¨ë¸<a class="header-link" href="#secrets" title="Permanent link">&para;</a></h3>
<table>
<thead>
<tr>
<th>ë ˆë²¨</th>
<th>ì„¤ëª…</th>
<th>ì‹¤ì²œì‚¬í•­</th>
</tr>
</thead>
<tbody>
<tr>
<td>ë ˆë²¨ 0</td>
<td>ê´€ë¦¬ ì—†ìŒ</td>
<td>í•˜ë“œì½”ë”©ëœ secrets, gitì— ì»¤ë°‹ë¨</td>
</tr>
<tr>
<td>ë ˆë²¨ 1</td>
<td>ê¸°ë³¸</td>
<td>.env íŒŒì¼, .gitignore, ìˆ˜ë™ êµì²´</td>
</tr>
<tr>
<td>ë ˆë²¨ 2</td>
<td>ì¤‘ê¸‰</td>
<td>Secret ê´€ë¦¬ì(Vault/í´ë¼ìš°ë“œ), pre-commit í›…</td>
</tr>
<tr>
<td>ë ˆë²¨ 3</td>
<td>ê³ ê¸‰</td>
<td>ìë™ êµì²´, ë™ì  secrets, ê°ì‚¬ ë¡œê¹…</td>
</tr>
<tr>
<td>ë ˆë²¨ 4</td>
<td>ìµœì </td>
<td>ì œë¡œ íŠ¸ëŸ¬ìŠ¤íŠ¸, ëª¨ë“  ê³³ì— OIDC, ì—°ì† ìŠ¤ìºë‹</td>
</tr>
</tbody>
</table>
<h3 id="_3">í•µì‹¬ ìš”ì <a class="header-link" href="#_3" title="Permanent link">&para;</a></h3>
<ol>
<li><strong>ì ˆëŒ€ secretsë¥¼ í•˜ë“œì½”ë”©í•˜ì§€ ë§ ê²ƒ</strong> â€” í™˜ê²½ ë³€ìˆ˜ ë˜ëŠ” secret ê´€ë¦¬ì ì‚¬ìš©</li>
<li><strong>ì§€ì†ì ìœ¼ë¡œ ìŠ¤ìº”</strong> â€” pre-commit í›…ê³¼ CI/CD ìŠ¤ìºë‹ ì‚¬ìš©</li>
<li><strong>ì •ê¸°ì ìœ¼ë¡œ êµì²´</strong> â€” ë‹¤ìš´íƒ€ì„ ì—†ëŠ” íŒ¨í„´ìœ¼ë¡œ êµì²´ ìë™í™”</li>
<li><strong>ì €ì¥ ì‹œ ì•”í˜¸í™”</strong> â€” SOPS, Vault Transit ë˜ëŠ” í´ë¼ìš°ë“œ KMS ì‚¬ìš©</li>
<li><strong>ì•¡ì„¸ìŠ¤ ê°ì‚¬</strong> â€” ëˆ„ê°€ ì–¸ì œ ì–´ë–¤ secretì— ì•¡ì„¸ìŠ¤í–ˆëŠ”ì§€ ê¸°ë¡</li>
<li><strong>ë…¸ì¶œ ìµœì†Œí™”</strong> â€” ë‹¨ê¸°ê°„ ìê²© ì¦ëª…ê³¼ ìµœì†Œ ê¶Œí•œ ì‚¬ìš©</li>
<li><strong>ì†ìƒ ê³„íš</strong> â€” secret ìœ ì¶œ ì‹œ(ì–¸ì œê°€ ì•„ë‹ˆë¼)ë¥¼ ìœ„í•œ ëŸ°ë¶ ì¤€ë¹„</li>
</ol>
<hr />
<p><strong>ì´ì „</strong>: <a href="./10_API_Security.md">10_API_Security.md</a> | <strong>ë‹¤ìŒ</strong>: <a href="./12_Container_Security.md">12_Container_Security.md</a></p>
    </div>

    
<div class="lesson-toolbar lesson-toolbar--bottom">
    <div class="toolbar-nav toolbar-nav--prev">
        
        <a href="/study/ko/Security/10_API_Security.html" class="nav-prev">
            <span class="nav-label">Previous</span>
            <span class="nav-title">API ë³´ì•ˆ</span>
        </a>
        
    </div>
    <div class="toolbar-actions">
        <button class="btn btn-copy-link" data-action="copy-link" title="Copy link">
            <span class="icon">ğŸ”—</span>
            <span class="text">Copy link</span>
        </button>
        <a href="/study/ko/Security/" class="btn btn-topic-link" title="Back to topic list">
            <span class="icon">ğŸ“‹</span>
            <span class="text">Topic list</span>
        </a>
    </div>
    <div class="toolbar-nav toolbar-nav--next">
        
        <a href="/study/ko/Security/12_Container_Security.html" class="nav-next">
            <span class="nav-label">Next</span>
            <span class="nav-title">ì»¨í…Œì´ë„ˆ ë° í´ë¼ìš°ë“œ ë³´ì•ˆ</span>
        </a>
        
    </div>
</div>


    <div class="toolbar-keyboard-hint">
        <kbd>&larr;</kbd> <kbd>&rarr;</kbd> to navigate between lessons
    </div>
</article>

<!-- Scroll to top floating button -->
<button class="scroll-to-top" id="scroll-to-top" title="Scroll to top" aria-label="Scroll to top">â†‘</button>

            </div>
        </main>
    </div>

    <script src="/study/static/js/app.js"></script>
    <script>
        function switchLanguage(newLang) {
            const path = window.location.pathname;
            const base = '/study';
            const currentLang = 'ko';
            const newPath = path.replace(base + '/' + currentLang + '/', base + '/' + newLang + '/');
            window.location.href = newPath + window.location.search;
        }
    </script>
    
<script>
    document.addEventListener('DOMContentLoaded', function() {
        // Copy link - independent feedback per button
        document.querySelectorAll('[data-action="copy-link"]').forEach(function(btn) {
            btn.addEventListener('click', function() {
                navigator.clipboard.writeText(window.location.href);
                var textEl = this.querySelector('.text');
                var originalText = textEl.textContent;
                textEl.textContent = 'Copied!';
                setTimeout(function() { textEl.textContent = originalText; }, 2000);
            });
        });

        // Add copy buttons to code blocks
        document.querySelectorAll('.lesson-content pre').forEach(function(pre) {
            var copyBtn = document.createElement('button');
            copyBtn.className = 'code-copy-btn';
            copyBtn.textContent = 'Copy';
            copyBtn.addEventListener('click', function() {
                var code = pre.querySelector('code');
                var text = code ? code.textContent : pre.textContent;
                navigator.clipboard.writeText(text);
                copyBtn.textContent = 'Copied!';
                setTimeout(function() { copyBtn.textContent = 'Copy'; }, 2000);
            });
            pre.style.position = 'relative';
            pre.appendChild(copyBtn);
        });

        // Scroll to top button
        var scrollBtn = document.getElementById('scroll-to-top');
        window.addEventListener('scroll', function() {
            scrollBtn.classList.toggle('visible', window.scrollY > 300);
        });
        scrollBtn.addEventListener('click', function() {
            window.scrollTo({ top: 0, behavior: 'smooth' });
        });

        // Keyboard shortcuts: left/right arrows for lesson navigation
        document.addEventListener('keydown', function(e) {
            var tag = document.activeElement.tagName;
            if (tag === 'INPUT' || tag === 'TEXTAREA' || tag === 'SELECT') return;

            if (e.key === 'ArrowLeft') {
                var prevLink = document.querySelector('.nav-prev');
                if (prevLink) prevLink.click();
            } else if (e.key === 'ArrowRight') {
                var nextLink = document.querySelector('.nav-next');
                if (nextLink) nextLink.click();
            }
        });
    });
</script>

</body>
</html>
{% endraw %}