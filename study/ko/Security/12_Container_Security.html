{% raw %}
<!DOCTYPE html>
<html lang="ko" data-theme="light">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>컨테이너 및 클라우드 보안 - Study Materials</title>
    <link rel="stylesheet" href="/study/static/css/style.css">
    <link rel="stylesheet" href="/study/static/css/highlight.css">
    <!-- KaTeX for LaTeX math rendering -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.16.11/dist/katex.min.css">
    <script defer src="https://cdn.jsdelivr.net/npm/katex@0.16.11/dist/katex.min.js"></script>
    <script defer src="https://cdn.jsdelivr.net/npm/katex@0.16.11/dist/contrib/auto-render.min.js"
        onload="renderMathInElement(document.body, {
            delimiters: [
                {left: '$$', right: '$$', display: true},
                {left: '$', right: '$', display: false}
            ],
            throwOnError: false
        });"></script>
    
</head>
<body>
    <div class="app-container">
        <!-- Sidebar -->
        <aside class="sidebar" id="sidebar">
            <div class="sidebar-header">
                <a href="/study/ko/" class="logo">Study Materials</a>
                <button class="sidebar-toggle" id="sidebar-toggle" aria-label="Toggle sidebar">
                    <span></span>
                </button>
            </div>

            <nav class="sidebar-nav">
                <a href="/study/ko/" class="nav-item ">
                    <span class="nav-icon">🏠</span>
                    <span class="nav-text">Home</span>
                </a>
                <a href="/study/examples/" class="nav-item ">
                    <span class="nav-icon">💻</span>
                    <span class="nav-text">Examples</span>
                </a>
            </nav>

            <div class="sidebar-search">
                <form action="/study/ko/search.html" method="get" id="search-form">
                    <input type="search" name="q" placeholder="Search..." id="search-sidebar-input">
                </form>
            </div>

            <!-- Language Selector -->
            <div class="sidebar-lang">
                <select id="lang-select" class="lang-selector" onchange="switchLanguage(this.value)">
                    
                    <option value="en" >
                        English
                    </option>
                    
                    <option value="ko" selected>
                        한국어
                    </option>
                    
                </select>
            </div>

            <div class="sidebar-footer">
                <button class="theme-toggle" id="theme-toggle" aria-label="Toggle theme">
                    <span class="theme-icon light">☀️</span>
                    <span class="theme-icon dark">🌙</span>
                </button>
            </div>
        </aside>

        <!-- Main Content -->
        <main class="main-content">
            <header class="main-header">
                <button class="menu-toggle" id="menu-toggle" aria-label="Open menu">
                    <span></span>
                </button>
                
<nav class="breadcrumb">
    <a href="/study/ko/">Topics</a>
    <span class="separator">/</span>
    <a href="/study/ko/Security/">Security</a>
    <span class="separator">/</span>
    <span class="current">컨테이너 및 클라우드 보안</span>
</nav>

            </header>

            <div class="content">
                
<article class="lesson-article">
    <header class="lesson-header">
        <h1>컨테이너 및 클라우드 보안</h1>
    </header>

    
<div class="lesson-toolbar lesson-toolbar--top">
    <div class="toolbar-nav toolbar-nav--prev">
        
        <a href="/study/ko/Security/11_Secrets_Management.html" class="nav-prev">
            <span class="nav-label">Previous</span>
            <span class="nav-title">Secrets Management와 환경 설정</span>
        </a>
        
    </div>
    <div class="toolbar-actions">
        <button class="btn btn-copy-link" data-action="copy-link" title="Copy link">
            <span class="icon">🔗</span>
            <span class="text">Copy link</span>
        </button>
        <a href="/study/ko/Security/" class="btn btn-topic-link" title="Back to topic list">
            <span class="icon">📋</span>
            <span class="text">Topic list</span>
        </a>
    </div>
    <div class="toolbar-nav toolbar-nav--next">
        
        <a href="/study/ko/Security/13_Security_Testing.html" class="nav-next">
            <span class="nav-label">Next</span>
            <span class="nav-title">보안 테스팅</span>
        </a>
        
    </div>
</div>


    
    <nav class="toc" id="toc">
        <h2>Table of Contents</h2>
        <div class="toc">
<ul>
<li><a href="#_2">학습 목표</a></li>
<li><a href="#1-docker">1. Docker 보안 기초</a><ul>
<li><a href="#11">1.1 컨테이너 위협 모델</a></li>
<li><a href="#12-docker">1.2 Docker 보안 원칙</a></li>
</ul>
</li>
<li><a href="#2-dockerfiles">2. 안전한 Dockerfiles</a><ul>
<li><a href="#21-vs-dockerfile">2.1 안전하지 않은 vs 안전한 Dockerfile</a></li>
<li><a href="#22-dockerignore">2.2 .dockerignore</a></li>
<li><a href="#23">2.3 다단계 빌드 패턴</a></li>
<li><a href="#24">2.4 베이스 이미지 비교</a></li>
</ul>
</li>
<li><a href="#3">3. 이미지 스캐닝</a><ul>
<li><a href="#31-trivy">3.1 Trivy (포괄적 스캐너)</a></li>
<li><a href="#32-hadolint-dockerfile">3.2 Hadolint (Dockerfile 린터)</a></li>
<li><a href="#33-snyk">3.3 Snyk 컨테이너 스캐닝</a></li>
</ul>
</li>
<li><a href="#4">4. 이미지 서명 및 검증</a><ul>
<li><a href="#41">4.1 왜 이미지를 서명하는가?</a></li>
<li><a href="#42-cosign-sigstore">4.2 Cosign (Sigstore)</a></li>
</ul>
</li>
<li><a href="#5-kubernetes">5. Kubernetes 보안</a><ul>
<li><a href="#51-kubernetes">5.1 Kubernetes 보안 계층</a></li>
<li><a href="#52-rbac">5.2 RBAC (역할 기반 액세스 제어)</a></li>
<li><a href="#53-network-policies">5.3 Network Policies</a></li>
<li><a href="#54-pod-security-standards">5.4 Pod Security Standards</a></li>
<li><a href="#55-kubernetes">5.5 Kubernetes 보안 체크리스트</a></li>
</ul>
</li>
<li><a href="#6">6. 서비스 메시 보안</a><ul>
<li><a href="#61-istio-mtls">6.1 Istio와 mTLS</a></li>
</ul>
</li>
<li><a href="#7-iam">7. 클라우드 IAM 모범 사례</a><ul>
<li><a href="#71-iam">7.1 IAM 원칙</a></li>
<li><a href="#72-aws-iam">7.2 AWS IAM 정책</a></li>
</ul>
</li>
<li><a href="#8-infrastructure-as-code">8. Infrastructure as Code 보안</a><ul>
<li><a href="#81-terraform">8.1 Terraform 보안</a></li>
<li><a href="#82-tfseccheckov-iac">8.2 tfsec/Checkov로 IaC 스캔</a></li>
</ul>
</li>
<li><a href="#9">9. 런타임 보안 모니터링</a><ul>
<li><a href="#91-falco">9.1 Falco (런타임 위협 감지)</a></li>
</ul>
</li>
<li><a href="#10">10. 공급망 보안</a><ul>
<li><a href="#101-software-bill-of-materials-sbom">10.1 Software Bill of Materials (SBOM)</a></li>
<li><a href="#102-slsa-supply-chain-levels-for-software-artifacts">10.2 SLSA (Supply Chain Levels for Software Artifacts)</a></li>
</ul>
</li>
<li><a href="#11_1">11. 연습 문제</a><ul>
<li><a href="#1-dockerfile">연습 문제 1: 안전한 Dockerfile 챌린지</a></li>
<li><a href="#2-kubernetes">연습 문제 2: Kubernetes 보안 강화</a></li>
<li><a href="#3_1">연습 문제 3: 컨테이너 이미지 스캐너</a></li>
<li><a href="#4-iam">연습 문제 4: 클라우드 IAM 감사 도구</a></li>
<li><a href="#5-terraform">연습 문제 5: Terraform 보안 스캐너</a></li>
<li><a href="#6_1">연습 문제 6: 공급망 보안 파이프라인</a></li>
</ul>
</li>
<li><a href="#_3">요약</a><ul>
<li><a href="#_4">컨테이너 보안 체크리스트</a></li>
<li><a href="#_5">핵심 요점</a></li>
</ul>
</li>
</ul>
</div>

    </nav>
    

    <div class="lesson-content markdown-body">
        <h1 id="_1">컨테이너 및 클라우드 보안<a class="header-link" href="#_1" title="Permanent link">&para;</a></h1>
<p><strong>이전</strong>: <a href="./11_Secrets_Management.md">11_Secrets_Management.md</a> | <strong>다음</strong>: <a href="./13_Security_Testing.md">13. Security Testing</a></p>
<hr />
<p>컨테이너는 소프트웨어 배포에 혁명을 일으켰지만, 새로운 공격 표면도 도입했습니다. 취약한 베이스 이미지, 지나치게 관대한 Dockerfile, 또는 잘못 구성된 Kubernetes 클러스터는 전체 인프라를 노출시킬 수 있습니다. 클라우드 환경은 IAM 정책, 네트워크 구성, 공유 책임 모델로 더욱 복잡성을 추가합니다. 이 레슨은 컨테이너 및 클라우드 스택 전반의 보안 모범 사례를 다룹니다 — 최소화되고 강화된 이미지 구축부터 Kubernetes 보안 정책 구현 및 클라우드 IAM 거버넌스까지.</p>
<h2 id="_2">학습 목표<a class="header-link" href="#_2" title="Permanent link">&para;</a></h2>
<ul>
<li>공격 표면을 최소화하는 안전한 Dockerfile 작성</li>
<li>최소 베이스 이미지 선택 및 감사(distroless, Alpine, scratch)</li>
<li>Trivy, Snyk, Hadolint를 사용하여 컨테이너 이미지의 취약점 스캔</li>
<li>cosign과 Sigstore로 컨테이너 이미지 서명 및 검증</li>
<li>Kubernetes 보안 제어 구현(RBAC, NetworkPolicy, Pod Security Standards)</li>
<li>mTLS로 서비스 메시 보안 구성</li>
<li>AWS, GCP, Azure 전반에 클라우드 IAM 모범 사례 적용</li>
<li>Infrastructure as Code(Terraform, CloudFormation) 보안</li>
<li>컨테이너 런타임 보안 모니터링</li>
<li>SBOM 및 SLSA로 공급망 보안 이해</li>
</ul>
<hr />
<h2 id="1-docker">1. Docker 보안 기초<a class="header-link" href="#1-docker" title="Permanent link">&para;</a></h2>
<h3 id="11">1.1 컨테이너 위협 모델<a class="header-link" href="#11" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code>┌─────────────────────────────────────────────────────────────────────┐
│                    컨테이너 위협 모델                                  │
├─────────────────────────────────────────────────────────────────────┤
│                                                                      │
│  ┌──────────────────────────────────────────────────────┐           │
│  │                    호스트 OS                          │           │
│  │                                                       │           │
│  │  ┌──────────────────────────────────────────────┐    │           │
│  │  │              컨테이너 런타임                  │    │           │
│  │  │                                               │    │           │
│  │  │  ┌────────┐  ┌────────┐  ┌────────┐         │    │           │
│  │  │  │컨테이너│  │컨테이너│  │컨테이너│        │    │           │
│  │  │  │   A     │  │   B     │  │   C     │        │    │           │
│  │  │  │ ┌────┐  │  │ ┌────┐  │  │ ┌────┐  │       │    │           │
│  │  │  │ │App │  │  │ │App │  │  │ │App │  │       │    │           │
│  │  │  │ └────┘  │  │ └────┘  │  │ └────┘  │       │    │           │
│  │  │  └────────┘  └────────┘  └────────┘         │    │           │
│  │  └──────────────────────────────────────────────┘    │           │
│  └──────────────────────────────────────────────────────┘           │
│                                                                      │
│  공격 벡터:                                                            │
│  1. 취약한 베이스 이미지 (OS 패키지의 CVE)                            │
│  2. 애플리케이션 취약점 (의존성 CVE)                                   │
│  3. 잘못 구성된 컨테이너 (root로 실행, 과도한 권한)                    │
│  4. 컨테이너 탈출 (커널 익스플로잇, 마운트 탈출)                       │
│  5. 이미지 변조 (공급망 공격)                                          │
│  6. 이미지 내 secrets (임베디드 자격 증명)                            │
│  7. 과도한 네트워크 액세스 (네트워크 격리 없음)                        │
│  8. 리소스 고갈 (제한 없음 = 시끄러운 이웃 / DoS)                     │
│                                                                      │
│  컨테이너는 호스트 커널을 공유함 — VM이 아닙니다.                      │
│  커널 익스플로잇은 호스트의 모든 컨테이너를 손상시킬 수 있습니다.       │
│                                                                      │
└─────────────────────────────────────────────────────────────────────┘
</code></pre></div>

<h3 id="12-docker">1.2 Docker 보안 원칙<a class="header-link" href="#12-docker" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code>┌─────────────────────────────────────────────────────────────────────┐
│                    컨테이너 보안 원칙                                  │
├─────────────────────────────────────────────────────────────────────┤
│                                                                      │
│  1. 최소 공격 표면                                                     │
│     가능한 가장 작은 베이스 이미지 사용                                 │
│     필요한 패키지만 설치                                                │
│     최종 이미지에서 빌드 도구 제거                                       │
│                                                                      │
│  2. 최소 권한                                                          │
│     비root 사용자로 실행                                                │
│     모든 권한 삭제, 필요한 것만 다시 추가                                │
│     가능한 곳에서 읽기 전용 파일시스템 사용                              │
│                                                                      │
│  3. 불변성                                                             │
│     이미지는 한 번 빌드되고, 여러 번 배포됨                              │
│     실행 중인 컨테이너를 절대 패치하지 말 것 — 재빌드 및 재배포          │
│     버전 태그뿐만 아니라 digest로 이미지 태그                           │
│                                                                      │
│  4. 심층 방어                                                          │
│     빌드, 푸시, 배포 시 이미지 스캔                                     │
│     컨테이너 간 네트워크 정책                                           │
│     비정상 동작에 대한 런타임 모니터링                                   │
│                                                                      │
│  5. 검증 가능성                                                        │
│     배포 전 이미지 서명 및 서명 검증                                     │
│     모든 이미지에 대한 SBOM 생성                                        │
│     의존성을 정확한 버전으로 고정                                        │
│                                                                      │
└─────────────────────────────────────────────────────────────────────┘
</code></pre></div>

<hr />
<h2 id="2-dockerfiles">2. 안전한 Dockerfiles<a class="header-link" href="#2-dockerfiles" title="Permanent link">&para;</a></h2>
<h3 id="21-vs-dockerfile">2.1 안전하지 않은 vs 안전한 Dockerfile<a class="header-link" href="#21-vs-dockerfile" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><span class="c"># ══════════════════════════════════════════════════════════════════</span>
<span class="c"># 나쁨: 안전하지 않은 Dockerfile (일반적인 실수)</span>
<span class="c"># ══════════════════════════════════════════════════════════════════</span>
<span class="k">FROM</span><span class="w"> </span><span class="s">python:3.12</span><span class="w">                    </span><span class="c"># 전체 이미지 (900MB+), 많은 패키지</span>
<span class="k">WORKDIR</span><span class="w"> </span><span class="s">/app</span>
<span class="k">COPY</span><span class="w"> </span>.<span class="w"> </span>.<span class="w">                             </span>#<span class="w"> </span>.env,<span class="w"> </span>.git<span class="w"> </span>포함<span class="w"> </span>모든<span class="w"> </span>것을<span class="w"> </span>복사
<span class="k">RUN</span><span class="w"> </span>pip<span class="w"> </span>install<span class="w"> </span>-r<span class="w"> </span>requirements.txt<span class="w">  </span>#<span class="w"> </span>root로<span class="w"> </span>실행
<span class="k">ENV</span><span class="w"> </span><span class="nv">API_KEY</span><span class="o">=</span>sk_live_xxxxx<span class="w">            </span><span class="c"># Secret이 이미지에 구워짐</span>
<span class="k">EXPOSE</span><span class="w"> </span><span class="s">8000</span>
<span class="k">CMD</span><span class="w"> </span><span class="p">[</span><span class="s2">&quot;python&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;app.py&quot;</span><span class="p">]</span><span class="w">             </span>#<span class="w"> </span>root로<span class="w"> </span>실행
<span class="c"># 문제점:</span>
<span class="c"># - root로 실행</span>
<span class="c"># - 큰 공격 표면 (전체 OS)</span>
<span class="c"># - 환경/이미지 레이어에 secrets</span>
<span class="c"># - 불필요한 파일 복사</span>
<span class="c"># - 헬스 체크 없음</span>
<span class="c"># - 정의된 리소스 제한 없음</span>


<span class="c"># ══════════════════════════════════════════════════════════════════</span>
<span class="c"># 좋음: 안전한 Dockerfile (모범 사례)</span>
<span class="c"># ══════════════════════════════════════════════════════════════════</span>
<span class="c"># 단계 1: 빌드</span>
<span class="k">FROM</span><span class="w"> </span><span class="s">python:3.12-slim</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="s">builder</span>

<span class="k">WORKDIR</span><span class="w"> </span><span class="s">/build</span>

<span class="c"># 먼저 의존성 설치 (레이어 캐싱)</span>
<span class="k">COPY</span><span class="w"> </span>requirements.txt<span class="w"> </span>.
<span class="k">RUN</span><span class="w"> </span>pip<span class="w"> </span>install<span class="w"> </span>--no-cache-dir<span class="w"> </span>--user<span class="w"> </span>-r<span class="w"> </span>requirements.txt

<span class="c"># 애플리케이션 코드 복사</span>
<span class="k">COPY</span><span class="w"> </span>src/<span class="w"> </span>./src/

<span class="c"># 단계 2: 프로덕션</span>
<span class="k">FROM</span><span class="w"> </span><span class="s">python:3.12-slim</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="s">production</span>

<span class="c"># 보안: 비root 사용자 생성</span>
<span class="k">RUN</span><span class="w"> </span>groupadd<span class="w"> </span>-r<span class="w"> </span>appuser<span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="se">\</span>
<span class="w">    </span>useradd<span class="w"> </span>-r<span class="w"> </span>-g<span class="w"> </span>appuser<span class="w"> </span>-d<span class="w"> </span>/app<span class="w"> </span>-s<span class="w"> </span>/sbin/nologin<span class="w"> </span>appuser

<span class="c"># 런타임 의존성만 설치</span>
<span class="k">RUN</span><span class="w"> </span>apt-get<span class="w"> </span>update<span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="se">\</span>
<span class="w">    </span>apt-get<span class="w"> </span>install<span class="w"> </span>-y<span class="w"> </span>--no-install-recommends<span class="w"> </span><span class="se">\</span>
<span class="w">        </span>tini<span class="w"> </span><span class="se">\</span>
<span class="w">    </span><span class="o">&amp;&amp;</span><span class="w"> </span>rm<span class="w"> </span>-rf<span class="w"> </span>/var/lib/apt/lists/*

<span class="k">WORKDIR</span><span class="w"> </span><span class="s">/app</span>

<span class="c"># 빌더에서 필요한 것만 복사</span>
<span class="k">COPY</span><span class="w"> </span>--from<span class="o">=</span>builder<span class="w"> </span>/root/.local<span class="w"> </span>/home/appuser/.local
<span class="k">COPY</span><span class="w"> </span>--from<span class="o">=</span>builder<span class="w"> </span>/build/src<span class="w"> </span>./src/

<span class="c"># 사용자가 설치한 패키지를 위한 PATH 설정</span>
<span class="k">ENV</span><span class="w"> </span><span class="nv">PATH</span><span class="o">=</span>/home/appuser/.local/bin:<span class="nv">$PATH</span>

<span class="c"># 보안: 소유권 설정 및 비root로 전환</span>
<span class="k">RUN</span><span class="w"> </span>chown<span class="w"> </span>-R<span class="w"> </span>appuser:appuser<span class="w"> </span>/app
<span class="k">USER</span><span class="w"> </span><span class="s">appuser</span>

<span class="c"># 보안: 읽기 전용 파일시스템 친화적</span>
<span class="k">VOLUME</span><span class="w"> </span><span class="p">[</span><span class="s2">&quot;/tmp&quot;</span><span class="p">]</span>

<span class="c"># 헬스 체크</span>
<span class="k">HEALTHCHECK</span><span class="w"> </span>--interval<span class="o">=</span>30s<span class="w"> </span>--timeout<span class="o">=</span>5s<span class="w"> </span>--start-period<span class="o">=</span>10s<span class="w"> </span>--retries<span class="o">=</span><span class="m">3</span><span class="w"> </span><span class="se">\</span>
<span class="w">    </span>CMD<span class="w"> </span>python<span class="w"> </span>-c<span class="w"> </span><span class="s2">&quot;import urllib.request; urllib.request.urlopen(&#39;http://localhost:8000/health&#39;)&quot;</span><span class="w"> </span><span class="o">||</span><span class="w"> </span><span class="nb">exit</span><span class="w"> </span><span class="m">1</span>

<span class="k">EXPOSE</span><span class="w"> </span><span class="s">8000</span>

<span class="c"># tini를 init 프로세스로 사용 (적절한 신호 처리)</span>
<span class="k">ENTRYPOINT</span><span class="w"> </span><span class="p">[</span><span class="s2">&quot;tini&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;--&quot;</span><span class="p">]</span>
<span class="k">CMD</span><span class="w"> </span><span class="p">[</span><span class="s2">&quot;python&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;-m&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;uvicorn&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;src.app:app&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;--host&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;0.0.0.0&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;--port&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;8000&quot;</span><span class="p">]</span>
</code></pre></div>

<h3 id="22-dockerignore">2.2 .dockerignore<a class="header-link" href="#22-dockerignore" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><span class="c1"># .dockerignore — Docker 빌드 컨텍스트에서 파일 제외</span>
<span class="c1"># 이것은 보안과 빌드 성능 모두에 중요</span>

<span class="c1"># 버전 관리</span>
<span class="na">.git</span>
<span class="na">.gitignore</span>

<span class="c1"># 환경 및 secrets</span>
<span class="na">.env</span>
<span class="na">.env.</span><span class="p">*</span>
<span class="err">*</span><span class="na">.pem</span>
<span class="err">*</span><span class="na">.key</span>
<span class="nf">credentials.json</span>

<span class="c1"># Python</span>
<span class="nf">__pycache__</span>
<span class="err">*</span><span class="na">.pyc</span>
<span class="err">*</span><span class="na">.pyo</span>
<span class="na">.venv</span>
<span class="nf">venv</span>
<span class="na">.pytest_cache</span>
<span class="na">.mypy_cache</span>
<span class="na">.coverage</span>
<span class="nf">htmlcov</span>

<span class="c1"># IDE</span>
<span class="na">.vscode</span>
<span class="na">.idea</span>
<span class="err">*</span><span class="na">.swp</span>
<span class="err">*</span><span class="na">.swo</span>

<span class="c1"># Docker</span>
<span class="nf">Dockerfile</span><span class="p">*</span>
<span class="nf">docker-compose</span><span class="p">*.</span><span class="no">yml</span>

<span class="c1"># 문서</span>
<span class="nf">README.md</span>
<span class="nf">docs</span><span class="err">/</span>
<span class="err">*</span><span class="na">.md</span>

<span class="c1"># CI/CD</span>
<span class="na">.github</span>
<span class="na">.gitlab-ci.yml</span>

<span class="c1"># OS 파일</span>
<span class="na">.DS_Store</span>
<span class="nf">Thumbs.db</span>
</code></pre></div>

<h3 id="23">2.3 다단계 빌드 패턴<a class="header-link" href="#23" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><span class="c"># ══════════════════════════════════════════════════════════════════</span>
<span class="c"># 패턴 1: Go 애플리케이션 — scratch에서 빌드</span>
<span class="c"># ══════════════════════════════════════════════════════════════════</span>
<span class="k">FROM</span><span class="w"> </span><span class="s">golang:1.22</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="s">builder</span>

<span class="k">WORKDIR</span><span class="w"> </span><span class="s">/build</span>
<span class="k">COPY</span><span class="w"> </span>go.mod<span class="w"> </span>go.sum<span class="w"> </span>./
<span class="k">RUN</span><span class="w"> </span>go<span class="w"> </span>mod<span class="w"> </span>download

<span class="k">COPY</span><span class="w"> </span>.<span class="w"> </span>.
<span class="c"># 정적 바이너리 빌드 (외부 의존성 없음)</span>
<span class="k">RUN</span><span class="w"> </span><span class="nv">CGO_ENABLED</span><span class="o">=</span><span class="m">0</span><span class="w"> </span><span class="nv">GOOS</span><span class="o">=</span>linux<span class="w"> </span><span class="nv">GOARCH</span><span class="o">=</span>amd64<span class="w"> </span><span class="se">\</span>
<span class="w">    </span>go<span class="w"> </span>build<span class="w"> </span>-ldflags<span class="o">=</span><span class="s2">&quot;-w -s&quot;</span><span class="w"> </span>-o<span class="w"> </span>/app/server<span class="w"> </span>./cmd/server

<span class="c"># 최종 이미지: scratch (말 그대로 비어있음 — ~0 MB 베이스)</span>
<span class="k">FROM</span><span class="w"> </span><span class="s">scratch</span>

<span class="c"># HTTPS를 위한 CA 인증서 가져오기</span>
<span class="k">COPY</span><span class="w"> </span>--from<span class="o">=</span>builder<span class="w"> </span>/etc/ssl/certs/ca-certificates.crt<span class="w"> </span>/etc/ssl/certs/
<span class="c"># 타임존 데이터 가져오기</span>
<span class="k">COPY</span><span class="w"> </span>--from<span class="o">=</span>builder<span class="w"> </span>/usr/share/zoneinfo<span class="w"> </span>/usr/share/zoneinfo

<span class="c"># 바이너리 복사</span>
<span class="k">COPY</span><span class="w"> </span>--from<span class="o">=</span>builder<span class="w"> </span>/app/server<span class="w"> </span>/server

<span class="c"># 비root 사용자 (scratch에는 /etc/passwd가 없으므로 숫자 UID)</span>
<span class="k">USER</span><span class="w"> </span><span class="s">65534</span>

<span class="k">EXPOSE</span><span class="w"> </span><span class="s">8080</span>
<span class="k">ENTRYPOINT</span><span class="w"> </span><span class="p">[</span><span class="s2">&quot;/server&quot;</span><span class="p">]</span>


<span class="c"># ══════════════════════════════════════════════════════════════════</span>
<span class="c"># 패턴 2: Node.js — distroless 이미지</span>
<span class="c"># ══════════════════════════════════════════════════════════════════</span>
<span class="k">FROM</span><span class="w"> </span><span class="s">node:20-slim</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="s">builder</span>

<span class="k">WORKDIR</span><span class="w"> </span><span class="s">/build</span>
<span class="k">COPY</span><span class="w"> </span>package.json<span class="w"> </span>package-lock.json<span class="w"> </span>./
<span class="k">RUN</span><span class="w"> </span>npm<span class="w"> </span>ci<span class="w"> </span>--only<span class="o">=</span>production

<span class="k">COPY</span><span class="w"> </span>src/<span class="w"> </span>./src/

<span class="c"># 최종 이미지: distroless (셸 없음, 패키지 관리자 없음)</span>
<span class="k">FROM</span><span class="w"> </span><span class="s">gcr.io/distroless/nodejs20-debian12</span>

<span class="k">WORKDIR</span><span class="w"> </span><span class="s">/app</span>
<span class="k">COPY</span><span class="w"> </span>--from<span class="o">=</span>builder<span class="w"> </span>/build/node_modules<span class="w"> </span>./node_modules
<span class="k">COPY</span><span class="w"> </span>--from<span class="o">=</span>builder<span class="w"> </span>/build/src<span class="w"> </span>./src

<span class="c"># Distroless는 기본적으로 nonroot로 실행</span>
<span class="k">USER</span><span class="w"> </span><span class="s">nonroot</span>

<span class="k">EXPOSE</span><span class="w"> </span><span class="s">3000</span>
<span class="k">CMD</span><span class="w"> </span><span class="p">[</span><span class="s2">&quot;src/index.js&quot;</span><span class="p">]</span>


<span class="c"># ══════════════════════════════════════════════════════════════════</span>
<span class="c"># 패턴 3: Python — Alpine (작지만 셸 있음)</span>
<span class="c"># ══════════════════════════════════════════════════════════════════</span>
<span class="k">FROM</span><span class="w"> </span><span class="s">python:3.12-alpine</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="s">builder</span>

<span class="k">RUN</span><span class="w"> </span>apk<span class="w"> </span>add<span class="w"> </span>--no-cache<span class="w"> </span>build-base

<span class="k">WORKDIR</span><span class="w"> </span><span class="s">/build</span>
<span class="k">COPY</span><span class="w"> </span>requirements.txt<span class="w"> </span>.
<span class="k">RUN</span><span class="w"> </span>pip<span class="w"> </span>install<span class="w"> </span>--no-cache-dir<span class="w"> </span>--prefix<span class="o">=</span>/install<span class="w"> </span>-r<span class="w"> </span>requirements.txt

<span class="k">FROM</span><span class="w"> </span><span class="s">python:3.12-alpine</span>

<span class="c"># 보안 강화</span>
<span class="k">RUN</span><span class="w"> </span>addgroup<span class="w"> </span>-S<span class="w"> </span>appuser<span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span>adduser<span class="w"> </span>-S<span class="w"> </span>-G<span class="w"> </span>appuser<span class="w"> </span>appuser<span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="se">\</span>
<span class="w">    </span>apk<span class="w"> </span>add<span class="w"> </span>--no-cache<span class="w"> </span>tini

<span class="k">WORKDIR</span><span class="w"> </span><span class="s">/app</span>
<span class="k">COPY</span><span class="w"> </span>--from<span class="o">=</span>builder<span class="w"> </span>/install<span class="w"> </span>/usr/local
<span class="k">COPY</span><span class="w"> </span>src/<span class="w"> </span>./src/

<span class="k">RUN</span><span class="w"> </span>chown<span class="w"> </span>-R<span class="w"> </span>appuser:appuser<span class="w"> </span>/app
<span class="k">USER</span><span class="w"> </span><span class="s">appuser</span>

<span class="k">ENTRYPOINT</span><span class="w"> </span><span class="p">[</span><span class="s2">&quot;tini&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;--&quot;</span><span class="p">]</span>
<span class="k">CMD</span><span class="w"> </span><span class="p">[</span><span class="s2">&quot;python&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;-m&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;src.app&quot;</span><span class="p">]</span>
</code></pre></div>

<h3 id="24">2.4 베이스 이미지 비교<a class="header-link" href="#24" title="Permanent link">&para;</a></h3>
<table>
<thead>
<tr>
<th>베이스 이미지</th>
<th>크기</th>
<th>셸</th>
<th>패키지 관리자</th>
<th>CVE</th>
<th>사용 사례</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>ubuntu:24.04</code></td>
<td>~75 MB</td>
<td>Yes</td>
<td>apt</td>
<td>Medium</td>
<td>전체 OS 필요</td>
</tr>
<tr>
<td><code>debian:bookworm-slim</code></td>
<td>~80 MB</td>
<td>Yes</td>
<td>apt</td>
<td>Medium</td>
<td>범용</td>
</tr>
<tr>
<td><code>alpine:3.19</code></td>
<td>~7 MB</td>
<td>Yes</td>
<td>apk</td>
<td>Low</td>
<td>셸이 있는 작은 크기</td>
</tr>
<tr>
<td><code>python:3.12-slim</code></td>
<td>~150 MB</td>
<td>Yes</td>
<td>apt + pip</td>
<td>Medium</td>
<td>Python 앱</td>
</tr>
<tr>
<td><code>python:3.12-alpine</code></td>
<td>~55 MB</td>
<td>Yes</td>
<td>apk + pip</td>
<td>Low</td>
<td>Python (작음)</td>
</tr>
<tr>
<td><code>gcr.io/distroless/python3</code></td>
<td>~50 MB</td>
<td>No</td>
<td>None</td>
<td>Very Low</td>
<td>Python (강화됨)</td>
</tr>
<tr>
<td><code>gcr.io/distroless/static</code></td>
<td>~2 MB</td>
<td>No</td>
<td>None</td>
<td>Minimal</td>
<td>정적 바이너리</td>
</tr>
<tr>
<td><code>scratch</code></td>
<td>0 MB</td>
<td>No</td>
<td>None</td>
<td>None</td>
<td>Go/Rust 정적</td>
</tr>
</tbody>
</table>
<div class="highlight"><pre><span></span><code><span class="err">┌─────────────────────────────────────────────────────────────────────┐</span>
<span class="err">│</span><span class="w">                    </span><span class="n">베이스</span><span class="w"> </span><span class="n">이미지</span><span class="w"> </span><span class="n">결정</span><span class="w"> </span><span class="n">트리</span><span class="w">                             </span><span class="err">│</span>
<span class="err">├─────────────────────────────────────────────────────────────────────┤</span>
<span class="err">│</span><span class="w">                                                                      </span><span class="err">│</span>
<span class="err">│</span><span class="w">  </span><span class="n">디버깅을</span><span class="w"> </span><span class="n">위한</span><span class="w"> </span><span class="n">셸이</span><span class="w"> </span><span class="n">필요한가요</span><span class="vm">?</span><span class="w">                                        </span><span class="err">│</span>
<span class="err">│</span><span class="w">  </span><span class="err">├──</span><span class="w"> </span><span class="nl">Yes</span><span class="p">:</span><span class="w"> </span><span class="n">Alpine</span><span class="w"> </span><span class="p">(</span><span class="n">작음</span><span class="p">)</span><span class="w"> </span><span class="n">또는</span><span class="w"> </span><span class="n">Debian</span><span class="o">-</span><span class="n">slim</span><span class="w"> </span><span class="p">(</span><span class="n">호환성</span><span class="p">)</span><span class="w">                    </span><span class="err">│</span>
<span class="err">│</span><span class="w">  </span><span class="err">└──</span><span class="w"> </span><span class="k">No</span><span class="err">:</span><span class="w">                                                             </span><span class="err">│</span>
<span class="err">│</span><span class="w">       </span><span class="err">└──</span><span class="w"> </span><span class="n">정적</span><span class="w"> </span><span class="n">바이너리</span><span class="w"> </span><span class="p">(</span><span class="k">Go</span><span class="p">,</span><span class="w"> </span><span class="n">Rust</span><span class="p">)</span><span class="vm">?</span><span class="w">                                  </span><span class="err">│</span>
<span class="err">│</span><span class="w">            </span><span class="err">├──</span><span class="w"> </span><span class="nl">Yes</span><span class="p">:</span><span class="w"> </span><span class="n">scratch</span><span class="w"> </span><span class="n">또는</span><span class="w"> </span><span class="n">distroless</span><span class="o">/</span><span class="k">static</span><span class="w">                   </span><span class="err">│</span>
<span class="err">│</span><span class="w">            </span><span class="err">└──</span><span class="w"> </span><span class="k">No</span><span class="err">:</span><span class="w">  </span><span class="n">distroless</span><span class="o">/&lt;</span><span class="k">language</span><span class="o">&gt;</span><span class="w">                            </span><span class="err">│</span>
<span class="err">│</span><span class="w">                                                                      </span><span class="err">│</span>
<span class="err">│</span><span class="w">  </span><span class="n">일반</span><span class="w"> </span><span class="nl">권장사항</span><span class="p">:</span><span class="w">                                                        </span><span class="err">│</span>
<span class="err">│</span><span class="w">  </span><span class="err">•</span><span class="w"> </span><span class="nl">개발</span><span class="p">:</span><span class="w"> </span><span class="k">language</span><span class="o">-</span><span class="n">slim</span><span class="w"> </span><span class="p">(</span><span class="nl">예</span><span class="p">:</span><span class="w"> </span><span class="nl">python</span><span class="p">:</span><span class="mf">3.12</span><span class="o">-</span><span class="n">slim</span><span class="p">)</span><span class="w">                        </span><span class="err">│</span>
<span class="err">│</span><span class="w">  </span><span class="err">•</span><span class="w"> </span><span class="nl">프로덕션</span><span class="p">:</span><span class="w"> </span><span class="n">distroless</span><span class="w"> </span><span class="n">또는</span><span class="w"> </span><span class="n">Alpine</span><span class="w">                                  </span><span class="err">│</span>
<span class="err">│</span><span class="w">  </span><span class="err">•</span><span class="w"> </span><span class="n">최대</span><span class="w"> </span><span class="nl">보안</span><span class="p">:</span><span class="w"> </span><span class="n">scratch</span><span class="w"> </span><span class="p">(</span><span class="n">정적</span><span class="w"> </span><span class="n">바이너리</span><span class="w"> </span><span class="n">필요</span><span class="p">)</span><span class="w">                            </span><span class="err">│</span>
<span class="err">│</span><span class="w">                                                                      </span><span class="err">│</span>
<span class="err">│</span><span class="w">  </span><span class="n">Alpine</span><span class="w"> </span><span class="nl">주의사항</span><span class="p">:</span><span class="w">                                                     </span><span class="err">│</span>
<span class="err">│</span><span class="w">  </span><span class="err">•</span><span class="w"> </span><span class="n">glibc가</span><span class="w"> </span><span class="n">아닌</span><span class="w"> </span><span class="n">musl</span><span class="w"> </span><span class="n">libc</span><span class="w"> </span><span class="n">사용</span><span class="w"> </span><span class="err">—</span><span class="w"> </span><span class="n">일부</span><span class="w"> </span><span class="n">패키지가</span><span class="w"> </span><span class="n">작동하지</span><span class="w"> </span><span class="n">않을</span><span class="w"> </span><span class="n">수</span><span class="w"> </span><span class="n">있음</span><span class="w">  </span><span class="err">│</span>
<span class="err">│</span><span class="w">  </span><span class="err">•</span><span class="w"> </span><span class="n">Python</span><span class="w"> </span><span class="n">휠이</span><span class="w"> </span><span class="n">컴파일</span><span class="w"> </span><span class="n">필요할</span><span class="w"> </span><span class="n">수</span><span class="w"> </span><span class="n">있음</span><span class="w"> </span><span class="p">(</span><span class="n">빌드</span><span class="w"> </span><span class="n">느림</span><span class="p">)</span><span class="w">                      </span><span class="err">│</span>
<span class="err">│</span><span class="w">  </span><span class="err">•</span><span class="w"> </span><span class="n">DNS</span><span class="w"> </span><span class="n">해석이</span><span class="w"> </span><span class="n">glibc</span><span class="w"> </span><span class="n">기반</span><span class="w"> </span><span class="n">이미지와</span><span class="w"> </span><span class="n">다름</span><span class="w">                                </span><span class="err">│</span>
<span class="err">│</span><span class="w">                                                                      </span><span class="err">│</span>
<span class="err">└─────────────────────────────────────────────────────────────────────┘</span>
</code></pre></div>

<hr />
<h2 id="3">3. 이미지 스캐닝<a class="header-link" href="#3" title="Permanent link">&para;</a></h2>
<h3 id="31-trivy">3.1 Trivy (포괄적 스캐너)<a class="header-link" href="#31-trivy" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><span class="c1"># ── Trivy 설치 ────────────────────────────────────────────────</span>
brew<span class="w"> </span>install<span class="w"> </span>trivy<span class="w">          </span><span class="c1"># macOS</span>
apt-get<span class="w"> </span>install<span class="w"> </span>trivy<span class="w">       </span><span class="c1"># Debian/Ubuntu (먼저 aquasecurity 저장소 추가)</span>

<span class="c1"># ── Docker 이미지 스캔 ─────────────────────────────────────────</span>
trivy<span class="w"> </span>image<span class="w"> </span>python:3.12-slim

<span class="c1"># ── 심각도 필터로 스캔 ───────────────────────────────────────────</span>
trivy<span class="w"> </span>image<span class="w"> </span>--severity<span class="w"> </span>CRITICAL,HIGH<span class="w"> </span>python:3.12-slim

<span class="c1"># ── 취약점 발견 시 실패 (CI/CD용) ───────────────────────────────</span>
trivy<span class="w"> </span>image<span class="w"> </span>--exit-code<span class="w"> </span><span class="m">1</span><span class="w"> </span>--severity<span class="w"> </span>CRITICAL<span class="w"> </span>myapp:latest

<span class="c1"># ── Dockerfile 스캔 (잘못된 구성) ────────────────────────────────</span>
trivy<span class="w"> </span>config<span class="w"> </span>Dockerfile

<span class="c1"># ── 파일시스템 스캔 (애플리케이션 의존성) ────────────────────────</span>
trivy<span class="w"> </span>fs<span class="w"> </span>--scanners<span class="w"> </span>vuln,secret,misconfig<span class="w"> </span>/path/to/project

<span class="c1"># ── SBOM 생성 ───────────────────────────────────────────────────</span>
trivy<span class="w"> </span>image<span class="w"> </span>--format<span class="w"> </span>spdx-json<span class="w"> </span>--output<span class="w"> </span>sbom.json<span class="w"> </span>myapp:latest

<span class="c1"># ── Kubernetes 매니페스트 스캔 ────────────────────────────────────</span>
trivy<span class="w"> </span>config<span class="w"> </span>k8s-manifests/

<span class="c1"># ── 프로그래밍 방식 처리를 위한 JSON 출력 ─────────────────────────</span>
trivy<span class="w"> </span>image<span class="w"> </span>--format<span class="w"> </span>json<span class="w"> </span>--output<span class="w"> </span>results.json<span class="w"> </span>myapp:latest

<span class="c1"># ── 수정되지 않은 취약점 무시 ──────────────────────────────────</span>
trivy<span class="w"> </span>image<span class="w"> </span>--ignore-unfixed<span class="w"> </span>myapp:latest
</code></pre></div>

<div class="highlight"><pre><span></span><code><span class="c1"># ── GitHub Actions의 Trivy ─────────────────────────────────────</span>
<span class="c1"># .github/workflows/security.yml</span>
<span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Security Scan</span>

<span class="nt">on</span><span class="p">:</span>
<span class="w">  </span><span class="nt">push</span><span class="p">:</span>
<span class="w">    </span><span class="nt">branches</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">[</span><span class="nv">main</span><span class="p p-Indicator">]</span>
<span class="w">  </span><span class="nt">pull_request</span><span class="p">:</span>

<span class="nt">jobs</span><span class="p">:</span>
<span class="w">  </span><span class="nt">trivy-scan</span><span class="p">:</span>
<span class="w">    </span><span class="nt">runs-on</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">ubuntu-latest</span>
<span class="w">    </span><span class="nt">steps</span><span class="p">:</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">uses</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">actions/checkout@v4</span>

<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Build image</span>
<span class="w">        </span><span class="nt">run</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">docker build -t myapp:${{ github.sha }} .</span>

<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Run Trivy vulnerability scanner</span>
<span class="w">        </span><span class="nt">uses</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">aquasecurity/trivy-action@master</span>
<span class="w">        </span><span class="nt">with</span><span class="p">:</span>
<span class="w">          </span><span class="nt">image-ref</span><span class="p">:</span><span class="w"> </span><span class="s">&#39;myapp:${{</span><span class="nv"> </span><span class="s">github.sha</span><span class="nv"> </span><span class="s">}}&#39;</span>
<span class="w">          </span><span class="nt">format</span><span class="p">:</span><span class="w"> </span><span class="s">&#39;sarif&#39;</span>
<span class="w">          </span><span class="nt">output</span><span class="p">:</span><span class="w"> </span><span class="s">&#39;trivy-results.sarif&#39;</span>
<span class="w">          </span><span class="nt">severity</span><span class="p">:</span><span class="w"> </span><span class="s">&#39;CRITICAL,HIGH&#39;</span>
<span class="w">          </span><span class="nt">exit-code</span><span class="p">:</span><span class="w"> </span><span class="s">&#39;1&#39;</span>

<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Upload Trivy scan results</span>
<span class="w">        </span><span class="nt">uses</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">github/codeql-action/upload-sarif@v3</span>
<span class="w">        </span><span class="nt">if</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">always()</span>
<span class="w">        </span><span class="nt">with</span><span class="p">:</span>
<span class="w">          </span><span class="nt">sarif_file</span><span class="p">:</span><span class="w"> </span><span class="s">&#39;trivy-results.sarif&#39;</span>
</code></pre></div>

<h3 id="32-hadolint-dockerfile">3.2 Hadolint (Dockerfile 린터)<a class="header-link" href="#32-hadolint-dockerfile" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><span class="c1"># ── Hadolint 설치 ─────────────────────────────────────────────</span>
brew<span class="w"> </span>install<span class="w"> </span>hadolint<span class="w">        </span><span class="c1"># macOS</span>
<span class="c1"># 또는 Docker 사용:</span>
docker<span class="w"> </span>run<span class="w"> </span>--rm<span class="w"> </span>-i<span class="w"> </span>hadolint/hadolint<span class="w"> </span>&lt;<span class="w"> </span>Dockerfile

<span class="c1"># ── Dockerfile 린트 ────────────────────────────────────────────</span>
hadolint<span class="w"> </span>Dockerfile

<span class="c1"># ── 예제 출력 ───────────────────────────────────────────────────</span>
<span class="c1"># Dockerfile:3 DL3006 warning: Always tag the version of an image explicitly</span>
<span class="c1"># Dockerfile:7 DL3008 warning: Pin versions in apt-get install</span>
<span class="c1"># Dockerfile:7 DL3009 info: Delete apt-get lists after installing</span>
<span class="c1"># Dockerfile:12 DL3025 warning: Use arguments JSON notation for CMD</span>
<span class="c1"># Dockerfile:5 DL3045 warning: COPY to a relative destination without WORKDIR</span>

<span class="c1"># ── 특정 규칙 무시 ───────────────────────────────────────────────</span>
hadolint<span class="w"> </span>--ignore<span class="w"> </span>DL3008<span class="w"> </span>--ignore<span class="w"> </span>DL3013<span class="w"> </span>Dockerfile

<span class="c1"># ── 구성 파일 ──────────────────────────────────────────────────</span>
<span class="c1"># .hadolint.yaml</span>
</code></pre></div>

<div class="highlight"><pre><span></span><code><span class="c1"># .hadolint.yaml</span>
<span class="nt">ignored</span><span class="p">:</span>
<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">DL3008</span><span class="w">   </span><span class="c1"># apt-get에서 버전 고정 (때때로 비현실적)</span>

<span class="nt">trustedRegistries</span><span class="p">:</span>
<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">docker.io</span>
<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">gcr.io</span>
<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">ghcr.io</span>

<span class="nt">override</span><span class="p">:</span>
<span class="w">  </span><span class="nt">error</span><span class="p">:</span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">DL3001</span><span class="w">  </span><span class="c1"># 버전 없이 설치로 파이프</span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">DL3002</span><span class="w">  </span><span class="c1"># 마지막 사용자가 root가 아니어야 함</span>
<span class="w">  </span><span class="nt">warning</span><span class="p">:</span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">DL3003</span><span class="w">  </span><span class="c1"># WORKDIR 사용</span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">DL3006</span><span class="w">  </span><span class="c1"># 항상 이미지 버전 태그</span>
<span class="w">  </span><span class="nt">info</span><span class="p">:</span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">DL3007</span><span class="w">  </span><span class="c1"># latest 태그 사용</span>
</code></pre></div>

<h3 id="33-snyk">3.3 Snyk 컨테이너 스캐닝<a class="header-link" href="#33-snyk" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><span class="c1"># ── Snyk CLI 설치 ─────────────────────────────────────────────</span>
npm<span class="w"> </span>install<span class="w"> </span>-g<span class="w"> </span>snyk
snyk<span class="w"> </span>auth<span class="w">  </span><span class="c1"># 인증</span>

<span class="c1"># ── Docker 이미지 스캔 ─────────────────────────────────────────</span>
snyk<span class="w"> </span>container<span class="w"> </span><span class="nb">test</span><span class="w"> </span>myapp:latest

<span class="c1"># ── 더 나은 개선 조언을 위해 Dockerfile과 함께 스캔 ──────────</span>
snyk<span class="w"> </span>container<span class="w"> </span><span class="nb">test</span><span class="w"> </span>myapp:latest<span class="w"> </span>--file<span class="o">=</span>Dockerfile

<span class="c1"># ── 모니터 (지속적 스캐닝) ───────────────────────────────────────</span>
snyk<span class="w"> </span>container<span class="w"> </span>monitor<span class="w"> </span>myapp:latest

<span class="c1"># ── SBOM 생성 ───────────────────────────────────────────────────</span>
snyk<span class="w"> </span>container<span class="w"> </span>sbom<span class="w"> </span>myapp:latest<span class="w"> </span>--format<span class="o">=</span>spdx-json<span class="w"> </span>&gt;<span class="w"> </span>sbom.json
</code></pre></div>

<hr />
<h2 id="4">4. 이미지 서명 및 검증<a class="header-link" href="#4" title="Permanent link">&para;</a></h2>
<h3 id="41">4.1 왜 이미지를 서명하는가?<a class="header-link" href="#41" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code>┌─────────────────────────────────────────────────────────────────────┐
│                    이미지 공급망 공격                                  │
├─────────────────────────────────────────────────────────────────────┤
│                                                                      │
│  서명 없이:                                                            │
│                                                                      │
│  개발자 ──push──▶ 레지스트리 ──pull──▶ 프로덕션                       │
│                          ↑                                           │
│                      공격자가 이미지를                                 │
│                      악의적인 버전으로                                 │
│                      교체 (동일한 태그)                                │
│                                                                      │
│  서명과 함께 (cosign):                                                │
│                                                                      │
│  개발자 ──push──▶ 레지스트리 ──pull──▶ 서명 검증 ──▶ 배포             │
│       │                  │                     ↑                     │
│       └──서명────────────┘                     │                     │
│                                           서명이 유효하지             │
│                                           않으면 거부                 │
│                                                                      │
│  서명은 보장함:                                                        │
│  1. 무결성: 이미지가 수정되지 않았음                                   │
│  2. 진정성: 이미지가 신뢰할 수 있는 엔티티에 의해 빌드됨                │
│  3. 부인 방지: 서명자가 서명을 부인할 수 없음                          │
│                                                                      │
└─────────────────────────────────────────────────────────────────────┘
</code></pre></div>

<h3 id="42-cosign-sigstore">4.2 Cosign (Sigstore)<a class="header-link" href="#42-cosign-sigstore" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><span class="c1"># ── cosign 설치 ──────────────────────────────────────────────</span>
brew<span class="w"> </span>install<span class="w"> </span>cosign

<span class="c1"># ── 키 없는 서명 (권장 — OIDC ID 사용) ──────────────────────</span>
<span class="c1"># 이미지 서명 (OIDC 인증을 위해 브라우저 열림)</span>
cosign<span class="w"> </span>sign<span class="w"> </span>myregistry.io/myapp:v1.0.0

<span class="c1"># 서명 검증</span>
cosign<span class="w"> </span>verify<span class="w"> </span>myregistry.io/myapp:v1.0.0<span class="w"> </span><span class="se">\</span>
<span class="w">    </span>--certificate-identity<span class="w"> </span>user@example.com<span class="w"> </span><span class="se">\</span>
<span class="w">    </span>--certificate-oidc-issuer<span class="w"> </span>https://accounts.google.com

<span class="c1"># ── 키 기반 서명 ───────────────────────────────────────────────</span>
<span class="c1"># 키 쌍 생성</span>
cosign<span class="w"> </span>generate-key-pair

<span class="c1"># 개인 키로 서명</span>
cosign<span class="w"> </span>sign<span class="w"> </span>--key<span class="w"> </span>cosign.key<span class="w"> </span>myregistry.io/myapp:v1.0.0

<span class="c1"># 공개 키로 검증</span>
cosign<span class="w"> </span>verify<span class="w"> </span>--key<span class="w"> </span>cosign.pub<span class="w"> </span>myregistry.io/myapp:v1.0.0

<span class="c1"># ── digest로 서명 (태그보다 더 안전) ─────────────────────────</span>
<span class="c1"># 태그는 변경 가능; digest는 불변</span>
<span class="nv">IMAGE_DIGEST</span><span class="o">=</span><span class="k">$(</span>docker<span class="w"> </span>inspect<span class="w"> </span>--format<span class="o">=</span><span class="s1">&#39;{{index .RepoDigests 0}}&#39;</span><span class="w"> </span>myapp:v1.0.0<span class="k">)</span>
cosign<span class="w"> </span>sign<span class="w"> </span>--key<span class="w"> </span>cosign.key<span class="w"> </span><span class="s2">&quot;</span><span class="nv">$IMAGE_DIGEST</span><span class="s2">&quot;</span>

<span class="c1"># ── 이미지에 SBOM 첨부 ────────────────────────────────────────</span>
cosign<span class="w"> </span>attach<span class="w"> </span>sbom<span class="w"> </span>--sbom<span class="w"> </span>sbom.json<span class="w"> </span>myregistry.io/myapp:v1.0.0

<span class="c1"># ── 배포 전 CI/CD에서 검증 ───────────────────────────────────</span>
cosign<span class="w"> </span>verify<span class="w"> </span>--key<span class="w"> </span>cosign.pub<span class="w"> </span>myregistry.io/myapp@sha256:abc123...<span class="w"> </span><span class="o">||</span><span class="w"> </span><span class="nb">exit</span><span class="w"> </span><span class="m">1</span>
</code></pre></div>

<div class="highlight"><pre><span></span><code><span class="c1"># ── GitHub Actions의 Cosign ────────────────────────────────────</span>
<span class="c1"># .github/workflows/build-sign.yml</span>
<span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Build and Sign</span>

<span class="nt">on</span><span class="p">:</span>
<span class="w">  </span><span class="nt">push</span><span class="p">:</span>
<span class="w">    </span><span class="nt">tags</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">[</span><span class="s">&#39;v*&#39;</span><span class="p p-Indicator">]</span>

<span class="nt">jobs</span><span class="p">:</span>
<span class="w">  </span><span class="nt">build-and-sign</span><span class="p">:</span>
<span class="w">    </span><span class="nt">runs-on</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">ubuntu-latest</span>
<span class="w">    </span><span class="nt">permissions</span><span class="p">:</span>
<span class="w">      </span><span class="nt">contents</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">read</span>
<span class="w">      </span><span class="nt">id-token</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">write</span><span class="w">   </span><span class="c1"># 키 없는 서명에 필요</span>

<span class="w">    </span><span class="nt">steps</span><span class="p">:</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">uses</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">actions/checkout@v4</span>

<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">uses</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">sigstore/cosign-installer@v3</span>

<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Login to registry</span>
<span class="w">        </span><span class="nt">uses</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">docker/login-action@v3</span>
<span class="w">        </span><span class="nt">with</span><span class="p">:</span>
<span class="w">          </span><span class="nt">registry</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">ghcr.io</span>
<span class="w">          </span><span class="nt">username</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">${{ github.actor }}</span>
<span class="w">          </span><span class="nt">password</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">${{ secrets.GITHUB_TOKEN }}</span>

<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Build and push</span>
<span class="w">        </span><span class="nt">id</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">build</span>
<span class="w">        </span><span class="nt">uses</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">docker/build-push-action@v5</span>
<span class="w">        </span><span class="nt">with</span><span class="p">:</span>
<span class="w">          </span><span class="nt">push</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">true</span>
<span class="w">          </span><span class="nt">tags</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">ghcr.io/${{ github.repository }}:${{ github.ref_name }}</span>

<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Sign the image (keyless)</span>
<span class="w">        </span><span class="nt">run</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">cosign sign --yes ghcr.io/${{ github.repository }}@${{ steps.build.outputs.digest }}</span>
</code></pre></div>

<hr />
<h2 id="5-kubernetes">5. Kubernetes 보안<a class="header-link" href="#5-kubernetes" title="Permanent link">&para;</a></h2>
<h3 id="51-kubernetes">5.1 Kubernetes 보안 계층<a class="header-link" href="#51-kubernetes" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code>┌─────────────────────────────────────────────────────────────────────┐
│                    Kubernetes 보안 계층                               │
├─────────────────────────────────────────────────────────────────────┤
│                                                                      │
│  레이어 1: 클러스터 인프라                                             │
│  ├── API 서버 인증 및 암호화                                          │
│  ├── etcd 저장 시 암호화                                              │
│  ├── 노드 보안 (OS 강화, kubelet 구성)                                │
│  └── 네트워크 암호화 (모든 곳에 TLS)                                  │
│                                                                      │
│  레이어 2: 클러스터 구성                                               │
│  ├── RBAC (역할 기반 액세스 제어)                                     │
│  ├── 승인 컨트롤러 (OPA/Gatekeeper, Kyverno)                        │
│  ├── Pod Security Standards (Restricted/Baseline/Privileged)       │
│  └── Network Policies                                              │
│                                                                      │
│  레이어 3: 애플리케이션 보안                                           │
│  ├── 이미지 스캐닝 및 서명                                            │
│  ├── Secret 관리 (External Secrets Operator)                       │
│  ├── 서비스 메시 (Istio/Linkerd와 mTLS)                             │
│  └── 런타임 보안 (Falco, Tetragon)                                  │
│                                                                      │
│  레이어 4: 데이터 보안                                                 │
│  ├── 저장 시 암호화 (StorageClass 암호화)                            │
│  ├── 전송 중 암호화 (mTLS)                                           │
│  └── 백업 및 재해 복구                                                │
│                                                                      │
└─────────────────────────────────────────────────────────────────────┘
</code></pre></div>

<h3 id="52-rbac">5.2 RBAC (역할 기반 액세스 제어)<a class="header-link" href="#52-rbac" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><span class="c1"># ── 원칙: 필요한 최소 권한 부여 ────────────────────────────────</span>

<span class="c1"># Role: 네임스페이스 내에서 권한 정의</span>
<span class="nt">apiVersion</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">rbac.authorization.k8s.io/v1</span>
<span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Role</span>
<span class="nt">metadata</span><span class="p">:</span>
<span class="w">  </span><span class="nt">namespace</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">production</span>
<span class="w">  </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">app-reader</span>
<span class="nt">rules</span><span class="p">:</span>
<span class="w">  </span><span class="c1"># pod와 로그 읽기 가능</span>
<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">apiGroups</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">[</span><span class="s">&quot;&quot;</span><span class="p p-Indicator">]</span>
<span class="w">    </span><span class="nt">resources</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">[</span><span class="s">&quot;pods&quot;</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="s">&quot;pods/log&quot;</span><span class="p p-Indicator">]</span>
<span class="w">    </span><span class="nt">verbs</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">[</span><span class="s">&quot;get&quot;</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="s">&quot;list&quot;</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="s">&quot;watch&quot;</span><span class="p p-Indicator">]</span>
<span class="w">  </span><span class="c1"># configmaps 읽기 가능</span>
<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">apiGroups</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">[</span><span class="s">&quot;&quot;</span><span class="p p-Indicator">]</span>
<span class="w">    </span><span class="nt">resources</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">[</span><span class="s">&quot;configmaps&quot;</span><span class="p p-Indicator">]</span>
<span class="w">    </span><span class="nt">verbs</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">[</span><span class="s">&quot;get&quot;</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="s">&quot;list&quot;</span><span class="p p-Indicator">]</span>
<span class="w">  </span><span class="c1"># secrets 읽기 불가 (의도적으로 제외됨)</span>

<span class="nn">---</span>
<span class="c1"># RoleBinding: 사용자/그룹/서비스 계정에 역할 할당</span>
<span class="nt">apiVersion</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">rbac.authorization.k8s.io/v1</span>
<span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">RoleBinding</span>
<span class="nt">metadata</span><span class="p">:</span>
<span class="w">  </span><span class="nt">namespace</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">production</span>
<span class="w">  </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">developer-read-access</span>
<span class="nt">subjects</span><span class="p">:</span>
<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Group</span>
<span class="w">    </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">developers</span>
<span class="w">    </span><span class="nt">apiGroup</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">rbac.authorization.k8s.io</span>
<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">ServiceAccount</span>
<span class="w">    </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">monitoring-sa</span>
<span class="w">    </span><span class="nt">namespace</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">production</span>
<span class="nt">roleRef</span><span class="p">:</span>
<span class="w">  </span><span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Role</span>
<span class="w">  </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">app-reader</span>
<span class="w">  </span><span class="nt">apiGroup</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">rbac.authorization.k8s.io</span>

<span class="nn">---</span>
<span class="c1"># ClusterRole: 클러스터 전체 권한</span>
<span class="nt">apiVersion</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">rbac.authorization.k8s.io/v1</span>
<span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">ClusterRole</span>
<span class="nt">metadata</span><span class="p">:</span>
<span class="w">  </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">namespace-admin</span>
<span class="nt">rules</span><span class="p">:</span>
<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">apiGroups</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">[</span><span class="s">&quot;&quot;</span><span class="p p-Indicator">]</span>
<span class="w">    </span><span class="nt">resources</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">[</span><span class="s">&quot;namespaces&quot;</span><span class="p p-Indicator">]</span>
<span class="w">    </span><span class="nt">verbs</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">[</span><span class="s">&quot;get&quot;</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="s">&quot;list&quot;</span><span class="p p-Indicator">]</span>
<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">apiGroups</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">[</span><span class="s">&quot;apps&quot;</span><span class="p p-Indicator">]</span>
<span class="w">    </span><span class="nt">resources</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">[</span><span class="s">&quot;deployments&quot;</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="s">&quot;replicasets&quot;</span><span class="p p-Indicator">]</span>
<span class="w">    </span><span class="nt">verbs</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">[</span><span class="s">&quot;get&quot;</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="s">&quot;list&quot;</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="s">&quot;watch&quot;</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="s">&quot;create&quot;</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="s">&quot;update&quot;</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="s">&quot;patch&quot;</span><span class="p p-Indicator">]</span>
<span class="w">  </span><span class="c1"># 네임스페이스에서 delete 명시적으로 거부</span>
<span class="w">  </span><span class="c1"># (verbs에 &quot;delete&quot;를 포함하지 않음)</span>

<span class="nn">---</span>
<span class="c1"># ClusterRoleBinding</span>
<span class="nt">apiVersion</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">rbac.authorization.k8s.io/v1</span>
<span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">ClusterRoleBinding</span>
<span class="nt">metadata</span><span class="p">:</span>
<span class="w">  </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">team-leads-namespace-admin</span>
<span class="nt">subjects</span><span class="p">:</span>
<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Group</span>
<span class="w">    </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">team-leads</span>
<span class="w">    </span><span class="nt">apiGroup</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">rbac.authorization.k8s.io</span>
<span class="nt">roleRef</span><span class="p">:</span>
<span class="w">  </span><span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">ClusterRole</span>
<span class="w">  </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">namespace-admin</span>
<span class="w">  </span><span class="nt">apiGroup</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">rbac.authorization.k8s.io</span>
</code></pre></div>

<div class="highlight"><pre><span></span><code><span class="c1"># ── RBAC 감사 명령 ──────────────────────────────────────────────</span>

<span class="c1"># 모든 역할 및 바인딩 목록</span>
kubectl<span class="w"> </span>get<span class="w"> </span>roles,rolebindings<span class="w"> </span>-A
kubectl<span class="w"> </span>get<span class="w"> </span>clusterroles,clusterrolebindings

<span class="c1"># 사용자가 할 수 있는 작업 확인</span>
kubectl<span class="w"> </span>auth<span class="w"> </span>can-i<span class="w"> </span>--list<span class="w"> </span>--as<span class="w"> </span>developer@example.com

<span class="c1"># 특정 권한 확인</span>
kubectl<span class="w"> </span>auth<span class="w"> </span>can-i<span class="w"> </span>create<span class="w"> </span>pods<span class="w"> </span>--namespace<span class="w"> </span>production<span class="w"> </span>--as<span class="w"> </span>developer@example.com

<span class="c1"># 지나치게 관대한 바인딩 찾기</span>
kubectl<span class="w"> </span>get<span class="w"> </span>clusterrolebindings<span class="w"> </span>-o<span class="w"> </span>json<span class="w"> </span><span class="p">|</span><span class="w"> </span><span class="se">\</span>
<span class="w">    </span>jq<span class="w"> </span><span class="s1">&#39;.items[] | select(.roleRef.name == &quot;cluster-admin&quot;) | .subjects&#39;</span>
</code></pre></div>

<h3 id="53-network-policies">5.3 Network Policies<a class="header-link" href="#53-network-policies" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><span class="c1"># ── 기본: 모든 인그레스 및 이그레스 거부 ─────────────────────────</span>
<span class="nt">apiVersion</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">networking.k8s.io/v1</span>
<span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">NetworkPolicy</span>
<span class="nt">metadata</span><span class="p">:</span>
<span class="w">  </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">default-deny-all</span>
<span class="w">  </span><span class="nt">namespace</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">production</span>
<span class="nt">spec</span><span class="p">:</span>
<span class="w">  </span><span class="nt">podSelector</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">{}</span><span class="w">  </span><span class="c1"># 네임스페이스의 모든 pod에 적용</span>
<span class="w">  </span><span class="nt">policyTypes</span><span class="p">:</span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Ingress</span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Egress</span>
<span class="w">  </span><span class="c1"># 인그레스 또는 이그레스 규칙 없음 = 모두 거부</span>

<span class="nn">---</span>
<span class="c1"># ── 특정 트래픽 패턴 허용 ──────────────────────────────────────</span>
<span class="c1"># 웹 pod가 인그레스 컨트롤러로부터 트래픽 받기 허용</span>
<span class="nt">apiVersion</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">networking.k8s.io/v1</span>
<span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">NetworkPolicy</span>
<span class="nt">metadata</span><span class="p">:</span>
<span class="w">  </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">allow-web-ingress</span>
<span class="w">  </span><span class="nt">namespace</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">production</span>
<span class="nt">spec</span><span class="p">:</span>
<span class="w">  </span><span class="nt">podSelector</span><span class="p">:</span>
<span class="w">    </span><span class="nt">matchLabels</span><span class="p">:</span>
<span class="w">      </span><span class="nt">app</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">web</span>
<span class="w">  </span><span class="nt">policyTypes</span><span class="p">:</span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Ingress</span>
<span class="w">  </span><span class="nt">ingress</span><span class="p">:</span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">from</span><span class="p">:</span>
<span class="w">        </span><span class="c1"># 인그레스 컨트롤러 네임스페이스에서 허용</span>
<span class="w">        </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">namespaceSelector</span><span class="p">:</span>
<span class="w">            </span><span class="nt">matchLabels</span><span class="p">:</span>
<span class="w">              </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">ingress-nginx</span>
<span class="w">          </span><span class="nt">podSelector</span><span class="p">:</span>
<span class="w">            </span><span class="nt">matchLabels</span><span class="p">:</span>
<span class="w">              </span><span class="nt">app</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">ingress-nginx</span>
<span class="w">      </span><span class="nt">ports</span><span class="p">:</span>
<span class="w">        </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">protocol</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">TCP</span>
<span class="w">          </span><span class="nt">port</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">8080</span>

<span class="nn">---</span>
<span class="c1"># 웹 pod가 API pod에 연결 허용</span>
<span class="nt">apiVersion</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">networking.k8s.io/v1</span>
<span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">NetworkPolicy</span>
<span class="nt">metadata</span><span class="p">:</span>
<span class="w">  </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">allow-web-to-api</span>
<span class="w">  </span><span class="nt">namespace</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">production</span>
<span class="nt">spec</span><span class="p">:</span>
<span class="w">  </span><span class="nt">podSelector</span><span class="p">:</span>
<span class="w">    </span><span class="nt">matchLabels</span><span class="p">:</span>
<span class="w">      </span><span class="nt">app</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">api</span>
<span class="w">  </span><span class="nt">policyTypes</span><span class="p">:</span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Ingress</span>
<span class="w">  </span><span class="nt">ingress</span><span class="p">:</span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">from</span><span class="p">:</span>
<span class="w">        </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">podSelector</span><span class="p">:</span>
<span class="w">            </span><span class="nt">matchLabels</span><span class="p">:</span>
<span class="w">              </span><span class="nt">app</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">web</span>
<span class="w">      </span><span class="nt">ports</span><span class="p">:</span>
<span class="w">        </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">protocol</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">TCP</span>
<span class="w">          </span><span class="nt">port</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">3000</span>

<span class="nn">---</span>
<span class="c1"># API pod가 데이터베이스에 연결 허용</span>
<span class="nt">apiVersion</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">networking.k8s.io/v1</span>
<span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">NetworkPolicy</span>
<span class="nt">metadata</span><span class="p">:</span>
<span class="w">  </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">allow-api-to-db</span>
<span class="w">  </span><span class="nt">namespace</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">production</span>
<span class="nt">spec</span><span class="p">:</span>
<span class="w">  </span><span class="nt">podSelector</span><span class="p">:</span>
<span class="w">    </span><span class="nt">matchLabels</span><span class="p">:</span>
<span class="w">      </span><span class="nt">app</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">database</span>
<span class="w">  </span><span class="nt">policyTypes</span><span class="p">:</span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Ingress</span>
<span class="w">  </span><span class="nt">ingress</span><span class="p">:</span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">from</span><span class="p">:</span>
<span class="w">        </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">podSelector</span><span class="p">:</span>
<span class="w">            </span><span class="nt">matchLabels</span><span class="p">:</span>
<span class="w">              </span><span class="nt">app</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">api</span>
<span class="w">      </span><span class="nt">ports</span><span class="p">:</span>
<span class="w">        </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">protocol</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">TCP</span>
<span class="w">          </span><span class="nt">port</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">5432</span>

<span class="nn">---</span>
<span class="c1"># 모든 pod에 대해 DNS 해석 허용</span>
<span class="nt">apiVersion</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">networking.k8s.io/v1</span>
<span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">NetworkPolicy</span>
<span class="nt">metadata</span><span class="p">:</span>
<span class="w">  </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">allow-dns</span>
<span class="w">  </span><span class="nt">namespace</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">production</span>
<span class="nt">spec</span><span class="p">:</span>
<span class="w">  </span><span class="nt">podSelector</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">{}</span>
<span class="w">  </span><span class="nt">policyTypes</span><span class="p">:</span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Egress</span>
<span class="w">  </span><span class="nt">egress</span><span class="p">:</span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">to</span><span class="p">:</span>
<span class="w">        </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">namespaceSelector</span><span class="p">:</span>
<span class="w">            </span><span class="nt">matchLabels</span><span class="p">:</span>
<span class="w">              </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">kube-system</span>
<span class="w">      </span><span class="nt">ports</span><span class="p">:</span>
<span class="w">        </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">protocol</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">UDP</span>
<span class="w">          </span><span class="nt">port</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">53</span>
<span class="w">        </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">protocol</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">TCP</span>
<span class="w">          </span><span class="nt">port</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">53</span>
</code></pre></div>

<div class="highlight"><pre><span></span><code>┌─────────────────────────────────────────────────────────────────────┐
│                    Network Policy 시각화                             │
├─────────────────────────────────────────────────────────────────────┤
│                                                                      │
│  인터넷                                                               │
│      │                                                               │
│      ▼                                                               │
│  ┌──────────┐    ┌──────────┐    ┌──────────┐                       │
│  │ Ingress  │───▶│   Web    │───▶│   API    │                       │
│  │Controller│    │  :8080   │    │  :3000   │                       │
│  └──────────┘    └──────────┘    └──────────┘                       │
│                                       │                              │
│                                       ▼                              │
│                                  ┌──────────┐                        │
│                                  │ Database │                        │
│                                  │  :5432   │                        │
│                                  └──────────┘                        │
│                                                                      │
│  NetworkPolicy로 차단된 경로:                                         │
│  ✗ 인터넷 → API 직접                                                 │
│  ✗ 인터넷 → 데이터베이스 직접                                        │
│  ✗ Web → 데이터베이스 직접                                           │
│  ✗ 모든 pod → 인터넷 (DNS 제외)                                      │
│                                                                      │
└─────────────────────────────────────────────────────────────────────┘
</code></pre></div>

<h3 id="54-pod-security-standards">5.4 Pod Security Standards<a class="header-link" href="#54-pod-security-standards" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><span class="c1"># ── Pod Security Standards (PSS) — Restricted 레벨 ──────────────</span>
<span class="c1"># 네임스페이스 레이블을 통해 적용 (Kubernetes 1.25+)</span>

<span class="c1"># 제한된 보안을 강제하기 위해 네임스페이스 레이블 지정</span>
<span class="nt">apiVersion</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">v1</span>
<span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Namespace</span>
<span class="nt">metadata</span><span class="p">:</span>
<span class="w">  </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">production</span>
<span class="w">  </span><span class="nt">labels</span><span class="p">:</span>
<span class="w">    </span><span class="c1"># Enforce: 위반하는 pod 거부</span>
<span class="w">    </span><span class="nt">pod-security.kubernetes.io/enforce</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">restricted</span>
<span class="w">    </span><span class="nt">pod-security.kubernetes.io/enforce-version</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">latest</span>
<span class="w">    </span><span class="c1"># Warn: 경고 로그 (하지만 허용)</span>
<span class="w">    </span><span class="nt">pod-security.kubernetes.io/warn</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">restricted</span>
<span class="w">    </span><span class="nt">pod-security.kubernetes.io/warn-version</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">latest</span>
<span class="w">    </span><span class="c1"># Audit: 감사 로그에 기록</span>
<span class="w">    </span><span class="nt">pod-security.kubernetes.io/audit</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">restricted</span>
<span class="w">    </span><span class="nt">pod-security.kubernetes.io/audit-version</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">latest</span>

<span class="nn">---</span>
<span class="c1"># 제한된 보안 표준을 충족하는 Pod</span>
<span class="nt">apiVersion</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">v1</span>
<span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Pod</span>
<span class="nt">metadata</span><span class="p">:</span>
<span class="w">  </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">secure-pod</span>
<span class="w">  </span><span class="nt">namespace</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">production</span>
<span class="nt">spec</span><span class="p">:</span>
<span class="w">  </span><span class="c1"># 보안: 호스트 네임스페이스 사용하지 않기</span>
<span class="w">  </span><span class="nt">hostNetwork</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">false</span>
<span class="w">  </span><span class="nt">hostPID</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">false</span>
<span class="w">  </span><span class="nt">hostIPC</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">false</span>

<span class="w">  </span><span class="c1"># 보안: 비root 사용</span>
<span class="w">  </span><span class="nt">securityContext</span><span class="p">:</span>
<span class="w">    </span><span class="nt">runAsNonRoot</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">true</span>
<span class="w">    </span><span class="nt">runAsUser</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">1000</span>
<span class="w">    </span><span class="nt">runAsGroup</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">1000</span>
<span class="w">    </span><span class="nt">fsGroup</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">1000</span>
<span class="w">    </span><span class="nt">seccompProfile</span><span class="p">:</span>
<span class="w">      </span><span class="nt">type</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">RuntimeDefault</span>

<span class="w">  </span><span class="nt">containers</span><span class="p">:</span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">app</span>
<span class="w">      </span><span class="nt">image</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">myregistry.io/myapp@sha256:abc123...</span><span class="w">  </span><span class="c1"># digest에 고정</span>
<span class="w">      </span><span class="nt">ports</span><span class="p">:</span>
<span class="w">        </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">containerPort</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">8080</span>

<span class="w">      </span><span class="c1"># 보안 컨텍스트 (컨테이너 레벨)</span>
<span class="w">      </span><span class="nt">securityContext</span><span class="p">:</span>
<span class="w">        </span><span class="nt">allowPrivilegeEscalation</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">false</span>
<span class="w">        </span><span class="nt">readOnlyRootFilesystem</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">true</span>
<span class="w">        </span><span class="nt">runAsNonRoot</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">true</span>
<span class="w">        </span><span class="nt">runAsUser</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">1000</span>
<span class="w">        </span><span class="nt">capabilities</span><span class="p">:</span>
<span class="w">          </span><span class="nt">drop</span><span class="p">:</span>
<span class="w">            </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">ALL</span>
<span class="w">          </span><span class="c1"># 정말 필요한 권한만 추가</span>
<span class="w">          </span><span class="c1"># add:</span>
<span class="w">          </span><span class="c1">#   - NET_BIND_SERVICE  # 1024 미만 포트에 바인딩하는 경우</span>

<span class="w">      </span><span class="c1"># 리소스 제한 (DoS 방지)</span>
<span class="w">      </span><span class="nt">resources</span><span class="p">:</span>
<span class="w">        </span><span class="nt">requests</span><span class="p">:</span>
<span class="w">          </span><span class="nt">memory</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;128Mi&quot;</span>
<span class="w">          </span><span class="nt">cpu</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;100m&quot;</span>
<span class="w">        </span><span class="nt">limits</span><span class="p">:</span>
<span class="w">          </span><span class="nt">memory</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;512Mi&quot;</span>
<span class="w">          </span><span class="nt">cpu</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;500m&quot;</span>

<span class="w">      </span><span class="c1"># emptyDir을 통한 쓰기 가능 디렉토리</span>
<span class="w">      </span><span class="nt">volumeMounts</span><span class="p">:</span>
<span class="w">        </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">tmp</span>
<span class="w">          </span><span class="nt">mountPath</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">/tmp</span>
<span class="w">        </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">cache</span>
<span class="w">          </span><span class="nt">mountPath</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">/app/cache</span>

<span class="w">  </span><span class="nt">volumes</span><span class="p">:</span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">tmp</span>
<span class="w">      </span><span class="nt">emptyDir</span><span class="p">:</span>
<span class="w">        </span><span class="nt">sizeLimit</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">100Mi</span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">cache</span>
<span class="w">      </span><span class="nt">emptyDir</span><span class="p">:</span>
<span class="w">        </span><span class="nt">sizeLimit</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">200Mi</span>

<span class="w">  </span><span class="c1"># 보안: 서비스 계정</span>
<span class="w">  </span><span class="nt">serviceAccountName</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">app-sa</span>
<span class="w">  </span><span class="nt">automountServiceAccountToken</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">false</span><span class="w">  </span><span class="c1"># 필요하지 않으면 비활성화</span>
</code></pre></div>

<h3 id="55-kubernetes">5.5 Kubernetes 보안 체크리스트<a class="header-link" href="#55-kubernetes" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">Kubernetes 보안 감사 스크립트.</span>
<span class="sd">일반적인 잘못된 구성 확인.</span>
<span class="sd">&quot;&quot;&quot;</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">subprocess</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">json</span>

<span class="k">def</span><span class="w"> </span><span class="nf">run_kubectl</span><span class="p">(</span><span class="n">args</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;kubectl 명령 실행 및 JSON 출력 반환.&quot;&quot;&quot;</span>
    <span class="n">result</span> <span class="o">=</span> <span class="n">subprocess</span><span class="o">.</span><span class="n">run</span><span class="p">(</span>
        <span class="sa">f</span><span class="s2">&quot;kubectl </span><span class="si">{</span><span class="n">args</span><span class="si">}</span><span class="s2"> -o json&quot;</span><span class="p">,</span>
        <span class="n">shell</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">capture_output</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">text</span><span class="o">=</span><span class="kc">True</span>
    <span class="p">)</span>
    <span class="k">return</span> <span class="n">json</span><span class="o">.</span><span class="n">loads</span><span class="p">(</span><span class="n">result</span><span class="o">.</span><span class="n">stdout</span><span class="p">)</span> <span class="k">if</span> <span class="n">result</span><span class="o">.</span><span class="n">stdout</span> <span class="k">else</span> <span class="p">{}</span>


<span class="k">def</span><span class="w"> </span><span class="nf">audit_cluster_security</span><span class="p">():</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;보안 문제를 위한 Kubernetes 클러스터 감사.&quot;&quot;&quot;</span>
    <span class="n">findings</span> <span class="o">=</span> <span class="p">[]</span>

    <span class="c1"># ── 확인 1: root로 실행되는 Pod ────────────────────────────</span>
    <span class="n">pods</span> <span class="o">=</span> <span class="n">run_kubectl</span><span class="p">(</span><span class="s2">&quot;get pods -A&quot;</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">pod</span> <span class="ow">in</span> <span class="n">pods</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;items&quot;</span><span class="p">,</span> <span class="p">[]):</span>
        <span class="k">for</span> <span class="n">container</span> <span class="ow">in</span> <span class="n">pod</span><span class="p">[</span><span class="s2">&quot;spec&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;containers&quot;</span><span class="p">,</span> <span class="p">[]):</span>
            <span class="n">sc</span> <span class="o">=</span> <span class="n">container</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;securityContext&quot;</span><span class="p">,</span> <span class="p">{})</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">sc</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;runAsNonRoot&quot;</span><span class="p">,</span> <span class="kc">False</span><span class="p">):</span>
                <span class="n">pod_name</span> <span class="o">=</span> <span class="n">pod</span><span class="p">[</span><span class="s2">&quot;metadata&quot;</span><span class="p">][</span><span class="s2">&quot;name&quot;</span><span class="p">]</span>
                <span class="n">ns</span> <span class="o">=</span> <span class="n">pod</span><span class="p">[</span><span class="s2">&quot;metadata&quot;</span><span class="p">][</span><span class="s2">&quot;namespace&quot;</span><span class="p">]</span>
                <span class="n">findings</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
                    <span class="sa">f</span><span class="s2">&quot;[HIGH] Pod </span><span class="si">{</span><span class="n">ns</span><span class="si">}</span><span class="s2">/</span><span class="si">{</span><span class="n">pod_name</span><span class="si">}</span><span class="s2"> container &quot;</span>
                    <span class="sa">f</span><span class="s2">&quot;&#39;</span><span class="si">{</span><span class="n">container</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">&#39; may run as root&quot;</span>
                <span class="p">)</span>

    <span class="c1"># ── 확인 2: 특권 컨테이너 ───────────────────────────────────</span>
    <span class="k">for</span> <span class="n">pod</span> <span class="ow">in</span> <span class="n">pods</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;items&quot;</span><span class="p">,</span> <span class="p">[]):</span>
        <span class="k">for</span> <span class="n">container</span> <span class="ow">in</span> <span class="n">pod</span><span class="p">[</span><span class="s2">&quot;spec&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;containers&quot;</span><span class="p">,</span> <span class="p">[]):</span>
            <span class="n">sc</span> <span class="o">=</span> <span class="n">container</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;securityContext&quot;</span><span class="p">,</span> <span class="p">{})</span>
            <span class="k">if</span> <span class="n">sc</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;privileged&quot;</span><span class="p">,</span> <span class="kc">False</span><span class="p">):</span>
                <span class="n">pod_name</span> <span class="o">=</span> <span class="n">pod</span><span class="p">[</span><span class="s2">&quot;metadata&quot;</span><span class="p">][</span><span class="s2">&quot;name&quot;</span><span class="p">]</span>
                <span class="n">ns</span> <span class="o">=</span> <span class="n">pod</span><span class="p">[</span><span class="s2">&quot;metadata&quot;</span><span class="p">][</span><span class="s2">&quot;namespace&quot;</span><span class="p">]</span>
                <span class="n">findings</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
                    <span class="sa">f</span><span class="s2">&quot;[CRITICAL] Pod </span><span class="si">{</span><span class="n">ns</span><span class="si">}</span><span class="s2">/</span><span class="si">{</span><span class="n">pod_name</span><span class="si">}</span><span class="s2"> container &quot;</span>
                    <span class="sa">f</span><span class="s2">&quot;&#39;</span><span class="si">{</span><span class="n">container</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">&#39; is PRIVILEGED&quot;</span>
                <span class="p">)</span>

    <span class="c1"># ── 확인 3: 리소스 제한 없음 ──────────────────────────────────</span>
    <span class="k">for</span> <span class="n">pod</span> <span class="ow">in</span> <span class="n">pods</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;items&quot;</span><span class="p">,</span> <span class="p">[]):</span>
        <span class="k">for</span> <span class="n">container</span> <span class="ow">in</span> <span class="n">pod</span><span class="p">[</span><span class="s2">&quot;spec&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;containers&quot;</span><span class="p">,</span> <span class="p">[]):</span>
            <span class="n">resources</span> <span class="o">=</span> <span class="n">container</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;resources&quot;</span><span class="p">,</span> <span class="p">{})</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">resources</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;limits&quot;</span><span class="p">):</span>
                <span class="n">pod_name</span> <span class="o">=</span> <span class="n">pod</span><span class="p">[</span><span class="s2">&quot;metadata&quot;</span><span class="p">][</span><span class="s2">&quot;name&quot;</span><span class="p">]</span>
                <span class="n">ns</span> <span class="o">=</span> <span class="n">pod</span><span class="p">[</span><span class="s2">&quot;metadata&quot;</span><span class="p">][</span><span class="s2">&quot;namespace&quot;</span><span class="p">]</span>
                <span class="n">findings</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
                    <span class="sa">f</span><span class="s2">&quot;[MEDIUM] Pod </span><span class="si">{</span><span class="n">ns</span><span class="si">}</span><span class="s2">/</span><span class="si">{</span><span class="n">pod_name</span><span class="si">}</span><span class="s2"> container &quot;</span>
                    <span class="sa">f</span><span class="s2">&quot;&#39;</span><span class="si">{</span><span class="n">container</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">&#39; has no resource limits&quot;</span>
                <span class="p">)</span>

    <span class="c1"># ── 확인 4: 기본 서비스 계정 사용 ───────────────────────────────</span>
    <span class="k">for</span> <span class="n">pod</span> <span class="ow">in</span> <span class="n">pods</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;items&quot;</span><span class="p">,</span> <span class="p">[]):</span>
        <span class="n">sa</span> <span class="o">=</span> <span class="n">pod</span><span class="p">[</span><span class="s2">&quot;spec&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;serviceAccountName&quot;</span><span class="p">,</span> <span class="s2">&quot;default&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">sa</span> <span class="o">==</span> <span class="s2">&quot;default&quot;</span><span class="p">:</span>
            <span class="n">pod_name</span> <span class="o">=</span> <span class="n">pod</span><span class="p">[</span><span class="s2">&quot;metadata&quot;</span><span class="p">][</span><span class="s2">&quot;name&quot;</span><span class="p">]</span>
            <span class="n">ns</span> <span class="o">=</span> <span class="n">pod</span><span class="p">[</span><span class="s2">&quot;metadata&quot;</span><span class="p">][</span><span class="s2">&quot;namespace&quot;</span><span class="p">]</span>
            <span class="n">auto_mount</span> <span class="o">=</span> <span class="n">pod</span><span class="p">[</span><span class="s2">&quot;spec&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">get</span><span class="p">(</span>
                <span class="s2">&quot;automountServiceAccountToken&quot;</span><span class="p">,</span> <span class="kc">True</span>
            <span class="p">)</span>
            <span class="k">if</span> <span class="n">auto_mount</span><span class="p">:</span>
                <span class="n">findings</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
                    <span class="sa">f</span><span class="s2">&quot;[HIGH] Pod </span><span class="si">{</span><span class="n">ns</span><span class="si">}</span><span class="s2">/</span><span class="si">{</span><span class="n">pod_name</span><span class="si">}</span><span class="s2"> uses default SA &quot;</span>
                    <span class="sa">f</span><span class="s2">&quot;with token auto-mounted&quot;</span>
                <span class="p">)</span>

    <span class="c1"># ── 확인 5: digest 없는 이미지 ───────────────────────────────</span>
    <span class="k">for</span> <span class="n">pod</span> <span class="ow">in</span> <span class="n">pods</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;items&quot;</span><span class="p">,</span> <span class="p">[]):</span>
        <span class="k">for</span> <span class="n">container</span> <span class="ow">in</span> <span class="n">pod</span><span class="p">[</span><span class="s2">&quot;spec&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;containers&quot;</span><span class="p">,</span> <span class="p">[]):</span>
            <span class="n">image</span> <span class="o">=</span> <span class="n">container</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;image&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">)</span>
            <span class="k">if</span> <span class="s2">&quot;@sha256:&quot;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">image</span> <span class="ow">and</span> <span class="s2">&quot;:latest&quot;</span> <span class="ow">in</span> <span class="n">image</span><span class="p">:</span>
                <span class="n">pod_name</span> <span class="o">=</span> <span class="n">pod</span><span class="p">[</span><span class="s2">&quot;metadata&quot;</span><span class="p">][</span><span class="s2">&quot;name&quot;</span><span class="p">]</span>
                <span class="n">ns</span> <span class="o">=</span> <span class="n">pod</span><span class="p">[</span><span class="s2">&quot;metadata&quot;</span><span class="p">][</span><span class="s2">&quot;namespace&quot;</span><span class="p">]</span>
                <span class="n">findings</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
                    <span class="sa">f</span><span class="s2">&quot;[MEDIUM] Pod </span><span class="si">{</span><span class="n">ns</span><span class="si">}</span><span class="s2">/</span><span class="si">{</span><span class="n">pod_name</span><span class="si">}</span><span class="s2"> uses :latest &quot;</span>
                    <span class="sa">f</span><span class="s2">&quot;tag for &#39;</span><span class="si">{</span><span class="n">container</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">&#39;&quot;</span>
                <span class="p">)</span>

    <span class="c1"># ── 확인 6: 네트워크 정책 없는 네임스페이스 ────────────────────</span>
    <span class="n">namespaces</span> <span class="o">=</span> <span class="n">run_kubectl</span><span class="p">(</span><span class="s2">&quot;get namespaces&quot;</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">ns</span> <span class="ow">in</span> <span class="n">namespaces</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;items&quot;</span><span class="p">,</span> <span class="p">[]):</span>
        <span class="n">ns_name</span> <span class="o">=</span> <span class="n">ns</span><span class="p">[</span><span class="s2">&quot;metadata&quot;</span><span class="p">][</span><span class="s2">&quot;name&quot;</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">ns_name</span> <span class="ow">in</span> <span class="p">(</span><span class="s2">&quot;kube-system&quot;</span><span class="p">,</span> <span class="s2">&quot;kube-public&quot;</span><span class="p">,</span> <span class="s2">&quot;kube-node-lease&quot;</span><span class="p">):</span>
            <span class="k">continue</span>
        <span class="n">netpols</span> <span class="o">=</span> <span class="n">run_kubectl</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;get networkpolicies -n </span><span class="si">{</span><span class="n">ns_name</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">netpols</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;items&quot;</span><span class="p">):</span>
            <span class="n">findings</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;[HIGH] Namespace &#39;</span><span class="si">{</span><span class="n">ns_name</span><span class="si">}</span><span class="s2">&#39; has no NetworkPolicies&quot;</span>
            <span class="p">)</span>

    <span class="k">return</span> <span class="n">findings</span>


<span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s2">&quot;__main__&quot;</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Kubernetes Security Audit&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;=&quot;</span> <span class="o">*</span> <span class="mi">60</span><span class="p">)</span>
    <span class="n">findings</span> <span class="o">=</span> <span class="n">audit_cluster_security</span><span class="p">()</span>

    <span class="k">if</span> <span class="n">findings</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="n">findings</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="n">f</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Total findings: </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">findings</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;No security issues found.&quot;</span><span class="p">)</span>
</code></pre></div>

<hr />
<h2 id="6">6. 서비스 메시 보안<a class="header-link" href="#6" title="Permanent link">&para;</a></h2>
<h3 id="61-istio-mtls">6.1 Istio와 mTLS<a class="header-link" href="#61-istio-mtls" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code>┌─────────────────────────────────────────────────────────────────────┐
│                    서비스 메시와 Mutual TLS (mTLS)                    │
├─────────────────────────────────────────────────────────────────────┤
│                                                                      │
│  mTLS 없이:                                                           │
│  Pod A ────── 평문 ──────▶ Pod B                                     │
│  (네트워크의 누구나 가로챌 수 있음)                                    │
│                                                                      │
│  mTLS와 함께 (Istio 사이드카 프록시):                                 │
│  ┌────────────────────┐         ┌────────────────────┐              │
│  │  Pod A             │         │  Pod B             │              │
│  │  ┌─────┐ ┌──────┐ │ TLS     │ ┌──────┐ ┌─────┐  │              │
│  │  │ App │→│Envoy │─┼─────────┼─│Envoy │→│ App │  │              │
│  │  └─────┘ └──────┘ │ mTLS    │ └──────┘ └─────┘  │              │
│  └────────────────────┘ 상호    └────────────────────┘              │
│                         인증                                         │
│                                                                      │
│  mTLS 제공:                                                           │
│  1. 암호화:      모든 트래픽이 전송 중 암호화됨                        │
│  2. 인증:        양쪽 모두 신원 확인 (인증서)                          │
│  3. 권한 부여:   허용된 서비스만 통신 가능                             │
│  4. 자동:        인증서 교체가 메시에 의해 처리됨                      │
│                                                                      │
└─────────────────────────────────────────────────────────────────────┘
</code></pre></div>

<div class="highlight"><pre><span></span><code><span class="c1"># ── Istio PeerAuthentication: mTLS 강제 ──────────────────────</span>
<span class="nt">apiVersion</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">security.istio.io/v1</span>
<span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">PeerAuthentication</span>
<span class="nt">metadata</span><span class="p">:</span>
<span class="w">  </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">default</span>
<span class="w">  </span><span class="nt">namespace</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">production</span>
<span class="nt">spec</span><span class="p">:</span>
<span class="w">  </span><span class="nt">mtls</span><span class="p">:</span>
<span class="w">    </span><span class="nt">mode</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">STRICT</span><span class="w">  </span><span class="c1"># mTLS가 아닌 연결 거부</span>

<span class="nn">---</span>
<span class="c1"># ── Istio AuthorizationPolicy ───────────────────────────────────</span>
<span class="c1"># 특정 서비스 간 통신만 허용</span>
<span class="nt">apiVersion</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">security.istio.io/v1</span>
<span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">AuthorizationPolicy</span>
<span class="nt">metadata</span><span class="p">:</span>
<span class="w">  </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">api-access</span>
<span class="w">  </span><span class="nt">namespace</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">production</span>
<span class="nt">spec</span><span class="p">:</span>
<span class="w">  </span><span class="nt">selector</span><span class="p">:</span>
<span class="w">    </span><span class="nt">matchLabels</span><span class="p">:</span>
<span class="w">      </span><span class="nt">app</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">api-service</span>
<span class="w">  </span><span class="nt">action</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">ALLOW</span>
<span class="w">  </span><span class="nt">rules</span><span class="p">:</span>
<span class="w">    </span><span class="c1"># web-frontend가 api-service 호출 허용</span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">from</span><span class="p">:</span>
<span class="w">        </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">source</span><span class="p">:</span>
<span class="w">            </span><span class="nt">principals</span><span class="p">:</span>
<span class="w">              </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="s">&quot;cluster.local/ns/production/sa/web-frontend-sa&quot;</span>
<span class="w">      </span><span class="nt">to</span><span class="p">:</span>
<span class="w">        </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">operation</span><span class="p">:</span>
<span class="w">            </span><span class="nt">methods</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">[</span><span class="s">&quot;GET&quot;</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="s">&quot;POST&quot;</span><span class="p p-Indicator">]</span>
<span class="w">            </span><span class="nt">paths</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">[</span><span class="s">&quot;/api/*&quot;</span><span class="p p-Indicator">]</span>

<span class="w">    </span><span class="c1"># 모니터링이 헬스 엔드포인트 호출 허용</span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">from</span><span class="p">:</span>
<span class="w">        </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">source</span><span class="p">:</span>
<span class="w">            </span><span class="nt">principals</span><span class="p">:</span>
<span class="w">              </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="s">&quot;cluster.local/ns/monitoring/sa/prometheus-sa&quot;</span>
<span class="w">      </span><span class="nt">to</span><span class="p">:</span>
<span class="w">        </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">operation</span><span class="p">:</span>
<span class="w">            </span><span class="nt">methods</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">[</span><span class="s">&quot;GET&quot;</span><span class="p p-Indicator">]</span>
<span class="w">            </span><span class="nt">paths</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">[</span><span class="s">&quot;/health&quot;</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="s">&quot;/metrics&quot;</span><span class="p p-Indicator">]</span>

<span class="nn">---</span>
<span class="c1"># api-service로의 다른 모든 트래픽 거부</span>
<span class="nt">apiVersion</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">security.istio.io/v1</span>
<span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">AuthorizationPolicy</span>
<span class="nt">metadata</span><span class="p">:</span>
<span class="w">  </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">deny-all</span>
<span class="w">  </span><span class="nt">namespace</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">production</span>
<span class="nt">spec</span><span class="p">:</span>
<span class="w">  </span><span class="nt">selector</span><span class="p">:</span>
<span class="w">    </span><span class="nt">matchLabels</span><span class="p">:</span>
<span class="w">      </span><span class="nt">app</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">api-service</span>
<span class="w">  </span><span class="nt">action</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">DENY</span>
<span class="w">  </span><span class="nt">rules</span><span class="p">:</span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="p p-Indicator">{}</span>
</code></pre></div>

<hr />
<h2 id="7-iam">7. 클라우드 IAM 모범 사례<a class="header-link" href="#7-iam" title="Permanent link">&para;</a></h2>
<h3 id="71-iam">7.1 IAM 원칙<a class="header-link" href="#71-iam" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code>┌─────────────────────────────────────────────────────────────────────┐
│                    클라우드 IAM 보안 원칙                             │
├─────────────────────────────────────────────────────────────────────┤
│                                                                      │
│  1. 최소 권한                                                          │
│     ├── 작업에 필요한 권한만 부여                                      │
│     ├── 세분화된 정책 사용 (AdministratorAccess 아님)                 │
│     └── 정기적으로 권한 검토 및 축소                                   │
│                                                                      │
│  2. 장기 자격 증명 없음                                                │
│     ├── 액세스 키 대신 IAM 역할 사용                                  │
│     ├── CI/CD를 위한 OIDC 페더레이션 사용                              │
│     └── 키가 필요한 경우 90일마다 교체                                 │
│                                                                      │
│  3. 모든 곳에 MFA                                                      │
│     ├── 콘솔 액세스에 MFA 필요                                        │
│     ├── 민감한 API 호출에 MFA 필요                                    │
│     └── 특권 계정에 하드웨어 보안 키 사용                              │
│                                                                      │
│  4. 직무 분리                                                          │
│     ├── dev/staging/prod를 위한 다른 계정                             │
│     ├── 긴급 액세스를 위한 비상 절차                                   │
│     └── 단일 사람이 배포 + 승인하면 안 됨                              │
│                                                                      │
│  5. 모든 것 감사                                                       │
│     ├── CloudTrail/Cloud Audit Logs 활성화                          │
│     ├── 비정상적인 API 패턴에 경고                                     │
│     └── 정기적인 액세스 검토                                           │
│                                                                      │
└─────────────────────────────────────────────────────────────────────┘
</code></pre></div>

<h3 id="72-aws-iam">7.2 AWS IAM 정책<a class="header-link" href="#72-aws-iam" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><span class="p">{</span>
<span class="w">  </span><span class="nt">&quot;Version&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;2012-10-17&quot;</span><span class="p">,</span>
<span class="w">  </span><span class="nt">&quot;Statement&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span>
<span class="w">    </span><span class="p">{</span>
<span class="w">      </span><span class="nt">&quot;Sid&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;AllowS3ReadOnly&quot;</span><span class="p">,</span>
<span class="w">      </span><span class="nt">&quot;Effect&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;Allow&quot;</span><span class="p">,</span>
<span class="w">      </span><span class="nt">&quot;Action&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span>
<span class="w">        </span><span class="s2">&quot;s3:GetObject&quot;</span><span class="p">,</span>
<span class="w">        </span><span class="s2">&quot;s3:ListBucket&quot;</span>
<span class="w">      </span><span class="p">],</span>
<span class="w">      </span><span class="nt">&quot;Resource&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span>
<span class="w">        </span><span class="s2">&quot;arn:aws:s3:::my-app-bucket&quot;</span><span class="p">,</span>
<span class="w">        </span><span class="s2">&quot;arn:aws:s3:::my-app-bucket/*&quot;</span>
<span class="w">      </span><span class="p">],</span>
<span class="w">      </span><span class="nt">&quot;Condition&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="nt">&quot;StringEquals&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">          </span><span class="nt">&quot;aws:RequestedRegion&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;us-east-1&quot;</span>
<span class="w">        </span><span class="p">},</span>
<span class="w">        </span><span class="nt">&quot;Bool&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">          </span><span class="nt">&quot;aws:SecureTransport&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;true&quot;</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">      </span><span class="p">}</span>
<span class="w">    </span><span class="p">},</span>
<span class="w">    </span><span class="p">{</span>
<span class="w">      </span><span class="nt">&quot;Sid&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;DenyDeleteBucket&quot;</span><span class="p">,</span>
<span class="w">      </span><span class="nt">&quot;Effect&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;Deny&quot;</span><span class="p">,</span>
<span class="w">      </span><span class="nt">&quot;Action&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span>
<span class="w">        </span><span class="s2">&quot;s3:DeleteBucket&quot;</span><span class="p">,</span>
<span class="w">        </span><span class="s2">&quot;s3:DeleteObject&quot;</span>
<span class="w">      </span><span class="p">],</span>
<span class="w">      </span><span class="nt">&quot;Resource&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;*&quot;</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">  </span><span class="p">]</span>
<span class="p">}</span>
</code></pre></div>

<div class="highlight"><pre><span></span><code><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">AWS IAM 보안 감사 스크립트.</span>
<span class="sd">pip install boto3</span>
<span class="sd">&quot;&quot;&quot;</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">boto3</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">datetime</span><span class="w"> </span><span class="kn">import</span> <span class="n">datetime</span><span class="p">,</span> <span class="n">timezone</span><span class="p">,</span> <span class="n">timedelta</span>


<span class="k">def</span><span class="w"> </span><span class="nf">audit_iam_security</span><span class="p">():</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;보안 문제를 위한 AWS IAM 구성 감사.&quot;&quot;&quot;</span>
    <span class="n">iam</span> <span class="o">=</span> <span class="n">boto3</span><span class="o">.</span><span class="n">client</span><span class="p">(</span><span class="s1">&#39;iam&#39;</span><span class="p">)</span>
    <span class="n">findings</span> <span class="o">=</span> <span class="p">[]</span>

    <span class="c1"># ── 확인 1: Root 계정 액세스 키 ────────────────────────────</span>
    <span class="n">summary</span> <span class="o">=</span> <span class="n">iam</span><span class="o">.</span><span class="n">get_account_summary</span><span class="p">()[</span><span class="s1">&#39;SummaryMap&#39;</span><span class="p">]</span>
    <span class="k">if</span> <span class="n">summary</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;AccountAccessKeysPresent&#39;</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
        <span class="n">findings</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
            <span class="s2">&quot;[CRITICAL] Root account has active access keys. &quot;</span>
            <span class="s2">&quot;Delete them immediately.&quot;</span>
        <span class="p">)</span>

    <span class="c1"># ── 확인 2: MFA 활성화되지 않음 ────────────────────────────</span>
    <span class="k">if</span> <span class="n">summary</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;AccountMFAEnabled&#39;</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
        <span class="n">findings</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
            <span class="s2">&quot;[CRITICAL] Root account does not have MFA enabled.&quot;</span>
        <span class="p">)</span>

    <span class="c1"># ── 확인 3: MFA 없는 사용자 ──────────────────────────────────</span>
    <span class="n">users</span> <span class="o">=</span> <span class="n">iam</span><span class="o">.</span><span class="n">list_users</span><span class="p">()[</span><span class="s1">&#39;Users&#39;</span><span class="p">]</span>
    <span class="k">for</span> <span class="n">user</span> <span class="ow">in</span> <span class="n">users</span><span class="p">:</span>
        <span class="n">mfa_devices</span> <span class="o">=</span> <span class="n">iam</span><span class="o">.</span><span class="n">list_mfa_devices</span><span class="p">(</span>
            <span class="n">UserName</span><span class="o">=</span><span class="n">user</span><span class="p">[</span><span class="s1">&#39;UserName&#39;</span><span class="p">]</span>
        <span class="p">)[</span><span class="s1">&#39;MFADevices&#39;</span><span class="p">]</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">mfa_devices</span><span class="p">:</span>
            <span class="n">findings</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;[HIGH] User &#39;</span><span class="si">{</span><span class="n">user</span><span class="p">[</span><span class="s1">&#39;UserName&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">&#39; does not have MFA enabled.&quot;</span>
            <span class="p">)</span>

    <span class="c1"># ── 확인 4: 오래된 액세스 키 ────────────────────────────────</span>
    <span class="k">for</span> <span class="n">user</span> <span class="ow">in</span> <span class="n">users</span><span class="p">:</span>
        <span class="n">keys</span> <span class="o">=</span> <span class="n">iam</span><span class="o">.</span><span class="n">list_access_keys</span><span class="p">(</span>
            <span class="n">UserName</span><span class="o">=</span><span class="n">user</span><span class="p">[</span><span class="s1">&#39;UserName&#39;</span><span class="p">]</span>
        <span class="p">)[</span><span class="s1">&#39;AccessKeyMetadata&#39;</span><span class="p">]</span>
        <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">keys</span><span class="p">:</span>
            <span class="n">age</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">(</span><span class="n">timezone</span><span class="o">.</span><span class="n">utc</span><span class="p">)</span> <span class="o">-</span> <span class="n">key</span><span class="p">[</span><span class="s1">&#39;CreateDate&#39;</span><span class="p">]</span>
            <span class="k">if</span> <span class="n">age</span> <span class="o">&gt;</span> <span class="n">timedelta</span><span class="p">(</span><span class="n">days</span><span class="o">=</span><span class="mi">90</span><span class="p">):</span>
                <span class="n">findings</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
                    <span class="sa">f</span><span class="s2">&quot;[HIGH] User &#39;</span><span class="si">{</span><span class="n">user</span><span class="p">[</span><span class="s1">&#39;UserName&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">&#39; has access key &quot;</span>
                    <span class="sa">f</span><span class="s2">&quot;&#39;</span><span class="si">{</span><span class="n">key</span><span class="p">[</span><span class="s1">&#39;AccessKeyId&#39;</span><span class="p">][:</span><span class="mi">8</span><span class="p">]</span><span class="si">}</span><span class="s2">...&#39; that is </span><span class="si">{</span><span class="n">age</span><span class="o">.</span><span class="n">days</span><span class="si">}</span><span class="s2"> days old. &quot;</span>
                    <span class="sa">f</span><span class="s2">&quot;Rotate immediately.&quot;</span>
                <span class="p">)</span>
            <span class="k">if</span> <span class="n">key</span><span class="p">[</span><span class="s1">&#39;Status&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;Inactive&#39;</span><span class="p">:</span>
                <span class="n">findings</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
                    <span class="sa">f</span><span class="s2">&quot;[MEDIUM] User &#39;</span><span class="si">{</span><span class="n">user</span><span class="p">[</span><span class="s1">&#39;UserName&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">&#39; has inactive &quot;</span>
                    <span class="sa">f</span><span class="s2">&quot;access key &#39;</span><span class="si">{</span><span class="n">key</span><span class="p">[</span><span class="s1">&#39;AccessKeyId&#39;</span><span class="p">][:</span><span class="mi">8</span><span class="p">]</span><span class="si">}</span><span class="s2">...&#39;. Delete it.&quot;</span>
                <span class="p">)</span>

    <span class="c1"># ── 확인 5: 사용하지 않는 사용자 ───────────────────────────────</span>
    <span class="k">for</span> <span class="n">user</span> <span class="ow">in</span> <span class="n">users</span><span class="p">:</span>
        <span class="n">last_used</span> <span class="o">=</span> <span class="n">user</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;PasswordLastUsed&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">last_used</span><span class="p">:</span>
            <span class="n">age</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">(</span><span class="n">timezone</span><span class="o">.</span><span class="n">utc</span><span class="p">)</span> <span class="o">-</span> <span class="n">last_used</span>
            <span class="k">if</span> <span class="n">age</span> <span class="o">&gt;</span> <span class="n">timedelta</span><span class="p">(</span><span class="n">days</span><span class="o">=</span><span class="mi">90</span><span class="p">):</span>
                <span class="n">findings</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
                    <span class="sa">f</span><span class="s2">&quot;[MEDIUM] User &#39;</span><span class="si">{</span><span class="n">user</span><span class="p">[</span><span class="s1">&#39;UserName&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">&#39; has not logged &quot;</span>
                    <span class="sa">f</span><span class="s2">&quot;in for </span><span class="si">{</span><span class="n">age</span><span class="o">.</span><span class="n">days</span><span class="si">}</span><span class="s2"> days. Consider disabling.&quot;</span>
                <span class="p">)</span>

    <span class="c1"># ── 확인 6: 지나치게 관대한 정책 ─────────────────────────────</span>
    <span class="k">for</span> <span class="n">user</span> <span class="ow">in</span> <span class="n">users</span><span class="p">:</span>
        <span class="n">attached</span> <span class="o">=</span> <span class="n">iam</span><span class="o">.</span><span class="n">list_attached_user_policies</span><span class="p">(</span>
            <span class="n">UserName</span><span class="o">=</span><span class="n">user</span><span class="p">[</span><span class="s1">&#39;UserName&#39;</span><span class="p">]</span>
        <span class="p">)[</span><span class="s1">&#39;AttachedPolicies&#39;</span><span class="p">]</span>
        <span class="k">for</span> <span class="n">policy</span> <span class="ow">in</span> <span class="n">attached</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">policy</span><span class="p">[</span><span class="s1">&#39;PolicyName&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;AdministratorAccess&#39;</span><span class="p">:</span>
                <span class="n">findings</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
                    <span class="sa">f</span><span class="s2">&quot;[HIGH] User &#39;</span><span class="si">{</span><span class="n">user</span><span class="p">[</span><span class="s1">&#39;UserName&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">&#39; has &quot;</span>
                    <span class="sa">f</span><span class="s2">&quot;AdministratorAccess attached directly. &quot;</span>
                    <span class="sa">f</span><span class="s2">&quot;Use groups and least-privilege policies.&quot;</span>
                <span class="p">)</span>

    <span class="k">return</span> <span class="n">findings</span>


<span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s2">&quot;__main__&quot;</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;AWS IAM Security Audit&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;=&quot;</span> <span class="o">*</span> <span class="mi">60</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">finding</span> <span class="ow">in</span> <span class="n">audit_iam_security</span><span class="p">():</span>
        <span class="nb">print</span><span class="p">(</span><span class="n">finding</span><span class="p">)</span>
</code></pre></div>

<hr />
<h2 id="8-infrastructure-as-code">8. Infrastructure as Code 보안<a class="header-link" href="#8-infrastructure-as-code" title="Permanent link">&para;</a></h2>
<h3 id="81-terraform">8.1 Terraform 보안<a class="header-link" href="#81-terraform" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><span class="c1"># ── 안전한 Terraform 구성 ──────────────────────────────────────</span>

<span class="c1"># Provider 구성 — 절대 자격 증명 하드코딩하지 말 것</span>
<span class="kr">provider</span><span class="w"> </span><span class="nv">&quot;aws&quot;</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="na">region</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">var.region</span>
<span class="c1">  # 환경 또는 IAM 역할에서 자격 증명</span>
<span class="c1">  # 절대 안 됨: access_key = &quot;AKIA...&quot;</span>
<span class="c1">  # 절대 안 됨: secret_key = &quot;wJal...&quot;</span>
<span class="p">}</span>

<span class="c1"># 암호화가 있는 원격 상태</span>
<span class="nb">terraform</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="kr">backend</span><span class="w"> </span><span class="nv">&quot;s3&quot;</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="na">bucket</span><span class="w">         </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;terraform-state-mycompany&quot;</span>
<span class="w">    </span><span class="na">key</span><span class="w">            </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;production/terraform.tfstate&quot;</span>
<span class="w">    </span><span class="na">region</span><span class="w">         </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;us-east-1&quot;</span>
<span class="w">    </span><span class="na">encrypt</span><span class="w">        </span><span class="o">=</span><span class="w"> </span><span class="no">true</span>
<span class="w">    </span><span class="na">dynamodb_table</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;terraform-locks&quot;</span>
<span class="c1">    # 상태에 secrets가 포함될 수 있음 — 항상 암호화</span>
<span class="w">  </span><span class="p">}</span>
<span class="p">}</span>

<span class="c1"># 보안 그룹 — 기본적으로 제한적</span>
<span class="kr">resource</span><span class="w"> </span><span class="nc">&quot;aws_security_group&quot;</span><span class="w"> </span><span class="nv">&quot;web&quot;</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="na">name_prefix</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;web-sg-&quot;</span>
<span class="w">  </span><span class="na">vpc_id</span><span class="w">      </span><span class="o">=</span><span class="w"> </span><span class="nv">var.vpc_id</span>

<span class="c1">  # 어디서나 HTTPS만 허용</span>
<span class="w">  </span><span class="nb">ingress</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="na">description</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;HTTPS from internet&quot;</span>
<span class="w">    </span><span class="na">from_port</span><span class="w">   </span><span class="o">=</span><span class="w"> </span><span class="m">443</span>
<span class="w">    </span><span class="na">to_port</span><span class="w">     </span><span class="o">=</span><span class="w"> </span><span class="m">443</span>
<span class="w">    </span><span class="na">protocol</span><span class="w">    </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;tcp&quot;</span>
<span class="w">    </span><span class="na">cidr_blocks</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">[</span><span class="s2">&quot;0.0.0.0/0&quot;</span><span class="p">]</span>
<span class="w">  </span><span class="p">}</span>

<span class="c1">  # 나쁨: 이것을 하지 마세요</span>
<span class="c1">  # ingress {</span>
<span class="c1">  #   from_port   = 0</span>
<span class="c1">  #   to_port     = 0</span>
<span class="c1">  #   protocol    = &quot;-1&quot;</span>
<span class="c1">  #   cidr_blocks = [&quot;0.0.0.0/0&quot;]</span>
<span class="c1">  # }</span>

<span class="c1">  # 이그레스도 제한</span>
<span class="w">  </span><span class="nb">egress</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="na">description</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;HTTPS outbound&quot;</span>
<span class="w">    </span><span class="na">from_port</span><span class="w">   </span><span class="o">=</span><span class="w"> </span><span class="m">443</span>
<span class="w">    </span><span class="na">to_port</span><span class="w">     </span><span class="o">=</span><span class="w"> </span><span class="m">443</span>
<span class="w">    </span><span class="na">protocol</span><span class="w">    </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;tcp&quot;</span>
<span class="w">    </span><span class="na">cidr_blocks</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">[</span><span class="s2">&quot;0.0.0.0/0&quot;</span><span class="p">]</span>
<span class="w">  </span><span class="p">}</span>

<span class="w">  </span><span class="nb">tags</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="na">Environment</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">var.environment</span>
<span class="w">    </span><span class="na">ManagedBy</span><span class="w">   </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;terraform&quot;</span>
<span class="w">  </span><span class="p">}</span>
<span class="p">}</span>

<span class="c1"># 보안 제어가 있는 S3 버킷</span>
<span class="kr">resource</span><span class="w"> </span><span class="nc">&quot;aws_s3_bucket&quot;</span><span class="w"> </span><span class="nv">&quot;data&quot;</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="na">bucket</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;mycompany-data-${var.environment}&quot;</span>
<span class="p">}</span>

<span class="kr">resource</span><span class="w"> </span><span class="nc">&quot;aws_s3_bucket_versioning&quot;</span><span class="w"> </span><span class="nv">&quot;data&quot;</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="na">bucket</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">aws_s3_bucket.data.id</span>
<span class="w">  </span><span class="nb">versioning_configuration</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="na">status</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;Enabled&quot;</span>
<span class="w">  </span><span class="p">}</span>
<span class="p">}</span>

<span class="kr">resource</span><span class="w"> </span><span class="nc">&quot;aws_s3_bucket_server_side_encryption_configuration&quot;</span><span class="w"> </span><span class="nv">&quot;data&quot;</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="na">bucket</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">aws_s3_bucket.data.id</span>
<span class="w">  </span><span class="nb">rule</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nb">apply_server_side_encryption_by_default</span><span class="w"> </span><span class="p">{</span>
<span class="w">      </span><span class="na">sse_algorithm</span><span class="w">     </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;aws:kms&quot;</span>
<span class="w">      </span><span class="na">kms_master_key_id</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">aws_kms_key.data.arn</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">    </span><span class="na">bucket_key_enabled</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="no">true</span>
<span class="w">  </span><span class="p">}</span>
<span class="p">}</span>

<span class="kr">resource</span><span class="w"> </span><span class="nc">&quot;aws_s3_bucket_public_access_block&quot;</span><span class="w"> </span><span class="nv">&quot;data&quot;</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="na">bucket</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">aws_s3_bucket.data.id</span>
<span class="w">  </span><span class="na">block_public_acls</span><span class="w">       </span><span class="o">=</span><span class="w"> </span><span class="no">true</span>
<span class="w">  </span><span class="na">block_public_policy</span><span class="w">     </span><span class="o">=</span><span class="w"> </span><span class="no">true</span>
<span class="w">  </span><span class="na">ignore_public_acls</span><span class="w">      </span><span class="o">=</span><span class="w"> </span><span class="no">true</span>
<span class="w">  </span><span class="na">restrict_public_buckets</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="no">true</span>
<span class="p">}</span>
</code></pre></div>

<h3 id="82-tfseccheckov-iac">8.2 tfsec/Checkov로 IaC 스캔<a class="header-link" href="#82-tfseccheckov-iac" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><span class="c1"># ── tfsec — Terraform 보안 스캐너 ──────────────────────────────</span>
brew<span class="w"> </span>install<span class="w"> </span>tfsec

<span class="c1"># Terraform 파일 스캔</span>
tfsec<span class="w"> </span>/path/to/terraform

<span class="c1"># 최소 심각도로 스캔</span>
tfsec<span class="w"> </span>--minimum-severity<span class="w"> </span>HIGH<span class="w"> </span>/path/to/terraform

<span class="c1"># CI를 위한 SARIF 출력 생성</span>
tfsec<span class="w"> </span>--format<span class="w"> </span>sarif<span class="w"> </span>--out<span class="w"> </span>results.sarif<span class="w"> </span>/path/to/terraform

<span class="c1"># ── Checkov — 다중 프레임워크 IaC 스캐너 ───────────────────────</span>
pip<span class="w"> </span>install<span class="w"> </span>checkov

<span class="c1"># Terraform 스캔</span>
checkov<span class="w"> </span>-d<span class="w"> </span>/path/to/terraform

<span class="c1"># Kubernetes 매니페스트 스캔</span>
checkov<span class="w"> </span>-d<span class="w"> </span>/path/to/k8s-manifests

<span class="c1"># Dockerfiles 스캔</span>
checkov<span class="w"> </span>--framework<span class="w"> </span>dockerfile<span class="w"> </span>-f<span class="w"> </span>Dockerfile

<span class="c1"># CloudFormation 스캔</span>
checkov<span class="w"> </span>-d<span class="w"> </span>/path/to/cfn-templates

<span class="c1"># 실패만 포함한 간결한 출력</span>
checkov<span class="w"> </span>-d<span class="w"> </span>/path/to/terraform<span class="w"> </span>--compact<span class="w"> </span>--quiet
</code></pre></div>

<div class="highlight"><pre><span></span><code><span class="c1"># ── CI/CD의 Checkov ────────────────────────────────────────────</span>
<span class="c1"># .github/workflows/iac-security.yml</span>
<span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">IaC Security</span>

<span class="nt">on</span><span class="p">:</span>
<span class="w">  </span><span class="nt">pull_request</span><span class="p">:</span>
<span class="w">    </span><span class="nt">paths</span><span class="p">:</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="s">&#39;terraform/**&#39;</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="s">&#39;k8s/**&#39;</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="s">&#39;Dockerfile*&#39;</span>

<span class="nt">jobs</span><span class="p">:</span>
<span class="w">  </span><span class="nt">checkov</span><span class="p">:</span>
<span class="w">    </span><span class="nt">runs-on</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">ubuntu-latest</span>
<span class="w">    </span><span class="nt">steps</span><span class="p">:</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">uses</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">actions/checkout@v4</span>

<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Run Checkov</span>
<span class="w">        </span><span class="nt">uses</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">bridgecrewio/checkov-action@v12</span>
<span class="w">        </span><span class="nt">with</span><span class="p">:</span>
<span class="w">          </span><span class="nt">directory</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">terraform/</span>
<span class="w">          </span><span class="nt">framework</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">terraform</span>
<span class="w">          </span><span class="nt">output_format</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">sarif</span>
<span class="w">          </span><span class="nt">output_file_path</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">results.sarif</span>
<span class="w">          </span><span class="nt">soft_fail</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">false</span><span class="w">  </span><span class="c1"># 문제 발생 시 빌드 실패</span>

<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Upload results</span>
<span class="w">        </span><span class="nt">uses</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">github/codeql-action/upload-sarif@v3</span>
<span class="w">        </span><span class="nt">if</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">always()</span>
<span class="w">        </span><span class="nt">with</span><span class="p">:</span>
<span class="w">          </span><span class="nt">sarif_file</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">results.sarif</span>
</code></pre></div>

<hr />
<h2 id="9">9. 런타임 보안 모니터링<a class="header-link" href="#9" title="Permanent link">&para;</a></h2>
<h3 id="91-falco">9.1 Falco (런타임 위협 감지)<a class="header-link" href="#91-falco" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><span class="c1"># ── 컨테이너 런타임 보안을 위한 Falco 규칙 ──────────────────────</span>
<span class="c1"># Falco는 시스템 콜을 모니터링하고 비정상 동작 감지</span>

<span class="c1"># 컨테이너에서 셸이 생성됨 감지</span>
<span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">rule</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Terminal shell in container</span>
<span class="w">  </span><span class="nt">desc</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">A shell was started inside a container</span>
<span class="w">  </span><span class="nt">condition</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">&gt;</span>
<span class="w">    </span><span class="no">spawned_process and container and</span>
<span class="w">    </span><span class="no">proc.name in (bash, sh, zsh, ksh, csh, dash) and</span>
<span class="w">    </span><span class="no">not proc.pname in (cron, crond, supervisord)</span>
<span class="w">  </span><span class="nt">output</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">&gt;</span>
<span class="w">    </span><span class="no">Shell spawned in container</span>
<span class="w">    </span><span class="no">(user=%user.name container=%container.name</span>
<span class="w">     </span><span class="no">shell=%proc.name parent=%proc.pname</span>
<span class="w">     </span><span class="no">cmdline=%proc.cmdline image=%container.image.repository)</span>
<span class="w">  </span><span class="nt">priority</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">WARNING</span>

<span class="c1"># 민감한 파일 액세스 감지</span>
<span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">rule</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Read sensitive file in container</span>
<span class="w">  </span><span class="nt">desc</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Sensitive file was read inside a container</span>
<span class="w">  </span><span class="nt">condition</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">&gt;</span>
<span class="w">    </span><span class="no">open_read and container and</span>
<span class="w">    </span><span class="no">fd.name in (/etc/shadow, /etc/passwd, /etc/sudoers) and</span>
<span class="w">    </span><span class="no">not proc.name in (sshd, login)</span>
<span class="w">  </span><span class="nt">output</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">&gt;</span>
<span class="w">    </span><span class="no">Sensitive file read in container</span>
<span class="w">    </span><span class="no">(user=%user.name file=%fd.name container=%container.name</span>
<span class="w">     </span><span class="no">image=%container.image.repository)</span>
<span class="w">  </span><span class="nt">priority</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">WARNING</span>

<span class="c1"># 예상치 못한 포트로의 아웃바운드 연결 감지</span>
<span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">rule</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Unexpected outbound connection</span>
<span class="w">  </span><span class="nt">desc</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Container making outbound connection on unexpected port</span>
<span class="w">  </span><span class="nt">condition</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">&gt;</span>
<span class="w">    </span><span class="no">outbound and container and</span>
<span class="w">    </span><span class="no">not fd.sport in (80, 443, 53, 8080, 8443) and</span>
<span class="w">    </span><span class="no">not proc.name in (curl, wget, python, node)</span>
<span class="w">  </span><span class="nt">output</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">&gt;</span>
<span class="w">    </span><span class="no">Unexpected outbound connection</span>
<span class="w">    </span><span class="no">(command=%proc.cmdline connection=%fd.name</span>
<span class="w">     </span><span class="no">container=%container.name image=%container.image.repository)</span>
<span class="w">  </span><span class="nt">priority</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">NOTICE</span>

<span class="c1"># 권한 상승 시도 감지</span>
<span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">rule</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Privilege escalation in container</span>
<span class="w">  </span><span class="nt">desc</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Detected privilege escalation inside a container</span>
<span class="w">  </span><span class="nt">condition</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">&gt;</span>
<span class="w">    </span><span class="no">spawned_process and container and</span>
<span class="w">    </span><span class="no">(proc.name in (sudo, su) or</span>
<span class="w">     </span><span class="no">proc.name = setuid or</span>
<span class="w">     </span><span class="no">proc.args contains &quot;--privileged&quot;)</span>
<span class="w">  </span><span class="nt">output</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">&gt;</span>
<span class="w">    </span><span class="no">Privilege escalation attempt in container</span>
<span class="w">    </span><span class="no">(user=%user.name command=%proc.cmdline</span>
<span class="w">     </span><span class="no">container=%container.name image=%container.image.repository)</span>
<span class="w">  </span><span class="nt">priority</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">CRITICAL</span>
</code></pre></div>

<div class="highlight"><pre><span></span><code><span class="c1"># ── Kubernetes에 Falco 설치 ─────────────────────────────────────</span>
helm<span class="w"> </span>repo<span class="w"> </span>add<span class="w"> </span>falcosecurity<span class="w"> </span>https://falcosecurity.github.io/charts
helm<span class="w"> </span>install<span class="w"> </span>falco<span class="w"> </span>falcosecurity/falco<span class="w"> </span><span class="se">\</span>
<span class="w">    </span>--namespace<span class="w"> </span>falco<span class="w"> </span>--create-namespace<span class="w"> </span><span class="se">\</span>
<span class="w">    </span>--set<span class="w"> </span><span class="nv">tty</span><span class="o">=</span><span class="nb">true</span><span class="w"> </span><span class="se">\</span>
<span class="w">    </span>--set<span class="w"> </span>falcosidekick.enabled<span class="o">=</span><span class="nb">true</span><span class="w"> </span><span class="se">\</span>
<span class="w">    </span>--set<span class="w"> </span>falcosidekick.config.slack.webhookurl<span class="o">=</span><span class="s2">&quot;https://hooks.slack.com/...&quot;</span>

<span class="c1"># ── Falco 알림 보기 ───────────────────────────────────────────────</span>
kubectl<span class="w"> </span>logs<span class="w"> </span>-l<span class="w"> </span>app.kubernetes.io/name<span class="o">=</span>falco<span class="w"> </span>-n<span class="w"> </span>falco<span class="w"> </span>-f
</code></pre></div>

<hr />
<h2 id="10">10. 공급망 보안<a class="header-link" href="#10" title="Permanent link">&para;</a></h2>
<h3 id="101-software-bill-of-materials-sbom">10.1 Software Bill of Materials (SBOM)<a class="header-link" href="#101-software-bill-of-materials-sbom" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code>┌─────────────────────────────────────────────────────────────────────┐
│                    소프트웨어 공급망                                  │
├─────────────────────────────────────────────────────────────────────┤
│                                                                      │
│  소스 코드 ──▶ 의존성 ──▶ 빌드 ──▶ 이미지 ──▶ 배포                  │
│       │               │            │          │          │           │
│       ▼               ▼            ▼          ▼          ▼           │
│  코드 리뷰       Lock 파일     Hermetic    Sign &amp;     Verify        │
│  SAST 스캔      의존성 감사     빌드        SBOM      서명          │
│  Secret 스캔    취약점 스캔    재현 가능    digest   서명된 것만   │
│                                            저장      승인          │
│                                                                      │
│  SBOM (Software Bill of Materials):                                 │
│  소프트웨어의 모든 구성 요소의 완전한 목록                             │
│  ├── 직접 의존성 (requirements.txt)                                 │
│  ├── 전이 의존성 (의존성의 의존성)                                   │
│  ├── OS 패키지 (베이스 이미지에서)                                   │
│  └── 각 구성 요소의 라이선스                                         │
│                                                                      │
│  형식:                                                                │
│  ├── SPDX (ISO 표준)                                                │
│  ├── CycloneDX (OWASP)                                             │
│  └── Syft (네이티브)                                                 │
│                                                                      │
└─────────────────────────────────────────────────────────────────────┘
</code></pre></div>

<div class="highlight"><pre><span></span><code><span class="c1"># ── Syft로 SBOM 생성 ─────────────────────────────────────────────</span>
<span class="c1"># 설치</span>
brew<span class="w"> </span>install<span class="w"> </span>syft

<span class="c1"># Docker 이미지에 대한 SBOM 생성</span>
syft<span class="w"> </span>myapp:latest<span class="w"> </span>-o<span class="w"> </span>spdx-json<span class="w"> </span>&gt;<span class="w"> </span>sbom.spdx.json
syft<span class="w"> </span>myapp:latest<span class="w"> </span>-o<span class="w"> </span>cyclonedx-json<span class="w"> </span>&gt;<span class="w"> </span>sbom.cdx.json

<span class="c1"># 디렉토리에 대한 SBOM 생성 (소스 코드)</span>
syft<span class="w"> </span>dir:/path/to/project<span class="w"> </span>-o<span class="w"> </span>spdx-json

<span class="c1"># ── Grype로 SBOM 취약점 스캔 ───────────────────────────────────</span>
brew<span class="w"> </span>install<span class="w"> </span>grype

<span class="c1"># SBOM에서 스캔</span>
grype<span class="w"> </span>sbom:sbom.spdx.json

<span class="c1"># 이미지 직접 스캔</span>
grype<span class="w"> </span>myapp:latest

<span class="c1"># high/critical에서 실패</span>
grype<span class="w"> </span>myapp:latest<span class="w"> </span>--fail-on<span class="w"> </span>high
</code></pre></div>

<h3 id="102-slsa-supply-chain-levels-for-software-artifacts">10.2 SLSA (Supply Chain Levels for Software Artifacts)<a class="header-link" href="#102-slsa-supply-chain-levels-for-software-artifacts" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code>┌─────────────────────────────────────────────────────────────────────┐
│                    SLSA 레벨                                         │
├─────────────────────────────────────────────────────────────────────┤
│                                                                      │
│  레벨 0: 보장 없음                                                    │
│  └── 누구나 무엇이든 빌드 가능, 출처 없음                              │
│                                                                      │
│  레벨 1: 빌드 프로세스 문서화                                          │
│  ├── 출처 존재 (누가, 어떻게 빌드했는지)                              │
│  └── 빌드 프로세스가 문서화됨                                          │
│                                                                      │
│  레벨 2: 빌드 서비스의 변조 저항                                       │
│  ├── 출처가 서명됨                                                     │
│  ├── 빌드 서비스가 출처를 자동으로 생성                                │
│  └── 빌드 서비스가 버전 관리됨                                         │
│                                                                      │
│  레벨 3: 특정 위협에 대한 추가 저항                                    │
│  ├── 출처가 위조 불가능                                                │
│  ├── 격리되고 일시적인 빌드 환경                                       │
│  └── 소스가 검증된 히스토리로 버전 관리됨                              │
│                                                                      │
│  대부분의 프로젝트는 최소 SLSA 레벨 2를 목표로 해야 합니다.             │
│                                                                      │
└─────────────────────────────────────────────────────────────────────┘
</code></pre></div>

<div class="highlight"><pre><span></span><code><span class="c1"># ── GitHub Actions SLSA 출처 생성기 ────────────────────────────</span>
<span class="c1"># .github/workflows/slsa-build.yml</span>
<span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">SLSA Build</span>

<span class="nt">on</span><span class="p">:</span>
<span class="w">  </span><span class="nt">push</span><span class="p">:</span>
<span class="w">    </span><span class="nt">tags</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">[</span><span class="s">&#39;v*&#39;</span><span class="p p-Indicator">]</span>

<span class="nt">jobs</span><span class="p">:</span>
<span class="w">  </span><span class="nt">build</span><span class="p">:</span>
<span class="w">    </span><span class="nt">runs-on</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">ubuntu-latest</span>
<span class="w">    </span><span class="nt">outputs</span><span class="p">:</span>
<span class="w">      </span><span class="nt">digest</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">${{ steps.build.outputs.digest }}</span>

<span class="w">    </span><span class="nt">steps</span><span class="p">:</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">uses</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">actions/checkout@v4</span>

<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Build image</span>
<span class="w">        </span><span class="nt">id</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">build</span>
<span class="w">        </span><span class="nt">run</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">|</span>
<span class="w">          </span><span class="no">docker build -t myapp:${{ github.ref_name }} .</span>
<span class="w">          </span><span class="no">DIGEST=$(docker inspect --format=&#39;{{index .RepoDigests 0}}&#39; myapp:${{ github.ref_name }} | cut -d@ -f2)</span>
<span class="w">          </span><span class="no">echo &quot;digest=$DIGEST&quot; &gt;&gt; &quot;$GITHUB_OUTPUT&quot;</span>

<span class="w">  </span><span class="nt">provenance</span><span class="p">:</span>
<span class="w">    </span><span class="nt">needs</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">build</span>
<span class="w">    </span><span class="nt">permissions</span><span class="p">:</span>
<span class="w">      </span><span class="nt">actions</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">read</span>
<span class="w">      </span><span class="nt">id-token</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">write</span>
<span class="w">      </span><span class="nt">packages</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">write</span>
<span class="w">    </span><span class="nt">uses</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">slsa-framework/slsa-github-generator/.github/workflows/generator_container_slsa3.yml@v2.0.0</span>
<span class="w">    </span><span class="nt">with</span><span class="p">:</span>
<span class="w">      </span><span class="nt">image</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">ghcr.io/${{ github.repository }}</span>
<span class="w">      </span><span class="nt">digest</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">${{ needs.build.outputs.digest }}</span>
</code></pre></div>

<hr />
<h2 id="11_1">11. 연습 문제<a class="header-link" href="#11_1" title="Permanent link">&para;</a></h2>
<h3 id="1-dockerfile">연습 문제 1: 안전한 Dockerfile 챌린지<a class="header-link" href="#1-dockerfile" title="Permanent link">&para;</a></h3>
<p>다음의 안전하지 않은 Dockerfile을 가져와 모든 보안 문제를 수정하세요:</p>
<div class="highlight"><pre><span></span><code><span class="k">FROM</span><span class="w"> </span><span class="s">ubuntu:latest</span>
<span class="k">RUN</span><span class="w"> </span>apt-get<span class="w"> </span>update<span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span>apt-get<span class="w"> </span>install<span class="w"> </span>-y<span class="w"> </span>python3<span class="w"> </span>python3-pip
<span class="k">COPY</span><span class="w"> </span>.<span class="w"> </span>/app
<span class="k">WORKDIR</span><span class="w"> </span><span class="s">/app</span>
<span class="k">RUN</span><span class="w"> </span>pip3<span class="w"> </span>install<span class="w"> </span>-r<span class="w"> </span>requirements.txt
<span class="k">ENV</span><span class="w"> </span><span class="nv">DATABASE_URL</span><span class="o">=</span>postgresql://admin:password123@db.prod.example.com/mydb
<span class="k">ENV</span><span class="w"> </span><span class="nv">API_SECRET</span><span class="o">=</span>sk_live_supersecret
<span class="k">EXPOSE</span><span class="w"> </span><span class="s">22 80 443 5432 8080</span>
<span class="k">CMD</span><span class="w"> </span>python3<span class="w"> </span>app.py
</code></pre></div>

<p>요구사항:
1. 최소 베이스 이미지 사용
2. 다단계 빌드
3. 비root 사용자
4. 이미지에 secrets 없음
5. 적절한 .dockerignore
6. 헬스 체크
7. 읽기 전용 파일시스템
8. 고정된 버전</p>
<h3 id="2-kubernetes">연습 문제 2: Kubernetes 보안 강화<a class="header-link" href="#2-kubernetes" title="Permanent link">&para;</a></h3>
<p>다음을 포함한 웹 애플리케이션을 위한 완전한 Kubernetes 매니페스트 작성:</p>
<ol>
<li>보안 강화된 pod 스펙이 있는 Deployment</li>
<li>적절한 타입의 Service</li>
<li>인그레스 컨트롤러로부터의 인그레스와 API 서비스 및 DNS로의 이그레스만 허용하는 NetworkPolicy</li>
<li>기본 토큰 마운팅 없는 ServiceAccount</li>
<li>"developer" 그룹을 위한 읽기 전용 액세스 Role 및 RoleBinding</li>
<li>네임스페이스에 Pod Security Standards 강제</li>
</ol>
<h3 id="3_1">연습 문제 3: 컨테이너 이미지 스캐너<a class="header-link" href="#3_1" title="Permanent link">&para;</a></h3>
<p>다음을 수행하는 Python 도구 구축:</p>
<ol>
<li>Docker 이미지 풀</li>
<li>Trivy 스캔 실행 (또는 Trivy JSON 출력 파싱)</li>
<li>critical/high 취약점 확인</li>
<li>이미지가 서명되었는지 검증 (cosign)</li>
<li>준수 보고서 생성 (통과/실패 및 이유)</li>
<li>CI/CD 게이트로 사용 가능 (실패 시 종료 코드 1)</li>
</ol>
<h3 id="4-iam">연습 문제 4: 클라우드 IAM 감사 도구<a class="header-link" href="#4-iam" title="Permanent link">&para;</a></h3>
<p>다음을 수행하는 AWS IAM 감사 도구 생성:</p>
<ol>
<li>모든 IAM 사용자와 첨부된 정책 목록</li>
<li>MFA 없는 사용자 식별</li>
<li>90일 이상 오래된 액세스 키 찾기</li>
<li>AdministratorAccess가 있는 사용자 감지</li>
<li>사용하지 않는 역할 식별 (90일간 가정되지 않음)</li>
<li>지나치게 관대한 S3 버킷 정책 확인</li>
<li>결과 및 개선 단계가 있는 CSV 보고서 생성</li>
</ol>
<h3 id="5-terraform">연습 문제 5: Terraform 보안 스캐너<a class="header-link" href="#5-terraform" title="Permanent link">&para;</a></h3>
<p>다음을 위한 Terraform 구성 스캔 도구 작성:</p>
<ol>
<li>민감한 포트(22, 3389, 5432)에서 0.0.0.0/0가 있는 보안 그룹</li>
<li>암호화 없는 S3 버킷</li>
<li>공개 액세스 차단 없는 S3 버킷</li>
<li>암호화 없는 RDS 인스턴스</li>
<li>필수 태그 없는 리소스 (Environment, Owner, ManagedBy)</li>
<li>.tf 파일의 하드코딩된 자격 증명</li>
<li>CI/CD 게이팅에 적합한 형식으로 결과 출력</li>
</ol>
<h3 id="6_1">연습 문제 6: 공급망 보안 파이프라인<a class="header-link" href="#6_1" title="Permanent link">&para;</a></h3>
<p>다음을 수행하는 CI/CD 파이프라인 설계 및 구현:</p>
<ol>
<li>취약점에 대한 소스 코드 스캔 (SAST)</li>
<li>알려진 CVE에 대한 의존성 스캔</li>
<li>다단계 Dockerfile로 컨테이너 이미지 빌드</li>
<li>Trivy로 빌드된 이미지 스캔</li>
<li>cosign으로 이미지 서명</li>
<li>SBOM 생성 (SPDX 형식)</li>
<li>이미지에 SBOM 첨부</li>
<li>모든 확인이 통과할 때만 배포</li>
</ol>
<hr />
<h2 id="_3">요약<a class="header-link" href="#_3" title="Permanent link">&para;</a></h2>
<h3 id="_4">컨테이너 보안 체크리스트<a class="header-link" href="#_4" title="Permanent link">&para;</a></h3>
<table>
<thead>
<tr>
<th>카테고리</th>
<th>제어</th>
<th>우선순위</th>
</tr>
</thead>
<tbody>
<tr>
<td>이미지</td>
<td>최소 베이스 이미지 사용 (distroless/Alpine)</td>
<td>Critical</td>
</tr>
<tr>
<td>이미지</td>
<td>취약점 스캔 (Trivy/Snyk)</td>
<td>Critical</td>
</tr>
<tr>
<td>이미지</td>
<td>이미지에 secrets 없음</td>
<td>Critical</td>
</tr>
<tr>
<td>이미지</td>
<td>베이스 이미지 digest 고정</td>
<td>High</td>
</tr>
<tr>
<td>이미지</td>
<td>이미지 서명 (cosign)</td>
<td>High</td>
</tr>
<tr>
<td>Dockerfile</td>
<td>비root로 실행</td>
<td>Critical</td>
</tr>
<tr>
<td>Dockerfile</td>
<td>다단계 빌드</td>
<td>High</td>
</tr>
<tr>
<td>Dockerfile</td>
<td>모든 권한 삭제</td>
<td>High</td>
</tr>
<tr>
<td>Dockerfile</td>
<td>읽기 전용 파일시스템</td>
<td>Medium</td>
</tr>
<tr>
<td>Kubernetes</td>
<td>최소 권한 RBAC</td>
<td>Critical</td>
</tr>
<tr>
<td>Kubernetes</td>
<td>Network Policies</td>
<td>Critical</td>
</tr>
<tr>
<td>Kubernetes</td>
<td>Pod Security Standards</td>
<td>High</td>
</tr>
<tr>
<td>Kubernetes</td>
<td>기본 서비스 계정 토큰 없음</td>
<td>High</td>
</tr>
<tr>
<td>클라우드</td>
<td>최소 권한 IAM</td>
<td>Critical</td>
</tr>
<tr>
<td>클라우드</td>
<td>장기 자격 증명 없음</td>
<td>High</td>
</tr>
<tr>
<td>클라우드</td>
<td>모든 계정에 MFA</td>
<td>Critical</td>
</tr>
<tr>
<td>클라우드</td>
<td>상태 파일 암호화</td>
<td>High</td>
</tr>
<tr>
<td>공급망</td>
<td>SBOM 생성</td>
<td>High</td>
</tr>
<tr>
<td>공급망</td>
<td>의존성 스캐닝</td>
<td>High</td>
</tr>
<tr>
<td>런타임</td>
<td>Falco/Tetragon으로 모니터링</td>
<td>Medium</td>
</tr>
</tbody>
</table>
<h3 id="_5">핵심 요점<a class="header-link" href="#_5" title="Permanent link">&para;</a></h3>
<ol>
<li><strong>최소 이미지가 공격 표면 감소</strong> — 모든 패키지는 잠재적 취약점; 가능하면 distroless 또는 scratch 사용</li>
<li><strong>절대 root로 실행하지 말 것</strong> — 모든 Dockerfile에서 전용 사용자 생성</li>
<li><strong>서명 및 검증</strong> — cosign을 사용하여 이미지를 서명하고 배포 전 검증</li>
<li><strong>네트워크 격리가 중요</strong> — 기본 거부 NetworkPolicies는 측면 이동 방지</li>
<li><strong>왼쪽으로 이동</strong> — 프로덕션뿐만 아니라 CI/CD에서 이미지, IaC, 의존성 스캔</li>
<li><strong>클라우드 IAM이 새로운 경계</strong> — 방화벽 규칙과 동일한 엄격함으로 IAM 정책 다루기</li>
<li><strong>모든 것 자동화</strong> — 수동 보안 검사는 확장되지 않음; 파이프라인에 통합</li>
</ol>
<hr />
<p><strong>이전</strong>: <a href="./11_Secrets_Management.md">11_Secrets_Management.md</a> | <strong>다음</strong>: <a href="./13_Security_Testing.md">13. Security Testing</a></p>
    </div>

    
<div class="lesson-toolbar lesson-toolbar--bottom">
    <div class="toolbar-nav toolbar-nav--prev">
        
        <a href="/study/ko/Security/11_Secrets_Management.html" class="nav-prev">
            <span class="nav-label">Previous</span>
            <span class="nav-title">Secrets Management와 환경 설정</span>
        </a>
        
    </div>
    <div class="toolbar-actions">
        <button class="btn btn-copy-link" data-action="copy-link" title="Copy link">
            <span class="icon">🔗</span>
            <span class="text">Copy link</span>
        </button>
        <a href="/study/ko/Security/" class="btn btn-topic-link" title="Back to topic list">
            <span class="icon">📋</span>
            <span class="text">Topic list</span>
        </a>
    </div>
    <div class="toolbar-nav toolbar-nav--next">
        
        <a href="/study/ko/Security/13_Security_Testing.html" class="nav-next">
            <span class="nav-label">Next</span>
            <span class="nav-title">보안 테스팅</span>
        </a>
        
    </div>
</div>


    <div class="toolbar-keyboard-hint">
        <kbd>&larr;</kbd> <kbd>&rarr;</kbd> to navigate between lessons
    </div>
</article>

<!-- Scroll to top floating button -->
<button class="scroll-to-top" id="scroll-to-top" title="Scroll to top" aria-label="Scroll to top">↑</button>

            </div>
        </main>
    </div>

    <script src="/study/static/js/app.js"></script>
    <script>
        function switchLanguage(newLang) {
            const path = window.location.pathname;
            const base = '/study';
            const currentLang = 'ko';
            const newPath = path.replace(base + '/' + currentLang + '/', base + '/' + newLang + '/');
            window.location.href = newPath + window.location.search;
        }
    </script>
    
<script>
    document.addEventListener('DOMContentLoaded', function() {
        // Copy link - independent feedback per button
        document.querySelectorAll('[data-action="copy-link"]').forEach(function(btn) {
            btn.addEventListener('click', function() {
                navigator.clipboard.writeText(window.location.href);
                var textEl = this.querySelector('.text');
                var originalText = textEl.textContent;
                textEl.textContent = 'Copied!';
                setTimeout(function() { textEl.textContent = originalText; }, 2000);
            });
        });

        // Add copy buttons to code blocks
        document.querySelectorAll('.lesson-content pre').forEach(function(pre) {
            var copyBtn = document.createElement('button');
            copyBtn.className = 'code-copy-btn';
            copyBtn.textContent = 'Copy';
            copyBtn.addEventListener('click', function() {
                var code = pre.querySelector('code');
                var text = code ? code.textContent : pre.textContent;
                navigator.clipboard.writeText(text);
                copyBtn.textContent = 'Copied!';
                setTimeout(function() { copyBtn.textContent = 'Copy'; }, 2000);
            });
            pre.style.position = 'relative';
            pre.appendChild(copyBtn);
        });

        // Scroll to top button
        var scrollBtn = document.getElementById('scroll-to-top');
        window.addEventListener('scroll', function() {
            scrollBtn.classList.toggle('visible', window.scrollY > 300);
        });
        scrollBtn.addEventListener('click', function() {
            window.scrollTo({ top: 0, behavior: 'smooth' });
        });

        // Keyboard shortcuts: left/right arrows for lesson navigation
        document.addEventListener('keydown', function(e) {
            var tag = document.activeElement.tagName;
            if (tag === 'INPUT' || tag === 'TEXTAREA' || tag === 'SELECT') return;

            if (e.key === 'ArrowLeft') {
                var prevLink = document.querySelector('.nav-prev');
                if (prevLink) prevLink.click();
            } else if (e.key === 'ArrowRight') {
                var nextLink = document.querySelector('.nav-next');
                if (nextLink) nextLink.click();
            }
        });
    });
</script>

</body>
</html>
{% endraw %}