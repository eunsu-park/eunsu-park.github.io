{% raw %}
<!DOCTYPE html>
<html lang="ko" data-theme="light">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>사고 대응 및 포렌식 - Study Materials</title>
    <link rel="stylesheet" href="/study/static/css/style.css">
    <link rel="stylesheet" href="/study/static/css/highlight.css">
    <!-- KaTeX for LaTeX math rendering -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.16.11/dist/katex.min.css">
    <script defer src="https://cdn.jsdelivr.net/npm/katex@0.16.11/dist/katex.min.js"></script>
    <script defer src="https://cdn.jsdelivr.net/npm/katex@0.16.11/dist/contrib/auto-render.min.js"
        onload="renderMathInElement(document.body, {
            delimiters: [
                {left: '$$', right: '$$', display: true},
                {left: '$', right: '$', display: false}
            ],
            throwOnError: false
        });"></script>
    
</head>
<body>
    <div class="app-container">
        <!-- Sidebar -->
        <aside class="sidebar" id="sidebar">
            <div class="sidebar-header">
                <a href="/study/ko/" class="logo">Study Materials</a>
                <button class="sidebar-toggle" id="sidebar-toggle" aria-label="Toggle sidebar">
                    <span></span>
                </button>
            </div>

            <nav class="sidebar-nav">
                <a href="/study/ko/" class="nav-item ">
                    <span class="nav-icon">🏠</span>
                    <span class="nav-text">Home</span>
                </a>
                <a href="/study/examples/" class="nav-item ">
                    <span class="nav-icon">💻</span>
                    <span class="nav-text">Examples</span>
                </a>
            </nav>

            <div class="sidebar-search">
                <form action="/study/ko/search.html" method="get" id="search-form">
                    <input type="search" name="q" placeholder="Search..." id="search-sidebar-input">
                </form>
            </div>

            <!-- Language Selector -->
            <div class="sidebar-lang">
                <select id="lang-select" class="lang-selector" onchange="switchLanguage(this.value)">
                    
                    <option value="en" >
                        English
                    </option>
                    
                    <option value="ko" selected>
                        한국어
                    </option>
                    
                </select>
            </div>

            <div class="sidebar-footer">
                <button class="theme-toggle" id="theme-toggle" aria-label="Toggle theme">
                    <span class="theme-icon light">☀️</span>
                    <span class="theme-icon dark">🌙</span>
                </button>
            </div>
        </aside>

        <!-- Main Content -->
        <main class="main-content">
            <header class="main-header">
                <button class="menu-toggle" id="menu-toggle" aria-label="Open menu">
                    <span></span>
                </button>
                
<nav class="breadcrumb">
    <a href="/study/ko/">Topics</a>
    <span class="separator">/</span>
    <a href="/study/ko/Security/">Security</a>
    <span class="separator">/</span>
    <span class="current">사고 대응 및 포렌식</span>
</nav>

            </header>

            <div class="content">
                
<article class="lesson-article">
    <header class="lesson-header">
        <h1>사고 대응 및 포렌식</h1>
    </header>

    
<div class="lesson-toolbar lesson-toolbar--top">
    <div class="toolbar-nav toolbar-nav--prev">
        
        <a href="/study/ko/Security/13_Security_Testing.html" class="nav-prev">
            <span class="nav-label">Previous</span>
            <span class="nav-title">보안 테스팅</span>
        </a>
        
    </div>
    <div class="toolbar-actions">
        <button class="btn btn-copy-link" data-action="copy-link" title="Copy link">
            <span class="icon">🔗</span>
            <span class="text">Copy link</span>
        </button>
        <a href="/study/ko/Security/" class="btn btn-topic-link" title="Back to topic list">
            <span class="icon">📋</span>
            <span class="text">Topic list</span>
        </a>
    </div>
    <div class="toolbar-nav toolbar-nav--next">
        
        <a href="/study/ko/Security/15_Project_Secure_API.html" class="nav-next">
            <span class="nav-label">Next</span>
            <span class="nav-title">프로젝트: 안전한 REST API 구축</span>
        </a>
        
    </div>
</div>


    
    <nav class="toc" id="toc">
        <h2>Table of Contents</h2>
        <div class="toc">
<ul>
<li><a href="#_2">학습 목표</a></li>
<li><a href="#1">1. 사고 대응 개요</a><ul>
<li><a href="#11">1.1 보안 사고란 무엇인가?</a></li>
<li><a href="#12">1.2 일반적인 사고 유형</a></li>
</ul>
</li>
<li><a href="#2-nist">2. NIST 사고 대응 생명주기</a><ul>
<li><a href="#21-4">2.1 4단계</a></li>
<li><a href="#22-1">2.2 1단계: 준비</a><ul>
<li><a href="#ir">IR 팀 역할</a></li>
</ul>
</li>
<li><a href="#23-2">2.3 2단계: 탐지 및 분석</a><ul>
<li><a href="#_3">탐지 소스</a></li>
<li><a href="#_4">초기 분석 질문</a></li>
</ul>
</li>
<li><a href="#24-3">2.4 3단계: 격리, 제거 및 복구</a></li>
<li><a href="#25-4">2.5 4단계: 사고 후 활동 (교훈 학습)</a></li>
</ul>
</li>
<li><a href="#3-siem">3. 로그 분석 및 SIEM 개념</a><ul>
<li><a href="#31">3.1 로깅 아키텍처</a></li>
<li><a href="#32">3.2 중요한 로그 소스</a></li>
<li><a href="#33-siem">3.3 SIEM 상관 규칙</a></li>
</ul>
</li>
<li><a href="#4-python">4. Python: 로그 파싱 및 분석</a><ul>
<li><a href="#41">4.1 웹 서버 로그 파서</a></li>
<li><a href="#42-ioc">4.2 IOC 탐지 스크립트</a></li>
</ul>
</li>
<li><a href="#5">5. 디지털 포렌식 기초</a><ul>
<li><a href="#51">5.1 포렌식 원칙</a></li>
<li><a href="#52">5.2 휘발성 순서</a></li>
<li><a href="#53">5.3 보관 연속성</a></li>
<li><a href="#54">5.4 포렌식 디스크 이미징</a></li>
</ul>
</li>
<li><a href="#6">6. 메모리 포렌식 개념</a><ul>
<li><a href="#61">6.1 메모리 포렌식이 필요한 이유</a></li>
<li><a href="#62">6.2 메모리 수집</a></li>
<li><a href="#63-volatility">6.3 Volatility 프레임워크 (개요)</a></li>
</ul>
</li>
<li><a href="#7">7. 네트워크 포렌식</a><ul>
<li><a href="#71">7.1 패킷 캡처 분석</a></li>
<li><a href="#72">7.2 유용한 커맨드라인 도구</a></li>
</ul>
</li>
<li><a href="#8">8. 사고 대응 플레이북</a><ul>
<li><a href="#81">8.1 플레이북 템플릿</a></li>
<li><a href="#82">8.2 플레이북: 랜섬웨어 사고</a></li>
<li><a href="#83">8.3 플레이북: 자격 증명 침해</a></li>
</ul>
</li>
<li><a href="#9">9. 사고 후 검토 템플릿</a></li>
<li><a href="#10">10. 연습 문제</a><ul>
<li><a href="#1_1">연습 문제 1: 로그 분석</a></li>
<li><a href="#2-ioc">연습 문제 2: IOC 데이터베이스</a></li>
<li><a href="#3">연습 문제 3: 사고 대응 플레이북</a></li>
<li><a href="#4">연습 문제 4: 메모리 포렌식 분석</a></li>
<li><a href="#5_1">연습 문제 5: 사고 후 보고서</a></li>
<li><a href="#6-pcap">연습 문제 6: PCAP 분석</a></li>
</ul>
</li>
<li><a href="#_5">요약</a></li>
</ul>
</div>

    </nav>
    

    <div class="lesson-content markdown-body">
        <h1 id="_1">사고 대응 및 포렌식<a class="header-link" href="#_1" title="Permanent link">&para;</a></h1>
<hr />
<p>보안 사고는 불가피합니다. 회복력 있는 조직과 취약한 조직을 구분하는 것은 침해를 당하느냐 여부가 아니라, 얼마나 효과적으로 대응하느냐입니다. 이 레슨은 NIST 프레임워크를 기반으로 한 완전한 사고 대응 생명주기, 디지털 포렌식 기초, 로그 분석 기법, 침해 지표(IOC) 탐지를 위한 실용적인 Python 스크립트를 다룹니다. 이 레슨을 마치면 사고 대응 플레이북을 작성하고 보안 이벤트를 체계적으로 분석할 수 있습니다.</p>
<h2 id="_2">학습 목표<a class="header-link" href="#_2" title="Permanent link">&para;</a></h2>
<ul>
<li>NIST 사고 대응 생명주기 단계 이해</li>
<li>사고 대응 계획 수립 및 유지</li>
<li>침해 지표를 찾기 위한 로그 분석</li>
<li>디지털 포렌식 기초 및 증거 보관 연속성 이해</li>
<li>로그 파싱 및 IOC 탐지를 위한 Python 스크립트 작성</li>
<li>일반적인 시나리오에 대한 사고 대응 플레이북 작성</li>
<li>효과적인 사고 후 검토 수행</li>
</ul>
<hr />
<h2 id="1">1. 사고 대응 개요<a class="header-link" href="#1" title="Permanent link">&para;</a></h2>
<h3 id="11">1.1 보안 사고란 무엇인가?<a class="header-link" href="#11" title="Permanent link">&para;</a></h3>
<p>보안 사고는 정보나 시스템의 기밀성, 무결성, 가용성을 손상시키는 모든 이벤트입니다. 모든 보안 이벤트가 사고인 것은 아니며, 트리아지를 통해 심각도를 판단합니다.</p>
<div class="highlight"><pre><span></span><code>┌─────────────────────────────────────────────────────────────────┐
│              보안 이벤트 → 사고 분류                             │
├─────────────────────────────────────────────────────────────────┤
│                                                                  │
│  보안 이벤트 (수백만 건/일)                                      │
│  ├── 방화벽 차단                                                 │
│  ├── 로그인 실패 시도                                            │
│  ├── 포트 스캔                                                   │
│  ├── 악성코드 탐지 (격리됨)                                      │
│  └── IDS/IPS 경고                                                │
│       │                                                          │
│       ▼  트리아지 및 상관 분석                                   │
│                                                                  │
│  보안 사고 (몇 건/월)                                            │
│  ├── 성공적인 무단 접근                                          │
│  ├── 데이터 침해 / 유출                                          │
│  ├── 악성코드 감염 (활성)                                        │
│  ├── 서비스 거부 공격                                            │
│  ├── 내부자 위협 활동                                            │
│  └── 랜섬웨어 배포                                               │
│       │                                                          │
│       ▼  심각도 분류                                             │
│                                                                  │
│  ┌───────────┬──────────────────────────────────────────────┐   │
│  │ 심각도    │ 설명                                         │   │
│  ├───────────┼──────────────────────────────────────────────┤   │
│  │ Critical  │ 활성 데이터 침해, 랜섬웨어, 시스템 전체      │   │
│  │ (P1)      │ 침해. 즉시 대응 필요.                        │   │
│  ├───────────┼──────────────────────────────────────────────┤   │
│  │ High      │ 확인된 침입, 단일 시스템 침해,               │   │
│  │ (P2)      │ 활성 악성코드. 몇 시간 내.                   │   │
│  ├───────────┼──────────────────────────────────────────────┤   │
│  │ Medium    │ 의심스러운 활동, 정책 위반,                  │   │
│  │ (P3)      │ 취약점 적극 악용. 며칠 내.                   │   │
│  ├───────────┼──────────────────────────────────────────────┤   │
│  │ Low       │ 사소한 정책 위반, 실패한 공격 시도,          │   │
│  │ (P4)      │ 정보성. 몇 주 내.                            │   │
│  └───────────┴──────────────────────────────────────────────┘   │
│                                                                  │
└─────────────────────────────────────────────────────────────────┘
</code></pre></div>

<h3 id="12">1.2 일반적인 사고 유형<a class="header-link" href="#12" title="Permanent link">&para;</a></h3>
<table>
<thead>
<tr>
<th>사고 유형</th>
<th>예시</th>
<th>일반적인 지표</th>
</tr>
</thead>
<tbody>
<tr>
<td><strong>악성코드</strong></td>
<td>랜섬웨어, 트로이목마, 웜</td>
<td>비정상적인 프로세스, 파일 암호화, C2 트래픽</td>
</tr>
<tr>
<td><strong>무단 접근</strong></td>
<td>자격 증명 침해, 무차별 대입</td>
<td>로그인 실패, 비정상 시간 접근, 비정상 지리적 위치</td>
</tr>
<tr>
<td><strong>데이터 침해</strong></td>
<td>유출, 우발적 노출</td>
<td>대량 데이터 전송, DB 덤프, 비정상 쿼리</td>
</tr>
<tr>
<td><strong>DoS/DDoS</strong></td>
<td>볼륨형, 애플리케이션 레이어</td>
<td>트래픽 급증, 서비스 저하, CPU 소진</td>
</tr>
<tr>
<td><strong>내부자 위협</strong></td>
<td>데이터 절도, 사보타주</td>
<td>과도한 접근, 대용량 다운로드, 정책 위반</td>
</tr>
<tr>
<td><strong>웹 애플리케이션</strong></td>
<td>SQLi, XSS, RCE</td>
<td>의심스러운 요청 패턴, WAF 경고, 오류 급증</td>
</tr>
<tr>
<td><strong>공급망</strong></td>
<td>침해된 종속성, 업데이트</td>
<td>예상치 못한 패키지 변경, 의심스러운 빌드 아티팩트</td>
</tr>
<tr>
<td><strong>피싱</strong></td>
<td>자격 증명 수집, BEC</td>
<td>신고된 이메일, 비정상 로그인 위치, 송금 요청</td>
</tr>
</tbody>
</table>
<hr />
<h2 id="2-nist">2. NIST 사고 대응 생명주기<a class="header-link" href="#2-nist" title="Permanent link">&para;</a></h2>
<h3 id="21-4">2.1 4단계<a class="header-link" href="#21-4" title="Permanent link">&para;</a></h3>
<p>NIST 컴퓨터 보안 사고 처리 가이드(SP 800-61)는 4가지 주요 단계를 정의합니다. 실제로 이러한 단계는 중첩되고 순환합니다.</p>
<div class="highlight"><pre><span></span><code>┌─────────────────────────────────────────────────────────────────┐
│              NIST 사고 대응 생명주기                             │
│              (SP 800-61 Rev. 2)                                  │
├─────────────────────────────────────────────────────────────────┤
│                                                                  │
│   ┌─────────────────┐                                           │
│   │  1. 준비         │◄──────────────────────────────┐          │
│   │                  │                               │          │
│   │  - IR 계획       │                               │          │
│   │  - 팀 교육       │                               │          │
│   │  - 도구 준비     │                               │          │
│   │  - 커뮤니케이션  │                               │          │
│   └────────┬─────────┘                               │          │
│            │                                          │          │
│            ▼                                          │          │
│   ┌─────────────────────────┐                        │          │
│   │  2. 탐지 및              │                        │          │
│   │     분석                 │                        │          │
│   │                          │                        │          │
│   │  - 경고 모니터링         │                        │          │
│   │  - 이벤트 트리아지       │                        │          │
│   │  - 범위 결정             │                        │          │
│   │  - 심각도 분류           │                        │          │
│   └────────┬────────────────┘                        │          │
│            │                                          │          │
│            ▼                                          │          │
│   ┌─────────────────────────┐                        │          │
│   │  3. 격리,                │    ◄── 이 하위 단계들 │          │
│   │     제거 및              │        간에 순환 가능  │          │
│   │     복구                 │                        │          │
│   │                          │                        │          │
│   │  - 영향받은 시스템 격리  │                        │          │
│   │  - 위협 제거             │                        │          │
│   │  - 시스템 복구           │                        │          │
│   │  - 복구 검증             │                        │          │
│   └────────┬────────────────┘                        │          │
│            │                                          │          │
│            ▼                                          │          │
│   ┌─────────────────────────┐                        │          │
│   │  4. 사고 후              │────────────────────────┘          │
│   │     활동                 │    교훈이 준비 단계로             │
│   │                          │    피드백됨                       │
│   │  - 교훈 학습             │                                    │
│   │  - 보고서 작성           │                                    │
│   │  - 프로세스 개선         │                                    │
│   └─────────────────────────┘                                    │
│                                                                  │
└─────────────────────────────────────────────────────────────────┘
</code></pre></div>

<h3 id="22-1">2.2 1단계: 준비<a class="header-link" href="#22-1" title="Permanent link">&para;</a></h3>
<p>준비는 가장 중요한 단계입니다. 이것이 없으면 나머지는 모두 압박 속에서의 즉흥적인 대응이 됩니다.</p>
<div class="highlight"><pre><span></span><code><span class="err">┌──────────────────────────────────────────────────────────────────┐</span>
<span class="err">│</span><span class="w">                    </span><span class="n">준비</span><span class="w"> </span><span class="n">체크리스트</span><span class="w">                                 </span><span class="err">│</span>
<span class="err">├──────────────────────────────────────────────────────────────────┤</span>
<span class="err">│</span><span class="w">                                                                   </span><span class="err">│</span>
<span class="err">│</span><span class="w">  </span><span class="nl">인력</span><span class="p">:</span><span class="w">                                                            </span><span class="err">│</span>
<span class="err">│</span><span class="w">  </span><span class="o">[</span><span class="n">x</span><span class="o">]</span><span class="w"> </span><span class="n">명확한</span><span class="w"> </span><span class="n">역할을</span><span class="w"> </span><span class="n">가진</span><span class="w"> </span><span class="n">IR</span><span class="w"> </span><span class="n">팀</span><span class="w"> </span><span class="n">식별</span><span class="w">                               </span><span class="err">│</span>
<span class="err">│</span><span class="w">  </span><span class="o">[</span><span class="n">x</span><span class="o">]</span><span class="w"> </span><span class="n">연락처</span><span class="w"> </span><span class="n">목록</span><span class="w"> </span><span class="p">(</span><span class="n">팀</span><span class="p">,</span><span class="w"> </span><span class="n">경영진</span><span class="p">,</span><span class="w"> </span><span class="n">법무</span><span class="p">,</span><span class="w"> </span><span class="n">PR</span><span class="p">,</span><span class="w"> </span><span class="n">벤더</span><span class="p">)</span><span class="w">                    </span><span class="err">│</span>
<span class="err">│</span><span class="w">  </span><span class="o">[</span><span class="n">x</span><span class="o">]</span><span class="w"> </span><span class="n">당직</span><span class="w"> </span><span class="n">근무</span><span class="w"> </span><span class="n">일정</span><span class="w">                                               </span><span class="err">│</span>
<span class="err">│</span><span class="w">  </span><span class="o">[</span><span class="n">x</span><span class="o">]</span><span class="w"> </span><span class="n">정기적인</span><span class="w"> </span><span class="n">교육</span><span class="w"> </span><span class="n">및</span><span class="w"> </span><span class="n">탁상</span><span class="w"> </span><span class="n">연습</span><span class="w">                                   </span><span class="err">│</span>
<span class="err">│</span><span class="w">  </span><span class="o">[</span><span class="n">x</span><span class="o">]</span><span class="w"> </span><span class="n">외부</span><span class="w"> </span><span class="n">IR</span><span class="w"> </span><span class="n">리테이너</span><span class="w"> </span><span class="p">(</span><span class="n">선택사항</span><span class="p">)</span><span class="w">                                  </span><span class="err">│</span>
<span class="err">│</span><span class="w">                                                                   </span><span class="err">│</span>
<span class="err">│</span><span class="w">  </span><span class="nl">프로세스</span><span class="p">:</span><span class="w">                                                        </span><span class="err">│</span>
<span class="err">│</span><span class="w">  </span><span class="o">[</span><span class="n">x</span><span class="o">]</span><span class="w"> </span><span class="n">경영진이</span><span class="w"> </span><span class="n">승인한</span><span class="w"> </span><span class="n">서면</span><span class="w"> </span><span class="n">IR</span><span class="w"> </span><span class="n">계획</span><span class="w">                                </span><span class="err">│</span>
<span class="err">│</span><span class="w">  </span><span class="o">[</span><span class="n">x</span><span class="o">]</span><span class="w"> </span><span class="n">일반적인</span><span class="w"> </span><span class="n">사고</span><span class="w"> </span><span class="n">유형에</span><span class="w"> </span><span class="n">대한</span><span class="w"> </span><span class="n">플레이북</span><span class="w">                          </span><span class="err">│</span>
<span class="err">│</span><span class="w">  </span><span class="o">[</span><span class="n">x</span><span class="o">]</span><span class="w"> </span><span class="n">에스컬레이션</span><span class="w"> </span><span class="n">절차</span><span class="w">                                            </span><span class="err">│</span>
<span class="err">│</span><span class="w">  </span><span class="o">[</span><span class="n">x</span><span class="o">]</span><span class="w"> </span><span class="n">커뮤니케이션</span><span class="w"> </span><span class="n">템플릿</span><span class="w"> </span><span class="p">(</span><span class="n">내부</span><span class="p">,</span><span class="w"> </span><span class="n">외부</span><span class="p">,</span><span class="w"> </span><span class="n">법무</span><span class="p">)</span><span class="w">                      </span><span class="err">│</span>
<span class="err">│</span><span class="w">  </span><span class="o">[</span><span class="n">x</span><span class="o">]</span><span class="w"> </span><span class="n">증거</span><span class="w"> </span><span class="n">처리</span><span class="w"> </span><span class="n">절차</span><span class="w">                                               </span><span class="err">│</span>
<span class="err">│</span><span class="w">  </span><span class="o">[</span><span class="n">x</span><span class="o">]</span><span class="w"> </span><span class="n">규제</span><span class="w"> </span><span class="n">알림</span><span class="w"> </span><span class="n">요구사항</span><span class="w"> </span><span class="n">문서화</span><span class="w">                                    </span><span class="err">│</span>
<span class="err">│</span><span class="w">                                                                   </span><span class="err">│</span>
<span class="err">│</span><span class="w">  </span><span class="nl">기술</span><span class="p">:</span><span class="w">                                                            </span><span class="err">│</span>
<span class="err">│</span><span class="w">  </span><span class="o">[</span><span class="n">x</span><span class="o">]</span><span class="w"> </span><span class="n">로깅</span><span class="w"> </span><span class="n">인프라</span><span class="w"> </span><span class="p">(</span><span class="n">중앙화됨</span><span class="p">,</span><span class="w"> </span><span class="n">보관됨</span><span class="p">)</span><span class="w">                              </span><span class="err">│</span>
<span class="err">│</span><span class="w">  </span><span class="o">[</span><span class="n">x</span><span class="o">]</span><span class="w"> </span><span class="n">SIEM</span><span class="w"> </span><span class="n">또는</span><span class="w"> </span><span class="n">로그</span><span class="w"> </span><span class="n">분석</span><span class="w"> </span><span class="n">도구</span><span class="w">                                    </span><span class="err">│</span>
<span class="err">│</span><span class="w">  </span><span class="o">[</span><span class="n">x</span><span class="o">]</span><span class="w"> </span><span class="n">포렌식</span><span class="w"> </span><span class="n">워크스테이션</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="n">툴킷</span><span class="w">                                  </span><span class="err">│</span>
<span class="err">│</span><span class="w">  </span><span class="o">[</span><span class="n">x</span><span class="o">]</span><span class="w"> </span><span class="n">네트워크</span><span class="w"> </span><span class="n">모니터링</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="n">IDS</span><span class="w">                                     </span><span class="err">│</span>
<span class="err">│</span><span class="w">  </span><span class="o">[</span><span class="n">x</span><span class="o">]</span><span class="w"> </span><span class="n">엔드포인트</span><span class="w"> </span><span class="n">탐지</span><span class="w"> </span><span class="n">및</span><span class="w"> </span><span class="n">대응</span><span class="w"> </span><span class="p">(</span><span class="n">EDR</span><span class="p">)</span><span class="w">                               </span><span class="err">│</span>
<span class="err">│</span><span class="w">  </span><span class="o">[</span><span class="n">x</span><span class="o">]</span><span class="w"> </span><span class="n">백업</span><span class="w"> </span><span class="n">및</span><span class="w"> </span><span class="n">복구</span><span class="w"> </span><span class="n">시스템</span><span class="w"> </span><span class="n">테스트</span><span class="w"> </span><span class="n">완료</span><span class="w">                             </span><span class="err">│</span>
<span class="err">│</span><span class="w">  </span><span class="o">[</span><span class="n">x</span><span class="o">]</span><span class="w"> </span><span class="n">클린</span><span class="w"> </span><span class="n">OS</span><span class="w"> </span><span class="n">이미지</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="n">골든</span><span class="w"> </span><span class="n">이미지</span><span class="w">                                </span><span class="err">│</span>
<span class="err">│</span><span class="w">  </span><span class="o">[</span><span class="n">x</span><span class="o">]</span><span class="w"> </span><span class="n">점프</span><span class="w"> </span><span class="nl">백</span><span class="p">:</span><span class="w"> </span><span class="n">휴대용</span><span class="w"> </span><span class="n">포렌식</span><span class="w"> </span><span class="n">도구</span><span class="p">,</span><span class="w"> </span><span class="n">케이블</span><span class="p">,</span><span class="w"> </span><span class="n">스토리지</span><span class="w">               </span><span class="err">│</span>
<span class="err">│</span><span class="w">                                                                   </span><span class="err">│</span>
<span class="err">└──────────────────────────────────────────────────────────────────┘</span>
</code></pre></div>

<h4 id="ir">IR 팀 역할<a class="header-link" href="#ir" title="Permanent link">&para;</a></h4>
<div class="highlight"><pre><span></span><code>┌──────────────────────────────────────────────────────────────────┐
│                   사고 대응 팀 역할                                │
├──────────────────────────────────────────────────────────────────┤
│                                                                   │
│  ┌─────────────────────┐                                         │
│  │   사고 관리자        │  전체 조정, 의사결정,                   │
│  │   (팀 리더)          │  경영진과의 커뮤니케이션                │
│  └─────────┬───────────┘                                         │
│            │                                                      │
│  ┌─────────┴────────────────────────────────┐                    │
│  │         │              │                  │                    │
│  ▼         ▼              ▼                  ▼                    │
│ ┌────────┐ ┌────────────┐ ┌──────────┐ ┌──────────┐            │
│ │보안     │ │  포렌식     │ │  시스템  │ │ 커뮤니케 │            │
│ │분석가   │ │  분석가     │ │  관리자  │ │ 이션/법무│            │
│ │        │ │            │ │          │ │          │            │
│ │모니터링│ │증거        │ │격리 및   │ │알림 및   │            │
│ │트리아지│ │수집        │ │복구      │ │문서화    │            │
│ │분석    │ │분석        │ │패치      │ │규제 대응 │            │
│ └────────┘ └────────────┘ └──────────┘ └──────────┘            │
│                                                                   │
└──────────────────────────────────────────────────────────────────┘
</code></pre></div>

<h3 id="23-2">2.3 2단계: 탐지 및 분석<a class="header-link" href="#23-2" title="Permanent link">&para;</a></h3>
<h4 id="_3">탐지 소스<a class="header-link" href="#_3" title="Permanent link">&para;</a></h4>
<div class="highlight"><pre><span></span><code><span class="err">┌──────────────────────────────────────────────────────────────────┐</span>
<span class="err">│</span><span class="w">                    </span><span class="err">탐지</span><span class="w"> </span><span class="err">소스</span><span class="w">                                       </span><span class="err">│</span>
<span class="err">├──────────────────────────────────────────────────────────────────┤</span>
<span class="err">│</span><span class="w">                                                                   </span><span class="err">│</span>
<span class="err">│</span><span class="w">  </span><span class="err">자동화</span><span class="o">:</span><span class="w">                                                          </span><span class="err">│</span>
<span class="err">│</span><span class="w">  </span><span class="err">├──</span><span class="w"> </span><span class="n">SIEM</span><span class="w"> </span><span class="err">경고</span><span class="w"> </span><span class="p">(</span><span class="err">상관된</span><span class="w"> </span><span class="err">로그</span><span class="w"> </span><span class="err">이벤트</span><span class="p">)</span><span class="w">                              </span><span class="err">│</span>
<span class="err">│</span><span class="w">  </span><span class="err">├──</span><span class="w"> </span><span class="n">IDS</span><span class="o">/</span><span class="n">IPS</span><span class="w"> </span><span class="p">(</span><span class="n">Snort</span><span class="p">,</span><span class="w"> </span><span class="n">Suricata</span><span class="p">)</span><span class="w">                                   </span><span class="err">│</span>
<span class="err">│</span><span class="w">  </span><span class="err">├──</span><span class="w"> </span><span class="n">EDR</span><span class="w"> </span><span class="err">경고</span><span class="w"> </span><span class="p">(</span><span class="n">CrowdStrike</span><span class="p">,</span><span class="w"> </span><span class="n">Carbon</span><span class="w"> </span><span class="n">Black</span><span class="w"> </span><span class="err">등</span><span class="p">)</span><span class="w">                     </span><span class="err">│</span>
<span class="err">│</span><span class="w">  </span><span class="err">├──</span><span class="w"> </span><span class="n">WAF</span><span class="w"> </span><span class="err">경고</span><span class="w"> </span><span class="p">(</span><span class="n">ModSecurity</span><span class="p">,</span><span class="w"> </span><span class="n">AWS</span><span class="w"> </span><span class="n">WAF</span><span class="p">)</span><span class="w">                             </span><span class="err">│</span>
<span class="err">│</span><span class="w">  </span><span class="err">├──</span><span class="w"> </span><span class="err">안티바이러스</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="err">안티멀웨어</span><span class="w">                                    </span><span class="err">│</span>
<span class="err">│</span><span class="w">  </span><span class="err">├──</span><span class="w"> </span><span class="err">파일</span><span class="w"> </span><span class="err">무결성</span><span class="w"> </span><span class="err">모니터링</span><span class="w"> </span><span class="p">(</span><span class="n">OSSEC</span><span class="p">,</span><span class="w"> </span><span class="n">Tripwire</span><span class="p">)</span><span class="w">                      </span><span class="err">│</span>
<span class="err">│</span><span class="w">  </span><span class="err">├──</span><span class="w"> </span><span class="err">네트워크</span><span class="w"> </span><span class="err">트래픽</span><span class="w"> </span><span class="err">이상</span><span class="w"> </span><span class="p">(</span><span class="n">NetFlow</span><span class="p">,</span><span class="w"> </span><span class="n">Zeek</span><span class="p">)</span><span class="w">                        </span><span class="err">│</span>
<span class="err">│</span><span class="w">  </span><span class="err">└──</span><span class="w"> </span><span class="err">클라우드</span><span class="w"> </span><span class="err">보안</span><span class="w"> </span><span class="err">경고</span><span class="w"> </span><span class="p">(</span><span class="n">GuardDuty</span><span class="p">,</span><span class="w"> </span><span class="n">Security</span><span class="w"> </span><span class="n">Center</span><span class="p">)</span><span class="w">             </span><span class="err">│</span>
<span class="err">│</span><span class="w">                                                                   </span><span class="err">│</span>
<span class="err">│</span><span class="w">  </span><span class="err">사람</span><span class="o">:</span><span class="w">                                                            </span><span class="err">│</span>
<span class="err">│</span><span class="w">  </span><span class="err">├──</span><span class="w"> </span><span class="err">사용자</span><span class="w"> </span><span class="err">신고</span><span class="w"> </span><span class="p">(</span><span class="s">&quot;뭔가 이상합니다&quot;</span><span class="p">)</span><span class="w">                             </span><span class="err">│</span>
<span class="err">│</span><span class="w">  </span><span class="err">├──</span><span class="w"> </span><span class="err">헬프데스크</span><span class="w"> </span><span class="err">티켓</span><span class="w">                                              </span><span class="err">│</span>
<span class="err">│</span><span class="w">  </span><span class="err">├──</span><span class="w"> </span><span class="err">외부</span><span class="w"> </span><span class="err">알림</span><span class="w"> </span><span class="p">(</span><span class="err">파트너</span><span class="p">,</span><span class="w"> </span><span class="err">벤더</span><span class="p">,</span><span class="w"> </span><span class="err">연구원</span><span class="p">)</span><span class="w">                            </span><span class="err">│</span>
<span class="err">│</span><span class="w">  </span><span class="err">├──</span><span class="w"> </span><span class="err">법</span><span class="w"> </span><span class="err">집행기관</span><span class="w"> </span><span class="err">알림</span><span class="w">                                             </span><span class="err">│</span>
<span class="err">│</span><span class="w">  </span><span class="err">├──</span><span class="w"> </span><span class="err">언론</span><span class="w"> </span><span class="err">보도</span><span class="w">                                                    </span><span class="err">│</span>
<span class="err">│</span><span class="w">  </span><span class="err">└──</span><span class="w"> </span><span class="err">위협</span><span class="w"> </span><span class="err">인텔리전스</span><span class="w"> </span><span class="err">피드</span><span class="w">                                         </span><span class="err">│</span>
<span class="err">│</span><span class="w">                                                                   </span><span class="err">│</span>
<span class="err">│</span><span class="w">  </span><span class="err">능동적</span><span class="o">:</span><span class="w">                                                          </span><span class="err">│</span>
<span class="err">│</span><span class="w">  </span><span class="err">├──</span><span class="w"> </span><span class="err">위협</span><span class="w"> </span><span class="err">헌팅</span><span class="w">                                                    </span><span class="err">│</span>
<span class="err">│</span><span class="w">  </span><span class="err">├──</span><span class="w"> </span><span class="err">침투</span><span class="w"> </span><span class="err">테스트</span><span class="w"> </span><span class="err">결과</span><span class="w">                                             </span><span class="err">│</span>
<span class="err">│</span><span class="w">  </span><span class="err">├──</span><span class="w"> </span><span class="err">취약점</span><span class="w"> </span><span class="err">스캔</span><span class="w">                                                  </span><span class="err">│</span>
<span class="err">│</span><span class="w">  </span><span class="err">└──</span><span class="w"> </span><span class="err">로그</span><span class="w"> </span><span class="err">검토</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="err">감사</span><span class="w">                                             </span><span class="err">│</span>
<span class="err">│</span><span class="w">                                                                   </span><span class="err">│</span>
<span class="err">└──────────────────────────────────────────────────────────────────┘</span>
</code></pre></div>

<h4 id="_4">초기 분석 질문<a class="header-link" href="#_4" title="Permanent link">&para;</a></h4>
<p>경고가 발생하면 다음 질문들에 체계적으로 답변하십시오:</p>
<div class="highlight"><pre><span></span><code><span class="mf">1.</span><span class="w"> </span><span class="n">무엇이</span><span class="w"> </span><span class="n">일어났는가</span><span class="err">?</span>
<span class="w">   </span><span class="o">-</span><span class="w"> </span><span class="n">어떤</span><span class="w"> </span><span class="n">시스템</span><span class="o">/</span><span class="n">데이터가</span><span class="w"> </span><span class="n">영향을</span><span class="w"> </span><span class="n">받았는가</span><span class="err">?</span>
<span class="w">   </span><span class="o">-</span><span class="w"> </span><span class="n">이것은</span><span class="w"> </span><span class="n">어떤</span><span class="w"> </span><span class="n">유형의</span><span class="w"> </span><span class="n">사고인가</span><span class="err">?</span>
<span class="w">   </span><span class="o">-</span><span class="w"> </span><span class="n">초기</span><span class="w"> </span><span class="n">증거는</span><span class="w"> </span><span class="n">무엇인가</span><span class="err">?</span>

<span class="mf">2.</span><span class="w"> </span><span class="n">언제</span><span class="w"> </span><span class="n">일어났는가</span><span class="err">?</span>
<span class="w">   </span><span class="o">-</span><span class="w"> </span><span class="n">첫</span><span class="w"> </span><span class="n">번째</span><span class="w"> </span><span class="n">지표는</span><span class="w"> </span><span class="n">언제였는가</span><span class="err">?</span>
<span class="w">   </span><span class="o">-</span><span class="w"> </span><span class="n">언제</span><span class="w"> </span><span class="n">탐지되었는가</span><span class="err">?</span>
<span class="w">   </span><span class="o">-</span><span class="w"> </span><span class="n">현재</span><span class="w"> </span><span class="n">진행</span><span class="w"> </span><span class="n">중인가</span><span class="err">?</span>

<span class="mf">3.</span><span class="w"> </span><span class="n">어디에</span><span class="w"> </span><span class="n">영향이</span><span class="w"> </span><span class="n">있는가</span><span class="err">?</span>
<span class="w">   </span><span class="o">-</span><span class="w"> </span><span class="n">어떤</span><span class="w"> </span><span class="n">호스트</span><span class="o">/</span><span class="n">네트워크</span><span class="err">?</span>
<span class="w">   </span><span class="o">-</span><span class="w"> </span><span class="n">어떤</span><span class="w"> </span><span class="n">애플리케이션</span><span class="o">/</span><span class="n">서비스</span><span class="err">?</span>
<span class="w">   </span><span class="o">-</span><span class="w"> </span><span class="n">어떤</span><span class="w"> </span><span class="n">데이터</span><span class="o">/</span><span class="n">사용자</span><span class="err">?</span>

<span class="mf">4.</span><span class="w"> </span><span class="n">누가</span><span class="w"> </span><span class="n">관련되어</span><span class="w"> </span><span class="n">있는가</span><span class="err">?</span>
<span class="w">   </span><span class="o">-</span><span class="w"> </span><span class="n">소스</span><span class="w"> </span><span class="n">IP</span><span class="o">/</span><span class="n">계정</span><span class="err">?</span>
<span class="w">   </span><span class="o">-</span><span class="w"> </span><span class="n">타겟팅된</span><span class="w"> </span><span class="n">사용자</span><span class="o">/</span><span class="n">시스템</span><span class="err">?</span>
<span class="w">   </span><span class="o">-</span><span class="w"> </span><span class="n">내부</span><span class="w"> </span><span class="n">또는</span><span class="w"> </span><span class="n">외부</span><span class="w"> </span><span class="n">행위자</span><span class="err">?</span>

<span class="mf">5.</span><span class="w"> </span><span class="n">어떻게</span><span class="w"> </span><span class="n">일어났는가</span><span class="err">?</span>
<span class="w">   </span><span class="o">-</span><span class="w"> </span><span class="n">공격</span><span class="w"> </span><span class="n">벡터</span><span class="w"> </span><span class="p">(</span><span class="n">피싱</span><span class="p">,</span><span class="w"> </span><span class="n">익스플로잇</span><span class="p">,</span><span class="w"> </span><span class="n">내부자</span><span class="w"> </span><span class="n">등</span><span class="p">)</span><span class="err">?</span>
<span class="w">   </span><span class="o">-</span><span class="w"> </span><span class="n">악용된</span><span class="w"> </span><span class="n">취약점</span><span class="err">?</span>
<span class="w">   </span><span class="o">-</span><span class="w"> </span><span class="n">사용된</span><span class="w"> </span><span class="n">도구</span><span class="o">/</span><span class="n">기법</span><span class="err">?</span>

<span class="mf">6.</span><span class="w"> </span><span class="n">얼마나</span><span class="w"> </span><span class="n">심각한가</span><span class="err">?</span>
<span class="w">   </span><span class="o">-</span><span class="w"> </span><span class="n">범위</span><span class="p">:</span><span class="w"> </span><span class="n">몇</span><span class="w"> </span><span class="n">개의</span><span class="w"> </span><span class="n">시스템이</span><span class="w"> </span><span class="n">영향을</span><span class="w"> </span><span class="n">받았는가</span><span class="err">?</span>
<span class="w">   </span><span class="o">-</span><span class="w"> </span><span class="n">영향</span><span class="p">:</span><span class="w"> </span><span class="n">데이터</span><span class="w"> </span><span class="n">손실</span><span class="p">,</span><span class="w"> </span><span class="n">서비스</span><span class="w"> </span><span class="n">중단</span><span class="err">?</span>
<span class="w">   </span><span class="o">-</span><span class="w"> </span><span class="n">심각도</span><span class="w"> </span><span class="n">분류</span><span class="w"> </span><span class="p">(</span><span class="n">P1</span><span class="o">-</span><span class="n">P4</span><span class="p">)</span><span class="err">?</span>
</code></pre></div>

<h3 id="24-3">2.4 3단계: 격리, 제거 및 복구<a class="header-link" href="#24-3" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code>┌──────────────────────────────────────────────────────────────────┐
│          격리 → 제거 → 복구                                        │
├──────────────────────────────────────────────────────────────────┤
│                                                                   │
│  ┌─────────────────────────────────────────────┐                 │
│  │  격리 (출혈 멈추기)                          │                 │
│  │                                              │                 │
│  │  단기:                                       │                 │
│  │  ├── 영향받은 시스템 격리 (네트워크)        │                 │
│  │  ├── 악성 IP/도메인 차단                    │                 │
│  │  ├── 침해된 계정 비활성화                   │                 │
│  │  ├── 필요시 DNS 리디렉션                    │                 │
│  │  └── 변경 전 증거 보존                      │                 │
│  │                                              │                 │
│  │  장기:                                       │                 │
│  │  ├── 임시 패치/우회 방법 적용               │                 │
│  │  ├── 영향받은 영역의 모니터링 증가          │                 │
│  │  ├── 추가 접근 제어 구현                    │                 │
│  │  └── 적절한 경우 허니팟/카나리 설정         │                 │
│  └─────────────────────────────────────────────┘                 │
│            │                                                      │
│            ▼                                                      │
│  ┌─────────────────────────────────────────────┐                 │
│  │  제거 (위협 제거)                            │                 │
│  │                                              │                 │
│  │  ├── 악성코드 / 백도어 제거                 │                 │
│  │  ├── 악용된 취약점 패치                     │                 │
│  │  ├── 침해된 자격 증명 재설정                │                 │
│  │  ├── 필요시 영향받은 시스템 재구축          │                 │
│  │  ├── 방화벽/IDS 규칙 업데이트               │                 │
│  │  └── 지속성 메커니즘 스캔                   │                 │
│  └─────────────────────────────────────────────┘                 │
│            │                                                      │
│            ▼                                                      │
│  ┌─────────────────────────────────────────────┐                 │
│  │  복구 (정상으로 복귀)                        │                 │
│  │                                              │                 │
│  │  ├── 클린 백업에서 복원                     │                 │
│  │  ├── 골든 이미지에서 시스템 재구축          │                 │
│  │  ├── 서비스 점진적 복원                     │                 │
│  │  ├── 시스템 무결성 검증                     │                 │
│  │  ├── 재침해에 대한 면밀한 모니터링          │                 │
│  │  └── 사고 해결 선언                         │                 │
│  └─────────────────────────────────────────────┘                 │
│                                                                   │
│  중요: 모든 조치를 타임스탬프와 함께 문서화하십시오!             │
│                                                                   │
└──────────────────────────────────────────────────────────────────┘
</code></pre></div>

<h3 id="25-4">2.5 4단계: 사고 후 활동 (교훈 학습)<a class="header-link" href="#25-4" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code>┌──────────────────────────────────────────────────────────────────┐
│              사고 후 검토 회의 안건                                │
├──────────────────────────────────────────────────────────────────┤
│                                                                   │
│  일정: 사고 종료 후 1-2주 이내                                    │
│  참석자: 모든 관련자 (비난 없는 환경)                             │
│                                                                   │
│  1. 타임라인 검토 (30분)                                          │
│     - 완전한 타임라인 살펴보기                                    │
│     - 첫 지표는 언제? 탐지는 언제? 해결은 언제?                  │
│                                                                   │
│  2. 잘된 점 (15분)                                                │
│     - 효과적인 탐지 메커니즘                                      │
│     - 신속한 격리 조치                                            │
│     - 좋은 커뮤니케이션                                           │
│                                                                   │
│  3. 개선할 수 있는 점 (30분)                                      │
│     - 탐지 공백                                                   │
│     - 대응 지연                                                   │
│     - 커뮤니케이션 단절                                           │
│     - 도구/프로세스 공백                                          │
│                                                                   │
│  4. 근본 원인 분석 (30분)                                         │
│     - 근본 원인은 무엇이었는가?                                   │
│     - 기존 통제가 실패한 이유는?                                  │
│     - &quot;5 Whys&quot; 기법 사용                                          │
│                                                                   │
│  5. 액션 아이템 (15분)                                            │
│     - 담당자와 마감일이 있는 구체적인 개선사항                    │
│     - 프로세스 변경                                               │
│     - 기술 변경                                                   │
│     - 교육 필요사항                                               │
│                                                                   │
└──────────────────────────────────────────────────────────────────┘
</code></pre></div>

<hr />
<h2 id="3-siem">3. 로그 분석 및 SIEM 개념<a class="header-link" href="#3-siem" title="Permanent link">&para;</a></h2>
<h3 id="31">3.1 로깅 아키텍처<a class="header-link" href="#31" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code>┌──────────────────────────────────────────────────────────────────┐
│                  중앙 집중식 로깅 아키텍처                          │
├──────────────────────────────────────────────────────────────────┤
│                                                                   │
│  로그 소스                    수집            스토리지/분석       │
│  ┌──────────┐                                                     │
│  │ 웹       │──┐                                                  │
│  │ 서버     │  │    ┌───────────────┐    ┌───────────────────┐   │
│  └──────────┘  ├──► │  로그 전송     │──► │                   │   │
│  ┌──────────┐  │    │  (Filebeat,   │    │  SIEM / 로그      │   │
│  │ 앱       │──┤    │   Fluentd,    │    │  관리             │   │
│  │ 서버     │  │    │   rsyslog)    │    │                   │   │
│  └──────────┘  │    └───────────────┘    │  - Elasticsearch  │   │
│  ┌──────────┐  │                         │  - Splunk         │   │
│  │ 데이터   │──┤    ┌───────────────┐    │  - Graylog        │   │
│  │ 베이스   │  ├──► │  메시지       │──► │  - Wazuh          │   │
│  └──────────┘  │    │  큐           │    │  - QRadar         │   │
│  ┌──────────┐  │    │  (Kafka,      │    │                   │   │
│  │ 방화벽   │──┤    │   Redis)      │    │  기능:            │   │
│  │ / IDS    │  │    └───────────────┘    │  - 검색           │   │
│  └──────────┘  │                         │  - 상관 분석      │   │
│  ┌──────────┐  │                         │  - 경고           │   │
│  │ 엔드포   │──┘                         │  - 대시보드       │   │
│  │ 인트에이│                             │  - 보관           │   │
│  │ 전트     │                            └───────────────────┘   │
│  └──────────┘                                                     │
│                                                                   │
└──────────────────────────────────────────────────────────────────┘
</code></pre></div>

<h3 id="32">3.2 중요한 로그 소스<a class="header-link" href="#32" title="Permanent link">&para;</a></h3>
<table>
<thead>
<tr>
<th>로그 소스</th>
<th>캡처 대상</th>
<th>보안 가치</th>
</tr>
</thead>
<tbody>
<tr>
<td><strong>웹 서버</strong> (nginx, Apache)</td>
<td>접근 로그, 오류 로그</td>
<td>공격 탐지, 이상 탐지</td>
</tr>
<tr>
<td><strong>애플리케이션</strong></td>
<td>인증 이벤트, 오류, API 호출</td>
<td>비즈니스 로직 공격, 악용</td>
</tr>
<tr>
<td><strong>데이터베이스</strong></td>
<td>쿼리, 연결, 오류</td>
<td>SQL 인젝션, 데이터 유출</td>
</tr>
<tr>
<td><strong>OS / 시스템</strong></td>
<td>인증 로그, 프로세스 실행, 파일 변경</td>
<td>권한 상승, 지속성</td>
</tr>
<tr>
<td><strong>방화벽</strong></td>
<td>허용/거부, 연결</td>
<td>네트워크 공격, 측면 이동</td>
</tr>
<tr>
<td><strong>DNS</strong></td>
<td>쿼리, 응답</td>
<td>C2 통신, 데이터 유출</td>
</tr>
<tr>
<td><strong>이메일</strong></td>
<td>송수신, 첨부 파일</td>
<td>피싱, 데이터 유출</td>
</tr>
<tr>
<td><strong>클라우드</strong></td>
<td>API 호출, 설정 변경</td>
<td>잘못된 설정, 무단 접근</td>
</tr>
</tbody>
</table>
<h3 id="33-siem">3.3 SIEM 상관 규칙<a class="header-link" href="#33-siem" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code>┌──────────────────────────────────────────────────────────────────┐
│<span class="w">                   </span>일반적인<span class="w"> </span><span class="nv">SIEM</span><span class="w"> </span>상관<span class="w"> </span>규칙<span class="w">                          </span>│
├──────────────────────────────────────────────────────────────────┤
│<span class="w">                                                                   </span>│
│<span class="w">  </span>규칙<span class="w"> </span><span class="mi">1</span>:<span class="w"> </span>무차별<span class="w"> </span>대입<span class="w"> </span>탐지<span class="w">                                         </span>│
│<span class="w">  </span>┌────────────────────────────────────────────────────┐<span class="w">          </span>│
│<span class="w">  </span>│<span class="w"> </span><span class="k">IF</span>:<span class="w"> </span>동일<span class="w"> </span><span class="nv">IP</span>에서<span class="w"> </span><span class="mi">5</span>분<span class="w"> </span>내에<span class="w"> </span><span class="mi">10</span>회<span class="w"> </span>이상<span class="w"> </span>로그인<span class="w"> </span>실패<span class="w">    </span>│<span class="w">          </span>│
│<span class="w">  </span>│<span class="w"> </span><span class="k">THEN</span>:<span class="w"> </span><span class="s2">&quot;가능한 무차별 대입 공격&quot;</span><span class="w"> </span>경고<span class="w">               </span>│<span class="w">          </span>│
│<span class="w">  </span>│<span class="w"> </span>심각도:<span class="w"> </span><span class="nv">Medium</span><span class="w">                                     </span>│<span class="w">          </span>│
│<span class="w">  </span>│<span class="w"> </span>조치:<span class="w"> </span><span class="nv">IP</span><span class="w"> </span>임시<span class="w"> </span>차단,<span class="w"> </span><span class="nv">SOC</span><span class="w"> </span>알림<span class="w">                       </span>│<span class="w">          </span>│
│<span class="w">  </span>└────────────────────────────────────────────────────┘<span class="w">          </span>│
│<span class="w">                                                                   </span>│
│<span class="w">  </span>규칙<span class="w"> </span><span class="mi">2</span>:<span class="w"> </span>불가능한<span class="w"> </span>이동<span class="w">                                            </span>│
│<span class="w">  </span>┌────────────────────────────────────────────────────┐<span class="w">          </span>│
│<span class="w">  </span>│<span class="w"> </span><span class="k">IF</span>:<span class="w"> </span>동일<span class="w"> </span>사용자가<span class="w"> </span><span class="mi">30</span>분<span class="w"> </span>내에<span class="w"> </span><span class="mi">500</span>마일<span class="w"> </span>이상<span class="w">          </span>│<span class="w">          </span>│
│<span class="w">  </span>│<span class="w">     </span>떨어진<span class="w"> </span><span class="mi">2</span>개<span class="w"> </span>지역에서<span class="w"> </span>로그인<span class="w">                     </span>│<span class="w">          </span>│
│<span class="w">  </span>│<span class="w"> </span><span class="k">THEN</span>:<span class="w"> </span><span class="s2">&quot;불가능한 이동 탐지&quot;</span><span class="w"> </span>경고<span class="w">                    </span>│<span class="w">          </span>│
│<span class="w">  </span>│<span class="w"> </span>심각도:<span class="w"> </span><span class="nv">High</span><span class="w">                                       </span>│<span class="w">          </span>│
│<span class="w">  </span>│<span class="w"> </span>조치:<span class="w"> </span>재인증<span class="w"> </span>강제,<span class="w"> </span>사용자<span class="w"> </span>알림<span class="w">                     </span>│<span class="w">          </span>│
│<span class="w">  </span>└────────────────────────────────────────────────────┘<span class="w">          </span>│
│<span class="w">                                                                   </span>│
│<span class="w">  </span>규칙<span class="w"> </span><span class="mi">3</span>:<span class="w"> </span>데이터<span class="w"> </span>유출<span class="w">                                              </span>│
│<span class="w">  </span>┌────────────────────────────────────────────────────┐<span class="w">          </span>│
│<span class="w">  </span>│<span class="w"> </span><span class="k">IF</span>:<span class="w"> </span>외부<span class="w"> </span><span class="nv">IP</span>로<span class="w"> </span><span class="mi">100</span><span class="nv">MB</span><span class="w"> </span>이상<span class="w"> </span>데이터<span class="w"> </span>전송<span class="w">               </span>│<span class="w">          </span>│
│<span class="w">  </span>│<span class="w">     </span>평소<span class="w"> </span><span class="mi">1</span><span class="nv">MB</span><span class="o">/</span>시간<span class="w"> </span>미만<span class="w"> </span>전송하는<span class="w"> </span>서버에서<span class="w">           </span>│<span class="w">          </span>│
│<span class="w">  </span>│<span class="w"> </span><span class="k">THEN</span>:<span class="w"> </span><span class="s2">&quot;가능한 데이터 유출&quot;</span><span class="w"> </span>경고<span class="w">                    </span>│<span class="w">          </span>│
│<span class="w">  </span>│<span class="w"> </span>심각도:<span class="w"> </span><span class="nv">Critical</span><span class="w">                                   </span>│<span class="w">          </span>│
│<span class="w">  </span>│<span class="w"> </span>조치:<span class="w"> </span>전송<span class="w"> </span>차단,<span class="w"> </span>호스트<span class="w"> </span>격리,<span class="w"> </span><span class="nv">IR</span><span class="w"> </span>경고<span class="w">              </span>│<span class="w">          </span>│
│<span class="w">  </span>└────────────────────────────────────────────────────┘<span class="w">          </span>│
│<span class="w">                                                                   </span>│
│<span class="w">  </span>규칙<span class="w"> </span><span class="mi">4</span>:<span class="w"> </span>권한<span class="w"> </span>상승<span class="w">                                                </span>│
│<span class="w">  </span>┌────────────────────────────────────────────────────┐<span class="w">          </span>│
│<span class="w">  </span>│<span class="w"> </span><span class="k">IF</span>:<span class="w"> </span>사용자가<span class="w"> </span>관리자<span class="o">/</span>루트<span class="w"> </span>그룹에<span class="w"> </span>추가됨<span class="w">             </span>│<span class="w">          </span>│
│<span class="w">  </span>│<span class="w">     </span><span class="nv">AND</span><span class="w"> </span>승인된<span class="w"> </span>변경<span class="w"> </span>시스템에서<span class="w"> </span>온<span class="w"> </span>것이<span class="w"> </span>아님<span class="w">        </span>│<span class="w">          </span>│
│<span class="w">  </span>│<span class="w"> </span><span class="k">THEN</span>:<span class="w"> </span><span class="s2">&quot;무단 권한 상승&quot;</span><span class="w"> </span>경고<span class="w">                        </span>│<span class="w">          </span>│
│<span class="w">  </span>│<span class="w"> </span>심각도:<span class="w"> </span><span class="nv">Critical</span><span class="w">                                   </span>│<span class="w">          </span>│
│<span class="w">  </span>│<span class="w"> </span>조치:<span class="w"> </span>변경<span class="w"> </span>되돌림,<span class="w"> </span>계정<span class="w"> </span>비활성화,<span class="w"> </span><span class="nv">IR</span><span class="w"> </span>경고<span class="w">          </span>│<span class="w">          </span>│
│<span class="w">  </span>└────────────────────────────────────────────────────┘<span class="w">          </span>│
│<span class="w">                                                                   </span>│
│<span class="w">  </span>규칙<span class="w"> </span><span class="mi">5</span>:<span class="w"> </span>웹<span class="w"> </span>애플리케이션<span class="w"> </span>공격<span class="w">                                     </span>│
│<span class="w">  </span>┌────────────────────────────────────────────────────┐<span class="w">          </span>│
│<span class="w">  </span>│<span class="w"> </span><span class="k">IF</span>:<span class="w"> </span>동일<span class="w"> </span><span class="nv">IP</span>에서<span class="w"> </span><span class="mi">1</span>분<span class="w"> </span>내에<span class="w"> </span><span class="nv">WAF</span><span class="w"> </span>차단<span class="w"> </span><span class="mi">5</span>회<span class="w"> </span>이상<span class="w">        </span>│<span class="w">          </span>│
│<span class="w">  </span>│<span class="w">     </span><span class="nv">AND</span><span class="w"> </span>동일<span class="w"> </span>앱에서<span class="w"> </span><span class="nv">HTTP</span><span class="w"> </span><span class="mi">500</span><span class="w"> </span>오류<span class="w"> </span>증가<span class="w">             </span>│<span class="w">          </span>│
│<span class="w">  </span>│<span class="w"> </span><span class="k">THEN</span>:<span class="w"> </span><span class="s2">&quot;활성 웹 애플리케이션 공격&quot;</span><span class="w"> </span>경고<span class="w">             </span>│<span class="w">          </span>│
│<span class="w">  </span>│<span class="w"> </span>심각도:<span class="w"> </span><span class="nv">High</span><span class="w">                                       </span>│<span class="w">          </span>│
│<span class="w">  </span>│<span class="w"> </span>조치:<span class="w"> </span><span class="nv">IP</span><span class="w"> </span>차단,<span class="w"> </span>로깅<span class="w"> </span>증가,<span class="w"> </span><span class="nv">IR</span><span class="w"> </span>경고<span class="w">                  </span>│<span class="w">          </span>│
│<span class="w">  </span>└────────────────────────────────────────────────────┘<span class="w">          </span>│
│<span class="w">                                                                   </span>│
└──────────────────────────────────────────────────────────────────┘
</code></pre></div>

<hr />
<h2 id="4-python">4. Python: 로그 파싱 및 분석<a class="header-link" href="#4-python" title="Permanent link">&para;</a></h2>
<h3 id="41">4.1 웹 서버 로그 파서<a class="header-link" href="#41" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">log_parser.py - 웹 서버 접근 로그를 파싱하고 분석합니다.</span>
<span class="sd">Apache/Nginx combined 로그 형식 지원.</span>

<span class="sd">예제 로그 라인:</span>
<span class="sd">192.168.1.100 - admin [15/Jan/2025:10:30:45 +0000] &quot;GET /admin HTTP/1.1&quot; 200 1234 &quot;http://example.com&quot; &quot;Mozilla/5.0&quot;</span>
<span class="sd">&quot;&quot;&quot;</span>

<span class="kn">import</span><span class="w"> </span><span class="nn">re</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">collections</span><span class="w"> </span><span class="kn">import</span> <span class="n">Counter</span><span class="p">,</span> <span class="n">defaultdict</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">dataclasses</span><span class="w"> </span><span class="kn">import</span> <span class="n">dataclass</span><span class="p">,</span> <span class="n">field</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">datetime</span><span class="w"> </span><span class="kn">import</span> <span class="n">datetime</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">pathlib</span><span class="w"> </span><span class="kn">import</span> <span class="n">Path</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">typing</span><span class="w"> </span><span class="kn">import</span> <span class="n">Optional</span><span class="p">,</span> <span class="n">Iterator</span>


<span class="c1"># Combined log format regex</span>
<span class="n">LOG_PATTERN</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span>
    <span class="sa">r</span><span class="s1">&#39;(?P&lt;ip&gt;\S+)\s+&#39;</span>              <span class="c1"># IP address</span>
    <span class="sa">r</span><span class="s1">&#39;\S+\s+&#39;</span>                       <span class="c1"># ident (usually -)</span>
    <span class="sa">r</span><span class="s1">&#39;(?P&lt;user&gt;\S+)\s+&#39;</span>            <span class="c1"># authenticated user</span>
    <span class="sa">r</span><span class="s1">&#39;\[(?P&lt;time&gt;[^\]]+)\]\s+&#39;</span>     <span class="c1"># timestamp</span>
    <span class="sa">r</span><span class="s1">&#39;&quot;(?P&lt;method&gt;\S+)\s+&#39;</span>         <span class="c1"># HTTP method</span>
    <span class="sa">r</span><span class="s1">&#39;(?P&lt;path&gt;\S+)\s+&#39;</span>            <span class="c1"># request path</span>
    <span class="sa">r</span><span class="s1">&#39;(?P&lt;protocol&gt;\S+)&quot;\s+&#39;</span>       <span class="c1"># HTTP version</span>
    <span class="sa">r</span><span class="s1">&#39;(?P&lt;status&gt;\d+)\s+&#39;</span>          <span class="c1"># status code</span>
    <span class="sa">r</span><span class="s1">&#39;(?P&lt;size&gt;\S+)\s+&#39;</span>            <span class="c1"># response size</span>
    <span class="sa">r</span><span class="s1">&#39;&quot;(?P&lt;referer&gt;[^&quot;]*)&quot;\s+&#39;</span>     <span class="c1"># referer</span>
    <span class="sa">r</span><span class="s1">&#39;&quot;(?P&lt;agent&gt;[^&quot;]*)&quot;&#39;</span>          <span class="c1"># user agent</span>
<span class="p">)</span>


<span class="nd">@dataclass</span>
<span class="k">class</span><span class="w"> </span><span class="nc">LogEntry</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;파싱된 로그 엔트리.&quot;&quot;&quot;</span>
    <span class="n">ip</span><span class="p">:</span> <span class="nb">str</span>
    <span class="n">user</span><span class="p">:</span> <span class="nb">str</span>
    <span class="n">timestamp</span><span class="p">:</span> <span class="n">datetime</span>
    <span class="n">method</span><span class="p">:</span> <span class="nb">str</span>
    <span class="n">path</span><span class="p">:</span> <span class="nb">str</span>
    <span class="n">protocol</span><span class="p">:</span> <span class="nb">str</span>
    <span class="n">status</span><span class="p">:</span> <span class="nb">int</span>
    <span class="n">size</span><span class="p">:</span> <span class="nb">int</span>
    <span class="n">referer</span><span class="p">:</span> <span class="nb">str</span>
    <span class="n">user_agent</span><span class="p">:</span> <span class="nb">str</span>
    <span class="n">raw</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>


<span class="nd">@dataclass</span>
<span class="k">class</span><span class="w"> </span><span class="nc">SecurityAlert</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;로그 분석에서 생성된 보안 경고.&quot;&quot;&quot;</span>
    <span class="n">alert_type</span><span class="p">:</span> <span class="nb">str</span>
    <span class="n">severity</span><span class="p">:</span> <span class="nb">str</span>           <span class="c1"># CRITICAL, HIGH, MEDIUM, LOW</span>
    <span class="n">description</span><span class="p">:</span> <span class="nb">str</span>
    <span class="n">source_ip</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="n">count</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="n">sample_entries</span><span class="p">:</span> <span class="nb">list</span> <span class="o">=</span> <span class="n">field</span><span class="p">(</span><span class="n">default_factory</span><span class="o">=</span><span class="nb">list</span><span class="p">)</span>
    <span class="n">timestamp</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="p">(</span><span class="sa">f</span><span class="s2">&quot;[</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">severity</span><span class="si">}</span><span class="s2">] </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">alert_type</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">description</span><span class="si">}</span><span class="s2"> &quot;</span>
                <span class="sa">f</span><span class="s2">&quot;(IP: </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">source_ip</span><span class="si">}</span><span class="s2">, count: </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">count</span><span class="si">}</span><span class="s2">)&quot;</span><span class="p">)</span>


<span class="k">def</span><span class="w"> </span><span class="nf">parse_log_line</span><span class="p">(</span><span class="n">line</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Optional</span><span class="p">[</span><span class="n">LogEntry</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;단일 로그 라인을 LogEntry로 파싱합니다.&quot;&quot;&quot;</span>
    <span class="n">match</span> <span class="o">=</span> <span class="n">LOG_PATTERN</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="n">line</span><span class="o">.</span><span class="n">strip</span><span class="p">())</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">match</span><span class="p">:</span>
        <span class="k">return</span> <span class="kc">None</span>

    <span class="n">data</span> <span class="o">=</span> <span class="n">match</span><span class="o">.</span><span class="n">groupdict</span><span class="p">()</span>

    <span class="c1"># Parse timestamp</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">ts</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">strptime</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;time&#39;</span><span class="p">],</span> <span class="s1">&#39;</span><span class="si">%d</span><span class="s1">/%b/%Y:%H:%M:%S %z&#39;</span><span class="p">)</span>
    <span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span>
        <span class="n">ts</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">()</span>

    <span class="c1"># Parse size (may be &#39;-&#39;)</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">size</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;size&#39;</span><span class="p">])</span>
    <span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span>
        <span class="n">size</span> <span class="o">=</span> <span class="mi">0</span>

    <span class="k">return</span> <span class="n">LogEntry</span><span class="p">(</span>
        <span class="n">ip</span><span class="o">=</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;ip&#39;</span><span class="p">],</span>
        <span class="n">user</span><span class="o">=</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;user&#39;</span><span class="p">],</span>
        <span class="n">timestamp</span><span class="o">=</span><span class="n">ts</span><span class="p">,</span>
        <span class="n">method</span><span class="o">=</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;method&#39;</span><span class="p">],</span>
        <span class="n">path</span><span class="o">=</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;path&#39;</span><span class="p">],</span>
        <span class="n">protocol</span><span class="o">=</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;protocol&#39;</span><span class="p">],</span>
        <span class="n">status</span><span class="o">=</span><span class="nb">int</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;status&#39;</span><span class="p">]),</span>
        <span class="n">size</span><span class="o">=</span><span class="n">size</span><span class="p">,</span>
        <span class="n">referer</span><span class="o">=</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;referer&#39;</span><span class="p">],</span>
        <span class="n">user_agent</span><span class="o">=</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;agent&#39;</span><span class="p">],</span>
        <span class="n">raw</span><span class="o">=</span><span class="n">line</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
    <span class="p">)</span>


<span class="k">def</span><span class="w"> </span><span class="nf">parse_log_file</span><span class="p">(</span><span class="n">filepath</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Iterator</span><span class="p">[</span><span class="n">LogEntry</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;로그 파일의 모든 엔트리를 파싱합니다.&quot;&quot;&quot;</span>
    <span class="n">path</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="n">filepath</span><span class="p">)</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">():</span>
        <span class="k">raise</span> <span class="ne">FileNotFoundError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Log file not found: </span><span class="si">{</span><span class="n">filepath</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

    <span class="k">with</span> <span class="n">path</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="s1">&#39;r&#39;</span><span class="p">,</span> <span class="n">errors</span><span class="o">=</span><span class="s1">&#39;ignore&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">f</span><span class="p">:</span>
            <span class="n">entry</span> <span class="o">=</span> <span class="n">parse_log_line</span><span class="p">(</span><span class="n">line</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">entry</span><span class="p">:</span>
                <span class="k">yield</span> <span class="n">entry</span>


<span class="k">class</span><span class="w"> </span><span class="nc">LogAnalyzer</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;파싱된 로그 엔트리에서 보안 지표를 분석합니다.&quot;&quot;&quot;</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">entries</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="n">LogEntry</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">alerts</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="n">SecurityAlert</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">load</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">filepath</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;로그 파일을 로드하고 파싱합니다. 엔트리 개수를 반환합니다.&quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">entries</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">parse_log_file</span><span class="p">(</span><span class="n">filepath</span><span class="p">))</span>
        <span class="k">return</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">entries</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">analyze_all</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">[</span><span class="n">SecurityAlert</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;모든 분석 규칙을 실행합니다.&quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">alerts</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">detect_brute_force</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">detect_directory_traversal</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">detect_sql_injection</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">detect_scanner_activity</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">detect_error_spikes</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">detect_suspicious_user_agents</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">detect_admin_access</span><span class="p">()</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">alerts</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">detect_brute_force</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">threshold</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">10</span><span class="p">,</span>
                            <span class="n">window_minutes</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">5</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;무차별 대입 로그인 시도를 탐지합니다.&quot;&quot;&quot;</span>
        <span class="c1"># Group 401/403 responses by IP</span>
        <span class="n">failed_logins</span> <span class="o">=</span> <span class="n">defaultdict</span><span class="p">(</span><span class="nb">list</span><span class="p">)</span>

        <span class="k">for</span> <span class="n">entry</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">entries</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">entry</span><span class="o">.</span><span class="n">status</span> <span class="ow">in</span> <span class="p">(</span><span class="mi">401</span><span class="p">,</span> <span class="mi">403</span><span class="p">):</span>
                <span class="n">failed_logins</span><span class="p">[</span><span class="n">entry</span><span class="o">.</span><span class="n">ip</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">entry</span><span class="p">)</span>

        <span class="k">for</span> <span class="n">ip</span><span class="p">,</span> <span class="n">entries</span> <span class="ow">in</span> <span class="n">failed_logins</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">entries</span><span class="p">)</span> <span class="o">&gt;=</span> <span class="n">threshold</span><span class="p">:</span>
                <span class="c1"># Check if they occur within the time window</span>
                <span class="n">entries</span><span class="o">.</span><span class="n">sort</span><span class="p">(</span><span class="n">key</span><span class="o">=</span><span class="k">lambda</span> <span class="n">e</span><span class="p">:</span> <span class="n">e</span><span class="o">.</span><span class="n">timestamp</span><span class="p">)</span>
                <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">entries</span><span class="p">)</span> <span class="o">-</span> <span class="n">threshold</span> <span class="o">+</span> <span class="mi">1</span><span class="p">):</span>
                    <span class="n">window</span> <span class="o">=</span> <span class="n">entries</span><span class="p">[</span><span class="n">i</span><span class="p">:</span><span class="n">i</span> <span class="o">+</span> <span class="n">threshold</span><span class="p">]</span>
                    <span class="n">time_diff</span> <span class="o">=</span> <span class="p">(</span><span class="n">window</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">timestamp</span> <span class="o">-</span>
                                 <span class="n">window</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">timestamp</span><span class="p">)</span><span class="o">.</span><span class="n">total_seconds</span><span class="p">()</span>
                    <span class="k">if</span> <span class="n">time_diff</span> <span class="o">&lt;=</span> <span class="n">window_minutes</span> <span class="o">*</span> <span class="mi">60</span><span class="p">:</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">alerts</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">SecurityAlert</span><span class="p">(</span>
                            <span class="n">alert_type</span><span class="o">=</span><span class="s2">&quot;BRUTE_FORCE&quot;</span><span class="p">,</span>
                            <span class="n">severity</span><span class="o">=</span><span class="s2">&quot;HIGH&quot;</span><span class="p">,</span>
                            <span class="n">description</span><span class="o">=</span><span class="p">(</span>
                                <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">entries</span><span class="p">)</span><span class="si">}</span><span class="s2"> failed auth attempts from </span><span class="si">{</span><span class="n">ip</span><span class="si">}</span><span class="s2"> &quot;</span>
                                <span class="sa">f</span><span class="s2">&quot;(</span><span class="si">{</span><span class="n">threshold</span><span class="si">}</span><span class="s2">+ within </span><span class="si">{</span><span class="n">window_minutes</span><span class="si">}</span><span class="s2"> min)&quot;</span>
                            <span class="p">),</span>
                            <span class="n">source_ip</span><span class="o">=</span><span class="n">ip</span><span class="p">,</span>
                            <span class="n">count</span><span class="o">=</span><span class="nb">len</span><span class="p">(</span><span class="n">entries</span><span class="p">),</span>
                            <span class="n">sample_entries</span><span class="o">=</span><span class="p">[</span><span class="n">e</span><span class="o">.</span><span class="n">raw</span> <span class="k">for</span> <span class="n">e</span> <span class="ow">in</span> <span class="n">entries</span><span class="p">[:</span><span class="mi">3</span><span class="p">]],</span>
                        <span class="p">))</span>
                        <span class="k">break</span>  <span class="c1"># One alert per IP</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">detect_directory_traversal</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;경로 순회 시도를 탐지합니다.&quot;&quot;&quot;</span>
        <span class="n">traversal_patterns</span> <span class="o">=</span> <span class="p">[</span>
            <span class="s1">&#39;../&#39;</span><span class="p">,</span> <span class="s1">&#39;..</span><span class="se">\\</span><span class="s1">&#39;</span><span class="p">,</span> <span class="s1">&#39;</span><span class="si">%2e%2e</span><span class="s1">&#39;</span><span class="p">,</span> <span class="s1">&#39;</span><span class="si">%252e%252e</span><span class="s1">&#39;</span><span class="p">,</span>
            <span class="s1">&#39;/etc/passwd&#39;</span><span class="p">,</span> <span class="s1">&#39;/etc/shadow&#39;</span><span class="p">,</span> <span class="s1">&#39;/windows/system32&#39;</span><span class="p">,</span>
            <span class="s1">&#39;boot.ini&#39;</span><span class="p">,</span> <span class="s1">&#39;web.config&#39;</span><span class="p">,</span>
        <span class="p">]</span>

        <span class="n">traversal_attempts</span> <span class="o">=</span> <span class="n">defaultdict</span><span class="p">(</span><span class="nb">list</span><span class="p">)</span>

        <span class="k">for</span> <span class="n">entry</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">entries</span><span class="p">:</span>
            <span class="n">path_lower</span> <span class="o">=</span> <span class="n">entry</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span>
            <span class="k">for</span> <span class="n">pattern</span> <span class="ow">in</span> <span class="n">traversal_patterns</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">pattern</span> <span class="ow">in</span> <span class="n">path_lower</span><span class="p">:</span>
                    <span class="n">traversal_attempts</span><span class="p">[</span><span class="n">entry</span><span class="o">.</span><span class="n">ip</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">entry</span><span class="p">)</span>
                    <span class="k">break</span>

        <span class="k">for</span> <span class="n">ip</span><span class="p">,</span> <span class="n">entries</span> <span class="ow">in</span> <span class="n">traversal_attempts</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">alerts</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">SecurityAlert</span><span class="p">(</span>
                <span class="n">alert_type</span><span class="o">=</span><span class="s2">&quot;DIRECTORY_TRAVERSAL&quot;</span><span class="p">,</span>
                <span class="n">severity</span><span class="o">=</span><span class="s2">&quot;HIGH&quot;</span><span class="p">,</span>
                <span class="n">description</span><span class="o">=</span><span class="p">(</span>
                    <span class="sa">f</span><span class="s2">&quot;Path traversal attempt from </span><span class="si">{</span><span class="n">ip</span><span class="si">}</span><span class="s2">: &quot;</span>
                    <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">entries</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">path</span><span class="si">}</span><span class="s2">&quot;</span>
                <span class="p">),</span>
                <span class="n">source_ip</span><span class="o">=</span><span class="n">ip</span><span class="p">,</span>
                <span class="n">count</span><span class="o">=</span><span class="nb">len</span><span class="p">(</span><span class="n">entries</span><span class="p">),</span>
                <span class="n">sample_entries</span><span class="o">=</span><span class="p">[</span><span class="n">e</span><span class="o">.</span><span class="n">raw</span> <span class="k">for</span> <span class="n">e</span> <span class="ow">in</span> <span class="n">entries</span><span class="p">[:</span><span class="mi">3</span><span class="p">]],</span>
            <span class="p">))</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">detect_sql_injection</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;요청 경로에서 SQL 인젝션 시도를 탐지합니다.&quot;&quot;&quot;</span>
        <span class="n">sqli_patterns</span> <span class="o">=</span> <span class="p">[</span>
            <span class="s2">&quot;&#39; or &quot;</span><span class="p">,</span> <span class="s2">&quot;&#39; and &quot;</span><span class="p">,</span> <span class="s2">&quot;union select&quot;</span><span class="p">,</span> <span class="s2">&quot;order by&quot;</span><span class="p">,</span>
            <span class="s2">&quot;1=1&quot;</span><span class="p">,</span> <span class="s2">&quot;&#39; --&quot;</span><span class="p">,</span> <span class="s2">&quot;&#39;; drop&quot;</span><span class="p">,</span> <span class="s2">&quot;sleep(&quot;</span><span class="p">,</span>
            <span class="s2">&quot;benchmark(&quot;</span><span class="p">,</span> <span class="s2">&quot;waitfor delay&quot;</span><span class="p">,</span> <span class="s2">&quot;pg_sleep&quot;</span><span class="p">,</span>
            <span class="s2">&quot;%27&quot;</span><span class="p">,</span> <span class="s2">&quot;char(&quot;</span><span class="p">,</span> <span class="s2">&quot;concat(&quot;</span><span class="p">,</span>
        <span class="p">]</span>

        <span class="n">sqli_attempts</span> <span class="o">=</span> <span class="n">defaultdict</span><span class="p">(</span><span class="nb">list</span><span class="p">)</span>

        <span class="k">for</span> <span class="n">entry</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">entries</span><span class="p">:</span>
            <span class="n">path_lower</span> <span class="o">=</span> <span class="n">entry</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span>
            <span class="k">for</span> <span class="n">pattern</span> <span class="ow">in</span> <span class="n">sqli_patterns</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">pattern</span> <span class="ow">in</span> <span class="n">path_lower</span><span class="p">:</span>
                    <span class="n">sqli_attempts</span><span class="p">[</span><span class="n">entry</span><span class="o">.</span><span class="n">ip</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">entry</span><span class="p">)</span>
                    <span class="k">break</span>

        <span class="k">for</span> <span class="n">ip</span><span class="p">,</span> <span class="n">entries</span> <span class="ow">in</span> <span class="n">sqli_attempts</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">alerts</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">SecurityAlert</span><span class="p">(</span>
                <span class="n">alert_type</span><span class="o">=</span><span class="s2">&quot;SQL_INJECTION&quot;</span><span class="p">,</span>
                <span class="n">severity</span><span class="o">=</span><span class="s2">&quot;CRITICAL&quot;</span><span class="p">,</span>
                <span class="n">description</span><span class="o">=</span><span class="p">(</span>
                    <span class="sa">f</span><span class="s2">&quot;SQL injection attempt from </span><span class="si">{</span><span class="n">ip</span><span class="si">}</span><span class="s2">: &quot;</span>
                    <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">entries</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">path</span><span class="p">[:</span><span class="mi">100</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span>
                <span class="p">),</span>
                <span class="n">source_ip</span><span class="o">=</span><span class="n">ip</span><span class="p">,</span>
                <span class="n">count</span><span class="o">=</span><span class="nb">len</span><span class="p">(</span><span class="n">entries</span><span class="p">),</span>
                <span class="n">sample_entries</span><span class="o">=</span><span class="p">[</span><span class="n">e</span><span class="o">.</span><span class="n">raw</span> <span class="k">for</span> <span class="n">e</span> <span class="ow">in</span> <span class="n">entries</span><span class="p">[:</span><span class="mi">3</span><span class="p">]],</span>
            <span class="p">))</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">detect_scanner_activity</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;자동화된 취약점 스캐너 활동을 탐지합니다.&quot;&quot;&quot;</span>
        <span class="n">scanner_paths</span> <span class="o">=</span> <span class="p">[</span>
            <span class="s1">&#39;/.env&#39;</span><span class="p">,</span> <span class="s1">&#39;/wp-admin&#39;</span><span class="p">,</span> <span class="s1">&#39;/wp-login.php&#39;</span><span class="p">,</span>
            <span class="s1">&#39;/phpmyadmin&#39;</span><span class="p">,</span> <span class="s1">&#39;/admin&#39;</span><span class="p">,</span> <span class="s1">&#39;/administrator&#39;</span><span class="p">,</span>
            <span class="s1">&#39;/.git/config&#39;</span><span class="p">,</span> <span class="s1">&#39;/.svn/entries&#39;</span><span class="p">,</span>
            <span class="s1">&#39;/robots.txt&#39;</span><span class="p">,</span> <span class="s1">&#39;/sitemap.xml&#39;</span><span class="p">,</span>
            <span class="s1">&#39;/backup&#39;</span><span class="p">,</span> <span class="s1">&#39;/database&#39;</span><span class="p">,</span> <span class="s1">&#39;/db&#39;</span><span class="p">,</span>
            <span class="s1">&#39;/server-status&#39;</span><span class="p">,</span> <span class="s1">&#39;/server-info&#39;</span><span class="p">,</span>
            <span class="s1">&#39;/.htaccess&#39;</span><span class="p">,</span> <span class="s1">&#39;/web.config&#39;</span><span class="p">,</span>
            <span class="s1">&#39;/xmlrpc.php&#39;</span><span class="p">,</span> <span class="s1">&#39;/api/v1&#39;</span><span class="p">,</span>
        <span class="p">]</span>

        <span class="n">ip_scanner_hits</span> <span class="o">=</span> <span class="n">defaultdict</span><span class="p">(</span><span class="nb">set</span><span class="p">)</span>

        <span class="k">for</span> <span class="n">entry</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">entries</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">scanner_path</span> <span class="ow">in</span> <span class="n">scanner_paths</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">entry</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="n">scanner_path</span><span class="p">):</span>
                    <span class="n">ip_scanner_hits</span><span class="p">[</span><span class="n">entry</span><span class="o">.</span><span class="n">ip</span><span class="p">]</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">entry</span><span class="o">.</span><span class="n">path</span><span class="p">)</span>

        <span class="k">for</span> <span class="n">ip</span><span class="p">,</span> <span class="n">paths</span> <span class="ow">in</span> <span class="n">ip_scanner_hits</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">paths</span><span class="p">)</span> <span class="o">&gt;=</span> <span class="mi">5</span><span class="p">:</span>  <span class="c1"># Hit 5+ scanner paths</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">alerts</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">SecurityAlert</span><span class="p">(</span>
                    <span class="n">alert_type</span><span class="o">=</span><span class="s2">&quot;VULNERABILITY_SCANNER&quot;</span><span class="p">,</span>
                    <span class="n">severity</span><span class="o">=</span><span class="s2">&quot;MEDIUM&quot;</span><span class="p">,</span>
                    <span class="n">description</span><span class="o">=</span><span class="p">(</span>
                        <span class="sa">f</span><span class="s2">&quot;Scanner activity from </span><span class="si">{</span><span class="n">ip</span><span class="si">}</span><span class="s2">: &quot;</span>
                        <span class="sa">f</span><span class="s2">&quot;probed </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">paths</span><span class="p">)</span><span class="si">}</span><span class="s2"> common paths&quot;</span>
                    <span class="p">),</span>
                    <span class="n">source_ip</span><span class="o">=</span><span class="n">ip</span><span class="p">,</span>
                    <span class="n">count</span><span class="o">=</span><span class="nb">len</span><span class="p">(</span><span class="n">paths</span><span class="p">),</span>
                    <span class="n">sample_entries</span><span class="o">=</span><span class="nb">list</span><span class="p">(</span><span class="n">paths</span><span class="p">)[:</span><span class="mi">5</span><span class="p">],</span>
                <span class="p">))</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">detect_error_spikes</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">threshold</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">50</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;오류 응답의 비정상적인 급증을 탐지합니다.&quot;&quot;&quot;</span>
        <span class="c1"># Count 5xx errors per IP</span>
        <span class="n">error_counts</span> <span class="o">=</span> <span class="n">Counter</span><span class="p">()</span>
        <span class="k">for</span> <span class="n">entry</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">entries</span><span class="p">:</span>
            <span class="k">if</span> <span class="mi">500</span> <span class="o">&lt;=</span> <span class="n">entry</span><span class="o">.</span><span class="n">status</span> <span class="o">&lt;</span> <span class="mi">600</span><span class="p">:</span>
                <span class="n">error_counts</span><span class="p">[</span><span class="n">entry</span><span class="o">.</span><span class="n">ip</span><span class="p">]</span> <span class="o">+=</span> <span class="mi">1</span>

        <span class="k">for</span> <span class="n">ip</span><span class="p">,</span> <span class="n">count</span> <span class="ow">in</span> <span class="n">error_counts</span><span class="o">.</span><span class="n">most_common</span><span class="p">():</span>
            <span class="k">if</span> <span class="n">count</span> <span class="o">&gt;=</span> <span class="n">threshold</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">alerts</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">SecurityAlert</span><span class="p">(</span>
                    <span class="n">alert_type</span><span class="o">=</span><span class="s2">&quot;ERROR_SPIKE&quot;</span><span class="p">,</span>
                    <span class="n">severity</span><span class="o">=</span><span class="s2">&quot;MEDIUM&quot;</span><span class="p">,</span>
                    <span class="n">description</span><span class="o">=</span><span class="p">(</span>
                        <span class="sa">f</span><span class="s2">&quot;High error rate from </span><span class="si">{</span><span class="n">ip</span><span class="si">}</span><span class="s2">: &quot;</span>
                        <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">count</span><span class="si">}</span><span class="s2"> server errors (5xx)&quot;</span>
                    <span class="p">),</span>
                    <span class="n">source_ip</span><span class="o">=</span><span class="n">ip</span><span class="p">,</span>
                    <span class="n">count</span><span class="o">=</span><span class="n">count</span><span class="p">,</span>
                <span class="p">))</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">detect_suspicious_user_agents</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;의심스러운 user agent를 가진 요청을 탐지합니다.&quot;&quot;&quot;</span>
        <span class="n">suspicious_agents</span> <span class="o">=</span> <span class="p">[</span>
            <span class="s1">&#39;sqlmap&#39;</span><span class="p">,</span> <span class="s1">&#39;nikto&#39;</span><span class="p">,</span> <span class="s1">&#39;nmap&#39;</span><span class="p">,</span> <span class="s1">&#39;masscan&#39;</span><span class="p">,</span>
            <span class="s1">&#39;dirbuster&#39;</span><span class="p">,</span> <span class="s1">&#39;gobuster&#39;</span><span class="p">,</span> <span class="s1">&#39;wfuzz&#39;</span><span class="p">,</span>
            <span class="s1">&#39;burpsuite&#39;</span><span class="p">,</span> <span class="s1">&#39;acunetix&#39;</span><span class="p">,</span> <span class="s1">&#39;nessus&#39;</span><span class="p">,</span>
            <span class="s1">&#39;python-requests&#39;</span><span class="p">,</span>  <span class="c1"># May be legitimate, but flag</span>
            <span class="s1">&#39;curl/&#39;</span><span class="p">,</span>            <span class="c1"># May be legitimate, but flag</span>
        <span class="p">]</span>

        <span class="k">for</span> <span class="n">entry</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">entries</span><span class="p">:</span>
            <span class="n">agent_lower</span> <span class="o">=</span> <span class="n">entry</span><span class="o">.</span><span class="n">user_agent</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span>
            <span class="k">for</span> <span class="n">sus_agent</span> <span class="ow">in</span> <span class="n">suspicious_agents</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">sus_agent</span> <span class="ow">in</span> <span class="n">agent_lower</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">alerts</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">SecurityAlert</span><span class="p">(</span>
                        <span class="n">alert_type</span><span class="o">=</span><span class="s2">&quot;SUSPICIOUS_USER_AGENT&quot;</span><span class="p">,</span>
                        <span class="n">severity</span><span class="o">=</span><span class="s2">&quot;MEDIUM&quot;</span><span class="p">,</span>
                        <span class="n">description</span><span class="o">=</span><span class="p">(</span>
                            <span class="sa">f</span><span class="s2">&quot;Suspicious user agent from </span><span class="si">{</span><span class="n">entry</span><span class="o">.</span><span class="n">ip</span><span class="si">}</span><span class="s2">: &quot;</span>
                            <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">entry</span><span class="o">.</span><span class="n">user_agent</span><span class="p">[:</span><span class="mi">80</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span>
                        <span class="p">),</span>
                        <span class="n">source_ip</span><span class="o">=</span><span class="n">entry</span><span class="o">.</span><span class="n">ip</span><span class="p">,</span>
                        <span class="n">count</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
                    <span class="p">))</span>
                    <span class="k">break</span>  <span class="c1"># One alert per entry</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">detect_admin_access</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;관리 엔드포인트에 대한 접근을 탐지합니다.&quot;&quot;&quot;</span>
        <span class="n">admin_paths</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;/admin&#39;</span><span class="p">,</span> <span class="s1">&#39;/dashboard&#39;</span><span class="p">,</span> <span class="s1">&#39;/manage&#39;</span><span class="p">,</span> <span class="s1">&#39;/api/admin&#39;</span><span class="p">]</span>
        <span class="n">admin_access</span> <span class="o">=</span> <span class="n">defaultdict</span><span class="p">(</span><span class="nb">list</span><span class="p">)</span>

        <span class="k">for</span> <span class="n">entry</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">entries</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">admin_path</span> <span class="ow">in</span> <span class="n">admin_paths</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">entry</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="n">admin_path</span><span class="p">):</span>
                    <span class="k">if</span> <span class="n">entry</span><span class="o">.</span><span class="n">status</span> <span class="o">==</span> <span class="mi">200</span><span class="p">:</span>
                        <span class="n">admin_access</span><span class="p">[</span><span class="n">entry</span><span class="o">.</span><span class="n">ip</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">entry</span><span class="p">)</span>

        <span class="k">for</span> <span class="n">ip</span><span class="p">,</span> <span class="n">entries</span> <span class="ow">in</span> <span class="n">admin_access</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">alerts</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">SecurityAlert</span><span class="p">(</span>
                <span class="n">alert_type</span><span class="o">=</span><span class="s2">&quot;ADMIN_ACCESS&quot;</span><span class="p">,</span>
                <span class="n">severity</span><span class="o">=</span><span class="s2">&quot;LOW&quot;</span><span class="p">,</span>
                <span class="n">description</span><span class="o">=</span><span class="p">(</span>
                    <span class="sa">f</span><span class="s2">&quot;Successful admin access from </span><span class="si">{</span><span class="n">ip</span><span class="si">}</span><span class="s2">: &quot;</span>
                    <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">entries</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">path</span><span class="si">}</span><span class="s2">&quot;</span>
                <span class="p">),</span>
                <span class="n">source_ip</span><span class="o">=</span><span class="n">ip</span><span class="p">,</span>
                <span class="n">count</span><span class="o">=</span><span class="nb">len</span><span class="p">(</span><span class="n">entries</span><span class="p">),</span>
            <span class="p">))</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">print_report</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;형식화된 분석 보고서를 출력합니다.&quot;&quot;&quot;</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;=&quot;</span> <span class="o">*</span> <span class="mi">65</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;  LOG ANALYSIS SECURITY REPORT&quot;</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;=&quot;</span> <span class="o">*</span> <span class="mi">65</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  Total entries analyzed: </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">entries</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  Total alerts: </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">alerts</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

        <span class="n">severity_order</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;CRITICAL&#39;</span><span class="p">,</span> <span class="s1">&#39;HIGH&#39;</span><span class="p">,</span> <span class="s1">&#39;MEDIUM&#39;</span><span class="p">,</span> <span class="s1">&#39;LOW&#39;</span><span class="p">]</span>
        <span class="k">for</span> <span class="n">severity</span> <span class="ow">in</span> <span class="n">severity_order</span><span class="p">:</span>
            <span class="n">alerts</span> <span class="o">=</span> <span class="p">[</span><span class="n">a</span> <span class="k">for</span> <span class="n">a</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">alerts</span> <span class="k">if</span> <span class="n">a</span><span class="o">.</span><span class="n">severity</span> <span class="o">==</span> <span class="n">severity</span><span class="p">]</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">alerts</span><span class="p">:</span>
                <span class="k">continue</span>

            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="se">\n</span><span class="si">{</span><span class="s1">&#39;─&#39;</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="mi">65</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  </span><span class="si">{</span><span class="n">severity</span><span class="si">}</span><span class="s2"> (</span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">alerts</span><span class="p">)</span><span class="si">}</span><span class="s2">)&quot;</span><span class="p">)</span>
            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="s1">&#39;─&#39;</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="mi">65</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

            <span class="k">for</span> <span class="n">alert</span> <span class="ow">in</span> <span class="n">alerts</span><span class="p">:</span>
                <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">  [</span><span class="si">{</span><span class="n">alert</span><span class="o">.</span><span class="n">alert_type</span><span class="si">}</span><span class="s2">]&quot;</span><span class="p">)</span>
                <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  </span><span class="si">{</span><span class="n">alert</span><span class="o">.</span><span class="n">description</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">alert</span><span class="o">.</span><span class="n">sample_entries</span><span class="p">:</span>
                    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  Samples:&quot;</span><span class="p">)</span>
                    <span class="k">for</span> <span class="n">sample</span> <span class="ow">in</span> <span class="n">alert</span><span class="o">.</span><span class="n">sample_entries</span><span class="p">[:</span><span class="mi">2</span><span class="p">]:</span>
                        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;    </span><span class="si">{</span><span class="nb">str</span><span class="p">(</span><span class="n">sample</span><span class="p">)[:</span><span class="mi">100</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

        <span class="c1"># Summary statistics</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="se">\n</span><span class="si">{</span><span class="s1">&#39;─&#39;</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="mi">65</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;  TOP SOURCE IPs&quot;</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="s1">&#39;─&#39;</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="mi">65</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="n">ip_alert_count</span> <span class="o">=</span> <span class="n">Counter</span><span class="p">()</span>
        <span class="k">for</span> <span class="n">alert</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">alerts</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">alert</span><span class="o">.</span><span class="n">source_ip</span><span class="p">:</span>
                <span class="n">ip_alert_count</span><span class="p">[</span><span class="n">alert</span><span class="o">.</span><span class="n">source_ip</span><span class="p">]</span> <span class="o">+=</span> <span class="mi">1</span>
        <span class="k">for</span> <span class="n">ip</span><span class="p">,</span> <span class="n">count</span> <span class="ow">in</span> <span class="n">ip_alert_count</span><span class="o">.</span><span class="n">most_common</span><span class="p">(</span><span class="mi">10</span><span class="p">):</span>
            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  </span><span class="si">{</span><span class="n">ip</span><span class="si">:</span><span class="s2">20s</span><span class="si">}</span><span class="s2"> </span><span class="si">{</span><span class="n">count</span><span class="si">}</span><span class="s2"> alerts&quot;</span><span class="p">)</span>

        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="se">\n</span><span class="si">{</span><span class="s1">&#39;=&#39;</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="mi">65</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>


<span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s2">&quot;__main__&quot;</span><span class="p">:</span>
    <span class="kn">import</span><span class="w"> </span><span class="nn">sys</span>

    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">sys</span><span class="o">.</span><span class="n">argv</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">2</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Usage: python log_parser.py &lt;access.log&gt;&quot;</span><span class="p">)</span>
        <span class="n">sys</span><span class="o">.</span><span class="n">exit</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>

    <span class="n">analyzer</span> <span class="o">=</span> <span class="n">LogAnalyzer</span><span class="p">()</span>
    <span class="n">count</span> <span class="o">=</span> <span class="n">analyzer</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">sys</span><span class="o">.</span><span class="n">argv</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;[*] Loaded </span><span class="si">{</span><span class="n">count</span><span class="si">}</span><span class="s2"> log entries&quot;</span><span class="p">)</span>

    <span class="n">alerts</span> <span class="o">=</span> <span class="n">analyzer</span><span class="o">.</span><span class="n">analyze_all</span><span class="p">()</span>
    <span class="n">analyzer</span><span class="o">.</span><span class="n">print_report</span><span class="p">()</span>
</code></pre></div>

<h3 id="42-ioc">4.2 IOC 탐지 스크립트<a class="header-link" href="#42-ioc" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">ioc_detector.py - 침해 지표(IOC) 탐지.</span>
<span class="sd">파일, 네트워크 연결, 시스템 상태에서 알려진 IOC를 확인합니다.</span>
<span class="sd">&quot;&quot;&quot;</span>

<span class="kn">import</span><span class="w"> </span><span class="nn">hashlib</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">json</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">os</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">re</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">socket</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">subprocess</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">dataclasses</span><span class="w"> </span><span class="kn">import</span> <span class="n">dataclass</span><span class="p">,</span> <span class="n">field</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">datetime</span><span class="w"> </span><span class="kn">import</span> <span class="n">datetime</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">pathlib</span><span class="w"> </span><span class="kn">import</span> <span class="n">Path</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">typing</span><span class="w"> </span><span class="kn">import</span> <span class="n">Optional</span>


<span class="nd">@dataclass</span>
<span class="k">class</span><span class="w"> </span><span class="nc">IOC</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;침해 지표.&quot;&quot;&quot;</span>
    <span class="n">ioc_type</span><span class="p">:</span> <span class="nb">str</span>       <span class="c1"># IP, DOMAIN, HASH_MD5, HASH_SHA256, FILENAME, REGEX</span>
    <span class="n">value</span><span class="p">:</span> <span class="nb">str</span>
    <span class="n">description</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
    <span class="n">source</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>    <span class="c1"># Where this IOC came from</span>
    <span class="n">severity</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;MEDIUM&quot;</span>


<span class="nd">@dataclass</span>
<span class="k">class</span><span class="w"> </span><span class="nc">IOCMatch</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;스캔 중 발견된 매칭.&quot;&quot;&quot;</span>
    <span class="n">ioc</span><span class="p">:</span> <span class="n">IOC</span>
    <span class="n">location</span><span class="p">:</span> <span class="nb">str</span>       <span class="c1"># Where the match was found</span>
    <span class="n">context</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>   <span class="c1"># Additional context</span>
    <span class="n">timestamp</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">__post_init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">timestamp</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">timestamp</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">()</span><span class="o">.</span><span class="n">isoformat</span><span class="p">()</span>


<span class="k">class</span><span class="w"> </span><span class="nc">IOCDatabase</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    간단한 IOC 데이터베이스.</span>
<span class="sd">    프로덕션에서는 STIX/TAXII 또는 적절한 위협 인텔리전스 플랫폼을 사용하십시오.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">iocs</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="n">IOC</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">load_from_json</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">filepath</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;JSON 파일에서 IOC를 로드합니다.&quot;&quot;&quot;</span>
        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">filepath</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
            <span class="n">data</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">f</span><span class="p">)</span>

        <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;iocs&#39;</span><span class="p">,</span> <span class="p">[]):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">iocs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">IOC</span><span class="p">(</span>
                <span class="n">ioc_type</span><span class="o">=</span><span class="n">item</span><span class="p">[</span><span class="s1">&#39;type&#39;</span><span class="p">],</span>
                <span class="n">value</span><span class="o">=</span><span class="n">item</span><span class="p">[</span><span class="s1">&#39;value&#39;</span><span class="p">],</span>
                <span class="n">description</span><span class="o">=</span><span class="n">item</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;description&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">),</span>
                <span class="n">source</span><span class="o">=</span><span class="n">item</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;source&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">),</span>
                <span class="n">severity</span><span class="o">=</span><span class="n">item</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;severity&#39;</span><span class="p">,</span> <span class="s1">&#39;MEDIUM&#39;</span><span class="p">),</span>
            <span class="p">))</span>

        <span class="k">return</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">iocs</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">load_sample_iocs</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;데모용 샘플 IOC를 로드합니다.&quot;&quot;&quot;</span>
        <span class="c1"># These are FAKE IOCs for educational purposes</span>
        <span class="n">sample_iocs</span> <span class="o">=</span> <span class="p">[</span>
            <span class="n">IOC</span><span class="p">(</span><span class="s2">&quot;IP&quot;</span><span class="p">,</span> <span class="s2">&quot;198.51.100.1&quot;</span><span class="p">,</span> <span class="s2">&quot;Known C2 server&quot;</span><span class="p">,</span> <span class="s2">&quot;sample&quot;</span><span class="p">,</span> <span class="s2">&quot;HIGH&quot;</span><span class="p">),</span>
            <span class="n">IOC</span><span class="p">(</span><span class="s2">&quot;IP&quot;</span><span class="p">,</span> <span class="s2">&quot;203.0.113.50&quot;</span><span class="p">,</span> <span class="s2">&quot;Phishing infrastructure&quot;</span><span class="p">,</span> <span class="s2">&quot;sample&quot;</span><span class="p">,</span> <span class="s2">&quot;HIGH&quot;</span><span class="p">),</span>
            <span class="n">IOC</span><span class="p">(</span><span class="s2">&quot;DOMAIN&quot;</span><span class="p">,</span> <span class="s2">&quot;evil-malware.example.com&quot;</span><span class="p">,</span> <span class="s2">&quot;Malware C2&quot;</span><span class="p">,</span> <span class="s2">&quot;sample&quot;</span><span class="p">,</span> <span class="s2">&quot;CRITICAL&quot;</span><span class="p">),</span>
            <span class="n">IOC</span><span class="p">(</span><span class="s2">&quot;DOMAIN&quot;</span><span class="p">,</span> <span class="s2">&quot;phish.example.net&quot;</span><span class="p">,</span> <span class="s2">&quot;Phishing domain&quot;</span><span class="p">,</span> <span class="s2">&quot;sample&quot;</span><span class="p">,</span> <span class="s2">&quot;HIGH&quot;</span><span class="p">),</span>
            <span class="n">IOC</span><span class="p">(</span><span class="s2">&quot;HASH_SHA256&quot;</span><span class="p">,</span>
                <span class="s2">&quot;e3b0c44298fc1c149afbf4c8996fb92427ae41e4649b934ca495991b7852b855&quot;</span><span class="p">,</span>
                <span class="s2">&quot;Known malware hash (empty file SHA256)&quot;</span><span class="p">,</span> <span class="s2">&quot;sample&quot;</span><span class="p">,</span> <span class="s2">&quot;MEDIUM&quot;</span><span class="p">),</span>
            <span class="n">IOC</span><span class="p">(</span><span class="s2">&quot;FILENAME&quot;</span><span class="p">,</span> <span class="s2">&quot;mimikatz.exe&quot;</span><span class="p">,</span> <span class="s2">&quot;Credential dumping tool&quot;</span><span class="p">,</span> <span class="s2">&quot;sample&quot;</span><span class="p">,</span> <span class="s2">&quot;CRITICAL&quot;</span><span class="p">),</span>
            <span class="n">IOC</span><span class="p">(</span><span class="s2">&quot;FILENAME&quot;</span><span class="p">,</span> <span class="s2">&quot;nc.exe&quot;</span><span class="p">,</span> <span class="s2">&quot;Netcat - possible backdoor&quot;</span><span class="p">,</span> <span class="s2">&quot;sample&quot;</span><span class="p">,</span> <span class="s2">&quot;HIGH&quot;</span><span class="p">),</span>
            <span class="n">IOC</span><span class="p">(</span><span class="s2">&quot;REGEX&quot;</span><span class="p">,</span> <span class="sa">r</span><span class="s2">&quot;(?:eval|exec)\s*\(\s*base64&quot;</span><span class="p">,</span> <span class="s2">&quot;Obfuscated code execution&quot;</span><span class="p">,</span>
                <span class="s2">&quot;sample&quot;</span><span class="p">,</span> <span class="s2">&quot;HIGH&quot;</span><span class="p">),</span>
        <span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">iocs</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">sample_iocs</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">get_by_type</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">ioc_type</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">[</span><span class="n">IOC</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;특정 유형의 모든 IOC를 가져옵니다.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="p">[</span><span class="n">ioc</span> <span class="k">for</span> <span class="n">ioc</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">iocs</span> <span class="k">if</span> <span class="n">ioc</span><span class="o">.</span><span class="n">ioc_type</span> <span class="o">==</span> <span class="n">ioc_type</span><span class="p">]</span>


<span class="k">class</span><span class="w"> </span><span class="nc">IOCScanner</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;시스템에서 침해 지표를 스캔합니다.&quot;&quot;&quot;</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">ioc_db</span><span class="p">:</span> <span class="n">IOCDatabase</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ioc_db</span> <span class="o">=</span> <span class="n">ioc_db</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">matches</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="n">IOCMatch</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">scan_all</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">scan_dir</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">[</span><span class="n">IOCMatch</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;모든 IOC 스캔을 실행합니다.&quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">matches</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;[*] Starting IOC scan...&quot;</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">scan_file_hashes</span><span class="p">(</span><span class="n">scan_dir</span> <span class="ow">or</span> <span class="s2">&quot;/tmp&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">scan_file_names</span><span class="p">(</span><span class="n">scan_dir</span> <span class="ow">or</span> <span class="s2">&quot;/tmp&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">scan_network_connections</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">scan_dns_cache</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">scan_file_contents</span><span class="p">(</span><span class="n">scan_dir</span> <span class="ow">or</span> <span class="s2">&quot;/tmp&quot;</span><span class="p">)</span>

        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">matches</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">scan_file_hashes</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">directory</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;알려진 악성코드 해시와 파일 해시를 비교합니다.&quot;&quot;&quot;</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;[*] Scanning file hashes in </span><span class="si">{</span><span class="n">directory</span><span class="si">}</span><span class="s2">...&quot;</span><span class="p">)</span>
        <span class="n">hash_iocs</span> <span class="o">=</span> <span class="p">{</span>
            <span class="n">ioc</span><span class="o">.</span><span class="n">value</span><span class="o">.</span><span class="n">lower</span><span class="p">():</span> <span class="n">ioc</span>
            <span class="k">for</span> <span class="n">ioc</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">ioc_db</span><span class="o">.</span><span class="n">get_by_type</span><span class="p">(</span><span class="s2">&quot;HASH_SHA256&quot;</span><span class="p">)</span>
        <span class="p">}</span>
        <span class="n">md5_iocs</span> <span class="o">=</span> <span class="p">{</span>
            <span class="n">ioc</span><span class="o">.</span><span class="n">value</span><span class="o">.</span><span class="n">lower</span><span class="p">():</span> <span class="n">ioc</span>
            <span class="k">for</span> <span class="n">ioc</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">ioc_db</span><span class="o">.</span><span class="n">get_by_type</span><span class="p">(</span><span class="s2">&quot;HASH_MD5&quot;</span><span class="p">)</span>
        <span class="p">}</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">hash_iocs</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">md5_iocs</span><span class="p">:</span>
            <span class="k">return</span>

        <span class="n">scan_path</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="n">directory</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">filepath</span> <span class="ow">in</span> <span class="n">scan_path</span><span class="o">.</span><span class="n">rglob</span><span class="p">(</span><span class="s2">&quot;*&quot;</span><span class="p">):</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">filepath</span><span class="o">.</span><span class="n">is_file</span><span class="p">():</span>
                <span class="k">continue</span>
            <span class="c1"># Skip very large files (&gt;100MB)</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">filepath</span><span class="o">.</span><span class="n">stat</span><span class="p">()</span><span class="o">.</span><span class="n">st_size</span> <span class="o">&gt;</span> <span class="mi">100</span> <span class="o">*</span> <span class="mi">1024</span> <span class="o">*</span> <span class="mi">1024</span><span class="p">:</span>
                    <span class="k">continue</span>
            <span class="k">except</span> <span class="ne">OSError</span><span class="p">:</span>
                <span class="k">continue</span>

            <span class="k">try</span><span class="p">:</span>
                <span class="n">content</span> <span class="o">=</span> <span class="n">filepath</span><span class="o">.</span><span class="n">read_bytes</span><span class="p">()</span>
                <span class="n">sha256</span> <span class="o">=</span> <span class="n">hashlib</span><span class="o">.</span><span class="n">sha256</span><span class="p">(</span><span class="n">content</span><span class="p">)</span><span class="o">.</span><span class="n">hexdigest</span><span class="p">()</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span>
                <span class="n">md5</span> <span class="o">=</span> <span class="n">hashlib</span><span class="o">.</span><span class="n">md5</span><span class="p">(</span><span class="n">content</span><span class="p">)</span><span class="o">.</span><span class="n">hexdigest</span><span class="p">()</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span>

                <span class="k">if</span> <span class="n">sha256</span> <span class="ow">in</span> <span class="n">hash_iocs</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">matches</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">IOCMatch</span><span class="p">(</span>
                        <span class="n">ioc</span><span class="o">=</span><span class="n">hash_iocs</span><span class="p">[</span><span class="n">sha256</span><span class="p">],</span>
                        <span class="n">location</span><span class="o">=</span><span class="nb">str</span><span class="p">(</span><span class="n">filepath</span><span class="p">),</span>
                        <span class="n">context</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;SHA256: </span><span class="si">{</span><span class="n">sha256</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
                    <span class="p">))</span>

                <span class="k">if</span> <span class="n">md5</span> <span class="ow">in</span> <span class="n">md5_iocs</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">matches</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">IOCMatch</span><span class="p">(</span>
                        <span class="n">ioc</span><span class="o">=</span><span class="n">md5_iocs</span><span class="p">[</span><span class="n">md5</span><span class="p">],</span>
                        <span class="n">location</span><span class="o">=</span><span class="nb">str</span><span class="p">(</span><span class="n">filepath</span><span class="p">),</span>
                        <span class="n">context</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;MD5: </span><span class="si">{</span><span class="n">md5</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
                    <span class="p">))</span>

            <span class="k">except</span> <span class="p">(</span><span class="ne">PermissionError</span><span class="p">,</span> <span class="ne">OSError</span><span class="p">):</span>
                <span class="k">pass</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">scan_file_names</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">directory</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;알려진 악성 이름을 가진 파일을 확인합니다.&quot;&quot;&quot;</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;[*] Scanning file names in </span><span class="si">{</span><span class="n">directory</span><span class="si">}</span><span class="s2">...&quot;</span><span class="p">)</span>
        <span class="n">name_iocs</span> <span class="o">=</span> <span class="p">{</span>
            <span class="n">ioc</span><span class="o">.</span><span class="n">value</span><span class="o">.</span><span class="n">lower</span><span class="p">():</span> <span class="n">ioc</span>
            <span class="k">for</span> <span class="n">ioc</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">ioc_db</span><span class="o">.</span><span class="n">get_by_type</span><span class="p">(</span><span class="s2">&quot;FILENAME&quot;</span><span class="p">)</span>
        <span class="p">}</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">name_iocs</span><span class="p">:</span>
            <span class="k">return</span>

        <span class="n">scan_path</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="n">directory</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">filepath</span> <span class="ow">in</span> <span class="n">scan_path</span><span class="o">.</span><span class="n">rglob</span><span class="p">(</span><span class="s2">&quot;*&quot;</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">filepath</span><span class="o">.</span><span class="n">name</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="ow">in</span> <span class="n">name_iocs</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">matches</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">IOCMatch</span><span class="p">(</span>
                    <span class="n">ioc</span><span class="o">=</span><span class="n">name_iocs</span><span class="p">[</span><span class="n">filepath</span><span class="o">.</span><span class="n">name</span><span class="o">.</span><span class="n">lower</span><span class="p">()],</span>
                    <span class="n">location</span><span class="o">=</span><span class="nb">str</span><span class="p">(</span><span class="n">filepath</span><span class="p">),</span>
                    <span class="n">context</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;Filename match: </span><span class="si">{</span><span class="n">filepath</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
                <span class="p">))</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">scan_network_connections</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;알려진 악성 IP와 활성 네트워크 연결을 비교합니다.&quot;&quot;&quot;</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;[*] Scanning network connections...&quot;</span><span class="p">)</span>
        <span class="n">ip_iocs</span> <span class="o">=</span> <span class="p">{</span>
            <span class="n">ioc</span><span class="o">.</span><span class="n">value</span><span class="p">:</span> <span class="n">ioc</span>
            <span class="k">for</span> <span class="n">ioc</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">ioc_db</span><span class="o">.</span><span class="n">get_by_type</span><span class="p">(</span><span class="s2">&quot;IP&quot;</span><span class="p">)</span>
        <span class="p">}</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">ip_iocs</span><span class="p">:</span>
            <span class="k">return</span>

        <span class="k">try</span><span class="p">:</span>
            <span class="c1"># Use netstat or ss to get connections</span>
            <span class="n">result</span> <span class="o">=</span> <span class="n">subprocess</span><span class="o">.</span><span class="n">run</span><span class="p">(</span>
                <span class="p">[</span><span class="s2">&quot;netstat&quot;</span><span class="p">,</span> <span class="s2">&quot;-an&quot;</span><span class="p">],</span>
                <span class="n">capture_output</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">text</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">timeout</span><span class="o">=</span><span class="mi">10</span>
            <span class="p">)</span>

            <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">result</span><span class="o">.</span><span class="n">stdout</span><span class="o">.</span><span class="n">splitlines</span><span class="p">():</span>
                <span class="k">for</span> <span class="n">bad_ip</span> <span class="ow">in</span> <span class="n">ip_iocs</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">bad_ip</span> <span class="ow">in</span> <span class="n">line</span><span class="p">:</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">matches</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">IOCMatch</span><span class="p">(</span>
                            <span class="n">ioc</span><span class="o">=</span><span class="n">ip_iocs</span><span class="p">[</span><span class="n">bad_ip</span><span class="p">],</span>
                            <span class="n">location</span><span class="o">=</span><span class="s2">&quot;Active network connection&quot;</span><span class="p">,</span>
                            <span class="n">context</span><span class="o">=</span><span class="n">line</span><span class="o">.</span><span class="n">strip</span><span class="p">(),</span>
                        <span class="p">))</span>

        <span class="k">except</span> <span class="p">(</span><span class="ne">FileNotFoundError</span><span class="p">,</span> <span class="n">subprocess</span><span class="o">.</span><span class="n">TimeoutExpired</span><span class="p">):</span>
            <span class="c1"># Try ss as fallback</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">result</span> <span class="o">=</span> <span class="n">subprocess</span><span class="o">.</span><span class="n">run</span><span class="p">(</span>
                    <span class="p">[</span><span class="s2">&quot;ss&quot;</span><span class="p">,</span> <span class="s2">&quot;-an&quot;</span><span class="p">],</span>
                    <span class="n">capture_output</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">text</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">timeout</span><span class="o">=</span><span class="mi">10</span>
                <span class="p">)</span>
                <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">result</span><span class="o">.</span><span class="n">stdout</span><span class="o">.</span><span class="n">splitlines</span><span class="p">():</span>
                    <span class="k">for</span> <span class="n">bad_ip</span> <span class="ow">in</span> <span class="n">ip_iocs</span><span class="p">:</span>
                        <span class="k">if</span> <span class="n">bad_ip</span> <span class="ow">in</span> <span class="n">line</span><span class="p">:</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">matches</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">IOCMatch</span><span class="p">(</span>
                                <span class="n">ioc</span><span class="o">=</span><span class="n">ip_iocs</span><span class="p">[</span><span class="n">bad_ip</span><span class="p">],</span>
                                <span class="n">location</span><span class="o">=</span><span class="s2">&quot;Active network connection&quot;</span><span class="p">,</span>
                                <span class="n">context</span><span class="o">=</span><span class="n">line</span><span class="o">.</span><span class="n">strip</span><span class="p">(),</span>
                            <span class="p">))</span>
            <span class="k">except</span> <span class="p">(</span><span class="ne">FileNotFoundError</span><span class="p">,</span> <span class="n">subprocess</span><span class="o">.</span><span class="n">TimeoutExpired</span><span class="p">):</span>
                <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;    [!] Could not check network connections&quot;</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">scan_dns_cache</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;알려진 악성 도메인에 대한 DNS 해석을 확인합니다.&quot;&quot;&quot;</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;[*] Checking known malicious domains...&quot;</span><span class="p">)</span>
        <span class="n">domain_iocs</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ioc_db</span><span class="o">.</span><span class="n">get_by_type</span><span class="p">(</span><span class="s2">&quot;DOMAIN&quot;</span><span class="p">)</span>

        <span class="k">for</span> <span class="n">ioc</span> <span class="ow">in</span> <span class="n">domain_iocs</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="c1"># Try to resolve the domain - if it resolves from cache</span>
                <span class="c1"># the system may have contacted it</span>
                <span class="n">result</span> <span class="o">=</span> <span class="n">socket</span><span class="o">.</span><span class="n">getaddrinfo</span><span class="p">(</span>
                    <span class="n">ioc</span><span class="o">.</span><span class="n">value</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="n">socket</span><span class="o">.</span><span class="n">AF_INET</span><span class="p">,</span>
                    <span class="n">socket</span><span class="o">.</span><span class="n">SOCK_STREAM</span>
                <span class="p">)</span>
                <span class="k">if</span> <span class="n">result</span><span class="p">:</span>
                    <span class="n">ip</span> <span class="o">=</span> <span class="n">result</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">4</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">matches</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">IOCMatch</span><span class="p">(</span>
                        <span class="n">ioc</span><span class="o">=</span><span class="n">ioc</span><span class="p">,</span>
                        <span class="n">location</span><span class="o">=</span><span class="s2">&quot;DNS resolution&quot;</span><span class="p">,</span>
                        <span class="n">context</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">ioc</span><span class="o">.</span><span class="n">value</span><span class="si">}</span><span class="s2"> resolves to </span><span class="si">{</span><span class="n">ip</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
                    <span class="p">))</span>
            <span class="k">except</span> <span class="p">(</span><span class="n">socket</span><span class="o">.</span><span class="n">gaierror</span><span class="p">,</span> <span class="n">socket</span><span class="o">.</span><span class="n">timeout</span><span class="p">,</span> <span class="ne">OSError</span><span class="p">):</span>
                <span class="k">pass</span>  <span class="c1"># Domain doesn&#39;t resolve - good</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">scan_file_contents</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">directory</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
                           <span class="n">extensions</span><span class="p">:</span> <span class="nb">tuple</span> <span class="o">=</span> <span class="p">(</span><span class="s1">&#39;.py&#39;</span><span class="p">,</span> <span class="s1">&#39;.js&#39;</span><span class="p">,</span> <span class="s1">&#39;.sh&#39;</span><span class="p">,</span> <span class="s1">&#39;.php&#39;</span><span class="p">,</span>
                                                <span class="s1">&#39;.rb&#39;</span><span class="p">,</span> <span class="s1">&#39;.pl&#39;</span><span class="p">,</span> <span class="s1">&#39;.ps1&#39;</span><span class="p">))</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;IOC 패턴(정규식)에 대해 파일 내용을 스캔합니다.&quot;&quot;&quot;</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;[*] Scanning file contents in </span><span class="si">{</span><span class="n">directory</span><span class="si">}</span><span class="s2">...&quot;</span><span class="p">)</span>
        <span class="n">regex_iocs</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ioc_db</span><span class="o">.</span><span class="n">get_by_type</span><span class="p">(</span><span class="s2">&quot;REGEX&quot;</span><span class="p">)</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">regex_iocs</span><span class="p">:</span>
            <span class="k">return</span>

        <span class="n">compiled_patterns</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">ioc</span> <span class="ow">in</span> <span class="n">regex_iocs</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">compiled_patterns</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="n">ioc</span><span class="o">.</span><span class="n">value</span><span class="p">,</span> <span class="n">re</span><span class="o">.</span><span class="n">IGNORECASE</span><span class="p">),</span> <span class="n">ioc</span><span class="p">))</span>
            <span class="k">except</span> <span class="n">re</span><span class="o">.</span><span class="n">error</span><span class="p">:</span>
                <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;    [!] Invalid regex pattern: </span><span class="si">{</span><span class="n">ioc</span><span class="o">.</span><span class="n">value</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

        <span class="n">scan_path</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="n">directory</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">filepath</span> <span class="ow">in</span> <span class="n">scan_path</span><span class="o">.</span><span class="n">rglob</span><span class="p">(</span><span class="s2">&quot;*&quot;</span><span class="p">):</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">filepath</span><span class="o">.</span><span class="n">is_file</span><span class="p">():</span>
                <span class="k">continue</span>
            <span class="k">if</span> <span class="n">filepath</span><span class="o">.</span><span class="n">suffix</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">extensions</span><span class="p">:</span>
                <span class="k">continue</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">filepath</span><span class="o">.</span><span class="n">stat</span><span class="p">()</span><span class="o">.</span><span class="n">st_size</span> <span class="o">&gt;</span> <span class="mi">10</span> <span class="o">*</span> <span class="mi">1024</span> <span class="o">*</span> <span class="mi">1024</span><span class="p">:</span>  <span class="c1"># Skip &gt;10MB</span>
                    <span class="k">continue</span>
                <span class="n">content</span> <span class="o">=</span> <span class="n">filepath</span><span class="o">.</span><span class="n">read_text</span><span class="p">(</span><span class="n">errors</span><span class="o">=</span><span class="s1">&#39;ignore&#39;</span><span class="p">)</span>

                <span class="k">for</span> <span class="n">pattern</span><span class="p">,</span> <span class="n">ioc</span> <span class="ow">in</span> <span class="n">compiled_patterns</span><span class="p">:</span>
                    <span class="n">matches</span> <span class="o">=</span> <span class="n">pattern</span><span class="o">.</span><span class="n">findall</span><span class="p">(</span><span class="n">content</span><span class="p">)</span>
                    <span class="k">if</span> <span class="n">matches</span><span class="p">:</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">matches</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">IOCMatch</span><span class="p">(</span>
                            <span class="n">ioc</span><span class="o">=</span><span class="n">ioc</span><span class="p">,</span>
                            <span class="n">location</span><span class="o">=</span><span class="nb">str</span><span class="p">(</span><span class="n">filepath</span><span class="p">),</span>
                            <span class="n">context</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;Pattern &#39;</span><span class="si">{</span><span class="n">ioc</span><span class="o">.</span><span class="n">value</span><span class="si">}</span><span class="s2">&#39; found </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">matches</span><span class="p">)</span><span class="si">}</span><span class="s2"> times&quot;</span><span class="p">,</span>
                        <span class="p">))</span>

            <span class="k">except</span> <span class="p">(</span><span class="ne">PermissionError</span><span class="p">,</span> <span class="ne">OSError</span><span class="p">):</span>
                <span class="k">pass</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">print_report</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;IOC 스캔 결과를 출력합니다.&quot;&quot;&quot;</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span> <span class="o">+</span> <span class="s2">&quot;=&quot;</span> <span class="o">*</span> <span class="mi">65</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;  IOC SCAN REPORT&quot;</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;=&quot;</span> <span class="o">*</span> <span class="mi">65</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  IOCs in database: </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ioc_db</span><span class="o">.</span><span class="n">iocs</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  Matches found: </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">matches</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">matches</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">  No IOC matches found. System appears clean.&quot;</span><span class="p">)</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;=&quot;</span> <span class="o">*</span> <span class="mi">65</span><span class="p">)</span>
            <span class="k">return</span>

        <span class="k">for</span> <span class="n">severity</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;CRITICAL&#39;</span><span class="p">,</span> <span class="s1">&#39;HIGH&#39;</span><span class="p">,</span> <span class="s1">&#39;MEDIUM&#39;</span><span class="p">,</span> <span class="s1">&#39;LOW&#39;</span><span class="p">]:</span>
            <span class="n">matches</span> <span class="o">=</span> <span class="p">[</span><span class="n">m</span> <span class="k">for</span> <span class="n">m</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">matches</span> <span class="k">if</span> <span class="n">m</span><span class="o">.</span><span class="n">ioc</span><span class="o">.</span><span class="n">severity</span> <span class="o">==</span> <span class="n">severity</span><span class="p">]</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">matches</span><span class="p">:</span>
                <span class="k">continue</span>

            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="se">\n</span><span class="si">{</span><span class="s1">&#39;─&#39;</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="mi">65</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  </span><span class="si">{</span><span class="n">severity</span><span class="si">}</span><span class="s2"> (</span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">matches</span><span class="p">)</span><span class="si">}</span><span class="s2"> matches)&quot;</span><span class="p">)</span>
            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="s1">&#39;─&#39;</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="mi">65</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

            <span class="k">for</span> <span class="n">match</span> <span class="ow">in</span> <span class="n">matches</span><span class="p">:</span>
                <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">  Type: </span><span class="si">{</span><span class="n">match</span><span class="o">.</span><span class="n">ioc</span><span class="o">.</span><span class="n">ioc_type</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
                <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  IOC:  </span><span class="si">{</span><span class="n">match</span><span class="o">.</span><span class="n">ioc</span><span class="o">.</span><span class="n">value</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
                <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  Desc: </span><span class="si">{</span><span class="n">match</span><span class="o">.</span><span class="n">ioc</span><span class="o">.</span><span class="n">description</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
                <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  Found: </span><span class="si">{</span><span class="n">match</span><span class="o">.</span><span class="n">location</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
                <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  Context: </span><span class="si">{</span><span class="n">match</span><span class="o">.</span><span class="n">context</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="se">\n</span><span class="si">{</span><span class="s1">&#39;=&#39;</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="mi">65</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;  RECOMMENDED ACTIONS:&quot;</span><span class="p">)</span>
        <span class="n">critical</span> <span class="o">=</span> <span class="p">[</span><span class="n">m</span> <span class="k">for</span> <span class="n">m</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">matches</span> <span class="k">if</span> <span class="n">m</span><span class="o">.</span><span class="n">ioc</span><span class="o">.</span><span class="n">severity</span> <span class="o">==</span> <span class="s1">&#39;CRITICAL&#39;</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">critical</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;  [!] CRITICAL matches found - initiate incident response&quot;</span><span class="p">)</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;  [!] Isolate affected system immediately&quot;</span><span class="p">)</span>
        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">matches</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;  [*] Review matches and determine if they are true positives&quot;</span><span class="p">)</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;  [*] Escalate confirmed matches to security team&quot;</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;=&quot;</span> <span class="o">*</span> <span class="mi">65</span><span class="p">)</span>


<span class="c1"># ─── Example IOC JSON format ───</span>
<span class="n">SAMPLE_IOC_JSON</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot;</span>
<span class="s2">{</span>
<span class="s2">  &quot;iocs&quot;: [</span>
<span class="s2">    {</span>
<span class="s2">      &quot;type&quot;: &quot;IP&quot;,</span>
<span class="s2">      &quot;value&quot;: &quot;198.51.100.1&quot;,</span>
<span class="s2">      &quot;description&quot;: &quot;Known C2 server for BotnetX&quot;,</span>
<span class="s2">      &quot;source&quot;: &quot;ThreatIntel Feed Alpha&quot;,</span>
<span class="s2">      &quot;severity&quot;: &quot;HIGH&quot;</span>
<span class="s2">    },</span>
<span class="s2">    {</span>
<span class="s2">      &quot;type&quot;: &quot;DOMAIN&quot;,</span>
<span class="s2">      &quot;value&quot;: &quot;evil-malware.example.com&quot;,</span>
<span class="s2">      &quot;description&quot;: &quot;Malware distribution domain&quot;,</span>
<span class="s2">      &quot;source&quot;: &quot;OSINT&quot;,</span>
<span class="s2">      &quot;severity&quot;: &quot;CRITICAL&quot;</span>
<span class="s2">    },</span>
<span class="s2">    {</span>
<span class="s2">      &quot;type&quot;: &quot;HASH_SHA256&quot;,</span>
<span class="s2">      &quot;value&quot;: &quot;a1b2c3d4e5f6...&quot;,</span>
<span class="s2">      &quot;description&quot;: &quot;Ransomware binary&quot;,</span>
<span class="s2">      &quot;source&quot;: &quot;VirusTotal&quot;,</span>
<span class="s2">      &quot;severity&quot;: &quot;CRITICAL&quot;</span>
<span class="s2">    },</span>
<span class="s2">    {</span>
<span class="s2">      &quot;type&quot;: &quot;FILENAME&quot;,</span>
<span class="s2">      &quot;value&quot;: &quot;mimikatz.exe&quot;,</span>
<span class="s2">      &quot;description&quot;: &quot;Credential dumping tool&quot;,</span>
<span class="s2">      &quot;source&quot;: &quot;MITRE ATT&amp;CK&quot;,</span>
<span class="s2">      &quot;severity&quot;: &quot;CRITICAL&quot;</span>
<span class="s2">    },</span>
<span class="s2">    {</span>
<span class="s2">      &quot;type&quot;: &quot;REGEX&quot;,</span>
<span class="s2">      &quot;value&quot;: &quot;(?:eval|exec)</span><span class="se">\\\\</span><span class="s2">s*</span><span class="se">\\\\</span><span class="s2">(</span><span class="se">\\\\</span><span class="s2">s*base64&quot;,</span>
<span class="s2">      &quot;description&quot;: &quot;Obfuscated code execution pattern&quot;,</span>
<span class="s2">      &quot;source&quot;: &quot;Custom rule&quot;,</span>
<span class="s2">      &quot;severity&quot;: &quot;HIGH&quot;</span>
<span class="s2">    }</span>
<span class="s2">  ]</span>
<span class="s2">}</span>
<span class="s2">&quot;&quot;&quot;</span>


<span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s2">&quot;__main__&quot;</span><span class="p">:</span>
    <span class="kn">import</span><span class="w"> </span><span class="nn">sys</span>

    <span class="c1"># Initialize IOC database</span>
    <span class="n">ioc_db</span> <span class="o">=</span> <span class="n">IOCDatabase</span><span class="p">()</span>

    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">sys</span><span class="o">.</span><span class="n">argv</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span> <span class="ow">and</span> <span class="n">sys</span><span class="o">.</span><span class="n">argv</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="s1">&#39;.json&#39;</span><span class="p">):</span>
        <span class="n">count</span> <span class="o">=</span> <span class="n">ioc_db</span><span class="o">.</span><span class="n">load_from_json</span><span class="p">(</span><span class="n">sys</span><span class="o">.</span><span class="n">argv</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;[*] Loaded </span><span class="si">{</span><span class="n">count</span><span class="si">}</span><span class="s2"> IOCs from </span><span class="si">{</span><span class="n">sys</span><span class="o">.</span><span class="n">argv</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="n">scan_dir</span> <span class="o">=</span> <span class="n">sys</span><span class="o">.</span><span class="n">argv</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">sys</span><span class="o">.</span><span class="n">argv</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">2</span> <span class="k">else</span> <span class="s2">&quot;/tmp&quot;</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">ioc_db</span><span class="o">.</span><span class="n">load_sample_iocs</span><span class="p">()</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;[*] Loaded </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">ioc_db</span><span class="o">.</span><span class="n">iocs</span><span class="p">)</span><span class="si">}</span><span class="s2"> sample IOCs&quot;</span><span class="p">)</span>
        <span class="n">scan_dir</span> <span class="o">=</span> <span class="n">sys</span><span class="o">.</span><span class="n">argv</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">sys</span><span class="o">.</span><span class="n">argv</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span> <span class="k">else</span> <span class="s2">&quot;/tmp&quot;</span>

    <span class="c1"># Run scanner</span>
    <span class="n">scanner</span> <span class="o">=</span> <span class="n">IOCScanner</span><span class="p">(</span><span class="n">ioc_db</span><span class="p">)</span>
    <span class="n">scanner</span><span class="o">.</span><span class="n">scan_all</span><span class="p">(</span><span class="n">scan_dir</span><span class="p">)</span>
    <span class="n">scanner</span><span class="o">.</span><span class="n">print_report</span><span class="p">()</span>
</code></pre></div>

<hr />
<h2 id="5">5. 디지털 포렌식 기초<a class="header-link" href="#5" title="Permanent link">&para;</a></h2>
<h3 id="51">5.1 포렌식 원칙<a class="header-link" href="#51" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code>┌──────────────────────────────────────────────────────────────────┐
│                  디지털 포렌식 원칙                                │
├──────────────────────────────────────────────────────────────────┤
│                                                                   │
│  1. 증거 보존                                                     │
│     - 원본 증거로는 절대 작업하지 않음                            │
│     - 포렌식 이미지 생성 (비트 단위 복사본)                       │
│     - 디스크 액세스 시 쓰기 차단기 사용                           │
│     - 모든 것을 타임스탬프와 함께 문서화                          │
│                                                                   │
│  2. 보관 연속성 문서화                                            │
│     - 누가 증거를 수집했는가?                                     │
│     - 언제 수집되었는가?                                          │
│     - 어떻게 보관되었는가?                                        │
│     - 누가 접근했는가?                                            │
│                                                                   │
│  3. 무결성 검증                                                   │
│     - 모든 증거를 즉시 해싱 (SHA-256)                            │
│     - 분석 전후 해시 검증                                         │
│     - 모든 변경은 증거를 무효화함                                 │
│                                                                   │
│  4. 복사본으로 분석                                               │
│     - 포렌식 복사본으로 작업, 원본은 절대 안됨                    │
│     - 증거를 수정하지 않는 포렌식 도구 사용                       │
│     - 모든 분석 단계의 상세 메모 유지                             │
│                                                                   │
│  5. 결과 보고                                                     │
│     - 사실적이고 객관적인 보고                                    │
│     - 재현 가능한 방법론                                          │
│     - 증거에서 결론까지 명확한 연결                               │
│                                                                   │
└──────────────────────────────────────────────────────────────────┘
</code></pre></div>

<h3 id="52">5.2 휘발성 순서<a class="header-link" href="#52" title="Permanent link">&para;</a></h3>
<p>증거를 수집할 때는 가장 휘발성이 높은(수명이 짧은) 데이터부터 시작합니다.</p>
<div class="highlight"><pre><span></span><code>┌──────────────────────────────────────────────────────────────────┐
│               휘발성 순서 (높음 → 낮음)                            │
├──────────────────────────────────────────────────────────────────┤
│                                                                   │
│  가장 휘발성 높음 (먼저 수집)                                     │
│  │                                                                │
│  ├── 1. CPU 레지스터, 캐시                                        │
│  │      수명: 나노초                                              │
│  │                                                                │
│  ├── 2. 메모리 (RAM)                                             │
│  │      수명: 전원 사이클                                         │
│  │      포함: 실행 중인 프로세스, 네트워크 연결,                  │
│  │      복호화된 데이터, 패스워드, 암호화 키                      │
│  │                                                                │
│  ├── 3. 네트워크 상태                                             │
│  │      수명: 초-분                                               │
│  │      포함: 활성 연결, 라우팅 테이블, ARP 캐시                  │
│  │                                                                │
│  ├── 4. 실행 중인 프로세스                                        │
│  │      수명: 프로세스가 종료될 때까지                            │
│  │      포함: 프로세스 목록, 열린 파일, 로드된 라이브러리         │
│  │                                                                │
│  ├── 5. 디스크 (파일 시스템)                                      │
│  │      수명: 덮어쓰기될 때까지                                   │
│  │      포함: 파일, 로그, 스왑, 임시 파일, 슬랙 공간              │
│  │                                                                │
│  ├── 6. 원격 로깅 / 모니터링                                      │
│  │      수명: 보관 정책                                           │
│  │                                                                │
│  └── 7. 아카이브 미디어 (백업, 테이프)                            │
│         수명: 년                                                  │
│                                                                   │
│  가장 휘발성 낮음 (나중에 수집)                                   │
│                                                                   │
└──────────────────────────────────────────────────────────────────┘
</code></pre></div>

<h3 id="53">5.3 보관 연속성<a class="header-link" href="#53" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code>┌──────────────────────────────────────────────────────────────────┐
│                    보관 연속성 양식                                │
├──────────────────────────────────────────────────────────────────┤
│                                                                   │
│  사건 번호: IR-2025-0042                                          │
│  증거 ID: EVD-001                                                │
│  설명: Dell Latitude 7420 노트북, S/N: ABC123DEF                 │
│  발견 위치: 건물 A, 사무실 302                                    │
│                                                                   │
│  증거 해시 (수집 시):                                             │
│  SHA-256: a1b2c3d4e5f6789...                                     │
│                                                                   │
│  ┌──────────┬───────────────────┬────────────┬────────────────┐  │
│  │   날짜   │  인계자           │ 인수자     │    목적        │  │
│  ├──────────┼───────────────────┼────────────┼────────────────┤  │
│  │ 01/15/25 │ Officer Smith     │ Analyst Lee│ 최초           │  │
│  │ 10:30 AM │ (배지 #1234)      │ (IR팀)     │ 수집           │  │
│  ├──────────┼───────────────────┼────────────┼────────────────┤  │
│  │ 01/15/25 │ Analyst Lee       │ 증거       │ 안전           │  │
│  │ 11:45 AM │ (IR팀)            │ 보관함     │ 보관           │  │
│  ├──────────┼───────────────────┼────────────┼────────────────┤  │
│  │ 01/16/25 │ 증거 보관함       │ Forensic   │ 디스크         │  │
│  │ 09:00 AM │                   │ Analyst Kim│ 이미징         │  │
│  ├──────────┼───────────────────┼────────────┼────────────────┤  │
│  │ 01/16/25 │ Forensic Analyst  │ 증거       │ 이미징 후      │  │
│  │ 05:00 PM │ Kim               │ 보관함     │ 반납           │  │
│  └──────────┴───────────────────┴────────────┴────────────────┘  │
│                                                                   │
│  참고사항:                                                        │
│  - 수집 시 노트북이 꺼져 있었음                                   │
│  - 우발적인 부팅을 방지하기 위해 배터리 제거                      │
│  - FTK Imager를 사용하여 디스크 이미징, 해시 검증 완료           │
│                                                                   │
└──────────────────────────────────────────────────────────────────┘
</code></pre></div>

<h3 id="54">5.4 포렌식 디스크 이미징<a class="header-link" href="#54" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><span class="c1"># dd를 사용한 포렌식 이미지 생성</span>
<span class="c1"># 경고: dd는 매우 주의해서 사용 - 잘못된 매개변수는 데이터 파괴 가능</span>

<span class="c1"># 1단계: 타겟 디스크 식별</span>
lsblk
<span class="c1"># or</span>
fdisk<span class="w"> </span>-l

<span class="c1"># 2단계: 포렌식 이미지 생성 (비트 단위 복사)</span>
<span class="c1"># /dev/sdb = 소스 (증거 드라이브, 쓰기 차단기를 통해)</span>
<span class="c1"># evidence.dd = 대상 이미지 파일</span>
sudo<span class="w"> </span>dd<span class="w"> </span><span class="k">if</span><span class="o">=</span>/dev/sdb<span class="w"> </span><span class="nv">of</span><span class="o">=</span>evidence.dd<span class="w"> </span><span class="nv">bs</span><span class="o">=</span><span class="m">4096</span><span class="w"> </span><span class="nv">conv</span><span class="o">=</span>noerror,sync<span class="w"> </span><span class="nv">status</span><span class="o">=</span>progress

<span class="c1"># 3단계: 원본과 이미지의 해시 계산</span>
sha256sum<span class="w"> </span>/dev/sdb<span class="w"> </span>&gt;<span class="w"> </span>original_hash.txt
sha256sum<span class="w"> </span>evidence.dd<span class="w"> </span>&gt;<span class="w"> </span>image_hash.txt

<span class="c1"># 4단계: 해시 일치 검증</span>
diff<span class="w"> </span>original_hash.txt<span class="w"> </span>image_hash.txt

<span class="c1"># 더 나은 대안: dc3dd (포렌식에 특화된 dd)</span>
sudo<span class="w"> </span>dc3dd<span class="w"> </span><span class="k">if</span><span class="o">=</span>/dev/sdb<span class="w"> </span><span class="nv">of</span><span class="o">=</span>evidence.dd<span class="w"> </span><span class="nv">hash</span><span class="o">=</span>sha256<span class="w"> </span><span class="nv">log</span><span class="o">=</span>imaging.log

<span class="c1"># 대안: FTK Imager (크로스 플랫폼, GUI)</span>
<span class="c1"># 내장 해싱이 포함된 E01 (Expert Witness) 형식 생성</span>
</code></pre></div>

<hr />
<h2 id="6">6. 메모리 포렌식 개념<a class="header-link" href="#6" title="Permanent link">&para;</a></h2>
<h3 id="61">6.1 메모리 포렌식이 필요한 이유<a class="header-link" href="#61" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code>┌──────────────────────────────────────────────────────────────────┐
│                메모리에만 존재하는 것들                            │
├──────────────────────────────────────────────────────────────────┤
│                                                                   │
│  ┌─────────────────────────────────────────────┐                 │
│  │  RAM에서만 찾을 수 있는 것들:               │                 │
│  │                                              │                 │
│  │  - 실행 중인 프로세스 (숨겨진 것 포함)      │                 │
│  │  - 네트워크 연결                             │                 │
│  │  - 복호화 키                                 │                 │
│  │  - 패스워드 (메모리 내 평문)                │                 │
│  │  - 주입된 코드 (파일리스 악성코드)          │                 │
│  │  - 클립보드 내용                             │                 │
│  │  - 채팅 메시지 (디스크에 저장되기 전)       │                 │
│  │  - 암호화 키 (전체 디스크 암호화)           │                 │
│  │  - 명령 기록                                 │                 │
│  │  - 언팩/복호화된 악성코드                   │                 │
│  └─────────────────────────────────────────────┘                 │
│                                                                   │
│  최신 악성코드는 디스크 기반 탐지를 피하기 위해                   │
│  전적으로 메모리에서 작동하는 경우가 많습니다                     │
│  (&quot;파일리스 악성코드&quot;).                                           │
│                                                                   │
└──────────────────────────────────────────────────────────────────┘
</code></pre></div>

<h3 id="62">6.2 메모리 수집<a class="header-link" href="#62" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><span class="c1"># Linux 메모리 수집</span>

<span class="c1"># 방법 1: /proc/kcore (루트 권한 필요)</span>
sudo<span class="w"> </span>dd<span class="w"> </span><span class="k">if</span><span class="o">=</span>/proc/kcore<span class="w"> </span><span class="nv">of</span><span class="o">=</span>memory.raw<span class="w"> </span><span class="nv">bs</span><span class="o">=</span>1M

<span class="c1"># 방법 2: LiME (Linux Memory Extractor) - 권장</span>
<span class="c1"># LiME 커널 모듈 로드</span>
sudo<span class="w"> </span>insmod<span class="w"> </span>lime-<span class="k">$(</span>uname<span class="w"> </span>-r<span class="k">)</span>.ko<span class="w"> </span><span class="s2">&quot;path=memory.lime format=lime&quot;</span>

<span class="c1"># 방법 3: AVML (Microsoft의 Linux 메모리 수집 도구)</span>
sudo<span class="w"> </span>./avml<span class="w"> </span>memory.lime

<span class="c1"># Windows 메모리 수집</span>
<span class="c1"># - FTK Imager (무료, GUI)</span>
<span class="c1"># - WinPmem (커맨드라인)</span>
<span class="c1"># - Belkasoft RAM Capturer (무료)</span>

<span class="c1"># macOS 메모리 수집</span>
<span class="c1"># - osxpmem</span>
sudo<span class="w"> </span>./osxpmem<span class="w"> </span>-o<span class="w"> </span>memory.aff4
</code></pre></div>

<h3 id="63-volatility">6.3 Volatility 프레임워크 (개요)<a class="header-link" href="#63-volatility" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><span class="c1"># Volatility 3 - 메모리 포렌식 프레임워크</span>
<span class="c1"># 설치: pip install volatility3</span>

<span class="c1"># OS 프로파일 식별</span>
vol<span class="w"> </span>-f<span class="w"> </span>memory.raw<span class="w"> </span>windows.info

<span class="c1"># 실행 중인 프로세스 목록</span>
vol<span class="w"> </span>-f<span class="w"> </span>memory.raw<span class="w"> </span>windows.pslist
vol<span class="w"> </span>-f<span class="w"> </span>memory.raw<span class="w"> </span>windows.pstree<span class="w">  </span><span class="c1"># 트리 뷰</span>

<span class="c1"># 숨겨진 프로세스 찾기</span>
vol<span class="w"> </span>-f<span class="w"> </span>memory.raw<span class="w"> </span>windows.psscan

<span class="c1"># 네트워크 연결</span>
vol<span class="w"> </span>-f<span class="w"> </span>memory.raw<span class="w"> </span>windows.netscan

<span class="c1"># 명령 기록</span>
vol<span class="w"> </span>-f<span class="w"> </span>memory.raw<span class="w"> </span>windows.cmdline

<span class="c1"># 특정 프로세스의 DLL 목록</span>
vol<span class="w"> </span>-f<span class="w"> </span>memory.raw<span class="w"> </span>windows.dlllist<span class="w"> </span>--pid<span class="w"> </span><span class="m">1234</span>

<span class="c1"># 특정 프로세스 덤프</span>
vol<span class="w"> </span>-f<span class="w"> </span>memory.raw<span class="w"> </span>windows.memmap<span class="w"> </span>--pid<span class="w"> </span><span class="m">1234</span><span class="w"> </span>--dump

<span class="c1"># 레지스트리 분석</span>
vol<span class="w"> </span>-f<span class="w"> </span>memory.raw<span class="w"> </span>windows.registry.hivelist

<span class="c1"># Linux 메모리 분석</span>
vol<span class="w"> </span>-f<span class="w"> </span>memory.raw<span class="w"> </span>linux.pslist
vol<span class="w"> </span>-f<span class="w"> </span>memory.raw<span class="w"> </span>linux.bash<span class="w">  </span><span class="c1"># Bash 기록</span>
vol<span class="w"> </span>-f<span class="w"> </span>memory.raw<span class="w"> </span>linux.netstat
</code></pre></div>

<hr />
<h2 id="7">7. 네트워크 포렌식<a class="header-link" href="#7" title="Permanent link">&para;</a></h2>
<h3 id="71">7.1 패킷 캡처 분석<a class="header-link" href="#71" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">pcap_analyzer.py - 패킷 캡처 분석을 사용한 기본 네트워크 포렌식.</span>
<span class="sd">필요: pip install scapy</span>

<span class="sd">경고: 모니터링 권한이 있는 네트워크의 캡처만 분석하십시오.</span>
<span class="sd">&quot;&quot;&quot;</span>

<span class="k">try</span><span class="p">:</span>
    <span class="kn">from</span><span class="w"> </span><span class="nn">scapy.all</span><span class="w"> </span><span class="kn">import</span> <span class="n">rdpcap</span><span class="p">,</span> <span class="n">IP</span><span class="p">,</span> <span class="n">TCP</span><span class="p">,</span> <span class="n">UDP</span><span class="p">,</span> <span class="n">DNS</span><span class="p">,</span> <span class="n">Raw</span>
    <span class="n">SCAPY_AVAILABLE</span> <span class="o">=</span> <span class="kc">True</span>
<span class="k">except</span> <span class="ne">ImportError</span><span class="p">:</span>
    <span class="n">SCAPY_AVAILABLE</span> <span class="o">=</span> <span class="kc">False</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Scapy가 설치되지 않았습니다. pip install scapy로 설치하세요&quot;</span><span class="p">)</span>

<span class="kn">from</span><span class="w"> </span><span class="nn">collections</span><span class="w"> </span><span class="kn">import</span> <span class="n">Counter</span><span class="p">,</span> <span class="n">defaultdict</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">dataclasses</span><span class="w"> </span><span class="kn">import</span> <span class="n">dataclass</span><span class="p">,</span> <span class="n">field</span>


<span class="nd">@dataclass</span>
<span class="k">class</span><span class="w"> </span><span class="nc">PcapAnalysis</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;PCAP 파일 분석 결과.&quot;&quot;&quot;</span>
    <span class="n">total_packets</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="n">protocols</span><span class="p">:</span> <span class="nb">dict</span> <span class="o">=</span> <span class="n">field</span><span class="p">(</span><span class="n">default_factory</span><span class="o">=</span><span class="nb">dict</span><span class="p">)</span>
    <span class="n">top_talkers</span><span class="p">:</span> <span class="nb">list</span> <span class="o">=</span> <span class="n">field</span><span class="p">(</span><span class="n">default_factory</span><span class="o">=</span><span class="nb">list</span><span class="p">)</span>
    <span class="n">dns_queries</span><span class="p">:</span> <span class="nb">list</span> <span class="o">=</span> <span class="n">field</span><span class="p">(</span><span class="n">default_factory</span><span class="o">=</span><span class="nb">list</span><span class="p">)</span>
    <span class="n">suspicious_connections</span><span class="p">:</span> <span class="nb">list</span> <span class="o">=</span> <span class="n">field</span><span class="p">(</span><span class="n">default_factory</span><span class="o">=</span><span class="nb">list</span><span class="p">)</span>
    <span class="n">http_requests</span><span class="p">:</span> <span class="nb">list</span> <span class="o">=</span> <span class="n">field</span><span class="p">(</span><span class="n">default_factory</span><span class="o">=</span><span class="nb">list</span><span class="p">)</span>
    <span class="n">large_transfers</span><span class="p">:</span> <span class="nb">list</span> <span class="o">=</span> <span class="n">field</span><span class="p">(</span><span class="n">default_factory</span><span class="o">=</span><span class="nb">list</span><span class="p">)</span>


<span class="k">def</span><span class="w"> </span><span class="nf">analyze_pcap</span><span class="p">(</span><span class="n">filepath</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">PcapAnalysis</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    보안 관련 정보를 찾기 위해 PCAP 파일을 분석합니다.</span>

<span class="sd">    Args:</span>
<span class="sd">        filepath: .pcap 또는 .pcapng 파일 경로</span>

<span class="sd">    Returns:</span>
<span class="sd">        발견 사항이 포함된 PcapAnalysis</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">SCAPY_AVAILABLE</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ImportError</span><span class="p">(</span><span class="s2">&quot;PCAP 분석을 위해 Scapy가 필요합니다&quot;</span><span class="p">)</span>

    <span class="n">packets</span> <span class="o">=</span> <span class="n">rdpcap</span><span class="p">(</span><span class="n">filepath</span><span class="p">)</span>
    <span class="n">analysis</span> <span class="o">=</span> <span class="n">PcapAnalysis</span><span class="p">(</span><span class="n">total_packets</span><span class="o">=</span><span class="nb">len</span><span class="p">(</span><span class="n">packets</span><span class="p">))</span>

    <span class="c1"># 통계 추적</span>
    <span class="n">ip_src_counter</span> <span class="o">=</span> <span class="n">Counter</span><span class="p">()</span>
    <span class="n">ip_dst_counter</span> <span class="o">=</span> <span class="n">Counter</span><span class="p">()</span>
    <span class="n">protocol_counter</span> <span class="o">=</span> <span class="n">Counter</span><span class="p">()</span>
    <span class="n">connection_sizes</span> <span class="o">=</span> <span class="n">defaultdict</span><span class="p">(</span><span class="nb">int</span><span class="p">)</span>
    <span class="n">dns_queries</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">http_requests</span> <span class="o">=</span> <span class="p">[]</span>

    <span class="k">for</span> <span class="n">pkt</span> <span class="ow">in</span> <span class="n">packets</span><span class="p">:</span>
        <span class="c1"># 프로토콜 분석</span>
        <span class="k">if</span> <span class="n">pkt</span><span class="o">.</span><span class="n">haslayer</span><span class="p">(</span><span class="n">TCP</span><span class="p">):</span>
            <span class="n">protocol_counter</span><span class="p">[</span><span class="s1">&#39;TCP&#39;</span><span class="p">]</span> <span class="o">+=</span> <span class="mi">1</span>
        <span class="k">elif</span> <span class="n">pkt</span><span class="o">.</span><span class="n">haslayer</span><span class="p">(</span><span class="n">UDP</span><span class="p">):</span>
            <span class="n">protocol_counter</span><span class="p">[</span><span class="s1">&#39;UDP&#39;</span><span class="p">]</span> <span class="o">+=</span> <span class="mi">1</span>

        <span class="c1"># IP 레이어 분석</span>
        <span class="k">if</span> <span class="n">pkt</span><span class="o">.</span><span class="n">haslayer</span><span class="p">(</span><span class="n">IP</span><span class="p">):</span>
            <span class="n">src</span> <span class="o">=</span> <span class="n">pkt</span><span class="p">[</span><span class="n">IP</span><span class="p">]</span><span class="o">.</span><span class="n">src</span>
            <span class="n">dst</span> <span class="o">=</span> <span class="n">pkt</span><span class="p">[</span><span class="n">IP</span><span class="p">]</span><span class="o">.</span><span class="n">dst</span>
            <span class="n">ip_src_counter</span><span class="p">[</span><span class="n">src</span><span class="p">]</span> <span class="o">+=</span> <span class="mi">1</span>
            <span class="n">ip_dst_counter</span><span class="p">[</span><span class="n">dst</span><span class="p">]</span> <span class="o">+=</span> <span class="mi">1</span>

            <span class="c1"># 연결 데이터 볼륨 추적</span>
            <span class="k">if</span> <span class="n">pkt</span><span class="o">.</span><span class="n">haslayer</span><span class="p">(</span><span class="n">Raw</span><span class="p">):</span>
                <span class="n">key</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">src</span><span class="si">}</span><span class="s2"> -&gt; </span><span class="si">{</span><span class="n">dst</span><span class="si">}</span><span class="s2">&quot;</span>
                <span class="n">connection_sizes</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">+=</span> <span class="nb">len</span><span class="p">(</span><span class="n">pkt</span><span class="p">[</span><span class="n">Raw</span><span class="p">]</span><span class="o">.</span><span class="n">load</span><span class="p">)</span>

        <span class="c1"># DNS 분석</span>
        <span class="k">if</span> <span class="n">pkt</span><span class="o">.</span><span class="n">haslayer</span><span class="p">(</span><span class="n">DNS</span><span class="p">)</span> <span class="ow">and</span> <span class="n">pkt</span><span class="p">[</span><span class="n">DNS</span><span class="p">]</span><span class="o">.</span><span class="n">qr</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>  <span class="c1"># Query</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">query_name</span> <span class="o">=</span> <span class="n">pkt</span><span class="p">[</span><span class="n">DNS</span><span class="p">]</span><span class="o">.</span><span class="n">qd</span><span class="o">.</span><span class="n">qname</span><span class="o">.</span><span class="n">decode</span><span class="p">(</span><span class="s1">&#39;utf-8&#39;</span><span class="p">,</span> <span class="n">errors</span><span class="o">=</span><span class="s1">&#39;ignore&#39;</span><span class="p">)</span>
                <span class="n">dns_queries</span><span class="o">.</span><span class="n">append</span><span class="p">({</span>
                    <span class="s1">&#39;query&#39;</span><span class="p">:</span> <span class="n">query_name</span><span class="p">,</span>
                    <span class="s1">&#39;src&#39;</span><span class="p">:</span> <span class="n">pkt</span><span class="p">[</span><span class="n">IP</span><span class="p">]</span><span class="o">.</span><span class="n">src</span> <span class="k">if</span> <span class="n">pkt</span><span class="o">.</span><span class="n">haslayer</span><span class="p">(</span><span class="n">IP</span><span class="p">)</span> <span class="k">else</span> <span class="s1">&#39;unknown&#39;</span><span class="p">,</span>
                    <span class="s1">&#39;type&#39;</span><span class="p">:</span> <span class="n">pkt</span><span class="p">[</span><span class="n">DNS</span><span class="p">]</span><span class="o">.</span><span class="n">qd</span><span class="o">.</span><span class="n">qtype</span><span class="p">,</span>
                <span class="p">})</span>
            <span class="k">except</span> <span class="p">(</span><span class="ne">AttributeError</span><span class="p">,</span> <span class="ne">IndexError</span><span class="p">):</span>
                <span class="k">pass</span>

        <span class="c1"># HTTP 요청 탐지 (기본)</span>
        <span class="k">if</span> <span class="n">pkt</span><span class="o">.</span><span class="n">haslayer</span><span class="p">(</span><span class="n">TCP</span><span class="p">)</span> <span class="ow">and</span> <span class="n">pkt</span><span class="o">.</span><span class="n">haslayer</span><span class="p">(</span><span class="n">Raw</span><span class="p">):</span>
            <span class="n">payload</span> <span class="o">=</span> <span class="n">pkt</span><span class="p">[</span><span class="n">Raw</span><span class="p">]</span><span class="o">.</span><span class="n">load</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">text</span> <span class="o">=</span> <span class="n">payload</span><span class="o">.</span><span class="n">decode</span><span class="p">(</span><span class="s1">&#39;utf-8&#39;</span><span class="p">,</span> <span class="n">errors</span><span class="o">=</span><span class="s1">&#39;ignore&#39;</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">text</span><span class="o">.</span><span class="n">startswith</span><span class="p">((</span><span class="s1">&#39;GET &#39;</span><span class="p">,</span> <span class="s1">&#39;POST &#39;</span><span class="p">,</span> <span class="s1">&#39;PUT &#39;</span><span class="p">,</span> <span class="s1">&#39;DELETE &#39;</span><span class="p">)):</span>
                    <span class="n">lines</span> <span class="o">=</span> <span class="n">text</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\r\n</span><span class="s1">&#39;</span><span class="p">)</span>
                    <span class="n">http_requests</span><span class="o">.</span><span class="n">append</span><span class="p">({</span>
                        <span class="s1">&#39;method&#39;</span><span class="p">:</span> <span class="n">lines</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39; &#39;</span><span class="p">)[</span><span class="mi">0</span><span class="p">],</span>
                        <span class="s1">&#39;path&#39;</span><span class="p">:</span> <span class="n">lines</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39; &#39;</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span> <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">lines</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39; &#39;</span><span class="p">))</span> <span class="o">&gt;</span> <span class="mi">1</span> <span class="k">else</span> <span class="s1">&#39;&#39;</span><span class="p">,</span>
                        <span class="s1">&#39;src&#39;</span><span class="p">:</span> <span class="n">pkt</span><span class="p">[</span><span class="n">IP</span><span class="p">]</span><span class="o">.</span><span class="n">src</span> <span class="k">if</span> <span class="n">pkt</span><span class="o">.</span><span class="n">haslayer</span><span class="p">(</span><span class="n">IP</span><span class="p">)</span> <span class="k">else</span> <span class="s1">&#39;unknown&#39;</span><span class="p">,</span>
                        <span class="s1">&#39;dst&#39;</span><span class="p">:</span> <span class="n">pkt</span><span class="p">[</span><span class="n">IP</span><span class="p">]</span><span class="o">.</span><span class="n">dst</span> <span class="k">if</span> <span class="n">pkt</span><span class="o">.</span><span class="n">haslayer</span><span class="p">(</span><span class="n">IP</span><span class="p">)</span> <span class="k">else</span> <span class="s1">&#39;unknown&#39;</span><span class="p">,</span>
                    <span class="p">})</span>
            <span class="k">except</span> <span class="p">(</span><span class="ne">UnicodeDecodeError</span><span class="p">,</span> <span class="ne">IndexError</span><span class="p">):</span>
                <span class="k">pass</span>

    <span class="c1"># 결과 컴파일</span>
    <span class="n">analysis</span><span class="o">.</span><span class="n">protocols</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">protocol_counter</span><span class="p">)</span>

    <span class="c1"># 주요 대화자 (패킷 수 기준)</span>
    <span class="n">analysis</span><span class="o">.</span><span class="n">top_talkers</span> <span class="o">=</span> <span class="p">[</span>
        <span class="p">{</span><span class="s1">&#39;ip&#39;</span><span class="p">:</span> <span class="n">ip</span><span class="p">,</span> <span class="s1">&#39;packets_sent&#39;</span><span class="p">:</span> <span class="n">count</span><span class="p">}</span>
        <span class="k">for</span> <span class="n">ip</span><span class="p">,</span> <span class="n">count</span> <span class="ow">in</span> <span class="n">ip_src_counter</span><span class="o">.</span><span class="n">most_common</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span>
    <span class="p">]</span>

    <span class="c1"># DNS 쿼리 (중복 제거)</span>
    <span class="n">seen_queries</span> <span class="o">=</span> <span class="nb">set</span><span class="p">()</span>
    <span class="k">for</span> <span class="n">q</span> <span class="ow">in</span> <span class="n">dns_queries</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">q</span><span class="p">[</span><span class="s1">&#39;query&#39;</span><span class="p">]</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">seen_queries</span><span class="p">:</span>
            <span class="n">analysis</span><span class="o">.</span><span class="n">dns_queries</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">q</span><span class="p">)</span>
            <span class="n">seen_queries</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">q</span><span class="p">[</span><span class="s1">&#39;query&#39;</span><span class="p">])</span>

    <span class="c1"># 대용량 데이터 전송 (잠재적 유출)</span>
    <span class="n">analysis</span><span class="o">.</span><span class="n">large_transfers</span> <span class="o">=</span> <span class="p">[</span>
        <span class="p">{</span><span class="s1">&#39;connection&#39;</span><span class="p">:</span> <span class="n">conn</span><span class="p">,</span> <span class="s1">&#39;bytes&#39;</span><span class="p">:</span> <span class="n">size</span><span class="p">}</span>
        <span class="k">for</span> <span class="n">conn</span><span class="p">,</span> <span class="n">size</span> <span class="ow">in</span> <span class="nb">sorted</span><span class="p">(</span>
            <span class="n">connection_sizes</span><span class="o">.</span><span class="n">items</span><span class="p">(),</span> <span class="n">key</span><span class="o">=</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">reverse</span><span class="o">=</span><span class="kc">True</span>
        <span class="p">)[:</span><span class="mi">10</span><span class="p">]</span>
    <span class="p">]</span>

    <span class="n">analysis</span><span class="o">.</span><span class="n">http_requests</span> <span class="o">=</span> <span class="n">http_requests</span><span class="p">[:</span><span class="mi">50</span><span class="p">]</span>

    <span class="c1"># 의심스러운 패턴 탐지</span>
    <span class="n">analysis</span><span class="o">.</span><span class="n">suspicious_connections</span> <span class="o">=</span> <span class="n">detect_suspicious_patterns</span><span class="p">(</span>
        <span class="n">packets</span><span class="p">,</span> <span class="n">ip_src_counter</span><span class="p">,</span> <span class="n">dns_queries</span>
    <span class="p">)</span>

    <span class="k">return</span> <span class="n">analysis</span>


<span class="k">def</span><span class="w"> </span><span class="nf">detect_suspicious_patterns</span><span class="p">(</span><span class="n">packets</span><span class="p">,</span> <span class="n">ip_counter</span><span class="p">,</span> <span class="n">dns_queries</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;의심스러운 네트워크 패턴을 탐지합니다.&quot;&quot;&quot;</span>
    <span class="n">suspicious</span> <span class="o">=</span> <span class="p">[]</span>

    <span class="c1"># 1. 비컨 탐지 (정기적인 간격 연결)</span>
    <span class="c1"># 단순화: 매우 규칙적인 패킷 간격을 가진 IP 확인</span>
    <span class="c1"># (실제 비컨 탐지는 통계적 분석 필요)</span>

    <span class="c1"># 2. DNS 터널링 지표</span>
    <span class="n">long_queries</span> <span class="o">=</span> <span class="p">[</span><span class="n">q</span> <span class="k">for</span> <span class="n">q</span> <span class="ow">in</span> <span class="n">dns_queries</span> <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">q</span><span class="p">[</span><span class="s1">&#39;query&#39;</span><span class="p">])</span> <span class="o">&gt;</span> <span class="mi">50</span><span class="p">]</span>
    <span class="k">if</span> <span class="n">long_queries</span><span class="p">:</span>
        <span class="n">suspicious</span><span class="o">.</span><span class="n">append</span><span class="p">({</span>
            <span class="s1">&#39;type&#39;</span><span class="p">:</span> <span class="s1">&#39;DNS_TUNNELING_POSSIBLE&#39;</span><span class="p">,</span>
            <span class="s1">&#39;description&#39;</span><span class="p">:</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">long_queries</span><span class="p">)</span><span class="si">}</span><span class="s2">개의 비정상적으로 긴 DNS 쿼리 발견&quot;</span><span class="p">,</span>
            <span class="s1">&#39;samples&#39;</span><span class="p">:</span> <span class="p">[</span><span class="n">q</span><span class="p">[</span><span class="s1">&#39;query&#39;</span><span class="p">][:</span><span class="mi">80</span><span class="p">]</span> <span class="k">for</span> <span class="n">q</span> <span class="ow">in</span> <span class="n">long_queries</span><span class="p">[:</span><span class="mi">3</span><span class="p">]],</span>
        <span class="p">})</span>

    <span class="c1"># 3. 포트 스캔 탐지</span>
    <span class="n">dst_ports</span> <span class="o">=</span> <span class="n">defaultdict</span><span class="p">(</span><span class="nb">set</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">pkt</span> <span class="ow">in</span> <span class="n">packets</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">pkt</span><span class="o">.</span><span class="n">haslayer</span><span class="p">(</span><span class="n">TCP</span><span class="p">)</span> <span class="ow">and</span> <span class="n">pkt</span><span class="o">.</span><span class="n">haslayer</span><span class="p">(</span><span class="n">IP</span><span class="p">):</span>
            <span class="n">src</span> <span class="o">=</span> <span class="n">pkt</span><span class="p">[</span><span class="n">IP</span><span class="p">]</span><span class="o">.</span><span class="n">src</span>
            <span class="n">dst_port</span> <span class="o">=</span> <span class="n">pkt</span><span class="p">[</span><span class="n">TCP</span><span class="p">]</span><span class="o">.</span><span class="n">dport</span>
            <span class="n">dst_ports</span><span class="p">[</span><span class="n">src</span><span class="p">]</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">dst_port</span><span class="p">)</span>

    <span class="k">for</span> <span class="n">ip</span><span class="p">,</span> <span class="n">ports</span> <span class="ow">in</span> <span class="n">dst_ports</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">ports</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">20</span><span class="p">:</span>  <span class="c1"># 많은 다른 포트 접근</span>
            <span class="n">suspicious</span><span class="o">.</span><span class="n">append</span><span class="p">({</span>
                <span class="s1">&#39;type&#39;</span><span class="p">:</span> <span class="s1">&#39;PORT_SCAN_POSSIBLE&#39;</span><span class="p">,</span>
                <span class="s1">&#39;description&#39;</span><span class="p">:</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">ip</span><span class="si">}</span><span class="s2">가 </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">ports</span><span class="p">)</span><span class="si">}</span><span class="s2">개의 다른 포트에 접촉&quot;</span><span class="p">,</span>
                <span class="s1">&#39;samples&#39;</span><span class="p">:</span> <span class="nb">sorted</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">ports</span><span class="p">))[:</span><span class="mi">10</span><span class="p">],</span>
            <span class="p">})</span>

    <span class="k">return</span> <span class="n">suspicious</span>


<span class="k">def</span><span class="w"> </span><span class="nf">print_pcap_report</span><span class="p">(</span><span class="n">analysis</span><span class="p">:</span> <span class="n">PcapAnalysis</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;형식화된 PCAP 분석 보고서를 출력합니다.&quot;&quot;&quot;</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;=&quot;</span> <span class="o">*</span> <span class="mi">65</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;  네트워크 포렌식 보고서&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;=&quot;</span> <span class="o">*</span> <span class="mi">65</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  총 패킷 수: </span><span class="si">{</span><span class="n">analysis</span><span class="o">.</span><span class="n">total_packets</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  프로토콜: </span><span class="si">{</span><span class="n">analysis</span><span class="o">.</span><span class="n">protocols</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="se">\n</span><span class="si">{</span><span class="s1">&#39;─&#39;</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="mi">65</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;  주요 대화자 (전송된 패킷 기준)&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="s1">&#39;─&#39;</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="mi">65</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="n">analysis</span><span class="o">.</span><span class="n">top_talkers</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  </span><span class="si">{</span><span class="n">t</span><span class="p">[</span><span class="s1">&#39;ip&#39;</span><span class="p">]</span><span class="si">:</span><span class="s2">20s</span><span class="si">}</span><span class="s2"> </span><span class="si">{</span><span class="n">t</span><span class="p">[</span><span class="s1">&#39;packets_sent&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2"> 패킷&quot;</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">analysis</span><span class="o">.</span><span class="n">dns_queries</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="se">\n</span><span class="si">{</span><span class="s1">&#39;─&#39;</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="mi">65</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  DNS 쿼리 (</span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">analysis</span><span class="o">.</span><span class="n">dns_queries</span><span class="p">)</span><span class="si">}</span><span class="s2">개 고유)&quot;</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="s1">&#39;─&#39;</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="mi">65</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">q</span> <span class="ow">in</span> <span class="n">analysis</span><span class="o">.</span><span class="n">dns_queries</span><span class="p">[:</span><span class="mi">20</span><span class="p">]:</span>
            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  </span><span class="si">{</span><span class="n">q</span><span class="p">[</span><span class="s1">&#39;src&#39;</span><span class="p">]</span><span class="si">:</span><span class="s2">20s</span><span class="si">}</span><span class="s2"> -&gt; </span><span class="si">{</span><span class="n">q</span><span class="p">[</span><span class="s1">&#39;query&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">analysis</span><span class="o">.</span><span class="n">large_transfers</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="se">\n</span><span class="si">{</span><span class="s1">&#39;─&#39;</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="mi">65</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;  최대 데이터 전송&quot;</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="s1">&#39;─&#39;</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="mi">65</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="n">analysis</span><span class="o">.</span><span class="n">large_transfers</span><span class="p">:</span>
            <span class="n">size_kb</span> <span class="o">=</span> <span class="n">t</span><span class="p">[</span><span class="s1">&#39;bytes&#39;</span><span class="p">]</span> <span class="o">/</span> <span class="mi">1024</span>
            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  </span><span class="si">{</span><span class="n">t</span><span class="p">[</span><span class="s1">&#39;connection&#39;</span><span class="p">]</span><span class="si">:</span><span class="s2">40s</span><span class="si">}</span><span class="s2"> </span><span class="si">{</span><span class="n">size_kb</span><span class="si">:</span><span class="s2">.1f</span><span class="si">}</span><span class="s2"> KB&quot;</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">analysis</span><span class="o">.</span><span class="n">suspicious_connections</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="se">\n</span><span class="si">{</span><span class="s1">&#39;─&#39;</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="mi">65</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;  의심스러운 패턴&quot;</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="s1">&#39;─&#39;</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="mi">65</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">s</span> <span class="ow">in</span> <span class="n">analysis</span><span class="o">.</span><span class="n">suspicious_connections</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  [</span><span class="si">{</span><span class="n">s</span><span class="p">[</span><span class="s1">&#39;type&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">] </span><span class="si">{</span><span class="n">s</span><span class="p">[</span><span class="s1">&#39;description&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">s</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;samples&#39;</span><span class="p">):</span>
                <span class="k">for</span> <span class="n">sample</span> <span class="ow">in</span> <span class="n">s</span><span class="p">[</span><span class="s1">&#39;samples&#39;</span><span class="p">]:</span>
                    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;    - </span><span class="si">{</span><span class="n">sample</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="se">\n</span><span class="si">{</span><span class="s1">&#39;=&#39;</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="mi">65</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</code></pre></div>

<h3 id="72">7.2 유용한 커맨드라인 도구<a class="header-link" href="#72" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><span class="c1"># tcpdump - 패킷 캡처</span>
<span class="c1"># eth0에서 모든 트래픽 캡처</span>
sudo<span class="w"> </span>tcpdump<span class="w"> </span>-i<span class="w"> </span>eth0<span class="w"> </span>-w<span class="w"> </span>capture.pcap

<span class="c1"># 특정 IP와의 트래픽만 캡처</span>
sudo<span class="w"> </span>tcpdump<span class="w"> </span>-i<span class="w"> </span>eth0<span class="w"> </span>host<span class="w"> </span><span class="m">192</span>.168.1.100<span class="w"> </span>-w<span class="w"> </span>suspicious.pcap

<span class="c1"># HTTP 트래픽만 캡처</span>
sudo<span class="w"> </span>tcpdump<span class="w"> </span>-i<span class="w"> </span>eth0<span class="w"> </span>port<span class="w"> </span><span class="m">80</span><span class="w"> </span>-w<span class="w"> </span>http_traffic.pcap

<span class="c1"># DNS 트래픽 캡처</span>
sudo<span class="w"> </span>tcpdump<span class="w"> </span>-i<span class="w"> </span>eth0<span class="w"> </span>port<span class="w"> </span><span class="m">53</span><span class="w"> </span>-w<span class="w"> </span>dns_traffic.pcap

<span class="c1"># tshark (커맨드라인 Wireshark)</span>
<span class="c1"># HTTP 요청 추출</span>
tshark<span class="w"> </span>-r<span class="w"> </span>capture.pcap<span class="w"> </span>-Y<span class="w"> </span><span class="s2">&quot;http.request&quot;</span><span class="w"> </span>-T<span class="w"> </span>fields<span class="w"> </span><span class="se">\</span>
<span class="w">  </span>-e<span class="w"> </span>ip.src<span class="w"> </span>-e<span class="w"> </span>http.request.method<span class="w"> </span>-e<span class="w"> </span>http.request.uri

<span class="c1"># DNS 쿼리 추출</span>
tshark<span class="w"> </span>-r<span class="w"> </span>capture.pcap<span class="w"> </span>-Y<span class="w"> </span><span class="s2">&quot;dns.qr == 0&quot;</span><span class="w"> </span>-T<span class="w"> </span>fields<span class="w"> </span><span class="se">\</span>
<span class="w">  </span>-e<span class="w"> </span>ip.src<span class="w"> </span>-e<span class="w"> </span>dns.qry.name

<span class="c1"># 파일 전송 추출</span>
tshark<span class="w"> </span>-r<span class="w"> </span>capture.pcap<span class="w"> </span>--export-objects<span class="w"> </span>http,exported_files/

<span class="c1"># 대화 통계 표시</span>
tshark<span class="w"> </span>-r<span class="w"> </span>capture.pcap<span class="w"> </span>-z<span class="w"> </span>conv,ip<span class="w"> </span>-q
</code></pre></div>

<hr />
<h2 id="8">8. 사고 대응 플레이북<a class="header-link" href="#8" title="Permanent link">&para;</a></h2>
<h3 id="81">8.1 플레이북 템플릿<a class="header-link" href="#81" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code>┌──────────────────────────────────────────────────────────────────┐
│                  IR 플레이북 템플릿                                │
├──────────────────────────────────────────────────────────────────┤
│                                                                   │
│  플레이북: [사고 유형]                                            │
│  버전: 1.0                                                        │
│  최종 업데이트: [날짜]                                            │
│  담당자: [팀/담당자]                                              │
│  심각도: [P1-P4]                                                  │
│                                                                   │
│  트리거:                                                          │
│  [이 플레이북을 활성화하는 경고/조건]                             │
│                                                                   │
│  초기 트리아지 (첫 15분):                                         │
│  [ ] 1단계: ...                                                   │
│  [ ] 2단계: ...                                                   │
│  [ ] 3단계: 심각도 분류                                           │
│  [ ] 4단계: 사고 관리자에게 알림                                  │
│                                                                   │
│  격리 (첫 1-4시간):                                               │
│  [ ] 1단계: ...                                                   │
│  [ ] 2단계: ...                                                   │
│  [ ] 3단계: 증거 보존                                             │
│                                                                   │
│  제거:                                                            │
│  [ ] 1단계: ...                                                   │
│  [ ] 2단계: ...                                                   │
│                                                                   │
│  복구:                                                            │
│  [ ] 1단계: ...                                                   │
│  [ ] 2단계: 정상 작동 검증                                        │
│                                                                   │
│  커뮤니케이션:                                                    │
│  - 내부: [누구에게 언제 알릴지]                                  │
│  - 외부: [고객, 규제기관, 법 집행기관]                            │
│                                                                   │
│  에스컬레이션:                                                    │
│  - 조건 → 조치                                                    │
│                                                                   │
└──────────────────────────────────────────────────────────────────┘
</code></pre></div>

<h3 id="82">8.2 플레이북: 랜섬웨어 사고<a class="header-link" href="#82" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code>┌──────────────────────────────────────────────────────────────────┐
│            플레이북: 랜섬웨어 사고                                 │
├──────────────────────────────────────────────────────────────────┤
│  심각도: P1 (Critical)                                            │
│                                                                   │
│  트리거:                                                          │
│  - 엔드포인트에 랜섬 메모 표시됨                                  │
│  - 대량 파일 암호화 탐지                                          │
│  - EDR 경고: 랜섬웨어 행위                                        │
│                                                                   │
│  초기 트리아지 (첫 15분):                                         │
│  [ ] 1. 영향받은 시스템 전원 끄지 말 것                           │
│  [ ] 2. 영향받은 시스템을 네트워크에서 분리                       │
│         (이더넷 뽑기, WiFi 비활성화 - 종료하지 말 것)            │
│  [ ] 3. 랜섬 메모 문서화 (사진/스크린샷)                          │
│  [ ] 4. 가능하면 랜섬웨어 변종 식별                               │
│  [ ] 5. 범위 결정: 몇 개의 시스템이 영향을 받았는가?             │
│  [ ] 6. 사고 관리자에게 알림 → IR 팀 활성화                      │
│  [ ] 7. CISO / 경영진에게 알림                                   │
│                                                                   │
│  격리 (첫 1-4시간):                                               │
│  [ ] 1. 영향받은 네트워크 세그먼트 격리                           │
│  [ ] 2. 알려진 랜섬웨어 C2 IP/도메인 차단                        │
│  [ ] 3. 확산 방지를 위해 네트워크 공유 비활성화                   │
│  [ ] 4. 잠재적으로 침해된 모든 자격 증명 재설정                   │
│  [ ] 5. 영향받은 시스템의 메모리 덤프 캡처                        │
│  [ ] 6. 로그 보존 (SIEM, 방화벽, 엔드포인트)                     │
│  [ ] 7. 백업 무결성 확인 (백업이 영향받았는가?)                  │
│                                                                   │
│  제거:                                                            │
│  [ ] 1. 초기 감염 벡터 식별 (이메일, 익스플로잇 등)              │
│  [ ] 2. NoMoreRansom.org에서 복호화 도구 확인                    │
│  [ ] 3. 영향받은 모든 시스템에서 악성코드 제거                    │
│  [ ] 4. 감염을 허용한 취약점 패치                                 │
│  [ ] 5. 지속성 메커니즘에 대해 모든 시스템 스캔                   │
│                                                                   │
│  복구:                                                            │
│  [ ] 1. 클린하고 검증된 백업에서 복원                             │
│  [ ] 2. 정리할 수 없는 시스템 재구축                              │
│  [ ] 3. 재감염 모니터링하며 단계적으로 복원                       │
│  [ ] 4. 조직 전체 모든 패스워드 재설정                            │
│  [ ] 5. 복구 후 30일간 모니터링 강화                              │
│                                                                   │
│  커뮤니케이션:                                                    │
│  - 내부: 2시간 내 전체 알림                                       │
│  - 법무: 즉시 법률 고문 참여                                      │
│  - 보험: 사이버 보험사에 알림                                     │
│  - 법 집행기관: FBI IC3에 신고 제출                              │
│  - 규제기관: 규제 요구사항에 따라 (GDPR: 72시간)                 │
│  - 고객: 데이터 침해 확인 시                                      │
│                                                                   │
│  하지 말 것:                                                      │
│  - 법무 및 법 집행기관과 상담 없이 몸값 지불하지 말 것            │
│  - 법적 지침 없이 공격자와 통신하지 말 것                         │
│  - 증거 파괴하지 말 것                                            │
│  - 클린한지 확인하기 전에 백업에서 복원하지 말 것                 │
│                                                                   │
└──────────────────────────────────────────────────────────────────┘
</code></pre></div>

<h3 id="83">8.3 플레이북: 자격 증명 침해<a class="header-link" href="#83" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code>┌──────────────────────────────────────────────────────────────────┐
│         플레이북: 자격 증명 침해                                   │
├──────────────────────────────────────────────────────────────────┤
│  심각도: P2 (High)                                                │
│                                                                   │
│  트리거:                                                          │
│  - 다크웹 / 페이스트 사이트에서 자격 증명 발견                    │
│  - 사용자가 피싱 / 자격 증명 절도 신고                            │
│  - 불가능한 이동 경고                                             │
│  - MFA 우회 탐지                                                  │
│                                                                   │
│  초기 트리아지:                                                   │
│  [ ] 1. 영향받은 계정 식별                                        │
│  [ ] 2. 자격 증명 유형 결정 (패스워드, API 키, 토큰)             │
│  [ ] 3. 감사 로그에서 무단 접근 확인                              │
│  [ ] 4. MFA가 활성화되어 있었는지 확인                            │
│                                                                   │
│  격리:                                                            │
│  [ ] 1. 영향받은 계정의 패스워드 강제 재설정                      │
│  [ ] 2. 모든 활성 세션 / 토큰 취소                               │
│  [ ] 3. 해당하는 경우 API 키 교체                                 │
│  [ ] 4. 아직 활성화되지 않았다면 MFA 활성화                       │
│  [ ] 5. 의심스러운 소스 IP 차단                                   │
│  [ ] 6. 메일박스 규칙 확인 (전달, 삭제)                           │
│                                                                   │
│  조사:                                                            │
│  [ ] 1. 침해된 자격 증명으로 수행된 모든 조치 검토                │
│  [ ] 2. 측면 이동 확인 (다른 시스템 접근)                         │
│  [ ] 3. 데이터 접근 / 유출 확인                                   │
│  [ ] 4. 자격 증명이 어떻게 침해되었는지 식별                      │
│  [ ] 5. 자격 증명이 다른 서비스에서 재사용되었는지 확인           │
│                                                                   │
│  복구:                                                            │
│  [ ] 1. 계정이 보안되었는지 검증 (새 패스워드 + MFA)              │
│  [ ] 2. 무단 변경 사항 되돌림                                     │
│  [ ] 3. 사고를 사용자에게 알리고 보안 교육 요구                   │
│  [ ] 4. 30일간 계정 모니터링                                      │
│                                                                   │
└──────────────────────────────────────────────────────────────────┘
</code></pre></div>

<hr />
<h2 id="9">9. 사고 후 검토 템플릿<a class="header-link" href="#9" title="Permanent link">&para;</a></h2>
<div class="highlight"><pre><span></span><code><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">incident_report.py - 사고 후 검토 보고서를 생성합니다.</span>
<span class="sd">&quot;&quot;&quot;</span>

<span class="kn">from</span><span class="w"> </span><span class="nn">dataclasses</span><span class="w"> </span><span class="kn">import</span> <span class="n">dataclass</span><span class="p">,</span> <span class="n">field</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">datetime</span><span class="w"> </span><span class="kn">import</span> <span class="n">datetime</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">typing</span><span class="w"> </span><span class="kn">import</span> <span class="n">Optional</span>


<span class="nd">@dataclass</span>
<span class="k">class</span><span class="w"> </span><span class="nc">TimelineEvent</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;사고 타임라인의 단일 이벤트.&quot;&quot;&quot;</span>
    <span class="n">timestamp</span><span class="p">:</span> <span class="nb">str</span>
    <span class="n">description</span><span class="p">:</span> <span class="nb">str</span>
    <span class="n">actor</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>        <span class="c1"># 조치를 수행한 사람</span>
    <span class="n">evidence</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>     <span class="c1"># 뒷받침하는 증거</span>


<span class="nd">@dataclass</span>
<span class="k">class</span><span class="w"> </span><span class="nc">ActionItem</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;사고 검토의 후속 조치.&quot;&quot;&quot;</span>
    <span class="n">description</span><span class="p">:</span> <span class="nb">str</span>
    <span class="n">owner</span><span class="p">:</span> <span class="nb">str</span>
    <span class="n">due_date</span><span class="p">:</span> <span class="nb">str</span>
    <span class="n">priority</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;MEDIUM&quot;</span>  <span class="c1"># HIGH, MEDIUM, LOW</span>
    <span class="n">status</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;OPEN&quot;</span>      <span class="c1"># OPEN, IN_PROGRESS, DONE</span>


<span class="nd">@dataclass</span>
<span class="k">class</span><span class="w"> </span><span class="nc">IncidentReport</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;완전한 사고 후 검토 보고서.&quot;&quot;&quot;</span>
    <span class="c1"># 메타데이터</span>
    <span class="n">incident_id</span><span class="p">:</span> <span class="nb">str</span>
    <span class="n">title</span><span class="p">:</span> <span class="nb">str</span>
    <span class="n">severity</span><span class="p">:</span> <span class="nb">str</span>
    <span class="n">status</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;CLOSED&quot;</span>
    <span class="n">report_date</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
    <span class="n">report_author</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>

    <span class="c1"># 타임라인</span>
    <span class="n">detected_at</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
    <span class="n">contained_at</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
    <span class="n">eradicated_at</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
    <span class="n">recovered_at</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
    <span class="n">closed_at</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>

    <span class="c1"># 상세</span>
    <span class="n">summary</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
    <span class="n">root_cause</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
    <span class="n">impact</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
    <span class="n">affected_systems</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="n">field</span><span class="p">(</span><span class="n">default_factory</span><span class="o">=</span><span class="nb">list</span><span class="p">)</span>
    <span class="n">affected_users</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="n">data_compromised</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>

    <span class="c1"># 분석</span>
    <span class="n">attack_vector</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
    <span class="n">attacker_info</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
    <span class="n">timeline</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="n">TimelineEvent</span><span class="p">]</span> <span class="o">=</span> <span class="n">field</span><span class="p">(</span><span class="n">default_factory</span><span class="o">=</span><span class="nb">list</span><span class="p">)</span>

    <span class="c1"># 교훈</span>
    <span class="n">what_went_well</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="n">field</span><span class="p">(</span><span class="n">default_factory</span><span class="o">=</span><span class="nb">list</span><span class="p">)</span>
    <span class="n">what_went_wrong</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="n">field</span><span class="p">(</span><span class="n">default_factory</span><span class="o">=</span><span class="nb">list</span><span class="p">)</span>
    <span class="n">action_items</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="n">ActionItem</span><span class="p">]</span> <span class="o">=</span> <span class="n">field</span><span class="p">(</span><span class="n">default_factory</span><span class="o">=</span><span class="nb">list</span><span class="p">)</span>

    <span class="c1"># 메트릭</span>
    <span class="n">time_to_detect</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>       <span class="c1"># 침해부터 탐지까지의 시간</span>
    <span class="n">time_to_contain</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>      <span class="c1"># 탐지부터 격리까지의 시간</span>
    <span class="n">time_to_recover</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>      <span class="c1"># 격리부터 복구까지의 시간</span>
    <span class="n">total_duration</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>       <span class="c1"># 총 사고 지속 시간</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">__post_init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">report_date</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">report_date</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">()</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s2">&quot;%Y-%m-</span><span class="si">%d</span><span class="s2">&quot;</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">generate_markdown</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Markdown 보고서를 생성합니다.&quot;&quot;&quot;</span>
        <span class="n">lines</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="n">lines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;# 사고 보고서: </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">incident_id</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="n">lines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">**제목**: </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">title</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="n">lines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;**심각도**: </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">severity</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="n">lines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;**상태**: </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">status</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="n">lines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;**보고서 작성일**: </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">report_date</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="n">lines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;**작성자**: </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">report_author</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

        <span class="c1"># 요약</span>
        <span class="n">lines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">## 요약</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="n">lines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">summary</span><span class="p">)</span>

        <span class="c1"># 영향</span>
        <span class="n">lines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">## 영향</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="n">lines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">impact</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">affected_systems</span><span class="p">:</span>
            <span class="n">lines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">**영향받은 시스템**: </span><span class="si">{</span><span class="s1">&#39;, &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">affected_systems</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="n">lines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;**영향받은 사용자**: </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">affected_users</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">data_compromised</span><span class="p">:</span>
            <span class="n">lines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;**침해된 데이터**: </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">data_compromised</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

        <span class="c1"># 타임라인</span>
        <span class="n">lines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">## 타임라인</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="n">lines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;| 시간 | 이벤트 | 담당자 |&quot;</span><span class="p">)</span>
        <span class="n">lines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;|------|-------|-------|&quot;</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">event</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">timeline</span><span class="p">:</span>
            <span class="n">lines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;| </span><span class="si">{</span><span class="n">event</span><span class="o">.</span><span class="n">timestamp</span><span class="si">}</span><span class="s2"> | </span><span class="si">{</span><span class="n">event</span><span class="o">.</span><span class="n">description</span><span class="si">}</span><span class="s2"> | </span><span class="si">{</span><span class="n">event</span><span class="o">.</span><span class="n">actor</span><span class="si">}</span><span class="s2"> |&quot;</span>
            <span class="p">)</span>

        <span class="c1"># 주요 메트릭</span>
        <span class="n">lines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">## 주요 메트릭</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="n">lines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;- **탐지 시간**: </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">time_to_detect</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="n">lines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;- **격리 시간**: </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">time_to_contain</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="n">lines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;- **복구 시간**: </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">time_to_recover</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="n">lines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;- **총 지속 시간**: </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">total_duration</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

        <span class="c1"># 근본 원인</span>
        <span class="n">lines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">## 근본 원인 분석</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="n">lines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">root_cause</span><span class="p">)</span>
        <span class="n">lines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">**공격 벡터**: </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">attack_vector</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

        <span class="c1"># 교훈</span>
        <span class="n">lines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">## 교훈</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="n">lines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;### 잘된 점</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">what_went_well</span><span class="p">:</span>
            <span class="n">lines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;- </span><span class="si">{</span><span class="n">item</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="n">lines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">### 개선이 필요한 점</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">what_went_wrong</span><span class="p">:</span>
            <span class="n">lines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;- </span><span class="si">{</span><span class="n">item</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

        <span class="c1"># 액션 아이템</span>
        <span class="n">lines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">## 액션 아이템</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="n">lines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;| # | 조치 | 담당자 | 마감일 | 우선순위 | 상태 |&quot;</span><span class="p">)</span>
        <span class="n">lines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;|---|--------|-------|----------|----------|--------|&quot;</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">action</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">action_items</span><span class="p">,</span> <span class="mi">1</span><span class="p">):</span>
            <span class="n">lines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;| </span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s2"> | </span><span class="si">{</span><span class="n">action</span><span class="o">.</span><span class="n">description</span><span class="si">}</span><span class="s2"> | </span><span class="si">{</span><span class="n">action</span><span class="o">.</span><span class="n">owner</span><span class="si">}</span><span class="s2"> | &quot;</span>
                <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">action</span><span class="o">.</span><span class="n">due_date</span><span class="si">}</span><span class="s2"> | </span><span class="si">{</span><span class="n">action</span><span class="o">.</span><span class="n">priority</span><span class="si">}</span><span class="s2"> | </span><span class="si">{</span><span class="n">action</span><span class="o">.</span><span class="n">status</span><span class="si">}</span><span class="s2"> |&quot;</span>
            <span class="p">)</span>

        <span class="k">return</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">lines</span><span class="p">)</span>


<span class="c1"># ─── 사용 예제 ───</span>

<span class="k">def</span><span class="w"> </span><span class="nf">create_sample_report</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="n">IncidentReport</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;데모를 위한 샘플 사고 보고서를 생성합니다.&quot;&quot;&quot;</span>
    <span class="n">report</span> <span class="o">=</span> <span class="n">IncidentReport</span><span class="p">(</span>
        <span class="n">incident_id</span><span class="o">=</span><span class="s2">&quot;IR-2025-0042&quot;</span><span class="p">,</span>
        <span class="n">title</span><span class="o">=</span><span class="s2">&quot;침해된 API 키를 통한 무단 접근&quot;</span><span class="p">,</span>
        <span class="n">severity</span><span class="o">=</span><span class="s2">&quot;P2 - High&quot;</span><span class="p">,</span>
        <span class="n">report_author</span><span class="o">=</span><span class="s2">&quot;보안팀&quot;</span><span class="p">,</span>
        <span class="n">summary</span><span class="o">=</span><span class="p">(</span>
            <span class="s2">&quot;2025년 1월 15일, 무단 당사자가 침해된 API 키를 사용하여 &quot;</span>
            <span class="s2">&quot;프로덕션 API에 접근했습니다. 키가 공개 GitHub 저장소에 &quot;</span>
            <span class="s2">&quot;실수로 커밋되었습니다. 공격자는 탐지되기 전 약 2시간 동안 &quot;</span>
            <span class="s2">&quot;고객 주문 데이터에 접근했습니다.&quot;</span>
        <span class="p">),</span>
        <span class="n">root_cause</span><span class="o">=</span><span class="p">(</span>
            <span class="s2">&quot;개발자가 1월 10일 공개 GitHub 저장소에 API 키를 커밋했습니다. &quot;</span>
            <span class="s2">&quot;키가 자동화된 봇에 의해 스크랩되어 1월 15일 프로덕션 API &quot;</span>
            <span class="s2">&quot;접근에 사용되었습니다. 개발자 머신에 비밀 탐지를 위한 &quot;</span>
            <span class="s2">&quot;pre-commit hook이 구성되지 않았습니다.&quot;</span>
        <span class="p">),</span>
        <span class="n">impact</span><span class="o">=</span><span class="p">(</span>
            <span class="s2">&quot;약 1,200명의 고객에 대한 고객 주문 데이터(이름, 주소, 주문 기록)가 &quot;</span>
            <span class="s2">&quot;잠재적으로 접근되었습니다. 결제 카드 데이터는 노출되지 않았습니다 &quot;</span>
            <span class="s2">&quot;(별도 저장). 데이터 수정의 증거는 없습니다.&quot;</span>
        <span class="p">),</span>
        <span class="n">attack_vector</span><span class="o">=</span><span class="s2">&quot;공개 Git 저장소에서 침해된 API 키&quot;</span><span class="p">,</span>
        <span class="n">affected_systems</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;api-prod-01&quot;</span><span class="p">,</span> <span class="s2">&quot;api-prod-02&quot;</span><span class="p">,</span> <span class="s2">&quot;orders-db&quot;</span><span class="p">],</span>
        <span class="n">affected_users</span><span class="o">=</span><span class="mi">1200</span><span class="p">,</span>
        <span class="n">data_compromised</span><span class="o">=</span><span class="s2">&quot;고객 이름, 주소, 주문 기록&quot;</span><span class="p">,</span>
        <span class="n">detected_at</span><span class="o">=</span><span class="s2">&quot;2025-01-15 14:30 UTC&quot;</span><span class="p">,</span>
        <span class="n">contained_at</span><span class="o">=</span><span class="s2">&quot;2025-01-15 14:45 UTC&quot;</span><span class="p">,</span>
        <span class="n">eradicated_at</span><span class="o">=</span><span class="s2">&quot;2025-01-15 16:00 UTC&quot;</span><span class="p">,</span>
        <span class="n">recovered_at</span><span class="o">=</span><span class="s2">&quot;2025-01-15 18:00 UTC&quot;</span><span class="p">,</span>
        <span class="n">closed_at</span><span class="o">=</span><span class="s2">&quot;2025-01-20 09:00 UTC&quot;</span><span class="p">,</span>
        <span class="n">time_to_detect</span><span class="o">=</span><span class="s2">&quot;5일 (키 커밋부터 탐지까지)&quot;</span><span class="p">,</span>
        <span class="n">time_to_contain</span><span class="o">=</span><span class="s2">&quot;15분&quot;</span><span class="p">,</span>
        <span class="n">time_to_recover</span><span class="o">=</span><span class="s2">&quot;3.5시간&quot;</span><span class="p">,</span>
        <span class="n">total_duration</span><span class="o">=</span><span class="s2">&quot;5일&quot;</span><span class="p">,</span>
        <span class="n">timeline</span><span class="o">=</span><span class="p">[</span>
            <span class="n">TimelineEvent</span><span class="p">(</span>
                <span class="s2">&quot;2025-01-10 09:15&quot;</span><span class="p">,</span> <span class="s2">&quot;API 키가 공개 저장소에 커밋됨&quot;</span><span class="p">,</span>
                <span class="s2">&quot;개발자 A&quot;</span>
            <span class="p">),</span>
            <span class="n">TimelineEvent</span><span class="p">(</span>
                <span class="s2">&quot;2025-01-15 12:30&quot;</span><span class="p">,</span> <span class="s2">&quot;첫 무단 API 접근&quot;</span><span class="p">,</span>
                <span class="s2">&quot;미상의 공격자&quot;</span>
            <span class="p">),</span>
            <span class="n">TimelineEvent</span><span class="p">(</span>
                <span class="s2">&quot;2025-01-15 14:30&quot;</span><span class="p">,</span> <span class="s2">&quot;비정상적인 API 사용 경고 발생&quot;</span><span class="p">,</span>
                <span class="s2">&quot;SIEM&quot;</span>
            <span class="p">),</span>
            <span class="n">TimelineEvent</span><span class="p">(</span>
                <span class="s2">&quot;2025-01-15 14:35&quot;</span><span class="p">,</span> <span class="s2">&quot;SOC 분석가가 무단 접근 확인&quot;</span><span class="p">,</span>
                <span class="s2">&quot;분석가 B&quot;</span>
            <span class="p">),</span>
            <span class="n">TimelineEvent</span><span class="p">(</span>
                <span class="s2">&quot;2025-01-15 14:45&quot;</span><span class="p">,</span> <span class="s2">&quot;API 키 취소, 공격자 차단&quot;</span><span class="p">,</span>
                <span class="s2">&quot;분석가 B&quot;</span>
            <span class="p">),</span>
            <span class="n">TimelineEvent</span><span class="p">(</span>
                <span class="s2">&quot;2025-01-15 15:00&quot;</span><span class="p">,</span> <span class="s2">&quot;사고 관리자에게 알림, IR 활성화&quot;</span><span class="p">,</span>
                <span class="s2">&quot;IR 리드 C&quot;</span>
            <span class="p">),</span>
            <span class="n">TimelineEvent</span><span class="p">(</span>
                <span class="s2">&quot;2025-01-15 16:00&quot;</span><span class="p">,</span> <span class="s2">&quot;노출된 모든 API 키 교체&quot;</span><span class="p">,</span>
                <span class="s2">&quot;DevOps 팀&quot;</span>
            <span class="p">),</span>
            <span class="n">TimelineEvent</span><span class="p">(</span>
                <span class="s2">&quot;2025-01-15 18:00&quot;</span><span class="p">,</span> <span class="s2">&quot;모니터링 결과 추가 접근 없음 확인&quot;</span><span class="p">,</span>
                <span class="s2">&quot;SOC 팀&quot;</span>
            <span class="p">),</span>
        <span class="p">],</span>
        <span class="n">what_went_well</span><span class="o">=</span><span class="p">[</span>
            <span class="s2">&quot;비정상 패턴이 탐지되면 SIEM 경고가 빠르게 발생&quot;</span><span class="p">,</span>
            <span class="s2">&quot;API 키 취소가 신속했음 (경고부터 격리까지 15분)&quot;</span><span class="p">,</span>
            <span class="s2">&quot;IR 팀이 플레이북을 효과적으로 따름&quot;</span><span class="p">,</span>
            <span class="s2">&quot;SOC와 개발팀 간 원활한 커뮤니케이션&quot;</span><span class="p">,</span>
        <span class="p">],</span>
        <span class="n">what_went_wrong</span><span class="o">=</span><span class="p">[</span>
            <span class="s2">&quot;API 키가 탐지되기 전 5일간 공개 저장소에 있었음&quot;</span><span class="p">,</span>
            <span class="s2">&quot;GitHub 저장소에 자동화된 비밀 스캔 없음&quot;</span><span class="p">,</span>
            <span class="s2">&quot;모든 개발자 머신에 pre-commit hook이 강제되지 않음&quot;</span><span class="p">,</span>
            <span class="s2">&quot;API 키가 지나치게 광범위한 권한을 가짐 (모든 주문 읽기)&quot;</span><span class="p">,</span>
            <span class="s2">&quot;API 키에 IP 기반 접근 제한 없음&quot;</span><span class="p">,</span>
        <span class="p">],</span>
        <span class="n">action_items</span><span class="o">=</span><span class="p">[</span>
            <span class="n">ActionItem</span><span class="p">(</span>
                <span class="s2">&quot;모든 저장소에 Gitleaks 배포&quot;</span><span class="p">,</span>
                <span class="s2">&quot;DevOps 팀&quot;</span><span class="p">,</span> <span class="s2">&quot;2025-02-01&quot;</span><span class="p">,</span> <span class="s2">&quot;HIGH&quot;</span>
            <span class="p">),</span>
            <span class="n">ActionItem</span><span class="p">(</span>
                <span class="s2">&quot;detect-secrets로 pre-commit hook 강제&quot;</span><span class="p">,</span>
                <span class="s2">&quot;개발 리드&quot;</span><span class="p">,</span> <span class="s2">&quot;2025-02-15&quot;</span><span class="p">,</span> <span class="s2">&quot;HIGH&quot;</span>
            <span class="p">),</span>
            <span class="n">ActionItem</span><span class="p">(</span>
                <span class="s2">&quot;API 키 범위 제한 구현 (최소 권한)&quot;</span><span class="p">,</span>
                <span class="s2">&quot;API 팀&quot;</span><span class="p">,</span> <span class="s2">&quot;2025-03-01&quot;</span><span class="p">,</span> <span class="s2">&quot;HIGH&quot;</span>
            <span class="p">),</span>
            <span class="n">ActionItem</span><span class="p">(</span>
                <span class="s2">&quot;프로덕션 API 키에 IP 허용 목록 추가&quot;</span><span class="p">,</span>
                <span class="s2">&quot;인프라&quot;</span><span class="p">,</span> <span class="s2">&quot;2025-03-01&quot;</span><span class="p">,</span> <span class="s2">&quot;MEDIUM&quot;</span>
            <span class="p">),</span>
            <span class="n">ActionItem</span><span class="p">(</span>
                <span class="s2">&quot;개발자 보안 교육 실시 (비밀 관리)&quot;</span><span class="p">,</span>
                <span class="s2">&quot;보안팀&quot;</span><span class="p">,</span> <span class="s2">&quot;2025-02-28&quot;</span><span class="p">,</span> <span class="s2">&quot;MEDIUM&quot;</span>
            <span class="p">),</span>
            <span class="n">ActionItem</span><span class="p">(</span>
                <span class="s2">&quot;자동 키 교체 구현 (최대 90일)&quot;</span><span class="p">,</span>
                <span class="s2">&quot;DevOps 팀&quot;</span><span class="p">,</span> <span class="s2">&quot;2025-04-01&quot;</span><span class="p">,</span> <span class="s2">&quot;MEDIUM&quot;</span>
            <span class="p">),</span>
        <span class="p">],</span>
    <span class="p">)</span>

    <span class="k">return</span> <span class="n">report</span>


<span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s2">&quot;__main__&quot;</span><span class="p">:</span>
    <span class="n">report</span> <span class="o">=</span> <span class="n">create_sample_report</span><span class="p">()</span>
    <span class="n">markdown</span> <span class="o">=</span> <span class="n">report</span><span class="o">.</span><span class="n">generate_markdown</span><span class="p">()</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">markdown</span><span class="p">)</span>

    <span class="c1"># 파일로 저장</span>
    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="s2">&quot;incident_report_IR-2025-0042.md&quot;</span><span class="p">,</span> <span class="s2">&quot;w&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
        <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">markdown</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">보고서가 저장되었습니다: incident_report_IR-2025-0042.md&quot;</span><span class="p">)</span>
</code></pre></div>

<hr />
<h2 id="10">10. 연습 문제<a class="header-link" href="#10" title="Permanent link">&para;</a></h2>
<h3 id="1_1">연습 문제 1: 로그 분석<a class="header-link" href="#1_1" title="Permanent link">&para;</a></h3>
<p>다음 샘플 로그 엔트리가 주어졌을 때, 모든 보안 사고를 식별하십시오:</p>
<div class="highlight"><pre><span></span><code>192.168.1.50<span class="w"> </span>-<span class="w"> </span>-<span class="w"> </span>[15/Jan/2025:10:00:01<span class="w"> </span>+0000]<span class="w"> </span>&quot;GET<span class="w"> </span>/login<span class="w"> </span>HTTP/1.1&quot;<span class="w"> </span>200<span class="w"> </span>1234
192.168.1.50<span class="w"> </span>-<span class="w"> </span>-<span class="w"> </span>[15/Jan/2025:10:00:02<span class="w"> </span>+0000]<span class="w"> </span>&quot;POST<span class="w"> </span>/login<span class="w"> </span>HTTP/1.1&quot;<span class="w"> </span>401<span class="w"> </span>89
192.168.1.50<span class="w"> </span>-<span class="w"> </span>-<span class="w"> </span>[15/Jan/2025:10:00:03<span class="w"> </span>+0000]<span class="w"> </span>&quot;POST<span class="w"> </span>/login<span class="w"> </span>HTTP/1.1&quot;<span class="w"> </span>401<span class="w"> </span>89
192.168.1.50<span class="w"> </span>-<span class="w"> </span>-<span class="w"> </span>[15/Jan/2025:10:00:04<span class="w"> </span>+0000]<span class="w"> </span>&quot;POST<span class="w"> </span>/login<span class="w"> </span>HTTP/1.1&quot;<span class="w"> </span>401<span class="w"> </span>89
10.0.0.5<span class="w"> </span>-<span class="w"> </span>admin<span class="w"> </span>[15/Jan/2025:10:05:00<span class="w"> </span>+0000]<span class="w"> </span>&quot;GET<span class="w"> </span>/admin/users<span class="w"> </span>HTTP/1.1&quot;<span class="w"> </span>200<span class="w"> </span>5678
10.0.0.5<span class="w"> </span>-<span class="w"> </span>admin<span class="w"> </span>[15/Jan/2025:10:05:01<span class="w"> </span>+0000]<span class="w"> </span>&quot;GET<span class="w"> </span>/admin/export?table=users<span class="w"> </span>HTTP/1.1&quot;<span class="w"> </span>200<span class="w"> </span>890123
10.0.0.5<span class="w"> </span>-<span class="w"> </span>admin<span class="w"> </span>[15/Jan/2025:10:05:02<span class="w"> </span>+0000]<span class="w"> </span>&quot;GET<span class="w"> </span>/admin/export?table=payments<span class="w"> </span>HTTP/1.1&quot;<span class="w"> </span>200<span class="w"> </span>1234567
203.0.113.10<span class="w"> </span>-<span class="w"> </span>-<span class="w"> </span>[15/Jan/2025:10:10:00<span class="w"> </span>+0000]<span class="w"> </span>&quot;GET<span class="w"> </span>/../../etc/passwd<span class="w"> </span>HTTP/1.1&quot;<span class="w"> </span>403<span class="w"> </span>0
203.0.113.10<span class="w"> </span>-<span class="w"> </span>-<span class="w"> </span>[15/Jan/2025:10:10:01<span class="w"> </span>+0000]<span class="w"> </span>&quot;GET<span class="w"> </span>/search?q=&#39;<span class="w"> </span>OR<span class="w"> </span>1=1<span class="w"> </span>--<span class="w"> </span>HTTP/1.1&quot;<span class="w"> </span>500<span class="w"> </span>0
203.0.113.10<span class="w"> </span>-<span class="w"> </span>-<span class="w"> </span>[15/Jan/2025:10:10:02<span class="w"> </span>+0000]<span class="w"> </span>&quot;GET<span class="w"> </span>/search?q=<span class="nt">&lt;script&gt;</span>alert(1)<span class="nt">&lt;/script&gt;</span><span class="w"> </span>HTTP/1.1&quot;<span class="w"> </span>200<span class="w"> </span>456
</code></pre></div>

<p><strong>과제:</strong>
1. 각 의심스러운 패턴 분류 (무차별 대입, 순회, SQLi, XSS, 데이터 유출)
2. 각 발견 사항의 심각도 결정
3. 각 사항에 대한 간단한 사고 요약 작성</p>
<h3 id="2-ioc">연습 문제 2: IOC 데이터베이스<a class="header-link" href="#2-ioc" title="Permanent link">&para;</a></h3>
<p>다음을 포함하는 최소 20개의 IOC가 있는 JSON 파일을 생성하십시오:
- 5개의 악성 IP 주소
- 5개의 악성 도메인
- 5개의 악성코드 파일 해시
- 5개의 의심스러운 파일명</p>
<p>일치하는 항목이 있는 테스트 디렉토리를 생성하고 IOC 스캐너를 실행하십시오.</p>
<h3 id="3">연습 문제 3: 사고 대응 플레이북<a class="header-link" href="#3" title="Permanent link">&para;</a></h3>
<p><strong>SQL 인젝션 공격</strong>에 대한 완전한 사고 대응 플레이북을 작성하십시오:
1. 트리거 조건 정의 (SQLi를 나타내는 경고)
2. NIST의 4단계 모두 포함
3. 각 단계에서 사용할 구체적인 명령/도구 포함
4. 커뮤니케이션 및 에스컬레이션 절차 정의
5. 사고 후 체크리스트 포함</p>
<h3 id="4">연습 문제 4: 메모리 포렌식 분석<a class="header-link" href="#4" title="Permanent link">&para;</a></h3>
<p>Volatility 3를 연구하고 다음을 위한 메모리 덤프 분석 단계별 가이드를 작성하십시오:
1. 실행 중인 모든 프로세스 나열 및 의심스러운 프로세스 식별
2. 활성 네트워크 연결 찾기
3. 각 프로세스의 명령줄 인수 추출
4. 주입된 DLL 또는 코드 식별
5. 메모리에서 암호화 키 또는 패스워드 복구</p>
<h3 id="5_1">연습 문제 5: 사고 후 보고서<a class="header-link" href="#5_1" title="Permanent link">&para;</a></h3>
<p>이 레슨의 <code>IncidentReport</code> 클래스를 사용하여 다음 시나리오에 대한 완전한 사고 후 보고서를 생성하십시오:</p>
<blockquote>
<p>회사의 웹 애플리케이션이 일요일 오전 3시에 변조되었습니다. 공격자가 패치되지 않은 WordPress 플러그인의 알려진 CVE를 악용했습니다. 홈페이지를 정치적 메시지로 교체했습니다. 모니터링 시스템이 오전 3:15에 변경을 탐지했습니다. 당직 엔지니어가 오전 4:00에 백업에서 복원했습니다. 조사 결과 공격자가 백도어 관리자 계정도 생성한 것으로 밝혀졌습니다.</p>
</blockquote>
<h3 id="6-pcap">연습 문제 6: PCAP 분석<a class="header-link" href="#6-pcap" title="Permanent link">&para;</a></h3>
<p>CTF 또는 보안 교육 리소스(예: malware-traffic-analysis.net)에서 샘플 PCAP 파일을 다운로드하십시오. 이 레슨의 도구를 사용하여 분석하고 다음을 포함하는 네트워크 포렌식 보고서를 작성하십시오:
1. 주요 대화자 (가장 활발한 IP 주소)
2. DNS 쿼리 (특히 의심스러운 것)
3. HTTP 요청 (악성코드 다운로드, C2 통신 찾기)
4. 데이터 유출 지표</p>
<hr />
<h2 id="_5">요약<a class="header-link" href="#_5" title="Permanent link">&para;</a></h2>
<div class="highlight"><pre><span></span><code>┌──────────────────────────────────────────────────────────────────┐
│           사고 대응 핵심 요점                                      │
├──────────────────────────────────────────────────────────────────┤
│                                                                   │
│  1. 준비가 전부입니다: 사고가 발생하기 전에 계획, 도구,          │
│     훈련된 인력을 갖추십시오                                      │
│                                                                   │
│  2. NIST 생명주기를 따르십시오: 준비 → 탐지 →                    │
│     격리 → 제거 → 복구 → 교훈 학습                               │
│                                                                   │
│  3. 증거를 보존하십시오: 모든 것을 문서화하고, 보관 연속성을     │
│     유지하고, 모든 증거를 해싱하고, 복사본으로 작업하십시오      │
│                                                                   │
│  4. 로깅을 중앙화하십시오: 로그하지 않은 것은 조사할 수          │
│     없습니다. 로깅 인프라에 투자하십시오                          │
│                                                                   │
│  5. 탐지를 자동화하십시오: SIEM 상관 규칙과 IOC 스캔을           │
│     사용하여 탐지 시간을 줄이십시오                               │
│                                                                   │
│  6. 플레이북으로 연습하십시오: 작성되고 테스트된 플레이북은      │
│     대응 시간을 줄이고 일관성을 보장합니다                        │
│                                                                   │
│  7. 사고로부터 배우십시오: 사고 후 검토는 보안 개선을 위한       │
│     가장 가치 있는 소스입니다                                     │
│                                                                   │
│  8. 시간이 중요합니다: 활성 사고 중에는 분 단위가 중요합니다.    │
│     평균 탐지 시간(MTTD)과 평균 대응 시간(MTTR)이                │
│     핵심 메트릭입니다                                             │
│                                                                   │
└──────────────────────────────────────────────────────────────────┘
</code></pre></div>

<hr />
<p><strong>이전</strong>: <a href="13_Security_Testing.md">13. 보안 테스팅</a> | <strong>다음</strong>: <a href="15_Project_Secure_API.md">15. 프로젝트: 보안 REST API 구축</a></p>
    </div>

    
<div class="lesson-toolbar lesson-toolbar--bottom">
    <div class="toolbar-nav toolbar-nav--prev">
        
        <a href="/study/ko/Security/13_Security_Testing.html" class="nav-prev">
            <span class="nav-label">Previous</span>
            <span class="nav-title">보안 테스팅</span>
        </a>
        
    </div>
    <div class="toolbar-actions">
        <button class="btn btn-copy-link" data-action="copy-link" title="Copy link">
            <span class="icon">🔗</span>
            <span class="text">Copy link</span>
        </button>
        <a href="/study/ko/Security/" class="btn btn-topic-link" title="Back to topic list">
            <span class="icon">📋</span>
            <span class="text">Topic list</span>
        </a>
    </div>
    <div class="toolbar-nav toolbar-nav--next">
        
        <a href="/study/ko/Security/15_Project_Secure_API.html" class="nav-next">
            <span class="nav-label">Next</span>
            <span class="nav-title">프로젝트: 안전한 REST API 구축</span>
        </a>
        
    </div>
</div>


    <div class="toolbar-keyboard-hint">
        <kbd>&larr;</kbd> <kbd>&rarr;</kbd> to navigate between lessons
    </div>
</article>

<!-- Scroll to top floating button -->
<button class="scroll-to-top" id="scroll-to-top" title="Scroll to top" aria-label="Scroll to top">↑</button>

            </div>
        </main>
    </div>

    <script src="/study/static/js/app.js"></script>
    <script>
        function switchLanguage(newLang) {
            const path = window.location.pathname;
            const base = '/study';
            const currentLang = 'ko';
            const newPath = path.replace(base + '/' + currentLang + '/', base + '/' + newLang + '/');
            window.location.href = newPath + window.location.search;
        }
    </script>
    
<script>
    document.addEventListener('DOMContentLoaded', function() {
        // Copy link - independent feedback per button
        document.querySelectorAll('[data-action="copy-link"]').forEach(function(btn) {
            btn.addEventListener('click', function() {
                navigator.clipboard.writeText(window.location.href);
                var textEl = this.querySelector('.text');
                var originalText = textEl.textContent;
                textEl.textContent = 'Copied!';
                setTimeout(function() { textEl.textContent = originalText; }, 2000);
            });
        });

        // Add copy buttons to code blocks
        document.querySelectorAll('.lesson-content pre').forEach(function(pre) {
            var copyBtn = document.createElement('button');
            copyBtn.className = 'code-copy-btn';
            copyBtn.textContent = 'Copy';
            copyBtn.addEventListener('click', function() {
                var code = pre.querySelector('code');
                var text = code ? code.textContent : pre.textContent;
                navigator.clipboard.writeText(text);
                copyBtn.textContent = 'Copied!';
                setTimeout(function() { copyBtn.textContent = 'Copy'; }, 2000);
            });
            pre.style.position = 'relative';
            pre.appendChild(copyBtn);
        });

        // Scroll to top button
        var scrollBtn = document.getElementById('scroll-to-top');
        window.addEventListener('scroll', function() {
            scrollBtn.classList.toggle('visible', window.scrollY > 300);
        });
        scrollBtn.addEventListener('click', function() {
            window.scrollTo({ top: 0, behavior: 'smooth' });
        });

        // Keyboard shortcuts: left/right arrows for lesson navigation
        document.addEventListener('keydown', function(e) {
            var tag = document.activeElement.tagName;
            if (tag === 'INPUT' || tag === 'TEXTAREA' || tag === 'SELECT') return;

            if (e.key === 'ArrowLeft') {
                var prevLink = document.querySelector('.nav-prev');
                if (prevLink) prevLink.click();
            } else if (e.key === 'ArrowRight') {
                var nextLink = document.querySelector('.nav-next');
                if (nextLink) nextLink.click();
            }
        });
    });
</script>

</body>
</html>
{% endraw %}