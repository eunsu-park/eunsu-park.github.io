{% raw %}
<!DOCTYPE html>
<html lang="ko" data-theme="light">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>데이터베이스 확장 - Study Materials</title>
    <link rel="stylesheet" href="/study/static/css/style.css">
    <link rel="stylesheet" href="/study/static/css/highlight.css">
    <!-- KaTeX for LaTeX math rendering -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.16.11/dist/katex.min.css">
    <script defer src="https://cdn.jsdelivr.net/npm/katex@0.16.11/dist/katex.min.js"></script>
    <script defer src="https://cdn.jsdelivr.net/npm/katex@0.16.11/dist/contrib/auto-render.min.js"
        onload="renderMathInElement(document.body, {
            delimiters: [
                {left: '$$', right: '$$', display: true},
                {left: '$', right: '$', display: false}
            ],
            throwOnError: false
        });"></script>
    
</head>
<body>
    <div class="app-container">
        <!-- Sidebar -->
        <aside class="sidebar" id="sidebar">
            <div class="sidebar-header">
                <a href="/study/ko/" class="logo">Study Materials</a>
                <button class="sidebar-toggle" id="sidebar-toggle" aria-label="Toggle sidebar">
                    <span></span>
                </button>
            </div>

            <nav class="sidebar-nav">
                <a href="/study/ko/" class="nav-item ">
                    <span class="nav-icon">🏠</span>
                    <span class="nav-text">Home</span>
                </a>
                <a href="/study/examples/" class="nav-item ">
                    <span class="nav-icon">💻</span>
                    <span class="nav-text">Examples</span>
                </a>
            </nav>

            <div class="sidebar-search">
                <form action="/study/ko/search.html" method="get" id="search-form">
                    <input type="search" name="q" placeholder="Search..." id="search-sidebar-input">
                </form>
            </div>

            <!-- Language Selector -->
            <div class="sidebar-lang">
                <select id="lang-select" class="lang-selector" onchange="switchLanguage(this.value)">
                    
                    <option value="en" >
                        English
                    </option>
                    
                    <option value="ko" selected>
                        한국어
                    </option>
                    
                </select>
            </div>

            <div class="sidebar-footer">
                <button class="theme-toggle" id="theme-toggle" aria-label="Toggle theme">
                    <span class="theme-icon light">☀️</span>
                    <span class="theme-icon dark">🌙</span>
                </button>
            </div>
        </aside>

        <!-- Main Content -->
        <main class="main-content">
            <header class="main-header">
                <button class="menu-toggle" id="menu-toggle" aria-label="Open menu">
                    <span></span>
                </button>
                
<nav class="breadcrumb">
    <a href="/study/ko/">Topics</a>
    <span class="separator">/</span>
    <a href="/study/ko/System_Design/">System Design</a>
    <span class="separator">/</span>
    <span class="current">데이터베이스 확장</span>
</nav>

            </header>

            <div class="content">
                
<article class="lesson-article">
    <header class="lesson-header">
        <h1>데이터베이스 확장</h1>
    </header>

    
<div class="lesson-toolbar lesson-toolbar--top">
    <div class="toolbar-nav toolbar-nav--prev">
        
        <a href="/study/ko/System_Design/07_Distributed_Cache_Systems.html" class="nav-prev">
            <span class="nav-label">Previous</span>
            <span class="nav-title">분산 캐시 시스템</span>
        </a>
        
    </div>
    <div class="toolbar-actions">
        <button class="btn btn-copy-link" data-action="copy-link" title="Copy link">
            <span class="icon">🔗</span>
            <span class="text">Copy link</span>
        </button>
        <a href="/study/ko/System_Design/" class="btn btn-topic-link" title="Back to topic list">
            <span class="icon">📋</span>
            <span class="text">Topic list</span>
        </a>
    </div>
    <div class="toolbar-nav toolbar-nav--next">
        
        <a href="/study/ko/System_Design/09_Database_Replication.html" class="nav-next">
            <span class="nav-label">Next</span>
            <span class="nav-title">데이터베이스 복제 (Database Replication)</span>
        </a>
        
    </div>
</div>


    
    <nav class="toc" id="toc">
        <h2>Table of Contents</h2>
        <div class="toc">
<ul>
<li><a href="#_2">개요</a></li>
<li><a href="#_3">목차</a></li>
<li><a href="#1">1. 데이터베이스 확장의 필요성</a><ul>
<li><a href="#11">1.1 단일 데이터베이스의 한계</a></li>
<li><a href="#12">1.2 확장 전략 개요</a></li>
</ul>
</li>
<li><a href="#2-vs">2. 파티셔닝 vs 샤딩</a><ul>
<li><a href="#21-partitioning">2.1 파티셔닝 (Partitioning)</a></li>
<li><a href="#22-sharding">2.2 샤딩 (Sharding)</a></li>
<li><a href="#23">2.3 비교</a></li>
</ul>
</li>
<li><a href="#3">3. 샤딩 전략</a><ul>
<li><a href="#31-range">3.1 Range 기반 샤딩</a></li>
<li><a href="#32-hash">3.2 Hash 기반 샤딩</a></li>
<li><a href="#33-directory">3.3 Directory 기반 샤딩</a></li>
<li><a href="#34">3.4 전략 비교</a></li>
</ul>
</li>
<li><a href="#4">4. 샤딩 키 선택</a><ul>
<li><a href="#41">4.1 좋은 샤딩 키의 조건</a></li>
<li><a href="#42">4.2 샤딩 키 예시</a></li>
</ul>
</li>
<li><a href="#5">5. 핫스팟 방지</a><ul>
<li><a href="#51">5.1 핫스팟 문제</a></li>
<li><a href="#52">5.2 핫스팟 방지 전략</a></li>
</ul>
</li>
<li><a href="#6">6. 리밸런싱</a><ul>
<li><a href="#61">6.1 리밸런싱이 필요한 경우</a></li>
<li><a href="#62">6.2 리밸런싱 전략</a></li>
</ul>
</li>
<li><a href="#7">7. 연습 문제</a><ul>
<li><a href="#1_1">문제 1: 샤딩 전략 선택</a></li>
<li><a href="#2">문제 2: 샤딩 키 선택</a></li>
<li><a href="#3_1">문제 3: 핫스팟 해결</a></li>
<li><a href="#4_1">문제 4: 리밸런싱 계획</a></li>
</ul>
</li>
<li><a href="#_4">정답</a><ul>
<li><a href="#1_2">문제 1 정답</a></li>
<li><a href="#2_1">문제 2 정답</a></li>
<li><a href="#3_2">문제 3 정답</a></li>
<li><a href="#4_2">문제 4 정답</a></li>
</ul>
</li>
<li><a href="#8">8. 다음 단계</a><ul>
<li><a href="#_5">다음 레슨</a></li>
<li><a href="#_6">관련 레슨</a></li>
<li><a href="#_7">추천 실습</a></li>
</ul>
</li>
<li><a href="#9">9. 참고 자료</a><ul>
<li><a href="#_8">도서</a></li>
<li><a href="#_9">데이터베이스</a></li>
<li><a href="#_10">기업 사례</a></li>
</ul>
</li>
</ul>
</div>

    </nav>
    

    <div class="lesson-content markdown-body">
        <h1 id="_1">데이터베이스 확장<a class="header-link" href="#_1" title="Permanent link">&para;</a></h1>
<h2 id="_2">개요<a class="header-link" href="#_2" title="Permanent link">&para;</a></h2>
<p>이 문서에서는 데이터베이스 확장 전략을 다룹니다. 파티셔닝과 샤딩의 차이, 다양한 샤딩 전략(Range, Hash, Directory), 샤딩 키 선택, 핫스팟 방지, 그리고 리밸런싱을 학습합니다.</p>
<p><strong>난이도</strong>: ⭐⭐⭐
<strong>예상 학습 시간</strong>: 2-3시간
<strong>선수 지식</strong>: <a href="./07_Distributed_Cache_Systems.md">07_Distributed_Cache_Systems.md</a>, <a href="../PostgreSQL/00_Overview.md">PostgreSQL 폴더</a></p>
<hr />
<h2 id="_3">목차<a class="header-link" href="#_3" title="Permanent link">&para;</a></h2>
<ol>
<li><a href="#1-데이터베이스-확장의-필요성">데이터베이스 확장의 필요성</a></li>
<li><a href="#2-파티셔닝-vs-샤딩">파티셔닝 vs 샤딩</a></li>
<li><a href="#3-샤딩-전략">샤딩 전략</a></li>
<li><a href="#4-샤딩-키-선택">샤딩 키 선택</a></li>
<li><a href="#5-핫스팟-방지">핫스팟 방지</a></li>
<li><a href="#6-리밸런싱">리밸런싱</a></li>
<li><a href="#7-연습-문제">연습 문제</a></li>
<li><a href="#8-다음-단계">다음 단계</a></li>
<li><a href="#9-참고-자료">참고 자료</a></li>
</ol>
<hr />
<h2 id="1">1. 데이터베이스 확장의 필요성<a class="header-link" href="#1" title="Permanent link">&para;</a></h2>
<h3 id="11">1.1 단일 데이터베이스의 한계<a class="header-link" href="#11" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code>┌─────────────────────────────────────────────────────────────────┐
│                단일 데이터베이스 한계                            │
├─────────────────────────────────────────────────────────────────┤
│                                                                  │
│  트래픽/데이터 증가 시 문제:                                    │
│  ┌────────────────────────────────────────────────────────────┐ │
│  │                                                            │ │
│  │  1. 저장 용량 한계                                         │ │
│  │     • 단일 디스크/서버의 물리적 한계                       │ │
│  │     • 수십 TB 이상 데이터 관리 어려움                      │ │
│  │                                                            │ │
│  │  2. 처리량 한계                                            │ │
│  │     • 단일 서버 CPU/메모리 한계                            │ │
│  │     • 동시 연결 수 제한                                    │ │
│  │                                                            │ │
│  │  3. 응답 시간 증가                                         │ │
│  │     • 큰 테이블 → 느린 쿼리                                │ │
│  │     • 인덱스 크기 증가                                     │ │
│  │                                                            │ │
│  │  4. 단일 장애점 (SPOF)                                     │ │
│  │     • 서버 장애 = 전체 서비스 장애                         │ │
│  │                                                            │ │
│  └────────────────────────────────────────────────────────────┘ │
│                                                                  │
│  해결 방법:                                                     │
│  ┌────────────────────────────────────────────────────────────┐ │
│  │                                                            │ │
│  │  수직 확장 (Scale Up)                                      │ │
│  │    → 더 강력한 하드웨어 (한계 있음)                        │ │
│  │                                                            │ │
│  │  수평 확장 (Scale Out)                                     │ │
│  │    → 여러 서버로 분산 (파티셔닝/샤딩)                      │ │
│  │                                                            │ │
│  └────────────────────────────────────────────────────────────┘ │
│                                                                  │
└─────────────────────────────────────────────────────────────────┘
</code></pre></div>

<h3 id="12">1.2 확장 전략 개요<a class="header-link" href="#12" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code>┌─────────────────────────────────────────────────────────────────┐
│                   데이터베이스 확장 전략                         │
├─────────────────────────────────────────────────────────────────┤
│                                                                  │
│  ┌────────────────────────────────────────────────────────────┐ │
│  │                                                            │ │
│  │  1. 읽기 복제 (Read Replica)                               │ │
│  │     • 읽기 부하 분산                                       │ │
│  │     • 다음 레슨에서 자세히 다룸                            │ │
│  │                                                            │ │
│  │  2. 파티셔닝 (Partitioning)                                │ │
│  │     • 단일 DB 내에서 테이블 분할                           │ │
│  │     • PostgreSQL 네이티브 파티셔닝                         │ │
│  │                                                            │ │
│  │  3. 샤딩 (Sharding)                                        │ │
│  │     • 여러 DB 서버로 데이터 분산                           │ │
│  │     • 수평 확장의 핵심                                     │ │
│  │                                                            │ │
│  └────────────────────────────────────────────────────────────┘ │
│                                                                  │
│                    [단일 DB]                                    │
│                        │                                        │
│         ┌──────────────┼──────────────┐                         │
│         ▼              ▼              ▼                         │
│    [복제]         [파티셔닝]       [샤딩]                       │
│    읽기 확장      단일DB 분할     다중DB 분산                   │
│                                                                  │
└─────────────────────────────────────────────────────────────────┘
</code></pre></div>

<hr />
<h2 id="2-vs">2. 파티셔닝 vs 샤딩<a class="header-link" href="#2-vs" title="Permanent link">&para;</a></h2>
<h3 id="21-partitioning">2.1 파티셔닝 (Partitioning)<a class="header-link" href="#21-partitioning" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><span class="err">┌─────────────────────────────────────────────────────────────────┐</span>
<span class="err">│</span><span class="w">                      </span><span class="nt">파티셔닝</span><span class="w">                                    </span><span class="err">│</span>
<span class="err">├─────────────────────────────────────────────────────────────────┤</span>
<span class="err">│</span><span class="w">                                                                  </span><span class="err">│</span>
<span class="err">│</span><span class="w">  </span><span class="s2">&quot;하나의 DB 서버 내에서 테이블을 여러 파티션으로 분할&quot;</span><span class="w">          </span><span class="err">│</span>
<span class="err">│</span><span class="w">                                                                  </span><span class="err">│</span>
<span class="err">│</span><span class="w">  </span><span class="err">┌────────────────────────────────────────────────────────────┐</span><span class="w"> </span><span class="err">│</span>
<span class="err">│</span><span class="w">  </span><span class="err">│</span><span class="w">                                                            </span><span class="err">│</span><span class="w"> </span><span class="err">│</span>
<span class="err">│</span><span class="w">  </span><span class="err">│</span><span class="w">  </span><span class="err">┌───────────────────────────────────────────────────────┐</span><span class="w"> </span><span class="err">│</span><span class="w"> </span><span class="err">│</span>
<span class="err">│</span><span class="w">  </span><span class="err">│</span><span class="w">  </span><span class="err">│</span><span class="w">              </span><span class="nt">Database</span><span class="w"> </span><span class="nt">Server</span><span class="w">                          </span><span class="err">│</span><span class="w"> </span><span class="err">│</span><span class="w"> </span><span class="err">│</span>
<span class="err">│</span><span class="w">  </span><span class="err">│</span><span class="w">  </span><span class="err">│</span><span class="w">                                                       </span><span class="err">│</span><span class="w"> </span><span class="err">│</span><span class="w"> </span><span class="err">│</span>
<span class="err">│</span><span class="w">  </span><span class="err">│</span><span class="w">  </span><span class="err">│</span><span class="w">  </span><span class="err">┌─────────────────────────────────────────────────┐</span><span class="w">  </span><span class="err">│</span><span class="w"> </span><span class="err">│</span><span class="w"> </span><span class="err">│</span>
<span class="err">│</span><span class="w">  </span><span class="err">│</span><span class="w">  </span><span class="err">│</span><span class="w">  </span><span class="err">│</span><span class="w">              </span><span class="nt">orders</span><span class="w"> </span><span class="o">(</span><span class="nt">논리</span><span class="w"> </span><span class="nt">테이블</span><span class="o">)</span><span class="w">               </span><span class="err">│</span><span class="w">  </span><span class="err">│</span><span class="w"> </span><span class="err">│</span><span class="w"> </span><span class="err">│</span>
<span class="err">│</span><span class="w">  </span><span class="err">│</span><span class="w">  </span><span class="err">│</span><span class="w">  </span><span class="err">└─────────────────────────────────────────────────┘</span><span class="w">  </span><span class="err">│</span><span class="w"> </span><span class="err">│</span><span class="w"> </span><span class="err">│</span>
<span class="err">│</span><span class="w">  </span><span class="err">│</span><span class="w">  </span><span class="err">│</span><span class="w">                        </span><span class="err">│</span><span class="w">                              </span><span class="err">│</span><span class="w"> </span><span class="err">│</span><span class="w"> </span><span class="err">│</span>
<span class="err">│</span><span class="w">  </span><span class="err">│</span><span class="w">  </span><span class="err">│</span><span class="w">         </span><span class="err">┌──────────────┼──────────────┐</span><span class="w">               </span><span class="err">│</span><span class="w"> </span><span class="err">│</span><span class="w"> </span><span class="err">│</span>
<span class="err">│</span><span class="w">  </span><span class="err">│</span><span class="w">  </span><span class="err">│</span><span class="w">         </span><span class="err">▼</span><span class="w">              </span><span class="err">▼</span><span class="w">              </span><span class="err">▼</span><span class="w">               </span><span class="err">│</span><span class="w"> </span><span class="err">│</span><span class="w"> </span><span class="err">│</span>
<span class="err">│</span><span class="w">  </span><span class="err">│</span><span class="w">  </span><span class="err">│</span><span class="w">  </span><span class="err">┌───────────┐</span><span class="w">  </span><span class="err">┌───────────┐</span><span class="w">  </span><span class="err">┌───────────┐</span><span class="w">         </span><span class="err">│</span><span class="w"> </span><span class="err">│</span><span class="w"> </span><span class="err">│</span>
<span class="err">│</span><span class="w">  </span><span class="err">│</span><span class="w">  </span><span class="err">│</span><span class="w">  </span><span class="err">│</span><span class="nt">orders_2022</span><span class="err">│</span><span class="w">  </span><span class="err">│</span><span class="nt">orders_2023</span><span class="err">│</span><span class="w">  </span><span class="err">│</span><span class="nt">orders_2024</span><span class="err">│</span><span class="w">         </span><span class="err">│</span><span class="w"> </span><span class="err">│</span><span class="w"> </span><span class="err">│</span>
<span class="err">│</span><span class="w">  </span><span class="err">│</span><span class="w">  </span><span class="err">│</span><span class="w">  </span><span class="err">│</span><span class="w"> </span><span class="o">(</span><span class="nt">파티션1</span><span class="o">)</span><span class="w"> </span><span class="err">│</span><span class="w">  </span><span class="err">│</span><span class="w"> </span><span class="o">(</span><span class="nt">파티션2</span><span class="o">)</span><span class="w"> </span><span class="err">│</span><span class="w">  </span><span class="err">│</span><span class="w"> </span><span class="o">(</span><span class="nt">파티션3</span><span class="o">)</span><span class="w"> </span><span class="err">│</span><span class="w">         </span><span class="err">│</span><span class="w"> </span><span class="err">│</span><span class="w"> </span><span class="err">│</span>
<span class="err">│</span><span class="w">  </span><span class="err">│</span><span class="w">  </span><span class="err">│</span><span class="w">  </span><span class="err">└───────────┘</span><span class="w">  </span><span class="err">└───────────┘</span><span class="w">  </span><span class="err">└───────────┘</span><span class="w">         </span><span class="err">│</span><span class="w"> </span><span class="err">│</span><span class="w"> </span><span class="err">│</span>
<span class="err">│</span><span class="w">  </span><span class="err">│</span><span class="w">  </span><span class="err">│</span><span class="w">                                                       </span><span class="err">│</span><span class="w"> </span><span class="err">│</span><span class="w"> </span><span class="err">│</span>
<span class="err">│</span><span class="w">  </span><span class="err">│</span><span class="w">  </span><span class="err">└───────────────────────────────────────────────────────┘</span><span class="w"> </span><span class="err">│</span><span class="w"> </span><span class="err">│</span>
<span class="err">│</span><span class="w">  </span><span class="err">│</span><span class="w">                                                            </span><span class="err">│</span><span class="w"> </span><span class="err">│</span>
<span class="err">│</span><span class="w">  </span><span class="err">└────────────────────────────────────────────────────────────┘</span><span class="w"> </span><span class="err">│</span>
<span class="err">│</span><span class="w">                                                                  </span><span class="err">│</span>
<span class="err">│</span><span class="w">  </span><span class="nt">PostgreSQL</span><span class="w"> </span><span class="nt">예시</span><span class="o">:</span><span class="w">                                               </span><span class="err">│</span>
<span class="err">│</span><span class="w">  </span><span class="err">┌────────────────────────────────────────────────────────────┐</span><span class="w"> </span><span class="err">│</span>
<span class="err">│</span><span class="w">  </span><span class="err">│</span><span class="w">  </span><span class="nt">--</span><span class="w"> </span><span class="nt">파티션</span><span class="w"> </span><span class="nt">테이블</span><span class="w"> </span><span class="nt">생성</span><span class="w">                                     </span><span class="err">│</span><span class="w"> </span><span class="err">│</span>
<span class="err">│</span><span class="w">  </span><span class="err">│</span><span class="w">  </span><span class="nt">CREATE</span><span class="w"> </span><span class="nt">TABLE</span><span class="w"> </span><span class="nt">orders</span><span class="w"> </span><span class="o">(</span><span class="w">                                     </span><span class="err">│</span><span class="w"> </span><span class="err">│</span>
<span class="err">│</span><span class="w">  </span><span class="err">│</span><span class="w">      </span><span class="nt">id</span><span class="w"> </span><span class="nt">SERIAL</span><span class="o">,</span><span class="w">                                            </span><span class="err">│</span><span class="w"> </span><span class="err">│</span>
<span class="err">│</span><span class="w">  </span><span class="err">│</span><span class="w">      </span><span class="nt">order_date</span><span class="w"> </span><span class="nt">DATE</span><span class="o">,</span><span class="w">                                      </span><span class="err">│</span><span class="w"> </span><span class="err">│</span>
<span class="err">│</span><span class="w">  </span><span class="err">│</span><span class="w">      </span><span class="nt">amount</span><span class="w"> </span><span class="nt">DECIMAL</span><span class="w">                                        </span><span class="err">│</span><span class="w"> </span><span class="err">│</span>
<span class="err">│</span><span class="w">  </span><span class="err">│</span><span class="w">  </span><span class="o">)</span><span class="w"> </span><span class="nt">PARTITION</span><span class="w"> </span><span class="nt">BY</span><span class="w"> </span><span class="nt">RANGE</span><span class="w"> </span><span class="o">(</span><span class="nt">order_date</span><span class="o">);</span><span class="w">                        </span><span class="err">│</span><span class="w"> </span><span class="err">│</span>
<span class="err">│</span><span class="w">  </span><span class="err">│</span><span class="w">                                                            </span><span class="err">│</span><span class="w"> </span><span class="err">│</span>
<span class="err">│</span><span class="w">  </span><span class="err">│</span><span class="w">  </span><span class="nt">--</span><span class="w"> </span><span class="nt">파티션</span><span class="w"> </span><span class="nt">생성</span><span class="w">                                            </span><span class="err">│</span><span class="w"> </span><span class="err">│</span>
<span class="err">│</span><span class="w">  </span><span class="err">│</span><span class="w">  </span><span class="nt">CREATE</span><span class="w"> </span><span class="nt">TABLE</span><span class="w"> </span><span class="nt">orders_2024</span><span class="w"> </span><span class="nt">PARTITION</span><span class="w"> </span><span class="nt">OF</span><span class="w"> </span><span class="nt">orders</span><span class="w">              </span><span class="err">│</span><span class="w"> </span><span class="err">│</span>
<span class="err">│</span><span class="w">  </span><span class="err">│</span><span class="w">      </span><span class="nt">FOR</span><span class="w"> </span><span class="nt">VALUES</span><span class="w"> </span><span class="nt">FROM</span><span class="w"> </span><span class="o">(</span><span class="s1">&#39;2024-01-01&#39;</span><span class="o">)</span><span class="w"> </span><span class="nt">TO</span><span class="w"> </span><span class="o">(</span><span class="s1">&#39;2025-01-01&#39;</span><span class="o">);</span><span class="w">     </span><span class="err">│</span><span class="w"> </span><span class="err">│</span>
<span class="err">│</span><span class="w">  </span><span class="err">└────────────────────────────────────────────────────────────┘</span><span class="w"> </span><span class="err">│</span>
<span class="err">│</span><span class="w">                                                                  </span><span class="err">│</span>
<span class="err">│</span><span class="w">  </span><span class="nt">장점</span><span class="o">:</span><span class="w">                                                          </span><span class="err">│</span>
<span class="err">│</span><span class="w">  </span><span class="err">•</span><span class="w"> </span><span class="nt">쿼리</span><span class="w"> </span><span class="nt">성능</span><span class="w"> </span><span class="nt">향상</span><span class="w"> </span><span class="o">(</span><span class="nt">파티션</span><span class="w"> </span><span class="nt">프루닝</span><span class="o">)</span><span class="w">                               </span><span class="err">│</span>
<span class="err">│</span><span class="w">  </span><span class="err">•</span><span class="w"> </span><span class="nt">데이터</span><span class="w"> </span><span class="nt">관리</span><span class="w"> </span><span class="nt">용이</span><span class="w"> </span><span class="o">(</span><span class="nt">파티션별</span><span class="w"> </span><span class="nt">삭제</span><span class="o">/</span><span class="nt">백업</span><span class="o">)</span><span class="w">                        </span><span class="err">│</span>
<span class="err">│</span><span class="w">  </span><span class="err">•</span><span class="w"> </span><span class="nt">인덱스</span><span class="w"> </span><span class="nt">크기</span><span class="w"> </span><span class="nt">감소</span><span class="w">                                             </span><span class="err">│</span>
<span class="err">│</span><span class="w">                                                                  </span><span class="err">│</span>
<span class="err">│</span><span class="w">  </span><span class="nt">한계</span><span class="o">:</span><span class="w">                                                          </span><span class="err">│</span>
<span class="err">│</span><span class="w">  </span><span class="err">•</span><span class="w"> </span><span class="nt">여전히</span><span class="w"> </span><span class="nt">단일</span><span class="w"> </span><span class="nt">서버</span><span class="w"> </span><span class="o">(</span><span class="nt">용량</span><span class="o">,</span><span class="w"> </span><span class="nt">처리량</span><span class="w"> </span><span class="nt">한계</span><span class="o">)</span><span class="w">                         </span><span class="err">│</span>
<span class="err">│</span><span class="w">                                                                  </span><span class="err">│</span>
<span class="err">└─────────────────────────────────────────────────────────────────┘</span>
</code></pre></div>

<h3 id="22-sharding">2.2 샤딩 (Sharding)<a class="header-link" href="#22-sharding" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code>┌─────────────────────────────────────────────────────────────────┐
│                        샤딩                                      │
├─────────────────────────────────────────────────────────────────┤
│                                                                  │
│  &quot;여러 DB 서버로 데이터를 분산 저장&quot;                            │
│                                                                  │
│  ┌────────────────────────────────────────────────────────────┐ │
│  │                                                            │ │
│  │         ┌─────────────────────────────────────────┐        │ │
│  │         │           Application                   │        │ │
│  │         └──────────────────┬──────────────────────┘        │ │
│  │                            │                               │ │
│  │                   ┌────────┴────────┐                      │ │
│  │                   │  Shard Router   │                      │ │
│  │                   │  (샤드 결정)    │                      │ │
│  │                   └────────┬────────┘                      │ │
│  │                            │                               │ │
│  │         ┌──────────────────┼──────────────────┐            │ │
│  │         │                  │                  │            │ │
│  │         ▼                  ▼                  ▼            │ │
│  │  ┌────────────┐     ┌────────────┐     ┌────────────┐     │ │
│  │  │  Shard 1   │     │  Shard 2   │     │  Shard 3   │     │ │
│  │  │ (Server 1) │     │ (Server 2) │     │ (Server 3) │     │ │
│  │  │            │     │            │     │            │     │ │
│  │  │ user_id    │     │ user_id    │     │ user_id    │     │ │
│  │  │ 1-1000000  │     │ 1000001-   │     │ 2000001-   │     │ │
│  │  │            │     │ 2000000    │     │ 3000000    │     │ │
│  │  └────────────┘     └────────────┘     └────────────┘     │ │
│  │                                                            │ │
│  └────────────────────────────────────────────────────────────┘ │
│                                                                  │
│  장점:                                                          │
│  • 이론적으로 무한 확장 가능                                    │
│  • 각 샤드의 부하 감소                                          │
│  • 장애 격리                                                    │
│                                                                  │
│  단점:                                                          │
│  • 복잡도 증가                                                  │
│  • 크로스 샤드 쿼리 어려움                                      │
│  • 트랜잭션 제약                                                │
│  • 리밸런싱 어려움                                              │
│                                                                  │
└─────────────────────────────────────────────────────────────────┘
</code></pre></div>

<h3 id="23">2.3 비교<a class="header-link" href="#23" title="Permanent link">&para;</a></h3>
<table>
<thead>
<tr>
<th>항목</th>
<th>파티셔닝</th>
<th>샤딩</th>
</tr>
</thead>
<tbody>
<tr>
<td>위치</td>
<td>단일 서버 내</td>
<td>여러 서버</td>
</tr>
<tr>
<td>확장성</td>
<td>제한적</td>
<td>높음</td>
</tr>
<tr>
<td>복잡도</td>
<td>낮음</td>
<td>높음</td>
</tr>
<tr>
<td>트랜잭션</td>
<td>전체 가능</td>
<td>샤드 내만</td>
</tr>
<tr>
<td>JOIN</td>
<td>가능</td>
<td>크로스 샤드 어려움</td>
</tr>
<tr>
<td>관리</td>
<td>DB가 자동</td>
<td>애플리케이션이 관리</td>
</tr>
</tbody>
</table>
<hr />
<h2 id="3">3. 샤딩 전략<a class="header-link" href="#3" title="Permanent link">&para;</a></h2>
<h3 id="31-range">3.1 Range 기반 샤딩<a class="header-link" href="#31-range" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code>┌─────────────────────────────────────────────────────────────────┐
│                   Range 기반 샤딩                                │
├─────────────────────────────────────────────────────────────────┤
│                                                                  │
│  &quot;값의 범위에 따라 샤드 결정&quot;                                   │
│                                                                  │
│  ┌────────────────────────────────────────────────────────────┐ │
│  │                                                            │ │
│  │  user_id 기반 Range 샤딩:                                  │ │
│  │                                                            │ │
│  │  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐        │ │
│  │  │  Shard 1    │  │  Shard 2    │  │  Shard 3    │        │ │
│  │  │             │  │             │  │             │        │ │
│  │  │ user_id     │  │ user_id     │  │ user_id     │        │ │
│  │  │ 1 ~ 1M      │  │ 1M+1 ~ 2M   │  │ 2M+1 ~ 3M   │        │ │
│  │  │             │  │             │  │             │        │ │
│  │  └─────────────┘  └─────────────┘  └─────────────┘        │ │
│  │                                                            │ │
│  │  날짜 기반 Range 샤딩:                                     │ │
│  │                                                            │ │
│  │  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐        │ │
│  │  │  Shard 1    │  │  Shard 2    │  │  Shard 3    │        │ │
│  │  │             │  │             │  │             │        │ │
│  │  │ 2022년      │  │ 2023년      │  │ 2024년      │        │ │
│  │  │ 데이터      │  │ 데이터      │  │ 데이터      │        │ │
│  │  │             │  │             │  │             │        │ │
│  │  └─────────────┘  └─────────────┘  └─────────────┘        │ │
│  │                                                            │ │
│  └────────────────────────────────────────────────────────────┘ │
│                                                                  │
│  라우팅 로직:                                                   │
│  ┌────────────────────────────────────────────────────────────┐ │
│  │  def get_shard(user_id):                                   │ │
│  │      if user_id &lt;= 1_000_000:                              │ │
│  │          return &quot;shard_1&quot;                                  │ │
│  │      elif user_id &lt;= 2_000_000:                            │ │
│  │          return &quot;shard_2&quot;                                  │ │
│  │      else:                                                 │ │
│  │          return &quot;shard_3&quot;                                  │ │
│  └────────────────────────────────────────────────────────────┘ │
│                                                                  │
│  장점:                                                          │
│  • 범위 쿼리 효율적                                             │
│  • 구현 단순                                                    │
│                                                                  │
│  단점:                                                          │
│  • 핫스팟 발생 가능 (신규 사용자가 마지막 샤드에 몰림)          │
│  • 불균등 분배 가능                                             │
│                                                                  │
└─────────────────────────────────────────────────────────────────┘
</code></pre></div>

<h3 id="32-hash">3.2 Hash 기반 샤딩<a class="header-link" href="#32-hash" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code>┌─────────────────────────────────────────────────────────────────┐
│                    Hash 기반 샤딩                                │
├─────────────────────────────────────────────────────────────────┤
│                                                                  │
│  &quot;키의 해시값으로 샤드 결정&quot;                                    │
│                                                                  │
│  ┌────────────────────────────────────────────────────────────┐ │
│  │                                                            │ │
│  │  shard = hash(user_id) % N                                 │ │
│  │                                                            │ │
│  │  user_id: 12345                                            │ │
│  │  hash(12345) = 67890                                       │ │
│  │  67890 % 3 = 0 → Shard 0                                   │ │
│  │                                                            │ │
│  │  user_id: 12346                                            │ │
│  │  hash(12346) = 12347                                       │ │
│  │  12347 % 3 = 1 → Shard 1                                   │ │
│  │                                                            │ │
│  │  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐        │ │
│  │  │  Shard 0    │  │  Shard 1    │  │  Shard 2    │        │ │
│  │  │             │  │             │  │             │        │ │
│  │  │ user: 12345 │  │ user: 12346 │  │ user: 12347 │        │ │
│  │  │ user: 12348 │  │ user: 12349 │  │ user: 12350 │        │ │
│  │  │     ...     │  │     ...     │  │     ...     │        │ │
│  │  │             │  │             │  │             │        │ │
│  │  └─────────────┘  └─────────────┘  └─────────────┘        │ │
│  │                                                            │ │
│  └────────────────────────────────────────────────────────────┘ │
│                                                                  │
│  라우팅 로직:                                                   │
│  ┌────────────────────────────────────────────────────────────┐ │
│  │  def get_shard(user_id, num_shards=3):                     │ │
│  │      hash_value = hash(str(user_id))                       │ │
│  │      shard_id = hash_value % num_shards                    │ │
│  │      return f&quot;shard_{shard_id}&quot;                            │ │
│  └────────────────────────────────────────────────────────────┘ │
│                                                                  │
│  장점:                                                          │
│  • 균등 분배                                                    │
│  • 핫스팟 방지                                                  │
│                                                                  │
│  단점:                                                          │
│  • 범위 쿼리 어려움 (모든 샤드 조회 필요)                       │
│  • 샤드 추가/제거 시 대규모 재분배                              │
│  • → 일관성 해싱으로 해결                                       │
│                                                                  │
└─────────────────────────────────────────────────────────────────┘
</code></pre></div>

<h3 id="33-directory">3.3 Directory 기반 샤딩<a class="header-link" href="#33-directory" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code>┌─────────────────────────────────────────────────────────────────┐
│                 Directory 기반 샤딩                              │
├─────────────────────────────────────────────────────────────────┤
│                                                                  │
│  &quot;조회 테이블(디렉토리)로 샤드 결정&quot;                            │
│                                                                  │
│  ┌────────────────────────────────────────────────────────────┐ │
│  │                                                            │ │
│  │                   Application                              │ │
│  │                        │                                   │ │
│  │                        │ user_id: 12345                    │ │
│  │                        ▼                                   │ │
│  │              ┌──────────────────┐                          │ │
│  │              │ Directory Service│                          │ │
│  │              │ (Lookup Table)   │                          │ │
│  │              │                  │                          │ │
│  │              │ user_id │ shard  │                          │ │
│  │              │ ────────┼─────── │                          │ │
│  │              │ 12345   │ shard_2│                          │ │
│  │              │ 12346   │ shard_1│                          │ │
│  │              │ 12347   │ shard_3│                          │ │
│  │              │   ...   │  ...   │                          │ │
│  │              └─────────┬────────┘                          │ │
│  │                        │                                   │ │
│  │                        │ shard_2                           │ │
│  │                        ▼                                   │ │
│  │  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐        │ │
│  │  │  Shard 1    │  │  Shard 2    │  │  Shard 3    │        │ │
│  │  └─────────────┘  └──────┬──────┘  └─────────────┘        │ │
│  │                          │                                 │ │
│  │                          ▼                                 │ │
│  │                    user: 12345                             │ │
│  │                                                            │ │
│  └────────────────────────────────────────────────────────────┘ │
│                                                                  │
│  장점:                                                          │
│  • 유연한 데이터 이동                                           │
│  • 불균형 해소 용이                                             │
│  • 특정 사용자를 특정 샤드로 이동 가능                          │
│                                                                  │
│  단점:                                                          │
│  • 디렉토리 서비스가 SPOF                                       │
│  • 추가 조회 오버헤드                                           │
│  • 디렉토리 크기 증가                                           │
│                                                                  │
│  해결:                                                          │
│  • 디렉토리를 캐싱 (Redis)                                      │
│  • 디렉토리 복제                                                │
│                                                                  │
└─────────────────────────────────────────────────────────────────┘
</code></pre></div>

<h3 id="34">3.4 전략 비교<a class="header-link" href="#34" title="Permanent link">&para;</a></h3>
<table>
<thead>
<tr>
<th>전략</th>
<th>균등 분배</th>
<th>범위 쿼리</th>
<th>리밸런싱</th>
<th>복잡도</th>
</tr>
</thead>
<tbody>
<tr>
<td>Range</td>
<td>낮음</td>
<td>좋음</td>
<td>어려움</td>
<td>낮음</td>
</tr>
<tr>
<td>Hash</td>
<td>좋음</td>
<td>어려움</td>
<td>어려움</td>
<td>낮음</td>
</tr>
<tr>
<td>Directory</td>
<td>좋음</td>
<td>가능</td>
<td>쉬움</td>
<td>높음</td>
</tr>
<tr>
<td>Consistent Hash</td>
<td>좋음</td>
<td>어려움</td>
<td>쉬움</td>
<td>중간</td>
</tr>
</tbody>
</table>
<hr />
<h2 id="4">4. 샤딩 키 선택<a class="header-link" href="#4" title="Permanent link">&para;</a></h2>
<h3 id="41">4.1 좋은 샤딩 키의 조건<a class="header-link" href="#41" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code>┌─────────────────────────────────────────────────────────────────┐
│                  좋은 샤딩 키 조건                               │
├─────────────────────────────────────────────────────────────────┤
│                                                                  │
│  1. 높은 카디널리티 (High Cardinality)                          │
│  ┌────────────────────────────────────────────────────────────┐ │
│  │                                                            │ │
│  │  좋음: user_id (수백만 개의 고유 값)                       │ │
│  │  나쁨: country (수십 개)                                   │ │
│  │  나쁨: status (몇 개)                                      │ │
│  │                                                            │ │
│  │  → 고유 값이 많아야 균등 분배 가능                         │ │
│  │                                                            │ │
│  └────────────────────────────────────────────────────────────┘ │
│                                                                  │
│  2. 균등 분포 (Even Distribution)                               │
│  ┌────────────────────────────────────────────────────────────┐ │
│  │                                                            │ │
│  │  좋음: 해시된 user_id                                      │ │
│  │  나쁨: 생성일 (신규 데이터가 한 샤드에 집중)               │ │
│  │  나쁨: 인기 상품 ID (특정 상품에 쿼리 집중)                │ │
│  │                                                            │ │
│  │  → 데이터와 쿼리가 균등하게 분배되어야 함                  │ │
│  │                                                            │ │
│  └────────────────────────────────────────────────────────────┘ │
│                                                                  │
│  3. 쿼리 패턴과 일치                                            │
│  ┌────────────────────────────────────────────────────────────┐ │
│  │                                                            │ │
│  │  대부분 쿼리: &quot;WHERE user_id = ?&quot;                          │ │
│  │  → user_id를 샤딩 키로!                                    │ │
│  │                                                            │ │
│  │  대부분 쿼리: &quot;WHERE order_date BETWEEN ... AND ...&quot;       │ │
│  │  → order_date를 샤딩 키로!                                 │ │
│  │                                                            │ │
│  │  → 자주 사용하는 쿼리가 단일 샤드에서 처리되도록           │ │
│  │                                                            │ │
│  └────────────────────────────────────────────────────────────┘ │
│                                                                  │
│  4. 불변성 (Immutability)                                       │
│  ┌────────────────────────────────────────────────────────────┐ │
│  │                                                            │ │
│  │  좋음: user_id (변하지 않음)                               │ │
│  │  나쁨: email (사용자가 변경할 수 있음)                     │ │
│  │  나쁨: status (변경됨)                                     │ │
│  │                                                            │ │
│  │  → 샤딩 키 변경 = 데이터 이동 (비용 큼)                    │ │
│  │                                                            │ │
│  └────────────────────────────────────────────────────────────┘ │
│                                                                  │
└─────────────────────────────────────────────────────────────────┘
</code></pre></div>

<h3 id="42">4.2 샤딩 키 예시<a class="header-link" href="#42" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code>┌─────────────────────────────────────────────────────────────────┐
│                   도메인별 샤딩 키 예시                          │
├─────────────────────────────────────────────────────────────────┤
│                                                                  │
│  소셜 미디어 (사용자 중심):                                     │
│  ┌────────────────────────────────────────────────────────────┐ │
│  │  • users: user_id                                          │ │
│  │  • posts: user_id (작성자)                                 │ │
│  │  • followers: user_id (팔로우 당하는 사람)                 │ │
│  │  • messages: conversation_id                               │ │
│  │                                                            │ │
│  │  → 사용자별 데이터가 같은 샤드에!                          │ │
│  └────────────────────────────────────────────────────────────┘ │
│                                                                  │
│  이커머스 (테넌트 중심):                                        │
│  ┌────────────────────────────────────────────────────────────┐ │
│  │  • products: merchant_id                                   │ │
│  │  • orders: user_id 또는 order_id                           │ │
│  │  • reviews: product_id                                     │ │
│  │                                                            │ │
│  │  주의: orders를 user_id로 하면                             │ │
│  │        판매자 주문 조회 시 모든 샤드 조회 필요             │ │
│  └────────────────────────────────────────────────────────────┘ │
│                                                                  │
│  SaaS (테넌트 중심):                                            │
│  ┌────────────────────────────────────────────────────────────┐ │
│  │  • 모든 테이블: tenant_id                                  │ │
│  │                                                            │ │
│  │  → 테넌트별로 완전 격리                                    │ │
│  │  → 크로스 테넌트 쿼리 불필요                               │ │
│  └────────────────────────────────────────────────────────────┘ │
│                                                                  │
│  로그/분석 (시계열):                                            │
│  ┌────────────────────────────────────────────────────────────┐ │
│  │  • logs: timestamp (Range 샤딩)                            │ │
│  │  • metrics: (device_id, timestamp)                         │ │
│  │                                                            │ │
│  │  → 범위 쿼리에 효율적                                      │ │
│  │  → 오래된 샤드 삭제 용이                                   │ │
│  └────────────────────────────────────────────────────────────┘ │
│                                                                  │
└─────────────────────────────────────────────────────────────────┘
</code></pre></div>

<hr />
<h2 id="5">5. 핫스팟 방지<a class="header-link" href="#5" title="Permanent link">&para;</a></h2>
<h3 id="51">5.1 핫스팟 문제<a class="header-link" href="#51" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code>┌─────────────────────────────────────────────────────────────────┐
│                    핫스팟 문제                                   │
├─────────────────────────────────────────────────────────────────┤
│                                                                  │
│  &quot;특정 샤드에 트래픽/데이터가 집중되는 현상&quot;                    │
│                                                                  │
│  ┌────────────────────────────────────────────────────────────┐ │
│  │                                                            │ │
│  │  정상:                                                     │ │
│  │  ┌───────┐ ┌───────┐ ┌───────┐                            │ │
│  │  │Shard 1│ │Shard 2│ │Shard 3│                            │ │
│  │  │  33%  │ │  33%  │ │  33%  │                            │ │
│  │  └───────┘ └───────┘ └───────┘                            │ │
│  │                                                            │ │
│  │  핫스팟:                                                   │ │
│  │  ┌───────┐ ┌───────┐ ┌───────┐                            │ │
│  │  │Shard 1│ │Shard 2│ │Shard 3│                            │ │
│  │  │  80%  │ │  10%  │ │  10%  │ 💥 과부하!                  │ │
│  │  └───────┘ └───────┘ └───────┘                            │ │
│  │                                                            │ │
│  └────────────────────────────────────────────────────────────┘ │
│                                                                  │
│  발생 원인:                                                     │
│  ┌────────────────────────────────────────────────────────────┐ │
│  │                                                            │ │
│  │  1. Range 샤딩 + 순차 키                                   │ │
│  │     → 신규 데이터가 마지막 샤드에 집중                     │ │
│  │                                                            │ │
│  │  2. 인기 있는 엔티티                                       │ │
│  │     → 유명인 계정, 인기 상품                               │ │
│  │                                                            │ │
│  │  3. 시간 기반 패턴                                         │ │
│  │     → 특정 시간대에 특정 샤드 집중                         │ │
│  │                                                            │ │
│  └────────────────────────────────────────────────────────────┘ │
│                                                                  │
└─────────────────────────────────────────────────────────────────┘
</code></pre></div>

<h3 id="52">5.2 핫스팟 방지 전략<a class="header-link" href="#52" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code>┌─────────────────────────────────────────────────────────────────┐
│                  핫스팟 방지 전략                                │
├─────────────────────────────────────────────────────────────────┤
│                                                                  │
│  1. Hash 기반 샤딩 사용                                         │
│  ┌────────────────────────────────────────────────────────────┐ │
│  │                                                            │ │
│  │  Range 대신 Hash로 균등 분배                               │ │
│  │  user_id: 1, 2, 3 → 같은 샤드가 아니라 분산               │ │
│  │                                                            │ │
│  └────────────────────────────────────────────────────────────┘ │
│                                                                  │
│  2. 복합 샤딩 키                                                │
│  ┌────────────────────────────────────────────────────────────┐ │
│  │                                                            │ │
│  │  단일 키: user_id                                          │ │
│  │  → 인기 사용자가 핫스팟                                    │ │
│  │                                                            │ │
│  │  복합 키: (user_id, post_id)                               │ │
│  │  → 같은 사용자의 포스트도 분산                             │ │
│  │                                                            │ │
│  │  shard = hash(user_id + &quot;_&quot; + post_id) % N                 │ │
│  │                                                            │ │
│  └────────────────────────────────────────────────────────────┘ │
│                                                                  │
│  3. 솔팅 (Salting)                                              │
│  ┌────────────────────────────────────────────────────────────┐ │
│  │                                                            │ │
│  │  원래 키: celebrity_123                                    │ │
│  │  솔팅:   celebrity_123_0                                   │ │
│  │          celebrity_123_1                                   │ │
│  │          celebrity_123_2                                   │ │
│  │                                                            │ │
│  │  # 쓰기: 랜덤 솔트 추가                                    │ │
│  │  salt = random(0, 10)                                      │ │
│  │  key = f&quot;{user_id}_{salt}&quot;                                 │ │
│  │                                                            │ │
│  │  # 읽기: 모든 솔트 조회 후 합치기                          │ │
│  │  for salt in range(10):                                    │ │
│  │      results += query(f&quot;{user_id}_{salt}&quot;)                 │ │
│  │                                                            │ │
│  │  → 쓰기 분산, 읽기 복잡도 증가                             │ │
│  │                                                            │ │
│  └────────────────────────────────────────────────────────────┘ │
│                                                                  │
│  4. 핫 엔티티 전용 처리                                         │
│  ┌────────────────────────────────────────────────────────────┐ │
│  │                                                            │ │
│  │  • 인기 엔티티를 캐시 (Redis)                              │ │
│  │  • 별도의 전용 샤드/서버                                   │ │
│  │  • 비동기 처리 (카운터 등)                                 │ │
│  │                                                            │ │
│  └────────────────────────────────────────────────────────────┘ │
│                                                                  │
└─────────────────────────────────────────────────────────────────┘
</code></pre></div>

<hr />
<h2 id="6">6. 리밸런싱<a class="header-link" href="#6" title="Permanent link">&para;</a></h2>
<h3 id="61">6.1 리밸런싱이 필요한 경우<a class="header-link" href="#61" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code>┌─────────────────────────────────────────────────────────────────┐
│                  리밸런싱 필요 상황                              │
├─────────────────────────────────────────────────────────────────┤
│                                                                  │
│  1. 샤드 추가 (확장)                                            │
│  ┌────────────────────────────────────────────────────────────┐ │
│  │                                                            │ │
│  │  Before: [Shard 1] [Shard 2] [Shard 3]                     │ │
│  │  After:  [Shard 1] [Shard 2] [Shard 3] [Shard 4]           │ │
│  │                                                            │ │
│  │  일부 데이터를 새 샤드로 이동                              │ │
│  │                                                            │ │
│  └────────────────────────────────────────────────────────────┘ │
│                                                                  │
│  2. 샤드 제거 (축소)                                            │
│  ┌────────────────────────────────────────────────────────────┐ │
│  │                                                            │ │
│  │  Before: [Shard 1] [Shard 2] [Shard 3]                     │ │
│  │  After:  [Shard 1] [Shard 2]                               │ │
│  │                                                            │ │
│  │  Shard 3 데이터를 다른 샤드로 이동                         │ │
│  │                                                            │ │
│  └────────────────────────────────────────────────────────────┘ │
│                                                                  │
│  3. 불균형 해소                                                 │
│  ┌────────────────────────────────────────────────────────────┐ │
│  │                                                            │ │
│  │  Before: [Shard 1: 80%] [Shard 2: 10%] [Shard 3: 10%]      │ │
│  │  After:  [Shard 1: 33%] [Shard 2: 33%] [Shard 3: 33%]      │ │
│  │                                                            │ │
│  │  Shard 1에서 다른 샤드로 데이터 이동                       │ │
│  │                                                            │ │
│  └────────────────────────────────────────────────────────────┘ │
│                                                                  │
└─────────────────────────────────────────────────────────────────┘
</code></pre></div>

<h3 id="62">6.2 리밸런싱 전략<a class="header-link" href="#62" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code>┌─────────────────────────────────────────────────────────────────┐
│                   리밸런싱 전략                                  │
├─────────────────────────────────────────────────────────────────┤
│                                                                  │
│  1. 일관성 해싱 (Consistent Hashing)                            │
│  ┌────────────────────────────────────────────────────────────┐ │
│  │                                                            │ │
│  │  샤드 추가/제거 시 최소한의 데이터만 이동                  │ │
│  │  이전 레슨에서 학습                                        │ │
│  │                                                            │ │
│  └────────────────────────────────────────────────────────────┘ │
│                                                                  │
│  2. 이중 쓰기 (Dual Write)                                      │
│  ┌────────────────────────────────────────────────────────────┐ │
│  │                                                            │ │
│  │  1단계: 새 샤드 추가, 쓰기는 양쪽에                        │ │
│  │  ┌──────┐     ┌──────┐     ┌──────┐                        │ │
│  │  │Old S1│     │Old S2│     │New S3│                        │ │
│  │  │ R/W  │     │ R/W  │     │  W   │                        │ │
│  │  └──────┘     └──────┘     └──────┘                        │ │
│  │                                                            │ │
│  │  2단계: 기존 데이터 마이그레이션 (백그라운드)              │ │
│  │                                                            │ │
│  │  3단계: 읽기도 새 샤드로                                   │ │
│  │  ┌──────┐     ┌──────┐     ┌──────┐                        │ │
│  │  │Shard1│     │Shard2│     │Shard3│                        │ │
│  │  │ R/W  │     │ R/W  │     │ R/W  │                        │ │
│  │  └──────┘     └──────┘     └──────┘                        │ │
│  │                                                            │ │
│  └────────────────────────────────────────────────────────────┘ │
│                                                                  │
│  3. 버전 기반 라우팅                                            │
│  ┌────────────────────────────────────────────────────────────┐ │
│  │                                                            │ │
│  │  shard_config_v1:                                          │ │
│  │    range 1-1M → shard_1                                    │ │
│  │    range 1M-2M → shard_2                                   │ │
│  │                                                            │ │
│  │  shard_config_v2: (마이그레이션 후)                        │ │
│  │    range 1-700K → shard_1                                  │ │
│  │    range 700K-1.4M → shard_2                               │ │
│  │    range 1.4M-2M → shard_3                                 │ │
│  │                                                            │ │
│  │  # 새 쓰기는 v2, 기존 읽기는 v1                            │ │
│  │  # 마이그레이션 완료 후 v2로 전환                          │ │
│  │                                                            │ │
│  └────────────────────────────────────────────────────────────┘ │
│                                                                  │
└─────────────────────────────────────────────────────────────────┘
</code></pre></div>

<hr />
<h2 id="7">7. 연습 문제<a class="header-link" href="#7" title="Permanent link">&para;</a></h2>
<h3 id="1_1">문제 1: 샤딩 전략 선택<a class="header-link" href="#1_1" title="Permanent link">&para;</a></h3>
<p>다음 서비스에 적합한 샤딩 전략을 선택하세요.</p>
<p>a) 채팅 앱 (대화방별 메시지)
b) 로그 분석 시스템
c) 글로벌 사용자 서비스
d) SaaS 멀티 테넌트</p>
<h3 id="2">문제 2: 샤딩 키 선택<a class="header-link" href="#2" title="Permanent link">&para;</a></h3>
<p>이커머스 서비스에서 다음 테이블의 샤딩 키를 선택하세요.</p>
<ul>
<li>users (id, email, name)</li>
<li>orders (id, user_id, status, created_at)</li>
<li>order_items (id, order_id, product_id, quantity)</li>
<li>products (id, merchant_id, name, price)</li>
</ul>
<p>요구사항:
- 사용자별 주문 조회 빈번
- 판매자별 상품 조회 필요
- 주문과 주문 항목은 함께 조회</p>
<h3 id="3_1">문제 3: 핫스팟 해결<a class="header-link" href="#3_1" title="Permanent link">&para;</a></h3>
<p>인기 게시글에 댓글이 집중되어 해당 샤드가 과부하입니다. 해결책을 제시하세요.</p>
<h3 id="4_1">문제 4: 리밸런싱 계획<a class="header-link" href="#4_1" title="Permanent link">&para;</a></h3>
<p>3개 샤드에서 5개 샤드로 확장하려고 합니다. 무중단 마이그레이션 계획을 세우세요.</p>
<hr />
<h2 id="_4">정답<a class="header-link" href="#_4" title="Permanent link">&para;</a></h2>
<h3 id="1_2">문제 1 정답<a class="header-link" href="#1_2" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code>a) 채팅 앱: Hash(conversation_id)
   <span class="k">-</span> 같은 대화방 메시지가 같은 샤드
   <span class="k">-</span> 대화방 단위로 조회하므로 효율적

b) 로그 분석: Range(timestamp)
   <span class="k">-</span> 시간 범위 쿼리가 효율적
   <span class="k">-</span> 오래된 로그 샤드 삭제 용이

c) 글로벌 사용자: Hash(user_id)
   <span class="k">-</span> 균등 분배
   <span class="k">-</span> 사용자별 데이터 조회 효율적

d) SaaS 멀티 테넌트: tenant_id
   <span class="k">-</span> 테넌트별 완전 격리
   <span class="k">-</span> 크로스 테넌트 쿼리 불필요
</code></pre></div>

<h3 id="2_1">문제 2 정답<a class="header-link" href="#2_1" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><span class="n">users</span><span class="o">:</span><span class="w"> </span><span class="n">Hash</span><span class="o">(</span><span class="n">user_id</span><span class="o">)</span>
<span class="w">  </span><span class="o">-</span><span class="w"> </span><span class="err">기본</span><span class="w"> </span><span class="err">키로</span><span class="w"> </span><span class="err">사용</span>
<span class="w">  </span><span class="o">-</span><span class="w"> </span><span class="err">균등</span><span class="w"> </span><span class="err">분배</span>

<span class="n">orders</span><span class="o">:</span><span class="w"> </span><span class="n">Hash</span><span class="o">(</span><span class="n">user_id</span><span class="o">)</span>
<span class="w">  </span><span class="o">-</span><span class="w"> </span><span class="n">user_id가</span><span class="w"> </span><span class="err">주</span><span class="w"> </span><span class="err">조회</span><span class="w"> </span><span class="err">조건</span>
<span class="w">  </span><span class="o">-</span><span class="w"> </span><span class="err">사용자별</span><span class="w"> </span><span class="err">주문</span><span class="w"> </span><span class="err">조회</span><span class="w"> </span><span class="err">효율적</span>

<span class="n">order_items</span><span class="o">:</span><span class="w"> </span><span class="n">Hash</span><span class="o">(</span><span class="n">order_id</span><span class="o">)</span>
<span class="w">  </span><span class="o">-</span><span class="w"> </span><span class="err">또는</span><span class="w"> </span><span class="n">Hash</span><span class="o">(</span><span class="n">user_id</span><span class="o">)</span><span class="w"> </span><span class="o">(</span><span class="n">orders와</span><span class="w"> </span><span class="err">같은</span><span class="w"> </span><span class="err">샤드</span><span class="o">)</span>
<span class="w">  </span><span class="o">-</span><span class="w"> </span><span class="n">order_id를</span><span class="w"> </span><span class="err">사용하면</span><span class="w"> </span><span class="n">orders와</span><span class="w"> </span><span class="err">다른</span><span class="w"> </span><span class="err">샤드</span><span class="w"> </span><span class="err">가능</span>
<span class="w">  </span><span class="o">-</span><span class="w"> </span><span class="err">→</span><span class="w"> </span><span class="n">user_id</span><span class="w"> </span><span class="err">권장</span><span class="w"> </span><span class="o">(</span><span class="n">orders와</span><span class="w"> </span><span class="err">같은</span><span class="w"> </span><span class="err">샤드</span><span class="o">)</span>

<span class="n">products</span><span class="o">:</span><span class="w"> </span><span class="n">Hash</span><span class="o">(</span><span class="n">merchant_id</span><span class="o">)</span>
<span class="w">  </span><span class="o">-</span><span class="w"> </span><span class="err">판매자별</span><span class="w"> </span><span class="err">상품</span><span class="w"> </span><span class="err">조회</span>
<span class="w">  </span><span class="o">-</span><span class="w"> </span><span class="err">판매자</span><span class="w"> </span><span class="err">단위</span><span class="w"> </span><span class="err">격리</span>

<span class="err">크로스</span><span class="w"> </span><span class="err">샤드</span><span class="w"> </span><span class="err">주의</span><span class="o">:</span>
<span class="o">-</span><span class="w"> </span><span class="err">주문의</span><span class="w"> </span><span class="err">상품</span><span class="w"> </span><span class="err">정보</span><span class="w"> </span><span class="err">→</span><span class="w"> </span><span class="err">캐시</span><span class="w"> </span><span class="err">활용</span>
<span class="o">-</span><span class="w"> </span><span class="err">판매자</span><span class="w"> </span><span class="err">주문</span><span class="w"> </span><span class="err">조회</span><span class="w"> </span><span class="err">→</span><span class="w"> </span><span class="err">별도</span><span class="w"> </span><span class="err">인덱스</span><span class="w"> </span><span class="err">테이블</span>
</code></pre></div>

<h3 id="3_2">문제 3 정답<a class="header-link" href="#3_2" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><span class="err">해결책</span><span class="o">:</span>

<span class="mi">1</span><span class="o">.</span><span class="w"> </span><span class="err">핫</span><span class="w"> </span><span class="err">게시글</span><span class="w"> </span><span class="err">캐싱</span>
<span class="w">   </span><span class="o">-</span><span class="w"> </span><span class="err">댓글을</span><span class="w"> </span><span class="n">Redis에</span><span class="w"> </span><span class="err">캐싱</span>
<span class="w">   </span><span class="o">-</span><span class="w"> </span><span class="err">주기적으로</span><span class="w"> </span><span class="n">DB에</span><span class="w"> </span><span class="err">배치</span><span class="w"> </span><span class="err">저장</span>

<span class="mi">2</span><span class="o">.</span><span class="w"> </span><span class="err">솔팅</span><span class="w"> </span><span class="err">적용</span>
<span class="w">   </span><span class="n">post_123_0</span><span class="o">,</span><span class="w"> </span><span class="n">post_123_1</span><span class="o">,</span><span class="w"> </span><span class="o">...</span>
<span class="w">   </span><span class="o">-</span><span class="w"> </span><span class="err">쓰기</span><span class="w"> </span><span class="err">시</span><span class="w"> </span><span class="err">랜덤</span><span class="w"> </span><span class="err">솔트</span>
<span class="w">   </span><span class="o">-</span><span class="w"> </span><span class="err">읽기</span><span class="w"> </span><span class="err">시</span><span class="w"> </span><span class="err">모든</span><span class="w"> </span><span class="err">솔트</span><span class="w"> </span><span class="err">조회</span><span class="w"> </span><span class="err">후</span><span class="w"> </span><span class="err">합치기</span>

<span class="mi">3</span><span class="o">.</span><span class="w"> </span><span class="err">댓글</span><span class="w"> </span><span class="err">카운터</span><span class="w"> </span><span class="err">분리</span>
<span class="w">   </span><span class="o">-</span><span class="w"> </span><span class="err">카운터만</span><span class="w"> </span><span class="n">Redis에서</span><span class="w"> </span><span class="err">관리</span>
<span class="w">   </span><span class="o">-</span><span class="w"> </span><span class="err">비동기로</span><span class="w"> </span><span class="n">DB</span><span class="w"> </span><span class="err">업데이트</span>

<span class="mi">4</span><span class="o">.</span><span class="w"> </span><span class="err">샤딩</span><span class="w"> </span><span class="err">키</span><span class="w"> </span><span class="err">변경</span>
<span class="w">   </span><span class="o">-</span><span class="w"> </span><span class="o">(</span><span class="n">post_id</span><span class="o">,</span><span class="w"> </span><span class="n">comment_id</span><span class="o">)</span><span class="w"> </span><span class="err">복합</span><span class="w"> </span><span class="err">키로</span>
<span class="w">   </span><span class="o">-</span><span class="w"> </span><span class="err">같은</span><span class="w"> </span><span class="err">게시글</span><span class="w"> </span><span class="err">댓글도</span><span class="w"> </span><span class="err">분산</span>

<span class="mi">5</span><span class="o">.</span><span class="w"> </span><span class="err">전용</span><span class="w"> </span><span class="err">처리</span>
<span class="w">   </span><span class="o">-</span><span class="w"> </span><span class="err">인기</span><span class="w"> </span><span class="err">게시글</span><span class="w"> </span><span class="err">감지</span>
<span class="w">   </span><span class="o">-</span><span class="w"> </span><span class="err">전용</span><span class="w"> </span><span class="err">캐시</span><span class="w"> </span><span class="err">레이어</span><span class="w"> </span><span class="err">추가</span>
</code></pre></div>

<h3 id="4_2">문제 4 정답<a class="header-link" href="#4_2" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code>무중단 마이그레이션 계획:

1단계: 새 샤드 준비
   - Shard 4, 5 서버 준비
   - 스키마 생성

2단계: 이중 쓰기 시작
   - 라우터 업데이트
   - 새 쓰기 → 기존 샤드 + 새 샤드 (일관성 해싱 기준)

3단계: 기존 데이터 마이그레이션
   - 백그라운드 복사
   - 일관성 해싱으로 대상 결정 (약 40% 이동)

4단계: 검증
   - 데이터 카운트 비교
   - 샘플 데이터 검증

5단계: 읽기 전환
   - 새 라우팅 규칙 활성화
   - 점진적 전환 (10% → 50% → 100%)

6단계: 이중 쓰기 중단
   - 기존 라우팅 제거

7단계: 정리
   - 기존 샤드에서 이동된 데이터 삭제
</code></pre></div>

<hr />
<h2 id="8">8. 다음 단계<a class="header-link" href="#8" title="Permanent link">&para;</a></h2>
<p>데이터베이스 확장을 이해했다면, 데이터베이스 복제를 학습하세요.</p>
<h3 id="_5">다음 레슨<a class="header-link" href="#_5" title="Permanent link">&para;</a></h3>
<ul>
<li><a href="./09_Database_Replication.md">09_Database_Replication.md</a></li>
</ul>
<h3 id="_6">관련 레슨<a class="header-link" href="#_6" title="Permanent link">&para;</a></h3>
<ul>
<li><a href="./07_Distributed_Cache_Systems.md">07_Distributed_Cache_Systems.md</a> - 일관성 해싱</li>
<li><a href="../PostgreSQL/18_Table_Partitioning.md">PostgreSQL/18_Table_Partitioning.md</a></li>
</ul>
<h3 id="_7">추천 실습<a class="header-link" href="#_7" title="Permanent link">&para;</a></h3>
<ol>
<li>PostgreSQL 파티셔닝 실습</li>
<li>샤딩 라우터 구현해보기</li>
<li>일관성 해싱 구현</li>
</ol>
<hr />
<h2 id="9">9. 참고 자료<a class="header-link" href="#9" title="Permanent link">&para;</a></h2>
<h3 id="_8">도서<a class="header-link" href="#_8" title="Permanent link">&para;</a></h3>
<ul>
<li>Designing Data-Intensive Applications - Ch. 6</li>
</ul>
<h3 id="_9">데이터베이스<a class="header-link" href="#_9" title="Permanent link">&para;</a></h3>
<ul>
<li><a href="https://vitess.io/">Vitess</a> - MySQL 샤딩</li>
<li><a href="https://www.citusdata.com/">Citus</a> - PostgreSQL 샤딩</li>
<li><a href="https://docs.mongodb.com/manual/sharding/">MongoDB Sharding</a></li>
</ul>
<h3 id="_10">기업 사례<a class="header-link" href="#_10" title="Permanent link">&para;</a></h3>
<ul>
<li><a href="https://instagram-engineering.com/sharding-ids-at-instagram-1cf5a71e5a5c">Instagram Sharding</a></li>
<li><a href="https://medium.com/pinterest-engineering/sharding-pinterest-how-we-scaled-our-mysql-fleet-3f341e96ca6f">Pinterest Sharding</a></li>
</ul>
<hr />
<p><strong>문서 정보</strong>
- 최종 수정: 2024년
- 난이도: ⭐⭐⭐
- 예상 학습 시간: 2-3시간</p>
    </div>

    
<div class="lesson-toolbar lesson-toolbar--bottom">
    <div class="toolbar-nav toolbar-nav--prev">
        
        <a href="/study/ko/System_Design/07_Distributed_Cache_Systems.html" class="nav-prev">
            <span class="nav-label">Previous</span>
            <span class="nav-title">분산 캐시 시스템</span>
        </a>
        
    </div>
    <div class="toolbar-actions">
        <button class="btn btn-copy-link" data-action="copy-link" title="Copy link">
            <span class="icon">🔗</span>
            <span class="text">Copy link</span>
        </button>
        <a href="/study/ko/System_Design/" class="btn btn-topic-link" title="Back to topic list">
            <span class="icon">📋</span>
            <span class="text">Topic list</span>
        </a>
    </div>
    <div class="toolbar-nav toolbar-nav--next">
        
        <a href="/study/ko/System_Design/09_Database_Replication.html" class="nav-next">
            <span class="nav-label">Next</span>
            <span class="nav-title">데이터베이스 복제 (Database Replication)</span>
        </a>
        
    </div>
</div>


    <div class="toolbar-keyboard-hint">
        <kbd>&larr;</kbd> <kbd>&rarr;</kbd> to navigate between lessons
    </div>
</article>

<!-- Scroll to top floating button -->
<button class="scroll-to-top" id="scroll-to-top" title="Scroll to top" aria-label="Scroll to top">↑</button>

            </div>
        </main>
    </div>

    <script src="/study/static/js/app.js"></script>
    <script>
        function switchLanguage(newLang) {
            const path = window.location.pathname;
            const base = '/study';
            const currentLang = 'ko';
            const newPath = path.replace(base + '/' + currentLang + '/', base + '/' + newLang + '/');
            window.location.href = newPath + window.location.search;
        }
    </script>
    
<script>
    document.addEventListener('DOMContentLoaded', function() {
        // Copy link - independent feedback per button
        document.querySelectorAll('[data-action="copy-link"]').forEach(function(btn) {
            btn.addEventListener('click', function() {
                navigator.clipboard.writeText(window.location.href);
                var textEl = this.querySelector('.text');
                var originalText = textEl.textContent;
                textEl.textContent = 'Copied!';
                setTimeout(function() { textEl.textContent = originalText; }, 2000);
            });
        });

        // Add copy buttons to code blocks
        document.querySelectorAll('.lesson-content pre').forEach(function(pre) {
            var copyBtn = document.createElement('button');
            copyBtn.className = 'code-copy-btn';
            copyBtn.textContent = 'Copy';
            copyBtn.addEventListener('click', function() {
                var code = pre.querySelector('code');
                var text = code ? code.textContent : pre.textContent;
                navigator.clipboard.writeText(text);
                copyBtn.textContent = 'Copied!';
                setTimeout(function() { copyBtn.textContent = 'Copy'; }, 2000);
            });
            pre.style.position = 'relative';
            pre.appendChild(copyBtn);
        });

        // Scroll to top button
        var scrollBtn = document.getElementById('scroll-to-top');
        window.addEventListener('scroll', function() {
            scrollBtn.classList.toggle('visible', window.scrollY > 300);
        });
        scrollBtn.addEventListener('click', function() {
            window.scrollTo({ top: 0, behavior: 'smooth' });
        });

        // Keyboard shortcuts: left/right arrows for lesson navigation
        document.addEventListener('keydown', function(e) {
            var tag = document.activeElement.tagName;
            if (tag === 'INPUT' || tag === 'TEXTAREA' || tag === 'SELECT') return;

            if (e.key === 'ArrowLeft') {
                var prevLink = document.querySelector('.nav-prev');
                if (prevLink) prevLink.click();
            } else if (e.key === 'ArrowRight') {
                var nextLink = document.querySelector('.nav-next');
                if (nextLink) nextLink.click();
            }
        });
    });
</script>

</body>
</html>
{% endraw %}