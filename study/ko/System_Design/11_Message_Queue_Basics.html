{% raw %}
<!DOCTYPE html>
<html lang="ko" data-theme="light">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>메시지 큐 기초 (Message Queue Fundamentals) - Study Materials</title>
    <link rel="stylesheet" href="/study/static/css/style.css">
    <link rel="stylesheet" href="/study/static/css/highlight.css">
    <!-- KaTeX for LaTeX math rendering -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.16.11/dist/katex.min.css">
    <script defer src="https://cdn.jsdelivr.net/npm/katex@0.16.11/dist/katex.min.js"></script>
    <script defer src="https://cdn.jsdelivr.net/npm/katex@0.16.11/dist/contrib/auto-render.min.js"
        onload="renderMathInElement(document.body, {
            delimiters: [
                {left: '$$', right: '$$', display: true},
                {left: '$', right: '$', display: false}
            ],
            throwOnError: false
        });"></script>
    
</head>
<body>
    <div class="app-container">
        <!-- Sidebar -->
        <aside class="sidebar" id="sidebar">
            <div class="sidebar-header">
                <a href="/study/ko/" class="logo">Study Materials</a>
                <button class="sidebar-toggle" id="sidebar-toggle" aria-label="Toggle sidebar">
                    <span></span>
                </button>
            </div>

            <nav class="sidebar-nav">
                <a href="/study/ko/" class="nav-item ">
                    <span class="nav-icon">🏠</span>
                    <span class="nav-text">Home</span>
                </a>
                <a href="/study/examples/" class="nav-item ">
                    <span class="nav-icon">💻</span>
                    <span class="nav-text">Examples</span>
                </a>
            </nav>

            <div class="sidebar-search">
                <form action="/study/ko/search.html" method="get" id="search-form">
                    <input type="search" name="q" placeholder="Search..." id="search-sidebar-input">
                </form>
            </div>

            <!-- Language Selector -->
            <div class="sidebar-lang">
                <select id="lang-select" class="lang-selector" onchange="switchLanguage(this.value)">
                    
                    <option value="en" >
                        English
                    </option>
                    
                    <option value="ko" selected>
                        한국어
                    </option>
                    
                </select>
            </div>

            <div class="sidebar-footer">
                <button class="theme-toggle" id="theme-toggle" aria-label="Toggle theme">
                    <span class="theme-icon light">☀️</span>
                    <span class="theme-icon dark">🌙</span>
                </button>
            </div>
        </aside>

        <!-- Main Content -->
        <main class="main-content">
            <header class="main-header">
                <button class="menu-toggle" id="menu-toggle" aria-label="Open menu">
                    <span></span>
                </button>
                
<nav class="breadcrumb">
    <a href="/study/ko/">Topics</a>
    <span class="separator">/</span>
    <a href="/study/ko/System_Design/">System Design</a>
    <span class="separator">/</span>
    <span class="current">메시지 큐 기초 (Message Queue Fundamentals)</span>
</nav>

            </header>

            <div class="content">
                
<article class="lesson-article">
    <header class="lesson-header">
        <h1>메시지 큐 기초 (Message Queue Fundamentals)</h1>
    </header>

    
<div class="lesson-toolbar lesson-toolbar--top">
    <div class="toolbar-nav toolbar-nav--prev">
        
        <a href="/study/ko/System_Design/10_Data_Consistency_Patterns.html" class="nav-prev">
            <span class="nav-label">Previous</span>
            <span class="nav-title">데이터 일관성 패턴 (Data Consistency Patterns)</span>
        </a>
        
    </div>
    <div class="toolbar-actions">
        <button class="btn btn-copy-link" data-action="copy-link" title="Copy link">
            <span class="icon">🔗</span>
            <span class="text">Copy link</span>
        </button>
        <a href="/study/ko/System_Design/" class="btn btn-topic-link" title="Back to topic list">
            <span class="icon">📋</span>
            <span class="text">Topic list</span>
        </a>
    </div>
    <div class="toolbar-nav toolbar-nav--next">
        
        <a href="/study/ko/System_Design/12_Message_System_Comparison.html" class="nav-next">
            <span class="nav-label">Next</span>
            <span class="nav-title">메시지 시스템 비교 (Message Systems Comparison)</span>
        </a>
        
    </div>
</div>


    
    <nav class="toc" id="toc">
        <h2>Table of Contents</h2>
        <div class="toc">
<ul>
<li><a href="#_1">개요</a></li>
<li><a href="#_2">목차</a></li>
<li><a href="#1-vs">1. 동기 vs 비동기 통신</a><ul>
<li><a href="#synchronous">동기 통신 (Synchronous)</a></li>
<li><a href="#asynchronous">비동기 통신 (Asynchronous)</a></li>
<li><a href="#_3">통신 방식 비교</a></li>
</ul>
</li>
<li><a href="#2">2. 메시지 큐의 이점</a><ul>
<li><a href="#decoupling">디커플링 (Decoupling)</a></li>
<li><a href="#load-leveling">부하 평준화 (Load Leveling)</a></li>
<li><a href="#scalability">확장성 (Scalability)</a></li>
<li><a href="#durability">내구성 (Durability)</a></li>
</ul>
</li>
<li><a href="#3-vs">3. 큐 vs 토픽</a><ul>
<li><a href="#point-to-point-queue">Point-to-Point (Queue)</a></li>
<li><a href="#publishsubscribe-topic">Publish/Subscribe (Topic)</a></li>
<li><a href="#consumer-group">Consumer Group (하이브리드)</a></li>
<li><a href="#_4">패턴 비교</a></li>
</ul>
</li>
<li><a href="#4">4. 메시지 전달 보장</a><ul>
<li><a href="#at-most-once">At-Most-Once (최대 한 번)</a></li>
<li><a href="#at-least-once">At-Least-Once (최소 한 번)</a></li>
<li><a href="#exactly-once">Exactly-Once (정확히 한 번)</a></li>
<li><a href="#_5">전달 보장 비교</a></li>
</ul>
</li>
<li><a href="#5-idempotency">5. 멱등성 (Idempotency)</a><ul>
<li><a href="#_6">멱등성이란?</a></li>
<li><a href="#_7">멱등성 구현 패턴</a></li>
<li><a href="#consumer">멱등성 Consumer 구현 예시</a></li>
</ul>
</li>
<li><a href="#6">6. 메시지 큐 패턴</a><ul>
<li><a href="#work-queue-task-queue">Work Queue (Task Queue)</a></li>
<li><a href="#request-reply">Request-Reply</a></li>
<li><a href="#dead-letter-queue-dlq">Dead Letter Queue (DLQ)</a></li>
<li><a href="#priority-queue">Priority Queue</a></li>
</ul>
</li>
<li><a href="#7">7. 연습 문제</a><ul>
<li><a href="#1">연습 1: 통신 방식 선택</a></li>
<li><a href="#2_1">연습 2: 전달 보장 선택</a></li>
<li><a href="#3">연습 3: 멱등성 설계</a></li>
</ul>
</li>
<li><a href="#_8">다음 단계</a></li>
<li><a href="#_9">참고 자료</a></li>
</ul>
</div>

    </nav>
    

    <div class="lesson-content markdown-body">
        <h1 id="message-queue-fundamentals">메시지 큐 기초 (Message Queue Fundamentals)<a class="header-link" href="#message-queue-fundamentals" title="Permanent link">&para;</a></h1>
<p>난이도: ⭐⭐⭐</p>
<h2 id="_1">개요<a class="header-link" href="#_1" title="Permanent link">&para;</a></h2>
<p>메시지 큐는 분산 시스템에서 서비스 간 비동기 통신을 가능하게 하는 핵심 인프라입니다. 이 장에서는 동기와 비동기 통신의 차이, 큐와 토픽의 개념, 메시지 전달 보장 수준, 그리고 멱등성에 대해 학습합니다.</p>
<hr />
<h2 id="_2">목차<a class="header-link" href="#_2" title="Permanent link">&para;</a></h2>
<ol>
<li><a href="#1-동기-vs-비동기-통신">동기 vs 비동기 통신</a></li>
<li><a href="#2-메시지-큐의-이점">메시지 큐의 이점</a></li>
<li><a href="#3-큐-vs-토픽">큐 vs 토픽</a></li>
<li><a href="#4-메시지-전달-보장">메시지 전달 보장</a></li>
<li><a href="#5-멱등성-idempotency">멱등성 (Idempotency)</a></li>
<li><a href="#6-메시지-큐-패턴">메시지 큐 패턴</a></li>
<li><a href="#7-연습-문제">연습 문제</a></li>
</ol>
<hr />
<h2 id="1-vs">1. 동기 vs 비동기 통신<a class="header-link" href="#1-vs" title="Permanent link">&para;</a></h2>
<h3 id="synchronous">동기 통신 (Synchronous)<a class="header-link" href="#synchronous" title="Permanent link">&para;</a></h3>
<p>요청 후 응답을 기다리는 방식입니다.</p>
<div class="highlight"><pre><span></span><code>┌─────────────────────────────────────────────────────────────────────────┐
│                     동기 통신 (Request-Response)                        │
├─────────────────────────────────────────────────────────────────────────┤
│                                                                         │
│  ┌──────────┐                           ┌──────────┐                   │
│  │ Service A│                           │ Service B│                   │
│  └────┬─────┘                           └────┬─────┘                   │
│       │                                      │                          │
│       │─────── HTTP Request ────────────────►│                          │
│       │                                      │                          │
│       │        (Service A 블로킹)            │ 처리 중...              │
│       │        요청 스레드 대기              │                          │
│       │                                      │                          │
│       │◄────── HTTP Response ───────────────│                          │
│       │                                      │                          │
│       ▼                                      ▼                          │
│  다음 작업 계속                         처리 완료                       │
│                                                                         │
│  특징:                                                                  │
│  - 즉각적인 응답 필요                                                   │
│  - 호출자가 응답 대기                                                   │
│  - Service B 장애 시 Service A도 영향                                   │
│                                                                         │
└─────────────────────────────────────────────────────────────────────────┘
</code></pre></div>

<h3 id="asynchronous">비동기 통신 (Asynchronous)<a class="header-link" href="#asynchronous" title="Permanent link">&para;</a></h3>
<p>메시지를 보내고 즉시 다른 작업을 계속합니다.</p>
<div class="highlight"><pre><span></span><code>┌─────────────────────────────────────────────────────────────────────────┐
│<span class="w">                     </span>비동기<span class="w"> </span>통신<span class="w"> </span><span class="ss">(</span><span class="nv">Message</span><span class="w"> </span><span class="nv">Queue</span><span class="ss">)</span><span class="w">                         </span>│
├─────────────────────────────────────────────────────────────────────────┤
│<span class="w">                                                                         </span>│
│<span class="w">  </span>┌──────────┐<span class="w">     </span>┌──────────────┐<span class="w">     </span>┌──────────┐<span class="w">                   </span>│
│<span class="w">  </span>│<span class="w"> </span><span class="nv">Service</span><span class="w"> </span><span class="nv">A</span>│<span class="w">     </span>│<span class="w"> </span><span class="nv">Message</span><span class="w"> </span><span class="nv">Queue</span>│<span class="w">     </span>│<span class="w"> </span><span class="nv">Service</span><span class="w"> </span><span class="nv">B</span>│<span class="w">                   </span>│
│<span class="w">  </span>│<span class="ss">(</span><span class="nv">Producer</span><span class="ss">)</span>│<span class="w">     </span>│<span class="w">              </span>│<span class="w">     </span>│<span class="ss">(</span><span class="nv">Consumer</span><span class="ss">)</span>│<span class="w">                   </span>│
│<span class="w">  </span>└────┬─────┘<span class="w">     </span>└──────┬───────┘<span class="w">     </span>└────┬─────┘<span class="w">                   </span>│
│<span class="w">       </span>│<span class="w">                  </span>│<span class="w">                  </span>│<span class="w">                          </span>│
│<span class="w">       </span>│────<span class="w"> </span><span class="k">Send</span><span class="w"> </span><span class="nv">Msg</span><span class="w"> </span>───►│<span class="w">                  </span>│<span class="w">                          </span>│
│<span class="w">       </span>│◄───<span class="w"> </span><span class="nv">ACK</span><span class="w"> </span>─────────│<span class="w">                  </span>│<span class="w">                          </span>│
│<span class="w">       </span>│<span class="w">                  </span>│<span class="w">                  </span>│<span class="w">                          </span>│
│<span class="w">       </span>▼<span class="w">                  </span>│<span class="w">                  </span>│<span class="w">                          </span>│
│<span class="w">  </span>다음<span class="w"> </span>작업<span class="w"> </span>계속<span class="w">          </span>│◄───<span class="w"> </span><span class="nv">Poll</span><span class="w"> </span>────────│<span class="w">                          </span>│
│<span class="w">  </span><span class="ss">(</span>블로킹<span class="w"> </span>없음<span class="ss">)</span><span class="w">           </span>│────<span class="w"> </span><span class="nv">Deliver</span><span class="w"> </span>────►│<span class="w">                          </span>│
│<span class="w">                          </span>│<span class="w">                  </span>│<span class="w"> </span>처리<span class="w"> </span>중...<span class="w">               </span>│
│<span class="w">                          </span>│◄───<span class="w"> </span><span class="nv">ACK</span><span class="w"> </span>─────────│<span class="w">                          </span>│
│<span class="w">                          </span>│<span class="w">                  </span>▼<span class="w">                          </span>│
│<span class="w">                          </span>│<span class="w">             </span>처리<span class="w"> </span>완료<span class="w">                       </span>│
│<span class="w">                                                                         </span>│
│<span class="w">  </span>특징:<span class="w">                                                                  </span>│
│<span class="w">  </span><span class="o">-</span><span class="w"> </span>발신자<span class="o">/</span>수신자<span class="w"> </span>독립적<span class="w">                                                 </span>│
│<span class="w">  </span><span class="o">-</span><span class="w"> </span>느슨한<span class="w"> </span>결합<span class="w">                                                          </span>│
│<span class="w">  </span><span class="o">-</span><span class="w"> </span><span class="nv">Service</span><span class="w"> </span><span class="nv">B</span><span class="w"> </span>장애<span class="w"> </span>시에도<span class="w"> </span><span class="nv">Service</span><span class="w"> </span><span class="nv">A</span><span class="w"> </span>정상<span class="w"> </span>동작<span class="w">                            </span>│
│<span class="w">                                                                         </span>│
└─────────────────────────────────────────────────────────────────────────┘
</code></pre></div>

<h3 id="_3">통신 방식 비교<a class="header-link" href="#_3" title="Permanent link">&para;</a></h3>
<table>
<thead>
<tr>
<th>특성</th>
<th>동기</th>
<th>비동기</th>
</tr>
</thead>
<tbody>
<tr>
<td>응답 대기</td>
<td>필요</td>
<td>불필요</td>
</tr>
<tr>
<td>결합도</td>
<td>강함</td>
<td>느슨함</td>
</tr>
<tr>
<td>장애 전파</td>
<td>즉시 전파</td>
<td>격리됨</td>
</tr>
<tr>
<td>실시간성</td>
<td>즉시</td>
<td>지연 가능</td>
</tr>
<tr>
<td>복잡도</td>
<td>낮음</td>
<td>높음</td>
</tr>
<tr>
<td>처리량</td>
<td>제한적</td>
<td>높음</td>
</tr>
</tbody>
</table>
<hr />
<h2 id="2">2. 메시지 큐의 이점<a class="header-link" href="#2" title="Permanent link">&para;</a></h2>
<h3 id="decoupling">디커플링 (Decoupling)<a class="header-link" href="#decoupling" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><span class="err">┌─────────────────────────────────────────────────────────────────────────┐</span>
<span class="err">│</span><span class="w">                     </span><span class="n">강결합</span><span class="w"> </span><span class="n">vs</span><span class="w"> </span><span class="n">느슨한</span><span class="w"> </span><span class="n">결합</span><span class="w">                               </span><span class="err">│</span>
<span class="err">├─────────────────────────────────────────────────────────────────────────┤</span>
<span class="err">│</span><span class="w">                                                                         </span><span class="err">│</span>
<span class="err">│</span><span class="w">  </span><span class="n">강결합</span><span class="w"> </span><span class="p">(</span><span class="n">동기</span><span class="p">)</span><span class="err">:</span><span class="w">                                                         </span><span class="err">│</span>
<span class="err">│</span><span class="w">  </span><span class="err">┌─────┐</span><span class="w">     </span><span class="err">┌─────┐</span><span class="w">     </span><span class="err">┌─────┐</span><span class="w">     </span><span class="err">┌─────┐</span><span class="w">                          </span><span class="err">│</span>
<span class="err">│</span><span class="w">  </span><span class="err">│</span><span class="w">  </span><span class="n">A</span><span class="w">  </span><span class="err">│────►│</span><span class="w">  </span><span class="n">B</span><span class="w">  </span><span class="err">│────►│</span><span class="w">  </span><span class="n">C</span><span class="w">  </span><span class="err">│────►│</span><span class="w">  </span><span class="n">D</span><span class="w">  </span><span class="err">│</span><span class="w">                          </span><span class="err">│</span>
<span class="err">│</span><span class="w">  </span><span class="err">└─────┘</span><span class="w">     </span><span class="err">└─────┘</span><span class="w">     </span><span class="err">└─────┘</span><span class="w">     </span><span class="err">└─────┘</span><span class="w">                          </span><span class="err">│</span>
<span class="err">│</span><span class="w">     </span><span class="err">│</span><span class="w">                       </span><span class="n">X</span><span class="w"> </span><span class="n">장애</span><span class="err">!</span><span class="w">                                     </span><span class="err">│</span>
<span class="err">│</span><span class="w">     </span><span class="err">▼</span><span class="w">                                                                   </span><span class="err">│</span>
<span class="err">│</span><span class="w">  </span><span class="n">A도</span><span class="w"> </span><span class="n">실패</span><span class="err">!</span><span class="w"> </span><span class="p">(</span><span class="n">B</span><span class="w"> </span><span class="n">대기</span><span class="w"> </span><span class="err">→</span><span class="w"> </span><span class="n">C</span><span class="w"> </span><span class="n">장애</span><span class="w"> </span><span class="err">→</span><span class="w"> </span><span class="n">전체</span><span class="w"> </span><span class="n">실패</span><span class="p">)</span><span class="w">                               </span><span class="err">│</span>
<span class="err">│</span><span class="w">                                                                         </span><span class="err">│</span>
<span class="err">├─────────────────────────────────────────────────────────────────────────┤</span>
<span class="err">│</span><span class="w">  </span><span class="n">느슨한</span><span class="w"> </span><span class="n">결합</span><span class="w"> </span><span class="p">(</span><span class="n">비동기</span><span class="p">)</span><span class="err">:</span><span class="w">                                                  </span><span class="err">│</span>
<span class="err">│</span><span class="w">                      </span><span class="err">┌─────────────┐</span><span class="w">                                   </span><span class="err">│</span>
<span class="err">│</span><span class="w">                      </span><span class="err">│</span><span class="w">   </span><span class="n">Message</span><span class="w">   </span><span class="err">│</span><span class="w">                                   </span><span class="err">│</span>
<span class="err">│</span><span class="w">  </span><span class="err">┌─────┐</span><span class="w">            </span><span class="err">│</span><span class="w">    </span><span class="n">Queue</span><span class="w">    </span><span class="err">│</span><span class="w">            </span><span class="err">┌─────┐</span><span class="w">                </span><span class="err">│</span>
<span class="err">│</span><span class="w">  </span><span class="err">│</span><span class="w">  </span><span class="n">A</span><span class="w">  </span><span class="err">│───</span><span class="n">publish</span><span class="err">──►├─────────────┤◄──</span><span class="n">consume</span><span class="err">──│</span><span class="w">  </span><span class="n">B</span><span class="w">  </span><span class="err">│</span><span class="w">                </span><span class="err">│</span>
<span class="err">│</span><span class="w">  </span><span class="err">└─────┘</span><span class="w">            </span><span class="err">│</span><span class="w">  </span><span class="o">[</span><span class="n">msg</span><span class="o">][</span><span class="n">msg</span><span class="o">]</span><span class="w"> </span><span class="err">│</span><span class="w">            </span><span class="err">└─────┘</span><span class="w">                </span><span class="err">│</span>
<span class="err">│</span><span class="w">     </span><span class="err">│</span><span class="w">               </span><span class="err">│</span><span class="w">  </span><span class="o">[</span><span class="n">msg</span><span class="o">][</span><span class="n">msg</span><span class="o">]</span><span class="w"> </span><span class="err">│</span><span class="w">               </span><span class="n">X</span><span class="w"> </span><span class="n">장애</span><span class="err">!</span><span class="w">              </span><span class="err">│</span>
<span class="err">│</span><span class="w">     </span><span class="err">▼</span><span class="w">               </span><span class="err">└─────────────┘</span><span class="w">                                    </span><span class="err">│</span>
<span class="err">│</span><span class="w">  </span><span class="n">A</span><span class="w"> </span><span class="n">계속</span><span class="w"> </span><span class="n">동작</span><span class="err">!</span><span class="w">                                                          </span><span class="err">│</span>
<span class="err">│</span><span class="w">  </span><span class="p">(</span><span class="n">메시지는</span><span class="w"> </span><span class="n">큐에</span><span class="w"> </span><span class="n">보관</span><span class="p">,</span><span class="w"> </span><span class="n">B</span><span class="w"> </span><span class="n">복구</span><span class="w"> </span><span class="n">후</span><span class="w"> </span><span class="n">처리</span><span class="p">)</span><span class="w">                                   </span><span class="err">│</span>
<span class="err">│</span><span class="w">                                                                         </span><span class="err">│</span>
<span class="err">└─────────────────────────────────────────────────────────────────────────┘</span>
</code></pre></div>

<h3 id="load-leveling">부하 평준화 (Load Leveling)<a class="header-link" href="#load-leveling" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code>┌─────────────────────────────────────────────────────────────────────────┐
│                     부하 평준화                                         │
├─────────────────────────────────────────────────────────────────────────┤
│                                                                         │
│  Without Queue (직접 호출):                                             │
│                                                                         │
│  요청량    │    ████                                                   │
│           │    ████ ← 피크 시 서버 과부하!                             │
│  처리용량 │ ───████─────────────                                       │
│           │    ████                                                    │
│           └────────────────────────► 시간                              │
│                                                                         │
├─────────────────────────────────────────────────────────────────────────┤
│  With Queue (버퍼링):                                                   │
│                                                                         │
│  요청량    │    ████                                                   │
│           │    ████                                                    │
│  큐 크기  │ ───████████████──                                          │
│           │    ████████████                                            │
│  처리량   │ ═══════════════════════ ← 일정한 처리                      │
│           └────────────────────────► 시간                              │
│                                                                         │
│  큐가 버퍼 역할을 하여:                                                 │
│  - 피크 트래픽을 흡수                                                   │
│  - Consumer는 일정한 속도로 처리                                        │
│  - 시스템 안정성 향상                                                   │
│                                                                         │
└─────────────────────────────────────────────────────────────────────────┘
</code></pre></div>

<h3 id="scalability">확장성 (Scalability)<a class="header-link" href="#scalability" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><span class="err">┌─────────────────────────────────────────────────────────────────────────┐</span>
<span class="err">│</span><span class="w">                     </span><span class="n">수평</span><span class="w"> </span><span class="n">확장</span><span class="w">                                           </span><span class="err">│</span>
<span class="err">├─────────────────────────────────────────────────────────────────────────┤</span>
<span class="err">│</span><span class="w">                                                                         </span><span class="err">│</span>
<span class="err">│</span><span class="w">              </span><span class="err">┌────────────┐</span><span class="w">                                            </span><span class="err">│</span>
<span class="err">│</span><span class="w">              </span><span class="err">│</span><span class="w">  </span><span class="n">Message</span><span class="w">   </span><span class="err">│</span><span class="w">                                            </span><span class="err">│</span>
<span class="err">│</span><span class="w">              </span><span class="err">│</span><span class="w">   </span><span class="n">Queue</span><span class="w">    </span><span class="err">│</span><span class="w">                                            </span><span class="err">│</span>
<span class="err">│</span><span class="w">              </span><span class="err">├────────────┤</span><span class="w">                                            </span><span class="err">│</span>
<span class="err">│</span><span class="w">  </span><span class="n">Producer</span><span class="err">───►│</span><span class="w"> </span><span class="o">[</span><span class="n">m1</span><span class="o">][</span><span class="n">m2</span><span class="o">]</span><span class="w">   </span><span class="err">│</span><span class="w">                                            </span><span class="err">│</span>
<span class="err">│</span><span class="w">              </span><span class="err">│</span><span class="w"> </span><span class="o">[</span><span class="n">m3</span><span class="o">][</span><span class="n">m4</span><span class="o">]</span><span class="w">   </span><span class="err">│</span><span class="w">                                            </span><span class="err">│</span>
<span class="err">│</span><span class="w">              </span><span class="err">│</span><span class="w"> </span><span class="o">[</span><span class="n">m5</span><span class="o">][</span><span class="n">m6</span><span class="o">]</span><span class="w">   </span><span class="err">│</span><span class="w">                                            </span><span class="err">│</span>
<span class="err">│</span><span class="w">              </span><span class="err">└─────┬──────┘</span><span class="w">                                            </span><span class="err">│</span>
<span class="err">│</span><span class="w">                    </span><span class="err">│</span><span class="w">                                                    </span><span class="err">│</span>
<span class="err">│</span><span class="w">         </span><span class="err">┌──────────┼──────────┐</span><span class="w">                                        </span><span class="err">│</span>
<span class="err">│</span><span class="w">         </span><span class="err">▼</span><span class="w">          </span><span class="err">▼</span><span class="w">          </span><span class="err">▼</span><span class="w">                                        </span><span class="err">│</span>
<span class="err">│</span><span class="w">    </span><span class="err">┌─────────┐</span><span class="w"> </span><span class="err">┌─────────┐</span><span class="w"> </span><span class="err">┌─────────┐</span><span class="w">                                </span><span class="err">│</span>
<span class="err">│</span><span class="w">    </span><span class="err">│</span><span class="n">Consumer1</span><span class="err">│</span><span class="w"> </span><span class="err">│</span><span class="n">Consumer2</span><span class="err">│</span><span class="w"> </span><span class="err">│</span><span class="n">Consumer3</span><span class="err">│</span><span class="w">                                </span><span class="err">│</span>
<span class="err">│</span><span class="w">    </span><span class="err">│</span><span class="w">  </span><span class="p">(</span><span class="n">m1</span><span class="p">)</span><span class="w">   </span><span class="err">│</span><span class="w"> </span><span class="err">│</span><span class="w">  </span><span class="p">(</span><span class="n">m2</span><span class="p">)</span><span class="w">   </span><span class="err">│</span><span class="w"> </span><span class="err">│</span><span class="w">  </span><span class="p">(</span><span class="n">m3</span><span class="p">)</span><span class="w">   </span><span class="err">│</span><span class="w">                                </span><span class="err">│</span>
<span class="err">│</span><span class="w">    </span><span class="err">└─────────┘</span><span class="w"> </span><span class="err">└─────────┘</span><span class="w"> </span><span class="err">└─────────┘</span><span class="w">                                </span><span class="err">│</span>
<span class="err">│</span><span class="w">                                                                         </span><span class="err">│</span>
<span class="err">│</span><span class="w">  </span><span class="n">처리량</span><span class="w"> </span><span class="n">증가</span><span class="w"> </span><span class="nl">시</span><span class="p">:</span><span class="w">                                                        </span><span class="err">│</span>
<span class="err">│</span><span class="w">  </span><span class="o">-</span><span class="w"> </span><span class="n">Consumer만</span><span class="w"> </span><span class="n">추가하면</span><span class="w"> </span><span class="n">됨</span><span class="w">                                               </span><span class="err">│</span>
<span class="err">│</span><span class="w">  </span><span class="o">-</span><span class="w"> </span><span class="n">Producer</span><span class="w"> </span><span class="n">코드</span><span class="w"> </span><span class="n">변경</span><span class="w"> </span><span class="n">불필요</span><span class="w">                                            </span><span class="err">│</span>
<span class="err">│</span><span class="w">  </span><span class="o">-</span><span class="w"> </span><span class="n">메시지는</span><span class="w"> </span><span class="n">Consumer들에게</span><span class="w"> </span><span class="n">자동</span><span class="w"> </span><span class="n">분배</span><span class="w">                                    </span><span class="err">│</span>
<span class="err">│</span><span class="w">                                                                         </span><span class="err">│</span>
<span class="err">└─────────────────────────────────────────────────────────────────────────┘</span>
</code></pre></div>

<h3 id="durability">내구성 (Durability)<a class="header-link" href="#durability" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><span class="err">┌─────────────────────────────────────────────────────────────────────────┐</span>
<span class="err">│</span><span class="w">                     </span><span class="n">메시지</span><span class="w"> </span><span class="n">영속성</span><span class="w">                                       </span><span class="err">│</span>
<span class="err">├─────────────────────────────────────────────────────────────────────────┤</span>
<span class="err">│</span><span class="w">                                                                         </span><span class="err">│</span>
<span class="err">│</span><span class="w">  </span><span class="err">┌──────────┐</span><span class="w">     </span><span class="err">┌──────────────────────────┐</span><span class="w">                        </span><span class="err">│</span>
<span class="err">│</span><span class="w">  </span><span class="err">│</span><span class="w"> </span><span class="n">Producer</span><span class="w"> </span><span class="err">│────►│</span><span class="w"> </span><span class="n">Message</span><span class="w"> </span><span class="n">Queue</span><span class="w"> </span><span class="p">(</span><span class="n">Durable</span><span class="p">)</span><span class="w">  </span><span class="err">│</span><span class="w">                        </span><span class="err">│</span>
<span class="err">│</span><span class="w">  </span><span class="err">└──────────┘</span><span class="w">     </span><span class="err">├──────────────────────────┤</span><span class="w">                        </span><span class="err">│</span>
<span class="err">│</span><span class="w">                   </span><span class="err">│</span><span class="w">  </span><span class="n">메모리</span><span class="w">                   </span><span class="err">│</span><span class="w">                        </span><span class="err">│</span>
<span class="err">│</span><span class="w">                   </span><span class="err">│</span><span class="w">  </span><span class="err">┌──────────────────┐</span><span class="w">    </span><span class="err">│</span><span class="w">                        </span><span class="err">│</span>
<span class="err">│</span><span class="w">                   </span><span class="err">│</span><span class="w">  </span><span class="err">│</span><span class="w"> </span><span class="o">[</span><span class="n">msg1</span><span class="o">]</span><span class="w"> </span><span class="o">[</span><span class="n">msg2</span><span class="o">]</span><span class="w">    </span><span class="err">│</span><span class="w">    </span><span class="err">│</span><span class="w">                        </span><span class="err">│</span>
<span class="err">│</span><span class="w">                   </span><span class="err">│</span><span class="w">  </span><span class="err">└────────┬─────────┘</span><span class="w">    </span><span class="err">│</span><span class="w">                        </span><span class="err">│</span>
<span class="err">│</span><span class="w">                   </span><span class="err">│</span><span class="w">           </span><span class="err">│</span><span class="w">              </span><span class="err">│</span><span class="w">                        </span><span class="err">│</span>
<span class="err">│</span><span class="w">                   </span><span class="err">│</span><span class="w">           </span><span class="err">▼</span><span class="w">              </span><span class="err">│</span><span class="w">                        </span><span class="err">│</span>
<span class="err">│</span><span class="w">                   </span><span class="err">│</span><span class="w">  </span><span class="n">디스크</span><span class="w"> </span><span class="p">(</span><span class="n">WAL</span><span class="p">)</span><span class="w">            </span><span class="err">│</span><span class="w">                        </span><span class="err">│</span>
<span class="err">│</span><span class="w">                   </span><span class="err">│</span><span class="w">  </span><span class="err">┌──────────────────┐</span><span class="w">    </span><span class="err">│</span><span class="w">                        </span><span class="err">│</span>
<span class="err">│</span><span class="w">                   </span><span class="err">│</span><span class="w">  </span><span class="err">│</span><span class="w"> </span><span class="n">msg1</span><span class="p">,</span><span class="w"> </span><span class="n">msg2</span><span class="p">,</span><span class="w"> </span><span class="p">...</span><span class="w">  </span><span class="err">│</span><span class="w">    </span><span class="err">│</span><span class="w">                        </span><span class="err">│</span>
<span class="err">│</span><span class="w">                   </span><span class="err">│</span><span class="w">  </span><span class="err">└──────────────────┘</span><span class="w">    </span><span class="err">│</span><span class="w">                        </span><span class="err">│</span>
<span class="err">│</span><span class="w">                   </span><span class="err">└──────────────────────────┘</span><span class="w">                        </span><span class="err">│</span>
<span class="err">│</span><span class="w">                                                                         </span><span class="err">│</span>
<span class="err">│</span><span class="w">  </span><span class="n">장애</span><span class="w"> </span><span class="nl">복구</span><span class="p">:</span><span class="w">                                                             </span><span class="err">│</span>
<span class="err">│</span><span class="w">  </span><span class="mf">1.</span><span class="w"> </span><span class="n">브로커</span><span class="w"> </span><span class="n">재시작</span><span class="w">                                                       </span><span class="err">│</span>
<span class="err">│</span><span class="w">  </span><span class="mf">2.</span><span class="w"> </span><span class="n">디스크에서</span><span class="w"> </span><span class="n">메시지</span><span class="w"> </span><span class="n">복원</span><span class="w">                                              </span><span class="err">│</span>
<span class="err">│</span><span class="w">  </span><span class="mf">3.</span><span class="w"> </span><span class="n">Consumer에게</span><span class="w"> </span><span class="n">재전송</span><span class="w">                                                 </span><span class="err">│</span>
<span class="err">│</span><span class="w">  </span><span class="err">→</span><span class="w"> </span><span class="n">메시지</span><span class="w"> </span><span class="n">유실</span><span class="w"> </span><span class="n">방지</span><span class="w">                                                     </span><span class="err">│</span>
<span class="err">│</span><span class="w">                                                                         </span><span class="err">│</span>
<span class="err">└─────────────────────────────────────────────────────────────────────────┘</span>
</code></pre></div>

<hr />
<h2 id="3-vs">3. 큐 vs 토픽<a class="header-link" href="#3-vs" title="Permanent link">&para;</a></h2>
<h3 id="point-to-point-queue">Point-to-Point (Queue)<a class="header-link" href="#point-to-point-queue" title="Permanent link">&para;</a></h3>
<p>하나의 메시지는 하나의 Consumer만 처리합니다.</p>
<div class="highlight"><pre><span></span><code>┌─────────────────────────────────────────────────────────────────────────┐
│                     Point-to-Point (Queue)                              │
├─────────────────────────────────────────────────────────────────────────┤
│                                                                         │
│                         ┌───────────────────┐                          │
│  ┌──────────┐          │      Queue        │                          │
│  │Producer 1│─────────►│ ┌───┬───┬───┬───┐ │                          │
│  └──────────┘          │ │ A │ B │ C │ D │ │                          │
│                        │ └───┴───┴───┴───┘ │                          │
│  ┌──────────┐          │                   │          ┌──────────┐    │
│  │Producer 2│─────────►│ 각 메시지는       │─────────►│Consumer 1│    │
│  └──────────┘          │ 하나의 Consumer만 │   A,C    └──────────┘    │
│                        │ 처리              │                          │
│                        │                   │          ┌──────────┐    │
│                        │                   │─────────►│Consumer 2│    │
│                        │                   │   B,D    └──────────┘    │
│                        └───────────────────┘                          │
│                                                                         │
│  사용 사례:                                                             │
│  - 작업 분배 (Work Queue)                                               │
│  - 주문 처리                                                            │
│  - 이메일 발송 큐                                                       │
│                                                                         │
└─────────────────────────────────────────────────────────────────────────┘
</code></pre></div>

<h3 id="publishsubscribe-topic">Publish/Subscribe (Topic)<a class="header-link" href="#publishsubscribe-topic" title="Permanent link">&para;</a></h3>
<p>하나의 메시지가 모든 Subscriber에게 전달됩니다.</p>
<div class="highlight"><pre><span></span><code>┌─────────────────────────────────────────────────────────────────────────┐
│                     Publish/Subscribe (Topic)                           │
├─────────────────────────────────────────────────────────────────────────┤
│                                                                         │
│                         ┌───────────────────┐                          │
│  ┌──────────┐          │      Topic        │         ┌────────────┐   │
│  │Publisher │─────────►│ ┌───┬───┬───┬───┐ │────────►│Subscriber 1│   │
│  └──────────┘          │ │ A │ B │ C │ D │ │  A,B,   │ (모든 메시지)  │
│                        │ └───┴───┴───┴───┘ │  C,D    └────────────┘   │
│                        │                   │                          │
│                        │ 모든 Subscriber가 │         ┌────────────┐   │
│                        │ 모든 메시지를     │────────►│Subscriber 2│   │
│                        │ 받음              │  A,B,   │ (모든 메시지)  │
│                        │                   │  C,D    └────────────┘   │
│                        │                   │                          │
│                        │                   │         ┌────────────┐   │
│                        │                   │────────►│Subscriber 3│   │
│                        │                   │  A,B,   │ (모든 메시지)  │
│                        └───────────────────┘  C,D    └────────────┘   │
│                                                                         │
│  사용 사례:                                                             │
│  - 이벤트 브로드캐스트                                                  │
│  - 로그 수집 (여러 시스템이 같은 로그 수신)                             │
│  - 가격 업데이트 (모든 클라이언트에게 전파)                             │
│                                                                         │
└─────────────────────────────────────────────────────────────────────────┘
</code></pre></div>

<h3 id="consumer-group">Consumer Group (하이브리드)<a class="header-link" href="#consumer-group" title="Permanent link">&para;</a></h3>
<p>Kafka 스타일: Topic + 그룹 내 분산 처리</p>
<div class="highlight"><pre><span></span><code>┌─────────────────────────────────────────────────────────────────────────┐
│                     Consumer Group                                      │
├─────────────────────────────────────────────────────────────────────────┤
│                                                                         │
│                         ┌───────────────────┐                          │
│                        │      Topic        │                          │
│  ┌──────────┐          │ ┌───┬───┬───┬───┐ │                          │
│  │Publisher │─────────►│ │ A │ B │ C │ D │ │                          │
│  └──────────┘          │ └───┴───┴───┴───┘ │                          │
│                        └─────────┬─────────┘                          │
│                                  │                                     │
│              ┌───────────────────┼───────────────────┐                 │
│              ▼                   ▼                   ▼                 │
│  ┌───────────────────┐ ┌───────────────────┐ ┌───────────────────┐    │
│  │  Consumer Group 1 │ │  Consumer Group 2 │ │  Consumer Group 3 │    │
│  │ (Order Service)   │ │ (Analytics)       │ │ (Notification)    │    │
│  ├───────────────────┤ ├───────────────────┤ ├───────────────────┤    │
│  │ ┌────┐ ┌────┐    │ │ ┌────┐ ┌────┐    │ │ ┌────┐            │    │
│  │ │C1-1│ │C1-2│    │ │ │C2-1│ │C2-2│    │ │ │C3-1│            │    │
│  │ │A,C │ │B,D │    │ │ │A,C │ │B,D │    │ │ │A,B,C,D│         │    │
│  │ └────┘ └────┘    │ │ └────┘ └────┘    │ │ └────┘            │    │
│  └───────────────────┘ └───────────────────┘ └───────────────────┘    │
│                                                                         │
│  동작:                                                                  │
│  - 각 그룹은 모든 메시지 수신 (Pub/Sub)                                 │
│  - 그룹 내에서는 메시지 분산 (Point-to-Point)                           │
│  - 확장: 그룹 내 Consumer 추가                                          │
│                                                                         │
└─────────────────────────────────────────────────────────────────────────┘
</code></pre></div>

<h3 id="_4">패턴 비교<a class="header-link" href="#_4" title="Permanent link">&para;</a></h3>
<table>
<thead>
<tr>
<th>특성</th>
<th>Queue (P2P)</th>
<th>Topic (Pub/Sub)</th>
<th>Consumer Group</th>
</tr>
</thead>
<tbody>
<tr>
<td>메시지 복사</td>
<td>1:1</td>
<td>1:N</td>
<td>그룹당 1</td>
</tr>
<tr>
<td>부하 분산</td>
<td>O</td>
<td>X</td>
<td>그룹 내 O</td>
</tr>
<tr>
<td>브로드캐스트</td>
<td>X</td>
<td>O</td>
<td>그룹간 O</td>
</tr>
<tr>
<td>확장성</td>
<td>Consumer 추가</td>
<td>제한적</td>
<td>유연함</td>
</tr>
</tbody>
</table>
<hr />
<h2 id="4">4. 메시지 전달 보장<a class="header-link" href="#4" title="Permanent link">&para;</a></h2>
<h3 id="at-most-once">At-Most-Once (최대 한 번)<a class="header-link" href="#at-most-once" title="Permanent link">&para;</a></h3>
<p>메시지가 유실될 수 있지만, 중복은 없습니다.</p>
<div class="highlight"><pre><span></span><code>┌─────────────────────────────────────────────────────────────────────────┐
│<span class="w">                     </span><span class="nv">At</span><span class="o">-</span><span class="nv">Most</span><span class="o">-</span><span class="nv">Once</span><span class="w">                                        </span>│
├─────────────────────────────────────────────────────────────────────────┤
│<span class="w">                                                                         </span>│
│<span class="w">  </span>┌──────────┐<span class="w">     </span>┌─────────┐<span class="w">     </span>┌──────────┐<span class="w">                        </span>│
│<span class="w">  </span>│<span class="w"> </span><span class="nv">Producer</span><span class="w"> </span>│<span class="w">     </span>│<span class="w">  </span><span class="nv">Queue</span><span class="w">  </span>│<span class="w">     </span>│<span class="w"> </span><span class="nv">Consumer</span><span class="w"> </span>│<span class="w">                        </span>│
│<span class="w">  </span>└────┬─────┘<span class="w">     </span>└────┬────┘<span class="w">     </span>└────┬─────┘<span class="w">                        </span>│
│<span class="w">       </span>│<span class="w">                </span>│<span class="w">               </span>│<span class="w">                               </span>│
│<span class="w">       </span>│──<span class="w"> </span><span class="k">Send</span><span class="ss">(</span><span class="nv">msg</span><span class="ss">)</span><span class="w"> </span>──►│<span class="w">               </span>│<span class="w">                               </span>│
│<span class="w">       </span>│<span class="w">                </span>│──<span class="w"> </span><span class="nv">Deliver</span><span class="w"> </span>───►│<span class="w">                               </span>│
│<span class="w">       </span>│<span class="w">                </span>│<span class="w">               </span><span class="nv">X</span><span class="w"> </span>처리<span class="w"> </span>전<span class="w"> </span>장애<span class="o">!</span><span class="w">                 </span>│
│<span class="w">       </span>│<span class="w">                </span>│<span class="w">               </span>│<span class="w">                               </span>│
│<span class="w">       </span>│<span class="w">                </span>│<span class="w"> </span><span class="ss">(</span>메시지<span class="w"> </span>삭제<span class="ss">)</span><span class="w"> </span>│<span class="w">                               </span>│
│<span class="w">       </span>│<span class="w">                </span>│<span class="w">               </span>│<span class="w">                               </span>│
│<span class="w">       </span>│<span class="w">                </span>│<span class="w"> </span>재전송<span class="w"> </span>없음<span class="w">   </span>│<span class="w">                               </span>│
│<span class="w">       </span>│<span class="w">                </span>│<span class="w">               </span>│<span class="w">                               </span>│
│<span class="w">                                                                         </span>│
│<span class="w">  </span>구현:<span class="w"> </span><span class="nv">ACK</span><span class="w"> </span>전에<span class="w"> </span>메시지<span class="w"> </span>삭제<span class="w">                                             </span>│
│<span class="w">                                                                         </span>│
│<span class="w">  </span>장점:<span class="w">                                                                  </span>│
│<span class="w">  </span><span class="o">-</span><span class="w"> </span>중복<span class="w"> </span>처리<span class="w"> </span>불필요<span class="w">                                                     </span>│
│<span class="w">  </span><span class="o">-</span><span class="w"> </span>가장<span class="w"> </span>빠른<span class="w"> </span>성능<span class="w">                                                       </span>│
│<span class="w">                                                                         </span>│
│<span class="w">  </span>단점:<span class="w">                                                                  </span>│
│<span class="w">  </span><span class="o">-</span><span class="w"> </span>메시지<span class="w"> </span>유실<span class="w"> </span>가능<span class="w">                                                     </span>│
│<span class="w">                                                                         </span>│
│<span class="w">  </span>사용<span class="w"> </span>사례:<span class="w">                                                             </span>│
│<span class="w">  </span><span class="o">-</span><span class="w"> </span>실시간<span class="w"> </span>센서<span class="w"> </span>데이터<span class="w"> </span><span class="ss">(</span>일부<span class="w"> </span>유실<span class="w"> </span>허용<span class="ss">)</span><span class="w">                                  </span>│
│<span class="w">  </span><span class="o">-</span><span class="w"> </span>로그<span class="w"> </span>수집<span class="w"> </span><span class="ss">(</span>완전성보다<span class="w"> </span>성능<span class="w"> </span>중요<span class="ss">)</span><span class="w">                                     </span>│
│<span class="w">                                                                         </span>│
└─────────────────────────────────────────────────────────────────────────┘
</code></pre></div>

<h3 id="at-least-once">At-Least-Once (최소 한 번)<a class="header-link" href="#at-least-once" title="Permanent link">&para;</a></h3>
<p>메시지가 중복될 수 있지만, 유실은 없습니다.</p>
<div class="highlight"><pre><span></span><code>┌─────────────────────────────────────────────────────────────────────────┐
│<span class="w">                     </span><span class="nv">At</span><span class="o">-</span><span class="nv">Least</span><span class="o">-</span><span class="nv">Once</span><span class="w">                                       </span>│
├─────────────────────────────────────────────────────────────────────────┤
│<span class="w">                                                                         </span>│
│<span class="w">  </span>┌──────────┐<span class="w">     </span>┌─────────┐<span class="w">     </span>┌──────────┐<span class="w">                        </span>│
│<span class="w">  </span>│<span class="w"> </span><span class="nv">Producer</span><span class="w"> </span>│<span class="w">     </span>│<span class="w">  </span><span class="nv">Queue</span><span class="w">  </span>│<span class="w">     </span>│<span class="w"> </span><span class="nv">Consumer</span><span class="w"> </span>│<span class="w">                        </span>│
│<span class="w">  </span>└────┬─────┘<span class="w">     </span>└────┬────┘<span class="w">     </span>└────┬─────┘<span class="w">                        </span>│
│<span class="w">       </span>│<span class="w">                </span>│<span class="w">               </span>│<span class="w">                               </span>│
│<span class="w">       </span>│──<span class="w"> </span><span class="k">Send</span><span class="ss">(</span><span class="nv">msg</span><span class="ss">)</span><span class="w"> </span>──►│<span class="w">               </span>│<span class="w">                               </span>│
│<span class="w">       </span>│<span class="w">                </span>│──<span class="w"> </span><span class="nv">Deliver</span><span class="w"> </span>───►│<span class="w">                               </span>│
│<span class="w">       </span>│<span class="w">                </span>│<span class="w">               </span>│<span class="w"> </span>처리<span class="w"> </span>완료<span class="w">                     </span>│
│<span class="w">       </span>│<span class="w">                </span>│<span class="w">               </span><span class="nv">X</span><span class="w"> </span><span class="nv">ACK</span><span class="w"> </span>전<span class="w"> </span>장애<span class="o">!</span><span class="w">                  </span>│
│<span class="w">       </span>│<span class="w">                </span>│<span class="w">               </span>│<span class="w">                               </span>│
│<span class="w">       </span>│<span class="w">                </span>│<span class="w"> </span><span class="ss">(</span><span class="nv">ACK</span><span class="w"> </span>미수신<span class="ss">)</span><span class="w">  </span>│<span class="w">                               </span>│
│<span class="w">       </span>│<span class="w">                </span>│<span class="w">               </span>│<span class="w">                               </span>│
│<span class="w">       </span>│<span class="w">                </span>│──<span class="w"> </span><span class="nv">Redeliver</span><span class="w"> </span>─►│<span class="w"> </span>←<span class="w"> </span>재전송<span class="w"> </span><span class="ss">(</span>중복<span class="o">!</span><span class="ss">)</span><span class="w">             </span>│
│<span class="w">       </span>│<span class="w">                </span>│◄──<span class="w"> </span><span class="nv">ACK</span><span class="w"> </span>───────│<span class="w">                               </span>│
│<span class="w">       </span>│<span class="w">                </span>│<span class="w">               </span>│<span class="w">                               </span>│
│<span class="w">                                                                         </span>│
│<span class="w">  </span>구현:<span class="w"> </span><span class="nv">ACK</span><span class="w"> </span>후에만<span class="w"> </span>메시지<span class="w"> </span>삭제<span class="w">                                           </span>│
│<span class="w">                                                                         </span>│
│<span class="w">  </span>장점:<span class="w">                                                                  </span>│
│<span class="w">  </span><span class="o">-</span><span class="w"> </span>메시지<span class="w"> </span>유실<span class="w"> </span>없음<span class="w">                                                     </span>│
│<span class="w">                                                                         </span>│
│<span class="w">  </span>단점:<span class="w">                                                                  </span>│
│<span class="w">  </span><span class="o">-</span><span class="w"> </span>중복<span class="w"> </span>처리<span class="w"> </span>필요<span class="w"> </span><span class="ss">(</span>멱등성<span class="w"> </span>필요<span class="ss">)</span><span class="w">                                         </span>│
│<span class="w">                                                                         </span>│
│<span class="w">  </span>사용<span class="w"> </span>사례:<span class="w">                                                             </span>│
│<span class="w">  </span><span class="o">-</span><span class="w"> </span>결제<span class="w"> </span>처리<span class="w"> </span><span class="ss">(</span>유실<span class="w"> </span>불가,<span class="w"> </span>멱등성<span class="w"> </span>구현<span class="ss">)</span><span class="w">                                   </span>│
│<span class="w">  </span><span class="o">-</span><span class="w"> </span>주문<span class="w"> </span>처리<span class="w">                                                            </span>│
│<span class="w">  </span><span class="o">-</span><span class="w"> </span>이메일<span class="w"> </span>발송<span class="w">                                                          </span>│
│<span class="w">                                                                         </span>│
└─────────────────────────────────────────────────────────────────────────┘
</code></pre></div>

<h3 id="exactly-once">Exactly-Once (정확히 한 번)<a class="header-link" href="#exactly-once" title="Permanent link">&para;</a></h3>
<p>이론적으로 가장 이상적이지만, 구현이 복잡합니다.</p>
<div class="highlight"><pre><span></span><code>┌─────────────────────────────────────────────────────────────────────────┐
│                     Exactly-Once                                        │
├─────────────────────────────────────────────────────────────────────────┤
│                                                                         │
│  순수한 Exactly-Once는 분산 시스템에서 불가능!                          │
│  (Two Generals Problem)                                                │
│                                                                         │
│  실용적 구현: &quot;Effectively Once&quot;                                        │
│                                                                         │
│  방법 1: At-Least-Once + 멱등성 Consumer                                │
│  ┌──────────┐     ┌─────────┐     ┌──────────────────┐                │
│  │ Producer │────►│  Queue  │────►│ Idempotent       │                │
│  └──────────┘     └─────────┘     │ Consumer         │                │
│                                   │ ┌──────────────┐ │                │
│                                   │ │Processed IDs │ │                │
│                                   │ │{id1, id2, ..}│ │                │
│                                   │ └──────────────┘ │                │
│                                   │ 이미 처리된 건   │                │
│                                   │ 무시             │                │
│                                   └──────────────────┘                │
│                                                                         │
│  방법 2: 트랜잭션 기반 (Kafka Transactions)                             │
│  ┌──────────────────────────────────────────────────────────┐          │
│  │  Transaction                                             │          │
│  │  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐      │          │
│  │  │ Read from   │──│ Process     │──│ Write to    │      │          │
│  │  │ input topic │  │             │  │ output topic│      │          │
│  │  └─────────────┘  └─────────────┘  └─────────────┘      │          │
│  │                                                          │          │
│  │  → 모두 성공 또는 모두 실패                              │          │
│  └──────────────────────────────────────────────────────────┘          │
│                                                                         │
│  사용 사례:                                                             │
│  - 금융 거래                                                            │
│  - 재고 관리                                                            │
│  - 스트림 처리 (Kafka Streams)                                          │
│                                                                         │
└─────────────────────────────────────────────────────────────────────────┘
</code></pre></div>

<h3 id="_5">전달 보장 비교<a class="header-link" href="#_5" title="Permanent link">&para;</a></h3>
<table>
<thead>
<tr>
<th>보장 수준</th>
<th>유실</th>
<th>중복</th>
<th>성능</th>
<th>복잡도</th>
</tr>
</thead>
<tbody>
<tr>
<td>At-Most-Once</td>
<td>가능</td>
<td>없음</td>
<td>최고</td>
<td>낮음</td>
</tr>
<tr>
<td>At-Least-Once</td>
<td>없음</td>
<td>가능</td>
<td>좋음</td>
<td>중간</td>
</tr>
<tr>
<td>Exactly-Once</td>
<td>없음</td>
<td>없음</td>
<td>낮음</td>
<td>높음</td>
</tr>
</tbody>
</table>
<hr />
<h2 id="5-idempotency">5. 멱등성 (Idempotency)<a class="header-link" href="#5-idempotency" title="Permanent link">&para;</a></h2>
<h3 id="_6">멱등성이란?<a class="header-link" href="#_6" title="Permanent link">&para;</a></h3>
<p>같은 연산을 여러 번 수행해도 결과가 동일한 성질입니다.</p>
<div class="highlight"><pre><span></span><code>┌─────────────────────────────────────────────────────────────────────────┐
│                     멱등성 (Idempotency)                                │
├─────────────────────────────────────────────────────────────────────────┤
│                                                                         │
│  멱등 연산:                                                             │
│  f(f(x)) = f(x)                                                        │
│                                                                         │
│  예시:                                                                  │
│  ┌────────────────────────────────────────────────────────────────┐    │
│  │  연산                     │ 멱등?  │ 설명                      │    │
│  ├────────────────────────────────────────────────────────────────┤    │
│  │  x = 5                    │  O     │ 여러 번 해도 x=5         │    │
│  │  DELETE /users/123        │  O     │ 이미 삭제된 것 다시 삭제 │    │
│  │  PUT /users/123 {name:A}  │  O     │ 같은 값으로 덮어쓰기     │    │
│  ├────────────────────────────────────────────────────────────────┤    │
│  │  x = x + 1                │  X     │ 할 때마다 증가           │    │
│  │  POST /orders             │  X     │ 호출마다 새 주문 생성    │    │
│  │  account.balance -= 100   │  X     │ 호출마다 차감            │    │
│  └────────────────────────────────────────────────────────────────┘    │
│                                                                         │
└─────────────────────────────────────────────────────────────────────────┘
</code></pre></div>

<h3 id="_7">멱등성 구현 패턴<a class="header-link" href="#_7" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><span class="err">┌─────────────────────────────────────────────────────────────────────────┐</span>
<span class="err">│</span><span class="w">                     </span><span class="nt">멱등성</span><span class="w"> </span><span class="nt">구현</span><span class="w"> </span><span class="nt">방법</span><span class="w">                                    </span><span class="err">│</span>
<span class="err">├─────────────────────────────────────────────────────────────────────────┤</span>
<span class="err">│</span><span class="w">                                                                         </span><span class="err">│</span>
<span class="err">│</span><span class="w">  </span><span class="nt">방법</span><span class="w"> </span><span class="nt">1</span><span class="o">:</span><span class="w"> </span><span class="nt">Idempotency</span><span class="w"> </span><span class="nt">Key</span><span class="w">                                               </span><span class="err">│</span>
<span class="err">│</span><span class="w">                                                                         </span><span class="err">│</span>
<span class="err">│</span><span class="w">  </span><span class="err">┌──────────┐</span><span class="w">                         </span><span class="err">┌────────────────────────┐</span><span class="w">       </span><span class="err">│</span>
<span class="err">│</span><span class="w">  </span><span class="err">│</span><span class="w">  </span><span class="nt">Client</span><span class="w">  </span><span class="err">│</span><span class="w">                         </span><span class="err">│</span><span class="w">        </span><span class="nt">Server</span><span class="w">          </span><span class="err">│</span><span class="w">       </span><span class="err">│</span>
<span class="err">│</span><span class="w">  </span><span class="err">└────┬─────┘</span><span class="w">                         </span><span class="err">│</span><span class="w">  </span><span class="err">┌──────────────────┐</span><span class="w">  </span><span class="err">│</span><span class="w">       </span><span class="err">│</span>
<span class="err">│</span><span class="w">       </span><span class="err">│</span><span class="w">                               </span><span class="err">│</span><span class="w">  </span><span class="err">│</span><span class="w"> </span><span class="nt">Processed</span><span class="w"> </span><span class="nt">Keys</span><span class="w">   </span><span class="err">│</span><span class="w">  </span><span class="err">│</span><span class="w">       </span><span class="err">│</span>
<span class="err">│</span><span class="w">       </span><span class="err">│──</span><span class="nt">POST</span><span class="w"> </span><span class="o">/</span><span class="nt">payment</span><span class="w">                </span><span class="err">│</span><span class="w">  </span><span class="err">│</span><span class="w"> </span><span class="p">{</span><span class="err">key1,</span><span class="w"> </span><span class="err">key2,</span><span class="w"> </span><span class="err">...</span><span class="p">}</span><span class="err">│</span><span class="w">  </span><span class="err">│</span><span class="w">       </span><span class="err">│</span>
<span class="err">│</span><span class="w">       </span><span class="err">│</span><span class="w">  </span><span class="nt">Idempotency-Key</span><span class="o">:</span><span class="w"> </span><span class="nt">abc123</span><span class="w">     </span><span class="err">│</span><span class="w">  </span><span class="err">└──────────────────┘</span><span class="w">  </span><span class="err">│</span><span class="w">       </span><span class="err">│</span>
<span class="err">│</span><span class="w">       </span><span class="err">│</span><span class="w">  </span><span class="p">{</span><span class="n">amount</span><span class="p">:</span><span class="w"> </span><span class="mi">100</span><span class="p">}</span><span class="w">               </span><span class="err">│</span><span class="w">                        </span><span class="err">│</span><span class="w">       </span><span class="err">│</span>
<span class="err">│</span><span class="w">       </span><span class="err">│</span><span class="w">                               </span><span class="err">│</span><span class="w">  </span><span class="nt">1</span><span class="o">.</span><span class="w"> </span><span class="nt">Check</span><span class="o">:</span><span class="w"> </span><span class="nt">abc123</span><span class="o">?</span><span class="w">    </span><span class="err">│</span><span class="w">       </span><span class="err">│</span>
<span class="err">│</span><span class="w">       </span><span class="err">│</span><span class="w">                               </span><span class="err">│</span><span class="w">  </span><span class="nt">2</span><span class="o">.</span><span class="w"> </span><span class="nt">Not</span><span class="w"> </span><span class="nt">found</span><span class="w"> </span><span class="err">→</span><span class="w"> </span><span class="nt">처리</span><span class="w">   </span><span class="err">│</span><span class="w">       </span><span class="err">│</span>
<span class="err">│</span><span class="w">       </span><span class="err">│</span><span class="w">                               </span><span class="err">│</span><span class="w">  </span><span class="nt">3</span><span class="o">.</span><span class="w"> </span><span class="nt">Store</span><span class="w"> </span><span class="nt">abc123</span><span class="w">      </span><span class="err">│</span><span class="w">       </span><span class="err">│</span>
<span class="err">│</span><span class="w">       </span><span class="err">│◄─</span><span class="w"> </span><span class="nt">200</span><span class="w"> </span><span class="nt">OK</span><span class="w"> </span><span class="err">─────────────────────│</span><span class="w">                        </span><span class="err">│</span><span class="w">       </span><span class="err">│</span>
<span class="err">│</span><span class="w">       </span><span class="err">│</span><span class="w">                               </span><span class="err">│</span><span class="w">                        </span><span class="err">│</span><span class="w">       </span><span class="err">│</span>
<span class="err">│</span><span class="w">       </span><span class="err">│──</span><span class="nt">POST</span><span class="w"> </span><span class="o">/</span><span class="nt">payment</span><span class="w"> </span><span class="o">(</span><span class="nt">재시도</span><span class="o">)</span><span class="w">       </span><span class="err">│</span><span class="w">                        </span><span class="err">│</span><span class="w">       </span><span class="err">│</span>
<span class="err">│</span><span class="w">       </span><span class="err">│</span><span class="w">  </span><span class="nt">Idempotency-Key</span><span class="o">:</span><span class="w"> </span><span class="nt">abc123</span><span class="w">     </span><span class="err">│</span><span class="w">                        </span><span class="err">│</span><span class="w">       </span><span class="err">│</span>
<span class="err">│</span><span class="w">       </span><span class="err">│</span><span class="w">  </span><span class="p">{</span><span class="n">amount</span><span class="p">:</span><span class="w"> </span><span class="mi">100</span><span class="p">}</span><span class="w">               </span><span class="err">│</span><span class="w">                        </span><span class="err">│</span><span class="w">       </span><span class="err">│</span>
<span class="err">│</span><span class="w">       </span><span class="err">│</span><span class="w">                               </span><span class="err">│</span><span class="w">  </span><span class="nt">1</span><span class="o">.</span><span class="w"> </span><span class="nt">Check</span><span class="o">:</span><span class="w"> </span><span class="nt">abc123</span><span class="o">?</span><span class="w">    </span><span class="err">│</span><span class="w">       </span><span class="err">│</span>
<span class="err">│</span><span class="w">       </span><span class="err">│</span><span class="w">                               </span><span class="err">│</span><span class="w">  </span><span class="nt">2</span><span class="o">.</span><span class="w"> </span><span class="nt">Found</span><span class="w"> </span><span class="err">→</span><span class="w"> </span><span class="nt">기존</span><span class="w"> </span><span class="nt">응답</span><span class="w">  </span><span class="err">│</span><span class="w">       </span><span class="err">│</span>
<span class="err">│</span><span class="w">       </span><span class="err">│◄─</span><span class="w"> </span><span class="nt">200</span><span class="w"> </span><span class="nt">OK</span><span class="w"> </span><span class="o">(</span><span class="nt">동일</span><span class="w"> </span><span class="nt">응답</span><span class="o">)</span><span class="w"> </span><span class="err">─────────│</span><span class="w">                        </span><span class="err">│</span><span class="w">       </span><span class="err">│</span>
<span class="err">│</span><span class="w">       </span><span class="err">│</span><span class="w">                               </span><span class="err">│</span><span class="w">                        </span><span class="err">│</span><span class="w">       </span><span class="err">│</span>
<span class="err">│</span><span class="w">                                                                         </span><span class="err">│</span>
<span class="err">├─────────────────────────────────────────────────────────────────────────┤</span>
<span class="err">│</span><span class="w">  </span><span class="nt">방법</span><span class="w"> </span><span class="nt">2</span><span class="o">:</span><span class="w"> </span><span class="nt">버전</span><span class="o">/</span><span class="nt">조건부</span><span class="w"> </span><span class="nt">업데이트</span><span class="w">                                           </span><span class="err">│</span>
<span class="err">│</span><span class="w">                                                                         </span><span class="err">│</span>
<span class="err">│</span><span class="w">  </span><span class="nt">--</span><span class="w"> </span><span class="nt">비멱등적</span><span class="w"> </span><span class="nt">UPDATE</span><span class="w">                                                     </span><span class="err">│</span>
<span class="err">│</span><span class="w">  </span><span class="nt">UPDATE</span><span class="w"> </span><span class="nt">accounts</span><span class="w"> </span><span class="nt">SET</span><span class="w"> </span><span class="nt">balance</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nt">balance</span><span class="w"> </span><span class="nt">-</span><span class="w"> </span><span class="nt">100</span><span class="w"> </span><span class="nt">WHERE</span><span class="w"> </span><span class="nt">id</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nt">1</span><span class="o">;</span><span class="w">             </span><span class="err">│</span>
<span class="err">│</span><span class="w">  </span><span class="nt">--</span><span class="w"> </span><span class="nt">실행할</span><span class="w"> </span><span class="nt">때마다</span><span class="w"> </span><span class="nt">100</span><span class="w"> </span><span class="nt">감소</span><span class="w">                                              </span><span class="err">│</span>
<span class="err">│</span><span class="w">                                                                         </span><span class="err">│</span>
<span class="err">│</span><span class="w">  </span><span class="nt">--</span><span class="w"> </span><span class="nt">멱등적</span><span class="w"> </span><span class="nt">UPDATE</span><span class="w"> </span><span class="o">(</span><span class="nt">버전</span><span class="w"> </span><span class="nt">사용</span><span class="o">)</span><span class="w">                                           </span><span class="err">│</span>
<span class="err">│</span><span class="w">  </span><span class="nt">UPDATE</span><span class="w"> </span><span class="nt">accounts</span><span class="w">                                                        </span><span class="err">│</span>
<span class="err">│</span><span class="w">  </span><span class="nt">SET</span><span class="w"> </span><span class="nt">balance</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nt">balance</span><span class="w"> </span><span class="nt">-</span><span class="w"> </span><span class="nt">100</span><span class="o">,</span><span class="w"> </span><span class="nt">version</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nt">2</span><span class="w">                               </span><span class="err">│</span>
<span class="err">│</span><span class="w">  </span><span class="nt">WHERE</span><span class="w"> </span><span class="nt">id</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nt">1</span><span class="w"> </span><span class="nt">AND</span><span class="w"> </span><span class="nt">version</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nt">1</span><span class="o">;</span><span class="w">                                         </span><span class="err">│</span>
<span class="err">│</span><span class="w">  </span><span class="nt">--</span><span class="w"> </span><span class="nt">version이</span><span class="w"> </span><span class="nt">1일</span><span class="w"> </span><span class="nt">때만</span><span class="w"> </span><span class="nt">실행</span><span class="w"> </span><span class="o">(</span><span class="nt">한</span><span class="w"> </span><span class="nt">번만</span><span class="w"> </span><span class="nt">성공</span><span class="o">)</span><span class="w">                              </span><span class="err">│</span>
<span class="err">│</span><span class="w">                                                                         </span><span class="err">│</span>
<span class="err">├─────────────────────────────────────────────────────────────────────────┤</span>
<span class="err">│</span><span class="w">  </span><span class="nt">방법</span><span class="w"> </span><span class="nt">3</span><span class="o">:</span><span class="w"> </span><span class="nt">절대값</span><span class="w"> </span><span class="nt">설정</span><span class="w">                                                    </span><span class="err">│</span>
<span class="err">│</span><span class="w">                                                                         </span><span class="err">│</span>
<span class="err">│</span><span class="w">  </span><span class="nt">--</span><span class="w"> </span><span class="nt">비멱등적</span><span class="w">                                                            </span><span class="err">│</span>
<span class="err">│</span><span class="w">  </span><span class="nt">INSERT</span><span class="w"> </span><span class="nt">INTO</span><span class="w"> </span><span class="nt">orders</span><span class="w"> </span><span class="o">(</span><span class="nt">user_id</span><span class="o">,</span><span class="w"> </span><span class="nt">amount</span><span class="o">)</span><span class="w"> </span><span class="nt">VALUES</span><span class="w"> </span><span class="o">(</span><span class="nt">1</span><span class="o">,</span><span class="w"> </span><span class="nt">100</span><span class="o">);</span><span class="w">                 </span><span class="err">│</span>
<span class="err">│</span><span class="w">                                                                         </span><span class="err">│</span>
<span class="err">│</span><span class="w">  </span><span class="nt">--</span><span class="w"> </span><span class="nt">멱등적</span><span class="w"> </span><span class="o">(</span><span class="nt">UPSERT</span><span class="o">)</span><span class="w">                                                     </span><span class="err">│</span>
<span class="err">│</span><span class="w">  </span><span class="nt">INSERT</span><span class="w"> </span><span class="nt">INTO</span><span class="w"> </span><span class="nt">orders</span><span class="w"> </span><span class="o">(</span><span class="nt">order_id</span><span class="o">,</span><span class="w"> </span><span class="nt">user_id</span><span class="o">,</span><span class="w"> </span><span class="nt">amount</span><span class="o">)</span><span class="w">                        </span><span class="err">│</span>
<span class="err">│</span><span class="w">  </span><span class="nt">VALUES</span><span class="w"> </span><span class="o">(</span><span class="s1">&#39;order-abc123&#39;</span><span class="o">,</span><span class="w"> </span><span class="nt">1</span><span class="o">,</span><span class="w"> </span><span class="nt">100</span><span class="o">)</span><span class="w">                                       </span><span class="err">│</span>
<span class="err">│</span><span class="w">  </span><span class="nt">ON</span><span class="w"> </span><span class="nt">CONFLICT</span><span class="w"> </span><span class="o">(</span><span class="nt">order_id</span><span class="o">)</span><span class="w"> </span><span class="nt">DO</span><span class="w"> </span><span class="nt">NOTHING</span><span class="o">;</span><span class="w">                                    </span><span class="err">│</span>
<span class="err">│</span><span class="w">                                                                         </span><span class="err">│</span>
<span class="err">└─────────────────────────────────────────────────────────────────────────┘</span>
</code></pre></div>

<h3 id="consumer">멱등성 Consumer 구현 예시<a class="header-link" href="#consumer" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><span class="k">class</span><span class="w"> </span><span class="nc">IdempotentConsumer</span><span class="p">:</span>
    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">redis_client</span><span class="p">,</span> <span class="n">db</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">redis</span> <span class="o">=</span> <span class="n">redis_client</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">db</span> <span class="o">=</span> <span class="n">db</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">process_message</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">message</span><span class="p">):</span>
        <span class="n">message_id</span> <span class="o">=</span> <span class="n">message</span><span class="p">[</span><span class="s1">&#39;id&#39;</span><span class="p">]</span>

        <span class="c1"># 1. 이미 처리된 메시지인지 확인</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_processed</span><span class="p">(</span><span class="n">message_id</span><span class="p">):</span>
            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Message </span><span class="si">{</span><span class="n">message_id</span><span class="si">}</span><span class="s2"> already processed, skipping&quot;</span><span class="p">)</span>
            <span class="k">return</span>

        <span class="c1"># 2. 비즈니스 로직 처리</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">handle_business_logic</span><span class="p">(</span><span class="n">message</span><span class="p">)</span>

            <span class="c1"># 3. 처리 완료 표시 (원자적으로)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">mark_processed</span><span class="p">(</span><span class="n">message_id</span><span class="p">)</span>

        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="c1"># 처리 실패 시 재시도 가능</span>
            <span class="k">raise</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">is_processed</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">message_id</span><span class="p">):</span>
        <span class="c1"># Redis SET 사용 (TTL 설정으로 메모리 관리)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">redis</span><span class="o">.</span><span class="n">sismember</span><span class="p">(</span><span class="s2">&quot;processed_messages&quot;</span><span class="p">,</span> <span class="n">message_id</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">mark_processed</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">message_id</span><span class="p">):</span>
        <span class="c1"># 24시간 후 자동 삭제</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">redis</span><span class="o">.</span><span class="n">sadd</span><span class="p">(</span><span class="s2">&quot;processed_messages&quot;</span><span class="p">,</span> <span class="n">message_id</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">redis</span><span class="o">.</span><span class="n">expire</span><span class="p">(</span><span class="s2">&quot;processed_messages&quot;</span><span class="p">,</span> <span class="mi">86400</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">handle_business_logic</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">message</span><span class="p">):</span>
        <span class="c1"># 실제 비즈니스 로직</span>
        <span class="k">if</span> <span class="n">message</span><span class="p">[</span><span class="s1">&#39;type&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;payment&#39;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">process_payment</span><span class="p">(</span><span class="n">message</span><span class="p">[</span><span class="s1">&#39;data&#39;</span><span class="p">])</span>
</code></pre></div>

<hr />
<h2 id="6">6. 메시지 큐 패턴<a class="header-link" href="#6" title="Permanent link">&para;</a></h2>
<h3 id="work-queue-task-queue">Work Queue (Task Queue)<a class="header-link" href="#work-queue-task-queue" title="Permanent link">&para;</a></h3>
<p>작업을 여러 워커에게 분배합니다.</p>
<div class="highlight"><pre><span></span><code>┌─────────────────────────────────────────────────────────────────────────┐
│                     Work Queue Pattern                                  │
├─────────────────────────────────────────────────────────────────────────┤
│                                                                         │
│                       ┌─────────────────┐                              │
│                       │   Work Queue    │                              │
│  ┌──────────┐        │ ┌───┬───┬───┐   │         ┌──────────┐         │
│  │ Producer │───────►│ │T1 │T2 │T3 │   │────────►│ Worker 1 │         │
│  │  (Web)   │        │ ├───┼───┼───┤   │         └──────────┘         │
│  └──────────┘        │ │T4 │T5 │T6 │   │                              │
│                       │ └───┴───┴───┘   │         ┌──────────┐         │
│                       └─────────────────┘────────►│ Worker 2 │         │
│                                                   └──────────┘         │
│  사용 사례:                                        ┌──────────┐         │
│  - 이미지 리사이징                          ─────►│ Worker 3 │         │
│  - PDF 생성                                        └──────────┘         │
│  - 이메일 발송                                                          │
│                                                                         │
└─────────────────────────────────────────────────────────────────────────┘
</code></pre></div>

<h3 id="request-reply">Request-Reply<a class="header-link" href="#request-reply" title="Permanent link">&para;</a></h3>
<p>비동기 요청-응답 패턴입니다.</p>
<div class="highlight"><pre><span></span><code>┌─────────────────────────────────────────────────────────────────────────┐
│                     Request-Reply Pattern                               │
├─────────────────────────────────────────────────────────────────────────┤
│                                                                         │
│  ┌──────────┐     ┌─────────────┐     ┌──────────┐                    │
│  │ Requester│     │Request Queue│     │ Replier  │                    │
│  │          │     └─────────────┘     │          │                    │
│  │          │     ┌─────────────┐     │          │                    │
│  │          │     │Reply Queue  │     │          │                    │
│  └────┬─────┘     └──────┬──────┘     └────┬─────┘                    │
│       │                  │                 │                           │
│       │─Request(replyTo:Q1,correlationId:C1)─►│                        │
│       │                  │                 │                           │
│       │                  │                 │ 처리                      │
│       │                  │                 │                           │
│       │◄──Reply(correlationId:C1)──────────│                           │
│       │                  │                 │                           │
│                                                                         │
│  메시지 구조:                                                           │
│  Request: {                                                             │
│    correlationId: &quot;req-123&quot;,                                           │
│    replyTo: &quot;reply-queue-A&quot;,                                           │
│    body: { ... }                                                       │
│  }                                                                      │
│                                                                         │
│  Reply: {                                                               │
│    correlationId: &quot;req-123&quot;,  // 요청과 응답 매칭                       │
│    body: { ... }                                                       │
│  }                                                                      │
│                                                                         │
└─────────────────────────────────────────────────────────────────────────┘
</code></pre></div>

<h3 id="dead-letter-queue-dlq">Dead Letter Queue (DLQ)<a class="header-link" href="#dead-letter-queue-dlq" title="Permanent link">&para;</a></h3>
<p>처리 실패한 메시지를 보관합니다.</p>
<div class="highlight"><pre><span></span><code>┌─────────────────────────────────────────────────────────────────────────┐
│                     Dead Letter Queue                                   │
├─────────────────────────────────────────────────────────────────────────┤
│                                                                         │
│                       ┌─────────────────┐                              │
│  ┌──────────┐        │   Main Queue    │         ┌──────────┐         │
│  │ Producer │───────►│ ┌───┬───┬───┐   │────────►│ Consumer │         │
│  └──────────┘        │ │ A │ B │ C │   │         └────┬─────┘         │
│                       │ └───┴───┴───┘   │              │                │
│                       └────────┬────────┘              │                │
│                                │                       │                │
│                                │ 처리 실패             │                │
│                                │ (재시도 초과)         │                │
│                                ▼                       ▼                │
│                       ┌─────────────────┐        실패! (B 메시지)      │
│                       │ Dead Letter Q   │              │                │
│                       │ ┌───┐           │◄─────────────┘                │
│                       │ │ B │           │                               │
│                       │ └───┘           │                               │
│                       └────────┬────────┘                               │
│                                │                                        │
│                                ▼                                        │
│                       수동 검토 / 재처리                                │
│                                                                         │
│  DLQ 활용:                                                              │
│  - 실패 원인 분석                                                       │
│  - 수동 재처리                                                          │
│  - 알림/모니터링                                                        │
│                                                                         │
└─────────────────────────────────────────────────────────────────────────┘
</code></pre></div>

<h3 id="priority-queue">Priority Queue<a class="header-link" href="#priority-queue" title="Permanent link">&para;</a></h3>
<p>우선순위에 따라 메시지를 처리합니다.</p>
<div class="highlight"><pre><span></span><code>┌─────────────────────────────────────────────────────────────────────────┐
│                     Priority Queue                                      │
├─────────────────────────────────────────────────────────────────────────┤
│                                                                         │
│  ┌──────────┐     ┌─────────────────────┐     ┌──────────┐            │
│  │ Producer │     │   Priority Queue    │     │ Consumer │            │
│  └────┬─────┘     │                     │     └────┬─────┘            │
│       │           │ High   ┌───┬───┐    │          │                  │
│       │──(P:High)─│───────►│ A │ D │    │──────────│                  │
│       │           │        └───┴───┘    │          │                  │
│       │──(P:Med)──│ Medium ┌───┬───┐    │          │                  │
│       │           │───────►│ B │   │    │          │                  │
│       │           │        └───┴───┘    │          │                  │
│       │──(P:Low)──│ Low    ┌───┬───┐    │          │                  │
│       │           │───────►│ C │ E │    │          │                  │
│       │           │        └───┴───┘    │          │                  │
│       │           └─────────────────────┘          │                  │
│       │                                            │                  │
│       │           처리 순서: A → D → B → C → E     │                  │
│                                                                         │
│  구현 방법:                                                             │
│  1. 우선순위별 별도 큐 + 가중치 폴링                                    │
│  2. 단일 큐 + 힙 정렬                                                   │
│  3. RabbitMQ: x-max-priority 설정                                      │
│                                                                         │
└─────────────────────────────────────────────────────────────────────────┘
</code></pre></div>

<hr />
<h2 id="7">7. 연습 문제<a class="header-link" href="#7" title="Permanent link">&para;</a></h2>
<h3 id="1">연습 1: 통신 방식 선택<a class="header-link" href="#1" title="Permanent link">&para;</a></h3>
<p>다음 시나리오에서 동기/비동기 중 적절한 방식을 선택하세요:</p>
<ol>
<li>사용자 로그인 인증</li>
<li>주문 후 확인 이메일 발송</li>
<li>결제 승인 요청</li>
<li>로그 수집</li>
<li>실시간 채팅 메시지</li>
</ol>
<h3 id="2_1">연습 2: 전달 보장 선택<a class="header-link" href="#2_1" title="Permanent link">&para;</a></h3>
<p>다음 사용 사례에 적합한 전달 보장 수준을 선택하세요:</p>
<ol>
<li>IoT 센서 온도 데이터</li>
<li>은행 송금 요청</li>
<li>뉴스 피드 업데이트</li>
<li>주문 생성 이벤트</li>
<li>게임 플레이어 위치 업데이트</li>
</ol>
<h3 id="3">연습 3: 멱등성 설계<a class="header-link" href="#3" title="Permanent link">&para;</a></h3>
<p>다음 연산을 멱등하게 만드는 방법을 설계하세요:</p>
<ol>
<li>계좌에서 100원 출금</li>
<li>상품 재고 1개 감소</li>
<li>이메일 발송</li>
<li>포인트 적립</li>
</ol>
<hr />
<h2 id="_8">다음 단계<a class="header-link" href="#_8" title="Permanent link">&para;</a></h2>
<p><a href="./12_Message_System_Comparison.md">12_Message_System_Comparison.md</a>에서 Kafka, RabbitMQ, AWS SQS/SNS 등 주요 메시지 시스템을 비교해봅시다!</p>
<hr />
<h2 id="_9">참고 자료<a class="header-link" href="#_9" title="Permanent link">&para;</a></h2>
<ul>
<li>"Enterprise Integration Patterns" - Gregor Hohpe, Bobby Woolf</li>
<li>RabbitMQ Official Documentation</li>
<li>Apache Kafka Documentation</li>
<li>AWS Messaging Services</li>
<li>"Designing Data-Intensive Applications" - Martin Kleppmann</li>
</ul>
    </div>

    
<div class="lesson-toolbar lesson-toolbar--bottom">
    <div class="toolbar-nav toolbar-nav--prev">
        
        <a href="/study/ko/System_Design/10_Data_Consistency_Patterns.html" class="nav-prev">
            <span class="nav-label">Previous</span>
            <span class="nav-title">데이터 일관성 패턴 (Data Consistency Patterns)</span>
        </a>
        
    </div>
    <div class="toolbar-actions">
        <button class="btn btn-copy-link" data-action="copy-link" title="Copy link">
            <span class="icon">🔗</span>
            <span class="text">Copy link</span>
        </button>
        <a href="/study/ko/System_Design/" class="btn btn-topic-link" title="Back to topic list">
            <span class="icon">📋</span>
            <span class="text">Topic list</span>
        </a>
    </div>
    <div class="toolbar-nav toolbar-nav--next">
        
        <a href="/study/ko/System_Design/12_Message_System_Comparison.html" class="nav-next">
            <span class="nav-label">Next</span>
            <span class="nav-title">메시지 시스템 비교 (Message Systems Comparison)</span>
        </a>
        
    </div>
</div>


    <div class="toolbar-keyboard-hint">
        <kbd>&larr;</kbd> <kbd>&rarr;</kbd> to navigate between lessons
    </div>
</article>

<!-- Scroll to top floating button -->
<button class="scroll-to-top" id="scroll-to-top" title="Scroll to top" aria-label="Scroll to top">↑</button>

            </div>
        </main>
    </div>

    <script src="/study/static/js/app.js"></script>
    <script>
        function switchLanguage(newLang) {
            const path = window.location.pathname;
            const base = '/study';
            const currentLang = 'ko';
            const newPath = path.replace(base + '/' + currentLang + '/', base + '/' + newLang + '/');
            window.location.href = newPath + window.location.search;
        }
    </script>
    
<script>
    document.addEventListener('DOMContentLoaded', function() {
        // Copy link - independent feedback per button
        document.querySelectorAll('[data-action="copy-link"]').forEach(function(btn) {
            btn.addEventListener('click', function() {
                navigator.clipboard.writeText(window.location.href);
                var textEl = this.querySelector('.text');
                var originalText = textEl.textContent;
                textEl.textContent = 'Copied!';
                setTimeout(function() { textEl.textContent = originalText; }, 2000);
            });
        });

        // Add copy buttons to code blocks
        document.querySelectorAll('.lesson-content pre').forEach(function(pre) {
            var copyBtn = document.createElement('button');
            copyBtn.className = 'code-copy-btn';
            copyBtn.textContent = 'Copy';
            copyBtn.addEventListener('click', function() {
                var code = pre.querySelector('code');
                var text = code ? code.textContent : pre.textContent;
                navigator.clipboard.writeText(text);
                copyBtn.textContent = 'Copied!';
                setTimeout(function() { copyBtn.textContent = 'Copy'; }, 2000);
            });
            pre.style.position = 'relative';
            pre.appendChild(copyBtn);
        });

        // Scroll to top button
        var scrollBtn = document.getElementById('scroll-to-top');
        window.addEventListener('scroll', function() {
            scrollBtn.classList.toggle('visible', window.scrollY > 300);
        });
        scrollBtn.addEventListener('click', function() {
            window.scrollTo({ top: 0, behavior: 'smooth' });
        });

        // Keyboard shortcuts: left/right arrows for lesson navigation
        document.addEventListener('keydown', function(e) {
            var tag = document.activeElement.tagName;
            if (tag === 'INPUT' || tag === 'TEXTAREA' || tag === 'SELECT') return;

            if (e.key === 'ArrowLeft') {
                var prevLink = document.querySelector('.nav-prev');
                if (prevLink) prevLink.click();
            } else if (e.key === 'ArrowRight') {
                var nextLink = document.querySelector('.nav-next');
                if (nextLink) nextLink.click();
            }
        });
    });
</script>

</body>
</html>
{% endraw %}