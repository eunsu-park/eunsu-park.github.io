{% raw %}
<!DOCTYPE html>
<html lang="ko" data-theme="light">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>분산 시스템 개념 (Distributed Systems Concepts) - Study Materials</title>
    <link rel="stylesheet" href="/study/static/css/style.css">
    <link rel="stylesheet" href="/study/static/css/highlight.css">
    <!-- KaTeX for LaTeX math rendering -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.16.11/dist/katex.min.css">
    <script defer src="https://cdn.jsdelivr.net/npm/katex@0.16.11/dist/katex.min.js"></script>
    <script defer src="https://cdn.jsdelivr.net/npm/katex@0.16.11/dist/contrib/auto-render.min.js"
        onload="renderMathInElement(document.body, {
            delimiters: [
                {left: '$$', right: '$$', display: true},
                {left: '$', right: '$', display: false}
            ],
            throwOnError: false
        });"></script>
    
</head>
<body>
    <div class="app-container">
        <!-- Sidebar -->
        <aside class="sidebar" id="sidebar">
            <div class="sidebar-header">
                <a href="/study/ko/" class="logo">Study Materials</a>
                <button class="sidebar-toggle" id="sidebar-toggle" aria-label="Toggle sidebar">
                    <span></span>
                </button>
            </div>

            <nav class="sidebar-nav">
                <a href="/study/ko/" class="nav-item ">
                    <span class="nav-icon">🏠</span>
                    <span class="nav-text">Home</span>
                </a>
                <a href="/study/examples/" class="nav-item ">
                    <span class="nav-icon">💻</span>
                    <span class="nav-text">Examples</span>
                </a>
            </nav>

            <div class="sidebar-search">
                <form action="/study/ko/search.html" method="get" id="search-form">
                    <input type="search" name="q" placeholder="Search..." id="search-sidebar-input">
                </form>
            </div>

            <!-- Language Selector -->
            <div class="sidebar-lang">
                <select id="lang-select" class="lang-selector" onchange="switchLanguage(this.value)">
                    
                    <option value="en" >
                        English
                    </option>
                    
                    <option value="ko" selected>
                        한국어
                    </option>
                    
                </select>
            </div>

            <div class="sidebar-footer">
                <button class="theme-toggle" id="theme-toggle" aria-label="Toggle theme">
                    <span class="theme-icon light">☀️</span>
                    <span class="theme-icon dark">🌙</span>
                </button>
            </div>
        </aside>

        <!-- Main Content -->
        <main class="main-content">
            <header class="main-header">
                <button class="menu-toggle" id="menu-toggle" aria-label="Open menu">
                    <span></span>
                </button>
                
<nav class="breadcrumb">
    <a href="/study/ko/">Topics</a>
    <span class="separator">/</span>
    <a href="/study/ko/System_Design/">System Design</a>
    <span class="separator">/</span>
    <span class="current">분산 시스템 개념 (Distributed Systems Concepts)</span>
</nav>

            </header>

            <div class="content">
                
<article class="lesson-article">
    <header class="lesson-header">
        <h1>분산 시스템 개념 (Distributed Systems Concepts)</h1>
    </header>

    
<div class="lesson-toolbar lesson-toolbar--top">
    <div class="toolbar-nav toolbar-nav--prev">
        
        <a href="/study/ko/System_Design/14_Microservices_Patterns.html" class="nav-prev">
            <span class="nav-label">Previous</span>
            <span class="nav-title">마이크로서비스 패턴 (Microservices Patterns)</span>
        </a>
        
    </div>
    <div class="toolbar-actions">
        <button class="btn btn-copy-link" data-action="copy-link" title="Copy link">
            <span class="icon">🔗</span>
            <span class="text">Copy link</span>
        </button>
        <a href="/study/ko/System_Design/" class="btn btn-topic-link" title="Back to topic list">
            <span class="icon">📋</span>
            <span class="text">Topic list</span>
        </a>
    </div>
    <div class="toolbar-nav toolbar-nav--next">
        
        <a href="/study/ko/System_Design/16_Consensus_Algorithms.html" class="nav-next">
            <span class="nav-label">Next</span>
            <span class="nav-title">합의 알고리즘 (Consensus Algorithms)</span>
        </a>
        
    </div>
</div>


    
    <nav class="toc" id="toc">
        <h2>Table of Contents</h2>
        <div class="toc">
<ul>
<li><a href="#_1">개요</a></li>
<li><a href="#_2">목차</a></li>
<li><a href="#1-8">1. 분산 시스템의 8가지 오류</a><ul>
<li><a href="#fallacies-of-distributed-computing">Fallacies of Distributed Computing</a></li>
</ul>
</li>
<li><a href="#2">2. 시간과 순서</a><ul>
<li><a href="#_3">물리 시계의 문제</a></li>
<li><a href="#happens-before">Happens-Before 관계</a></li>
</ul>
</li>
<li><a href="#3">3. 논리 시계</a><ul>
<li><a href="#lamport-clock">Lamport Clock</a></li>
<li><a href="#vector-clock">Vector Clock</a></li>
<li><a href="#_4">논리 시계 비교</a></li>
<li><a href="#_5">실제 사용 예</a></li>
</ul>
</li>
<li><a href="#4">4. 리더 선출</a><ul>
<li><a href="#_6">리더 선출이 필요한 이유</a></li>
<li><a href="#bully-algorithm">Bully Algorithm</a></li>
<li><a href="#ring-algorithm">Ring Algorithm</a></li>
<li><a href="#_7">현대적 리더 선출</a></li>
</ul>
</li>
<li><a href="#5">5. 분산 시스템의 도전 과제</a><ul>
<li><a href="#_8">네트워크 파티션</a></li>
<li><a href="#_9">부분 장애</a></li>
<li><a href="#byzantine-failure">Byzantine Failure</a></li>
</ul>
</li>
<li><a href="#6">6. 연습 문제</a><ul>
<li><a href="#1-lamport-clock">연습 1: Lamport Clock 계산</a></li>
<li><a href="#2-vector-clock">연습 2: Vector Clock 분석</a></li>
<li><a href="#3_1">연습 3: 리더 선출 설계</a></li>
</ul>
</li>
<li><a href="#_10">다음 단계</a></li>
<li><a href="#_11">참고 자료</a></li>
</ul>
</div>

    </nav>
    

    <div class="lesson-content markdown-body">
        <h1 id="distributed-systems-concepts">분산 시스템 개념 (Distributed Systems Concepts)<a class="header-link" href="#distributed-systems-concepts" title="Permanent link">&para;</a></h1>
<p>난이도: ⭐⭐⭐⭐</p>
<h2 id="_1">개요<a class="header-link" href="#_1" title="Permanent link">&para;</a></h2>
<p>분산 시스템은 네트워크로 연결된 여러 컴퓨터가 협력하여 하나의 시스템처럼 동작하는 것입니다. 이 장에서는 분산 시스템의 근본적인 도전과제, 시간 개념, 그리고 리더 선출 알고리즘에 대해 학습합니다.</p>
<hr />
<h2 id="_2">목차<a class="header-link" href="#_2" title="Permanent link">&para;</a></h2>
<ol>
<li><a href="#1-분산-시스템의-8가지-오류">분산 시스템의 8가지 오류</a></li>
<li><a href="#2-시간과-순서">시간과 순서</a></li>
<li><a href="#3-논리-시계">논리 시계</a></li>
<li><a href="#4-리더-선출">리더 선출</a></li>
<li><a href="#5-분산-시스템의-도전-과제">분산 시스템의 도전 과제</a></li>
<li><a href="#6-연습-문제">연습 문제</a></li>
</ol>
<hr />
<h2 id="1-8">1. 분산 시스템의 8가지 오류<a class="header-link" href="#1-8" title="Permanent link">&para;</a></h2>
<h3 id="fallacies-of-distributed-computing">Fallacies of Distributed Computing<a class="header-link" href="#fallacies-of-distributed-computing" title="Permanent link">&para;</a></h3>
<p>분산 시스템 초보자들이 흔히 하는 잘못된 가정들입니다.</p>
<div class="highlight"><pre><span></span><code>┌─────────────────────────────────────────────────────────────────────────┐
│              분산 컴퓨팅의 8가지 오류 (Fallacies)                       │
├─────────────────────────────────────────────────────────────────────────┤
│                                                                         │
│  1. 네트워크는 신뢰할 수 있다 (The network is reliable)                │
│  ┌─────────────────────────────────────────────────────────────────┐   │
│  │  실제:                                                           │   │
│  │  - 패킷 손실                                                     │   │
│  │  - 네트워크 파티션                                               │   │
│  │  - 스위치/라우터 장애                                            │   │
│  │                                                                  │   │
│  │  Node A ───X───► Node B                                         │   │
│  │         패킷 손실                                                │   │
│  │                                                                  │   │
│  │  대응: 재시도, 타임아웃, 멱등성                                  │   │
│  └─────────────────────────────────────────────────────────────────┘   │
│                                                                         │
│  2. 지연 시간은 0이다 (Latency is zero)                                │
│  ┌─────────────────────────────────────────────────────────────────┐   │
│  │  실제:                                                           │   │
│  │  - 로컬 호출: ~10 ns                                             │   │
│  │  - 같은 DC: 0.5 ms                                               │   │
│  │  - 대륙 간: 100+ ms                                              │   │
│  │                                                                  │   │
│  │  Seoul ──────────────────► US West                               │   │
│  │         ~150ms RTT                                               │   │
│  │                                                                  │   │
│  │  대응: 캐싱, 비동기 처리, 지역 분산                              │   │
│  └─────────────────────────────────────────────────────────────────┘   │
│                                                                         │
│  3. 대역폭은 무한하다 (Bandwidth is infinite)                          │
│  ┌─────────────────────────────────────────────────────────────────┐   │
│  │  실제:                                                           │   │
│  │  - 네트워크 혼잡                                                 │   │
│  │  - 대역폭 한계                                                   │   │
│  │  - 비용                                                          │   │
│  │                                                                  │   │
│  │  대응: 압축, 페이징, 데이터 지역성                               │   │
│  └─────────────────────────────────────────────────────────────────┘   │
│                                                                         │
│  4. 네트워크는 안전하다 (The network is secure)                        │
│  ┌─────────────────────────────────────────────────────────────────┐   │
│  │  실제:                                                           │   │
│  │  - 중간자 공격                                                   │   │
│  │  - 패킷 스니핑                                                   │   │
│  │  - 악의적 노드                                                   │   │
│  │                                                                  │   │
│  │  대응: TLS, 인증, 암호화                                         │   │
│  └─────────────────────────────────────────────────────────────────┘   │
│                                                                         │
└─────────────────────────────────────────────────────────────────────────┘
</code></pre></div>

<div class="highlight"><pre><span></span><code>┌─────────────────────────────────────────────────────────────────────────┐
│              분산 컴퓨팅의 8가지 오류 (계속)                            │
├─────────────────────────────────────────────────────────────────────────┤
│                                                                         │
│  5. 토폴로지는 변하지 않는다 (Topology doesn&#39;t change)                 │
│  ┌─────────────────────────────────────────────────────────────────┐   │
│  │  실제:                                                           │   │
│  │  - 서버 추가/제거                                                │   │
│  │  - 장애 복구                                                     │   │
│  │  - 스케일링                                                      │   │
│  │                                                                  │   │
│  │  대응: 서비스 디스커버리, 동적 구성                              │   │
│  └─────────────────────────────────────────────────────────────────┘   │
│                                                                         │
│  6. 관리자는 한 명이다 (There is one administrator)                    │
│  ┌─────────────────────────────────────────────────────────────────┐   │
│  │  실제:                                                           │   │
│  │  - 여러 팀, 여러 조직                                            │   │
│  │  - 서로 다른 정책                                                │   │
│  │  - 클라우드 + 온프레미스                                         │   │
│  │                                                                  │   │
│  │  대응: 표준화, 자동화, 거버넌스                                  │   │
│  └─────────────────────────────────────────────────────────────────┘   │
│                                                                         │
│  7. 전송 비용은 0이다 (Transport cost is zero)                         │
│  ┌─────────────────────────────────────────────────────────────────┐   │
│  │  실제:                                                           │   │
│  │  - 클라우드 이그레스 비용                                        │   │
│  │  - 직렬화/역직렬화 오버헤드                                      │   │
│  │  - 네트워크 장비 비용                                            │   │
│  │                                                                  │   │
│  │  대응: 데이터 지역성, 효율적인 프로토콜                          │   │
│  └─────────────────────────────────────────────────────────────────┘   │
│                                                                         │
│  8. 네트워크는 균질적이다 (The network is homogeneous)                 │
│  ┌─────────────────────────────────────────────────────────────────┐   │
│  │  실제:                                                           │   │
│  │  - 다양한 하드웨어                                               │   │
│  │  - 다양한 프로토콜                                               │   │
│  │  - 레거시 시스템                                                 │   │
│  │                                                                  │   │
│  │  대응: 표준 프로토콜, 추상화 계층                                │   │
│  └─────────────────────────────────────────────────────────────────┘   │
│                                                                         │
└─────────────────────────────────────────────────────────────────────────┘
</code></pre></div>

<hr />
<h2 id="2">2. 시간과 순서<a class="header-link" href="#2" title="Permanent link">&para;</a></h2>
<h3 id="_3">물리 시계의 문제<a class="header-link" href="#_3" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code>┌─────────────────────────────────────────────────────────────────────────┐
│                     물리 시계 (Physical Clocks)                         │
├─────────────────────────────────────────────────────────────────────────┤
│                                                                         │
│  문제 1: 시계 드리프트 (Clock Drift)                                   │
│  ┌─────────────────────────────────────────────────────────────────┐   │
│  │                                                                  │   │
│  │  시간 ─────────────────────────────────────────────────────►     │   │
│  │                                                                  │   │
│  │  실제 시간: ═════════════════════════════════════════════════   │   │
│  │                                                                  │   │
│  │  Node A:    ════════════════════════════════════════════════     │   │
│  │              (약간 빠름)                                         │   │
│  │                                                                  │   │
│  │  Node B:    ════════════════════════════════════════════════     │   │
│  │              (약간 느림)                                         │   │
│  │                                                                  │   │
│  │  일반적인 드리프트: 초당 10-100 마이크로초                       │   │
│  │  → 하루에 수 초 차이 발생!                                       │   │
│  └─────────────────────────────────────────────────────────────────┘   │
│                                                                         │
│  문제 2: NTP 동기화의 한계                                              │
│  ┌─────────────────────────────────────────────────────────────────┐   │
│  │  - 일반적 정확도: 수십 밀리초                                    │   │
│  │  - 인터넷 환경: 100ms 이상 오차 가능                             │   │
│  │  - 시간 점프 발생 가능 (앞/뒤로)                                 │   │
│  │                                                                  │   │
│  │  NTP Server ───────────► Node                                   │   │
│  │              네트워크 지연                                       │   │
│  │              으로 인한 오차                                      │   │
│  └─────────────────────────────────────────────────────────────────┘   │
│                                                                         │
│  문제 3: 타임스탬프 기반 순서화의 위험                                  │
│  ┌─────────────────────────────────────────────────────────────────┐   │
│  │                                                                  │   │
│  │  Node A (시계 빠름):  Write X=1 at T=100                         │   │
│  │  Node B (시계 느림):  Write X=2 at T=99                          │   │
│  │                                                                  │   │
│  │  타임스탬프로 정렬: X=2 (T=99) → X=1 (T=100)                     │   │
│  │  실제 발생 순서: X=1 먼저 → X=2 나중                             │   │
│  │                                                                  │   │
│  │  → 잘못된 순서! 데이터 손실 가능!                                │   │
│  └─────────────────────────────────────────────────────────────────┘   │
│                                                                         │
└─────────────────────────────────────────────────────────────────────────┘
</code></pre></div>

<h3 id="happens-before">Happens-Before 관계<a class="header-link" href="#happens-before" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code>┌─────────────────────────────────────────────────────────────────────────┐
│                     Happens-Before 관계                                 │
├─────────────────────────────────────────────────────────────────────────┤
│                                                                         │
│  정의: a → b (a happens-before b)                                      │
│                                                                         │
│  1. 같은 프로세스에서 a가 b 이전에 발생                                 │
│  2. a가 메시지 전송, b가 해당 메시지 수신                               │
│  3. 전이성: a → b ∧ b → c ⟹ a → c                                      │
│                                                                         │
│  ┌─────────────────────────────────────────────────────────────────┐   │
│  │                                                                  │   │
│  │  Process P1:  ─────●a─────────────●c──────────────────────►      │   │
│  │                    │              ▲                              │   │
│  │                    │              │                              │   │
│  │                    ▼ (메시지)     │ (메시지)                     │   │
│  │                    │              │                              │   │
│  │  Process P2:  ─────────●b─────────●d──────────────────────►      │   │
│  │                                                                  │   │
│  │  관계:                                                           │   │
│  │  - a → b (메시지 전송)                                           │   │
│  │  - b → d (같은 프로세스)                                         │   │
│  │  - a → c (같은 프로세스)                                         │   │
│  │  - d → c (메시지 전송)                                           │   │
│  │  - a → d (전이성: a → b → d)                                     │   │
│  │                                                                  │   │
│  └─────────────────────────────────────────────────────────────────┘   │
│                                                                         │
│  동시성 (Concurrent):                                                   │
│  a → b도 아니고 b → a도 아닌 경우, a와 b는 동시(concurrent)            │
│  a ∥ b로 표기                                                          │
│                                                                         │
│  ┌─────────────────────────────────────────────────────────────────┐   │
│  │  P1:  ─────●a─────────────────────────────────────────►          │   │
│  │                                                                  │   │
│  │  P2:  ─────────────●b─────────────────────────────────►          │   │
│  │                                                                  │   │
│  │  a와 b는 인과관계 없음 → 순서 정의 불가 → 동시 (a ∥ b)           │   │
│  └─────────────────────────────────────────────────────────────────┘   │
│                                                                         │
└─────────────────────────────────────────────────────────────────────────┘
</code></pre></div>

<hr />
<h2 id="3">3. 논리 시계<a class="header-link" href="#3" title="Permanent link">&para;</a></h2>
<h3 id="lamport-clock">Lamport Clock<a class="header-link" href="#lamport-clock" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code>┌─────────────────────────────────────────────────────────────────────────┐
│                     Lamport Clock                                       │
├─────────────────────────────────────────────────────────────────────────┤
│                                                                         │
│  규칙:                                                                  │
│  1. 각 프로세스는 카운터 C를 유지                                       │
│  2. 이벤트 발생 시: C = C + 1                                          │
│  3. 메시지 전송 시: 메시지에 현재 C 포함                                │
│  4. 메시지 수신 시: C = max(C, msg.C) + 1                              │
│                                                                         │
│  ┌─────────────────────────────────────────────────────────────────┐   │
│  │                                                                  │   │
│  │  Process A:  ─●───────●───────────────●───────────────►          │   │
│  │  (C)          1       2               5                          │   │
│  │                       │               ▲                          │   │
│  │                       │ msg(C=2)      │ msg(C=4)                 │   │
│  │                       ▼               │                          │   │
│  │  Process B:  ─────────●───────●───────●───────────────►          │   │
│  │  (C)                  3       4       5                          │   │
│  │                               ▲                                  │   │
│  │                               │                                  │   │
│  │  B receives msg from A:      max(2, 2) + 1 = 3                  │   │
│  │  B local event:              3 + 1 = 4                          │   │
│  │  B sends msg to A:           4 (in message)                     │   │
│  │  A receives msg from B:      max(2, 4) + 1 = 5                  │   │
│  │                                                                  │   │
│  └─────────────────────────────────────────────────────────────────┘   │
│                                                                         │
│  특성:                                                                  │
│  ✓ a → b ⟹ C(a) &lt; C(b)    (인과관계면 시계도 순서 맞음)              │
│  ✗ C(a) &lt; C(b) ⟹ a → b    (역은 성립 안함!)                          │
│                                                                         │
│  한계:                                                                  │
│  - 동시 이벤트 구분 불가                                                │
│  - 같은 카운터 값 가능                                                  │
│                                                                         │
└─────────────────────────────────────────────────────────────────────────┘
</code></pre></div>

<h3 id="vector-clock">Vector Clock<a class="header-link" href="#vector-clock" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><span class="err">┌─────────────────────────────────────────────────────────────────────────┐</span>
<span class="err">│</span><span class="w">                     </span><span class="n">Vector</span><span class="w"> </span><span class="n">Clock</span><span class="w">                                        </span><span class="err">│</span>
<span class="err">├─────────────────────────────────────────────────────────────────────────┤</span>
<span class="err">│</span><span class="w">                                                                         </span><span class="err">│</span>
<span class="err">│</span><span class="w">  </span><span class="nl">규칙</span><span class="p">:</span><span class="w">                                                                  </span><span class="err">│</span>
<span class="err">│</span><span class="w">  </span><span class="o">-</span><span class="w"> </span><span class="n">각</span><span class="w"> </span><span class="n">프로세스</span><span class="w"> </span><span class="n">i는</span><span class="w"> </span><span class="n">벡터</span><span class="w"> </span><span class="n">V</span><span class="o">[</span><span class="n">1..N</span><span class="o">]</span><span class="w"> </span><span class="n">유지</span><span class="w"> </span><span class="p">(</span><span class="n">N</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">프로세스</span><span class="w"> </span><span class="n">수</span><span class="p">)</span><span class="w">                 </span><span class="err">│</span>
<span class="err">│</span><span class="w">  </span><span class="o">-</span><span class="w"> </span><span class="n">이벤트</span><span class="w"> </span><span class="n">발생</span><span class="w"> </span><span class="nl">시</span><span class="p">:</span><span class="w"> </span><span class="n">V</span><span class="o">[</span><span class="n">i</span><span class="o">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">V</span><span class="o">[</span><span class="n">i</span><span class="o">]</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span><span class="w">                                     </span><span class="err">│</span>
<span class="err">│</span><span class="w">  </span><span class="o">-</span><span class="w"> </span><span class="n">메시지</span><span class="w"> </span><span class="n">전송</span><span class="w"> </span><span class="nl">시</span><span class="p">:</span><span class="w"> </span><span class="n">전체</span><span class="w"> </span><span class="n">벡터</span><span class="w"> </span><span class="n">V</span><span class="w"> </span><span class="n">포함</span><span class="w">                                     </span><span class="err">│</span>
<span class="err">│</span><span class="w">  </span><span class="o">-</span><span class="w"> </span><span class="n">메시지</span><span class="w"> </span><span class="n">수신</span><span class="w"> </span><span class="nl">시</span><span class="p">:</span><span class="w"> </span><span class="n">V</span><span class="o">[</span><span class="n">j</span><span class="o">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">max</span><span class="p">(</span><span class="n">V</span><span class="o">[</span><span class="n">j</span><span class="o">]</span><span class="p">,</span><span class="w"> </span><span class="n">msg</span><span class="p">.</span><span class="n">V</span><span class="o">[</span><span class="n">j</span><span class="o">]</span><span class="p">)</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="ow">all</span><span class="w"> </span><span class="n">j</span><span class="p">,</span><span class="w"> </span><span class="n">V</span><span class="o">[</span><span class="n">i</span><span class="o">]++</span><span class="w">        </span><span class="err">│</span>
<span class="err">│</span><span class="w">                                                                         </span><span class="err">│</span>
<span class="err">│</span><span class="w">  </span><span class="err">┌─────────────────────────────────────────────────────────────────┐</span><span class="w">   </span><span class="err">│</span>
<span class="err">│</span><span class="w">  </span><span class="err">│</span><span class="w">                                                                  </span><span class="err">│</span><span class="w">   </span><span class="err">│</span>
<span class="err">│</span><span class="w">  </span><span class="err">│</span><span class="w">  </span><span class="n">Process</span><span class="w"> </span><span class="nl">A</span><span class="p">:</span><span class="w">  </span><span class="err">─●─────────●─────────────────●───────────►</span><span class="w">          </span><span class="err">│</span><span class="w">   </span><span class="err">│</span>
<span class="err">│</span><span class="w">  </span><span class="err">│</span><span class="w">  </span><span class="n">V</span><span class="w">           </span><span class="o">[</span><span class="n">1,0,0</span><span class="o">]</span><span class="w">  </span><span class="o">[</span><span class="n">2,0,0</span><span class="o">]</span><span class="w">           </span><span class="o">[</span><span class="n">3,2,1</span><span class="o">]</span><span class="w">                 </span><span class="err">│</span><span class="w">   </span><span class="err">│</span>
<span class="err">│</span><span class="w">  </span><span class="err">│</span><span class="w">                        </span><span class="err">│</span><span class="w">                   </span><span class="err">▲</span><span class="w">                     </span><span class="err">│</span><span class="w">   </span><span class="err">│</span>
<span class="err">│</span><span class="w">  </span><span class="err">│</span><span class="w">                        </span><span class="err">│</span><span class="w">                   </span><span class="err">│</span><span class="w"> </span><span class="n">msg</span><span class="w"> </span><span class="o">[</span><span class="n">2,2,1</span><span class="o">]</span><span class="w">         </span><span class="err">│</span><span class="w">   </span><span class="err">│</span>
<span class="err">│</span><span class="w">  </span><span class="err">│</span><span class="w">                        </span><span class="err">▼</span><span class="w">                   </span><span class="err">│</span><span class="w">                     </span><span class="err">│</span><span class="w">   </span><span class="err">│</span>
<span class="err">│</span><span class="w">  </span><span class="err">│</span><span class="w">  </span><span class="n">Process</span><span class="w"> </span><span class="nl">B</span><span class="p">:</span><span class="w">  </span><span class="err">─────────●─────────●─────────●───────────►</span><span class="w">          </span><span class="err">│</span><span class="w">   </span><span class="err">│</span>
<span class="err">│</span><span class="w">  </span><span class="err">│</span><span class="w">  </span><span class="n">V</span><span class="w">                  </span><span class="o">[</span><span class="n">2,1,0</span><span class="o">]</span><span class="w">   </span><span class="o">[</span><span class="n">2,2,0</span><span class="o">]</span><span class="w">   </span><span class="o">[</span><span class="n">2,2,1</span><span class="o">]</span><span class="w">                  </span><span class="err">│</span><span class="w">   </span><span class="err">│</span>
<span class="err">│</span><span class="w">  </span><span class="err">│</span><span class="w">                        </span><span class="err">▲</span><span class="w">         </span><span class="err">│</span><span class="w">                               </span><span class="err">│</span><span class="w">   </span><span class="err">│</span>
<span class="err">│</span><span class="w">  </span><span class="err">│</span><span class="w">                        </span><span class="err">│</span><span class="w">         </span><span class="err">│</span><span class="w"> </span><span class="n">msg</span><span class="w"> </span><span class="o">[</span><span class="n">2,2,0</span><span class="o">]</span><span class="w">                   </span><span class="err">│</span><span class="w">   </span><span class="err">│</span>
<span class="err">│</span><span class="w">  </span><span class="err">│</span><span class="w">                        </span><span class="err">│</span><span class="w">         </span><span class="err">▼</span><span class="w">                               </span><span class="err">│</span><span class="w">   </span><span class="err">│</span>
<span class="err">│</span><span class="w">  </span><span class="err">│</span><span class="w">  </span><span class="n">Process</span><span class="w"> </span><span class="nl">C</span><span class="p">:</span><span class="w">  </span><span class="err">─────────●─────────●─────────────────────►</span><span class="w">          </span><span class="err">│</span><span class="w">   </span><span class="err">│</span>
<span class="err">│</span><span class="w">  </span><span class="err">│</span><span class="w">  </span><span class="n">V</span><span class="w">                  </span><span class="o">[</span><span class="n">0,0,1</span><span class="o">]</span><span class="w">   </span><span class="o">[</span><span class="n">2,2,1</span><span class="o">]</span><span class="w">                           </span><span class="err">│</span><span class="w">   </span><span class="err">│</span>
<span class="err">│</span><span class="w">  </span><span class="err">│</span><span class="w">                                                                  </span><span class="err">│</span><span class="w">   </span><span class="err">│</span>
<span class="err">│</span><span class="w">  </span><span class="err">└─────────────────────────────────────────────────────────────────┘</span><span class="w">   </span><span class="err">│</span>
<span class="err">│</span><span class="w">                                                                         </span><span class="err">│</span>
<span class="err">│</span><span class="w">  </span><span class="n">비교</span><span class="w"> </span><span class="nl">규칙</span><span class="p">:</span><span class="w">                                                             </span><span class="err">│</span>
<span class="err">│</span><span class="w">  </span><span class="o">-</span><span class="w"> </span><span class="n">V1</span><span class="w"> </span><span class="err">≤</span><span class="w"> </span><span class="nl">V2</span><span class="p">:</span><span class="w"> </span><span class="n">V1</span><span class="o">[</span><span class="n">i</span><span class="o">]</span><span class="w"> </span><span class="err">≤</span><span class="w"> </span><span class="n">V2</span><span class="o">[</span><span class="n">i</span><span class="o">]</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="ow">all</span><span class="w"> </span><span class="n">i</span><span class="w">                                   </span><span class="err">│</span>
<span class="err">│</span><span class="w">  </span><span class="o">-</span><span class="w"> </span><span class="n">V1</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="nl">V2</span><span class="p">:</span><span class="w"> </span><span class="n">V1</span><span class="w"> </span><span class="err">≤</span><span class="w"> </span><span class="n">V2</span><span class="w"> </span><span class="ow">and</span><span class="w"> </span><span class="n">V1</span><span class="w"> </span><span class="err">≠</span><span class="w"> </span><span class="n">V2</span><span class="w">                                       </span><span class="err">│</span>
<span class="err">│</span><span class="w">  </span><span class="o">-</span><span class="w"> </span><span class="n">V1</span><span class="w"> </span><span class="err">∥</span><span class="w"> </span><span class="nl">V2</span><span class="p">:</span><span class="w"> </span><span class="n">neither</span><span class="w"> </span><span class="n">V1</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="n">V2</span><span class="w"> </span><span class="n">nor</span><span class="w"> </span><span class="n">V2</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="n">V1</span><span class="w"> </span><span class="p">(</span><span class="n">동시</span><span class="p">)</span><span class="w">                        </span><span class="err">│</span>
<span class="err">│</span><span class="w">                                                                         </span><span class="err">│</span>
<span class="err">│</span><span class="w">  </span><span class="nl">예시</span><span class="p">:</span><span class="w">                                                                  </span><span class="err">│</span>
<span class="err">│</span><span class="w">  </span><span class="o">[</span><span class="n">2,0,0</span><span class="o">]</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="o">[</span><span class="n">2,2,0</span><span class="o">]</span><span class="w">  </span><span class="err">✓</span><span class="w"> </span><span class="p">(</span><span class="n">happens</span><span class="o">-</span><span class="k">before</span><span class="p">)</span><span class="w">                                </span><span class="err">│</span>
<span class="err">│</span><span class="w">  </span><span class="o">[</span><span class="n">2,1,0</span><span class="o">]</span><span class="w"> </span><span class="err">∥</span><span class="w"> </span><span class="o">[</span><span class="n">0,0,1</span><span class="o">]</span><span class="w">  </span><span class="err">✓</span><span class="w"> </span><span class="p">(</span><span class="n">concurrent</span><span class="p">)</span><span class="w">                                    </span><span class="err">│</span>
<span class="err">│</span><span class="w">                                                                         </span><span class="err">│</span>
<span class="err">│</span><span class="w">  </span><span class="nl">장점</span><span class="p">:</span><span class="w"> </span><span class="n">동시</span><span class="w"> </span><span class="n">이벤트</span><span class="w"> </span><span class="n">감지</span><span class="w"> </span><span class="n">가능</span><span class="w">                                            </span><span class="err">│</span>
<span class="err">│</span><span class="w">  </span><span class="nl">단점</span><span class="p">:</span><span class="w"> </span><span class="n">벡터</span><span class="w"> </span><span class="n">크기</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">프로세스</span><span class="w"> </span><span class="n">수</span><span class="w"> </span><span class="p">(</span><span class="n">확장성</span><span class="w"> </span><span class="n">문제</span><span class="p">)</span><span class="w">                            </span><span class="err">│</span>
<span class="err">│</span><span class="w">                                                                         </span><span class="err">│</span>
<span class="err">└─────────────────────────────────────────────────────────────────────────┘</span>
</code></pre></div>

<h3 id="_4">논리 시계 비교<a class="header-link" href="#_4" title="Permanent link">&para;</a></h3>
<table>
<thead>
<tr>
<th>특성</th>
<th>Lamport Clock</th>
<th>Vector Clock</th>
</tr>
</thead>
<tbody>
<tr>
<td>크기</td>
<td>정수 1개</td>
<td>N개 정수</td>
</tr>
<tr>
<td>인과관계 감지</td>
<td>부분적</td>
<td>완전</td>
</tr>
<tr>
<td>동시성 감지</td>
<td>불가</td>
<td>가능</td>
</tr>
<tr>
<td>확장성</td>
<td>우수</td>
<td>제한적</td>
</tr>
<tr>
<td>구현 복잡도</td>
<td>간단</td>
<td>중간</td>
</tr>
</tbody>
</table>
<h3 id="_5">실제 사용 예<a class="header-link" href="#_5" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><span class="err">┌─────────────────────────────────────────────────────────────────────────┐</span>
<span class="err">│</span><span class="w">                     </span><span class="n">Vector</span><span class="w"> </span><span class="n">Clock</span><span class="w"> </span><span class="n">활용</span><span class="w"> </span><span class="nl">예</span><span class="p">:</span><span class="w"> </span><span class="n">DynamoDB</span><span class="w">                      </span><span class="err">│</span>
<span class="err">├─────────────────────────────────────────────────────────────────────────┤</span>
<span class="err">│</span><span class="w">                                                                         </span><span class="err">│</span>
<span class="err">│</span><span class="w">  </span><span class="n">충돌</span><span class="w"> </span><span class="n">감지</span><span class="w"> </span><span class="n">및</span><span class="w"> </span><span class="nl">해결</span><span class="p">:</span><span class="w">                                                     </span><span class="err">│</span>
<span class="err">│</span><span class="w">                                                                         </span><span class="err">│</span>
<span class="err">│</span><span class="w">  </span><span class="err">┌─────────────────────────────────────────────────────────────────┐</span><span class="w">   </span><span class="err">│</span>
<span class="err">│</span><span class="w">  </span><span class="err">│</span><span class="w">                                                                  </span><span class="err">│</span><span class="w">   </span><span class="err">│</span>
<span class="err">│</span><span class="w">  </span><span class="err">│</span><span class="w">  </span><span class="n">초기</span><span class="w"> </span><span class="nl">상태</span><span class="p">:</span><span class="w"> </span><span class="n">X</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ss">&quot;A&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">V</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">[</span><span class="n">1,0</span><span class="o">]</span><span class="w">                                   </span><span class="err">│</span><span class="w">   </span><span class="err">│</span>
<span class="err">│</span><span class="w">  </span><span class="err">│</span><span class="w">                                                                  </span><span class="err">│</span><span class="w">   </span><span class="err">│</span>
<span class="err">│</span><span class="w">  </span><span class="err">│</span><span class="w">  </span><span class="n">Replica</span><span class="w"> </span><span class="mi">1</span><span class="err">:</span><span class="w">  </span><span class="k">Write</span><span class="w"> </span><span class="n">X</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ss">&quot;B&quot;</span><span class="w">  </span><span class="err">→</span><span class="w">  </span><span class="n">V</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">[</span><span class="n">2,0</span><span class="o">]</span><span class="w">                        </span><span class="err">│</span><span class="w">   </span><span class="err">│</span>
<span class="err">│</span><span class="w">  </span><span class="err">│</span><span class="w">  </span><span class="n">Replica</span><span class="w"> </span><span class="mi">2</span><span class="err">:</span><span class="w">  </span><span class="k">Write</span><span class="w"> </span><span class="n">X</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ss">&quot;C&quot;</span><span class="w">  </span><span class="err">→</span><span class="w">  </span><span class="n">V</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">[</span><span class="n">1,1</span><span class="o">]</span><span class="w">                        </span><span class="err">│</span><span class="w">   </span><span class="err">│</span>
<span class="err">│</span><span class="w">  </span><span class="err">│</span><span class="w">                                                                  </span><span class="err">│</span><span class="w">   </span><span class="err">│</span>
<span class="err">│</span><span class="w">  </span><span class="err">│</span><span class="w">  </span><span class="n">동기화</span><span class="w"> </span><span class="nl">시점</span><span class="p">:</span><span class="w">                                                    </span><span class="err">│</span><span class="w">   </span><span class="err">│</span>
<span class="err">│</span><span class="w">  </span><span class="err">│</span><span class="w">  </span><span class="o">[</span><span class="n">2,0</span><span class="o">]</span><span class="w"> </span><span class="err">∥</span><span class="w"> </span><span class="o">[</span><span class="n">1,1</span><span class="o">]</span><span class="w">  </span><span class="p">(</span><span class="n">동시</span><span class="w"> </span><span class="n">쓰기</span><span class="err">!</span><span class="p">)</span><span class="w">                                    </span><span class="err">│</span><span class="w">   </span><span class="err">│</span>
<span class="err">│</span><span class="w">  </span><span class="err">│</span><span class="w">                                                                  </span><span class="err">│</span><span class="w">   </span><span class="err">│</span>
<span class="err">│</span><span class="w">  </span><span class="err">│</span><span class="w">  </span><span class="n">해결</span><span class="w"> </span><span class="nl">방법</span><span class="p">:</span><span class="w">                                                      </span><span class="err">│</span><span class="w">   </span><span class="err">│</span>
<span class="err">│</span><span class="w">  </span><span class="err">│</span><span class="w">  </span><span class="mf">1.</span><span class="w"> </span><span class="k">Last</span><span class="o">-</span><span class="k">Write</span><span class="o">-</span><span class="n">Wins</span><span class="w"> </span><span class="p">(</span><span class="n">타임스탬프</span><span class="p">)</span><span class="w">                                </span><span class="err">│</span><span class="w">   </span><span class="err">│</span>
<span class="err">│</span><span class="w">  </span><span class="err">│</span><span class="w">  </span><span class="mf">2.</span><span class="w"> </span><span class="n">클라이언트에게</span><span class="w"> </span><span class="n">반환하여</span><span class="w"> </span><span class="n">해결하게</span><span class="w"> </span><span class="n">함</span><span class="w">                          </span><span class="err">│</span><span class="w">   </span><span class="err">│</span>
<span class="err">│</span><span class="w">  </span><span class="err">│</span><span class="w">  </span><span class="mf">3.</span><span class="w"> </span><span class="n">애플리케이션</span><span class="w"> </span><span class="n">정의</span><span class="w"> </span><span class="n">병합</span><span class="w">                                       </span><span class="err">│</span><span class="w">   </span><span class="err">│</span>
<span class="err">│</span><span class="w">  </span><span class="err">│</span><span class="w">                                                                  </span><span class="err">│</span><span class="w">   </span><span class="err">│</span>
<span class="err">│</span><span class="w">  </span><span class="err">└─────────────────────────────────────────────────────────────────┘</span><span class="w">   </span><span class="err">│</span>
<span class="err">│</span><span class="w">                                                                         </span><span class="err">│</span>
<span class="err">│</span><span class="w">  </span><span class="nl">예</span><span class="p">:</span><span class="w"> </span><span class="n">장바구니</span><span class="w"> </span><span class="n">병합</span><span class="w">                                                      </span><span class="err">│</span>
<span class="err">│</span><span class="w">  </span><span class="err">┌─────────────────────────────────────────────────────────────────┐</span><span class="w">   </span><span class="err">│</span>
<span class="err">│</span><span class="w">  </span><span class="err">│</span><span class="w">  </span><span class="n">Client</span><span class="w"> </span><span class="k">reads</span><span class="err">:</span><span class="w"> </span><span class="o">[</span><span class="n">item1</span><span class="o">]</span><span class="p">,</span><span class="w"> </span><span class="o">[</span><span class="n">item2</span><span class="o">]</span><span class="w">  </span><span class="p">(</span><span class="n">두</span><span class="w"> </span><span class="n">버전</span><span class="p">)</span><span class="w">                      </span><span class="err">│</span><span class="w">   </span><span class="err">│</span>
<span class="err">│</span><span class="w">  </span><span class="err">│</span><span class="w">  </span><span class="n">Client</span><span class="w"> </span><span class="nl">merges</span><span class="p">:</span><span class="w"> </span><span class="o">[</span><span class="n">item1, item2</span><span class="o">]</span><span class="w">                                  </span><span class="err">│</span><span class="w">   </span><span class="err">│</span>
<span class="err">│</span><span class="w">  </span><span class="err">│</span><span class="w">  </span><span class="n">Client</span><span class="w"> </span><span class="nl">writes</span><span class="p">:</span><span class="w"> </span><span class="n">병합된</span><span class="w"> </span><span class="n">결과</span><span class="w">                                     </span><span class="err">│</span><span class="w">   </span><span class="err">│</span>
<span class="err">│</span><span class="w">  </span><span class="err">└─────────────────────────────────────────────────────────────────┘</span><span class="w">   </span><span class="err">│</span>
<span class="err">│</span><span class="w">                                                                         </span><span class="err">│</span>
<span class="err">└─────────────────────────────────────────────────────────────────────────┘</span>
</code></pre></div>

<hr />
<h2 id="4">4. 리더 선출<a class="header-link" href="#4" title="Permanent link">&para;</a></h2>
<h3 id="_6">리더 선출이 필요한 이유<a class="header-link" href="#_6" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code>┌─────────────────────────────────────────────────────────────────────────┐
│                     리더 선출 (Leader Election)                         │
├─────────────────────────────────────────────────────────────────────────┤
│                                                                         │
│  왜 필요한가?                                                           │
│  ┌─────────────────────────────────────────────────────────────────┐   │
│  │  분산 시스템에서 조정자(coordinator) 역할이 필요한 경우:         │   │
│  │                                                                  │   │
│  │  - 분산 락 관리                                                  │   │
│  │  - 합의 알고리즘에서 제안자                                      │   │
│  │  - 데이터베이스 Primary 노드                                     │   │
│  │  - 분산 작업 스케줄링                                            │   │
│  │  - 메시지 순서 결정                                              │   │
│  │                                                                  │   │
│  │  ┌─────────┐  ┌─────────┐  ┌─────────┐                          │   │
│  │  │ Node 1  │  │ Node 2  │  │ Node 3  │                          │   │
│  │  │(Leader) │  │(Follower│  │(Follower│                          │   │
│  │  │    ★    │  │         │  │         │                          │   │
│  │  └────┬────┘  └────┬────┘  └────┬────┘                          │   │
│  │       │            │            │                                │   │
│  │       └────────────┼────────────┘                                │   │
│  │                    │                                             │   │
│  │               조정/동기화                                        │   │
│  └─────────────────────────────────────────────────────────────────┘   │
│                                                                         │
│  요구사항:                                                              │
│  1. Safety: 동시에 최대 1명의 리더                                      │
│  2. Liveness: 결국 리더가 선출됨                                        │
│                                                                         │
└─────────────────────────────────────────────────────────────────────────┘
</code></pre></div>

<h3 id="bully-algorithm">Bully Algorithm<a class="header-link" href="#bully-algorithm" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code>┌─────────────────────────────────────────────────────────────────────────┐
│                     Bully 알고리즘                                      │
├─────────────────────────────────────────────────────────────────────────┤
│                                                                         │
│  규칙: 가장 높은 ID를 가진 노드가 리더                                  │
│                                                                         │
│  ┌─────────────────────────────────────────────────────────────────┐   │
│  │                                                                  │   │
│  │  초기 상태: Node 5가 리더                                        │   │
│  │                                                                  │   │
│  │  Node 1   Node 2   Node 3   Node 4   Node 5 (Leader)            │   │
│  │    │        │        │        │         ✗ (장애)               │   │
│  │    │        │        │        │                                  │   │
│  │                                                                  │   │
│  │  Step 1: Node 2가 리더 장애 감지                                 │   │
│  │  ─────────────────────────────                                   │   │
│  │  Node 2 → &quot;ELECTION&quot; → Node 3, 4, 5                             │   │
│  │                                                                  │   │
│  │  Step 2: 더 높은 ID가 응답                                       │   │
│  │  ─────────────────────────────                                   │   │
│  │  Node 3 → &quot;OK&quot; → Node 2  (나보다 높은 ID 있음)                  │   │
│  │  Node 4 → &quot;OK&quot; → Node 2                                         │   │
│  │  Node 5 → (무응답)                                              │   │
│  │                                                                  │   │
│  │  Step 3: Node 3, 4도 선거 시작                                   │   │
│  │  ─────────────────────────────                                   │   │
│  │  Node 3 → &quot;ELECTION&quot; → Node 4, 5                                │   │
│  │  Node 4 → &quot;ELECTION&quot; → Node 5                                   │   │
│  │                                                                  │   │
│  │  Step 4: Node 4가 최종 승자                                      │   │
│  │  ─────────────────────────────                                   │   │
│  │  Node 4 → &quot;COORDINATOR&quot; → All                                   │   │
│  │                                                                  │   │
│  │  Node 1   Node 2   Node 3   Node 4 (Leader)   Node 5            │   │
│  │                               ★                  ✗              │   │
│  │                                                                  │   │
│  └─────────────────────────────────────────────────────────────────┘   │
│                                                                         │
│  복잡도: O(n²) 메시지                                                   │
│                                                                         │
│  문제점:                                                                │
│  - 네트워크 파티션 시 Split-Brain 가능                                  │
│  - 높은 ID 노드가 불안정하면 계속 선거 반복                             │
│                                                                         │
└─────────────────────────────────────────────────────────────────────────┘
</code></pre></div>

<h3 id="ring-algorithm">Ring Algorithm<a class="header-link" href="#ring-algorithm" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><span class="err">┌─────────────────────────────────────────────────────────────────────────┐</span>
<span class="err">│</span><span class="w">                     </span><span class="n">Ring</span><span class="w"> </span><span class="n">알고리즘</span><span class="w">                                       </span><span class="err">│</span>
<span class="err">├─────────────────────────────────────────────────────────────────────────┤</span>
<span class="err">│</span><span class="w">                                                                         </span><span class="err">│</span>
<span class="err">│</span><span class="w">  </span><span class="nl">구조</span><span class="p">:</span><span class="w"> </span><span class="n">노드가</span><span class="w"> </span><span class="n">논리적</span><span class="w"> </span><span class="n">링으로</span><span class="w"> </span><span class="n">구성</span><span class="w">                                        </span><span class="err">│</span>
<span class="err">│</span><span class="w">                                                                         </span><span class="err">│</span>
<span class="err">│</span><span class="w">  </span><span class="err">┌─────────────────────────────────────────────────────────────────┐</span><span class="w">   </span><span class="err">│</span>
<span class="err">│</span><span class="w">  </span><span class="err">│</span><span class="w">                                                                  </span><span class="err">│</span><span class="w">   </span><span class="err">│</span>
<span class="err">│</span><span class="w">  </span><span class="err">│</span><span class="w">                    </span><span class="err">┌───────┐</span><span class="w">                                     </span><span class="err">│</span><span class="w">   </span><span class="err">│</span>
<span class="err">│</span><span class="w">  </span><span class="err">│</span><span class="w">                    </span><span class="err">│</span><span class="n">Node</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="err">│</span><span class="w">                                     </span><span class="err">│</span><span class="w">   </span><span class="err">│</span>
<span class="err">│</span><span class="w">  </span><span class="err">│</span><span class="w">                    </span><span class="err">└───┬───┘</span><span class="w">                                     </span><span class="err">│</span><span class="w">   </span><span class="err">│</span>
<span class="err">│</span><span class="w">  </span><span class="err">│</span><span class="w">               </span><span class="err">┌────────┘</span><span class="w"> </span><span class="err">└────────┐</span><span class="w">                              </span><span class="err">│</span><span class="w">   </span><span class="err">│</span>
<span class="err">│</span><span class="w">  </span><span class="err">│</span><span class="w">               </span><span class="err">▼</span><span class="w">                   </span><span class="err">▼</span><span class="w">                              </span><span class="err">│</span><span class="w">   </span><span class="err">│</span>
<span class="err">│</span><span class="w">  </span><span class="err">│</span><span class="w">           </span><span class="err">┌───────┐</span><span class="w">           </span><span class="err">┌───────┐</span><span class="w">                          </span><span class="err">│</span><span class="w">   </span><span class="err">│</span>
<span class="err">│</span><span class="w">  </span><span class="err">│</span><span class="w">           </span><span class="err">│</span><span class="n">Node</span><span class="w"> </span><span class="mi">5</span><span class="w"> </span><span class="err">│◄──────────│</span><span class="n">Node</span><span class="w"> </span><span class="mi">2</span><span class="w"> </span><span class="err">│</span><span class="w">                          </span><span class="err">│</span><span class="w">   </span><span class="err">│</span>
<span class="err">│</span><span class="w">  </span><span class="err">│</span><span class="w">           </span><span class="err">└───┬───┘</span><span class="w">           </span><span class="err">└───┬───┘</span><span class="w">                          </span><span class="err">│</span><span class="w">   </span><span class="err">│</span>
<span class="err">│</span><span class="w">  </span><span class="err">│</span><span class="w">               </span><span class="err">│</span><span class="w">                   </span><span class="err">│</span><span class="w">                              </span><span class="err">│</span><span class="w">   </span><span class="err">│</span>
<span class="err">│</span><span class="w">  </span><span class="err">│</span><span class="w">               </span><span class="err">▼</span><span class="w">                   </span><span class="err">▼</span><span class="w">                              </span><span class="err">│</span><span class="w">   </span><span class="err">│</span>
<span class="err">│</span><span class="w">  </span><span class="err">│</span><span class="w">           </span><span class="err">┌───────┐</span><span class="w">           </span><span class="err">┌───────┐</span><span class="w">                          </span><span class="err">│</span><span class="w">   </span><span class="err">│</span>
<span class="err">│</span><span class="w">  </span><span class="err">│</span><span class="w">           </span><span class="err">│</span><span class="n">Node</span><span class="w"> </span><span class="mi">4</span><span class="w"> </span><span class="err">│───────────│</span><span class="n">Node</span><span class="w"> </span><span class="mi">3</span><span class="w"> </span><span class="err">│</span><span class="w">                          </span><span class="err">│</span><span class="w">   </span><span class="err">│</span>
<span class="err">│</span><span class="w">  </span><span class="err">│</span><span class="w">           </span><span class="err">└───────┘</span><span class="w">           </span><span class="err">└───────┘</span><span class="w">                          </span><span class="err">│</span><span class="w">   </span><span class="err">│</span>
<span class="err">│</span><span class="w">  </span><span class="err">│</span><span class="w">                                                                  </span><span class="err">│</span><span class="w">   </span><span class="err">│</span>
<span class="err">│</span><span class="w">  </span><span class="err">└─────────────────────────────────────────────────────────────────┘</span><span class="w">   </span><span class="err">│</span>
<span class="err">│</span><span class="w">                                                                         </span><span class="err">│</span>
<span class="err">│</span><span class="w">  </span><span class="n">선거</span><span class="w"> </span><span class="nl">과정</span><span class="p">:</span><span class="w">                                                             </span><span class="err">│</span>
<span class="err">│</span><span class="w">  </span><span class="err">┌─────────────────────────────────────────────────────────────────┐</span><span class="w">   </span><span class="err">│</span>
<span class="err">│</span><span class="w">  </span><span class="err">│</span><span class="w">                                                                  </span><span class="err">│</span><span class="w">   </span><span class="err">│</span>
<span class="err">│</span><span class="w">  </span><span class="err">│</span><span class="w">  </span><span class="mf">1.</span><span class="w"> </span><span class="n">리더</span><span class="w"> </span><span class="n">장애</span><span class="w"> </span><span class="n">감지</span><span class="w"> </span><span class="n">시</span><span class="w"> </span><span class="n">선거</span><span class="w"> </span><span class="n">메시지</span><span class="w"> </span><span class="nl">생성</span><span class="p">:</span><span class="w"> </span><span class="o">[</span><span class="n">initiator_id</span><span class="o">]</span><span class="w">           </span><span class="err">│</span><span class="w">   </span><span class="err">│</span>
<span class="err">│</span><span class="w">  </span><span class="err">│</span><span class="w">                                                                  </span><span class="err">│</span><span class="w">   </span><span class="err">│</span>
<span class="err">│</span><span class="w">  </span><span class="err">│</span><span class="w">  </span><span class="mf">2.</span><span class="w"> </span><span class="n">다음</span><span class="w"> </span><span class="n">노드로</span><span class="w"> </span><span class="n">전달</span><span class="p">,</span><span class="w"> </span><span class="n">자신의</span><span class="w"> </span><span class="n">ID</span><span class="w"> </span><span class="nl">추가</span><span class="p">:</span><span class="w">                            </span><span class="err">│</span><span class="w">   </span><span class="err">│</span>
<span class="err">│</span><span class="w">  </span><span class="err">│</span><span class="w">     </span><span class="n">Node</span><span class="w"> </span><span class="mi">2</span><span class="err">:</span><span class="w"> </span><span class="o">[</span><span class="n">3</span><span class="o">]</span><span class="w"> </span><span class="err">→</span><span class="w"> </span><span class="n">Node</span><span class="w"> </span><span class="mi">3</span><span class="w">                                        </span><span class="err">│</span><span class="w">   </span><span class="err">│</span>
<span class="err">│</span><span class="w">  </span><span class="err">│</span><span class="w">     </span><span class="n">Node</span><span class="w"> </span><span class="mi">3</span><span class="err">:</span><span class="w"> </span><span class="o">[</span><span class="n">3, 4</span><span class="o">]</span><span class="w"> </span><span class="err">→</span><span class="w"> </span><span class="n">Node</span><span class="w"> </span><span class="mi">4</span><span class="w">                                     </span><span class="err">│</span><span class="w">   </span><span class="err">│</span>
<span class="err">│</span><span class="w">  </span><span class="err">│</span><span class="w">     </span><span class="n">Node</span><span class="w"> </span><span class="mi">4</span><span class="err">:</span><span class="w"> </span><span class="o">[</span><span class="n">3, 4, 5</span><span class="o">]</span><span class="w"> </span><span class="err">→</span><span class="w"> </span><span class="n">Node</span><span class="w"> </span><span class="mi">5</span><span class="w">                                  </span><span class="err">│</span><span class="w">   </span><span class="err">│</span>
<span class="err">│</span><span class="w">  </span><span class="err">│</span><span class="w">     </span><span class="n">Node</span><span class="w"> </span><span class="mi">5</span><span class="err">:</span><span class="w"> </span><span class="o">[</span><span class="n">3, 4, 5, 1</span><span class="o">]</span><span class="w"> </span><span class="err">→</span><span class="w"> </span><span class="n">Node</span><span class="w"> </span><span class="mi">1</span><span class="w">                               </span><span class="err">│</span><span class="w">   </span><span class="err">│</span>
<span class="err">│</span><span class="w">  </span><span class="err">│</span><span class="w">     </span><span class="n">Node</span><span class="w"> </span><span class="mi">1</span><span class="err">:</span><span class="w"> </span><span class="o">[</span><span class="n">3, 4, 5, 1, 2</span><span class="o">]</span><span class="w"> </span><span class="err">→</span><span class="w"> </span><span class="n">Node</span><span class="w"> </span><span class="mi">2</span><span class="w">                            </span><span class="err">│</span><span class="w">   </span><span class="err">│</span>
<span class="err">│</span><span class="w">  </span><span class="err">│</span><span class="w">                                                                  </span><span class="err">│</span><span class="w">   </span><span class="err">│</span>
<span class="err">│</span><span class="w">  </span><span class="err">│</span><span class="w">  </span><span class="mf">3.</span><span class="w"> </span><span class="n">메시지가</span><span class="w"> </span><span class="n">시작점으로</span><span class="w"> </span><span class="nl">돌아오면</span><span class="p">:</span><span class="w">                                </span><span class="err">│</span><span class="w">   </span><span class="err">│</span>
<span class="err">│</span><span class="w">  </span><span class="err">│</span><span class="w">     </span><span class="o">-</span><span class="w"> </span><span class="n">리스트에서</span><span class="w"> </span><span class="n">가장</span><span class="w"> </span><span class="n">높은</span><span class="w"> </span><span class="n">ID</span><span class="w"> </span><span class="nl">선택</span><span class="p">:</span><span class="w"> </span><span class="mi">5</span><span class="w">                           </span><span class="err">│</span><span class="w">   </span><span class="err">│</span>
<span class="err">│</span><span class="w">  </span><span class="err">│</span><span class="w">     </span><span class="o">-</span><span class="w"> </span><span class="n">COORDINATOR</span><span class="w"> </span><span class="n">메시지</span><span class="w"> </span><span class="nl">전파</span><span class="p">:</span><span class="w"> </span><span class="n">Node</span><span class="w"> </span><span class="mi">5</span><span class="n">가</span><span class="w"> </span><span class="n">리더</span><span class="w">                    </span><span class="err">│</span><span class="w">   </span><span class="err">│</span>
<span class="err">│</span><span class="w">  </span><span class="err">│</span><span class="w">                                                                  </span><span class="err">│</span><span class="w">   </span><span class="err">│</span>
<span class="err">│</span><span class="w">  </span><span class="err">└─────────────────────────────────────────────────────────────────┘</span><span class="w">   </span><span class="err">│</span>
<span class="err">│</span><span class="w">                                                                         </span><span class="err">│</span>
<span class="err">│</span><span class="w">  </span><span class="nl">복잡도</span><span class="p">:</span><span class="w"> </span><span class="n">O</span><span class="p">(</span><span class="n">n</span><span class="p">)</span><span class="w"> </span><span class="n">메시지</span><span class="w">                                                    </span><span class="err">│</span>
<span class="err">│</span><span class="w">                                                                         </span><span class="err">│</span>
<span class="err">│</span><span class="w">  </span><span class="nl">장점</span><span class="p">:</span><span class="w"> </span><span class="n">메시지</span><span class="w"> </span><span class="n">수</span><span class="w"> </span><span class="n">적음</span><span class="w">                                                   </span><span class="err">│</span>
<span class="err">│</span><span class="w">  </span><span class="nl">단점</span><span class="p">:</span><span class="w"> </span><span class="n">링</span><span class="w"> </span><span class="n">유지</span><span class="w"> </span><span class="n">필요</span><span class="p">,</span><span class="w"> </span><span class="n">느린</span><span class="w"> </span><span class="n">선거</span><span class="w"> </span><span class="n">과정</span><span class="w">                                     </span><span class="err">│</span>
<span class="err">│</span><span class="w">                                                                         </span><span class="err">│</span>
<span class="err">└─────────────────────────────────────────────────────────────────────────┘</span>
</code></pre></div>

<h3 id="_7">현대적 리더 선출<a class="header-link" href="#_7" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code>┌─────────────────────────────────────────────────────────────────────────┐
│                     현대적 리더 선출 방식                               │
├─────────────────────────────────────────────────────────────────────────┤
│                                                                         │
│  1. 합의 기반 (Consensus-based)                                        │
│  ┌─────────────────────────────────────────────────────────────────┐   │
│  │  - Raft, Paxos 등 합의 알고리즘 사용                            │   │
│  │  - 분산 락 서비스 활용 (ZooKeeper, etcd, Consul)                 │   │
│  │  - Split-Brain 방지                                              │   │
│  │                                                                  │   │
│  │  예: Raft 리더 선출                                              │   │
│  │  - 타임아웃 후 Candidate로 전환                                  │   │
│  │  - 과반수 투표로 리더 선출                                       │   │
│  │  - Term 기반 리더십 관리                                         │   │
│  └─────────────────────────────────────────────────────────────────┘   │
│                                                                         │
│  2. 외부 서비스 활용                                                    │
│  ┌─────────────────────────────────────────────────────────────────┐   │
│  │                                                                  │   │
│  │  ┌─────────────────────────────────────────────────────────┐    │   │
│  │  │                   ZooKeeper / etcd                       │    │   │
│  │  │                                                          │    │   │
│  │  │  /leader-election/                                       │    │   │
│  │  │    └─ lock (ephemeral node)                              │    │   │
│  │  │        owner: node-1                                     │    │   │
│  │  │                                                          │    │   │
│  │  └─────────────────────────────────────────────────────────┘    │   │
│  │            │           │           │                            │   │
│  │            ▼           ▼           ▼                            │   │
│  │       ┌────────┐  ┌────────┐  ┌────────┐                       │   │
│  │       │Node 1  │  │Node 2  │  │Node 3  │                       │   │
│  │       │(Leader)│  │(Watch) │  │(Watch) │                       │   │
│  │       └────────┘  └────────┘  └────────┘                       │   │
│  │                                                                 │   │
│  │  - Ephemeral 노드 생성 시도                                     │   │
│  │  - 첫 번째 생성자가 리더                                        │   │
│  │  - 리더 장애 시 노드 자동 삭제 → 재선거                         │   │
│  │                                                                 │   │
│  └─────────────────────────────────────────────────────────────────┘   │
│                                                                         │
└─────────────────────────────────────────────────────────────────────────┘
</code></pre></div>

<hr />
<h2 id="5">5. 분산 시스템의 도전 과제<a class="header-link" href="#5" title="Permanent link">&para;</a></h2>
<h3 id="_8">네트워크 파티션<a class="header-link" href="#_8" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code>┌─────────────────────────────────────────────────────────────────────────┐
│                     네트워크 파티션 (Network Partition)                 │
├─────────────────────────────────────────────────────────────────────────┤
│                                                                         │
│  파티션 발생:                                                           │
│  ┌─────────────────────────────────────────────────────────────────┐   │
│  │                                                                  │   │
│  │   Partition A              ✗              Partition B           │   │
│  │  ┌─────────────┐    네트워크 단절    ┌─────────────┐            │   │
│  │  │             │    ═══════════════  │             │            │   │
│  │  │  Node 1     │                     │  Node 3     │            │   │
│  │  │  Node 2     │                     │  Node 4     │            │   │
│  │  │             │                     │  Node 5     │            │   │
│  │  │             │                     │             │            │   │
│  │  └─────────────┘                     └─────────────┘            │   │
│  │                                                                  │   │
│  │  각 파티션은 서로를 &quot;장애&quot;로 인식                                │   │
│  └─────────────────────────────────────────────────────────────────┘   │
│                                                                         │
│  Split-Brain 문제:                                                      │
│  ┌─────────────────────────────────────────────────────────────────┐   │
│  │                                                                  │   │
│  │  Partition A:             Partition B:                          │   │
│  │  &quot;Node 3,4,5 장애!&quot;      &quot;Node 1,2 장애!&quot;                       │   │
│  │  → Node 1이 리더          → Node 5가 리더                       │   │
│  │                                                                  │   │
│  │  두 개의 리더! → 데이터 불일치, 충돌                             │   │
│  │                                                                  │   │
│  └─────────────────────────────────────────────────────────────────┘   │
│                                                                         │
│  해결책: Quorum (정족수)                                                │
│  ┌─────────────────────────────────────────────────────────────────┐   │
│  │                                                                  │   │
│  │  과반수 (N/2 + 1) 이상 노드와 통신 가능해야 리더 역할 수행       │   │
│  │                                                                  │   │
│  │  5개 노드 중:                                                    │   │
│  │  - Partition A (2개): 2 &lt; 3 → 리더 불가                         │   │
│  │  - Partition B (3개): 3 ≥ 3 → 리더 가능                         │   │
│  │                                                                  │   │
│  │  → 오직 하나의 리더만 존재!                                      │   │
│  │                                                                  │   │
│  └─────────────────────────────────────────────────────────────────┘   │
│                                                                         │
└─────────────────────────────────────────────────────────────────────────┘
</code></pre></div>

<h3 id="_9">부분 장애<a class="header-link" href="#_9" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code>┌─────────────────────────────────────────────────────────────────────────┐
│                     부분 장애 (Partial Failure)                         │
├─────────────────────────────────────────────────────────────────────────┤
│                                                                         │
│  분산 시스템의 고유한 특성: 일부만 실패할 수 있음                       │
│                                                                         │
│  ┌─────────────────────────────────────────────────────────────────┐   │
│  │                                                                  │   │
│  │  모호한 상황:                                                    │   │
│  │                                                                  │   │
│  │  Node A ──Request──► Node B                                     │   │
│  │         ◄───?────                                               │   │
│  │         타임아웃!                                                │   │
│  │                                                                  │   │
│  │  가능한 원인:                                                    │   │
│  │  1. 요청이 손실됨                                                │   │
│  │  2. Node B가 장애                                                │   │
│  │  3. 요청은 처리됐지만 응답이 손실됨                              │   │
│  │  4. Node B가 느림 (나중에 응답 올 수 있음)                       │   │
│  │                                                                  │   │
│  │  → 재시도? 안 하면? 어떤 게 맞는 결정인지 알 수 없음!            │   │
│  │                                                                  │   │
│  └─────────────────────────────────────────────────────────────────┘   │
│                                                                         │
│  대응 전략:                                                             │
│  ┌─────────────────────────────────────────────────────────────────┐   │
│  │  1. 멱등성 설계: 재시도해도 안전하게                             │   │
│  │  2. 타임아웃 조정: 너무 짧지도, 길지도 않게                      │   │
│  │  3. 헬스체크: 노드 상태 주기적 확인                              │   │
│  │  4. 서킷 브레이커: 반복적 실패 시 빠른 실패                      │   │
│  └─────────────────────────────────────────────────────────────────┘   │
│                                                                         │
└─────────────────────────────────────────────────────────────────────────┘
</code></pre></div>

<h3 id="byzantine-failure">Byzantine Failure<a class="header-link" href="#byzantine-failure" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code>┌─────────────────────────────────────────────────────────────────────────┐
│                     Byzantine Failure                                   │
├─────────────────────────────────────────────────────────────────────────┤
│                                                                         │
│  일반적인 장애: 노드가 멈추거나 응답 없음 (Crash Failure)               │
│  Byzantine 장애: 노드가 잘못된/악의적인 행동                            │
│                                                                         │
│  ┌─────────────────────────────────────────────────────────────────┐   │
│  │                                                                  │   │
│  │  정상 노드:                    Byzantine 노드:                   │   │
│  │  - 프로토콜 준수               - 거짓말                          │   │
│  │  - 정확한 정보                 - 다른 메시지를 다른 노드에        │   │
│  │  - 일관된 동작                 - 랜덤한 동작                      │   │
│  │                                                                  │   │
│  │  ┌─────┐    &quot;값은 5&quot;    ┌─────┐                                 │   │
│  │  │  A  │───────────────►│  B  │                                 │   │
│  │  │(악)│                └─────┘                                 │   │
│  │  │     │    &quot;값은 7&quot;    ┌─────┐                                 │   │
│  │  │     │───────────────►│  C  │                                 │   │
│  │  └─────┘                └─────┘                                 │   │
│  │                                                                  │   │
│  │  B와 C는 다른 값을 받음 → 합의 불가!                            │   │
│  │                                                                  │   │
│  └─────────────────────────────────────────────────────────────────┘   │
│                                                                         │
│  대응:                                                                  │
│  - Byzantine Fault Tolerant (BFT) 알고리즘                             │
│  - 3f + 1 노드로 f개 Byzantine 장애 허용                               │
│  - 블록체인에서 주로 사용 (PBFT, Tendermint)                           │
│                                                                         │
│  일반적인 시스템에서는:                                                 │
│  - 내부 노드는 신뢰 가정 (Crash Failure 모델)                           │
│  - 외부 입력만 검증                                                     │
│                                                                         │
└─────────────────────────────────────────────────────────────────────────┘
</code></pre></div>

<hr />
<h2 id="6">6. 연습 문제<a class="header-link" href="#6" title="Permanent link">&para;</a></h2>
<h3 id="1-lamport-clock">연습 1: Lamport Clock 계산<a class="header-link" href="#1-lamport-clock" title="Permanent link">&para;</a></h3>
<p>다음 이벤트 시퀀스에서 각 이벤트의 Lamport 타임스탬프를 계산하세요:</p>
<div class="highlight"><pre><span></span><code><span class="n">P1</span><span class="o">:</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="err">────────────►</span><span class="w"> </span><span class="n">b</span><span class="w"> </span><span class="err">──────────────────►</span><span class="w"> </span><span class="n">c</span>
<span class="w">         </span><span class="err">│</span><span class="w">                       </span><span class="err">▲</span>
<span class="w">         </span><span class="err">▼</span><span class="w">                       </span><span class="err">│</span>
<span class="n">P2</span><span class="o">:</span><span class="w"> </span><span class="err">─────</span><span class="n">d</span><span class="w"> </span><span class="err">─────────►</span><span class="w"> </span><span class="n">e</span><span class="w"> </span><span class="err">─────────</span><span class="n">f</span><span class="w"> </span><span class="err">────►</span>
</code></pre></div>

<h3 id="2-vector-clock">연습 2: Vector Clock 분석<a class="header-link" href="#2-vector-clock" title="Permanent link">&para;</a></h3>
<p>다음 Vector Clock 값들의 관계(happens-before, concurrent)를 판단하세요:
- V1 = [2, 1, 0]
- V2 = [1, 2, 0]
- V3 = [2, 2, 1]
- V4 = [3, 1, 0]</p>
<h3 id="3_1">연습 3: 리더 선출 설계<a class="header-link" href="#3_1" title="Permanent link">&para;</a></h3>
<p>5개 노드의 분산 데이터베이스에서 리더 선출 메커니즘을 설계하세요:
- 네트워크 파티션 처리
- Split-Brain 방지
- 리더 장애 시 자동 복구</p>
<hr />
<h2 id="_10">다음 단계<a class="header-link" href="#_10" title="Permanent link">&para;</a></h2>
<p><a href="./16_Consensus_Algorithms.md">16_Consensus_Algorithms.md</a>에서 Paxos, Raft 등 분산 합의 알고리즘을 배워봅시다!</p>
<hr />
<h2 id="_11">참고 자료<a class="header-link" href="#_11" title="Permanent link">&para;</a></h2>
<ul>
<li>"Distributed Systems" - Maarten van Steen, Andrew Tanenbaum</li>
<li>"Designing Data-Intensive Applications" - Martin Kleppmann</li>
<li>"Time, Clocks, and the Ordering of Events in a Distributed System" - Leslie Lamport</li>
<li>"The Fallacies of Distributed Computing" - L Peter Deutsch</li>
<li>Raft Consensus Algorithm - raft.github.io</li>
</ul>
    </div>

    
<div class="lesson-toolbar lesson-toolbar--bottom">
    <div class="toolbar-nav toolbar-nav--prev">
        
        <a href="/study/ko/System_Design/14_Microservices_Patterns.html" class="nav-prev">
            <span class="nav-label">Previous</span>
            <span class="nav-title">마이크로서비스 패턴 (Microservices Patterns)</span>
        </a>
        
    </div>
    <div class="toolbar-actions">
        <button class="btn btn-copy-link" data-action="copy-link" title="Copy link">
            <span class="icon">🔗</span>
            <span class="text">Copy link</span>
        </button>
        <a href="/study/ko/System_Design/" class="btn btn-topic-link" title="Back to topic list">
            <span class="icon">📋</span>
            <span class="text">Topic list</span>
        </a>
    </div>
    <div class="toolbar-nav toolbar-nav--next">
        
        <a href="/study/ko/System_Design/16_Consensus_Algorithms.html" class="nav-next">
            <span class="nav-label">Next</span>
            <span class="nav-title">합의 알고리즘 (Consensus Algorithms)</span>
        </a>
        
    </div>
</div>


    <div class="toolbar-keyboard-hint">
        <kbd>&larr;</kbd> <kbd>&rarr;</kbd> to navigate between lessons
    </div>
</article>

<!-- Scroll to top floating button -->
<button class="scroll-to-top" id="scroll-to-top" title="Scroll to top" aria-label="Scroll to top">↑</button>

            </div>
        </main>
    </div>

    <script src="/study/static/js/app.js"></script>
    <script>
        function switchLanguage(newLang) {
            const path = window.location.pathname;
            const base = '/study';
            const currentLang = 'ko';
            const newPath = path.replace(base + '/' + currentLang + '/', base + '/' + newLang + '/');
            window.location.href = newPath + window.location.search;
        }
    </script>
    
<script>
    document.addEventListener('DOMContentLoaded', function() {
        // Copy link - independent feedback per button
        document.querySelectorAll('[data-action="copy-link"]').forEach(function(btn) {
            btn.addEventListener('click', function() {
                navigator.clipboard.writeText(window.location.href);
                var textEl = this.querySelector('.text');
                var originalText = textEl.textContent;
                textEl.textContent = 'Copied!';
                setTimeout(function() { textEl.textContent = originalText; }, 2000);
            });
        });

        // Add copy buttons to code blocks
        document.querySelectorAll('.lesson-content pre').forEach(function(pre) {
            var copyBtn = document.createElement('button');
            copyBtn.className = 'code-copy-btn';
            copyBtn.textContent = 'Copy';
            copyBtn.addEventListener('click', function() {
                var code = pre.querySelector('code');
                var text = code ? code.textContent : pre.textContent;
                navigator.clipboard.writeText(text);
                copyBtn.textContent = 'Copied!';
                setTimeout(function() { copyBtn.textContent = 'Copy'; }, 2000);
            });
            pre.style.position = 'relative';
            pre.appendChild(copyBtn);
        });

        // Scroll to top button
        var scrollBtn = document.getElementById('scroll-to-top');
        window.addEventListener('scroll', function() {
            scrollBtn.classList.toggle('visible', window.scrollY > 300);
        });
        scrollBtn.addEventListener('click', function() {
            window.scrollTo({ top: 0, behavior: 'smooth' });
        });

        // Keyboard shortcuts: left/right arrows for lesson navigation
        document.addEventListener('keydown', function(e) {
            var tag = document.activeElement.tagName;
            if (tag === 'INPUT' || tag === 'TEXTAREA' || tag === 'SELECT') return;

            if (e.key === 'ArrowLeft') {
                var prevLink = document.querySelector('.nav-prev');
                if (prevLink) prevLink.click();
            } else if (e.key === 'ArrowRight') {
                var nextLink = document.querySelector('.nav-next');
                if (nextLink) nextLink.click();
            }
        });
    });
</script>

</body>
</html>
{% endraw %}