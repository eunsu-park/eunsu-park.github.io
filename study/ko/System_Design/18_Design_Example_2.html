{% raw %}
<!DOCTYPE html>
<html lang="ko" data-theme="light">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>실전 설계 예제 2 (Practical Design Examples 2) - Study Materials</title>
    <link rel="stylesheet" href="/study/static/css/style.css">
    <link rel="stylesheet" href="/study/static/css/highlight.css">
    <!-- KaTeX for LaTeX math rendering -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.16.11/dist/katex.min.css">
    <script defer src="https://cdn.jsdelivr.net/npm/katex@0.16.11/dist/katex.min.js"></script>
    <script defer src="https://cdn.jsdelivr.net/npm/katex@0.16.11/dist/contrib/auto-render.min.js"
        onload="renderMathInElement(document.body, {
            delimiters: [
                {left: '$$', right: '$$', display: true},
                {left: '$', right: '$', display: false}
            ],
            throwOnError: false
        });"></script>
    
</head>
<body>
    <div class="app-container">
        <!-- Sidebar -->
        <aside class="sidebar" id="sidebar">
            <div class="sidebar-header">
                <a href="/study/ko/" class="logo">Study Materials</a>
                <button class="sidebar-toggle" id="sidebar-toggle" aria-label="Toggle sidebar">
                    <span></span>
                </button>
            </div>

            <nav class="sidebar-nav">
                <a href="/study/ko/" class="nav-item ">
                    <span class="nav-icon">🏠</span>
                    <span class="nav-text">Home</span>
                </a>
                <a href="/study/examples/" class="nav-item ">
                    <span class="nav-icon">💻</span>
                    <span class="nav-text">Examples</span>
                </a>
            </nav>

            <div class="sidebar-search">
                <form action="/study/ko/search.html" method="get" id="search-form">
                    <input type="search" name="q" placeholder="Search..." id="search-sidebar-input">
                </form>
            </div>

            <!-- Language Selector -->
            <div class="sidebar-lang">
                <select id="lang-select" class="lang-selector" onchange="switchLanguage(this.value)">
                    
                    <option value="en" >
                        English
                    </option>
                    
                    <option value="ko" selected>
                        한국어
                    </option>
                    
                </select>
            </div>

            <div class="sidebar-footer">
                <button class="theme-toggle" id="theme-toggle" aria-label="Toggle theme">
                    <span class="theme-icon light">☀️</span>
                    <span class="theme-icon dark">🌙</span>
                </button>
            </div>
        </aside>

        <!-- Main Content -->
        <main class="main-content">
            <header class="main-header">
                <button class="menu-toggle" id="menu-toggle" aria-label="Open menu">
                    <span></span>
                </button>
                
<nav class="breadcrumb">
    <a href="/study/ko/">Topics</a>
    <span class="separator">/</span>
    <a href="/study/ko/System_Design/">System Design</a>
    <span class="separator">/</span>
    <span class="current">실전 설계 예제 2 (Practical Design Examples 2)</span>
</nav>

            </header>

            <div class="content">
                
<article class="lesson-article">
    <header class="lesson-header">
        <h1>실전 설계 예제 2 (Practical Design Examples 2)</h1>
    </header>

    
<div class="lesson-toolbar lesson-toolbar--top">
    <div class="toolbar-nav toolbar-nav--prev">
        
        <a href="/study/ko/System_Design/17_Design_Example_1.html" class="nav-prev">
            <span class="nav-label">Previous</span>
            <span class="nav-title">실전 설계 예제 1 (Practical Design Examples 1)</span>
        </a>
        
    </div>
    <div class="toolbar-actions">
        <button class="btn btn-copy-link" data-action="copy-link" title="Copy link">
            <span class="icon">🔗</span>
            <span class="text">Copy link</span>
        </button>
        <a href="/study/ko/System_Design/" class="btn btn-topic-link" title="Back to topic list">
            <span class="icon">📋</span>
            <span class="text">Topic list</span>
        </a>
    </div>
    <div class="toolbar-nav toolbar-nav--next">
        
        <a href="/study/ko/System_Design/19_Observability_Monitoring.html" class="nav-next">
            <span class="nav-label">Next</span>
            <span class="nav-title">19. 관측 가능성과 모니터링</span>
        </a>
        
    </div>
</div>


    
    <nav class="toc" id="toc">
        <h2>Table of Contents</h2>
        <div class="toc">
<ul>
<li><a href="#_1">개요</a></li>
<li><a href="#_2">목차</a></li>
<li><a href="#1">1. 뉴스 피드 / 타임라인</a><ul>
<li><a href="#11">1.1 요구사항 정의</a></li>
<li><a href="#12-push-vs-pull">1.2 핵심 과제: Push vs Pull</a></li>
<li><a href="#13">1.3 하이브리드 접근</a></li>
<li><a href="#14">1.4 시스템 아키텍처</a></li>
<li><a href="#15">1.5 피드 캐싱 전략</a></li>
</ul>
</li>
<li><a href="#2">2. 채팅 시스템</a><ul>
<li><a href="#21">2.1 요구사항 정의</a></li>
<li><a href="#22">2.2 통신 프로토콜</a></li>
<li><a href="#23">2.3 시스템 아키텍처</a></li>
<li><a href="#24">2.4 메시지 전송 흐름</a></li>
<li><a href="#25">2.5 그룹 채팅</a></li>
<li><a href="#26">2.6 온라인 상태 관리</a></li>
<li><a href="#27">2.7 메시지 저장</a></li>
</ul>
</li>
<li><a href="#3">3. 알림 시스템</a><ul>
<li><a href="#31">3.1 요구사항 정의</a></li>
<li><a href="#32">3.2 시스템 아키텍처</a></li>
<li><a href="#33">3.3 알림 흐름</a></li>
<li><a href="#34">3.4 중복 방지</a></li>
<li><a href="#35">3.5 우선순위 처리</a></li>
<li><a href="#36">3.6 알림 설정 스키마</a></li>
</ul>
</li>
<li><a href="#4">4. 연습 문제</a><ul>
<li><a href="#1_1">연습 1: 뉴스 피드 확장</a></li>
<li><a href="#2_1">연습 2: 채팅 시스템 확장</a></li>
<li><a href="#3_1">연습 3: 알림 시스템 최적화</a></li>
</ul>
</li>
<li><a href="#_3">마무리</a></li>
<li><a href="#_4">참고 자료</a></li>
</ul>
</div>

    </nav>
    

    <div class="lesson-content markdown-body">
        <h1 id="2-practical-design-examples-2">실전 설계 예제 2 (Practical Design Examples 2)<a class="header-link" href="#2-practical-design-examples-2" title="Permanent link">&para;</a></h1>
<p>난이도: ⭐⭐⭐⭐</p>
<h2 id="_1">개요<a class="header-link" href="#_1" title="Permanent link">&para;</a></h2>
<p>이 장에서는 소셜 미디어와 실시간 통신 시스템을 설계합니다: 뉴스 피드/타임라인, 채팅 시스템, 알림 시스템. 이러한 시스템은 대규모 사용자를 다루며, 실시간성과 확장성이 중요한 과제입니다.</p>
<hr />
<h2 id="_2">목차<a class="header-link" href="#_2" title="Permanent link">&para;</a></h2>
<ol>
<li><a href="#1-뉴스-피드--타임라인">뉴스 피드 / 타임라인</a></li>
<li><a href="#2-채팅-시스템">채팅 시스템</a></li>
<li><a href="#3-알림-시스템">알림 시스템</a></li>
<li><a href="#4-연습-문제">연습 문제</a></li>
</ol>
<hr />
<h2 id="1">1. 뉴스 피드 / 타임라인<a class="header-link" href="#1" title="Permanent link">&para;</a></h2>
<h3 id="11">1.1 요구사항 정의<a class="header-link" href="#11" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code>┌─────────────────────────────────────────────────────────────────────────┐
│                     기능 요구사항                                       │
├─────────────────────────────────────────────────────────────────────────┤
│                                                                         │
│  핵심 기능:                                                             │
│  1. 포스트 작성: 텍스트, 이미지, 비디오                                 │
│  2. 뉴스 피드 조회: 팔로우하는 사용자의 포스트                          │
│  3. 타임라인 조회: 특정 사용자의 포스트 목록                            │
│                                                                         │
│  부가 기능:                                                             │
│  4. 좋아요, 댓글                                                        │
│  5. 무한 스크롤                                                         │
│  6. 실시간 업데이트                                                     │
│                                                                         │
├─────────────────────────────────────────────────────────────────────────┤
│                     규모                                                │
├─────────────────────────────────────────────────────────────────────────┤
│                                                                         │
│  - 일간 활성 사용자(DAU): 100M                                          │
│  - 사용자당 팔로우: 평균 200명                                          │
│  - 일간 포스트: 10M                                                     │
│  - 피드 조회 빈도: 10회/일/사용자                                       │
│                                                                         │
└─────────────────────────────────────────────────────────────────────────┘
</code></pre></div>

<h3 id="12-push-vs-pull">1.2 핵심 과제: Push vs Pull<a class="header-link" href="#12-push-vs-pull" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><span class="err">┌─────────────────────────────────────────────────────────────────────────┐</span>
<span class="err">│</span><span class="w">                     </span><span class="nt">피드</span><span class="w"> </span><span class="nt">생성</span><span class="w"> </span><span class="nt">전략</span><span class="w">                                      </span><span class="err">│</span>
<span class="err">├─────────────────────────────────────────────────────────────────────────┤</span>
<span class="err">│</span><span class="w">                                                                         </span><span class="err">│</span>
<span class="err">│</span><span class="w">  </span><span class="nt">방법</span><span class="w"> </span><span class="nt">1</span><span class="o">:</span><span class="w"> </span><span class="nt">Pull</span><span class="w"> </span><span class="o">(</span><span class="nt">Fan-out</span><span class="w"> </span><span class="nt">on</span><span class="w"> </span><span class="nt">Read</span><span class="o">)</span><span class="w">                                        </span><span class="err">│</span>
<span class="err">│</span><span class="w">  </span><span class="err">┌─────────────────────────────────────────────────────────────────┐</span><span class="w">   </span><span class="err">│</span>
<span class="err">│</span><span class="w">  </span><span class="err">│</span><span class="w">                                                                  </span><span class="err">│</span><span class="w">   </span><span class="err">│</span>
<span class="err">│</span><span class="w">  </span><span class="err">│</span><span class="w">  </span><span class="nt">사용자가</span><span class="w"> </span><span class="nt">피드</span><span class="w"> </span><span class="nt">요청</span><span class="w"> </span><span class="nt">시</span><span class="o">:</span><span class="w">                                          </span><span class="err">│</span><span class="w">   </span><span class="err">│</span>
<span class="err">│</span><span class="w">  </span><span class="err">│</span><span class="w">                                                                  </span><span class="err">│</span><span class="w">   </span><span class="err">│</span>
<span class="err">│</span><span class="w">  </span><span class="err">│</span><span class="w">  </span><span class="nt">1</span><span class="o">.</span><span class="w"> </span><span class="nt">팔로우</span><span class="w"> </span><span class="nt">목록</span><span class="w"> </span><span class="nt">조회</span><span class="w">                                             </span><span class="err">│</span><span class="w">   </span><span class="err">│</span>
<span class="err">│</span><span class="w">  </span><span class="err">│</span><span class="w">  </span><span class="nt">2</span><span class="o">.</span><span class="w"> </span><span class="nt">각</span><span class="w"> </span><span class="nt">팔로우의</span><span class="w"> </span><span class="nt">최신</span><span class="w"> </span><span class="nt">포스트</span><span class="w"> </span><span class="nt">조회</span><span class="w">                                 </span><span class="err">│</span><span class="w">   </span><span class="err">│</span>
<span class="err">│</span><span class="w">  </span><span class="err">│</span><span class="w">  </span><span class="nt">3</span><span class="o">.</span><span class="w"> </span><span class="nt">병합</span><span class="w"> </span><span class="nt">및</span><span class="w"> </span><span class="nt">정렬</span><span class="w">                                                 </span><span class="err">│</span><span class="w">   </span><span class="err">│</span>
<span class="err">│</span><span class="w">  </span><span class="err">│</span><span class="w">  </span><span class="nt">4</span><span class="o">.</span><span class="w"> </span><span class="nt">반환</span><span class="w">                                                         </span><span class="err">│</span><span class="w">   </span><span class="err">│</span>
<span class="err">│</span><span class="w">  </span><span class="err">│</span><span class="w">                                                                  </span><span class="err">│</span><span class="w">   </span><span class="err">│</span>
<span class="err">│</span><span class="w">  </span><span class="err">│</span><span class="w">  </span><span class="err">┌──────────┐</span><span class="w">                                                   </span><span class="err">│</span><span class="w">   </span><span class="err">│</span>
<span class="err">│</span><span class="w">  </span><span class="err">│</span><span class="w">  </span><span class="err">│</span><span class="w">   </span><span class="nt">User</span><span class="w">   </span><span class="err">│───</span><span class="w"> </span><span class="nt">GET</span><span class="w"> </span><span class="o">/</span><span class="nt">feed</span><span class="w">                                      </span><span class="err">│</span><span class="w">   </span><span class="err">│</span>
<span class="err">│</span><span class="w">  </span><span class="err">│</span><span class="w">  </span><span class="err">└────┬─────┘</span><span class="w">                                                   </span><span class="err">│</span><span class="w">   </span><span class="err">│</span>
<span class="err">│</span><span class="w">  </span><span class="err">│</span><span class="w">       </span><span class="err">│</span><span class="w">                                                          </span><span class="err">│</span><span class="w">   </span><span class="err">│</span>
<span class="err">│</span><span class="w">  </span><span class="err">│</span><span class="w">       </span><span class="err">▼</span><span class="w">                                                          </span><span class="err">│</span><span class="w">   </span><span class="err">│</span>
<span class="err">│</span><span class="w">  </span><span class="err">│</span><span class="w">  </span><span class="err">┌────────────────────────────────────────────────────────────┐</span><span class="w"> </span><span class="err">│</span><span class="w">   </span><span class="err">│</span>
<span class="err">│</span><span class="w">  </span><span class="err">│</span><span class="w">  </span><span class="err">│</span><span class="w">  </span><span class="nt">SELECT</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nt">FROM</span><span class="w"> </span><span class="nt">posts</span><span class="w">                                       </span><span class="err">│</span><span class="w"> </span><span class="err">│</span><span class="w">   </span><span class="err">│</span>
<span class="err">│</span><span class="w">  </span><span class="err">│</span><span class="w">  </span><span class="err">│</span><span class="w">  </span><span class="nt">WHERE</span><span class="w"> </span><span class="nt">author_id</span><span class="w"> </span><span class="nt">IN</span><span class="w"> </span><span class="o">(</span><span class="nt">SELECT</span><span class="w"> </span><span class="nt">followee</span><span class="w"> </span><span class="nt">FROM</span><span class="w"> </span><span class="nt">follows</span><span class="w">          </span><span class="err">│</span><span class="w"> </span><span class="err">│</span><span class="w">   </span><span class="err">│</span>
<span class="err">│</span><span class="w">  </span><span class="err">│</span><span class="w">  </span><span class="err">│</span><span class="w">                      </span><span class="nt">WHERE</span><span class="w"> </span><span class="nt">follower</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nt">user_id</span><span class="o">)</span><span class="w">             </span><span class="err">│</span><span class="w"> </span><span class="err">│</span><span class="w">   </span><span class="err">│</span>
<span class="err">│</span><span class="w">  </span><span class="err">│</span><span class="w">  </span><span class="err">│</span><span class="w">  </span><span class="nt">ORDER</span><span class="w"> </span><span class="nt">BY</span><span class="w"> </span><span class="nt">created_at</span><span class="w"> </span><span class="nt">DESC</span><span class="w">                                  </span><span class="err">│</span><span class="w"> </span><span class="err">│</span><span class="w">   </span><span class="err">│</span>
<span class="err">│</span><span class="w">  </span><span class="err">│</span><span class="w">  </span><span class="err">│</span><span class="w">  </span><span class="nt">LIMIT</span><span class="w"> </span><span class="nt">20</span><span class="o">;</span><span class="w">                                                 </span><span class="err">│</span><span class="w"> </span><span class="err">│</span><span class="w">   </span><span class="err">│</span>
<span class="err">│</span><span class="w">  </span><span class="err">│</span><span class="w">  </span><span class="err">└────────────────────────────────────────────────────────────┘</span><span class="w"> </span><span class="err">│</span><span class="w">   </span><span class="err">│</span>
<span class="err">│</span><span class="w">  </span><span class="err">│</span><span class="w">                                                                  </span><span class="err">│</span><span class="w">   </span><span class="err">│</span>
<span class="err">│</span><span class="w">  </span><span class="err">│</span><span class="w">  </span><span class="nt">장점</span><span class="o">:</span><span class="w">                                                           </span><span class="err">│</span><span class="w">   </span><span class="err">│</span>
<span class="err">│</span><span class="w">  </span><span class="err">│</span><span class="w">  </span><span class="nt">-</span><span class="w"> </span><span class="nt">저장</span><span class="w"> </span><span class="nt">공간</span><span class="w"> </span><span class="nt">절약</span><span class="w">                                                </span><span class="err">│</span><span class="w">   </span><span class="err">│</span>
<span class="err">│</span><span class="w">  </span><span class="err">│</span><span class="w">  </span><span class="nt">-</span><span class="w"> </span><span class="nt">포스트</span><span class="w"> </span><span class="nt">작성이</span><span class="w"> </span><span class="nt">빠름</span><span class="w">                                            </span><span class="err">│</span><span class="w">   </span><span class="err">│</span>
<span class="err">│</span><span class="w">  </span><span class="err">│</span><span class="w">                                                                  </span><span class="err">│</span><span class="w">   </span><span class="err">│</span>
<span class="err">│</span><span class="w">  </span><span class="err">│</span><span class="w">  </span><span class="nt">단점</span><span class="o">:</span><span class="w">                                                           </span><span class="err">│</span><span class="w">   </span><span class="err">│</span>
<span class="err">│</span><span class="w">  </span><span class="err">│</span><span class="w">  </span><span class="nt">-</span><span class="w"> </span><span class="nt">피드</span><span class="w"> </span><span class="nt">조회가</span><span class="w"> </span><span class="nt">느림</span><span class="w"> </span><span class="o">(</span><span class="nt">팔로우</span><span class="w"> </span><span class="nt">많으면</span><span class="o">)</span><span class="w">                              </span><span class="err">│</span><span class="w">   </span><span class="err">│</span>
<span class="err">│</span><span class="w">  </span><span class="err">│</span><span class="w">  </span><span class="nt">-</span><span class="w"> </span><span class="nt">DB</span><span class="w"> </span><span class="nt">부하</span><span class="w">                                                       </span><span class="err">│</span><span class="w">   </span><span class="err">│</span>
<span class="err">│</span><span class="w">  </span><span class="err">│</span><span class="w">                                                                  </span><span class="err">│</span><span class="w">   </span><span class="err">│</span>
<span class="err">│</span><span class="w">  </span><span class="err">└─────────────────────────────────────────────────────────────────┘</span><span class="w">   </span><span class="err">│</span>
<span class="err">│</span><span class="w">                                                                         </span><span class="err">│</span>
<span class="err">│</span><span class="w">  </span><span class="nt">방법</span><span class="w"> </span><span class="nt">2</span><span class="o">:</span><span class="w"> </span><span class="nt">Push</span><span class="w"> </span><span class="o">(</span><span class="nt">Fan-out</span><span class="w"> </span><span class="nt">on</span><span class="w"> </span><span class="nt">Write</span><span class="o">)</span><span class="w">                                       </span><span class="err">│</span>
<span class="err">│</span><span class="w">  </span><span class="err">┌─────────────────────────────────────────────────────────────────┐</span><span class="w">   </span><span class="err">│</span>
<span class="err">│</span><span class="w">  </span><span class="err">│</span><span class="w">                                                                  </span><span class="err">│</span><span class="w">   </span><span class="err">│</span>
<span class="err">│</span><span class="w">  </span><span class="err">│</span><span class="w">  </span><span class="nt">포스트</span><span class="w"> </span><span class="nt">작성</span><span class="w"> </span><span class="nt">시</span><span class="o">:</span><span class="w">                                                 </span><span class="err">│</span><span class="w">   </span><span class="err">│</span>
<span class="err">│</span><span class="w">  </span><span class="err">│</span><span class="w">                                                                  </span><span class="err">│</span><span class="w">   </span><span class="err">│</span>
<span class="err">│</span><span class="w">  </span><span class="err">│</span><span class="w">  </span><span class="nt">1</span><span class="o">.</span><span class="w"> </span><span class="nt">포스트</span><span class="w"> </span><span class="nt">저장</span><span class="w">                                                  </span><span class="err">│</span><span class="w">   </span><span class="err">│</span>
<span class="err">│</span><span class="w">  </span><span class="err">│</span><span class="w">  </span><span class="nt">2</span><span class="o">.</span><span class="w"> </span><span class="nt">모든</span><span class="w"> </span><span class="nt">팔로워의</span><span class="w"> </span><span class="nt">피드에</span><span class="w"> </span><span class="nt">추가</span><span class="w">                                    </span><span class="err">│</span><span class="w">   </span><span class="err">│</span>
<span class="err">│</span><span class="w">  </span><span class="err">│</span><span class="w">                                                                  </span><span class="err">│</span><span class="w">   </span><span class="err">│</span>
<span class="err">│</span><span class="w">  </span><span class="err">│</span><span class="w">  </span><span class="err">┌──────────┐</span><span class="w">                                                   </span><span class="err">│</span><span class="w">   </span><span class="err">│</span>
<span class="err">│</span><span class="w">  </span><span class="err">│</span><span class="w">  </span><span class="err">│</span><span class="w">  </span><span class="nt">Author</span><span class="w">  </span><span class="err">│───</span><span class="w"> </span><span class="nt">POST</span><span class="w"> </span><span class="o">/</span><span class="nt">posts</span><span class="w">                                    </span><span class="err">│</span><span class="w">   </span><span class="err">│</span>
<span class="err">│</span><span class="w">  </span><span class="err">│</span><span class="w">  </span><span class="err">└────┬─────┘</span><span class="w">                                                   </span><span class="err">│</span><span class="w">   </span><span class="err">│</span>
<span class="err">│</span><span class="w">  </span><span class="err">│</span><span class="w">       </span><span class="err">│</span><span class="w">                                                          </span><span class="err">│</span><span class="w">   </span><span class="err">│</span>
<span class="err">│</span><span class="w">  </span><span class="err">│</span><span class="w">       </span><span class="err">▼</span><span class="w">                                                          </span><span class="err">│</span><span class="w">   </span><span class="err">│</span>
<span class="err">│</span><span class="w">  </span><span class="err">│</span><span class="w">  </span><span class="err">┌──────────────┐</span><span class="w">                                               </span><span class="err">│</span><span class="w">   </span><span class="err">│</span>
<span class="err">│</span><span class="w">  </span><span class="err">│</span><span class="w">  </span><span class="err">│</span><span class="w"> </span><span class="nt">Save</span><span class="w"> </span><span class="nt">Post</span><span class="w">    </span><span class="err">│</span><span class="w">                                               </span><span class="err">│</span><span class="w">   </span><span class="err">│</span>
<span class="err">│</span><span class="w">  </span><span class="err">│</span><span class="w">  </span><span class="err">└──────┬───────┘</span><span class="w">                                               </span><span class="err">│</span><span class="w">   </span><span class="err">│</span>
<span class="err">│</span><span class="w">  </span><span class="err">│</span><span class="w">         </span><span class="err">│</span><span class="w">                                                        </span><span class="err">│</span><span class="w">   </span><span class="err">│</span>
<span class="err">│</span><span class="w">  </span><span class="err">│</span><span class="w">         </span><span class="err">▼</span><span class="w">                                                        </span><span class="err">│</span><span class="w">   </span><span class="err">│</span>
<span class="err">│</span><span class="w">  </span><span class="err">│</span><span class="w">  </span><span class="err">┌──────────────┐</span><span class="w">     </span><span class="err">┌──────────────────────────────────────┐</span><span class="w">  </span><span class="err">│</span><span class="w">   </span><span class="err">│</span>
<span class="err">│</span><span class="w">  </span><span class="err">│</span><span class="w">  </span><span class="err">│</span><span class="w"> </span><span class="nt">Fan-out</span><span class="w"> </span><span class="nt">to</span><span class="w">   </span><span class="err">│────►│</span><span class="w"> </span><span class="nt">Follower</span><span class="w"> </span><span class="nt">1</span><span class="w"> </span><span class="nt">Feed</span><span class="o">:</span><span class="w"> </span><span class="cp">[</span><span class="nx">post_id</span><span class="p">,</span><span class="w"> </span><span class="nx">...</span><span class="cp">]</span><span class="w">      </span><span class="err">│</span><span class="w">  </span><span class="err">│</span><span class="w">   </span><span class="err">│</span>
<span class="err">│</span><span class="w">  </span><span class="err">│</span><span class="w">  </span><span class="err">│</span><span class="w"> </span><span class="nt">all</span><span class="w"> </span><span class="nt">followers</span><span class="err">│────►│</span><span class="w"> </span><span class="nt">Follower</span><span class="w"> </span><span class="nt">2</span><span class="w"> </span><span class="nt">Feed</span><span class="o">:</span><span class="w"> </span><span class="cp">[</span><span class="nx">post_id</span><span class="p">,</span><span class="w"> </span><span class="nx">...</span><span class="cp">]</span><span class="w">      </span><span class="err">│</span><span class="w">  </span><span class="err">│</span><span class="w">   </span><span class="err">│</span>
<span class="err">│</span><span class="w">  </span><span class="err">│</span><span class="w">  </span><span class="err">│</span><span class="w">              </span><span class="err">│────►│</span><span class="w"> </span><span class="nt">Follower</span><span class="w"> </span><span class="nt">3</span><span class="w"> </span><span class="nt">Feed</span><span class="o">:</span><span class="w"> </span><span class="cp">[</span><span class="nx">post_id</span><span class="p">,</span><span class="w"> </span><span class="nx">...</span><span class="cp">]</span><span class="w">      </span><span class="err">│</span><span class="w">  </span><span class="err">│</span><span class="w">   </span><span class="err">│</span>
<span class="err">│</span><span class="w">  </span><span class="err">│</span><span class="w">  </span><span class="err">│</span><span class="w">              </span><span class="err">│────►│</span><span class="w"> </span><span class="o">...</span><span class="w">                                   </span><span class="err">│</span><span class="w">  </span><span class="err">│</span><span class="w">   </span><span class="err">│</span>
<span class="err">│</span><span class="w">  </span><span class="err">│</span><span class="w">  </span><span class="err">└──────────────┘</span><span class="w">     </span><span class="err">└──────────────────────────────────────┘</span><span class="w">  </span><span class="err">│</span><span class="w">   </span><span class="err">│</span>
<span class="err">│</span><span class="w">  </span><span class="err">│</span><span class="w">                                                                  </span><span class="err">│</span><span class="w">   </span><span class="err">│</span>
<span class="err">│</span><span class="w">  </span><span class="err">│</span><span class="w">  </span><span class="nt">장점</span><span class="o">:</span><span class="w">                                                           </span><span class="err">│</span><span class="w">   </span><span class="err">│</span>
<span class="err">│</span><span class="w">  </span><span class="err">│</span><span class="w">  </span><span class="nt">-</span><span class="w"> </span><span class="nt">피드</span><span class="w"> </span><span class="nt">조회가</span><span class="w"> </span><span class="nt">빠름</span><span class="w"> </span><span class="o">(</span><span class="nt">사전</span><span class="w"> </span><span class="nt">계산됨</span><span class="o">)</span><span class="w">                                </span><span class="err">│</span><span class="w">   </span><span class="err">│</span>
<span class="err">│</span><span class="w">  </span><span class="err">│</span><span class="w">                                                                  </span><span class="err">│</span><span class="w">   </span><span class="err">│</span>
<span class="err">│</span><span class="w">  </span><span class="err">│</span><span class="w">  </span><span class="nt">단점</span><span class="o">:</span><span class="w">                                                           </span><span class="err">│</span><span class="w">   </span><span class="err">│</span>
<span class="err">│</span><span class="w">  </span><span class="err">│</span><span class="w">  </span><span class="nt">-</span><span class="w"> </span><span class="nt">저장</span><span class="w"> </span><span class="nt">공간</span><span class="w"> </span><span class="nt">많이</span><span class="w"> </span><span class="nt">사용</span><span class="w">                                           </span><span class="err">│</span><span class="w">   </span><span class="err">│</span>
<span class="err">│</span><span class="w">  </span><span class="err">│</span><span class="w">  </span><span class="nt">-</span><span class="w"> </span><span class="nt">셀럽</span><span class="o">(</span><span class="nt">팔로워</span><span class="w"> </span><span class="nt">많은</span><span class="w"> </span><span class="nt">사용자</span><span class="o">)</span><span class="w"> </span><span class="nt">포스트</span><span class="w"> </span><span class="nt">지연</span><span class="w">                          </span><span class="err">│</span><span class="w">   </span><span class="err">│</span>
<span class="err">│</span><span class="w">  </span><span class="err">│</span><span class="w">                                                                  </span><span class="err">│</span><span class="w">   </span><span class="err">│</span>
<span class="err">│</span><span class="w">  </span><span class="err">└─────────────────────────────────────────────────────────────────┘</span><span class="w">   </span><span class="err">│</span>
<span class="err">│</span><span class="w">                                                                         </span><span class="err">│</span>
<span class="err">└─────────────────────────────────────────────────────────────────────────┘</span>
</code></pre></div>

<h3 id="13">1.3 하이브리드 접근<a class="header-link" href="#13" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><span class="err">┌─────────────────────────────────────────────────────────────────────────┐</span>
<span class="err">│</span><span class="w">                     </span><span class="n">하이브리드</span><span class="w"> </span><span class="n">팬아웃</span><span class="w">                                   </span><span class="err">│</span>
<span class="err">├─────────────────────────────────────────────────────────────────────────┤</span>
<span class="err">│</span><span class="w">                                                                         </span><span class="err">│</span>
<span class="err">│</span><span class="w">  </span><span class="n">핵심</span><span class="w"> </span><span class="nl">아이디어</span><span class="p">:</span><span class="w">                                                         </span><span class="err">│</span>
<span class="err">│</span><span class="w">  </span><span class="o">-</span><span class="w"> </span><span class="n">일반</span><span class="w"> </span><span class="nl">사용자</span><span class="p">:</span><span class="w"> </span><span class="n">Push</span><span class="w"> </span><span class="p">(</span><span class="n">Fan</span><span class="o">-</span><span class="k">out</span><span class="w"> </span><span class="k">on</span><span class="w"> </span><span class="k">Write</span><span class="p">)</span><span class="w">                                </span><span class="err">│</span>
<span class="err">│</span><span class="w">  </span><span class="o">-</span><span class="w"> </span><span class="n">핫</span><span class="w"> </span><span class="n">유저</span><span class="p">(</span><span class="n">셀럽</span><span class="p">)</span><span class="err">:</span><span class="w"> </span><span class="n">Pull</span><span class="w"> </span><span class="p">(</span><span class="n">Fan</span><span class="o">-</span><span class="k">out</span><span class="w"> </span><span class="k">on</span><span class="w"> </span><span class="k">Read</span><span class="p">)</span><span class="w">                               </span><span class="err">│</span>
<span class="err">│</span><span class="w">                                                                         </span><span class="err">│</span>
<span class="err">│</span><span class="w">  </span><span class="err">┌─────────────────────────────────────────────────────────────────┐</span><span class="w">   </span><span class="err">│</span>
<span class="err">│</span><span class="w">  </span><span class="err">│</span><span class="w">                                                                  </span><span class="err">│</span><span class="w">   </span><span class="err">│</span>
<span class="err">│</span><span class="w">  </span><span class="err">│</span><span class="w">  </span><span class="n">포스트</span><span class="w"> </span><span class="nl">작성</span><span class="p">:</span><span class="w">                                                    </span><span class="err">│</span><span class="w">   </span><span class="err">│</span>
<span class="err">│</span><span class="w">  </span><span class="err">│</span><span class="w">                                                                  </span><span class="err">│</span><span class="w">   </span><span class="err">│</span>
<span class="err">│</span><span class="w">  </span><span class="err">│</span><span class="w">  </span><span class="err">┌──────────┐</span><span class="w">                                                   </span><span class="err">│</span><span class="w">   </span><span class="err">│</span>
<span class="err">│</span><span class="w">  </span><span class="err">│</span><span class="w">  </span><span class="err">│</span><span class="w">  </span><span class="n">Author</span><span class="w">  </span><span class="err">│──►</span><span class="w"> </span><span class="n">팔로워</span><span class="w"> </span><span class="n">수</span><span class="w"> </span><span class="n">확인</span><span class="w">                                 </span><span class="err">│</span><span class="w">   </span><span class="err">│</span>
<span class="err">│</span><span class="w">  </span><span class="err">│</span><span class="w">  </span><span class="err">└────┬─────┘</span><span class="w">                                                   </span><span class="err">│</span><span class="w">   </span><span class="err">│</span>
<span class="err">│</span><span class="w">  </span><span class="err">│</span><span class="w">       </span><span class="err">│</span><span class="w">                                                          </span><span class="err">│</span><span class="w">   </span><span class="err">│</span>
<span class="err">│</span><span class="w">  </span><span class="err">│</span><span class="w">  </span><span class="err">┌────┴────┐</span><span class="w">                                                     </span><span class="err">│</span><span class="w">   </span><span class="err">│</span>
<span class="err">│</span><span class="w">  </span><span class="err">│</span><span class="w">  </span><span class="err">│</span><span class="w">         </span><span class="err">│</span><span class="w">                                                     </span><span class="err">│</span><span class="w">   </span><span class="err">│</span>
<span class="err">│</span><span class="w">  </span><span class="err">│</span><span class="w">  </span><span class="err">▼</span><span class="w">         </span><span class="err">▼</span><span class="w">                                                     </span><span class="err">│</span><span class="w">   </span><span class="err">│</span>
<span class="err">│</span><span class="w">  </span><span class="err">│</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="mi">10</span><span class="n">K</span><span class="w">    </span><span class="err">≥</span><span class="w"> </span><span class="mi">10</span><span class="n">K</span><span class="w">                                                  </span><span class="err">│</span><span class="w">   </span><span class="err">│</span>
<span class="err">│</span><span class="w">  </span><span class="err">│</span><span class="w"> </span><span class="n">팔로워</span><span class="w">   </span><span class="n">팔로워</span><span class="w">                                                  </span><span class="err">│</span><span class="w">   </span><span class="err">│</span>
<span class="err">│</span><span class="w">  </span><span class="err">│</span><span class="w">  </span><span class="err">│</span><span class="w">         </span><span class="err">│</span><span class="w">                                                     </span><span class="err">│</span><span class="w">   </span><span class="err">│</span>
<span class="err">│</span><span class="w">  </span><span class="err">│</span><span class="w">  </span><span class="err">▼</span><span class="w">         </span><span class="err">▼</span><span class="w">                                                     </span><span class="err">│</span><span class="w">   </span><span class="err">│</span>
<span class="err">│</span><span class="w">  </span><span class="err">│</span><span class="w"> </span><span class="n">Push</span><span class="w">     </span><span class="k">Save</span><span class="w"> </span><span class="k">to</span><span class="w">                                                </span><span class="err">│</span><span class="w">   </span><span class="err">│</span>
<span class="err">│</span><span class="w">  </span><span class="err">│</span><span class="w"> </span><span class="k">to</span><span class="w"> </span><span class="ow">all</span><span class="w">   </span><span class="n">hot_posts</span><span class="w">                                              </span><span class="err">│</span><span class="w">   </span><span class="err">│</span>
<span class="err">│</span><span class="w">  </span><span class="err">│</span><span class="w"> </span><span class="n">feeds</span><span class="w">    </span><span class="nc">table</span><span class="w"> </span><span class="k">only</span><span class="w">                                             </span><span class="err">│</span><span class="w">   </span><span class="err">│</span>
<span class="err">│</span><span class="w">  </span><span class="err">│</span><span class="w">                                                                  </span><span class="err">│</span><span class="w">   </span><span class="err">│</span>
<span class="err">│</span><span class="w">  </span><span class="err">└─────────────────────────────────────────────────────────────────┘</span><span class="w">   </span><span class="err">│</span>
<span class="err">│</span><span class="w">                                                                         </span><span class="err">│</span>
<span class="err">│</span><span class="w">  </span><span class="n">피드</span><span class="w"> </span><span class="nl">조회</span><span class="p">:</span><span class="w">                                                             </span><span class="err">│</span>
<span class="err">│</span><span class="w">  </span><span class="err">┌─────────────────────────────────────────────────────────────────┐</span><span class="w">   </span><span class="err">│</span>
<span class="err">│</span><span class="w">  </span><span class="err">│</span><span class="w">                                                                  </span><span class="err">│</span><span class="w">   </span><span class="err">│</span>
<span class="err">│</span><span class="w">  </span><span class="err">│</span><span class="w">  </span><span class="mf">1.</span><span class="w"> </span><span class="n">사전</span><span class="w"> </span><span class="n">계산된</span><span class="w"> </span><span class="n">피드</span><span class="w"> </span><span class="n">조회</span><span class="w"> </span><span class="p">(</span><span class="n">Push된</span><span class="w"> </span><span class="n">포스트</span><span class="p">)</span><span class="w">                        </span><span class="err">│</span><span class="w">   </span><span class="err">│</span>
<span class="err">│</span><span class="w">  </span><span class="err">│</span><span class="w">  </span><span class="mf">2.</span><span class="w"> </span><span class="n">팔로우</span><span class="w"> </span><span class="n">중인</span><span class="w"> </span><span class="n">핫</span><span class="w"> </span><span class="n">유저의</span><span class="w"> </span><span class="n">최신</span><span class="w"> </span><span class="n">포스트</span><span class="w"> </span><span class="n">조회</span><span class="w">                       </span><span class="err">│</span><span class="w">   </span><span class="err">│</span>
<span class="err">│</span><span class="w">  </span><span class="err">│</span><span class="w">  </span><span class="mf">3.</span><span class="w"> </span><span class="n">병합</span><span class="w"> </span><span class="n">및</span><span class="w"> </span><span class="n">정렬</span><span class="w">                                                 </span><span class="err">│</span><span class="w">   </span><span class="err">│</span>
<span class="err">│</span><span class="w">  </span><span class="err">│</span><span class="w">                                                                  </span><span class="err">│</span><span class="w">   </span><span class="err">│</span>
<span class="err">│</span><span class="w">  </span><span class="err">│</span><span class="w">  </span><span class="err">┌──────────────────────────────────────────────────────────┐</span><span class="w">   </span><span class="err">│</span><span class="w">   </span><span class="err">│</span>
<span class="err">│</span><span class="w">  </span><span class="err">│</span><span class="w">  </span><span class="err">│</span><span class="w">                                                          </span><span class="err">│</span><span class="w">   </span><span class="err">│</span><span class="w">   </span><span class="err">│</span>
<span class="err">│</span><span class="w">  </span><span class="err">│</span><span class="w">  </span><span class="err">│</span><span class="w">  </span><span class="n">Pre</span><span class="o">-</span><span class="n">computed</span><span class="w"> </span><span class="n">Feed</span><span class="w">     </span><span class="n">Hot</span><span class="w"> </span><span class="n">Users</span><span class="w"> </span><span class="n">Posts</span><span class="w">                   </span><span class="err">│</span><span class="w">   </span><span class="err">│</span><span class="w">   </span><span class="err">│</span>
<span class="err">│</span><span class="w">  </span><span class="err">│</span><span class="w">  </span><span class="err">│</span><span class="w">  </span><span class="err">┌───────────────┐</span><span class="w">    </span><span class="err">┌───────────────┐</span><span class="w">                 </span><span class="err">│</span><span class="w">   </span><span class="err">│</span><span class="w">   </span><span class="err">│</span>
<span class="err">│</span><span class="w">  </span><span class="err">│</span><span class="w">  </span><span class="err">│</span><span class="w">  </span><span class="err">│</span><span class="w"> </span><span class="o">[</span><span class="n">post1</span><span class="o">]</span><span class="w">       </span><span class="err">│</span><span class="w">    </span><span class="err">│</span><span class="w"> </span><span class="o">[</span><span class="n">celeb_post1</span><span class="o">]</span><span class="w"> </span><span class="err">│</span><span class="w">                 </span><span class="err">│</span><span class="w">   </span><span class="err">│</span><span class="w">   </span><span class="err">│</span>
<span class="err">│</span><span class="w">  </span><span class="err">│</span><span class="w">  </span><span class="err">│</span><span class="w">  </span><span class="err">│</span><span class="w"> </span><span class="o">[</span><span class="n">post2</span><span class="o">]</span><span class="w">       </span><span class="err">│</span><span class="w"> </span><span class="o">+</span><span class="w">  </span><span class="err">│</span><span class="w"> </span><span class="o">[</span><span class="n">celeb_post2</span><span class="o">]</span><span class="w"> </span><span class="err">│</span><span class="w">                 </span><span class="err">│</span><span class="w">   </span><span class="err">│</span><span class="w">   </span><span class="err">│</span>
<span class="err">│</span><span class="w">  </span><span class="err">│</span><span class="w">  </span><span class="err">│</span><span class="w">  </span><span class="err">│</span><span class="w"> </span><span class="o">[</span><span class="n">post3</span><span class="o">]</span><span class="w">       </span><span class="err">│</span><span class="w">    </span><span class="err">│</span><span class="w">               </span><span class="err">│</span><span class="w">                 </span><span class="err">│</span><span class="w">   </span><span class="err">│</span><span class="w">   </span><span class="err">│</span>
<span class="err">│</span><span class="w">  </span><span class="err">│</span><span class="w">  </span><span class="err">│</span><span class="w">  </span><span class="err">└───────────────┘</span><span class="w">    </span><span class="err">└───────────────┘</span><span class="w">                 </span><span class="err">│</span><span class="w">   </span><span class="err">│</span><span class="w">   </span><span class="err">│</span>
<span class="err">│</span><span class="w">  </span><span class="err">│</span><span class="w">  </span><span class="err">│</span><span class="w">           </span><span class="err">│</span><span class="w">                    </span><span class="err">│</span><span class="w">                         </span><span class="err">│</span><span class="w">   </span><span class="err">│</span><span class="w">   </span><span class="err">│</span>
<span class="err">│</span><span class="w">  </span><span class="err">│</span><span class="w">  </span><span class="err">│</span><span class="w">           </span><span class="err">└────────┬───────────┘</span><span class="w">                         </span><span class="err">│</span><span class="w">   </span><span class="err">│</span><span class="w">   </span><span class="err">│</span>
<span class="err">│</span><span class="w">  </span><span class="err">│</span><span class="w">  </span><span class="err">│</span><span class="w">                    </span><span class="err">▼</span><span class="w">                                     </span><span class="err">│</span><span class="w">   </span><span class="err">│</span><span class="w">   </span><span class="err">│</span>
<span class="err">│</span><span class="w">  </span><span class="err">│</span><span class="w">  </span><span class="err">│</span><span class="w">             </span><span class="k">Merge</span><span class="w"> </span><span class="o">&amp;</span><span class="w"> </span><span class="n">Sort</span><span class="w">                                 </span><span class="err">│</span><span class="w">   </span><span class="err">│</span><span class="w">   </span><span class="err">│</span>
<span class="err">│</span><span class="w">  </span><span class="err">│</span><span class="w">  </span><span class="err">│</span><span class="w">                    </span><span class="err">│</span><span class="w">                                     </span><span class="err">│</span><span class="w">   </span><span class="err">│</span><span class="w">   </span><span class="err">│</span>
<span class="err">│</span><span class="w">  </span><span class="err">│</span><span class="w">  </span><span class="err">│</span><span class="w">                    </span><span class="err">▼</span><span class="w">                                     </span><span class="err">│</span><span class="w">   </span><span class="err">│</span><span class="w">   </span><span class="err">│</span>
<span class="err">│</span><span class="w">  </span><span class="err">│</span><span class="w">  </span><span class="err">│</span><span class="w">            </span><span class="n">Final</span><span class="w"> </span><span class="n">Feed</span><span class="w">                                    </span><span class="err">│</span><span class="w">   </span><span class="err">│</span><span class="w">   </span><span class="err">│</span>
<span class="err">│</span><span class="w">  </span><span class="err">│</span><span class="w">  </span><span class="err">│</span><span class="w">                                                          </span><span class="err">│</span><span class="w">   </span><span class="err">│</span><span class="w">   </span><span class="err">│</span>
<span class="err">│</span><span class="w">  </span><span class="err">│</span><span class="w">  </span><span class="err">└──────────────────────────────────────────────────────────┘</span><span class="w">   </span><span class="err">│</span><span class="w">   </span><span class="err">│</span>
<span class="err">│</span><span class="w">  </span><span class="err">│</span><span class="w">                                                                  </span><span class="err">│</span><span class="w">   </span><span class="err">│</span>
<span class="err">│</span><span class="w">  </span><span class="err">└─────────────────────────────────────────────────────────────────┘</span><span class="w">   </span><span class="err">│</span>
<span class="err">│</span><span class="w">                                                                         </span><span class="err">│</span>
<span class="err">└─────────────────────────────────────────────────────────────────────────┘</span>
</code></pre></div>

<h3 id="14">1.4 시스템 아키텍처<a class="header-link" href="#14" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code>┌─────────────────────────────────────────────────────────────────────────┐
│                     뉴스 피드 아키텍처                                  │
├─────────────────────────────────────────────────────────────────────────┤
│                                                                         │
│  ┌───────────────────────────────────────────────────────────────────┐ │
│  │                                                                   │ │
│  │   ┌────────┐                                                     │ │
│  │   │ Client │                                                     │ │
│  │   └───┬────┘                                                     │ │
│  │       │                                                          │ │
│  │       ▼                                                          │ │
│  │   ┌─────────────────┐                                            │ │
│  │   │   API Gateway   │                                            │ │
│  │   └───────┬─────────┘                                            │ │
│  │           │                                                      │ │
│  │   ┌───────┴───────┐                                              │ │
│  │   │               │                                              │ │
│  │   ▼               ▼                                              │ │
│  │ ┌─────────────┐ ┌─────────────┐                                 │ │
│  │ │ Post Service│ │ Feed Service│                                 │ │
│  │ └──────┬──────┘ └──────┬──────┘                                 │ │
│  │        │               │                                        │ │
│  │        ▼               │                                        │ │
│  │ ┌─────────────┐        │                                        │ │
│  │ │   Posts DB  │        │                                        │ │
│  │ │  (Sharded)  │        │                                        │ │
│  │ └──────┬──────┘        │                                        │ │
│  │        │               │                                        │ │
│  │        ▼               ▼                                        │ │
│  │ ┌──────────────────────────────────────┐                        │ │
│  │ │           Message Queue              │                        │ │
│  │ │            (Kafka)                   │                        │ │
│  │ └─────────────────┬────────────────────┘                        │ │
│  │                   │                                              │ │
│  │                   ▼                                              │ │
│  │ ┌──────────────────────────────────────┐                        │ │
│  │ │        Fanout Workers                │                        │ │
│  │ │  ┌────────┐ ┌────────┐ ┌────────┐   │                        │ │
│  │ │  │Worker 1│ │Worker 2│ │Worker 3│   │                        │ │
│  │ │  └───┬────┘ └───┬────┘ └───┬────┘   │                        │ │
│  │ └──────┼──────────┼──────────┼────────┘                        │ │
│  │        │          │          │                                  │ │
│  │        └──────────┼──────────┘                                  │ │
│  │                   ▼                                              │ │
│  │ ┌──────────────────────────────────────┐                        │ │
│  │ │         Feed Cache (Redis)           │                        │ │
│  │ │   user:123:feed = [post_ids...]      │                        │ │
│  │ └──────────────────────────────────────┘                        │ │
│  │                                                                   │ │
│  └───────────────────────────────────────────────────────────────────┘ │
│                                                                         │
└─────────────────────────────────────────────────────────────────────────┘
</code></pre></div>

<h3 id="15">1.5 피드 캐싱 전략<a class="header-link" href="#15" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code>┌─────────────────────────────────────────────────────────────────────────┐
│                     피드 캐싱                                           │
├─────────────────────────────────────────────────────────────────────────┤
│                                                                         │
│  Redis 피드 구조:                                                       │
│  ┌─────────────────────────────────────────────────────────────────┐   │
│  │                                                                  │   │
│  │  Key: feed:{user_id}                                            │   │
│  │  Type: Sorted Set                                               │   │
│  │  Score: timestamp                                               │   │
│  │  Member: post_id                                                │   │
│  │                                                                  │   │
│  │  ZADD feed:123 1704067200 &quot;post_abc&quot;                           │   │
│  │  ZADD feed:123 1704067300 &quot;post_def&quot;                           │   │
│  │  ...                                                            │   │
│  │                                                                  │   │
│  │  조회: ZREVRANGE feed:123 0 19                                  │   │
│  │  → 최신 20개 포스트 ID                                          │   │
│  │                                                                  │   │
│  └─────────────────────────────────────────────────────────────────┘   │
│                                                                         │
│  캐시 관리:                                                             │
│  ┌─────────────────────────────────────────────────────────────────┐   │
│  │                                                                  │   │
│  │  - 피드 크기 제한: 최근 800개 포스트만 유지                      │   │
│  │    ZREMRANGEBYRANK feed:123 0 -801                              │   │
│  │                                                                  │   │
│  │  - TTL 설정: 활성 사용자만 캐시 유지                             │   │
│  │    비활성 사용자 → 조회 시 재구축                               │   │
│  │                                                                  │   │
│  │  - 포스트 내용은 별도 캐시                                       │   │
│  │    Key: post:{post_id}                                          │   │
│  │    Value: { author, content, media, ... }                       │   │
│  │                                                                  │   │
│  └─────────────────────────────────────────────────────────────────┘   │
│                                                                         │
└─────────────────────────────────────────────────────────────────────────┘
</code></pre></div>

<hr />
<h2 id="2">2. 채팅 시스템<a class="header-link" href="#2" title="Permanent link">&para;</a></h2>
<h3 id="21">2.1 요구사항 정의<a class="header-link" href="#21" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code>┌─────────────────────────────────────────────────────────────────────────┐
│                     기능 요구사항                                       │
├─────────────────────────────────────────────────────────────────────────┤
│                                                                         │
│  핵심 기능:                                                             │
│  1. 1:1 채팅                                                            │
│  2. 그룹 채팅 (최대 500명)                                              │
│  3. 온라인 상태 표시                                                    │
│  4. 읽음 확인                                                           │
│                                                                         │
│  메시지 기능:                                                           │
│  5. 텍스트, 이미지, 파일 전송                                           │
│  6. 메시지 히스토리 동기화                                              │
│  7. 푸시 알림 (오프라인 시)                                             │
│                                                                         │
├─────────────────────────────────────────────────────────────────────────┤
│                     비기능 요구사항                                     │
├─────────────────────────────────────────────────────────────────────────┤
│                                                                         │
│  - 실시간 전송: &lt; 100ms                                                 │
│  - 메시지 순서 보장                                                     │
│  - 메시지 유실 방지                                                     │
│  - 동시 접속: 수백만                                                    │
│                                                                         │
└─────────────────────────────────────────────────────────────────────────┘
</code></pre></div>

<h3 id="22">2.2 통신 프로토콜<a class="header-link" href="#22" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><span class="err">┌─────────────────────────────────────────────────────────────────────────┐</span>
<span class="err">│</span><span class="w">                     </span><span class="n">프로토콜</span><span class="w"> </span><span class="n">선택</span><span class="w">                                       </span><span class="err">│</span>
<span class="err">├─────────────────────────────────────────────────────────────────────────┤</span>
<span class="err">│</span><span class="w">                                                                         </span><span class="err">│</span>
<span class="err">│</span><span class="w">  </span><span class="mf">1.</span><span class="w"> </span><span class="n">HTTP</span><span class="w"> </span><span class="n">Polling</span><span class="w">                                                       </span><span class="err">│</span>
<span class="err">│</span><span class="w">  </span><span class="err">┌─────────────────────────────────────────────────────────────────┐</span><span class="w">   </span><span class="err">│</span>
<span class="err">│</span><span class="w">  </span><span class="err">│</span><span class="w">                                                                  </span><span class="err">│</span><span class="w">   </span><span class="err">│</span>
<span class="err">│</span><span class="w">  </span><span class="err">│</span><span class="w">  </span><span class="n">Client</span><span class="w">              </span><span class="n">Server</span><span class="w">                                     </span><span class="err">│</span><span class="w">   </span><span class="err">│</span>
<span class="err">│</span><span class="w">  </span><span class="err">│</span><span class="w">    </span><span class="err">│</span><span class="w">                   </span><span class="err">│</span><span class="w">                                        </span><span class="err">│</span><span class="w">   </span><span class="err">│</span>
<span class="err">│</span><span class="w">  </span><span class="err">│</span><span class="w">    </span><span class="err">│──</span><span class="w"> </span><span class="k">GET</span><span class="w"> </span><span class="o">/</span><span class="n">messages</span><span class="w"> </span><span class="err">─►│</span><span class="w">                                        </span><span class="err">│</span><span class="w">   </span><span class="err">│</span>
<span class="err">│</span><span class="w">  </span><span class="err">│</span><span class="w">    </span><span class="err">│◄──</span><span class="w"> </span><span class="err">[]</span><span class="w"> </span><span class="err">────────────│</span><span class="w">                                        </span><span class="err">│</span><span class="w">   </span><span class="err">│</span>
<span class="err">│</span><span class="w">  </span><span class="err">│</span><span class="w">    </span><span class="err">│</span><span class="w">                   </span><span class="err">│</span><span class="w">                                        </span><span class="err">│</span><span class="w">   </span><span class="err">│</span>
<span class="err">│</span><span class="w">  </span><span class="err">│</span><span class="w">    </span><span class="err">│──</span><span class="w"> </span><span class="k">GET</span><span class="w"> </span><span class="o">/</span><span class="n">messages</span><span class="w"> </span><span class="err">─►│</span><span class="w"> </span><span class="p">(</span><span class="mi">5</span><span class="n">초</span><span class="w"> </span><span class="n">후</span><span class="p">)</span><span class="w">                               </span><span class="err">│</span><span class="w">   </span><span class="err">│</span>
<span class="err">│</span><span class="w">  </span><span class="err">│</span><span class="w">    </span><span class="err">│◄──</span><span class="w"> </span><span class="err">[]</span><span class="w"> </span><span class="err">────────────│</span><span class="w">                                        </span><span class="err">│</span><span class="w">   </span><span class="err">│</span>
<span class="err">│</span><span class="w">  </span><span class="err">│</span><span class="w">    </span><span class="err">│</span><span class="w">                   </span><span class="err">│</span><span class="w">                                        </span><span class="err">│</span><span class="w">   </span><span class="err">│</span>
<span class="err">│</span><span class="w">  </span><span class="err">│</span><span class="w">    </span><span class="err">│──</span><span class="w"> </span><span class="k">GET</span><span class="w"> </span><span class="o">/</span><span class="n">messages</span><span class="w"> </span><span class="err">─►│</span><span class="w"> </span><span class="p">(</span><span class="mi">5</span><span class="n">초</span><span class="w"> </span><span class="n">후</span><span class="p">)</span><span class="w">                               </span><span class="err">│</span><span class="w">   </span><span class="err">│</span>
<span class="err">│</span><span class="w">  </span><span class="err">│</span><span class="w">    </span><span class="err">│◄──</span><span class="w"> </span><span class="o">[</span><span class="n">msg1</span><span class="o">]</span><span class="w"> </span><span class="err">────────│</span><span class="w">                                        </span><span class="err">│</span><span class="w">   </span><span class="err">│</span>
<span class="err">│</span><span class="w">  </span><span class="err">│</span><span class="w">                                                                  </span><span class="err">│</span><span class="w">   </span><span class="err">│</span>
<span class="err">│</span><span class="w">  </span><span class="err">│</span><span class="w">  </span><span class="nl">단점</span><span class="p">:</span><span class="w"> </span><span class="n">지연</span><span class="p">,</span><span class="w"> </span><span class="n">불필요한</span><span class="w"> </span><span class="n">요청</span><span class="p">,</span><span class="w"> </span><span class="n">서버</span><span class="w"> </span><span class="n">부하</span><span class="w">                            </span><span class="err">│</span><span class="w">   </span><span class="err">│</span>
<span class="err">│</span><span class="w">  </span><span class="err">│</span><span class="w">                                                                  </span><span class="err">│</span><span class="w">   </span><span class="err">│</span>
<span class="err">│</span><span class="w">  </span><span class="err">└─────────────────────────────────────────────────────────────────┘</span><span class="w">   </span><span class="err">│</span>
<span class="err">│</span><span class="w">                                                                         </span><span class="err">│</span>
<span class="err">│</span><span class="w">  </span><span class="mf">2.</span><span class="w"> </span><span class="n">Long</span><span class="w"> </span><span class="n">Polling</span><span class="w">                                                       </span><span class="err">│</span>
<span class="err">│</span><span class="w">  </span><span class="err">┌─────────────────────────────────────────────────────────────────┐</span><span class="w">   </span><span class="err">│</span>
<span class="err">│</span><span class="w">  </span><span class="err">│</span><span class="w">                                                                  </span><span class="err">│</span><span class="w">   </span><span class="err">│</span>
<span class="err">│</span><span class="w">  </span><span class="err">│</span><span class="w">  </span><span class="n">Client</span><span class="w">              </span><span class="n">Server</span><span class="w">                                     </span><span class="err">│</span><span class="w">   </span><span class="err">│</span>
<span class="err">│</span><span class="w">  </span><span class="err">│</span><span class="w">    </span><span class="err">│</span><span class="w">                   </span><span class="err">│</span><span class="w">                                        </span><span class="err">│</span><span class="w">   </span><span class="err">│</span>
<span class="err">│</span><span class="w">  </span><span class="err">│</span><span class="w">    </span><span class="err">│──</span><span class="w"> </span><span class="k">GET</span><span class="w"> </span><span class="o">/</span><span class="n">messages</span><span class="w"> </span><span class="err">─►│</span><span class="w">                                        </span><span class="err">│</span><span class="w">   </span><span class="err">│</span>
<span class="err">│</span><span class="w">  </span><span class="err">│</span><span class="w">    </span><span class="err">│</span><span class="w">    </span><span class="p">(</span><span class="n">대기</span><span class="p">...)</span><span class="w">      </span><span class="err">│</span><span class="w">                                        </span><span class="err">│</span><span class="w">   </span><span class="err">│</span>
<span class="err">│</span><span class="w">  </span><span class="err">│</span><span class="w">    </span><span class="err">│</span><span class="w">                   </span><span class="err">│</span><span class="w"> </span><span class="n">메시지</span><span class="w"> </span><span class="n">도착</span><span class="err">!</span><span class="w">                            </span><span class="err">│</span><span class="w">   </span><span class="err">│</span>
<span class="err">│</span><span class="w">  </span><span class="err">│</span><span class="w">    </span><span class="err">│◄──</span><span class="w"> </span><span class="o">[</span><span class="n">msg1</span><span class="o">]</span><span class="w"> </span><span class="err">────────│</span><span class="w">                                        </span><span class="err">│</span><span class="w">   </span><span class="err">│</span>
<span class="err">│</span><span class="w">  </span><span class="err">│</span><span class="w">    </span><span class="err">│──</span><span class="w"> </span><span class="k">GET</span><span class="w"> </span><span class="o">/</span><span class="n">messages</span><span class="w"> </span><span class="err">─►│</span><span class="w"> </span><span class="p">(</span><span class="n">즉시</span><span class="w"> </span><span class="n">재연결</span><span class="p">)</span><span class="w">                          </span><span class="err">│</span><span class="w">   </span><span class="err">│</span>
<span class="err">│</span><span class="w">  </span><span class="err">│</span><span class="w">    </span><span class="err">│</span><span class="w">    </span><span class="p">(</span><span class="n">대기</span><span class="p">...)</span><span class="w">      </span><span class="err">│</span><span class="w">                                        </span><span class="err">│</span><span class="w">   </span><span class="err">│</span>
<span class="err">│</span><span class="w">  </span><span class="err">│</span><span class="w">                                                                  </span><span class="err">│</span><span class="w">   </span><span class="err">│</span>
<span class="err">│</span><span class="w">  </span><span class="err">│</span><span class="w">  </span><span class="nl">개선</span><span class="p">:</span><span class="w"> </span><span class="n">불필요한</span><span class="w"> </span><span class="n">요청</span><span class="w"> </span><span class="n">감소</span><span class="w">                                        </span><span class="err">│</span><span class="w">   </span><span class="err">│</span>
<span class="err">│</span><span class="w">  </span><span class="err">│</span><span class="w">  </span><span class="nl">단점</span><span class="p">:</span><span class="w"> </span><span class="n">연결</span><span class="w"> </span><span class="n">오버헤드</span><span class="p">,</span><span class="w"> </span><span class="n">서버</span><span class="w"> </span><span class="n">리소스</span><span class="w">                                </span><span class="err">│</span><span class="w">   </span><span class="err">│</span>
<span class="err">│</span><span class="w">  </span><span class="err">│</span><span class="w">                                                                  </span><span class="err">│</span><span class="w">   </span><span class="err">│</span>
<span class="err">│</span><span class="w">  </span><span class="err">└─────────────────────────────────────────────────────────────────┘</span><span class="w">   </span><span class="err">│</span>
<span class="err">│</span><span class="w">                                                                         </span><span class="err">│</span>
<span class="err">│</span><span class="w">  </span><span class="mf">3.</span><span class="w"> </span><span class="n">WebSocket</span><span class="w"> </span><span class="p">(</span><span class="n">권장</span><span class="p">)</span><span class="w">                                                   </span><span class="err">│</span>
<span class="err">│</span><span class="w">  </span><span class="err">┌─────────────────────────────────────────────────────────────────┐</span><span class="w">   </span><span class="err">│</span>
<span class="err">│</span><span class="w">  </span><span class="err">│</span><span class="w">                                                                  </span><span class="err">│</span><span class="w">   </span><span class="err">│</span>
<span class="err">│</span><span class="w">  </span><span class="err">│</span><span class="w">  </span><span class="n">Client</span><span class="w">              </span><span class="n">Server</span><span class="w">                                     </span><span class="err">│</span><span class="w">   </span><span class="err">│</span>
<span class="err">│</span><span class="w">  </span><span class="err">│</span><span class="w">    </span><span class="err">│</span><span class="w">                   </span><span class="err">│</span><span class="w">                                        </span><span class="err">│</span><span class="w">   </span><span class="err">│</span>
<span class="err">│</span><span class="w">  </span><span class="err">│</span><span class="w">    </span><span class="err">│──</span><span class="w"> </span><span class="n">HTTP</span><span class="w"> </span><span class="n">Upgrade</span><span class="w"> </span><span class="err">──►│</span><span class="w">                                        </span><span class="err">│</span><span class="w">   </span><span class="err">│</span>
<span class="err">│</span><span class="w">  </span><span class="err">│</span><span class="w">    </span><span class="err">│◄─</span><span class="w"> </span><span class="mi">101</span><span class="w"> </span><span class="n">Switching</span><span class="w"> </span><span class="err">──│</span><span class="w">                                        </span><span class="err">│</span><span class="w">   </span><span class="err">│</span>
<span class="err">│</span><span class="w">  </span><span class="err">│</span><span class="w">    </span><span class="err">│</span><span class="w">                   </span><span class="err">│</span><span class="w">                                        </span><span class="err">│</span><span class="w">   </span><span class="err">│</span>
<span class="err">│</span><span class="w">  </span><span class="err">│</span><span class="w">    </span><span class="err">│═══</span><span class="w"> </span><span class="n">WebSocket</span><span class="w"> </span><span class="err">═════│</span><span class="w"> </span><span class="p">(</span><span class="n">양방향</span><span class="w"> </span><span class="n">연결</span><span class="w"> </span><span class="n">유지</span><span class="p">)</span><span class="w">                     </span><span class="err">│</span><span class="w">   </span><span class="err">│</span>
<span class="err">│</span><span class="w">  </span><span class="err">│</span><span class="w">    </span><span class="err">│</span><span class="w">                   </span><span class="err">│</span><span class="w">                                        </span><span class="err">│</span><span class="w">   </span><span class="err">│</span>
<span class="err">│</span><span class="w">  </span><span class="err">│</span><span class="w">    </span><span class="err">│◄──</span><span class="w"> </span><span class="o">[</span><span class="n">msg1</span><span class="o">]</span><span class="w"> </span><span class="err">────────│</span><span class="w"> </span><span class="p">(</span><span class="n">서버</span><span class="w"> </span><span class="n">푸시</span><span class="p">)</span><span class="w">                            </span><span class="err">│</span><span class="w">   </span><span class="err">│</span>
<span class="err">│</span><span class="w">  </span><span class="err">│</span><span class="w">    </span><span class="err">│──</span><span class="w"> </span><span class="o">[</span><span class="n">msg2</span><span class="o">]</span><span class="w"> </span><span class="err">────────►│</span><span class="w"> </span><span class="p">(</span><span class="n">클라이언트</span><span class="w"> </span><span class="n">전송</span><span class="p">)</span><span class="w">                      </span><span class="err">│</span><span class="w">   </span><span class="err">│</span>
<span class="err">│</span><span class="w">  </span><span class="err">│</span><span class="w">    </span><span class="err">│◄──</span><span class="w"> </span><span class="o">[</span><span class="n">msg3</span><span class="o">]</span><span class="w"> </span><span class="err">────────│</span><span class="w">                                        </span><span class="err">│</span><span class="w">   </span><span class="err">│</span>
<span class="err">│</span><span class="w">  </span><span class="err">│</span><span class="w">                                                                  </span><span class="err">│</span><span class="w">   </span><span class="err">│</span>
<span class="err">│</span><span class="w">  </span><span class="err">│</span><span class="w">  </span><span class="nl">장점</span><span class="p">:</span><span class="w"> </span><span class="n">실시간</span><span class="p">,</span><span class="w"> </span><span class="n">양방향</span><span class="p">,</span><span class="w"> </span><span class="n">오버헤드</span><span class="w"> </span><span class="n">최소</span><span class="w">                             </span><span class="err">│</span><span class="w">   </span><span class="err">│</span>
<span class="err">│</span><span class="w">  </span><span class="err">│</span><span class="w">                                                                  </span><span class="err">│</span><span class="w">   </span><span class="err">│</span>
<span class="err">│</span><span class="w">  </span><span class="err">└─────────────────────────────────────────────────────────────────┘</span><span class="w">   </span><span class="err">│</span>
<span class="err">│</span><span class="w">                                                                         </span><span class="err">│</span>
<span class="err">└─────────────────────────────────────────────────────────────────────────┘</span>
</code></pre></div>

<h3 id="23">2.3 시스템 아키텍처<a class="header-link" href="#23" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code>┌─────────────────────────────────────────────────────────────────────────┐
│                     채팅 시스템 아키텍처                                │
├─────────────────────────────────────────────────────────────────────────┤
│                                                                         │
│  ┌───────────────────────────────────────────────────────────────────┐ │
│  │                                                                   │ │
│  │  ┌──────────┐    ┌──────────┐    ┌──────────┐                    │ │
│  │  │ Client A │    │ Client B │    │ Client C │                    │ │
│  │  └────┬─────┘    └────┬─────┘    └────┬─────┘                    │ │
│  │       │ WebSocket     │ WebSocket     │ WebSocket                │ │
│  │       │               │               │                          │ │
│  │       ▼               ▼               ▼                          │ │
│  │  ┌─────────────────────────────────────────────────────────────┐ │ │
│  │  │                   Load Balancer                             │ │ │
│  │  │              (Sticky Sessions by user_id)                   │ │ │
│  │  └──────────────────────┬──────────────────────────────────────┘ │ │
│  │                         │                                        │ │
│  │       ┌─────────────────┼─────────────────┐                     │ │
│  │       ▼                 ▼                 ▼                     │ │
│  │  ┌────────────┐   ┌────────────┐   ┌────────────┐               │ │
│  │  │ Chat Srv 1 │   │ Chat Srv 2 │   │ Chat Srv 3 │               │ │
│  │  │ [A&#39;s conn] │   │ [B&#39;s conn] │   │ [C&#39;s conn] │               │ │
│  │  └─────┬──────┘   └─────┬──────┘   └─────┬──────┘               │ │
│  │        │                │                │                       │ │
│  │        └────────────────┼────────────────┘                       │ │
│  │                         │                                        │ │
│  │                         ▼                                        │ │
│  │  ┌─────────────────────────────────────────────────────────────┐ │ │
│  │  │              Message Broker (Redis Pub/Sub)                 │ │ │
│  │  │                                                             │ │ │
│  │  │  A sends to B:                                              │ │ │
│  │  │  1. Chat Srv 1 → PUBLISH chat:B &quot;msg from A&quot;               │ │ │
│  │  │  2. Chat Srv 2 ← SUBSCRIBE chat:B → deliver to B           │ │ │
│  │  │                                                             │ │ │
│  │  └─────────────────────────────────────────────────────────────┘ │ │
│  │                         │                                        │ │
│  │                         ▼                                        │ │
│  │  ┌─────────────────────────────────────────────────────────────┐ │ │
│  │  │               Message Store (Cassandra)                     │ │ │
│  │  │                                                             │ │ │
│  │  │  Partition Key: conversation_id                            │ │ │
│  │  │  Clustering Key: message_id (time-based)                   │ │ │
│  │  │                                                             │ │ │
│  │  └─────────────────────────────────────────────────────────────┘ │ │
│  │                                                                   │ │
│  └───────────────────────────────────────────────────────────────────┘ │
│                                                                         │
└─────────────────────────────────────────────────────────────────────────┘
</code></pre></div>

<h3 id="24">2.4 메시지 전송 흐름<a class="header-link" href="#24" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><span class="err">┌─────────────────────────────────────────────────────────────────────────┐</span>
<span class="err">│</span><span class="w">                     </span><span class="mi">1</span><span class="err">:</span><span class="mi">1</span><span class="w"> </span><span class="n">메시지</span><span class="w"> </span><span class="n">전송</span><span class="w">                                     </span><span class="err">│</span>
<span class="err">├─────────────────────────────────────────────────────────────────────────┤</span>
<span class="err">│</span><span class="w">                                                                         </span><span class="err">│</span>
<span class="err">│</span><span class="w">  </span><span class="k">User</span><span class="w"> </span><span class="n">A</span><span class="w"> </span><span class="err">→</span><span class="w"> </span><span class="k">User</span><span class="w"> </span><span class="n">B</span><span class="w"> </span><span class="n">메시지</span><span class="w"> </span><span class="nl">전송</span><span class="p">:</span><span class="w">                                          </span><span class="err">│</span>
<span class="err">│</span><span class="w">                                                                         </span><span class="err">│</span>
<span class="err">│</span><span class="w">  </span><span class="err">┌─────────────────────────────────────────────────────────────────┐</span><span class="w">   </span><span class="err">│</span>
<span class="err">│</span><span class="w">  </span><span class="err">│</span><span class="w">                                                                  </span><span class="err">│</span><span class="w">   </span><span class="err">│</span>
<span class="err">│</span><span class="w">  </span><span class="err">│</span><span class="w">  </span><span class="mf">1.</span><span class="w"> </span><span class="n">A</span><span class="w"> </span><span class="err">───</span><span class="w"> </span><span class="o">[</span><span class="n">msg</span><span class="o">]</span><span class="w"> </span><span class="err">───►</span><span class="w"> </span><span class="n">Chat</span><span class="w"> </span><span class="n">Server</span><span class="w"> </span><span class="mi">1</span><span class="w">                              </span><span class="err">│</span><span class="w">   </span><span class="err">│</span>
<span class="err">│</span><span class="w">  </span><span class="err">│</span><span class="w">                          </span><span class="err">│</span><span class="w">                                       </span><span class="err">│</span><span class="w">   </span><span class="err">│</span>
<span class="err">│</span><span class="w">  </span><span class="err">│</span><span class="w">  </span><span class="mf">2.</span><span class="w">                      </span><span class="err">▼</span><span class="w">                                       </span><span class="err">│</span><span class="w">   </span><span class="err">│</span>
<span class="err">│</span><span class="w">  </span><span class="err">│</span><span class="w">           </span><span class="err">┌─────────────────────────────┐</span><span class="w">                       </span><span class="err">│</span><span class="w">   </span><span class="err">│</span>
<span class="err">│</span><span class="w">  </span><span class="err">│</span><span class="w">           </span><span class="err">│</span><span class="w"> </span><span class="n">Message</span><span class="w"> </span><span class="n">Service</span><span class="w">             </span><span class="err">│</span><span class="w">                       </span><span class="err">│</span><span class="w">   </span><span class="err">│</span>
<span class="err">│</span><span class="w">  </span><span class="err">│</span><span class="w">           </span><span class="err">│</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">Generate</span><span class="w"> </span><span class="n">message_id</span><span class="w">       </span><span class="err">│</span><span class="w">                       </span><span class="err">│</span><span class="w">   </span><span class="err">│</span>
<span class="err">│</span><span class="w">  </span><span class="err">│</span><span class="w">           </span><span class="err">│</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">Validate</span><span class="w"> </span><span class="n">message</span><span class="w">          </span><span class="err">│</span><span class="w">                       </span><span class="err">│</span><span class="w">   </span><span class="err">│</span>
<span class="err">│</span><span class="w">  </span><span class="err">│</span><span class="w">           </span><span class="err">└─────────────┬───────────────┘</span><span class="w">                       </span><span class="err">│</span><span class="w">   </span><span class="err">│</span>
<span class="err">│</span><span class="w">  </span><span class="err">│</span><span class="w">                         </span><span class="err">│</span><span class="w">                                        </span><span class="err">│</span><span class="w">   </span><span class="err">│</span>
<span class="err">│</span><span class="w">  </span><span class="err">│</span><span class="w">  </span><span class="mf">3.</span><span class="w">                     </span><span class="err">│</span><span class="w">                                        </span><span class="err">│</span><span class="w">   </span><span class="err">│</span>
<span class="err">│</span><span class="w">  </span><span class="err">│</span><span class="w">           </span><span class="err">┌─────────────┼───────────────┐</span><span class="w">                       </span><span class="err">│</span><span class="w">   </span><span class="err">│</span>
<span class="err">│</span><span class="w">  </span><span class="err">│</span><span class="w">           </span><span class="err">│</span><span class="w">             </span><span class="err">│</span><span class="w">               </span><span class="err">│</span><span class="w">                       </span><span class="err">│</span><span class="w">   </span><span class="err">│</span>
<span class="err">│</span><span class="w">  </span><span class="err">│</span><span class="w">           </span><span class="err">▼</span><span class="w">             </span><span class="err">▼</span><span class="w">               </span><span class="err">▼</span><span class="w">                       </span><span class="err">│</span><span class="w">   </span><span class="err">│</span>
<span class="err">│</span><span class="w">  </span><span class="err">│</span><span class="w">     </span><span class="err">┌──────────┐</span><span class="w">  </span><span class="err">┌──────────┐</span><span class="w">   </span><span class="err">┌──────────────┐</span><span class="w">              </span><span class="err">│</span><span class="w">   </span><span class="err">│</span>
<span class="err">│</span><span class="w">  </span><span class="err">│</span><span class="w">     </span><span class="err">│</span><span class="w"> </span><span class="n">Store</span><span class="w">    </span><span class="err">│</span><span class="w">  </span><span class="err">│</span><span class="w"> </span><span class="n">Publish</span><span class="w">  </span><span class="err">│</span><span class="w">   </span><span class="err">│</span><span class="w"> </span><span class="k">Check</span><span class="w"> </span><span class="n">B</span><span class="w">      </span><span class="err">│</span><span class="w">              </span><span class="err">│</span><span class="w">   </span><span class="err">│</span>
<span class="err">│</span><span class="w">  </span><span class="err">│</span><span class="w">     </span><span class="err">│</span><span class="w"> </span><span class="k">to</span><span class="w"> </span><span class="n">DB</span><span class="w">    </span><span class="err">│</span><span class="w">  </span><span class="err">│</span><span class="w"> </span><span class="k">to</span><span class="w"> </span><span class="n">Kafka</span><span class="w"> </span><span class="err">│</span><span class="w">   </span><span class="err">│</span><span class="w"> </span><span class="n">online</span><span class="vm">?</span><span class="w">      </span><span class="err">│</span><span class="w">              </span><span class="err">│</span><span class="w">   </span><span class="err">│</span>
<span class="err">│</span><span class="w">  </span><span class="err">│</span><span class="w">     </span><span class="err">└──────────┘</span><span class="w">  </span><span class="err">└──────────┘</span><span class="w">   </span><span class="err">└──────┬───────┘</span><span class="w">              </span><span class="err">│</span><span class="w">   </span><span class="err">│</span>
<span class="err">│</span><span class="w">  </span><span class="err">│</span><span class="w">                                         </span><span class="err">│</span><span class="w">                       </span><span class="err">│</span><span class="w">   </span><span class="err">│</span>
<span class="err">│</span><span class="w">  </span><span class="err">│</span><span class="w">  </span><span class="mf">4.</span><span class="w">                              </span><span class="err">┌──────┴──────┐</span><span class="w">                </span><span class="err">│</span><span class="w">   </span><span class="err">│</span>
<span class="err">│</span><span class="w">  </span><span class="err">│</span><span class="w">                                  </span><span class="err">│</span><span class="w">             </span><span class="err">│</span><span class="w">                </span><span class="err">│</span><span class="w">   </span><span class="err">│</span>
<span class="err">│</span><span class="w">  </span><span class="err">│</span><span class="w">                               </span><span class="n">Online</span><span class="w">        </span><span class="n">Offline</span><span class="w">             </span><span class="err">│</span><span class="w">   </span><span class="err">│</span>
<span class="err">│</span><span class="w">  </span><span class="err">│</span><span class="w">                                  </span><span class="err">│</span><span class="w">             </span><span class="err">│</span><span class="w">                </span><span class="err">│</span><span class="w">   </span><span class="err">│</span>
<span class="err">│</span><span class="w">  </span><span class="err">│</span><span class="w">                                  </span><span class="err">▼</span><span class="w">             </span><span class="err">▼</span><span class="w">                </span><span class="err">│</span><span class="w">   </span><span class="err">│</span>
<span class="err">│</span><span class="w">  </span><span class="err">│</span><span class="w">                           </span><span class="err">┌──────────┐</span><span class="w">  </span><span class="err">┌──────────┐</span><span class="w">           </span><span class="err">│</span><span class="w">   </span><span class="err">│</span>
<span class="err">│</span><span class="w">  </span><span class="err">│</span><span class="w">                           </span><span class="err">│</span><span class="w"> </span><span class="n">Pub</span><span class="o">/</span><span class="n">Sub</span><span class="w">  </span><span class="err">│</span><span class="w">  </span><span class="err">│</span><span class="w">  </span><span class="n">Push</span><span class="w">    </span><span class="err">│</span><span class="w">           </span><span class="err">│</span><span class="w">   </span><span class="err">│</span>
<span class="err">│</span><span class="w">  </span><span class="err">│</span><span class="w">                           </span><span class="err">│</span><span class="w"> </span><span class="k">to</span><span class="w"> </span><span class="n">B</span><span class="w">     </span><span class="err">│</span><span class="w">  </span><span class="err">│</span><span class="w">  </span><span class="n">Queue</span><span class="w">   </span><span class="err">│</span><span class="w">           </span><span class="err">│</span><span class="w">   </span><span class="err">│</span>
<span class="err">│</span><span class="w">  </span><span class="err">│</span><span class="w">                           </span><span class="err">└────┬─────┘</span><span class="w">  </span><span class="err">└──────────┘</span><span class="w">           </span><span class="err">│</span><span class="w">   </span><span class="err">│</span>
<span class="err">│</span><span class="w">  </span><span class="err">│</span><span class="w">                                </span><span class="err">│</span><span class="w">                                </span><span class="err">│</span><span class="w">   </span><span class="err">│</span>
<span class="err">│</span><span class="w">  </span><span class="err">│</span><span class="w">  </span><span class="mf">5.</span><span class="w">                            </span><span class="err">▼</span><span class="w">                                </span><span class="err">│</span><span class="w">   </span><span class="err">│</span>
<span class="err">│</span><span class="w">  </span><span class="err">│</span><span class="w">                     </span><span class="n">Chat</span><span class="w"> </span><span class="n">Server</span><span class="w"> </span><span class="mi">2</span><span class="w"> </span><span class="err">───</span><span class="w"> </span><span class="o">[</span><span class="n">msg</span><span class="o">]</span><span class="w"> </span><span class="err">───►</span><span class="w"> </span><span class="n">B</span><span class="w">              </span><span class="err">│</span><span class="w">   </span><span class="err">│</span>
<span class="err">│</span><span class="w">  </span><span class="err">│</span><span class="w">                                                                  </span><span class="err">│</span><span class="w">   </span><span class="err">│</span>
<span class="err">│</span><span class="w">  </span><span class="err">│</span><span class="w">  </span><span class="mf">6.</span><span class="w"> </span><span class="n">A</span><span class="w"> </span><span class="err">◄───</span><span class="w"> </span><span class="o">[</span><span class="n">ack</span><span class="o">]</span><span class="w"> </span><span class="err">───</span><span class="w"> </span><span class="n">Chat</span><span class="w"> </span><span class="n">Server</span><span class="w"> </span><span class="mi">1</span><span class="w">                              </span><span class="err">│</span><span class="w">   </span><span class="err">│</span>
<span class="err">│</span><span class="w">  </span><span class="err">│</span><span class="w">                                                                  </span><span class="err">│</span><span class="w">   </span><span class="err">│</span>
<span class="err">│</span><span class="w">  </span><span class="err">└─────────────────────────────────────────────────────────────────┘</span><span class="w">   </span><span class="err">│</span>
<span class="err">│</span><span class="w">                                                                         </span><span class="err">│</span>
<span class="err">└─────────────────────────────────────────────────────────────────────────┘</span>
</code></pre></div>

<h3 id="25">2.5 그룹 채팅<a class="header-link" href="#25" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><span class="err">┌─────────────────────────────────────────────────────────────────────────┐</span>
<span class="err">│</span><span class="w">                     </span><span class="n">그룹</span><span class="w"> </span><span class="n">채팅</span><span class="w"> </span><span class="n">설계</span><span class="w">                                      </span><span class="err">│</span>
<span class="err">├─────────────────────────────────────────────────────────────────────────┤</span>
<span class="err">│</span><span class="w">                                                                         </span><span class="err">│</span>
<span class="err">│</span><span class="w">  </span><span class="n">그룹</span><span class="w"> </span><span class="n">메시지</span><span class="w"> </span><span class="nl">전송</span><span class="p">:</span><span class="w">                                                      </span><span class="err">│</span>
<span class="err">│</span><span class="w">  </span><span class="err">┌─────────────────────────────────────────────────────────────────┐</span><span class="w">   </span><span class="err">│</span>
<span class="err">│</span><span class="w">  </span><span class="err">│</span><span class="w">                                                                  </span><span class="err">│</span><span class="w">   </span><span class="err">│</span>
<span class="err">│</span><span class="w">  </span><span class="err">│</span><span class="w">  </span><span class="mf">1.</span><span class="w"> </span><span class="n">Sender</span><span class="w"> </span><span class="err">───</span><span class="w"> </span><span class="o">[</span><span class="n">msg</span><span class="o">]</span><span class="w"> </span><span class="err">───►</span><span class="w"> </span><span class="n">Message</span><span class="w"> </span><span class="n">Service</span><span class="w">                       </span><span class="err">│</span><span class="w">   </span><span class="err">│</span>
<span class="err">│</span><span class="w">  </span><span class="err">│</span><span class="w">                               </span><span class="err">│</span><span class="w">                                  </span><span class="err">│</span><span class="w">   </span><span class="err">│</span>
<span class="err">│</span><span class="w">  </span><span class="err">│</span><span class="w">  </span><span class="mf">2.</span><span class="w">                           </span><span class="err">▼</span><span class="w">                                  </span><span class="err">│</span><span class="w">   </span><span class="err">│</span>
<span class="err">│</span><span class="w">  </span><span class="err">│</span><span class="w">                    </span><span class="k">Get</span><span class="w"> </span><span class="k">group</span><span class="w"> </span><span class="n">members</span><span class="w"> </span><span class="p">(</span><span class="mi">100</span><span class="n">명</span><span class="p">)</span><span class="w">                    </span><span class="err">│</span><span class="w">   </span><span class="err">│</span>
<span class="err">│</span><span class="w">  </span><span class="err">│</span><span class="w">                               </span><span class="err">│</span><span class="w">                                  </span><span class="err">│</span><span class="w">   </span><span class="err">│</span>
<span class="err">│</span><span class="w">  </span><span class="err">│</span><span class="w">  </span><span class="mf">3.</span><span class="w">                           </span><span class="err">▼</span><span class="w">                                  </span><span class="err">│</span><span class="w">   </span><span class="err">│</span>
<span class="err">│</span><span class="w">  </span><span class="err">│</span><span class="w">              </span><span class="err">┌────────────────┼────────────────┐</span><span class="w">                </span><span class="err">│</span><span class="w">   </span><span class="err">│</span>
<span class="err">│</span><span class="w">  </span><span class="err">│</span><span class="w">              </span><span class="err">│</span><span class="w">                </span><span class="err">│</span><span class="w">                </span><span class="err">│</span><span class="w">                </span><span class="err">│</span><span class="w">   </span><span class="err">│</span>
<span class="err">│</span><span class="w">  </span><span class="err">│</span><span class="w">              </span><span class="err">▼</span><span class="w">                </span><span class="err">▼</span><span class="w">                </span><span class="err">▼</span><span class="w">                </span><span class="err">│</span><span class="w">   </span><span class="err">│</span>
<span class="err">│</span><span class="w">  </span><span class="err">│</span><span class="w">         </span><span class="o">[</span><span class="n">Online 60명</span><span class="o">]</span><span class="w">   </span><span class="o">[</span><span class="n">Online 30명</span><span class="o">]</span><span class="w">   </span><span class="o">[</span><span class="n">Offline 10명</span><span class="o">]</span><span class="w">         </span><span class="err">│</span><span class="w">   </span><span class="err">│</span>
<span class="err">│</span><span class="w">  </span><span class="err">│</span><span class="w">              </span><span class="err">│</span><span class="w">                </span><span class="err">│</span><span class="w">                </span><span class="err">│</span><span class="w">                </span><span class="err">│</span><span class="w">   </span><span class="err">│</span>
<span class="err">│</span><span class="w">  </span><span class="err">│</span><span class="w">              </span><span class="err">▼</span><span class="w">                </span><span class="err">▼</span><span class="w">                </span><span class="err">▼</span><span class="w">                </span><span class="err">│</span><span class="w">   </span><span class="err">│</span>
<span class="err">│</span><span class="w">  </span><span class="err">│</span><span class="w">         </span><span class="n">Pub</span><span class="o">/</span><span class="n">Sub</span><span class="w">          </span><span class="n">Pub</span><span class="o">/</span><span class="n">Sub</span><span class="w">         </span><span class="n">Push</span><span class="w"> </span><span class="n">Queue</span><span class="w">            </span><span class="err">│</span><span class="w">   </span><span class="err">│</span>
<span class="err">│</span><span class="w">  </span><span class="err">│</span><span class="w">         </span><span class="p">(</span><span class="n">batch</span><span class="p">)</span><span class="w">          </span><span class="p">(</span><span class="n">batch</span><span class="p">)</span><span class="w">                                </span><span class="err">│</span><span class="w">   </span><span class="err">│</span>
<span class="err">│</span><span class="w">  </span><span class="err">│</span><span class="w">                                                                  </span><span class="err">│</span><span class="w">   </span><span class="err">│</span>
<span class="err">│</span><span class="w">  </span><span class="err">└─────────────────────────────────────────────────────────────────┘</span><span class="w">   </span><span class="err">│</span>
<span class="err">│</span><span class="w">                                                                         </span><span class="err">│</span>
<span class="err">│</span><span class="w">  </span><span class="nl">최적화</span><span class="p">:</span><span class="w">                                                                </span><span class="err">│</span>
<span class="err">│</span><span class="w">  </span><span class="err">┌─────────────────────────────────────────────────────────────────┐</span><span class="w">   </span><span class="err">│</span>
<span class="err">│</span><span class="w">  </span><span class="err">│</span><span class="w">                                                                  </span><span class="err">│</span><span class="w">   </span><span class="err">│</span>
<span class="err">│</span><span class="w">  </span><span class="err">│</span><span class="w">  </span><span class="mf">1.</span><span class="w"> </span><span class="n">온라인</span><span class="w"> </span><span class="n">멤버</span><span class="w"> </span><span class="n">우선</span><span class="w"> </span><span class="n">전송</span><span class="w">                                        </span><span class="err">│</span><span class="w">   </span><span class="err">│</span>
<span class="err">│</span><span class="w">  </span><span class="err">│</span><span class="w">  </span><span class="mf">2.</span><span class="w"> </span><span class="n">배치</span><span class="w"> </span><span class="n">처리</span><span class="w"> </span><span class="p">(</span><span class="n">한</span><span class="w"> </span><span class="n">번에</span><span class="w"> </span><span class="n">여러</span><span class="w"> </span><span class="n">멤버</span><span class="p">)</span><span class="w">                                </span><span class="err">│</span><span class="w">   </span><span class="err">│</span>
<span class="err">│</span><span class="w">  </span><span class="err">│</span><span class="w">  </span><span class="mf">3.</span><span class="w"> </span><span class="n">읽음</span><span class="w"> </span><span class="n">확인은</span><span class="w"> </span><span class="n">샘플링</span><span class="w"> </span><span class="p">(</span><span class="n">전체</span><span class="w"> </span><span class="n">X</span><span class="p">)</span><span class="w">                                  </span><span class="err">│</span><span class="w">   </span><span class="err">│</span>
<span class="err">│</span><span class="w">  </span><span class="err">│</span><span class="w">  </span><span class="mf">4.</span><span class="w"> </span><span class="n">대형</span><span class="w"> </span><span class="nl">그룹</span><span class="p">:</span><span class="w"> </span><span class="n">클라이언트</span><span class="w"> </span><span class="n">Pull</span><span class="w"> </span><span class="n">방식</span><span class="w"> </span><span class="n">고려</span><span class="w">                         </span><span class="err">│</span><span class="w">   </span><span class="err">│</span>
<span class="err">│</span><span class="w">  </span><span class="err">│</span><span class="w">                                                                  </span><span class="err">│</span><span class="w">   </span><span class="err">│</span>
<span class="err">│</span><span class="w">  </span><span class="err">└─────────────────────────────────────────────────────────────────┘</span><span class="w">   </span><span class="err">│</span>
<span class="err">│</span><span class="w">                                                                         </span><span class="err">│</span>
<span class="err">└─────────────────────────────────────────────────────────────────────────┘</span>
</code></pre></div>

<h3 id="26">2.6 온라인 상태 관리<a class="header-link" href="#26" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code>┌─────────────────────────────────────────────────────────────────────────┐
│                     온라인 상태 (Presence)                              │
├─────────────────────────────────────────────────────────────────────────┤
│                                                                         │
│  상태 종류:                                                             │
│  - Online: 현재 연결됨                                                  │
│  - Offline: 연결 없음                                                   │
│  - Away: 연결됐지만 비활성                                              │
│  - Last Seen: 마지막 접속 시간                                          │
│                                                                         │
│  구현:                                                                  │
│  ┌─────────────────────────────────────────────────────────────────┐   │
│  │                                                                  │   │
│  │  1. Heartbeat 기반                                               │   │
│  │                                                                  │   │
│  │  Client ─── heartbeat (30초마다) ───► Server                    │   │
│  │                                          │                       │   │
│  │                                          ▼                       │   │
│  │                              Redis: SET presence:user123 &quot;online&quot;│   │
│  │                                     EXPIRE presence:user123 60   │   │
│  │                                                                  │   │
│  │  60초간 heartbeat 없으면 → 키 만료 → Offline                    │   │
│  │                                                                  │   │
│  └─────────────────────────────────────────────────────────────────┘   │
│                                                                         │
│  상태 전파:                                                             │
│  ┌─────────────────────────────────────────────────────────────────┐   │
│  │                                                                  │   │
│  │  User A의 상태 변경 시:                                          │   │
│  │                                                                  │   │
│  │  1. A의 친구 목록 조회                                           │   │
│  │  2. 현재 온라인인 친구만 필터링                                  │   │
│  │  3. 해당 친구들에게 상태 변경 푸시                               │   │
│  │                                                                  │   │
│  │  최적화:                                                         │   │
│  │  - 친구가 많으면 배치 처리                                       │   │
│  │  - 빈번한 변경 방지 (debounce)                                   │   │
│  │  - 활성 대화창의 상대방에게만 우선 전파                          │   │
│  │                                                                  │   │
│  └─────────────────────────────────────────────────────────────────┘   │
│                                                                         │
└─────────────────────────────────────────────────────────────────────────┘
</code></pre></div>

<h3 id="27">2.7 메시지 저장<a class="header-link" href="#27" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><span class="err">┌─────────────────────────────────────────────────────────────────────────┐</span>
<span class="err">│</span><span class="w">                     </span><span class="nx">메시지</span><span class="w"> </span><span class="nx">DB</span><span class="w"> </span><span class="nx">스키마</span><span class="w"> </span><span class="p">(</span><span class="nx">Cassandra</span><span class="p">)</span><span class="w">                        </span><span class="err">│</span>
<span class="err">├─────────────────────────────────────────────────────────────────────────┤</span>
<span class="err">│</span><span class="w">                                                                         </span><span class="err">│</span>
<span class="err">│</span><span class="w">  </span><span class="nx">messages</span><span class="w"> </span><span class="nx">테이블</span><span class="p">:</span><span class="w">                                                       </span><span class="err">│</span>
<span class="err">│</span><span class="w">  </span><span class="err">┌─────────────────────────────────────────────────────────────────┐</span><span class="w">   </span><span class="err">│</span>
<span class="err">│</span><span class="w">  </span><span class="err">│</span><span class="w">                                                                  </span><span class="err">│</span><span class="w">   </span><span class="err">│</span>
<span class="err">│</span><span class="w">  </span><span class="err">│</span><span class="w">  </span><span class="nx">CREATE</span><span class="w"> </span><span class="nx">TABLE</span><span class="w"> </span><span class="nx">messages</span><span class="w"> </span><span class="p">(</span><span class="w">                                        </span><span class="err">│</span><span class="w">   </span><span class="err">│</span>
<span class="err">│</span><span class="w">  </span><span class="err">│</span><span class="w">      </span><span class="nx">conversation_id</span><span class="w"> </span><span class="nx">UUID</span><span class="p">,</span><span class="w">         </span><span class="o">--</span><span class="w"> </span><span class="nx">대화방</span><span class="w"> </span><span class="nx">ID</span><span class="w">                 </span><span class="err">│</span><span class="w">   </span><span class="err">│</span>
<span class="err">│</span><span class="w">  </span><span class="err">│</span><span class="w">      </span><span class="nx">message_id</span><span class="w"> </span><span class="nx">TIMEUUID</span><span class="p">,</span><span class="w">          </span><span class="o">--</span><span class="w"> </span><span class="nx">시간</span><span class="w"> </span><span class="nx">기반</span><span class="w"> </span><span class="nx">UUID</span><span class="w">            </span><span class="err">│</span><span class="w">   </span><span class="err">│</span>
<span class="err">│</span><span class="w">  </span><span class="err">│</span><span class="w">      </span><span class="nx">sender_id</span><span class="w"> </span><span class="nx">UUID</span><span class="p">,</span><span class="w">               </span><span class="o">--</span><span class="w"> </span><span class="nx">발신자</span><span class="w">                     </span><span class="err">│</span><span class="w">   </span><span class="err">│</span>
<span class="err">│</span><span class="w">  </span><span class="err">│</span><span class="w">      </span><span class="nx">content</span><span class="w"> </span><span class="nx">TEXT</span><span class="p">,</span><span class="w">                 </span><span class="o">--</span><span class="w"> </span><span class="nx">메시지</span><span class="w"> </span><span class="nx">내용</span><span class="w">               </span><span class="err">│</span><span class="w">   </span><span class="err">│</span>
<span class="err">│</span><span class="w">  </span><span class="err">│</span><span class="w">      </span><span class="nx">content_type</span><span class="w"> </span><span class="nx">TEXT</span><span class="p">,</span><span class="w">            </span><span class="o">--</span><span class="w"> </span><span class="nx">text</span><span class="p">,</span><span class="w"> </span><span class="nx">image</span><span class="p">,</span><span class="w"> </span><span class="nx">file</span><span class="w">         </span><span class="err">│</span><span class="w">   </span><span class="err">│</span>
<span class="err">│</span><span class="w">  </span><span class="err">│</span><span class="w">      </span><span class="nx">created_at</span><span class="w"> </span><span class="nx">TIMESTAMP</span><span class="p">,</span><span class="w">         </span><span class="o">--</span><span class="w"> </span><span class="nx">생성</span><span class="w"> </span><span class="nx">시간</span><span class="w">                 </span><span class="err">│</span><span class="w">   </span><span class="err">│</span>
<span class="err">│</span><span class="w">  </span><span class="err">│</span><span class="w">      </span><span class="nx">PRIMARY</span><span class="w"> </span><span class="nx">KEY</span><span class="w"> </span><span class="p">(</span><span class="nx">conversation_id</span><span class="p">,</span><span class="w"> </span><span class="nx">message_id</span><span class="p">)</span><span class="w">                  </span><span class="err">│</span><span class="w">   </span><span class="err">│</span>
<span class="err">│</span><span class="w">  </span><span class="err">│</span><span class="w">  </span><span class="p">)</span><span class="w"> </span><span class="nx">WITH</span><span class="w"> </span><span class="nx">CLUSTERING</span><span class="w"> </span><span class="nx">ORDER</span><span class="w"> </span><span class="nx">BY</span><span class="w"> </span><span class="p">(</span><span class="nx">message_id</span><span class="w"> </span><span class="nx">DESC</span><span class="p">);</span><span class="w">                  </span><span class="err">│</span><span class="w">   </span><span class="err">│</span>
<span class="err">│</span><span class="w">  </span><span class="err">│</span><span class="w">                                                                  </span><span class="err">│</span><span class="w">   </span><span class="err">│</span>
<span class="err">│</span><span class="w">  </span><span class="err">│</span><span class="w">  </span><span class="o">--</span><span class="w"> </span><span class="nx">최신</span><span class="w"> </span><span class="nx">메시지부터</span><span class="w"> </span><span class="nx">정렬</span><span class="w">                                         </span><span class="err">│</span><span class="w">   </span><span class="err">│</span>
<span class="err">│</span><span class="w">  </span><span class="err">│</span><span class="w">  </span><span class="o">--</span><span class="w"> </span><span class="nx">대화방별</span><span class="w"> </span><span class="nx">파티셔닝</span><span class="w"> </span><span class="p">(</span><span class="nx">핫</span><span class="w"> </span><span class="nx">파티션</span><span class="w"> </span><span class="nx">주의</span><span class="p">)</span><span class="w">                           </span><span class="err">│</span><span class="w">   </span><span class="err">│</span>
<span class="err">│</span><span class="w">  </span><span class="err">│</span><span class="w">                                                                  </span><span class="err">│</span><span class="w">   </span><span class="err">│</span>
<span class="err">│</span><span class="w">  </span><span class="err">└─────────────────────────────────────────────────────────────────┘</span><span class="w">   </span><span class="err">│</span>
<span class="err">│</span><span class="w">                                                                         </span><span class="err">│</span>
<span class="err">│</span><span class="w">  </span><span class="nx">conversations</span><span class="w"> </span><span class="nx">테이블</span><span class="p">:</span><span class="w">                                                  </span><span class="err">│</span>
<span class="err">│</span><span class="w">  </span><span class="err">┌─────────────────────────────────────────────────────────────────┐</span><span class="w">   </span><span class="err">│</span>
<span class="err">│</span><span class="w">  </span><span class="err">│</span><span class="w">                                                                  </span><span class="err">│</span><span class="w">   </span><span class="err">│</span>
<span class="err">│</span><span class="w">  </span><span class="err">│</span><span class="w">  </span><span class="nx">CREATE</span><span class="w"> </span><span class="nx">TABLE</span><span class="w"> </span><span class="nx">user_conversations</span><span class="w"> </span><span class="p">(</span><span class="w">                              </span><span class="err">│</span><span class="w">   </span><span class="err">│</span>
<span class="err">│</span><span class="w">  </span><span class="err">│</span><span class="w">      </span><span class="nx">user_id</span><span class="w"> </span><span class="nx">UUID</span><span class="p">,</span><span class="w">                                              </span><span class="err">│</span><span class="w">   </span><span class="err">│</span>
<span class="err">│</span><span class="w">  </span><span class="err">│</span><span class="w">      </span><span class="nx">last_message_at</span><span class="w"> </span><span class="nx">TIMESTAMP</span><span class="p">,</span><span class="w">    </span><span class="o">--</span><span class="w"> </span><span class="nx">정렬용</span><span class="w">                    </span><span class="err">│</span><span class="w">   </span><span class="err">│</span>
<span class="err">│</span><span class="w">  </span><span class="err">│</span><span class="w">      </span><span class="nx">conversation_id</span><span class="w"> </span><span class="nx">UUID</span><span class="p">,</span><span class="w">                                      </span><span class="err">│</span><span class="w">   </span><span class="err">│</span>
<span class="err">│</span><span class="w">  </span><span class="err">│</span><span class="w">      </span><span class="nx">conversation_type</span><span class="w"> </span><span class="nx">TEXT</span><span class="p">,</span><span class="w">       </span><span class="o">--</span><span class="w"> </span><span class="nx">dm</span><span class="p">,</span><span class="w"> </span><span class="nx">group</span><span class="w">                 </span><span class="err">│</span><span class="w">   </span><span class="err">│</span>
<span class="err">│</span><span class="w">  </span><span class="err">│</span><span class="w">      </span><span class="nx">unread_count</span><span class="w"> </span><span class="nx">INT</span><span class="p">,</span><span class="w">             </span><span class="o">--</span><span class="w"> </span><span class="nx">읽지</span><span class="w"> </span><span class="nx">않은</span><span class="w"> </span><span class="nx">메시지</span><span class="w">          </span><span class="err">│</span><span class="w">   </span><span class="err">│</span>
<span class="err">│</span><span class="w">  </span><span class="err">│</span><span class="w">      </span><span class="nx">PRIMARY</span><span class="w"> </span><span class="nx">KEY</span><span class="w"> </span><span class="p">(</span><span class="nx">user_id</span><span class="p">,</span><span class="w"> </span><span class="nx">last_message_at</span><span class="p">,</span><span class="w"> </span><span class="nx">conversation_id</span><span class="p">)</span><span class="w">    </span><span class="err">│</span><span class="w">   </span><span class="err">│</span>
<span class="err">│</span><span class="w">  </span><span class="err">│</span><span class="w">  </span><span class="p">)</span><span class="w"> </span><span class="nx">WITH</span><span class="w"> </span><span class="nx">CLUSTERING</span><span class="w"> </span><span class="nx">ORDER</span><span class="w"> </span><span class="nx">BY</span><span class="w"> </span><span class="p">(</span><span class="nx">last_message_at</span><span class="w"> </span><span class="nx">DESC</span><span class="p">);</span><span class="w">             </span><span class="err">│</span><span class="w">   </span><span class="err">│</span>
<span class="err">│</span><span class="w">  </span><span class="err">│</span><span class="w">                                                                  </span><span class="err">│</span><span class="w">   </span><span class="err">│</span>
<span class="err">│</span><span class="w">  </span><span class="err">│</span><span class="w">  </span><span class="o">--</span><span class="w"> </span><span class="nx">사용자별</span><span class="w"> </span><span class="nx">대화</span><span class="w"> </span><span class="nx">목록</span><span class="w"> </span><span class="nx">조회</span><span class="w">                                      </span><span class="err">│</span><span class="w">   </span><span class="err">│</span>
<span class="err">│</span><span class="w">  </span><span class="err">│</span><span class="w">                                                                  </span><span class="err">│</span><span class="w">   </span><span class="err">│</span>
<span class="err">│</span><span class="w">  </span><span class="err">└─────────────────────────────────────────────────────────────────┘</span><span class="w">   </span><span class="err">│</span>
<span class="err">│</span><span class="w">                                                                         </span><span class="err">│</span>
<span class="err">└─────────────────────────────────────────────────────────────────────────┘</span>
</code></pre></div>

<hr />
<h2 id="3">3. 알림 시스템<a class="header-link" href="#3" title="Permanent link">&para;</a></h2>
<h3 id="31">3.1 요구사항 정의<a class="header-link" href="#31" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code>┌─────────────────────────────────────────────────────────────────────────┐
│                     기능 요구사항                                       │
├─────────────────────────────────────────────────────────────────────────┤
│                                                                         │
│  알림 채널:                                                             │
│  1. iOS 푸시 (APNs)                                                    │
│  2. Android 푸시 (FCM)                                                 │
│  3. SMS                                                                │
│  4. Email                                                              │
│                                                                         │
│  기능:                                                                  │
│  5. 알림 템플릿                                                         │
│  6. 사용자별 알림 설정                                                  │
│  7. 스케줄 알림                                                         │
│  8. 알림 히스토리                                                       │
│                                                                         │
├─────────────────────────────────────────────────────────────────────────┤
│                     비기능 요구사항                                     │
├─────────────────────────────────────────────────────────────────────────┤
│                                                                         │
│  - 일간 알림: 10B (100억)                                               │
│  - Soft real-time: 수 초 내 전송                                        │
│  - 중복 방지                                                            │
│  - 우선순위 지원                                                        │
│                                                                         │
└─────────────────────────────────────────────────────────────────────────┘
</code></pre></div>

<h3 id="32">3.2 시스템 아키텍처<a class="header-link" href="#32" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code>┌─────────────────────────────────────────────────────────────────────────┐
│                     알림 시스템 아키텍처                                │
├─────────────────────────────────────────────────────────────────────────┤
│                                                                         │
│  ┌───────────────────────────────────────────────────────────────────┐ │
│  │                                                                   │ │
│  │  ┌─────────────────────────────────────────────────────────────┐ │ │
│  │  │                    Event Sources                            │ │ │
│  │  │  ┌────────┐ ┌────────┐ ┌────────┐ ┌────────┐              │ │ │
│  │  │  │Order   │ │Payment │ │Social  │ │Schedule│              │ │ │
│  │  │  │Service │ │Service │ │Service │ │Service │              │ │ │
│  │  │  └───┬────┘ └───┬────┘ └───┬────┘ └───┬────┘              │ │ │
│  │  │      │          │          │          │                    │ │ │
│  │  └──────┼──────────┼──────────┼──────────┼────────────────────┘ │ │
│  │         │          │          │          │                      │ │
│  │         └──────────┴──────────┴──────────┘                      │ │
│  │                         │                                        │ │
│  │                         ▼                                        │ │
│  │  ┌─────────────────────────────────────────────────────────────┐ │ │
│  │  │                 Notification Service                        │ │ │
│  │  │  ┌──────────────────────────────────────────────────────┐  │ │ │
│  │  │  │ 1. Validation                                         │  │ │ │
│  │  │  │ 2. User Preferences Check                             │  │ │ │
│  │  │  │ 3. Rate Limiting                                      │  │ │ │
│  │  │  │ 4. Template Rendering                                 │  │ │ │
│  │  │  │ 5. Priority Assignment                                │  │ │ │
│  │  │  └──────────────────────────────────────────────────────┘  │ │ │
│  │  └──────────────────────┬──────────────────────────────────────┘ │ │
│  │                         │                                        │ │
│  │                         ▼                                        │ │
│  │  ┌─────────────────────────────────────────────────────────────┐ │ │
│  │  │              Message Queues (Priority-based)                │ │ │
│  │  │  ┌─────────────┐ ┌─────────────┐ ┌─────────────┐           │ │ │
│  │  │  │ High Queue  │ │ Medium Queue│ │ Low Queue   │           │ │ │
│  │  │  └──────┬──────┘ └──────┬──────┘ └──────┬──────┘           │ │ │
│  │  └─────────┼───────────────┼───────────────┼───────────────────┘ │ │
│  │            │               │               │                     │ │
│  │            ▼               ▼               ▼                     │ │
│  │  ┌─────────────────────────────────────────────────────────────┐ │ │
│  │  │                     Workers                                 │ │ │
│  │  │  ┌────────┐ ┌────────┐ ┌────────┐ ┌────────┐              │ │ │
│  │  │  │  iOS   │ │Android │ │  SMS   │ │ Email  │              │ │ │
│  │  │  │ Worker │ │ Worker │ │ Worker │ │ Worker │              │ │ │
│  │  │  └───┬────┘ └───┬────┘ └───┬────┘ └───┬────┘              │ │ │
│  │  └──────┼──────────┼──────────┼──────────┼─────────────────────┘ │ │
│  │         │          │          │          │                       │ │
│  │         ▼          ▼          ▼          ▼                       │ │
│  │      ┌──────┐  ┌──────┐  ┌──────┐  ┌──────┐                     │ │
│  │      │ APNs │  │ FCM  │  │Twilio│  │ SES  │                     │ │
│  │      └──────┘  └──────┘  └──────┘  └──────┘                     │ │
│  │                                                                   │ │
│  └───────────────────────────────────────────────────────────────────┘ │
│                                                                         │
└─────────────────────────────────────────────────────────────────────────┘
</code></pre></div>

<h3 id="33">3.3 알림 흐름<a class="header-link" href="#33" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><span class="err">┌─────────────────────────────────────────────────────────────────────────┐</span>
<span class="err">│</span><span class="w">                     </span><span class="nx">알림</span><span class="w"> </span><span class="nx">전송</span><span class="w"> </span><span class="nx">흐름</span><span class="w">                                      </span><span class="err">│</span>
<span class="err">├─────────────────────────────────────────────────────────────────────────┤</span>
<span class="err">│</span><span class="w">                                                                         </span><span class="err">│</span>
<span class="err">│</span><span class="w">  </span><span class="err">┌─────────────────────────────────────────────────────────────────┐</span><span class="w">   </span><span class="err">│</span>
<span class="err">│</span><span class="w">  </span><span class="err">│</span><span class="w">                                                                  </span><span class="err">│</span><span class="w">   </span><span class="err">│</span>
<span class="err">│</span><span class="w">  </span><span class="err">│</span><span class="w">  </span><span class="mi">1</span><span class="p">.</span><span class="w"> </span><span class="nx">이벤트</span><span class="w"> </span><span class="nx">수신</span><span class="w">                                                  </span><span class="err">│</span><span class="w">   </span><span class="err">│</span>
<span class="err">│</span><span class="w">  </span><span class="err">│</span><span class="w">  </span><span class="err">─────────────</span><span class="w">                                                   </span><span class="err">│</span><span class="w">   </span><span class="err">│</span>
<span class="err">│</span><span class="w">  </span><span class="err">│</span><span class="w">  </span><span class="p">{</span><span class="w">                                                               </span><span class="err">│</span><span class="w">   </span><span class="err">│</span>
<span class="err">│</span><span class="w">  </span><span class="err">│</span><span class="w">    </span><span class="s">&quot;event_type&quot;</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;order_shipped&quot;</span><span class="p">,</span><span class="w">                               </span><span class="err">│</span><span class="w">   </span><span class="err">│</span>
<span class="err">│</span><span class="w">  </span><span class="err">│</span><span class="w">    </span><span class="s">&quot;user_id&quot;</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;user123&quot;</span><span class="p">,</span><span class="w">                                        </span><span class="err">│</span><span class="w">   </span><span class="err">│</span>
<span class="err">│</span><span class="w">  </span><span class="err">│</span><span class="w">    </span><span class="s">&quot;data&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="s">&quot;order_id&quot;</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;ORD456&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;tracking&quot;</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;...&quot;</span><span class="w"> </span><span class="p">}</span><span class="w">          </span><span class="err">│</span><span class="w">   </span><span class="err">│</span>
<span class="err">│</span><span class="w">  </span><span class="err">│</span><span class="w">  </span><span class="p">}</span><span class="w">                                                               </span><span class="err">│</span><span class="w">   </span><span class="err">│</span>
<span class="err">│</span><span class="w">  </span><span class="err">│</span><span class="w">                                                                  </span><span class="err">│</span><span class="w">   </span><span class="err">│</span>
<span class="err">│</span><span class="w">  </span><span class="err">│</span><span class="w">  </span><span class="mi">2</span><span class="p">.</span><span class="w"> </span><span class="nx">사용자</span><span class="w"> </span><span class="nx">설정</span><span class="w"> </span><span class="nx">확인</span><span class="w">                                             </span><span class="err">│</span><span class="w">   </span><span class="err">│</span>
<span class="err">│</span><span class="w">  </span><span class="err">│</span><span class="w">  </span><span class="err">─────────────────</span><span class="w">                                               </span><span class="err">│</span><span class="w">   </span><span class="err">│</span>
<span class="err">│</span><span class="w">  </span><span class="err">│</span><span class="w">  </span><span class="nx">SELECT</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">FROM</span><span class="w"> </span><span class="nx">user_notification_settings</span><span class="w">                       </span><span class="err">│</span><span class="w">   </span><span class="err">│</span>
<span class="err">│</span><span class="w">  </span><span class="err">│</span><span class="w">  </span><span class="nx">WHERE</span><span class="w"> </span><span class="nx">user_id</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="err">&#39;</span><span class="nx">user123</span><span class="err">&#39;</span><span class="p">;</span><span class="w">                                     </span><span class="err">│</span><span class="w">   </span><span class="err">│</span>
<span class="err">│</span><span class="w">  </span><span class="err">│</span><span class="w">                                                                  </span><span class="err">│</span><span class="w">   </span><span class="err">│</span>
<span class="err">│</span><span class="w">  </span><span class="err">│</span><span class="w">  </span><span class="err">→</span><span class="w"> </span><span class="nx">push</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span><span class="p">,</span><span class="w"> </span><span class="nx">email</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span><span class="p">,</span><span class="w"> </span><span class="nx">sms</span><span class="p">:</span><span class="w"> </span><span class="kc">false</span><span class="w">                          </span><span class="err">│</span><span class="w">   </span><span class="err">│</span>
<span class="err">│</span><span class="w">  </span><span class="err">│</span><span class="w">                                                                  </span><span class="err">│</span><span class="w">   </span><span class="err">│</span>
<span class="err">│</span><span class="w">  </span><span class="err">│</span><span class="w">  </span><span class="mi">3</span><span class="p">.</span><span class="w"> </span><span class="nx">디바이스</span><span class="w"> </span><span class="nx">토큰</span><span class="w"> </span><span class="nx">조회</span><span class="w">                                           </span><span class="err">│</span><span class="w">   </span><span class="err">│</span>
<span class="err">│</span><span class="w">  </span><span class="err">│</span><span class="w">  </span><span class="err">─────────────────</span><span class="w">                                               </span><span class="err">│</span><span class="w">   </span><span class="err">│</span>
<span class="err">│</span><span class="w">  </span><span class="err">│</span><span class="w">  </span><span class="nx">SELECT</span><span class="w"> </span><span class="nx">device_token</span><span class="p">,</span><span class="w"> </span><span class="nx">platform</span><span class="w">                                  </span><span class="err">│</span><span class="w">   </span><span class="err">│</span>
<span class="err">│</span><span class="w">  </span><span class="err">│</span><span class="w">  </span><span class="nx">FROM</span><span class="w"> </span><span class="nx">user_devices</span><span class="w"> </span><span class="nx">WHERE</span><span class="w"> </span><span class="nx">user_id</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="err">&#39;</span><span class="nx">user123</span><span class="err">&#39;</span><span class="p">;</span><span class="w">                   </span><span class="err">│</span><span class="w">   </span><span class="err">│</span>
<span class="err">│</span><span class="w">  </span><span class="err">│</span><span class="w">                                                                  </span><span class="err">│</span><span class="w">   </span><span class="err">│</span>
<span class="err">│</span><span class="w">  </span><span class="err">│</span><span class="w">  </span><span class="err">→</span><span class="w"> </span><span class="p">[{</span><span class="w"> </span><span class="nx">token</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;abc...&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">platform</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;ios&quot;</span><span class="w"> </span><span class="p">},</span><span class="w">                       </span><span class="err">│</span><span class="w">   </span><span class="err">│</span>
<span class="err">│</span><span class="w">  </span><span class="err">│</span><span class="w">      </span><span class="p">{</span><span class="w"> </span><span class="nx">token</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;def...&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">platform</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;android&quot;</span><span class="w"> </span><span class="p">}]</span><span class="w">                  </span><span class="err">│</span><span class="w">   </span><span class="err">│</span>
<span class="err">│</span><span class="w">  </span><span class="err">│</span><span class="w">                                                                  </span><span class="err">│</span><span class="w">   </span><span class="err">│</span>
<span class="err">│</span><span class="w">  </span><span class="err">│</span><span class="w">  </span><span class="mi">4</span><span class="p">.</span><span class="w"> </span><span class="nx">템플릿</span><span class="w"> </span><span class="nx">렌더링</span><span class="w">                                                </span><span class="err">│</span><span class="w">   </span><span class="err">│</span>
<span class="err">│</span><span class="w">  </span><span class="err">│</span><span class="w">  </span><span class="err">─────────────────</span><span class="w">                                               </span><span class="err">│</span><span class="w">   </span><span class="err">│</span>
<span class="err">│</span><span class="w">  </span><span class="err">│</span><span class="w">  </span><span class="nx">Template</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;Your order {order_id} has been shipped!&quot;</span><span class="w">            </span><span class="err">│</span><span class="w">   </span><span class="err">│</span>
<span class="err">│</span><span class="w">  </span><span class="err">│</span><span class="w">  </span><span class="nx">Result</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;Your order ORD456 has been shipped!&quot;</span><span class="w">                  </span><span class="err">│</span><span class="w">   </span><span class="err">│</span>
<span class="err">│</span><span class="w">  </span><span class="err">│</span><span class="w">                                                                  </span><span class="err">│</span><span class="w">   </span><span class="err">│</span>
<span class="err">│</span><span class="w">  </span><span class="err">│</span><span class="w">  </span><span class="mi">5</span><span class="p">.</span><span class="w"> </span><span class="nx">중복</span><span class="w"> </span><span class="nx">체크</span><span class="w">                                                    </span><span class="err">│</span><span class="w">   </span><span class="err">│</span>
<span class="err">│</span><span class="w">  </span><span class="err">│</span><span class="w">  </span><span class="err">─────────────────</span><span class="w">                                               </span><span class="err">│</span><span class="w">   </span><span class="err">│</span>
<span class="err">│</span><span class="w">  </span><span class="err">│</span><span class="w">  </span><span class="nx">Redis</span><span class="w"> </span><span class="nx">SETNX</span><span class="w"> </span><span class="nx">dedup</span><span class="p">:{</span><span class="nx">event_hash</span><span class="p">}</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="nx">EX</span><span class="w"> </span><span class="mi">86400</span><span class="w">                      </span><span class="err">│</span><span class="w">   </span><span class="err">│</span>
<span class="err">│</span><span class="w">  </span><span class="err">│</span><span class="w">  </span><span class="err">→</span><span class="w"> </span><span class="mi">24</span><span class="nx">시간</span><span class="w"> </span><span class="nx">내</span><span class="w"> </span><span class="nx">동일</span><span class="w"> </span><span class="nx">알림</span><span class="w"> </span><span class="nx">방지</span><span class="w">                                      </span><span class="err">│</span><span class="w">   </span><span class="err">│</span>
<span class="err">│</span><span class="w">  </span><span class="err">│</span><span class="w">                                                                  </span><span class="err">│</span><span class="w">   </span><span class="err">│</span>
<span class="err">│</span><span class="w">  </span><span class="err">│</span><span class="w">  </span><span class="mi">6</span><span class="p">.</span><span class="w"> </span><span class="nx">큐에</span><span class="w"> </span><span class="nx">발행</span><span class="w">                                                    </span><span class="err">│</span><span class="w">   </span><span class="err">│</span>
<span class="err">│</span><span class="w">  </span><span class="err">│</span><span class="w">  </span><span class="err">─────────────────</span><span class="w">                                               </span><span class="err">│</span><span class="w">   </span><span class="err">│</span>
<span class="err">│</span><span class="w">  </span><span class="err">│</span><span class="w">  </span><span class="nx">Publish</span><span class="w"> </span><span class="nx">to</span><span class="w"> </span><span class="nx">ios_queue</span><span class="p">,</span><span class="w"> </span><span class="nx">android_queue</span><span class="p">,</span><span class="w"> </span><span class="nx">email_queue</span><span class="w">               </span><span class="err">│</span><span class="w">   </span><span class="err">│</span>
<span class="err">│</span><span class="w">  </span><span class="err">│</span><span class="w">                                                                  </span><span class="err">│</span><span class="w">   </span><span class="err">│</span>
<span class="err">│</span><span class="w">  </span><span class="err">│</span><span class="w">  </span><span class="mi">7</span><span class="p">.</span><span class="w"> </span><span class="nx">Worker</span><span class="w"> </span><span class="nx">처리</span><span class="w">                                                  </span><span class="err">│</span><span class="w">   </span><span class="err">│</span>
<span class="err">│</span><span class="w">  </span><span class="err">│</span><span class="w">  </span><span class="err">─────────────────</span><span class="w">                                               </span><span class="err">│</span><span class="w">   </span><span class="err">│</span>
<span class="err">│</span><span class="w">  </span><span class="err">│</span><span class="w">  </span><span class="nx">iOS</span><span class="w"> </span><span class="nx">Worker</span><span class="w"> </span><span class="err">→</span><span class="w"> </span><span class="nx">APNs</span><span class="w"> </span><span class="nx">API</span><span class="w"> </span><span class="err">→</span><span class="w"> </span><span class="nx">Apple</span><span class="w"> </span><span class="nx">서버</span><span class="w">                             </span><span class="err">│</span><span class="w">   </span><span class="err">│</span>
<span class="err">│</span><span class="w">  </span><span class="err">│</span><span class="w">  </span><span class="nx">Android</span><span class="w"> </span><span class="nx">Worker</span><span class="w"> </span><span class="err">→</span><span class="w"> </span><span class="nx">FCM</span><span class="w"> </span><span class="nx">API</span><span class="w"> </span><span class="err">→</span><span class="w"> </span><span class="nx">Google</span><span class="w"> </span><span class="nx">서버</span><span class="w">                         </span><span class="err">│</span><span class="w">   </span><span class="err">│</span>
<span class="err">│</span><span class="w">  </span><span class="err">│</span><span class="w">  </span><span class="nx">Email</span><span class="w"> </span><span class="nx">Worker</span><span class="w"> </span><span class="err">→</span><span class="w"> </span><span class="nx">SES</span><span class="w"> </span><span class="nx">API</span><span class="w"> </span><span class="err">→</span><span class="w"> </span><span class="nx">이메일</span><span class="w"> </span><span class="nx">전송</span><span class="w">                           </span><span class="err">│</span><span class="w">   </span><span class="err">│</span>
<span class="err">│</span><span class="w">  </span><span class="err">│</span><span class="w">                                                                  </span><span class="err">│</span><span class="w">   </span><span class="err">│</span>
<span class="err">│</span><span class="w">  </span><span class="err">│</span><span class="w">  </span><span class="mi">8</span><span class="p">.</span><span class="w"> </span><span class="nx">결과</span><span class="w"> </span><span class="nx">저장</span><span class="w">                                                    </span><span class="err">│</span><span class="w">   </span><span class="err">│</span>
<span class="err">│</span><span class="w">  </span><span class="err">│</span><span class="w">  </span><span class="err">─────────────────</span><span class="w">                                               </span><span class="err">│</span><span class="w">   </span><span class="err">│</span>
<span class="err">│</span><span class="w">  </span><span class="err">│</span><span class="w">  </span><span class="nx">INSERT</span><span class="w"> </span><span class="nx">INTO</span><span class="w"> </span><span class="nx">notification_logs</span><span class="w"> </span><span class="p">(</span><span class="o">...</span><span class="p">)</span><span class="w">                            </span><span class="err">│</span><span class="w">   </span><span class="err">│</span>
<span class="err">│</span><span class="w">  </span><span class="err">│</span><span class="w">                                                                  </span><span class="err">│</span><span class="w">   </span><span class="err">│</span>
<span class="err">│</span><span class="w">  </span><span class="err">└─────────────────────────────────────────────────────────────────┘</span><span class="w">   </span><span class="err">│</span>
<span class="err">│</span><span class="w">                                                                         </span><span class="err">│</span>
<span class="err">└─────────────────────────────────────────────────────────────────────────┘</span>
</code></pre></div>

<h3 id="34">3.4 중복 방지<a class="header-link" href="#34" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><span class="err">┌─────────────────────────────────────────────────────────────────────────┐</span>
<span class="err">│</span><span class="w">                     </span><span class="nx">중복</span><span class="w"> </span><span class="nx">알림</span><span class="w"> </span><span class="nx">방지</span><span class="w">                                      </span><span class="err">│</span>
<span class="err">├─────────────────────────────────────────────────────────────────────────┤</span>
<span class="err">│</span><span class="w">                                                                         </span><span class="err">│</span>
<span class="err">│</span><span class="w">  </span><span class="nx">문제</span><span class="p">:</span><span class="w">                                                                  </span><span class="err">│</span>
<span class="err">│</span><span class="w">  </span><span class="o">-</span><span class="w"> </span><span class="nx">이벤트</span><span class="w"> </span><span class="nx">중복</span><span class="w"> </span><span class="nx">발행</span><span class="w">                                                     </span><span class="err">│</span>
<span class="err">│</span><span class="w">  </span><span class="o">-</span><span class="w"> </span><span class="nx">Worker</span><span class="w"> </span><span class="nx">재시도로</span><span class="w"> </span><span class="nx">인한</span><span class="w"> </span><span class="nx">중복</span><span class="w">                                            </span><span class="err">│</span>
<span class="err">│</span><span class="w">  </span><span class="o">-</span><span class="w"> </span><span class="nx">분산</span><span class="w"> </span><span class="nx">환경에서의</span><span class="w"> </span><span class="nx">Race</span><span class="w"> </span><span class="nx">Condition</span><span class="w">                                       </span><span class="err">│</span>
<span class="err">│</span><span class="w">                                                                         </span><span class="err">│</span>
<span class="err">│</span><span class="w">  </span><span class="nx">해결책</span><span class="p">:</span><span class="w">                                                                </span><span class="err">│</span>
<span class="err">│</span><span class="w">  </span><span class="err">┌─────────────────────────────────────────────────────────────────┐</span><span class="w">   </span><span class="err">│</span>
<span class="err">│</span><span class="w">  </span><span class="err">│</span><span class="w">                                                                  </span><span class="err">│</span><span class="w">   </span><span class="err">│</span>
<span class="err">│</span><span class="w">  </span><span class="err">│</span><span class="w">  </span><span class="mi">1</span><span class="p">.</span><span class="w"> </span><span class="nx">이벤트</span><span class="w"> </span><span class="nx">레벨</span><span class="w"> </span><span class="nx">중복</span><span class="w"> </span><span class="nx">제거</span><span class="w">                                        </span><span class="err">│</span><span class="w">   </span><span class="err">│</span>
<span class="err">│</span><span class="w">  </span><span class="err">│</span><span class="w">  </span><span class="err">─────────────────────────</span><span class="w">                                       </span><span class="err">│</span><span class="w">   </span><span class="err">│</span>
<span class="err">│</span><span class="w">  </span><span class="err">│</span><span class="w">  </span><span class="nx">event_key</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nx">hash</span><span class="p">(</span><span class="nx">event_type</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nx">user_id</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nx">key_data</span><span class="p">)</span><span class="w">              </span><span class="err">│</span><span class="w">   </span><span class="err">│</span>
<span class="err">│</span><span class="w">  </span><span class="err">│</span><span class="w">                                                                  </span><span class="err">│</span><span class="w">   </span><span class="err">│</span>
<span class="err">│</span><span class="w">  </span><span class="err">│</span><span class="w">  </span><span class="k">if</span><span class="w"> </span><span class="k">not</span><span class="w"> </span><span class="nx">redis</span><span class="p">.</span><span class="nx">setnx</span><span class="p">(</span><span class="nx">f</span><span class="s">&quot;dedup:{event_key}&quot;</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="nx">ex</span><span class="p">=</span><span class="mi">86400</span><span class="p">):</span><span class="w">        </span><span class="err">│</span><span class="w">   </span><span class="err">│</span>
<span class="err">│</span><span class="w">  </span><span class="err">│</span><span class="w">      </span><span class="k">return</span><span class="w">  </span><span class="err">#</span><span class="w"> </span><span class="nx">이미</span><span class="w"> </span><span class="nx">처리됨</span><span class="w">                                      </span><span class="err">│</span><span class="w">   </span><span class="err">│</span>
<span class="err">│</span><span class="w">  </span><span class="err">│</span><span class="w">                                                                  </span><span class="err">│</span><span class="w">   </span><span class="err">│</span>
<span class="err">│</span><span class="w">  </span><span class="err">│</span><span class="w">  </span><span class="mi">2</span><span class="p">.</span><span class="w"> </span><span class="nx">전송</span><span class="w"> </span><span class="nx">레벨</span><span class="w"> </span><span class="nx">중복</span><span class="w"> </span><span class="nx">제거</span><span class="w">                                          </span><span class="err">│</span><span class="w">   </span><span class="err">│</span>
<span class="err">│</span><span class="w">  </span><span class="err">│</span><span class="w">  </span><span class="err">─────────────────────────</span><span class="w">                                       </span><span class="err">│</span><span class="w">   </span><span class="err">│</span>
<span class="err">│</span><span class="w">  </span><span class="err">│</span><span class="w">  </span><span class="nx">notification_id</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nx">generate_unique_id</span><span class="p">()</span><span class="w">                         </span><span class="err">│</span><span class="w">   </span><span class="err">│</span>
<span class="err">│</span><span class="w">  </span><span class="err">│</span><span class="w">                                                                  </span><span class="err">│</span><span class="w">   </span><span class="err">│</span>
<span class="err">│</span><span class="w">  </span><span class="err">│</span><span class="w">  </span><span class="nx">각</span><span class="w"> </span><span class="nx">채널별</span><span class="w"> </span><span class="nx">전송</span><span class="w"> </span><span class="nx">전</span><span class="w"> </span><span class="nx">체크</span><span class="p">:</span><span class="w">                                         </span><span class="err">│</span><span class="w">   </span><span class="err">│</span>
<span class="err">│</span><span class="w">  </span><span class="err">│</span><span class="w">  </span><span class="k">if</span><span class="w"> </span><span class="k">not</span><span class="w"> </span><span class="nx">redis</span><span class="p">.</span><span class="nx">setnx</span><span class="p">(</span><span class="nx">f</span><span class="s">&quot;sent:{notification_id}:{channel}&quot;</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="p">):</span><span class="w">   </span><span class="err">│</span><span class="w">   </span><span class="err">│</span>
<span class="err">│</span><span class="w">  </span><span class="err">│</span><span class="w">      </span><span class="k">return</span><span class="w">  </span><span class="err">#</span><span class="w"> </span><span class="nx">이미</span><span class="w"> </span><span class="nx">전송됨</span><span class="w">                                      </span><span class="err">│</span><span class="w">   </span><span class="err">│</span>
<span class="err">│</span><span class="w">  </span><span class="err">│</span><span class="w">                                                                  </span><span class="err">│</span><span class="w">   </span><span class="err">│</span>
<span class="err">│</span><span class="w">  </span><span class="err">│</span><span class="w">  </span><span class="mi">3</span><span class="p">.</span><span class="w"> </span><span class="nx">빈도</span><span class="w"> </span><span class="nx">제한</span><span class="w">                                                    </span><span class="err">│</span><span class="w">   </span><span class="err">│</span>
<span class="err">│</span><span class="w">  </span><span class="err">│</span><span class="w">  </span><span class="err">─────────────────────────</span><span class="w">                                       </span><span class="err">│</span><span class="w">   </span><span class="err">│</span>
<span class="err">│</span><span class="w">  </span><span class="err">│</span><span class="w">  </span><span class="nx">max_per_hour</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="mi">10</span><span class="w">                                              </span><span class="err">│</span><span class="w">   </span><span class="err">│</span>
<span class="err">│</span><span class="w">  </span><span class="err">│</span><span class="w">                                                                  </span><span class="err">│</span><span class="w">   </span><span class="err">│</span>
<span class="err">│</span><span class="w">  </span><span class="err">│</span><span class="w">  </span><span class="nx">current</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nx">redis</span><span class="p">.</span><span class="nx">incr</span><span class="p">(</span><span class="nx">f</span><span class="s">&quot;rate:{user_id}:{hour}&quot;</span><span class="p">)</span><span class="w">                </span><span class="err">│</span><span class="w">   </span><span class="err">│</span>
<span class="err">│</span><span class="w">  </span><span class="err">│</span><span class="w">  </span><span class="k">if</span><span class="w"> </span><span class="nx">current</span><span class="w"> </span><span class="p">&gt;</span><span class="w"> </span><span class="nx">max_per_hour</span><span class="p">:</span><span class="w">                                     </span><span class="err">│</span><span class="w">   </span><span class="err">│</span>
<span class="err">│</span><span class="w">  </span><span class="err">│</span><span class="w">      </span><span class="err">#</span><span class="w"> </span><span class="nx">제한</span><span class="w"> </span><span class="nx">초과</span><span class="w"> </span><span class="err">→</span><span class="w"> </span><span class="nx">나중에</span><span class="w"> </span><span class="nx">발송</span><span class="w"> </span><span class="nx">또는</span><span class="w"> </span><span class="nx">무시</span><span class="w">                         </span><span class="err">│</span><span class="w">   </span><span class="err">│</span>
<span class="err">│</span><span class="w">  </span><span class="err">│</span><span class="w">      </span><span class="nx">enqueue_for_later</span><span class="p">()</span><span class="w">                                        </span><span class="err">│</span><span class="w">   </span><span class="err">│</span>
<span class="err">│</span><span class="w">  </span><span class="err">│</span><span class="w">                                                                  </span><span class="err">│</span><span class="w">   </span><span class="err">│</span>
<span class="err">│</span><span class="w">  </span><span class="err">└─────────────────────────────────────────────────────────────────┘</span><span class="w">   </span><span class="err">│</span>
<span class="err">│</span><span class="w">                                                                         </span><span class="err">│</span>
<span class="err">└─────────────────────────────────────────────────────────────────────────┘</span>
</code></pre></div>

<h3 id="35">3.5 우선순위 처리<a class="header-link" href="#35" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code>┌─────────────────────────────────────────────────────────────────────────┐
│                     알림 우선순위                                       │
├─────────────────────────────────────────────────────────────────────────┤
│                                                                         │
│  우선순위 분류:                                                         │
│  ┌─────────────────────────────────────────────────────────────────┐   │
│  │                                                                  │   │
│  │  HIGH (즉시):                                                    │   │
│  │  - 보안 알림 (비정상 로그인)                                     │   │
│  │  - 2FA 인증 코드                                                 │   │
│  │  - 긴급 시스템 알림                                              │   │
│  │                                                                  │   │
│  │  MEDIUM (수 초 내):                                              │   │
│  │  - 채팅 메시지                                                   │   │
│  │  - 주문 상태 변경                                                │   │
│  │  - 결제 알림                                                     │   │
│  │                                                                  │   │
│  │  LOW (수 분 ~ 시간):                                             │   │
│  │  - 마케팅 알림                                                   │   │
│  │  - 추천 알림                                                     │   │
│  │  - 요약 알림                                                     │   │
│  │                                                                  │   │
│  └─────────────────────────────────────────────────────────────────┘   │
│                                                                         │
│  구현:                                                                  │
│  ┌─────────────────────────────────────────────────────────────────┐   │
│  │                                                                  │   │
│  │  우선순위별 큐:                                                  │   │
│  │                                                                  │   │
│  │  ┌─────────────────┐                                            │   │
│  │  │ HIGH Queue      │ ──► 전용 Worker 10대                       │   │
│  │  └─────────────────┘     (항상 즉시 처리)                       │   │
│  │                                                                  │   │
│  │  ┌─────────────────┐                                            │   │
│  │  │ MEDIUM Queue    │ ──► 공유 Worker 50대                       │   │
│  │  └─────────────────┘     (HIGH 비어있을 때)                     │   │
│  │                                                                  │   │
│  │  ┌─────────────────┐                                            │   │
│  │  │ LOW Queue       │ ──► 공유 Worker 50대                       │   │
│  │  └─────────────────┘     (HIGH, MEDIUM 비어있을 때)             │   │
│  │                                                                  │   │
│  │  Worker 처리 순서:                                               │   │
│  │  while True:                                                    │   │
│  │      msg = high_queue.pop() or                                  │   │
│  │            medium_queue.pop() or                                │   │
│  │            low_queue.pop()                                      │   │
│  │      process(msg)                                               │   │
│  │                                                                  │   │
│  └─────────────────────────────────────────────────────────────────┘   │
│                                                                         │
└─────────────────────────────────────────────────────────────────────────┘
</code></pre></div>

<h3 id="36">3.6 알림 설정 스키마<a class="header-link" href="#36" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><span class="err">┌─────────────────────────────────────────────────────────────────────────┐</span>
<span class="err">│</span><span class="w">                     </span><span class="nx">DB</span><span class="w"> </span><span class="nx">스키마</span><span class="w">                                           </span><span class="err">│</span>
<span class="err">├─────────────────────────────────────────────────────────────────────────┤</span>
<span class="err">│</span><span class="w">                                                                         </span><span class="err">│</span>
<span class="err">│</span><span class="w">  </span><span class="nx">user_notification_settings</span><span class="p">:</span><span class="w">                                           </span><span class="err">│</span>
<span class="err">│</span><span class="w">  </span><span class="err">┌─────────────────────────────────────────────────────────────────┐</span><span class="w">   </span><span class="err">│</span>
<span class="err">│</span><span class="w">  </span><span class="err">│</span><span class="w">  </span><span class="nx">user_id</span><span class="w">          </span><span class="nx">UUID</span><span class="w">          </span><span class="nx">PK</span><span class="w">                              </span><span class="err">│</span><span class="w">   </span><span class="err">│</span>
<span class="err">│</span><span class="w">  </span><span class="err">│</span><span class="w">  </span><span class="nx">channel</span><span class="w">          </span><span class="nx">VARCHAR</span><span class="w">       </span><span class="nx">PK</span><span class="w"> </span><span class="p">(</span><span class="nx">push</span><span class="o">/</span><span class="nx">email</span><span class="o">/</span><span class="nx">sms</span><span class="p">)</span><span class="w">             </span><span class="err">│</span><span class="w">   </span><span class="err">│</span>
<span class="err">│</span><span class="w">  </span><span class="err">│</span><span class="w">  </span><span class="nx">enabled</span><span class="w">          </span><span class="nx">BOOLEAN</span><span class="w">                                       </span><span class="err">│</span><span class="w">   </span><span class="err">│</span>
<span class="err">│</span><span class="w">  </span><span class="err">│</span><span class="w">  </span><span class="nx">quiet_hours</span><span class="w">      </span><span class="nx">JSONB</span><span class="w">         </span><span class="p">{</span><span class="s">&quot;start&quot;</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;22:00&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;end&quot;</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;08:00&quot;</span><span class="p">}</span><span class="err">│</span><span class="w">  </span><span class="err">│</span>
<span class="err">│</span><span class="w">  </span><span class="err">│</span><span class="w">  </span><span class="nx">frequency</span><span class="w">        </span><span class="nx">VARCHAR</span><span class="w">       </span><span class="nx">immediate</span><span class="o">/</span><span class="nx">daily</span><span class="o">/</span><span class="nx">weekly</span><span class="w">          </span><span class="err">│</span><span class="w">   </span><span class="err">│</span>
<span class="err">│</span><span class="w">  </span><span class="err">└─────────────────────────────────────────────────────────────────┘</span><span class="w">   </span><span class="err">│</span>
<span class="err">│</span><span class="w">                                                                         </span><span class="err">│</span>
<span class="err">│</span><span class="w">  </span><span class="nx">notification_type_settings</span><span class="p">:</span><span class="w">                                           </span><span class="err">│</span>
<span class="err">│</span><span class="w">  </span><span class="err">┌─────────────────────────────────────────────────────────────────┐</span><span class="w">   </span><span class="err">│</span>
<span class="err">│</span><span class="w">  </span><span class="err">│</span><span class="w">  </span><span class="nx">user_id</span><span class="w">          </span><span class="nx">UUID</span><span class="w">          </span><span class="nx">PK</span><span class="w">                              </span><span class="err">│</span><span class="w">   </span><span class="err">│</span>
<span class="err">│</span><span class="w">  </span><span class="err">│</span><span class="w">  </span><span class="nx">notification_type</span><span class="w"> </span><span class="nx">VARCHAR</span><span class="w">      </span><span class="nx">PK</span><span class="w"> </span><span class="p">(</span><span class="nx">order</span><span class="o">/</span><span class="nx">social</span><span class="o">/</span><span class="nx">marketing</span><span class="p">)</span><span class="w">     </span><span class="err">│</span><span class="w">   </span><span class="err">│</span>
<span class="err">│</span><span class="w">  </span><span class="err">│</span><span class="w">  </span><span class="nx">push_enabled</span><span class="w">     </span><span class="nx">BOOLEAN</span><span class="w">                                       </span><span class="err">│</span><span class="w">   </span><span class="err">│</span>
<span class="err">│</span><span class="w">  </span><span class="err">│</span><span class="w">  </span><span class="nx">email_enabled</span><span class="w">    </span><span class="nx">BOOLEAN</span><span class="w">                                       </span><span class="err">│</span><span class="w">   </span><span class="err">│</span>
<span class="err">│</span><span class="w">  </span><span class="err">│</span><span class="w">  </span><span class="nx">sms_enabled</span><span class="w">      </span><span class="nx">BOOLEAN</span><span class="w">                                       </span><span class="err">│</span><span class="w">   </span><span class="err">│</span>
<span class="err">│</span><span class="w">  </span><span class="err">└─────────────────────────────────────────────────────────────────┘</span><span class="w">   </span><span class="err">│</span>
<span class="err">│</span><span class="w">                                                                         </span><span class="err">│</span>
<span class="err">│</span><span class="w">  </span><span class="nx">user_devices</span><span class="p">:</span><span class="w">                                                         </span><span class="err">│</span>
<span class="err">│</span><span class="w">  </span><span class="err">┌─────────────────────────────────────────────────────────────────┐</span><span class="w">   </span><span class="err">│</span>
<span class="err">│</span><span class="w">  </span><span class="err">│</span><span class="w">  </span><span class="nx">device_id</span><span class="w">        </span><span class="nx">UUID</span><span class="w">          </span><span class="nx">PK</span><span class="w">                              </span><span class="err">│</span><span class="w">   </span><span class="err">│</span>
<span class="err">│</span><span class="w">  </span><span class="err">│</span><span class="w">  </span><span class="nx">user_id</span><span class="w">          </span><span class="nx">UUID</span><span class="w">          </span><span class="nx">FK</span><span class="w">                              </span><span class="err">│</span><span class="w">   </span><span class="err">│</span>
<span class="err">│</span><span class="w">  </span><span class="err">│</span><span class="w">  </span><span class="nx">platform</span><span class="w">         </span><span class="nx">VARCHAR</span><span class="w">       </span><span class="nx">ios</span><span class="o">/</span><span class="nx">android</span><span class="w">                     </span><span class="err">│</span><span class="w">   </span><span class="err">│</span>
<span class="err">│</span><span class="w">  </span><span class="err">│</span><span class="w">  </span><span class="nx">device_token</span><span class="w">     </span><span class="nx">VARCHAR</span><span class="w">       </span><span class="nx">푸시</span><span class="w"> </span><span class="nx">토큰</span><span class="w">                        </span><span class="err">│</span><span class="w">   </span><span class="err">│</span>
<span class="err">│</span><span class="w">  </span><span class="err">│</span><span class="w">  </span><span class="nx">last_active</span><span class="w">      </span><span class="nx">TIMESTAMP</span><span class="w">     </span><span class="nx">마지막</span><span class="w"> </span><span class="nx">활성</span><span class="w">                      </span><span class="err">│</span><span class="w">   </span><span class="err">│</span>
<span class="err">│</span><span class="w">  </span><span class="err">│</span><span class="w">  </span><span class="nx">app_version</span><span class="w">      </span><span class="nx">VARCHAR</span><span class="w">       </span><span class="nx">앱</span><span class="w"> </span><span class="nx">버전</span><span class="w">                          </span><span class="err">│</span><span class="w">   </span><span class="err">│</span>
<span class="err">│</span><span class="w">  </span><span class="err">└─────────────────────────────────────────────────────────────────┘</span><span class="w">   </span><span class="err">│</span>
<span class="err">│</span><span class="w">                                                                         </span><span class="err">│</span>
<span class="err">│</span><span class="w">  </span><span class="nx">notification_logs</span><span class="p">:</span><span class="w">                                                    </span><span class="err">│</span>
<span class="err">│</span><span class="w">  </span><span class="err">┌─────────────────────────────────────────────────────────────────┐</span><span class="w">   </span><span class="err">│</span>
<span class="err">│</span><span class="w">  </span><span class="err">│</span><span class="w">  </span><span class="nx">id</span><span class="w">               </span><span class="nx">UUID</span><span class="w">          </span><span class="nx">PK</span><span class="w">                              </span><span class="err">│</span><span class="w">   </span><span class="err">│</span>
<span class="err">│</span><span class="w">  </span><span class="err">│</span><span class="w">  </span><span class="nx">user_id</span><span class="w">          </span><span class="nx">UUID</span><span class="w">                                          </span><span class="err">│</span><span class="w">   </span><span class="err">│</span>
<span class="err">│</span><span class="w">  </span><span class="err">│</span><span class="w">  </span><span class="k">type</span><span class="w">             </span><span class="nx">VARCHAR</span><span class="w">       </span><span class="nx">알림</span><span class="w"> </span><span class="nx">유형</span><span class="w">                        </span><span class="err">│</span><span class="w">   </span><span class="err">│</span>
<span class="err">│</span><span class="w">  </span><span class="err">│</span><span class="w">  </span><span class="nx">channel</span><span class="w">          </span><span class="nx">VARCHAR</span><span class="w">       </span><span class="nx">전송</span><span class="w"> </span><span class="nx">채널</span><span class="w">                        </span><span class="err">│</span><span class="w">   </span><span class="err">│</span>
<span class="err">│</span><span class="w">  </span><span class="err">│</span><span class="w">  </span><span class="nx">content</span><span class="w">          </span><span class="nx">JSONB</span><span class="w">         </span><span class="nx">알림</span><span class="w"> </span><span class="nx">내용</span><span class="w">                        </span><span class="err">│</span><span class="w">   </span><span class="err">│</span>
<span class="err">│</span><span class="w">  </span><span class="err">│</span><span class="w">  </span><span class="nx">status</span><span class="w">           </span><span class="nx">VARCHAR</span><span class="w">       </span><span class="nx">sent</span><span class="o">/</span><span class="nx">failed</span><span class="o">/</span><span class="nx">pending</span><span class="w">             </span><span class="err">│</span><span class="w">   </span><span class="err">│</span>
<span class="err">│</span><span class="w">  </span><span class="err">│</span><span class="w">  </span><span class="nx">sent_at</span><span class="w">          </span><span class="nx">TIMESTAMP</span><span class="w">     </span><span class="nx">전송</span><span class="w"> </span><span class="nx">시간</span><span class="w">                        </span><span class="err">│</span><span class="w">   </span><span class="err">│</span>
<span class="err">│</span><span class="w">  </span><span class="err">│</span><span class="w">  </span><span class="nx">read_at</span><span class="w">          </span><span class="nx">TIMESTAMP</span><span class="w">     </span><span class="nx">읽음</span><span class="w"> </span><span class="nx">시간</span><span class="w">                        </span><span class="err">│</span><span class="w">   </span><span class="err">│</span>
<span class="err">│</span><span class="w">  </span><span class="err">└─────────────────────────────────────────────────────────────────┘</span><span class="w">   </span><span class="err">│</span>
<span class="err">│</span><span class="w">                                                                         </span><span class="err">│</span>
<span class="err">└─────────────────────────────────────────────────────────────────────────┘</span>
</code></pre></div>

<hr />
<h2 id="4">4. 연습 문제<a class="header-link" href="#4" title="Permanent link">&para;</a></h2>
<h3 id="1_1">연습 1: 뉴스 피드 확장<a class="header-link" href="#1_1" title="Permanent link">&para;</a></h3>
<p>다음 기능을 추가하는 설계를 하세요:
- 광고 삽입 (5번째 포스트마다)
- 트렌딩 포스트 추천
- "관심 없음" 피드백 반영</p>
<h3 id="2_1">연습 2: 채팅 시스템 확장<a class="header-link" href="#2_1" title="Permanent link">&para;</a></h3>
<p>다음 요구사항을 만족하는 설계를 하세요:
- End-to-End 암호화
- 메시지 편집/삭제 (24시간 내)
- 화상/음성 통화 시그널링</p>
<h3 id="3_1">연습 3: 알림 시스템 최적화<a class="header-link" href="#3_1" title="Permanent link">&para;</a></h3>
<p>다음 상황을 처리하는 설계를 하세요:
- 글로벌 서비스: 다국어 알림
- 알림 배칭: 유사 알림 묶음
- A/B 테스트: 알림 문구 최적화</p>
<hr />
<h2 id="_3">마무리<a class="header-link" href="#_3" title="Permanent link">&para;</a></h2>
<p>이 시리즈를 통해 시스템 설계의 핵심 개념과 패턴을 학습했습니다. 실제 면접이나 프로젝트에서는 요구사항을 명확히 하고, 트레이드오프를 고려하며, 확장 가능한 설계를 하는 것이 중요합니다.</p>
<p>다음 단계로는:
- 실제 오픈소스 시스템 코드 분석
- 기업 기술 블로그 연구 (Netflix, Uber, Twitter 등)
- 모의 시스템 설계 면접 연습</p>
<hr />
<h2 id="_4">참고 자료<a class="header-link" href="#_4" title="Permanent link">&para;</a></h2>
<ul>
<li>"System Design Interview" - Alex Xu Vol.1 &amp; Vol.2</li>
<li>"Designing Data-Intensive Applications" - Martin Kleppmann</li>
<li>Twitter Timeline Architecture</li>
<li>Facebook News Feed Architecture</li>
<li>WhatsApp Architecture at Scale</li>
<li>Discord How Discord Stores Billions of Messages</li>
<li>Airbnb Notification System</li>
</ul>
    </div>

    
<div class="lesson-toolbar lesson-toolbar--bottom">
    <div class="toolbar-nav toolbar-nav--prev">
        
        <a href="/study/ko/System_Design/17_Design_Example_1.html" class="nav-prev">
            <span class="nav-label">Previous</span>
            <span class="nav-title">실전 설계 예제 1 (Practical Design Examples 1)</span>
        </a>
        
    </div>
    <div class="toolbar-actions">
        <button class="btn btn-copy-link" data-action="copy-link" title="Copy link">
            <span class="icon">🔗</span>
            <span class="text">Copy link</span>
        </button>
        <a href="/study/ko/System_Design/" class="btn btn-topic-link" title="Back to topic list">
            <span class="icon">📋</span>
            <span class="text">Topic list</span>
        </a>
    </div>
    <div class="toolbar-nav toolbar-nav--next">
        
        <a href="/study/ko/System_Design/19_Observability_Monitoring.html" class="nav-next">
            <span class="nav-label">Next</span>
            <span class="nav-title">19. 관측 가능성과 모니터링</span>
        </a>
        
    </div>
</div>


    <div class="toolbar-keyboard-hint">
        <kbd>&larr;</kbd> <kbd>&rarr;</kbd> to navigate between lessons
    </div>
</article>

<!-- Scroll to top floating button -->
<button class="scroll-to-top" id="scroll-to-top" title="Scroll to top" aria-label="Scroll to top">↑</button>

            </div>
        </main>
    </div>

    <script src="/study/static/js/app.js"></script>
    <script>
        function switchLanguage(newLang) {
            const path = window.location.pathname;
            const base = '/study';
            const currentLang = 'ko';
            const newPath = path.replace(base + '/' + currentLang + '/', base + '/' + newLang + '/');
            window.location.href = newPath + window.location.search;
        }
    </script>
    
<script>
    document.addEventListener('DOMContentLoaded', function() {
        // Copy link - independent feedback per button
        document.querySelectorAll('[data-action="copy-link"]').forEach(function(btn) {
            btn.addEventListener('click', function() {
                navigator.clipboard.writeText(window.location.href);
                var textEl = this.querySelector('.text');
                var originalText = textEl.textContent;
                textEl.textContent = 'Copied!';
                setTimeout(function() { textEl.textContent = originalText; }, 2000);
            });
        });

        // Add copy buttons to code blocks
        document.querySelectorAll('.lesson-content pre').forEach(function(pre) {
            var copyBtn = document.createElement('button');
            copyBtn.className = 'code-copy-btn';
            copyBtn.textContent = 'Copy';
            copyBtn.addEventListener('click', function() {
                var code = pre.querySelector('code');
                var text = code ? code.textContent : pre.textContent;
                navigator.clipboard.writeText(text);
                copyBtn.textContent = 'Copied!';
                setTimeout(function() { copyBtn.textContent = 'Copy'; }, 2000);
            });
            pre.style.position = 'relative';
            pre.appendChild(copyBtn);
        });

        // Scroll to top button
        var scrollBtn = document.getElementById('scroll-to-top');
        window.addEventListener('scroll', function() {
            scrollBtn.classList.toggle('visible', window.scrollY > 300);
        });
        scrollBtn.addEventListener('click', function() {
            window.scrollTo({ top: 0, behavior: 'smooth' });
        });

        // Keyboard shortcuts: left/right arrows for lesson navigation
        document.addEventListener('keydown', function(e) {
            var tag = document.activeElement.tagName;
            if (tag === 'INPUT' || tag === 'TEXTAREA' || tag === 'SELECT') return;

            if (e.key === 'ArrowLeft') {
                var prevLink = document.querySelector('.nav-prev');
                if (prevLink) prevLink.click();
            } else if (e.key === 'ArrowRight') {
                var nextLink = document.querySelector('.nav-next');
                if (nextLink) nextLink.click();
            }
        });
    });
</script>

</body>
</html>
{% endraw %}